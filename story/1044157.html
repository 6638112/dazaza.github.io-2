<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>苹果M1汇编语言Hello World </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">苹果M1汇编语言Hello World </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-15 20:26:16</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/67b316814d6569bd05bbf2546083ebff.png"><img src="http://img2.diglog.com/img/2021/1/67b316814d6569bd05bbf2546083ebff.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>上周，我们讨论了使用新的基于Apple M1的Macintosh作为开发工作站，以及如何安装Apple的开发系统XCode还安装了包括LLVM和make在内的大量开源开发工具。本周，我们将介绍如何编译和运行一个简单的命令行ARM汇编语言Hello World程序。</p><p>    我的《用64位ARM汇编语言进行编程》一书包含了许多自包含的汇编语言程序示例，以及许多iOS和Android示例。使用GNU工具集为Linux编译了命令行实用程序。 Alex vonBelow接受了所有这些内容，并对其进行了修改，以与LLVM工具链配合使用并在Apple的开发环境中使用。他还处理了Linux与MacOS / iOS之间的所有差异。他的本书的源代码版本已针对苹果M1进行了修改，可在此处找到：</p><p>      MacOS和Linux均基于Unix，并且相似之处多于不同。但是，需要注意一些差异：</p><p>  MacOS默认使用LLVM，而Linux使用GNU GCC。就本文而言，这实际上仅影响makefile中的命令行参数。您可以在Linux上使用LLVM，并且GCC不久将可用于Apple M1。</p><p>  MacOS链接器/加载器不喜欢重定位，因此您需要使用ADR而不是LDR指令来加载地址。您可以在Linux中使用ADR，如果执行此操作，则两者均可使用。</p><p>  Unix API调用几乎相同，不同之处在于Linux在使用64位时重命名了功能号，而MacOS则使功能号保持不变。在32位世界中，它们是相同的，但是现在它们都不同了。</p><p>    Linux安装了各种库，并在/ usr / lib和/ usr / include下包含了文件，因此易于查找和使用。当您安装XCode时，它会为MacOS，iOS，iPadOS，iWatchOS等安装SDK，并可以选择为版本安装批量。库和包含库的路径相当复杂，您需要一个工具来查找它们。 </p><p>在MacOS中，程序必须在64位边界上启动，因此列表顶部附近有一个“ .align 2”指令。</p><p>  在MacOS中，即使您没有从系统库中进行系统调用或收到链接器错误，也需要在系统库中进行链接。该示例Hello World程序使用软件中断而不是系统库中的API进行软件调用来进行系统调用，因此无需链接至该程序。</p><p>  在MacOS中，默认入口点是_main，而在Linux中，默认入口点是_start。这是通过链接器的命令行参数进行更改的。</p><p>    下面是简单的汇编语言程序，可在终端窗口中打印出“ Hello World”。有关这些指令和ARM处理器体系结构的所有细节，请查阅我的书。</p><p>  // //汇编程序打印＆＃34; Hello World！＆＃34; //到标准输出。 // // X0-X2-linux函数服务的参数// X16-linux函数编号// .global _start //向链接器提供程序起始地址.align 2 //设置参数以打印hello world //然后调用Linux做到了。 _start：mov X0，＃1 // 1 = StdOut adr X1，helloworld //要打印的字符串mov X2，＃13 // //字符串的长度mov X16，＃4输出字符串//设置参数以退出程序// //然后调用Linux进行操作。 mov X0，＃0 //使用0返回代码mov X16，＃1 //服务命令代码1终止该程序svc 0 0 //调用linux终止程序helloworld; 34 ;</p><p>    这是makefile，汇编源代码的命令很简单，然后链接的命令则有点复杂。</p><p>    HelloWorld：HelloWorld.o ld -macosx_version_min 11.0.0 -o HelloWorld HelloWorld.o -lSystem -syslibroot`xcrun -sdk macosx --show-sdk-path` -e _start -arch arm64 HelloWorld.o：HelloWorld.s为-o HelloWorld.o HelloWorld.s </p><p>xcrun命令是Apple运行或查找各种SDK的命令。这是运行它的一个示例：</p><p>  stephensmith @ Stephens-MacBook-Air-2〜％xcrun -sdk macosx –show-sdk-path objc [42012]：AMSupportURLConnectionDelegate类在两个版本中都实现了？ （0x1edb5b8f0）和?? （0x122dd02b8）。将使用两者之一。哪一个未定义。 objc [42012]：类AMSupportURLSession在两个版本中都实现了？ （0x1edb5b940）和?? （0x122dd0308）。将使用两者之一。哪一个未定义。 objc [42013]：类AMSupportURLConnectionDelegate在两个版本中都实现了？ （0x1edb5b8f0）和?? （0x1141942b8）。将使用两者之一。哪一个未定义。 objc [42013]：类AMSupportURLSession在两个版本中都实现了？ （0x1edb5b940）和?? （0x114194308）。将使用两者之一。哪一个未定义。 /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.1.sdk stephensmith @ Stephens-MacBook-Air-2〜％</p><p>      stephensmith @ Stephens-MacBook-Air-2第1章将-B设为-o HelloWorld.o HelloWorld.s objc [42104]：AMSupportURLConnectionDelegate类在两种方法中都实现了？ （0x1edb5b8f0）和?? （0x1145342b8）。将使用两者之一。哪一个未定义。 objc [42104]：在这两种方法中都实现了AMSupportURLSession类。 （0x1edb5b940）和?? （0x114534308）。将使用两者之一。哪一个未定义。 ld -macosx_version_min 11.0.0 -o HelloWorld HelloWorld.o -lSystem -syslibroot`xcrun -sdk macosx –show-sdk-path` -e _start -arch arm64 stephensmith @ Stephens-MacBook-Air-2第1％./HelloWorld世界！ stephensmith @ Stephens-MacBook-Air-2第1章</p><p>    新的Apple M1 Macintoshes作为所有Apple Silicon的一部分运行ARM处理器，您可以运行标准的ARM 64位汇编语言。 LLVM是一个标准的开源开发工具，其中包含一个类似于GNU汇编器的汇编器。 MacOS的编程与Linux类似，因为两者均基于Unix，并且如果您熟悉Linux，则您的大部分知识都可以直接应用。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://smist08.wordpress.com/2021/01/08/apple-m1-assembly-language-hello-world/">https://smist08.wordpress.com/2021/01/08/apple-m1-assembly-language-hello-world/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/汇编/">#汇编</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/m1/">#m1</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1043518.html"><img src="http://img2.diglog.com/img/2021/1/thumb_ba0906cb05b61a6f0f012f124539c6a1.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1043518.html">汇编语言，街机游戏，YouTube：前微软工程师Dave Plummer </a></div><span class="my_story_list_date">2021-1-8 22:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1034793.html"><img src="http://img2.diglog.com/img/2020/11/thumb_88fd6ddb8253d4481c2e73bf9c8b9c36.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034793.html">在锈迹斑斑的情况下编写过多的Brainfuck编译器来学习汇编语言</a></div><span class="my_story_list_date">2020-11-13 0:36</span></div><div class="col-sm"><div><a target="_blank" href="/story/1032428.html"><img src="http://img2.diglog.com/img/2020/10/thumb_ccf2499049bb2a4a20b073fcece9794d.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032428.html">苹果拒绝了一款用于验证个人在宾夕法尼亚州投票状态的应用程序，称该应用程序违反了其禁止未经同意汇编用户数据的指导方针</a></div><span class="my_story_list_date">2020-10-31 9:16</span></div><div class="col-sm"><div><a target="_blank" href="/story/1025246.html"><img src="http://img2.diglog.com/img/2020/9/thumb_6cc9cc63b59f52c7afaff14ef7fb1126.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1025246.html">ICE：铁锈中的x86/x64反汇编器、汇编器、解码器、编码器</a></div><span class="my_story_list_date">2020-9-21 6:4</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>