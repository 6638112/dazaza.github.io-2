<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Syncthing：同步所有事物</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Syncthing：同步所有事物</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-07-24 07:13:22</div><div class="page_narrow text-break page_content"><p>LWN 订阅者为您带来的这篇文章 LWN.net 的订阅者使这篇文章——以及围绕它的一切——成为可能。如果您欣赏我们的内容，请购买订阅并让下一组文章成为可能。计算设备很棒；他们肯定是这样，因为我们中的许多人拥有如此多的人。然而，计算机的激增直接导致了一个熟悉的问题：我们想要的文件总是在错误的机器上。一种解决方案是同步服务，它使一组文件在多台机器上保持最新；许多公司已经在此类服务的基础上创造了成功的商业产品。然而，我们中的一些人顽固地抵制将我们的数据交到公司及其专有系统手中的想法。对于我们这些宁愿控制我们的数据的人来说，像 Syncthing 这样的系统提供了一个可能的解决方案。同步系统背后的核心思想本质上是相同的：给定一个目录列表和一个系统列表，确保这些目录在每个系统上具有相同的内容。如果在一个文件上添加一个文件，则将其复制到其余文件中；修改和删除（通常）也会传播。不过，问题总是出在细节上；从繁琐的设置程序到数据损坏和安全问题，同步出错的方式有很多。因此用户必须非常信任这些系统；开源代码是朝着这个目标迈出的重要一步，但也有必要相信所涉及的开发人员已经仔细考虑过这些问题。当北半球的夏天来临时，新消息变得相对稀少时，终于有机会检查一两个有趣的软件项目。因此，您的编辑一直在玩 Syncthing 1.17.0 版本，从Fedora 和 CentOS (EPEL) 存储库。在 Fedora 上启动系统只是运行 syncthing 命令来启动同步守护进程并尽量不要对生成的日志数据量感到沮丧。相反，EPEL 包似乎将 Syncthing 安装为 systemd 用户服务，这意味着所需要的只是登录系统并自动启动守护程序。该守护进程通过内部 Web 服务器进行管理，默认情况下，该服务器显示在端口 8384 上；请参阅右侧的示例图像。最初不需要身份验证；用户可能希望将其作为他们做的第一件事来解决这个问题。默认情况下，Web 服务器只能通过环回接口访问；对配置文件的更改可以使其整体上可用于 Internet，但这听起来像即使启用了身份验证，这也是一件大胆的事情。根据文档中的建议，获取远程计算机上的 Web 界面访问权限的另一种方法是从本地系统设置 SSH 隧道。第一次启动时，Syncthing 会生成一个“设备 ID”来标识本地系统；看起来像这样： 在两台机器之间设置同步类似于蓝牙配对过程；它是通过向每一方提供属于另一方的设备 ID 来完成的。此处建议使用复制和粘贴。或者，如果两个系统在同一个本地网络上，它们将通过广播发现彼此并询问（通过管理接口）是否应该建立连接。在系统之间建立连接后，用户必须告诉 Syncthing 哪些目录应该同步；这是设置文件夹并将它们与任何或所有已知远程系统（Syncthing 称为“设备”）共享的问题。一旦远程端接受共享，文件更改将来回传播。如果可能，Syncthing 会从内核请求文件更改通知；这导致相对较快的传播时间。有很多选项可以设置来控制共享。例如，共享可以是单向的，这样一个特定的系统就可以创建文件并将它们发送出去，而不接受其他系统的更改。一个特别有趣的（虽然是新的和“测试版”）功能是能够将文件共享到特定系统加密形式。例如，如果一个系统是主要用于备份或分发目的的云服务器，则可以为其提供无法读取的加密数据。但是，共享网络中具有正确密码的任何其他系统都可以读取这些文件。还有各种处理版本控制的方法，当一个系统更改文件时，它会保留旧版本的文件。值得注意的是，虽然可以配置一组连接到中央服务器的 Syncthing 客户端，但 Syncthing 中的任何内容都不需要那种架构。系统可以以任何看似合理的方式连接。如果一个系统发现它需要已经传播到多个连接的对等点的文件，它可以以块的形式接收所需的数据，BitTorrent 风格，从哪个系统可以首先提供它。有趣的是，配置过程的任何阶段都不涉及主机名和 IP 地址——至少在默认情况下是这样；系统仅根据设备 ID 相互查找，而不管它们连接到哪个网络。这显然需要一些第三方的帮助。 Syncthing 项目运行一组“发现”服务器，这些服务器将帮助系统根据它们的设备 ID 找到彼此。还有一组“中继服务器”可以中继所涉及的系统无法直接相互访问的数据情况——例如，当它们都在 NAT 防火墙后面时。一些想法已经清楚地进入了这种架构的安全隐患。例如，只有在没有替代方案的情况下，数据才会通过中继服务器，并且在端点加密。但是仍然有一些信息是恶意发现或中继服务器可以获得的，这可能会让一些用户感到担忧。对于真正担心的人，两种类型的服务器的代码都可用；任何人都可以设置私有服务器并将他们的 Syncthing 实例配置为仅使用那些。根据文档，设备 ID 不需要保密，因为双方都需要采取肯定的行动来建立连接。人们可能想知道攻击者是否会尝试使用目标设备 ID 建立系统，从而获得对目标设备 ID 的访问权限。管理的文件。但是，该 ID 本质上是一个公钥，并且连接过程涉及证明拥有关联的私钥，因此这种攻击应该是不可能的。此页面更详细地描述了设备 ID。也许当今网络上同步最常见的用途是将照片从手机复制到中央服务器。由于Android手机至少是基于Linux的，因此只需在onit上设置一个正常的shell环境并将Syncthing放在那里即可实现这一目标；这个过程应该不会超过一天左右。或者，您可以安装 Android 应用程序，该应用程序也可以在 F-Droid 和 Google Play 商店中使用。右侧显示的这个应用程序带有一个用于开箱即用配置的相机文件夹（设置为仅发送共享），因此只需设置对等点即可。而且，为了避免使用屏幕键盘输入其中一个设备 ID 的问题，该应用程序可以读取 Web 界面将提供的有用的 QR 码，从而大大简化了该过程。一个稍微令人惊讶的行为是应用程序要求位置许可，这似乎不是它需要的东西。需要该权限来确定手机在哪个 WiFi 网络（如果有）上，这对于配置何时应该（和不应该）执行同步的功能很有用。计量 WiFi 服务的用户可能希望使用此机制来避免同步，因为它可能会花费他们金钱。在没有此权限的情况下，默认情况下，应用程序将在连接到任何 WiFi 网络时执行同步。无需多看，用户就会抱怨 Android 应用程序会很快耗尽电池电量。您的编辑器没有在有限的测试中观察到这种行为；最严重的问题可能已经解决了。该项目声明“安全是主要的项目目标之一”，开发人员似乎确实对这个问题进行了一些思考。在正确的地方使用了加密，验证了证书等。快速的 CVEsearch 在过去四年中发现了两个条目，其中一个允许覆盖任意文件。利用该漏洞需要首先获得对共享网络中一台机器的控制权，此时无论如何战斗都可能失败。似乎没有进行任何形式的正式安全审核，但 Syncthing 开发人员至少做出了正确的选择种噪音。关于可靠性，从使用 Syncthing 丢失数据的用户那里搜索（并找到）各种可怕的故事并不难。这些问题中的许多似乎是操作员错误的结果；如果您设置了一个系统并允许它删除您的所有数据，它最终可能会得出结论，您希望它完全这样做。同步在传播错误方面可以非常有效。使用版本控制会有所帮助，因为可以尽可能避免使用双向同步。 Syncthing 似乎没有很多数据丢失错误，但备份总是一个好主意。至少从 2013 年开始，Syncthing 就一直在同步事物，当时 firstcommit 出现在其 Git 存储库中； LWN 在 2014 年看过它。该项目主要是用 Go 编写的，并在 Mozilla Public License 下分发。当前的 Syncthing 版本是 1.18.0；它于 7 月 6 日发布 - 正在撰写本文时。该项目在过去一年中呈现出近一个月的发布节奏； 1.7.0 于 2020 年 7 月 7 日发布。在过去的一年里，40 名开发人员向 Syncthing 存储库提交了 728 次非合并提交；前三位开发人员（Simon Frei、Jakob Borg 和 Jesse Lucas）占这些提交的 76% 以上。因此，该项目并没有蜂拥而至的开发人员，但它现在看起来足够健康。一家名为 Kastelo 的公司为 Syncthing 提供支持订阅，并为 Syncthing 开发提供重要资源。该公司还是 Syncthing 基金会的一部分，该基金会反过来管理项目的基础设施并为开发项目提供资助。总而言之，Syncthing 给人留下了良好的印象。开发人员似乎已经完成了创建一个功能强大、可靠、安全且性能相当好的系统的工作。但他们也做了一些工作，使设置和使用变得容易——很多自由软件项目似乎都在这个地方失败了。对于任何想要控制其数据同步和复制需求的人来说，它都是一个有吸引力的工具。 （登录发表评论）我只能同意。 Syncthing 只做一项工作，而且它做得很好。弄清楚为什么某些设备不想与其他设备通信是一个非常重要的过程。不过，这并不是合成所独有的。由 Cyber​​ax 于 2021 年 7 月 9 日 19:16 UTC（星期五）发布（✭ 支持者 ✭，#52523）[ 链接] 爱同步！我在 btrfs 磁盘上使用它来同步最新的快照，因此即使您设法删除所有数据，您也只需回滚到早期版本。我的同步目录是我想要共享的文件的副本。有些是手动复制的，有些是自动复制的。我有一个每晚的 cron 作业，它告诉我任何差异，而且它们一直是我在编辑后忘记手动复制的文件。它非常可靠。我唯一的问题来自设置新手机或电脑；他们的术语让我惊讶了好几次，但我终于聪明起来并做了一些笔记，并且在设置之后不再让我感到惊讶，只有在 :-) 每隔一段时间，我都会惊叹它如何如此顺利地工作，以至于我差点忘记它正在运行，并发送一个小贡献。我曾经想过一两次提交错误报告，因为它没有足够的错误来提醒我它的存在，他们需要找到吸引足够注意力的最佳点来获得更多贡献。我从 0.12 版开始使用 Syncthing。从那时起，它已经走了很长一段路，它已成为我的“一劳永逸”工具之一，我只是不必考虑。可悲的是，相对复杂的初始设置吓跑了我认识的很多人。不过，这也没有什么好办法。</p><p>Syncthing 很棒，感谢您提醒我向他们发送另一笔捐款。但是请注意，在 Android 设备上同步外部存储的内容是一件非常麻烦的事情，尽管这不是 Syncthing 本身的错。这个问题在下面的链接中有完整的描述，但它的要点（据我所知，如果我错了，请纠正我）是最新版本的 Android 为设备外部存储上的每个应用程序创建单独的隔离目录，并且不允许使用标准 POSIX 系统调用在该目录外访问。如果应用程序具有特定权限，则应用程序可以使用单独的 Java API 来访问完整的外部存储目录树，但这会给跨平台应用程序带来集成困难。该问题也可能仅限于 Android 10，因为之前的版本早于该政策，而 Android 11 据称具有某种机制，允许具有适当特权的应用程序恢复 POSIX 访问，但我无法验证这一点。如果您的设备像我的一样卡在 Android 10 上，那么您将需要使用根后门来解决所有令人头疼的问题。自 Android 4.4（当 Syncthing 不再能够访问“外部”SD 卡时）以来，一直有关于 Android 文件系统访问的投诉。范围存储只是现有困难之上的额外地狱层。好吧，有了 11，他们似乎终于达到了我们可以接受的界面。是的，这很丑陋，但“任何随机应用程序都可以悄悄地窃取您的所有个人数据和图像”。我今天发现我选择的版本控制模式没有保留较旧的修订版……不幸的是，我现在解决了这个问题。是的，关于用户体验。如果开发人员想要接触更多的受众，它可以使用更多的 UX 改进来为您提供您实际需要的选项。但是我已经使用 Syncthing 4 年了，在某个时候运行了一个中继并且一直对它感到满意。 &gt; 由于 Android 手机至少是基于 Linux 的，因此只需在其上设置一个普通的 shell &gt; 环境并将 Syncthing 放在那里即可实现这一目标；这个过程不应该超过一天左右。 &gt; 例如，如果一个系统是主要用于备份或分发目的的云服务器 &gt; 是否有一种简单的方法来设置这样的服务器？您通过 ssh 连接到服务器（隧道端口 8384），安装 syncthing，启动它，打开其 Web 界面，然后复制服务器密钥 - 在本地设备上添加一个新设备（云系统）。然后你创建一个共享文件夹并与云系统共享该文件夹（此步骤允许您设置密码）。</p><p>我想我的意思是：有没有人提供这样的服务，这样我就不必自己与云提供商打交道了？ ;) 我知道我可以设置一个附加到一些 S3 存储的 EC2 实例，但是......我真的不喜欢它:) 我想喜欢同步，但我已经使用它几年了已经非常不可靠了。我用它在我的手机（运行 LineageOS w/来自 f-droid 的同步）和桌面（运行 Debian 测试）之间同步照片/视频。当我拍照然后去我的笔记本电脑对照片做一些事情时，它可以无缝地工作大约 3/4 的时间。另外 1/4 的时间，我最终需要在我的笔记本电脑或手机上重新启动同步守护程序。这是非常令人恼火的。在 f-droid 和 debian 测试升级之间，我不坚持使用单一版本，因此这种不稳定可能有多种原因；我从来没有费心去追踪它。同步大视频时也很慢，所以我的计划只是在某个时候迁移到其他地方。是的，我对用于台式机/服务器的 Syncthing 非常满意，但我放弃了 Android 端口，现在使用 Nextcloud 来备份照片/视频，这似乎非常可靠（尽管我最近制作的视频令人不快2 GB ......）。有趣的是，我很高兴听到 Nextcloud 的 Android 支持很可靠。我一直计划尝试用它来替换我当前的设置，即用于手机图片/视频的 Syncthing 和用于与家人共享文件的 Seafile。我之所以推迟只是因为我担心 php 和可扩展性，但听起来 Owncloud 和 Nextcloud 已经分别用 Go 和 Rust 替换了一些缓慢的 php 代码。呵呵。奇怪的。我几个月来一直在大量使用 Syncthing，包括加密文件夹，并且没有发现任何问题。另一方面，每当我做一些重要的事情时，Nextcloud 就会吃掉我手机电池的内容作为早餐。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://lwn.net/Articles/861978/">https://lwn.net/Articles/861978/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/syncthing/">#syncthing</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>