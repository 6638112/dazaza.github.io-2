<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>调试Rust中的异步发生器错误</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">调试Rust中的异步发生器错误</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-24 07:25:28</div><div class="page_narrow text-break page_content"><p>我的同事Matt Jibson和我最近发现自己不幸地陷入了调试来自Rust编译器的这个严重的异步/等待相关错误的境地：</p><p>错误[E0277]：`(dyn Futures：：Stream&lt；Item=std：：result：：Result&lt；std：：vec：：Vec&lt；repr：：Row&gt；，comm：：Error&gt；&gt；+std：：Marker：：Send+std：：Marker：：Unpin+#39；Static)`无法在线程之间安全共享--&gt；src/Materialized/src/mux.rs：138：100|138|Async FN Handle_Connection(&amp；Self，conn：SniffedStream&lt；TcpStream&gt；)-&gt；Result&lt；()，无论如何：：Error&gt；{|_^139||self.handleconnection(Conn).wait140||}。|_^`(dyn Futures：：Stream&lt；Item=std：：result：：Result&lt；std：：vec：：Vec&lt；repr：：Row&gt；，comm：：Error&gt；&gt；+std：：Marker：：Send+Std：：Marker：：Unpin+&#39；Static)`无法在线程之间安全共享|=帮助：`(Dyn Futures：：Stream&lt；Item=std：：result：：Result&lt；std：：vec：：Vec&lt；repr：：Row&gt；)没有实现特性`std：：Marker：：Sync`。，comm：：Error&gt；&gt；+std：：Marker：：Send+std：：Marker：：Unpin+&#39；Static)`=备注：由于对`std：：Ptr：：Unique&lt；(Dyn Futures：：Stream&lt；Item=std：：result：：Result&lt；std：：vec：：Vec&lt；repr：：Row&gt；，comm：：Error&gt；&gt；+std：：Marker：：Send+std：：Marker：：Unpin+#39；Static)&gt；`=注意：必填，因为它出现在类型`std：：Boxed：：Box&lt；(dyn Futures：：Stream&lt；Item=std：：result：：Result&lt；std：：vec：：Vec&lt；repr：：Row&gt；，comm：：Error&gt；&gt；+std：：Marker：：Send+std：：Marker：：Unpin+&#39；Static)&gt；中。`=注意：必填，因为它出现在类型`std：：option：：Option&lt；std：：boxed：：Box&lt；(dyn Futures：：Stream&lt；Item=std：：result：：Result&lt；std：：vec：：Vec&lt；repr：：Row&gt；，Comm：：Error&gt；&gt；+std：：Marker：：Send+std：：Marker：：Unpin)&gt；中。`=备注：必需，因为它出现在`coord：：Session：：Portal`=Note：Required类型中，因为它出现在`&amp；coord：：Session：：Portal`=备注`&amp；coord：：Session：：Send`的实施要求中，因为它出现在`for&lt；&#39；t0、&#39；t1、&#39；t2、&#39；t3、&#39；t4、&#39；t5、&#39；t6、&#39；t5、&#39；t6、&#39；t4、&#39；t5、&#39；t6、&#39；t2、&#39；t3、&#39；t4、&#39；t5、&#39；t6、&#39；T7，&#39；t8&gt；{std：：Future：：ResumeTy，&amp；r MUT pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；，std：：String：：String，pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；，&amp；的mut coord：：SessionClient，coord：：SessionClient，&amp；t0 coord：：Session：：Session，&amp；&#39；t1 MUT coord：：Session：：Session，&amp；&amp；&#39；T2字符串，&amp；T3 std：：string：：string，std：：option：：option&lt；&amp；&#39；t4 coord：：session：：Portal&gt；，Tokio_postgres：：Error：：sqlState：：sqlState，Iml Futures：：Future，()，&amp；&39；T7 coord：：Session：：Portal，Iml Futures：：Future}`=备注：必需，因为它出现在类型`[Static generator@pgwire：：protocol：：StateMachine：：&lt；A&gt；：：describe_portal：：#0 0：&amp；mut pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；]中。Tokio：：Net：：TcpStream&gt；&gt；&gt；，1：std：：string：：String，&lt；&#39；r，&#39；s，&#39；t0，&#39；t1，&#39；t2，&#39；T3，&#39；T4，&#39；T5，&#39；T6，&#39；T7，&#39；T8&gt；{std：：Future：：ResumeTy，&amp；&#39；R MUT pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；，std：：String：：String，pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；，&amp；的MUT Coord：：SessionClient，Coord：：SessionClient，&amp；&39；T0 coord：：session：：session，&amp；&#39；t1mut coord：：session：：session，&amp；&#39；t2str，&amp；&#39；t3 std：：string，std：：option：：option&lt；&amp；&#39；t4 coord：：session：：portal&gt；，Tokio_postgres：：error：：sqlstate：：SqlState，Impl Futures：：Future，()，&amp；&#39；T7 coord：：Session：：Portal，Iml Futures：：Future}]`=注意：必填，因为它出现在`std：：future：：from_generator：：GenFuture&lt；[static generator@pgwire：：protocol：：StateMachine：：&lt；A&gt；：：describe_portal：：#0 0：&amp；mut pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；类型中。，1：std：：String：：&lt；&#39；r，&#39；s，&#39；t0，&#39；t1，&#39；t2，&#39；T3，&#39；t4，&#39；t5，&#39；t6，&#39；t7，&#39；t8&gt；{std：：Future：：ResumeTy，&amp；r mut pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；Ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；，std：：String：：String，pgwire：：protocol：：StateMachine&lt；pgwire：：server：：Conn&lt；ore：：netio：：SniffedStream&lt；tokio：：net：：TcpStream&gt；&gt；&gt；，&amp；的MUT Coord：：SessionClient，Coord：：SessionClient，&amp；t0 Coord：：Session：：Session，&amp；&39；T1静音代码：：Session：：Session，&amp；&amp；&#39；T2字符串，&amp；&#39；T3 STD：：String：：String，STD：：Option：：Option&l</p><p>您可以在GitHub上查看完整协议的详细信息，我将尽最大努力在这里展示一个简化版本。与Rust中的大多数现代网络代码一样，我们的实现完全是异步的，使用最近稳定的异步/等待语法。</p><p>Struct session{portals：HashMap&lt；string，Portal&&gt;，}struct Portal{SQL：string，Row_Rows：Option&lt；Vec&lt；Row&gt；，}Async FN Execute_Query(SQL：&amp；str)-&gt；Result&lt；vec&lt；Row&gt；，Error&gt；{/*...*/}异步FN HANDLE_EXECUTE(CONN：CONN，SESSION：SESSION，PORTAL_NAME：&amp；STR，MAX_ROWS：usize，)-&gt；result&lt；()，Error&gt；{let portal=match session.portals.get_mut(Portal_Name){ome(Portal)=&gt；portal，NONE=&gt；baal！(&#34；未知端口。</p><p>.</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://meltware.com/2020/10/21/rust-async-nonsense.html?">https://meltware.com/2020/10/21/rust-async-nonsense.html?</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/rust/">#rust</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/调试/">#调试</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/async/">#async</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/std/">#std</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1030799.html"><img src="http://img2.diglog.com/img/2020/10/thumb_d45451e0f71b872780c4d5648f5ab3ac.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030799.html">Rust-GPU：使Rust成为GPU代码的一流语言和生态系统</a></div><span class="my_story_list_date">2020-10-24 7:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030710.html"><img src="http://img2.diglog.com/img/2020/10/thumb_769af75dabe542f0b70bf10286381710.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030710.html">Rust核心团队将64位ARM上的Linux提升至第1层支持平台状态</a></div><span class="my_story_list_date">2020-10-23 12:6</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030589.html"><img src="http://img2.diglog.com/img/2020/10/thumb_d45451e0f71b872780c4d5648f5ab3ac.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030589.html">锈蚀-GPU</a></div><span class="my_story_list_date">2020-10-23 0:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030566.html"><img src="http://img2.diglog.com/img/2020/10/thumb_836f4650fac2144e0237c6b09f824b8d.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030566.html">忘了反垄断法吧。为了限制技术，一些人说需要一个新的监管机构</a></div><span class="my_story_list_date">2020-10-22 23:0</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>