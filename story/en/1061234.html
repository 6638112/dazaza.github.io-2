<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>env：更好的方法来阅读JavaScript中的环境变量 Env: a better way to read environment variables in JavaScript</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Env: a better way to read environment variables in JavaScript<br/>env：更好的方法来阅读JavaScript中的环境变量 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-07 11:27:37</div><div class="page_narrow text-break page_content"><p>If you write server-side JavaScript, chances are you’ve need to read information from environment variables. It’s considered a best practice to share sensitive information, such as access tokens, inside of environment variables to keep them secure. However, the way environment variables are read from JavaScript is error-prone in subtle ways that might take you hours to figure out. When an error occurs reading an environment variable, you want to know immediately, and you don’t want to interpret cryptic error messages. That’s where Env comes in.</p><p>如果您编写服务器端JavaScript，则需要从环境变量读取信息的机会。它被认为是共享敏感信息的最佳实践，例如访问令牌，环境变量内部的访问令牌，以防止它们安全。但是，环境变量从JavaScript读取的方式是错误的，以可能需要几小时才能弄清楚。当读取环境变量时出错时，您想立即知道，您不想解释密码错误消息。那就是env进来的地方。</p><p>  Env  1 is a zero-dependency utility designed to make reading environment variables safer and less error-prone. It does this by addressing the root causes of environment variable-related errors in server-side JavaScript. It works in both Node.js and Deno, and automatically reads environment variables from the correct location based on the runtime being used.</p><p>  ENV 1是零依赖性实用程序，旨在使读取环境变量更安全，更少易于出错。它通过解决服务器端JavaScript中环境变量相关错误的根原因来实现这一点。它在Node.js和Deno中工作，并根据正在使用的运行时自动从正确的位置读取环境变量。</p><p>           The first problem Env addresses is how to deal with missing environment variables. It’s quite common for environment variables to go missing either because they were accidentally not set up correctly or because they only exist on some containers and not all. In any case, you want to handle missing environment variables seamlessly. In Node.js, you might do something like this:</p><p>           第一个问题ENV地址是如何处理缺少的环境变量。环境变量缺少的环境变量非常常见，因为它们被意外未正确设置，或者因为它们只存在于某些容器上而不是全部。在任何情况下，您都希望无缝地处理缺失的环境变量。在Node.js中，您可能会做这样的事情：</p><p>  The intent here is to use the  USERNAME environment variable if present, and if not, default to  &#34;guest&#34;. Env streamlines this to make setting defaults clear:</p><p>  这里的意图是使用用户名环境变量（如果没有，如果没有，则默认为＆＃34; guest＆＃34; ENV StumbLines此项以使设置默认值清除：</p><p>  This code has the same effect but avoids any type coercion in the process. Of course, this assumes it’s okay for  USERNAME to be missing. But what if you absolutely need an environment variable present in order for your application to work? For that, you might write some code like this:</p><p>  此代码具有相同的效果，但避免了该过程中的任何类型的胁迫。当然，这假设缺少用户名是可以的。但是，如果您绝对需要存在的环境变量，以便为您的申请工作？为此，您可能会编写这样的代码：</p><p>  That’s a lot of code for some simple validation, and if you have several required environment variables, you’ll end up repeating this pattern for each one. With Env, you can use the  require() method:</p><p>  这是一些简单验证的大量代码，如果您有几个必需的环境变量，则最终将重复每一个模式。使用ENV，您可以使用RESCELD（）方法：</p><p>  If the environment variable  USERNAME is missing in this example, then an error is thrown telling you so. You can also use the  required property in a similar way:</p><p>  如果在此示例中缺少环境变量用户名，则抛出错误告诉您。您还可以以类似的方式使用所需属性： </p><p>  This syntax allows you to avoid typing a string but will still throw an error if  USERNAME is not present.</p><p>此语法允许您避免键入字符串，但如果不存在用户名，则仍将抛出错误。</p><p>  Another type of error that is common with environment variables are typos. Typos can be hard to spot when you are typing the same thing multiple times. For example, you might type something like this:</p><p>  与环境变量很常见的另一种错误是拼写错误。当您多次键入相同的事情时，拼写错误可能很难点击。例如，您可能会键入这样的内容：</p><p>  Personally, I’ve spent hours tracking down bugs related to my incorrectly typing the name of the environment variable in my code. For whatever reason, I type the name of the variable correctly but not the environment variable name. If you want your JavaScript variables to have the same name as some required environment variables, you can use destructuring of the  required property to only type the name once:</p><p>  就个人而言，我花了几小时的时间跟踪与我错误地键入我的代码中的环境变量名称相关的错误。无论何种原因，我正确键入了变量的名称，但不是环境变量名称。如果您希望将JavaScript变量与某些所需环境变量具有相同的名称，则可以使用所需属性的破坏性以仅键入一次名称：</p><p>  Here, two local variables,  PORT and  HOST, are created from the environment variables of the same name. If either environment variable is missing, an error is thrown.</p><p>  这里，从相同名称的环境变量创建两个本地变量，端口和主机。如果缺少任何环境变量，则抛出错误。</p><p>  Another subtle type of error with environment variables are type mismatches. For instance, consider the following Node.js code:</p><p>  具有环境变量的另一个微妙类型的错误是类型不匹配。例如，请考虑以下Node.js代码：</p><p>  This line, or something similar, appears in a lot of Node.js applications. Most of the time it doesn’t cause an issue…but it could. Can you spot the problem?</p><p>  此行或类似的东西出现在很多Node.js应用程序中。大部分时间都不会导致问题......但它可以。你能发现这个问题吗？</p><p> All environment variables are strings, so the JavaScript variable  PORT is a string when the environment variable is present and a number if not. Using similar code in Deno threw an error  2 that took me a while to figure out. It turned out that the Deno HTTP server required the port to be a number, so it worked fine locally but when I deployed it to Cloud Run, I received an error.</p><p> 所有环境变量都是字符串，因此JavaScript变量端口是当存在环境变量时的字符串，如果没有，则是一个数字。在丹麦中使用类似的代码扔了一个错误的错误2，让我一段时间弄清楚。事实证明，丹诺HTTP服务器需要端口是一个数字，所以它在本地工作得很好，但当我将其部署到云运行时，我收到了错误。 </p><p>   Even if you pass in a non-string value as the default, Env will convert it to a string to ensure that you only ever receive a string value when reading environment variables.</p><p>即使您将非字符串值传递为默认值，ENV也会将其转换为字符串，以确保在读取环境变量时才会收到字符串值。</p><p>  Sometimes you might want to check several environment variables and only use a default if none of the environment variables are present. So you might have code that looks like this:</p><p>  有时您可能希望检查多个环境变量，只有在存在环境变量中时，才能使用默认值。所以你可能有代码如下所示：</p><p>    Using this code, Env returns a value from the first environment variable it finds. Similar to  get(),  first() allows you to pass in a default value to use if none of the environment variables are found, and that default value is automatically converted to a string. As an added error check, if the first argument isn’t an array or is an array with only one item, then an error is thrown.</p><p>    使用此代码，Env将从它发现的第一个环境变量返回值。类似于get（），first（）允许您在默认值中传递以使用，如果找不到环境变量，并且该默认值会自动转换为字符串。作为添加的错误检查，如果第一个参数不是数组，或者只有一个项目的数组，那么抛出错误。</p><p>  Env is one of those utilities that has been so valuable to me that I sometimes forget to mention it. I’ve been using it in a number of personal projects for the past two years and it’s saved me a lot of time. Debugging errors related to environment variables isn’t anyone’s idea of fun, and I can’t count the times where I’ve been saved by an Env error. I hope you find it helpful, as well.</p><p>  Env是那些对我来说非常有价值的公用事业之一，我有时会忘记提及它。在过去的两年里，我一直在一些个人项目中使用它，它已经救了我很多时间。调试与环境变量相关的错误并不是任何人的乐趣的想法，我无法计算我被ENV错误保存的时间。我希望你能找到它的帮助。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://humanwhocodes.com/blog/2021/02/introducing-env-javascript-environment-variables/">https://humanwhocodes.com/blog/2021/02/introducing-env-javascript-environment-variables/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/阅读/">#阅读</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/read/">#read</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/环境变量/">#环境变量</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>