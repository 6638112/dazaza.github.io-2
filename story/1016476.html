<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Debian打包的工作原理</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Debian打包的工作原理</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-06 02:42:33</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/6da044938616d0ab978b29690d7828c2.jpg"><img src="http://img.diglog.com/img/2020/8/6da044938616d0ab978b29690d7828c2.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Debian打包可能相当神秘和难以理解。在本指南中，我将简单介绍Debian打包过程及其最重要的概念。</p><p>这并不是包装各个方面的完整指南。取而代之的是，我将只介绍足够的基础知识来帮助您开发Debian打包的心理模型，并能够产生有用的结果。</p><p>Debian包包含元数据和文件。元数据包含包名称、描述、依赖项列表等。文件被解压缩到文件系统根目录(/)中，因此软件包中的文件路径是绝对路径。</p><p>因此，Debian包文件-.deb文件-有点像tar.gz或zip。它实际上不是tar.gz或zip：格式是ar，尽管这并不重要。</p><p>因此，Debian打包最简单的形式就是创建一个.deb文件，其中包含您想要放入的元数据和文件。</p><p>Debian打包系统实际上由两部分组成。最下面的部分是dpkg，它管理系统的数据库，描述安装了哪些软件包。Dpkg可以安装.deb文件并删除已经安装的软件包。</p><p>APT处理从Internet下载.deb文件，以及依赖项解析。Dpkg不会处理这件事。这就是为什么用户通常只与APT交互的原因，尽管dpkg是执行工作核心的部分。</p><p>Dpkg-apt关系类似于RHEL/CentOS上的RPM-DNF关系(或旧版本上的RPM-YUM)。</p><p>您实际上不需要运行Debian/Ubuntu来创建和检查Debian包！Debian包管理器dpkg也可以在其他操作系统上使用。只是不要指望能够安装任何有用的软件包。</p><p>继续安装dpkg，因为本文的其余部分假定您拥有它。</p><p>您可以检查Debian软件包最重要的元数据-控件部分-如下所示：</p><p>新的Debian包，2.0版。大小为4237584字节：控制档案=3124字节。841字节，20行控制8644字节，79行md5sum包：Passenger-dev来源：Passenger Version：1：6.0.6-1~Xenial1架构：AMD64 Maintainer：Phusion&lt；info@phusion.nl&gt；安装大小：41972取决于：ruby2.7|ruby2.6|ruby2.5|ruby2.4|ruby2.3|ruby2.2|ruby2.1|ruby2.0|ruby1.9.1|ruby1.8|ruby1.8|ruby解释器，Passenger(=1：6.0.6-1~exial1)冲突：ruby-Passenger-dev替换：ruby-Passenger-dev提供：ruby-Passenger-dev部分：ruby优先级：可选主页：https://www.phusionpassenger.com/描述：编译nginx模块的依赖项。Phusion是一款Phusion产品，它使Web应用的部署变得非常简单和强大。。这个方便的包提供了编译Nginx模块的开发依赖项。</p><p>大多数字段都非常不言自明。有关所有字段的概述，以及对其含义的更深入解释，请参阅Debian策略手册。</p><p>除了控制部分，还有更多的元数据。您可以通过将所有元数据提取到文件来查看其他元数据：</p><p>上面的代码将元数据解压到当前工作目录的名为Debian的子目录中。对于Passenger-dev包，唯一存在的其他元数据是一个md5sum文件：</p><p>Drwxr-xr-x root/root 0 2020-07-14 04：40./drwxr-xr-x root/root 0 2020-07-14 04：40./usr/drwxr-xr-x root/root 0 2020-07-14 04：40./usr/lib/drwxr-xr-x root/root 0 2020-07-14 04：40./usr/lib/Passenger/drwxr-xr-x root/。根/根02020-07-14 04：39./usr/lib/passenger/common/libpassenger_common/drwxr-xr-x根/根02020-07-14 04：39./usr/lib/passenger/common/libpassenger_common/JsonTools/-rw-r--r--根/根785616 2020-07-14 04：39./usr/lib/passenger/common/libpassenger_common/JsonTools/CBindings.o...</p><p>对于那些喜欢用更直观的方式检查包裹内容的人，可以去午夜指挥官那里。它是一个基于终端的可视化文件管理器，可以窥视许多类型的档案，包括Debian软件包。</p><p>午夜指挥官的Debian软件包支持需要安装dpkg，所以一定要安装它。</p><p>…。然后打开一个.deb文件。您应该会看到一个文件列表。以下是它们的意思：</p><p>通过选择INFO文件并按F3键来查看该文件，您应该会看到控件元数据的全貌：</p><p>创建Debian包的最简单方法是使用FPM。FPM是一种CLI工具。您告诉FPM您希望将哪些元数据和文件放入包中，它就会这样做。</p><p>请注意，如果您希望提交包以包含在Linux发行版中，那么使用FPM不是创建Debian包的正确方式。如果那不是你的目标，那么FPM也可以。我们稍后会回到正确的方式。</p><p>FPM是用Ruby编写的，因此您可以使用RubyGems包管理器安装它：</p><p>要查看它的实际效果，让我们使用FPM创建一个简单的包，其中包含一个名为/usr/share/doc/mypackage/readme.txt的文件，该文件依赖于&#39；curl&39；：</p><p>Echo&#39；hello FPM&#39；&gt；readme.txtfpm\--输入类型目录\-输出类型deb\-名称mypackage\--版本1.0.0\--架构全部\--Package mypackage_1.0.0_all.deb\-依赖curl\readme.txt=/usr/share/doc/mypackage/。</p><p>祝贺你!。您已经创建了您的第一个Debian包。但是拥有一个.deb文件只会给您带来一些好处：您还需要一个APT存储库，因为用户很少与单独的.deb文件交互。我们稍后再谈那件事。</p><p>如果您想提交包以包含在Linux发行版中，为什么FPM不是打包的正确方式呢？这是因为发行版希望您完整地描述整个软件包构建过程，而且使用FPM不符合它们的过程标准。</p><p>创建程序包文件。在这里，您可以将源树中的文件和编译构件映射到包中的文件。</p><p>发行版希望您创建一个所谓的源代码包，其中包含描述步骤1和步骤2的文件。然后，您将源代码包(而不是二进制包)提交给发行版，它们会为您构建二进制包。</p><p>如何创建源包，以及正式的Debian打包过程是如何工作的，这超出了本文的范围。在任何情况下，该过程和周围的工具都相当神秘，文档记录很差，坦率地说，这是可用性的噩梦。如果他们不是，你一开始就不会阅读这篇文章。我不推荐使用官方流程或官方工具，除非您的明确目标是对发行版做出贡献。尽可能长时间地坚持走容易的路。</p><p>存储库是包含一个或多个软件包(.deb文件)的目录，以及包含以下内容的元数据文件：</p><p>单个存储库可以包含多个发行版的包。但请注意，分销的概念应该持保留态度。例如，官方的Ubuntu存储库定义了&#34；bionic&34；，&#34；bionic-update&#34；和&#34；bionic-backports&#34；。对于APT而言，&#34；分发&#34；只是一个名称，以便APT确定要选择哪个子目录。</p><p>存储库还可以组织成多个组件。用户可以选择加入特定组件。例如，官方的Ubuntu存储库有组件&#34；main&#34；、&#34；multiverse&#34；、宇宙&#34；等等。</p><p>最后，存储库也是按体系结构组织的。APT仅下载适用于当前系统架构的软件包。</p><p>让我们来看一个真实的存储库示例。如果我们在Ubuntu系统上查看/etc/apt/Soures.list，则会看到如下行：</p><p>如果我们访问archive ve.ubuntu.com/ubuntu，那么我们会看到很多文件。以下是一些有趣的部分：</p><p>有许多工具可用于创建APT存储库。但他们中的大多数都不是…。啊哼…。理智：糟糕的文档，糟糕的可用性。</p><p>第三方软件包(不属于发行版的软件包)的一个常用托管解决方案是Ubuntu PPAs(个人软件包档案)。然而，我不推荐这样做，因为Ubuntu PPA希望您只上传源包-它们将为您处理构建二进制文件。这意味着您必须使用官方的Debian打包工具，这使得一切都变得非常困难。此外，Ubuntu PPA用户界面非常混乱，其软件包上传过程非常原始、繁琐且不可饶恕。它实际上包括将原始文件上传到FTP服务器，并等待包含构建结果的电子邮件。</p><p>我所见过的最友好的开源、自托管解决方案是恰如其分的。只需确保使用1.4版或更高版本即可。早期版本有相当严重的错误。</p><p>另一个选择是宾特利。Binty是一种商业托管解决方案。它们为开放源码项目提供免费的计划。与Ubuntu PPA不同的是，它们没有。</p><p>APTLY不直接操作您在archive ve.ubuntu.com/ubuntu中看到的那种apt repo文件。相反，它主要在内部数据库上运行。然后，您可以恰当地告诉以APT期望的格式将其内部数据库发布(导出)到APT存储库。</p><p>默认情况下，合适的内部数据库存储在~/.aply中。当您告诉Apply发布它的内部数据库时，它默认发布到~/.aply/public。这两个路径都可以通过适当的配置文件进行自定义，但出于本演示的目的，让我们坚持使用默认路径。</p><p>所以，让我们看看它的实际行动吧。首先，恰当地告诉您创建一个名为&#34；myrepo&#34；的存储库：</p><p>我们现在有一个内部存储库，其中包含一个包。要将其发布到真正的APT存储库，我们必须创建链接到特定存储库的出版物。</p><p>我们构建的包与分布和架构无关。因此，假设它属于不可知性分发、主组件和AMD64(Debian对x86_64的名称)体系结构。</p><p>APT存储库通常是GPG签名的，但是在这个演示中，我们将跳过签名以避免麻烦。</p><p>让我们尝试在Debian或Ubuntu服务器上使用这个APT存储库。我们压缩此repo并将其复制到Debian/Ubuntu服务器：</p><p>然后，我们登录到Debian/Ubuntu服务器，将tarball解压到某个位置，并将其添加为apt源文件：</p><p>#在Debian/Ubuntu服务器上：mkdir myaptrepo tar-C myaptrepo-xzf myaptrepo.tar.gz echo&#34；deb[ALLOW-INSECURE=YES]文件：$(Pwd)/myaptrepo agnostic main&#34；\|sudo tee/etc/apt/Soures.list.d/myaptrepo.list。</p><p>大多数Debian打包文档都是关于Linux发行版的官方打包过程的。由于某些原因，独立软件供应商的用例，或只想将内部应用打包为内部基础设施的人的用例，被广泛忽视。他们不应该是这样的。我希望通过这本指南，您已经能够理解Debian打包，并且我已经帮助您创建了自己的软件包。祝好运!</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.joyfulbikeshedding.com/blog/2020-08-03-how-debian-packaging-works.html">https://www.joyfulbikeshedding.com/blog/2020-08-03-how-debian-packaging-works.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/打包/">#打包</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/packaging/">#packaging</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/文件/">#文件</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>