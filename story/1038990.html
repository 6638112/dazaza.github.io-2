<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用现代工具调试WebAssembly </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用现代工具调试WebAssembly </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-11 07:53:19</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/665bfd348d7a78912cc2d3e0c6d5fd94.png"><img src="http://img2.diglog.com/img/2020/12/665bfd348d7a78912cc2d3e0c6d5fd94.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>我们展示了基本的步进支持，并讨论了DWARF信息的机会使用，而不是将来为我们打开源地图：</p><p>  今天，我们很高兴展示承诺的功能实现，以及Emscripten和Chrome DevTools团队在这一年中取得的进步，尤其是在C和C ++应用程序方面。</p><p> 在开始之前，请记住，这仍然是新体验的测试版，您需要自担风险使用所有工具的最新版本，如果遇到任何问题，请将其报告给https：// bugs .chromium.org / p / chromium / issues / entry？template = DevTools + issue。</p><p>  #include＆lt; stdlib.h＆gt;无效assert_less（int x，int y）{if（x＆gt; = y）{abort（）; }} int main（）{assert_less（10，20）; assert_less（30，20）;}</p><p> 要对其进行编译，我们就像在原始文章中一样，使用LatestEmscripten并传递-g标志以包含debuginformation：</p><p>  现在，我们可以从本地HTTP服务器（例如，使用serve）提供生成的页面，并在最新的ChromeCanary中打开它。</p><p> 这次，我们还需要一个与ChromeDevTools集成的帮助程序扩展程序，以帮助您理解WebAssembly文件中编码的所有调试信息。请通过以下链接进行安装：goo.gle/wasm-debugging-extension </p><p>您还需要在DevTools实验中启用WebAssembly调试。打开Chrome DevTools，单击DevTools窗格右上角的齿轮（⚙）图标，转到“实验”面板，然后勾选WebAssembly Debugging：启用DWARF支持。</p><p>  关闭设置后，DevTools会建议您重新加载自身以应用设置，所以就这样吧。一站式服务就是这样。</p><p> 现在，我们可以返回“源”面板，启用“暂停onexceptions”（⏸图标），然后选中“在捕获的异常上暂停”并重新加载页面。您应该看到DevTools因异常而暂停：</p><p>  默认情况下，它在Emscripten生成的粘合代码上停止，但是在右侧，您可以看到代表错误的堆栈跟踪的“调用堆栈”视图，并且可以导航到调用中止的原始C行：</p><p>  现在，如果您在“作用域”视图中查看，您可以在C / C ++代码中看到变量的原始名称和值，而不必再弄清楚像$ localN这样的错误名称的含义以及它们与您编写的源代码的关系。</p><p> 这不仅适用于整数之类的原始值，而且适用于诸如结构，类，数组等的复合类型！</p><p>  让我们看一个更复杂的例子来展示它们。这次，我们将使用以下C ++代码绘制Mandelbrotfractal： </p><p>#include＆lt; SDL2 / SDL.h＆gt; #include＆lt; complex＆gt; int main（）{//初始化SDL。 int宽度= 600，高度= 600； SDL_Init（SDL_INIT_VIDEO）; SDL_Window *窗口； SDL_Renderer *渲染器； SDL_CreateWindowAndRenderer（宽度，高度，SDL_WINDOW_OPENGL，＆amp;窗口，＆amp; renderer）; //生成具有随机颜色的调色板。枚举{MAX_ITER_COUNT = 256}; SDL_调色板[MAX_ITER_COUNT]； srand（time（0））;对于（int i = 0; i＆lt; MAX_ITER_COUNT; ++ i）{调色板[i] = {.r =（uint8_t）rand（），.g =（uint8_t）rand（），.b =（uint8_t）rand （），.a = 255，}; } //计算并绘制Mandelbrot集。 std :: complex＆lt; double＆gt;中心（0.5，0.5）;双倍= 4.0; for（int y = 0; y  2.0）中断; } SDL_Color color =调色板[i]; SDL_SetRenderDrawColor（renderer，color.r，color.g，color.b，color.a）; SDL_RenderDrawPoint（renderer，x，y）; }} //渲染我们绘制到画布上的所有内容。 SDL_RenderPresent（renderer）; // SDL_Quit（）;}</p><p> 您可以看到该应用程序仍然很小-它是一个包含50行代码的单个文件-但这次我还使用了一些外部API，例如SDLlibrary forgraphics以及C ++标准库中的复数。</p><p> 我将使用与上面相同的-g标志进行编译，以包含调试信息，并且我还将要求Emscripten提供SDL2库并允许任意大小的内存：</p><p>  当我在浏览器中访问生成的页面时，可以看到带有一些随机颜色的美丽分形：</p><p>  当我打开DevTools时，再次可以看到原始的C ++文件。但是，这一次，我们的代码没有错误（哇！），因此让我们在代码的开头设置一些断点。</p><p>   我们已经可以在右侧看到所有变量，但是目前仅初始化了width和height，因此检查的内容并不多。</p><p> 让我们在主Mandelbrot循环中设置另一个断点，然后恢复执行以向前跳过一点。 </p><p>此时，我们的调色板已经填充了一些随机的颜色，我们可以扩展数组本身以及单个SDL_Color结构，并检查其组件以验证一切看起来不错（例如，始终将“ alpha”通道设置为完全不透明）。类似地，我们可以展开并检查存储在中心变量中的复数的实部和虚部。</p><p> 如果要访问深层嵌套的属性（否则很难通过Scope视图访问），则也可以使用Consoleevaluation！但是，请注意，尚不支持更复杂的C ++表达式。</p><p>  让我们继续执行几次，我们可以看到内部x的变化方式-再次在Scope视图中查看，将变量名添加到监视列表，在控制台中对其进行评估，或者将鼠标悬停在源代码中：</p><p>  从这里，我们可以进入或进入C ++语句，并观察其他变量的变化情况：</p><p>  好的，所以当调试信息可用时，这一切都很好用，但是如果我们要调试不是使用debugoptions构建的代码，那该怎么办呢？</p><p>  例如，我们要求Emscripten提供一个预先构建的SDL库论坛，而不是从源代码本身进行编译，因此-至少当前-调试器无法找到关联的源代码。让我们再次进入SDL_RenderDrawColor：</p><p>   现在，它看起来有点吓人，并不是大多数Web开发人员都需要处理的东西，但是有时候您可能想调试没有调试信息的库，这是因为它是您无法控制的第三方库？您会遇到仅在生产环境中发生的错误之一。 </p><p>为了在这种情况下提供帮助，我们还对基本调试体验进行了一些改进。</p><p> 首先，如果您以前使用过原始WebAssembly调试，则可能会注意到整个反汇编现在都显示在单个文件中-不再猜测Sources条目wasm-53834e3e / wasm-53834e3e-7可能对应的功能。</p><p>  我们也在反汇编视图中改进了名称。以前，您只能看到数字索引，如果使用函数，则根本没有名称。</p><p> 现在，我们通过使用来自WebAssembly名称部分的提示，导入/导出路径，以及与其他反汇编工具类似的方法来生成名称，最后，如果其他所有操作失败，则根据项的类型和索引（例如$ func123）生成它们。您可以在上面的屏幕截图中看到如何这已经有助于获得稍微可读的堆栈跟踪和反汇编。</p><p> 如果没有可用的类型信息，则可能难以检查除基元以外的任何值-例如，指针将显示为规则整数，而无法知道它们背后存储的内容。</p><p>  以前，您只能扩展WebAssembly内存对象（由Scope视图中的env.memory表示）来查找单个字节。这在某些琐碎的情况下可行，但是扩展起来特别不方便，并且不允许以字节值以外的格式重新解释数据。我们还添加了一个新功能来帮助解决此问题：线性内存检查器。</p><p> 如果右键单击env.memory，现在应该看到一个名为“检查内存”的新选项： </p><p>单击后，它将弹出一个内存检查器，您可以在其中以十六进制和ASCII视图检查WebAssembly内存，导航到特定地址，以及解释数据的不同格式：</p><p>    当您打开DevTools时，WebAssembly代码将“分层”为未优化的版本以启用调试。这个版本慢很多，这意味着在打开DevTools时，您不能依赖console.time，performance.now和其他测量代码速度的方法，因为您获得的数字根本无法代表真实的性能。 。</p><p> 相反，您应该使用DevTools Performancepanel，它将以最快的速度运行代码，并为您详细分解各种功能所花费的时间：</p><p>  或者，您可以在关闭DevTools的情况下运行应用程序，并在完成后将其打开以检查控制台。</p><p> 将来，我们将改进分析方案，但是现在要注意。如果您想了解有关WebAssemblytiering方案的更多信息，请查看有关WebAssembly编译管道的文档。</p><p>  在Docker，虚拟机或远程构建服务器中进行构建时，您可能会遇到以下情况：构建期间使用的源文件的路径与运行Chrome DevTools的文件系统中的路径不匹配。在这种情况下，文件将显示在“源”面板中，但无法加载。</p><p> 为了解决此问题，我们在C / C ++扩展选项中实现了路径映射功能。您可以使用它来重新映射任意路径，并帮助DevTools查找源。 </p><p>例如，如果主机上的项目位于路径C：\ src \ my_project下，但在Docker容器中构建，该路径表示为/ mnt / c / src / my_project，则可以在调试期间通过指定重新映射这些路径作为前缀：</p><p>  第一个匹配的前缀“ wins”。如果您熟悉其他C ++调试器，则此选项类似于GDB中的set replace-path命令或LLDB中的target.source-map设置。</p><p>  与其他任何语言一样，如果禁用了优化，则调试效果最佳。优化可能会将函数彼此内联，重新排序代码或完全删除部分代码-所有这些都有可能使调试器（因此，您是用户）感到困惑。</p><p> 如果您不介意有限的调试经验，但仍想调试优化的构建，则除了函数内联之外，大多数优化都可以按预期进行。我们计划在将来解决剩余的问题，但是目前，在通过任何-O级别优化进行编译时，请使用-fno-inline禁用它，例如：</p><p>   调试信息保留了有关代码，定义的类型，变量，函数，作用域和位置的许多详细信息-可能对调试器有用的任何信息。结果，它通常可以大于代码本身。</p><p> 为了加快WebAssembly模块的加载和编译速度，您可能希望将此调试信息拆分为单独的WebAssembly文件。要在Emscripten中做到这一点，请传递-gseparate-dwarf =…标志并带有所需的文件名：</p><p>  在这种情况下，主应用程序将仅存储文件名temp.debug.wasm，并且在打开DevTools时，helper扩展将能够找到并加载它。 </p><p>当与如上所述的优化方法结合使用时，该功能甚至可以用于交付您应用程序的几乎优化的生产版本，然后使用本地边文件调试它们。在这种情况下，我们还需要覆盖存储的URL，以帮助扩展程序找到辅助文件，例如：</p><p> emcc -g temp.c -o temp.html \ -O3 -fno-inline \ -gseparate-dwarf = temp.debug.wasm \ -s SEPARATE_DWARF_URL = file：// [到temp.debug.wasm的本地路径]</p><p>   有了所有这些新的集成，Chrome DevTools不仅成为JavaScript的强大功能，而且还成为C和C ++应用程序的强大调试器，比以往任何时候都更容易采用内置于各种技术中的应用程序，并将它们带到一个共享的，跨平台的平台的Web。</p><p> 但是，我们的旅程尚未结束。从现在开始，我们将要进行的一些工作：</p><p>  同时，请通过在您自己的代码上尝试当前的Beta并将任何发现的问题报告给https://bugs.chromium.org/p/chromium/issues/entry?template=DevTools+issue来帮助我们。</p><p>   感谢您的反馈。如果您对如何改进此页面有特定的想法，请创建一个问题。</p><p>  感谢您的反馈。如果您对如何改进此页面有特定的想法，请创建一个问题。 </p><p>感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。 </p><p>感谢您的反馈。 如果您对如何改进此页面有特定的想法，请创建一个问题。  要讨论本文中的新功能和更改，或与DevTools相关的其他任何内容：  以下列出了Chrome DevTools工程博客系列中介绍的所有内容。  rss_feed订阅我们的RSS或Atom提要，并在您喜欢的提要阅读器中获取最新更新！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://developers.google.com/web/updates/2020/12/webassembly">https://developers.google.com/web/updates/2020/12/webassembly</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/现代/">#现代</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/devtools/">#devtools</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1038792.html"><img src="http://img2.diglog.com/img/2020/12/thumb_5317ad5725f7831a797d98f92e510490.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038792.html">报告：现代汽车集团已同意以约9.21亿美元的价格从软银购买Spot四足机器人制造商Boston Dynamics </a></div><span class="my_story_list_date">2020-12-10 8:24</span></div><div class="col-sm"><div><a target="_blank" href="/story/1036898.html"><img src="http://img2.diglog.com/img/2020/11/thumb_4efbb7bc4a2e9edc93fc402707d1c1ad.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1036898.html">CrateDB：专门用于在机器数据世界中扩展现代应用程序</a></div><span class="my_story_list_date">2020-11-28 2:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1036736.html"><img src="http://img2.diglog.com/img/2020/11/thumb_3ad989eb74490fcda4f1bd31b5f9221c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1036736.html">现代存储非常快。不好的是API</a></div><span class="my_story_list_date">2020-11-27 0:45</span></div><div class="col-sm"><div><a target="_blank" href="/story/1036598.html"><img src="http://img2.diglog.com/img/2020/11/thumb_a6aa2595c40fefd9158a5b89517afe1b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1036598.html">Quiver：现代的交换图编辑器</a></div><span class="my_story_list_date">2020-11-26 3:56</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>