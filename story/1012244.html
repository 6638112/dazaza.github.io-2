<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>禁用的Haskell类型</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">禁用的Haskell类型</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-16 18:08:59</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/7cf484ceeae6bc7fc2161eddc603cd15.jpg"><img src="http://img.diglog.com/img/2020/7/7cf484ceeae6bc7fc2161eddc603cd15.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>有时，编写Haskell就像与编译器发生争执。你给它推理，它就会检查它是否有瑕疵。如果它认为它找到了一个，它会告诉你所有关于它的事情。然后，你必须仔细检查它告诉你的内容，并找出它的确切抱怨是什么。我刚才表达得不好吗？还是我真的错了？或者，在非常偶然的情况下，编译器只是脾气暴躁，您必须解决这个问题。当然，如果你真的对GHC没有接受你的合理论证的计划感到不安，你可以去告诉它的父母。</p><p>Haskell的类型系统非常棒，但它没有的一件事是递归类型，这是其他一些类型系统所没有的，我指的是直接从它们自身构造的类型。递归类型在Haskell中是被禁止的。</p><p>比方说，我们想要创建一个递归类型T=可能T。官方介绍性的Haskell对此的回答是，不能直接这样做，但是可以很容易地创建一个包含可能T的类型T，有时称为“Newtype wrapper”。就像这样：</p><p>很简单。但我们能做得比这更好吗？我们能创建一个实际上等于T的类型吗？我们可以创建禁止的递归类型吗？</p><p>type关键字为类型创建别名，别名不能是递归的，因为它们最终必须引用实际类型。</p><p>类型族是奇怪的东西。它们不完全是“真正的”类型，但也不只是类型的别名，因为它们不需要完全解析。实际上，您可以在一个模块中声明类型族，将其作为真实类型使用，然后在另一个模块中定义该族的实际实例。</p><p>不过，遗憾的是，GHC不允许我们实际使用该实例。它拒绝了T和T可能是同一类型的明显证据：</p><p>类型族T，其中T=可能T证明：：T：~：可能T证明=反射</p><p>Example.hs：10：9：错误：·Reduce堆栈溢出；简化以下类型时大小=201：t。</p><p>这是为什么？这是因为GHC不能只接受别人告诉它的东西，而是没完没了地试图“减少”(即扩大)T=也许T=也许T(可能T)等等，当它达到安全极限时就放弃。您可以将其视为一种智力黑洞，或者编译器的“信息危机”：如果它开始检查您的递归类型的奇怪秘密，它将迷失在无限深渊中，直到内置的应急机制在漩涡中扭曲200次后将其唤醒(如果您愿意，您可以更改这个数字，甚至让它永远运行)。</p><p>结果是，我们可以构造一个类型T和一个适当的(非底层)证明值T：~：可能是T，我们只需要谨慎。关键是确保GHC永远不会遇到深不可测的约束T~也许T，因为它会立即陷入对其无穷无尽的思考中。</p><p>相反，我们准备了一个既无害又更通用的引理，然后使用TypeApplications扩展仔细地将其专门化以得到我们想要的可怕结论，从而避免了任何类型的推理：</p><p>型族A p q其中A()x=可能(Ax())引理：：for all x.。(A()x)：~：可能(A x())引理=Refltype T=A()()证明：：T：~：可能T证明=引理@()。</p><p>实际上，构建和解构T的值也需要类似的谨慎。诀窍是，我们不让GHC推断类型。我们不能让GHC去思考，因为一想到坏事就会让它发疯。相反，我们手工应用所有类型。以下是完整的程序，包括所有必要的扩展：</p><p>{-#language RankNTypes，TypeApplications，TypeOperators，TypeFamilies，UnecidableInstances，AllowAmbiguousTypes#-}模块main where import Data.Type.Equalitytype family A p q其中A()x=可能(A x())引理：：for all x。(A()x)：~：可能(A x())引理=Refltype T=A()()证明：：T：~：可能T证明=引理@()Convert1：：for all a B.a：~：b-&gt；a-&gt；bConvert1 refl=idConvert2：：for all a B.a：~：B-&gt；b-&gt；aconvert2 refl=idtConvert1：：t-。TtConvert2=Convert2@T@(可能T)Proof Nothing：：TNothing=tConvert2$Nothing@Tust：：t-&gt；tJust x=tConvert2$Just@T xcount：：t-&gt；Intcount t=case tConvert1 t of Nothing-&gt；0 Just t&#39；-&gt；Succ$count t&#39；T3：TT3=Just$Just Nothingmain：：IO。</p><p>这个程序定义了一个真正的递归类型T=可能T，构造它的一个值，然后解构该值。(它确实可以正确打印“3”。)。另一方面，这比仅仅使用我们应该使用的…的新型要复杂得多</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://semantic.org/post/forbidden-haskell-types/">https://semantic.org/post/forbidden-haskell-types/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/haskell/">#haskell</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/类型/">#类型</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1010833.html"><img src="http://img.diglog.com/img/2020/7/thumb_2487a6fa8405408e648e7ab655d41be7.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010833.html">Retrie：哈斯克尔重构变得容易</a></div><span class="my_story_list_date">2020-7-10 0:46</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007077.html"><img src="http://img.diglog.com/img/2020/6/thumb_ef105cfee85a31aa5e50a1ed7c1747b6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007077.html">在Haskell中构建无功计算器</a></div><span class="my_story_list_date">2020-6-18 17:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005669.html"><img src="http://img.diglog.com/img/2020/6/thumb_1286525605374d2066f352ecbdb38d5b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005669.html">哈斯克尔的痛点：实践总结</a></div><span class="my_story_list_date">2020-6-8 15:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1002443.html"><img src="http://img.diglog.com/img/2020/5/thumb_14a6d11e0e49572ccd576da5162faeec.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1002443.html">Pontiff：一种Haskell式的鸡计划构建系统</a></div><span class="my_story_list_date">2020-5-17 5:0</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>