<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Java缓冲区类型与本机数组：哪个更快？Java Buffer types versus native arrays: which is faster?</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Java Buffer types versus native arrays: which is faster?<br/>Java缓冲区类型与本机数组：哪个更快？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-01 06:15:14</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/c72a4bdf84c77ccc3eff0558d5edc17a.jpg"><img src="http://img2.diglog.com/img/2020/12/c72a4bdf84c77ccc3eff0558d5edc17a.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>When programming in C, one has to allocate and de-allocate memory by hand. It is an error prone process. In contrast, newer languages like Java often manage their memory automatically. Java relies on garbage collection. In effect, memory is allocated as needed by the programmer, and then Java figures out that some piece of data is no longer needed, and it retrieves the corresponding memory. The garbage collection process is fast and safe, but it is not free: despite decades of optimization, it can still cause major headaches to developers.</p><p>用C语言编程时，必须手动分配和取消分配内存。这是一个容易出错的过程。相反，像Java这样的较新语言通常会自动管理其内存。 Java依赖于垃圾回收。实际上，内存是根据程序员的需要分配的，然后Java指出不再需要某些数据，并检索相应的内存。垃圾回收过程既快速又安全，但是它不是免费的：尽管进行了数十年的优化，但它仍然可能给开发人员带来很多麻烦。</p><p> Java has native arrays (e.g., the int[] type). These arrays are typically allocated on the “Java heap”. That is, they are allocated and managed by Java as dynamic data, subject to garbage collection.</p><p> Java具有本机数组（例如int []类型）。这些数组通常在“ Java堆”上分配。也就是说，它们由Java作为动态数据进行分配和管理，并进行垃圾回收。</p><p> Java also has Buffer types such as the IntBuffer. These are high-level abstractions that can be backed by native Java arrays but also by other data sources, including data that is outside of the Java heap. Thus you can use Buffer types to avoid relying so much on the Java heap.</p><p> Java还具有Buffer类型，例如IntBuffer。这些是高级抽象，可以由本机Java数组支持，也可以由其他数据源（包括Java堆外部的数据）支持。因此，可以使用Buffer类型来避免过多地依赖Java堆。</p><p> But my experience is that it comes with some performance penalty compared to native arrays. I would not say that Buffers are slow. In fact, given a choice between a Buffer and a stream (DataInputStream),  you should strongly favour Buffer types. However, they are not as fast as native arrays in my experience.</p><p> 但是我的经验是，与本机阵列相比，它会带来一些性能损失。我不会说缓冲区很慢。实际上，给定Buffer和流（DataInputStream）之间的选择，您应该强烈赞成Buffer类型。但是，根据我的经验，它们不如本地数组快。</p><p> I can create an array of 50,000 integers, either with “new int[50000]” or as “IntBuffer.allocate(50000)”. The latter should essentially create an array (on the Java heap) but wrappred with an IntBuffer “interface”.</p><p> 我可以使用“ new int [50000]”或“ IntBuffer.allocate（50000）”创建50,000个整数的数组。后者本质上应该创建一个数组（在Java堆上），但是使用IntBuffer“接口”包装。</p><p> A possible intuition is that wrapping an array with an high-level interface should be free. Though it is true that high level abstractions can come with no performance penalty (and sometimes, even, performance gains), whether they do is an empirical matter. You should never just assume that your abstraction comes for free.</p><p> 可能的直觉是，使用高层接口包装数组应该是免费的。尽管高水平的抽象确实不会带来性能损失（有时甚至会提高性能），这是事实，但是否这样做是一个凭经验的问题。您永远不应仅仅假设您的抽象是免费提供的。</p><p> Because I am making an empirical statement, let us test it out empirically with the simplest test I can imagine. I am going to add one to every element in the array/IntBuffer.</p><p> 因为我在做经验陈述，所以让我们用我能想象的最简单的检验对它进行经验检验。我要向array / IntBuffer中的每个元素添加一个。</p><p>       My expectation is that many optimizations that Java applies to arrays are not applied to Buffer types.</p><p>我的期望是，Java适用于数组的许多优化都不适用于Buffer类型。</p><p> Of course, this tells us little about what happens when Buffers are used to map values from outside of the Java heap. My experience suggests that things can be even worse.</p><p> 当然，这几乎不告诉我们使用缓冲区从Java堆外部映射值时会发生什么。我的经验表明，情况可能更糟。</p><p> Buffer types have not made native arrays obsolete, at least not as far as performance is concerned.</p><p> 缓冲区类型并未使本机数组过时，至少在性能方面没有。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://lemire.me/blog/2020/11/30/java-buffer-types-versus-native-arrays-which-is-faster/">https://lemire.me/blog/2020/11/30/java-buffer-types-versus-native-arrays-which-is-faster/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/缓冲区/">#缓冲区</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/buffer/">#buffer</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>