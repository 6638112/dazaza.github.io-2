<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Shitlist驱动开发（2016） Shitlist Driven Development (2016)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Shitlist Driven Development (2016)<br/>Shitlist驱动开发（2016） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-15 16:12:33</div><div class="page_narrow text-break page_content"><p>Recently the team I work with completed a project to  allow Shopify to run inmultiple datacenters. This projectwas a refactoring project in disguise. When you undertake large refactoring of acode-base with 100s of developers and 100,000s of lines of code, you can’t alignby sending an email. The merge-conflicts a single pull request would entailmakes me shiver. When deprecating in a large code-base the only way to reliablyavoid new deprecated behaviour is a failing test that tells you what to do.Otherwise the pace that new deprecated code is introduced can easily outpace thespeed at which you can remove them, or be a massive source of frustration.</p><p>最近，我与之合作的团队完成了一个项目，以允许Shopify在多个数据中心中运行。这个项目是一个变相的重构项目。当您使用100位开发人员和100,000行代码行对代码库进行大规模重构时，您将无法通过发送电子邮件进行调整。单个合并请求的合并冲突会使我不寒而栗。在大型代码库中弃用时，可靠地避免新的过时行为的唯一方法是测试失败，并告诉您该怎么做。否则，引入新的过时代码的步伐很容易超过您删除它们的速度，或者挫败感的巨大根源。</p><p> Typically deprecations come in the form of soft warnings: Logging to  stderr,capital letters and exclamation marks in the documentation, or a legacy prefixto the method or class name. At the end of the day, everyone needs to get workdone, and if they see a code-path already being used from 10 places in thecode-base despite these soft warnings–it doesn’t seem crazy to introduceanother. However, if another project is blocked on these deprecated code-paths,piling on may have a large cost.</p><p> 通常，弃用以软警告的形式出现：登录到文档中的stderr，大写字母和感叹号，或方法或类名的旧前缀。归根结底，每个人都需要做好工作，并且尽管看到这些软警告，但如果他们看到已经从代码库的10个位置使用了代码路径，那么引入另一个似乎并不疯狂。但是，如果在这些不建议使用的代码路径上阻止了另一个项目，则堆积可能会付出巨大的代价。</p><p> To solve this problem  Florian Weingarten on ourteam introduced what he calls “shitlists”: a whitelist of deprecated behaviour.Existing deprecated behaviour is OK and whitelisted. New usage of the deprecatedAPI is banned and fails a test with a well-defined error.</p><p> 为了解决这个问题，弗洛里安·温加滕（Florian Weingarten）在我们的团队中介绍了他所谓的“ shitlists”（shitlists）：过时的行为白名单。禁止对deprecatedAPI进行新的使用，并且测试失败并出现明确定义的错误。</p><p>  Shitlist  =  [  ClassA,  ClassB,  ClassC ] def  push_job_that_does_crazy_things(klass)  if  Shitlist .include?(klass)  # Existing deprecated behaviour is called.  else  raise  Shitlist :: Error,  &lt;&lt;-EOS  You &#39;re pushing a job that does crazy things .  This  API has been deprecated  in this code -base .  &lt;team &gt; is actively trying to getrid of this code -path, because &lt;reason &gt;.  We suggest you instead  do  &lt;alternative &gt;.  If you have questions, pleaseping  &lt;team &gt;.  EOS end</p><p>  Shitlist = [ClassA，ClassB，ClassC] def push_job_that_does_crazy_things（klass）如果Shitlist .include？（klass）＃调用了现有的不赞成使用的行为。否则引发Shitlist ::错误，＆lt;＆lt; -EOS您正在推动一项疯狂的工作。此代码库中已弃用该API。 ＆lt;团队＆gt;正在积极尝试摆脱此代码-path，因为＆lt;原因＆gt;。我们建议您改为＆lt;替代＆gt;。如有疑问，请＆lt; team＆gt;。 EOS结束</p><p> A shitlist could be something as simple as a  git grep for a certain code-path:</p><p> 对于特定的代码路径，shitlist可能像git grep一样简单：</p><p> test  &#34;no new introductions of legacy code path&#34;  do actual  =  `git grep some_legacy_method_with_a_unique_name` assert_equal  321, actual end</p><p> 测试没有新的遗留代码路径的介绍＆＃34;做实际=`git grep some_legacy_method_with_a_unique_name` assert_equal 321，实际结束</p><p>  RedisShitlist  =  [  Session,  FragmentCache,  AuthenticationTokens, ] test  &#34;no new redis models introduced&#34;  do assert_equal  RedisShitlist,  RedisModel .descendants end</p><p>  RedisShitlist = [会话，FragmentCache，AuthenticationTokens]测试＆＃34;未引入新的Redis模型＆＃34;做assert_equal RedisShitlist，RedisModel .descendants结束 </p><p>  Make sure that a certain datastore is only read from in a certain context (ornot used at all). This would allow for using a read-only slave, or improvingresiliency in a certain area.</p><p>确保仅在特定上下文中读取特定数据存储区（或根本不使用）。这将允许使用只读从设备，或提高特定区域的弹性。</p><p> Ensure fallbacks for all uses of a secondary data-store. E.g. if you accesssessions in Redis and Redis is down, you should be able to still render thepage (i.e. have an empty session fallback).</p><p> 确保备用数据存储的所有用途都有备用。例如。如果您在Redis中访问会话并且Redis处于关闭状态，则您仍应该能够呈现该页面（即会话为空）。</p><p> Shitlisting joins between tables that have no business being joined. This ishelpful to keep data-models and scope clean, or separating a part of anapplication.</p><p> 在没有业务连接的表之间进行Shitlisting连接。这有助于保持数据模型和范围的整洁，或分离应用程序的一部分。</p><p> If you have a linter for a project, you may be able to encode rules. For exampleyou might use  Foodcritic for Chef, or Rubocop for Ruby.</p><p> 如果您有一个项目的lint，则可以对规则进行编码。例如，您可以将Foodcritic用于Chef，或将Rubocop用于Ruby。</p><p>   Strong feedback loop. The goal is to reduce the  Shitlist to an emptyArray and always raise or remove the code entirely. Remove a class from thelist, fix the code and the tests, celebrate and move on.</p><p>   强大的反馈回路。目标是将Shitlist减少为emptyArray，并始终完全提高或删除代码。从列表中删除一个类，修复代码和测试，庆祝并继续前进。</p><p> Stopped the bleeding. New deprecated behaviour is not introduced unlessthe team is contacted or some other action defined in the error is taken.</p><p> 止血了。除非与团队联系或采取错误中定义的其他措施，否则不会引入新的过时行为。</p><p> Success metric. If you have shitlists for everything that needs to bedone for your project, you have metrics that you can track. Every week youcan look at how these lists are shrinking. Refactoring for months at a timecan be exhausting, but if you see that you’re making progress with metricsmoving, it’s much more rewarding.</p><p> 成功指标。如果您有项目清单需要完成的所有项目的清单，则可以跟踪指标。每周您都可以查看这些列表的缩减情况。一次进行数月的重构可能会很累，但是如果您发现在移动指标方面取得了进步，那将是非常有意义的。 </p><p> Enforces a guarantee. For example, you can have a shitlist that all jobshave a retry mechanism. In that case, you know that you can kill any workergracefully at any time since the job will retry. Because of 1-3 you know howmuch work it will take to have this guarantee.</p><p>强制执行保证。例如，您可以拥有所有作业都具有重试机制的Shitlist。在这种情况下，您知道您可以随时优雅地杀死任何工作人员，因为该作业将重试。由于1-3，您知道获得此保证将需要多少工作。</p><p> It is important that the shitlist errors are actionable. If you hit the shitlistof another team, you need to know what to do next. Ideally the error explainsexactly what you need to do, and no humans need to talk, but reaching out to theowner of the shitlist should always be part of the shitlist.</p><p> shitlist错误是可操作的，这一点很重要。如果您碰到另一支球队的名单，则需要知道下一步该怎么做。理想情况下，该错误确切地说明了您需要执行的操作，并且无需任何人说话，但是与您的恋爱清单所有者保持联系应该始终是该恋爱清单的一部分。</p><p> If you own a shitlist, you must empathize with the problems of everyone who’srunning into problems. If you simply deprecate new behaviour and don’t offer analternative, you will be the source of frustration. If the value of emptying theshitlist far outweighs the value of adding to the shitlist, it may be OK to notoffer a direct other solution but ask the person who ran into the error torevise their solution.</p><p> 如果您拥有名单，则必须对遇到问题的每个人都充满同情。如果您只是不赞成使用新的行为而没有提供替代方案，那么您将成为沮丧的源头。如果清空shitlist的价值远远超过添加到shitlist的价值，则可以不提供其他直接解决方案，而请遇到错误的人修改其解决方案也可以。</p><p> It is important that people run into shitlists as early in development aspossible. If you run into a shitlist after spending hours implementing yoursolution, you will be less than popular. Some shitlists may require an entirere-architecting of some teams’ solutions.</p><p> 重要的是，人们应尽可能早地进入开发名单。如果您花了几个小时来实施解决方案后遇到了垃圾邮件列表，那么您将不那么受欢迎。有些名单可能需要对某些团队的解决方案进行整体重新架构。</p><p> Months, in our case more than a year, of refactoring can be overwhelming andunrewarding work. With the strong feedback loop that shitlists introduce you cansee the light at the end of the tunnel. You know that nothing is added to theshitlist without you knowing about it.</p><p> 在我们的情况下，为期数月的重构可能是不堪重负的工作。借助名单列表中引入的强大反馈循环，您可以看到隧道尽头的灯光。您知道在不知道的情况下什么也不会添加到shitlist。</p><p> Creating shitlists in some cases can be extremely difficult. Some take hours tocreate, others weeks, and in our case one took months to come up with. You’llhave to place the cost of developing the shitlist against the cost of not havingit. In some cases logging when you hit a bad code-path may be enough (simplesoft warning deprecation) if you assert the risk of new behaviour small and thecomplexity of introducing the shitlist big.</p><p> 在某些情况下，创建名单可能非常困难。有些需要花费数小时才能创建，而另一些则需要数周，而我们的案例需要花费数月才能得出。您必须将开发shitlist的成本与不拥有shitlist的成本进行比较。在某些情况下，如果您断言新行为的风险很小，而引入垃圾邮件列表的复杂性很大，那么在遇到错误的代码路径时进行日志记录可能就足够了（simplesoft警告弃用）。</p><p> Delegating with shitlists is great. Due to the tight feedback loop, asking otherteams or onboarding new team members becomes much easier. Remove something onthe shitlist, fix the code and the tests, then move on. Sometimes during largerefactorings you may need other teams with more domain expertise of a certainarea of the code-base to help. The shitlist becomes a great rock to point peopleat.</p><p> 与shitlists委派很棒。由于紧密的反馈循环，询问其他团队或加入新的团队成员变得容易得多。删除名单上的内容，修复代码和测试，然后继续。有时在大型重构期间，您可能需要其他团队，他们需要在代码库某个区域拥有更多领域专业知识，以提供帮助。名单上的人物成为指点人物的大石头。 </p><p> If you are about to embark on a large refactor, I highly recommend addingshitlists to your toolbox. Your project will look much less daunting when itgoes from an opaque objective to a list of shitlists.</p><p>如果您打算进行大型重构，强烈建议您将工具列表添加到工具箱中。 从不透明的目标转到列表列表，您的项目看起来将不再那么艰巨。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://sirupsen.com/shitlists/">https://sirupsen.com/shitlists/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开发/">#开发</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/驱动/">#驱动</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/driven/">#driven</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>