<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何绘制轨道 - 内核空间程序开发博客 How to Draw Orbits – Kernel Space Program Dev Blog</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">How to Draw Orbits – Kernel Space Program Dev Blog<br/>如何绘制轨道 - 内核空间程序开发博客 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-19 21:54:19</div><div class="page_narrow text-break page_content"><p>Hello all, I’m Johannes Peter – A programmer on Kerbal Space Program 2 – and I love solving interesting problems!</p><p>你好，我是Johannes Peter  - 一位Kerbal Space Program 2的程序员 - 我喜欢解决有趣的问题！</p><p> The problems we face in game development rarely have a single “correct” answer. The more specialized your game is, the more specialized your problems are, and the more creative your solutions need to be. As a rocketry simulator on an interplanetary scale, Kerbal Space Program has already tackled a wealth of  unique programming challenges.</p><p> 我们在游戏开发中面临的问题很少有一个“正确”的答案。您的游戏越专业，您的问题越专门，以及您的解决方案的创造性越多。作为行星际模拟器的火箭模拟器，Kerbal Space计划已经解决了丰富的独特编程挑战。</p><p> Today I want to share a solution I’ve worked on for a problem that is fairly unique to KSP:  How to draw accurate orbits that look stellar regardless of where they’re viewed from?</p><p> 今天我想分享一个解决方案，我已经为KSP提供了相当独一无二的问题：如何绘制精确的轨道，无论他们从哪里看，如何看待恒星？</p><p> I’ll briefly cover a standard approach for drawing orbits, touch on some of the issues with that approach, and then look at the solution that KSP2 is using now:  screen space orbit tessellation.</p><p> 我将简要介绍一个标准方法来绘制轨道，触摸该方法的一些问题，然后查看KSP2正在使用的解决方案：屏幕空间轨道曲折号。</p><p> This dev diary will get a bit into the technical side of KSP2’s development, with diagrams to help illustrate some of the core concepts. We will mainly focus on this test scene of Kerbin orbiting Kerbol:</p><p> 此开发日记将有点进入KSP2开发的技术方面，有帮助说明一些核心概念。我们主要关注Kerbin orbiting Kerbol的这一测试场景：</p><p>   All visuals were created specifically for this dev diary, and are in no way representative of how  anything may look in the final game. It’s just programmer art.</p><p>   所有视觉效果都是专门为此开发日记创建，并且绝不代表最终游戏的任何东西。这只是程序员艺术。</p><p>  All orbits are to scale and celestial bodies are a constant screen size to make them easy to see.</p><p>  所有轨道都是缩放，天体是一个恒定的屏幕尺寸，使它们易于看。 </p><p>  I hope it isn’t too   hyperbolic  of me to say, but KSP is all about orbits. Building, flying, and crashing rockets are all core to KSP’s identity, but if I had to describe KSP with one defining characteristic, it would be that it teaches you how orbits work on an intuitive level, just by playing it.</p><p>我希望这不是太栓塞说，但KSP都是关于轨道的。建筑，飞行和撞击火箭都是KSP的身份的核心，但如果我不得不用一个定义特征描述KSP，那就是它教你如何在直观的水平上工作，只是通过播放它。</p><p> While there are definitely exceptions (you know who you are), most players depend on the Map View to plan their journeys from launchpad A to crater B, so being able to display lots of orbits without visual artifacts is critical.</p><p> 虽然肯定是例外（你知道你是谁），但大多数玩家都依赖于地图视图来规划他们从Launchpad A到火山口B的旅程，因此能够在没有视觉伪影的情况下显示大量轨道是至关重要的。</p><p>  An orbit is the path that an object takes as it moves through space while under the gravitational influence of other objects around it. Real life orbits are chaotic and not deterministic. Without performing many small iterative calculations, it is generally not possible to say for certain where an object will be in space at an arbitrary point in time.</p><p>  轨道是对象所采用的路径，因为它在其周围的其他物体的引力影响下移动到空间。现实生活轨道是混乱而不是确定性的。在不执行许多小迭代计算的情况下，通常不可能对某些在任意时间点处于空间的确定。</p><p> This is one of the reasons why KSP simplifies its orbital mechanics so that generally you’re only within the  sphere of influence of one celestial body at a time. These kinds of orbits are known as  Kepler orbits  where position and velocity at any point on the orbit can be described using  parametric equations. With a parametric equation we can plug in a parameter —like a  time or an  angle —and get an accurate position or velocity.</p><p> 这是KSP简化其轨道机制的原因之一，因此通常您只有一次一个天体的影响范围。这些种类的轨道被称为孔轨道，其中可以使用参数方程描述轨道上的任何点处的位置和速度。使用参数方程，我们可以插入一个时间或一个角度 - 和速度的位置 - 和获得准​​确的位置或速度。</p><p> If a curve can be described as a parametric equation it is easy for us to draw.</p><p> 如果曲线可以被描述为参数方程，我们可以绘制。</p><p>  Choose a   start and   end parameter, as well as how many   points we want to generate.</p><p>  选择一个开始和结束参数，以及我们要生成的点数。</p><p> Generate the points by passing values into the parametric function that range from   start to   end.</p><p> 通过将值传递到从开始到结束的参数函数中来生成点。 </p><p>  With that function we can use a   start  and   end  parameter to generate our   points :</p><p>使用该函数，我们可以使用一个开始和结束参数来生成我们的要点：</p><p>  And assuming that we have a function to draw a line between two points, we can finally draw the lines between the points we just generated:</p><p>  假设我们有一个函数在两点之间画出一行，我们最终可以在我们刚刚生成的点之间绘制线条之间的线路：</p><p>   The green line is the ideal sine curve that we want to draw, and the blue line is the result of our   GenerateParametricPoints  and   DrawParametricCurve  functions.</p><p>   绿线是我们想要绘制的理想正弦曲线，蓝线是我们生成的参考点和绘制节目函数的结果。</p><p> Changing the   start and   end parameters (shown here in degrees) affects the position and length of the curve and the more points we generate the better the lines match the ideal curve.</p><p> 更改开始和结束参数（以下以学位显示）会影响曲线的位置和长度以及我们生成的点越多，线路符合理想曲线的速度越好。</p><p>   A parametric equation of our orbit. The exact equation is  outside the scope of this post, but for those curious, you can see better results if it uses the  eccentric anomaly as its parameter.</p><p>   我们轨道的参数方程。确切的等式超出了这篇文章的范围，但对于那些好奇的人来说，如果它使用偏心异常作为参数，您可以看到更好的结果。</p><p> A   start and an   end parameter that we’ll step between. A full orbit’s parametric equation generally ranges from 0 to 2π radians, or 0 to 360 degrees.</p><p> 一开始和结束参数，我们将介入。完整的轨道的参数方程通常为0到2π弧度，或0到360度。</p><p> The number of   points we want to generate. The default in KSP1 is 180 points for a full orbit.</p><p> 我们要生成的点数。 KSP1中的默认值为完整轨道为180分。 </p><p> A graphics package to do the rendering. We need a  way to draw a line between two points.</p><p>要执行渲染的图形包。我们需要一种方法来绘制两点之间的一条线。</p><p> As with the sine wave, we generate points using parameters ranging from the   start to the   end value, and by increasing the number of points we generate, we get a smoother looking orbit:</p><p> 与正弦波一样，我们使用从开始到终端值的参数生成点，并且通过增加我们生成的点数，我们得到了一个更顺畅的看轨道：</p><p>  Of course there’s a lot that I’m glossing over here, such as more efficient ways to draw lines than one at a time or other optimizations, but in a nutshell this is how orbits were drawn in KSP1.</p><p>  当然，我在这里有很多光泽，例如在一次或其他优化中绘制线的更有效的方法，但是简而言之，这就是轨道在KSP1中绘制的轨道。</p><p>  Evenly distributing the  points  of an orbit yields excellent results when viewed from   far away, specifically when the camera is not close to the plane that the orbit is on.  However, in KSP you frequently view orbits from extremely flat angles. For exampl e, when zoomed in close enough to see the moon of a planet, the orbit of the planet will be almost completely flat.</p><p>  在远处观察时均匀分布轨道的点产生优异的结果，特别是当相机不接近轨道上的平面时。但是，在KSP中，您经常从极平角度查看轨道。对于Exampl E，当足够缩小时缩小到一个星球的月亮，地球的轨道几乎完全平坦。</p><p> Let’s add the orbits of Kerbin’s moons Mun and Minmus to our example scene:</p><p> 让我们将Kerbin的Moons Mun和Minmus的轨道添加到我们的示例场景：</p><p>  W hen we zoom in on Kerbin’s moons , we  see sharp corners on Kerbin’s orbit. The orbit line also misses Kerbin by a significant margin.   Even though we generated Kerbin’s orbit with 180 points, the distance between two points is still about 5 times larger than  Minmus’ entire orbit :</p><p>  W Hen我们放大了Kerbin的卫星，我们看到Kerbin的轨道上的尖角。轨道线也偏出了克里林的重大保证金。即使我们生成了180点的Kerbin的轨道，两点之间的距离仍然比minmus的整个轨道大约5倍：</p><p>  If we evenly distribute the points around the orbit, then with orbits as large as those in KSP we run into scenarios where there may not be enough points from the camera’s point of view to look smooth.</p><p>  如果我们均匀地分布轨道周围的点，那么与ksp那么大的轨道，我们遇到了相机的角度可能没有足够的点，看起来很流畅。 </p><p> We could increase the point count,  but we’ll  quickly run into diminishing returns. Much of the orbit already looks smooth so adding points there would be a waste, while due to the angle of the camera other parts of the orbit don’t have enough points.</p><p>我们可以增加点数量，但我们会迅速遇到递减递减。大部分轨道已经看起来光滑，所以添加点会有浪费，而由于相机的角度，轨道的其他部分没有足够的点。</p><p>   If you have two points that were generated with a parametric equation you can generate a new point between them by averaging their parameters:</p><p>   如果使用参数方程生成的两点，则可以通过平均其参数来生成它们之间的新点：</p><p>  We can start with a small set of points and insert new ones by averaging their parameters. The curve becomes smoother each time we do this:</p><p>  我们可以从一组小点开始，并通过平均其参数插入新点。每次这样做时，曲线都会变得更加光滑：</p><p> In computer graphics  tessellation  is the process of dividing geometry to make it smoother. We are effectively tessellating our parametric curve.   We really only care that the curve appears smooth on the screen, so we want to evaluate the  smoothness  of our points in  screen space , where the X and Y coordinates correspond to the  point’s   screen position:</p><p> 在计算机图形学中，曲面状是分割几何形状的过程，使其更平滑。我们有效地使我们的参数曲线镶嵌。我们真的关心屏幕上的曲线显得平滑，因此我们希望评估我们在屏幕空间中的点的平滑度，其中x和y坐标对应于点的屏幕位置：</p><p>  With our points in screen space, we can insert a new point between points  A  and  B  based on how smooth the curve is there. But how do we define ‘smoothness’?</p><p>  通过我们在屏幕空间中的积分，我们可以根据曲线的平滑是如何平滑的点A和B之间的新点。但我们如何定义“平滑”？</p><p>  A heuristic is a rule-of-thumb; a method for solving a problem very fast while being adequately accurate. We need a heuristic to efficiently decide if our points are ‘smooth enough’.   We’ve mentioned two heuristics so far:</p><p>  启发式是一个拇指规则;一种用于解决问题的方法，同时充分准确。我们需要一个启发式，以有效地确定我们的积分是否“足够平滑”。到目前为止，我们已经提到了两个启发式：</p><p> The  distance between points. If points are visually close together then they’re less noticeable.</p><p> 点之间的距离。如果点在视觉上靠近，则它们不太明显。 </p><p> The  angle between points. The closer three points are to a straight line the less their middle corner stands out.</p><p>点之间的角度。三个点越近一条直线越少的中间角脱颖而出。</p><p> A convenient heuristic that incorporates both is the  triangle area, which we can compute very quickly using the  shoelace formula:</p><p> 一个方便的启发式，包括三角形区域，我们可以使用鞋带公式来非常快速地计算：</p><p>  If the triangle of   a ,   b  and   c  in screen space has an area larger than a given upper limit, then we insert a new point between  a  and  b  to smooth out the curve.   We evaluate our heuristic on every consecutive set of three points, until all points satisfy our heuristic, or we reach another end condition like how many points we have in total.</p><p>  如果屏幕空间中的A，B和C的三角形具有大于给定的上限的区域，则我们在A和B之间插入新点以平滑曲线。我们在每一个连续三个点中评估我们的启发式，直到所有点都满足我们的启发式，或者我们达到另一个结束条件，如我们总共有多少积分。</p><p>    We can apply the triangle heuristic to our orbits, coloring each point based on the Iteration it was added in—red first, then orange, yellow, and so on:</p><p>    我们可以将三角形启发式应用于我们的轨道，基于迭代的每个点着色它是红色的第一，然后是橙色，黄色等：</p><p>  The orbits are tessellated using the top-right camera and the turquoise lines show the viewing bounds of that camera. The top-left shows a close up of Kerbin and its moons.   The closer the camera moves to the  orbit, the  more iterations need to be performed to satisfy our heuristic, but we also use far fewer points overall because we only generate points where needed. For example the orbits of Mun and Minmus only generate new points when they become visible.   Here’s the original shot again with tessellation enabled and all debug drawing removed:</p><p>  使用右上右摄像头缠绕轨道，绿松石线显示该相机的观看界。左上图显示了Kerbin及其卫生的特写。相机移动到轨道的越近，需要执行越多的迭代来满足我们的启发式，但我们也使用较少的分数来实现，因为我们只生成所需的点。例如，Mun和Minmus的轨道只在变得可见时产生新点。以下是启用曲面的原始拍摄，并删除了所有调试绘图：</p><p>   Closing Thoughts   When working on programming problems your first solution is rarely perfect, and it’s possible for your solution to have its own problems that you need to solve.   There is far more that went into the development of this feature that I’d love to share here, from implementation details like additional heuristics, culling optimizations and choosing the right data structure for efficient point insertions, to how this can be used for more than just Keplerian orbits, but this is enough for one post.   If you enjoyed this technical deep dive and want to see more stuff like it please let us know! Having the chance to share something like this with you all is very special to me. I wouldn’t be in this industry if it wasn’t for so many developers sharing their passions and inspiring me through their work online.   I’ll leave you with one last debug visualization, showing the spatial partitioning used to decide when points are worth subdividing even if they’re not on screen (but one of their descendants might be):</p><p>   关闭思想在努力在编程问题上工作时，您的第一个解决方案很少是完美的，并且您的解决方案可能有可能需要解决自己的问题。远远进入了这个功能的发展，我喜欢在这里分享，从实现细节，如其他启发式，剔除优化和选择正确的数据结构，以便如何使用它超过只是开普勒轨道，但这足以让一个帖子。如果您喜欢这种技术深潮并希望看到更多的东西，请告诉我们！有机会与你分享这样的东西，对我来说非常特别。如果不是为这么多开发商分享他们的激情并通过在线工作激励我，我不会在这个行业中。我会留下最后一个调试可视化，显示用于决定点的空间分区，即使它们不在屏幕上也值得细分时（但他们的一个后代可能是）： </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.kerbalspaceprogram.com/dev-diaries/6509/">https://www.kerbalspaceprogram.com/dev-diaries/6509/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/开发/">#开发</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/轨道/">#轨道</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/orbits/">#orbits</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>