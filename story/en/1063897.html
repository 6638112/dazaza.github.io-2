<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>创建一个无要的函数来刮掉网页元数据 Creating a serverless function to scrape web pages metadata</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Creating a serverless function to scrape web pages metadata<br/>创建一个无要的函数来刮掉网页元数据 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-07 01:26:30</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/1a65df924f8779c225ea2e11e4155568.png"><img src="http://img2.diglog.com/img/2021/6/1a65df924f8779c225ea2e11e4155568.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Nowadays, most websites provide metadata about their content directly in the HTML markup. This post will show you how to create a Vercel serverless function to scrape this data using  Metascraper.</p><p>如今，大多数网站在HTML标记中直接提供关于它们内容的元数据。此帖子将向您展示如何使用MetaScraper来创建Vercel无操作功能以刮除此数据。</p><p>  Metascraper is a rule-based system that allows searching over a website content according to a series of rules. It is distributed as  an open-source Node.js library.</p><p>  MetaScraper是一个基于规则的系统，允许根据一系列规则搜索网站内容。它被分发为开源节点.js库。</p><p>   You can use Metascraper in any Node.js application. In my opinion, the most convenient way to use it is within a small Node.js server that, given an input URL, will return structured metadata about the target webpage as output. The idea is to create an API that:</p><p>   您可以在任何Node.js应用程序中使用MetaScraper。在我看来，最便捷的使用方法是给定输入URL的一个小节点.js服务器，将返回有关目标网页的结构化元数据作为输出。这个想法是创建一个API：</p><p> Checks that a valid URL has been passed as a parameter (e.g.: as a  ?url query-parameter).</p><p> 检查有效的URL已作为参数（例如：AS？URL Query-参数）。</p><p>  Given that the goal of this Node.js server is very well-scoped and that we don’t expect requests to take a long time to run, this is an excellent fit for deploying it as a serverless/lambda function. I’ll use  Vercel to deploy a serverless function, but you can do the same on any other serverless API provider that supports Node.js (e.g., AWS Lambda, Firebase, Netlify, etc…). Get started by creating a project directory,  cd into it, and initialize it using npm:</p><p>  鉴于此Node.js Server的目标非常好，我们不希望请求需要很长时间运行，这是一个很好的适合将其部署为无操作系统/ lambda函数。我将使用Vercel部署无服务器函数，但是您可以在支持Node.js（例如，AWS Lambda，Firebase，NetWase等）上的任何其他无服务器API提供程序上对此操作。通过创建项目目录，CD进入IT，使用NPM初始化：</p><p>    And update your start script in your  package.json to  &#34;start&#34;: &#34;vercel dev&#34;to run your serverless function locally.</p><p>    并将您的start脚本更新为＆＃34; start＆＃34 ;:＆＃34; Vercel dev＆＃34;在本地运行无务函数。</p><p>   // api/scrape.js // In Vercel, any file inside the folder &#34;/api&#34; is mapped to &#34;/api/*&#34; and  // will be treated as an API endpoint. // For an API route to work, you need to export a function as default (a.k.a request handler), // which then receives the following parameters: // - req: The request object. // - res: The response object. // See https://vercel.com/docs/serverless-functions/supported-languages#node.js for details. export  default  async  function  handler ( req , res )  { res . status ( 200 ) . send (  ` Hello world! ` ) }</p><p>   // api / scrape.js //在Vercel中，文件夹中的任何文件＆＃34; / api＆＃34;映射到＆＃34; / api / *＆＃34;和//将被视为API端点。 //对于API工作路由，您需要将函数导出为默认值（A.k.a请求处理程序），然后接收以下参数：//  -  req：请求对象。 //  -  res：响应对象。 //请参阅https://vercel.com/docs/serverless-functions/supported-languages#node.js了解详细信息。导出默认async函数处理程序（req，res）{res。状态（200）。发送（`你好世界！`）} </p><p> You should now be able to run deploy your code to Vercel (of course, we haven’t added any “real” logic in  api/scrape.js, so it won’t do anything now). My go-to approach on these occasions is to  create a GitHub repo and connect it to Vercel so that it will take care of automatically deploying the project on each commit — but  you can also do it manually if you prefer.</p><p>您现在应该能够运行将代码部署到Vercel（当然，我们还没有在API / Scrape.js中添加任何“真实”逻辑，因此它现在不会做任何事情）。在这些场合我的进一步方法是创建一个GitHub回购并将其连接到Vercel，以便在每个提交上自动部署项目 - 但如果您愿意，您也可以手动执行。</p><p>   First of all, we’ll use the  got npm package to fetch the website content (feel free to use any other fetching library), and the  metascraper npm package to extract the metadata:</p><p>   首先，我们将使用Get NPM包来获取网站内容（随意使用任何其他获取库），以及MetasCraper NPM包以提取元数据：</p><p>  Metascraper uses “rules bundles” to extract the metadata. Rules bundles are a collection of HTML selectors around a determinate property. The metascraper npm package doesn’t include any rule bundle out of the box, so you’ll need to install each one you need manually. You can check the  “Rules Bundles” section of the metascraper docs to see a list of available bundles. To make sure we extract as much metadata as we can, let’s add (almost) all of them:</p><p>  MetaScraper使用“规则捆绑”提取元数据。规则包是确定属性周围的HTML选择器的集合。 MetaScraper NPM包不会包含开箱即用的任何规则包，因此您需要安装手动需要的每个规则束。您可以检查MetasCraper文档的“规则捆绑”部分以查看可用捆绑包的列表。要确保我们可以提取尽可能多的元数据，让我们添加（几乎）所有这些：</p><p> npm i metascraper-amazon metascraper-audio metascraper-author metascraper-clearbit metascraper-date metascraper-description metascraper-image metascraper-instagram metascraper-lang metascraper-logo metascraper-logo metascraper-publisher metascraper-readability metascraper-soundcloud metascraper-spotify metascraper-telegram metascraper-title metascraper-url metascraper-video metascraper-youtube</p><p> NPM i MetaScraper-Amazon MetaScaper-Audio Metascaper-Authent MetaScraper-Clearbit Metascaper-Diame Metascaper-Design Metascaper-Image Metascraper-Instagram Metascraper-Lang MetaScraper-Logo Metascaper-Logo Metascraper-Pureascaper-Logo Metascraper-Soundcloud Metascaper-SoundCloud Metascaper-SoundCloud Metascraper-SoundCloud Metascaper-SoundCloud MetaScraper-Soundcare Metascraper标题Metascraper-URL MetaScraper-Video Metascraper-YouTube</p><p> We’re now ready to set up our API logic in  api/scrape.js. For the sake of simplicity, here’s the entire code (with comments):</p><p> 我们现在可以在API / Scrape.js中设置我们的API逻辑。为简单起见，这是整个代码（有评论）：</p><p> // api/scrape.js // In Vercel, any file inside the folder &#34;/api&#34; is mapped to &#34;/api/*&#34; and  // will be treated as an API endpoint. const  { parse  }  =  require ( &#34;url&#34; ) ; const got  =  require ( &#34;got&#34; ) ; // Initialize metascraper passing in the list of rules bundles to use. const metascraper  =  require ( &#34;metascraper&#34; ) ( [  require ( &#34;metascraper-amazon&#34; ) ( ) ,  require ( &#34;metascraper-audio&#34; ) ( ) ,  require ( &#34;metascraper-author&#34; ) ( ) ,  require ( &#34;metascraper-date&#34; ) ( ) ,  require ( &#34;metascraper-description&#34; ) ( ) ,  require ( &#34;metascraper-image&#34; ) ( ) ,  require ( &#34;metascraper-instagram&#34; ) ( ) ,  require ( &#34;metascraper-lang&#34; ) ( ) ,  require ( &#34;metascraper-logo&#34; ) ( ) ,  require ( &#34;metascraper-clearbit-logo&#34; ) ( ) ,  require ( &#34;metascraper-logo-favicon&#34; ) ( ) ,  require ( &#34;metascraper-publisher&#34; ) ( ) ,  require ( &#34;metascraper-readability&#34; ) ( ) ,  require ( &#34;metascraper-spotify&#34; ) ( ) ,  require ( &#34;metascraper-title&#34; ) ( ) ,  require ( &#34;metascraper-telegram&#34; ) ( ) ,  require ( &#34;metascraper-url&#34; ) ( ) ,  require ( &#34;metascraper-logo-favicon&#34; ) ( ) ,  require ( &#34;metascraper-amazon&#34; ) ( ) ,  require ( &#34;metascraper-youtube&#34; ) ( ) ,  require ( &#34;metascraper-soundcloud&#34; ) ( ) ,  require ( &#34;metascraper-video&#34; ) ( ) , ] ) ; // For an API route to work, you need to export a function as default (a.k.a request handler), // which then receives the following parameters: // - req: The request object. // - res: The response object. // See https://vercel.com/docs/serverless-functions/supported-languages#node.js for details. export  default  async  function  handler ( req , res )  {  // Parse the &#34;?url&#34; query parameter.  const targetUrl  =  parse (req .url ,  true ) .query ?.url ;  // Make sure the provided URL is valid.  if  ( !targetUrl )  { res  . status ( 401 )  . send ( &#39;Please provide a valid URL in the &#34;url&#34; query parameter.&#39; ) ;  return ;  }  try  {  // Use the got library to fetch the website content.  const  { body : html , url  }  =  await  got (targetUrl ) ;  // Extract the metadata from the website content.  const metadata  =  await  metascraper ( { html , url  } ) ;  // The Vercel Edge Network can cache the response at the edge in order to   // serve data to your users as fast as possible.  // Here we&#39;re caching the response at the edge for 1 hour.  // See https://vercel.com/docs/edge-network/caching for details. res . setHeader ( &#34;Cache-Control&#34; ,  &#34;s-maxage=3600&#34; ) ;  // Return the metadata as JSON res . status ( 200 ) . json (metadata ) ;  }  catch  (err )  { console . log (err ) ; res . status ( 401 ) . json ( { error :   ` Unable to scrape &#34;  ${url } &#34;. `  } ) ;  } }</p><p> // api / scrape.js //在Vercel中，文件夹中的任何文件＆＃34; / api＆＃34;映射到＆＃34; / api / *＆＃34;和//将被视为API端点。 const {parse} =要求（＆＃34; url＆＃34;）; const get =要求（＆＃34; got＆＃34;）; //初始化在要使用的规则捆绑列表中传递的Metascraper。 Const Metascraper =要求（＆＃34; MetaScraper＆＃34;）（[＆＃34; Metascraper-Amazon＆＃34;）（），要求（＆＃34; Metascraper-audio＆＃34;）（），要求（ ＆＃34; metascraper-author＆＃34;）（），要求（＆＃34; metascraper-date＆＃34;）（），需要（＆＃34; metascraper-description＆＃34;）（），要求（＆＃ 34; Metascraper-Image＆＃34;）（），要求（＆＃34; Metascraper-Instagram＆＃34;）（），要求（＆＃34; metascraper-lang＆＃34;）（），需要（＆＃34; metascraper-logo＆＃34;）（），要求（＆＃34; metascraper-clembit-logo＆＃34;）（），要求（＆＃34; metascraper-logo-favicon＆＃34;）（），要求（＆＃ 34; Metascraper-Publisher＆＃34;）（），需要（＆＃34; MetaScraper-可读性＆＃34;）（），要求（＆＃34; metascraper-spotify＆＃34;）（），要求（＆＃34; metascraper-title＆＃34;）（），要求（＆＃34; metascraper-telegram＆＃34;）（），要求（＆＃34; metascraper-url＆＃34;）（），需要（＆＃34; metascraper- Logo-Favicon＆＃34;）（），要求（＆＃34; Metascraper-Amazon＆＃34;）（），r equire（＆＃34; metascraper-youtube＆＃34; ）（），要求（＆＃34; metascraper-soundcloud＆＃34;）（），需要（＆＃34; metascraper-video＆＃34;）（），]）; //对于API工作路由，您需要将函数导出为默认值（A.k.a请求处理程序），然后接收以下参数：//  -  req：请求对象。 //  -  res：响应对象。 //请参阅https://vercel.com/docs/serverless-functions/supported-languages#node.js了解详细信息。导出默认async函数处理程序（req，res）{//解析＆＃34;？url＆＃34;查询参数。 const targeturl = parse（req .url，true）.query？.url; //确保提供的URL有效。 if（！targeturl）{res。状态（401）。发送（＆＃39;请在＆＃34; url＆＃34中提供有效的URL;查询参数。＆＃39;）;返回 ;尝试{//使用get库获取网站内容。 const {body：html，url} =等待GOT（targeturl）; //从网站内容中提取元数据。 const元数据=等待Metascraper（{HTML，URL}）; // Vercel Edge网络可以缓存边缘处的响应，以便//尽可能快地为用户提供数据。 //在这里我们＆＃39;重新加强边缘处的响应1小时。 //请参阅https://vercel.com/docs/edge-network/caching for详情。 res。 Setheader（＆＃34;缓存控制＆＃34;，＆＃34; s-maxage = 3600＆＃34;）; //将元数据返回JSON RES。状态（200）。 JSON（元数据）;捕获（错误）{控制台。日志（错误）; res。状态（401）。 JSON（{错误：`无法刮伤＆＃34; $ {url}＆＃34;`}）; }}</p><p> That’s it. By running  npm start (or deploying your code) and calling the  /api/scrape endpoint with a valid URL in the  url query parameter, you should get a JSON response with the webpage metadata.</p><p> 就是这样。通过在URL查询参数中使用有效的URL调用/ api / scrape端点来运行npm start（或部署代码），您应该使用网页元数据获取JSON响应。 </p><p>  {  &#34;lang&#34; :  &#34;en&#34; ,  &#34;author&#34; :  null ,  &#34;title&#34; :  &#34;Google&#34; ,  &#34;publisher&#34; :  null ,  &#34;image&#34; :  &#34;https://www.google.com/images/branding/googleg/1x/googleg_standard_color_128dp.png&#34; ,  &#34;audio&#34; :  null ,  &#34;date&#34; :  null ,  &#34;description&#34; :  &#34;Search the world’s information, including webpages, images, videos and more. Google has many special features to help you find exactly what you’re looking for.&#34; ,  &#34;video&#34; :  null ,  &#34;logo&#34; :  &#34;https://logo.clearbit.com/www.google.com&#34; ,  &#34;url&#34; :  &#34;https://www.google.com/&#34; }</p><p>{＆＃34; lang＆＃34; ：＆＃34; en＆＃34; ，＆＃34;作者＆＃34; ：null，＆＃34;标题＆＃34; ：＆＃34;谷歌＆＃34; ，＆＃34;出版商＆＃34; ：null，＆＃34;图像＆＃34; ：＆＃34; https：//www.google.com/images/branding/googleg/1x/googleg_standard_color_128dp.png&#34; ，＆＃34;音频＆＃34; ：null，＆＃34;日期＆＃34; ：null，＆＃34;描述＆＃34; ：＆＃34;搜索世界的信息，包括网页，图像，视频等。谷歌有许多特殊功能可以帮助您找到您正在寻找的内容。＆＃34; ，＃34;视频＆＃34; ：null，＆＃34; logo＆＃34; ：＆＃34; https：//logo.clearbit.com/www.google.com&#34; ，＆＃34; url＆＃34; ：＆＃34; https：//www.google.com/&#34; }</p><p> You can find the entire source code of this project  on GitHub — feel free to fork it or give it a try!</p><p> 您可以在Github上找到此项目的整个源代码 - 请随时叉子叉或试试！</p><p>  The  metascraper-video package depends on the   is-video package to determine if a   tag contains a valid video URL, and  is-video depends on the   video-extensions package that holds a list of valid video extensions. Unfortunately, the  video-extensions package hasn’t been updated in a while now, so it doesn’t support the  m3u8 video extension (which is a popular video extension on the web nowadays). Until  this pull request is released and  is-video is updated to use the latest version of  video-extensions, you can use   patch-package with the following diff to manually patch the  m3u8 support into  video-extensions (by putting it into  patches/video-extensions+1.1.0.patch).</p><p>  MetaScraper-Video Package取决于IS-Video Package，以确定标记是否包含有效的视频URL，并且IS-Video取决于保存有效视频扩展列表的视频扩展程序包。遗憾的是，视频扩展程序包现在尚未更新，因此它不支持M3U8视频扩展（现在是网络上的流行视频分机）。在释放此拉索请求并更新为视频才能使用最新版本的视频扩展，您可以使用以下差异使用Patch-Package手动修补M3U8支持（通过将其放入修补程序/视频） -extensions + 1.1.0.patch）。</p><p> diff --git a/node_modules/video-extensions/video-extensions.json b/node_modules/video-extensions/video-extensions.jsonindex 0ad84d7..a115959 100644 --- a/node_modules/video-extensions/video-extensions.json +++ b/node_modules/video-extensions/video-extensions.json @@ -8,6 +8,7 @@    &#34;drc&#34;,   &#34;flv&#34;,   &#34;m2v&#34;,  + &#34;m3u8&#34;,    &#34;m4p&#34;,   &#34;m4v&#34;,   &#34;mkv&#34;,</p><p> diff --git a / node_modules /视频扩展/视频扩展.json b / node_modules /视频扩展/视频扩展.jsonindex 0ad84d7..a115959 100644 --- a / node_modules / video-extensions /视频扩展。 json +++ b / node_modules /视频扩展/视频 -  extensions.json @@ -8,6 +8,7 @@＆＃34; DRC＆＃34 ;,＆＃34; flv＆＃34 ;,＆＃34 ; M2V＆＃34 ;, +＆＃34; m3u8＆＃34 ;,＆＃34; m4p＆＃34 ;,＆＃34; mkv＆＃34 ;,＆＃34; mkv＆＃34 ;, </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://mmazzarolo.com/blog/2021-06-06-metascraper-serverless-function/">https://mmazzarolo.com/blog/2021-06-06-metascraper-serverless-function/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/刮掉/">#刮掉</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>