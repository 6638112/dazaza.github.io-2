<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Twitter预连接到错误的域名</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Twitter预连接到错误的域名</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-27 18:24:04</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/33d4a851348403cdcf6fe619082b532a.webp"><img src="http://img2.diglog.com/img/2020/10/33d4a851348403cdcf6fe619082b532a.webp" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Twitter tried to reduce load times for external links, but it made things slower instead. It mistakenly normalizes domain names to a point where they’re no longer can be used to fulfill their task.</p><p>Twitter试图减少外部链接的加载时间，但它反而让速度变慢了。它错误地将域名正常化到无法再用于完成其任务的程度。</p><p>  I’ve previously written about  when to use  &lt;link rel=&#34;preconnect&#34;&gt;. That article also serves as an introduction if you’re unfamiliar with the topic.</p><p>我以前写过关于何时使用&lt；link rel=&#34；preconnect&#34；&gt；的信息。如果您不熟悉这个主题，那篇文章也可以作为介绍。</p><p>    Twitter redirects links through its  t.co link-shortening service. It was once a useful addition to its service as it helped people stay underneath the strict character limits. The link shortener reduced all links to 23 characters. Twitter gains some more data-insights about its users in the form of click-stream data and insight into popular links.</p><p>Twitter通过其t.co链接缩短服务重定向链接。它曾经是其服务的有用补充，因为它帮助人们保持在严格的性格限制之下。链接缩短器将所有链接减少到23个字符。Twitter通过点击流数据和对热门链接的洞察，获得了更多关于其用户的数据洞察力。</p><p>  However, the link shortening service has another cost: links resolve slower. Instead of clicking-through directly to the destination website, the browser needs to connect to Twitter’s link-shortening service and then follow a redirect to the destination website. To speed up the process, Twitter preconnects to its link-shortening service every time you scroll a link card into view. Link cards are boxes that show an image, title, and description of a link. This shows that Twitter finds it highly likely that people will click on external links in tweets.</p><p>然而，链路缩短服务还有另一个代价：链路解析速度较慢。浏览器需要连接到Twitter的链接缩短服务，然后重定向到目标网站，而不是直接点击进入目标网站。为了加快这一过程，每当你将链接卡滚动到视图中时，Twitter都会预先连接到它的链接缩短服务。链接卡是显示链接的图像、标题和描述的框。这表明Twitter发现人们极有可能点击推文中的外部链接。</p><p>  To speed things up even further, Twitter also preconnects to the destination website at the other end of the redirect. This is where it has made some mistakes, though.</p><p>为了进一步加快速度，Twitter还预先连接到重定向另一端的目的地网站。不过，这就是它犯了一些错误的地方。</p><p>  You may be wondering why it’s even using the link-shortening service anymore if it already knows the destination address. Reread the previous paragraph for clarification on Twitter’s motivations.</p><p>您可能会想，既然它已经知道目的地址，为什么还要使用链接缩短服务。重读上一段，以澄清Twitter的动机。</p><p>  Before I go on to discuss the issues, I have to talk a little bit about privacy. Preconnects doesn’t transmit any HTTP headers, cookies, or other identifying data. The destination website doesn’t have any idea why the client opened a connection to it at this point. It has just opened a connection and is waiting for a request to come in. Its servers can identify the TLS library and version used to establish the connection, but this is in no way unique data. A third-party that can observe the relevant network traffic will know that the user either tried to connect to or saw a link to the domain name or server in question.</p><p>在我继续讨论这些问题之前，我必须先谈一谈隐私问题。预连接不传输任何HTTP标头、Cookie或其他标识数据。目标网站不知道客户端为什么在这一点上打开到它的连接。它刚刚打开了一个连接，正在等待传入的请求。它的服务器可以识别用于建立连接的TLS库和版本，但这绝不是唯一的数据。可以观察到相关网络流量的第三方将知道用户试图连接到或看到与所讨论的域名或服务器的链接。</p><p>  That being said, Twitter will often preconnect to the wrong website. As an example, let’s look at the tweets by  @CtrlBlog and @nytimes. The links shared by these accounts link to the domains  www.ctrl.blog and  www.nytimes.com. Instead of preconnecting here, Twitter preconnects to  ctrl.blog and  nytimes.com. These connections are, of course, made to the wrong server so they’ll never be used.</p><p>也就是说，Twitter经常会预先连接到错误的网站。作为示例，让我们看看@CtrlBlog和@nyTimes发布的tweet。这些帐户共享的链接链接到www.ctrl.blog和www.nytimes.com域。Twitter没有在这里预先连接，而是预先连接到ctrl.blog和nytimes.com。当然，这些连接连接到错误的服务器，因此它们永远不会被使用。</p><p>  Strangely enough, tweets posted through Twitter Advertising (whether you see that tweet as an advert or not) don’t have this problem. These tweets don’t use  t.co and always preconnect to the right server (in addition to also preconnecting to the wrong server).</p><p>奇怪的是，通过Twitter Advertising发布的推文(不管你是否将该推文视为广告)没有这个问题。这些tweet不使用t.co，总是预先连接到正确的服务器(除了预先连接到错误的服务器之外)。</p><p>    The incorrect domain name used for the preconnect seems to originate from the display URL property of Twitter’s API. It strips out the  www. prefix to make a ”display version“ of the URL. I have no problem with this, as the prefix is entirely meaningless to humans. It does serve important technical functions, however. Twitter doesn’t remove it from the actual redirect URL.</p><p>用于预连接的不正确域名似乎源自Twitter API的显示URL属性。它把万维网去掉了。前缀以生成URL的“显示版本”。我对此没有问题，因为前缀对人类来说是完全没有意义的。然而，它确实具有重要的技术功能。Twitter不会将其从实际的重定向URL中删除。</p><p>  Let us look in more detail what happens when a user clicks on a link and when the browser gets to use the preconnection.</p><p>让我们更详细地了解当用户单击链接以及浏览器开始使用预连接时会发生什么。</p><p>  Firstly, the browser now needs to resolve the domain name including the  www. prefix. Secondly, the browser needs to establish a TCP connection and set up a TLS connection. All these steps would be done already had Twitter only connected to the correct domain in the first place.</p><p>首先，浏览器现在需要解析包括www的域名。前缀。其次，浏览器需要建立TCP连接并建立TLS连接。如果Twitter一开始只连接到正确的域，那么所有这些步骤都已经完成了。</p><p>  It’s difficult to say exactly when this issue began. I can’t look at older versions of Twitter, as its pages don’t work well in the Internet Archive’s Wayback Machine. Come to think of it, should Twitter be preconnecting to all these websites in the first place?</p><p>很难说这个问题是什么时候开始的。我不能看老版本的Twitter，因为它的页面在互联网档案馆的Wayback机器上不能很好地工作。想想看，Twitter应该从一开始就预先连接到所有这些网站吗？</p><p>  In my article  on when to use  &lt;link rel=&#34;preconnect&#34;&gt;, I discuss the situations where it’s beneficial to use the preconnect technique. I agree with Twitter that it’s likely to be useful to preconnect to the destination address in some situations. E.g. when the Twitter message or link card is the only thing on the page, or you’ve stopped scrolling and have it visible for a split second or two.</p><p>在我关于何时使用&lt；link rel=&lt；link rel=&lt；preconnect&#34；&gt；的文章中，我讨论了使用预连接技术有益的情况。我同意Twitter的观点，在某些情况下，预连接到目的地地址可能会很有用。例如，当Twitter消息或链接卡是页面上唯一的东西时，或者当您停止滚动并使其在一两秒钟内可见时。</p><p>  However, Twitter indiscriminately preconnects to every link that you scroll by in your feed. Technically, it only preconnects when you hover over the link. However, you hover over every link by default as you hold your mouse cursor over the main feed and scroll downwards. Depending on the link-sharing habits of those you follow, that number of preconnects adds up quickly. This can slow down your browsing experience in slow network conditions or on low-end devices.</p><p>然而，Twitter不分青红皂白地预先连接到您在提要中滚动的每个链接。从技术上讲，只有当您将鼠标悬停在链接上时，它才会预连接。但是，默认情况下，当您将鼠标光标放在主提要上并向下滚动时，您会将鼠标悬停在每个链接上。根据你关注的人的链接共享习惯，预连接的数量很快就会增加。这可能会降低您在网络速度较慢或低端设备上的浏览体验。</p><p>  Properly testing preconnection behavior requires specialist tools and skills. The developer tools in web browsers don’t do a good job with preconnects. They’re not even recorded in the Network tab. Safari displays a message for each preconnect and warns of unused preconnect in its Console tab.</p><p>正确测试预连接行为需要专业工具和技能。Web浏览器中的开发人员工具在预连接方面做得不好。它们甚至没有记录在网络选项卡中。Safari为每个预连接显示一条消息，并在其控制台选项卡中警告未使用的预连接。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.ctrl.blog/entry/twitter-preconnects.html">https://www.ctrl.blog/entry/twitter-preconnects.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/域名/">#域名</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/错误/">#错误</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/twitter/">#twitter</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>