<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>从Redux学习FP设计</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">从Redux学习FP设计</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-04 14:18:02</div><div class="page_narrow text-break page_content"><p>在我将目光投向Redux源代码之前，我天真地认为OOP作为一种编程范例要优于FP(函数式编程)。但这是不对的。众所周知，FP致力于形成一个易于理解和清晰的工作流，而不是那些晦涩抽象的对象和关系。它更接近人类的程序性思维方式。</p><p>现在，Reaction已经有了钩子，可以在没有Redux的情况下正确处理&#34；States&#34；事件。Redux的需求可能正在下降，但它的代码库仍然值得学习。特别是对于那些想要在函数式编程方面启发自己的人。所以，我想向一个好榜样学习从来都不是一个坏主意，即使它已经过时了(一点也不)。</p><p>当我开始阅读Redux源代码时，我立即感受到了我熟悉的编程语言的这种陌生用法的力量。感觉就像是用火炬照亮了壁画，探索了一个古老的洞穴，发现了这个伟大的秘密。</p><p>为了更多地了解Redux从FP中获得的好处，我研究了Redux源代码并创建了它的迷你版。</p><p>从上面的图表中，很容易找到关键字：动作存储、缩减器、查看、订阅和分派。下一步就是处理好这些关键字之间的关系。</p><p>FP在将功能结合在一起方面做得很好，没有副作用。返回值是一致的，这使得程序在执行期间或执行后的返回是可预见的。</p><p>OOP建立了一个坚实的结构，它定义了数据模型应该包含的所有属性。它使得修改或配置数据模型变得很容易。</p><p>在Redux中，Reduer和中间件通常只定义一次。这意味着，我们不需要更新这些属性的能力，也不希望它们在运行时被更改。至于FP方法，它利用闭包技术，消除了暴露内部属性的可能性。加上一些非常棒的FP技术(咖喱、作曲、管道)，它甚至使程序比面向对象的程序更具人类可读性。</p><p>我想说FP应该是最适合这种情况的。当然，我在这里谈论的FP远不是像Haskell那样的真正的函数式编程。但至少在Javascript中使用FP技术的想法是可以遵循的。</p><p>在Redux中，根本没有类(在早期版本中，它曾经基于Class)。它的所有核心API都返回值或函数(函数工厂)。这正是FP期望函数的行为：</p><p>为了简单地解释Redux设计，我只实现了上面API的最核心部分。由于最新版本的核心概念没有太大变化，所以我基于非常原始的Redux v1.0.1版本编写了源代码。因为我相信第一个相关的版本会是最全面的。</p><p>CreateStore定义了那些可以在组件内使用的API。它更像是二传手和吸气球。</p><p>EXPORT DEFAULT Function createStore(Reducer，Enhener){if(Enhener){Return Enhener(CreateStore)(Reducer)；}let currentstate；//Redux现在通过`ensureCanMutateNextListeners()`使用一个浅拷贝`nextListeners`//以防止`Dispatch`let currentListeners=[]；函数getState(){return currentstate；}//注册更改后执行的回调。Push(Listener)；return()=&gt；{//空监听器const index=currentListeners。IndexOf(侦听器)；currentListeners。Splice(index，1)；}；}函数调度(Action){currentstate=Reducer(currentstate，action)；//状态改变，通知调用回调currentListeners。ForEach(listener=&gt；listener())；}//调用虚拟Reducer调度初始化Redux({type：&#34；my-mini-Redux&#34；})；return{getState，Dispatch，Subscribe}；}。</p><p>//这只是一个通过对象函数mapValues(obj，fn){return映射的助手函数。密钥(Obj)。Reduce((result，key)=&gt；{result[key]=fn(obj[key]，key)；return result；}，{})；}导出默认函数组合Reducers(Reducers){返回函数组合(state={}，action){//官方Redux使用`ick`过滤还原器。//让&#39；的信任减少器是函数，此处返回mapValues(Reducers，(Reducer，Key)=&gt；Reducer(state[key]，action))}；}。</p><p>我个人认为applyMiddleware API是Redux最令人惊叹的部分。它提供了应用第三方插件的最佳解决方案。</p><p>在我的理解中，源代码中的FP组成符合数学的结合律。</p><p>(x∗(y∗z))=x∗y∗z。</p><p>ApplyMiddleware的使用实际上是管道的一种形式，它允许我们注入返回商店对象的增强函数。它非常类似于面向方面的编程，最典型的例子是注释/装饰器。</p><p>//组合函数//a(b(c()=&gt；Compose(a，b，c)函数Compose(...funcs){return函数。ReduceRight((Composed，f)=&gt；f(Composed))；}导出默认函数applyMiddleware(...中间件){return Next=&gt；(Reducer，initialState)=&gt；{const store=Next(Reducer，initialState)；let调度=存储。调度；常量中间件API={getState：store。GetState，Dispatch：Action=&gt；Dispatch(Action)}；const chain=中间件。Map(MIDDLEWARE=&gt；MIDDLEWARE(MIDDLEWARE API))；//通过对`Dispatchers`分别应用中间件Dispatch=Compose(...chain，store)来增强`Dispatchers`。派单)；返回{...存储，派单}；}；}。</p><p>有一些著名的REDUX中间件，如REDUX-THUNK和[REDUX-LOGGER(https://github.com/LogRocket/redux-logger).。这些都是使用applyMiddleware API增强功能的很好的示例。此外，他们的代码库小得惊人。核心部分只有几行代码。</p><p>当我需要在代码块中使用其他上下文时，这非常有用。在上述示例中，很容易发现NEXT和ACTION作为上下文传入，以帮助处理一些复杂的情况。</p><p>Redux-thunk允许将函数用作分派参数，这样我就可以在分派之前做一些事情。</p><p>//没有redux-thunk分派({type：&#39；action&#39；，payload：&#39；value&#39；})//有redux-thunk//分派由新的函数分派(Function(Dispatch，getState){.。日志(&#39；redux-thunk&#39；)派单({type：&#39；action&#39；，payload：&#39；value&#39；})})。</p><p>//允许传递函数调度导出默认函数thunk({Dispatch，getState}){return Next=&gt；action=&gt；{if(typeof action=&#34；function&#34；){return action(Dispatch，getState)；}return Next(Action)；}；}</p><p>//在控制台导出默认函数记录器({getState}){return Next=&gt；action=&gt；{中输出前一个和当前状态。LOG(&#34；=Redux Logger=&#34；)；。日志(&#34；操作类型：&#34；，操作。Type)；const premisState=getState()；。Log(&#34；prev：&#34；，prevState)；const rereturn Value=Next(Action)；const nextState=getState()；。LOG(&#34；NEXT：&#34；，nextState)；。日志(&#34；=&#34；)；return rereturn Value；}；}。</p><p>我实现了迷你版的redux和一个小的计数器应用程序来演示这些功能。应用程序将执行四个算术运算：加、减、乘和除。点击操作按钮后，数字将会更改。同时，乘除法将有300ms&#39；延迟，这是由自定义中间件实现的(一个迷你重复数据备份)。</p><p>该应用程序有一个子组件：MiniReduxComp。在我的Mini-Redux中，我没有创建上下文提供程序来触发更新。相反，我订阅了组件中的存储更改，并执行forceUpdate以响应更改。</p><p>IMPORT，{}FROM&#39；REACT&#39；；IMPORT STORE FROM&#39；../STORE&#39；EXPORT默认类扩展{ComponentDidMount(){this。取消订阅=存储。订阅(()=&gt；这个。ForceUpdate())；}ComponentWillUnmount(){this。取消订阅此内容(&amp；&amp；)。取消订阅()；}PLUS=()=&gt；存储。派单({type：&#34；加&#34；})减去=()=&gt；存储。派单({type：&#39；减去&#39；})乘以=()=&gt；存储。Dispatch((Dispatch，getState)=&gt；{setTimeout(()=&gt；{Dispatch({type：&#39；Multiply&#39；})}，300)})Divide=()=&gt；存储。Dispatch((Dispatch，getState)=&gt；{setTimeout(()=&gt；{Dispatch({type：&#39；Divide&#39；})}，300)})Render(){Return(加/减1{存储。GetState()。计数}+1-1乘/除2(0.3s延迟){存储。GetState()。Double}x2/2)；}}。</p><p>我认为在现代Web开发中，OOP仍然是主流。然而，我们可以看到，有一些开放源码项目混合了编程范例，并交付了非常合格的框架(例如，nest.js)。多亏了反应社区，计划生育现在是发展必需品的一部分。</p><p>好了，这就是Redux钻探的全部内容。希望您也能对Redux中的FP设计有一个很好的了解。如果你觉得这篇文章很棒，请在社交网络上分享。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://pitayan.com/posts/redux-fp-design/?ref=hackernews">https://pitayan.com/posts/redux-fp-design/?ref=hackernews</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/学习/">#学习</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fp/">#fp</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/redux/">#redux</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1016083.html"><img src="http://img.diglog.com/img/2020/8/thumb_299464739eb1dedf5e4b3e8d33531940.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016083.html">美国联邦航空局提议要求对波音737 MAX设计进行四项关键更改</a></div><span class="my_story_list_date">2020-8-4 10:26</span></div><div class="col-sm"><div><a target="_blank" href="/story/1016019.html"><img src="http://img.diglog.com/img/2020/8/thumb_b451a6d1afc8f6f7532c08c30bac4b88.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016019.html">美国联邦航空局提议要求关键的波音737 MAX设计更改</a></div><span class="my_story_list_date">2020-8-4 4:36</span></div><div class="col-sm"><div><a target="_blank" href="/story/1015975.html"><img src="http://img.diglog.com/img/2020/8/thumb_4764311766428da6a05d0320caaff8bd.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1015975.html">维珍银河公布高速旅行的最初车辆设计</a></div><span class="my_story_list_date">2020-8-4 2:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1015930.html"><img src="http://img.diglog.com/img/2020/8/thumb_87f2669170d89a1c30c625f5fce75770.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1015930.html">系统UIcons-专为产品设计的图标，无属性</a></div><span class="my_story_list_date">2020-8-4 0:35</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>