<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>大苏尔错误阻止升级到下一个版本 Big Sur bug prevents upgrades to the next version</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Big Sur bug prevents upgrades to the next version<br/>大苏尔错误阻止升级到下一个版本 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-18 16:08:47</div><div class="page_narrow text-break page_content"><p>If you work with Apple in some capacity, you know that they’re not very likely to admit mistakes. I’m not aware of Apple publishing postmortems after outages or providing details about known issues. So it’s up to the developer and admin communities at large to help each other learn about outages and potential causes. With the release of macOS 11.1 this week I’ve been debugging a new issue with the Mac software update process, one which will affect most enterprise users. I decided I should write about it and let everyone know what the issue is, workarounds, and how to avoid it. I’ve also been paying close attention to some recent changes to the software update mechanism, so I’ll try to mention them below as well.</p><p>如果您以某种身份与Apple合作，您会知道他们不太可能承认错误。我不知道Apple在停机后会发布验尸报告，也没有提供有关已知问题的详细信息。因此，整个开发人员和管理员社区应该互相帮助，以了解停电和潜在原因。在本周的macOS 11.1版本中，我一直在调试Mac软件更新过程中的一个新问题，该问题将影响大多数企业用户。我决定写这篇文章，让大家知道这个问题是什么，解决方法以及如何避免它。我也一直在密切关注软件更新机制的一些最新变化，因此，我也会在下面尝试提及它们。</p><p>  After macOS 11.1 was released earlier this week, many users  started reporting that they were not able to see the software update. Others reported that they saw it, but were not able to download it. I personally experienced this issue when 11.1 was in beta and filed a case with Apple about it, but then moved on to other problems. When the final release came out this week, there were widespread reports of it on the MacAdmins Slack. Reading through system logs, I as well as other admins were able to find what appears to be the root cause.  Under certain conditions, macOS 11.0.1 and macOS 11.1 hosts are requesting the update server send the 11.0.1 update, instead of requesting the next available one. The server rejects this update as it’s already either installed or older. This somehow corrupts the state of the software update process, and the update is no longer visible as an option in System Preferences.</p><p>  在本周早些时候发布macOS 11.1之后，许多用户开始报告他们看不到软件更新。其他人报告说他们看到了，但是无法下载。我个人在11.1测试版中遇到了这个问题，并向Apple提起了诉讼，但随后转到了其他问题。当最终版本于本周发布时，MacAdmins Slack上有关于它的广泛报道。通过阅读系统日志，我以及其他管理员都能找到根本原因。在某些情况下，macOS 11.0.1和macOS 11.1主机正在请求更新服务器发送11.0.1更新，而不是请求下一个可用更新。服务器拒绝此更新，因为它已安装或较旧。这以某种方式破坏了软件更新过程的状态，并且该更新作为“系统偏好设置”中的选项不再可见。</p><p>   The update is visible again immediately after the restart. But it’s unclear if the update can always be installed after it’s visible since the condition that made it fail to download the first time can be triggered again.</p><p>   重新启动后，更新立即再次可见。但目前尚不清楚该更新是否可以始终在可见后安装，因为可以再次触发导致首次下载失败的条件。</p><p> Removing the MDM enrollment profile causes the update to be seen again. I and several others tested this extensively, and it’s definitely the enrollment profile, not some other policy managed by MDM. This is obviously a terrible workaround and I’d hesitate to mention it to users as it could cause security agents to stop working, and countless approval dialogs we’re so familiar with. Not to mention some of you have the MDM enrollment profile as non-removable or users who are not administrators, so they don’t have permission to unenroll. Getting them back enrolled in the MDM might prove to be a challenge too.</p><p> 删除MDM注册配置文件会使更新再次出现。我和其他几个人对此进行了广泛的测试，这绝对是注册资料，不是MDM管理的其他一些政策。这显然是一个糟糕的解决方法，我会犹豫向用户提及它，因为它可能导致安全代理停止工作，以及我们非常熟悉的无数批准对话框。更不用说你们中的某些人具有不可移动的MDM注册资料或不是管理员的用户，因此他们没有取消注册的权限。让他们重新加入MDM也可能是一个挑战。</p><p>  Apple is well aware this is a problem now, so I am confident the issue will be addressed in 11.2. Unfortunately, it is a client-side issue affecting both 11.0.1 and 11.1 clients. So there’s not much Apple  can do to provide a fix. One potential solution I see is for Apple to detect the wrong request and instead of rejecting the download, offer the right file archive instead. But this is a complex system and it’s unclear if the server-side changes alone are enough.</p><p>  苹果公司现在很清楚这是一个问题，所以我相信这个问题将在11.2中解决。不幸的是，这是一个影响11.0.1和11.1客户端的客户端问题。因此，Apple无法提供修复程序。我认为一种潜在的解决方案是让Apple检测到错误的请求，而不是拒绝下载，而是提供正确的文件存档。但这是一个复杂的系统，目前尚不清楚仅服务器端的更改是否足够。</p><p> Something else Apple could try is to side load a patch through another software update. There’s background configuration and malware removal tools that are likely capable of fixing the issue on the system. But it’s an ugly hack and one I’d personally stay clear of even if the option was available.</p><p> 苹果可以尝试的另一种方法是通过另一个软件更新来侧面加载补丁。有后台配置和恶意软件删除工具可能能够解决系统上的问题。但这是一个丑陋的骇客，即使可以使用，我个人也不会这么做。</p><p> In my opinion, the most likely outcome is that the bug will be fixed in 11.2, but clients that have already upgraded to Big Sur (or any M1 macs you might’ve bought) will have to work around the problem themselves. If we’re lucky Apple will publish a support article and that will be that.</p><p> 我认为，最有可能的结果是该错误将在11.2中修复，但是已经升级到Big Sur（或您可能购买的任何M1 Mac）的客户将必须自行解决此问题。如果幸运的话，Apple会发表支持文章。 </p><p>  Big Sur has changed the software update mechanism entirely, especially on Apple Silicon macs. It’s a long time coming and Apple spoke about some of this at WWDC in the MDM and IT sessions, so it shouldn’t be entirely surprising. But a lot was left unsaid for us to discover on our own.</p><p>Big Sur完全改变了软件更新机制，尤其是在Apple Silicon macs上。很长一段时间来了，Apple在WWDC的MDM和IT会议上谈到了其中的一些内容，所以这并不奇怪。但是，还有很多话要说给我们自己去发现。</p><p> Combo update packages are  no longer published on the Apple website. This might surprise many of you who rely on distributing them. The main reason is that the entire format of the updates has changed, and it’s also no longer possible to install updates without the Mac having access to the internet. The updates must come from Apple, and they must be managed by  softwareupdate and related processes on the system.</p><p> 组合更新程序包不再在Apple网站上发布。这可能会让许多依赖分发它们的人感到惊讶。主要原因是更新的整体格式已更改，并且在Mac无法访问互联网的情况下也无法再安装更新。更新必须来自Apple，并且必须由系统上的软件更新和相关进程进行管理。</p><p> On Apple Silicon, third party processes are no longer able to script the  softwareupdate command. Running the software update command as a root process now prompts for the administrator password, who also needs to be a secure token user. There are only two possible options for OS updates to be applied; either the human user of the device itself or the MDM process  which has special permission. It might also be possible for the Mac to update itself with the auto-update mechanism, but there are too many bugs right now to observe how well that works. My personal experience is that it doesn’t and I’m greeted with a password prompt to enter the next day…</p><p> 在Apple Silicon上，第三方进程不再能够编写softwareupdate命令的脚本。现在，以root用户进程运行software update命令会提示您输入管理员密码，该管理员密码也必须是安全的令牌用户。只有两种可能的选项可以应用OS更新；设备本身的人工用户或具有特殊权限的MDM流程。 Mac可能还可以使用自动更新机制进行自我更新，但是目前存在太多错误，无法观察其工作原理。我的个人经历是，没有，我收到密码提示以输入第二天的信息…</p><p> Specifying a custom URL for the  softwareupdate process to pull updates from is no longer possible. Apple advertised this deprecation for all of last year, so it should surprise no one but it hurts.  Reposado was one of several great tools that made it possible to have unstable/beta/stable tracks within an organization.</p><p> 指定用于Softwareupdate流程以从中提取更新的自定义URL不再是可能的。苹果公司在去年全年都在宣传这种贬值的做法，因此它不会让人感到惊讶，但会带来伤害。 Reposado是使组织内具有不稳定/ beta /稳定轨道的几种出色工具之一。</p><p> —ignore is gone as a flag. It  was gone in 10.15.5 briefly too, so you likely know about this one. This time it’s gone for good and never coming back. An MDM server can delay the client from seeing OS updates for up to 90 days only, but that is the absolute maximum going forward. Even for a future major release like macOS 12. If this is important to you, file feedback for Apple to provide a second deferral option, specific to major version numbers.</p><p> —无视作为标志消失了。它在10.15.5中也曾短暂消失过，所以您可能知道这一点。这次它永远消失了，再也不会回来了。 MDM服务器最多可以将客户端的OS更新延迟最多90天，但这是以后的绝对最大值。即使对于像macOS 12这样的将来的主要版本，如果这对您来说很重要，请文件反馈给Apple，以提供第二个推迟选项，特定于主要版本号。</p><p> I work with the MDM protocol a lot day-to-day and have been  testing software updates for a while. I was even  optimistic about what it would look like in Big Sur back in June. Apple had promised it’s an entirely new implementation, closer to what is available on iOS and that everything would work better than before. But we’re not off to a good start, and all the concerns I had for several years now are back. The  design of OS updates in MDM is brittle, requiring multiple remote procedure calls to accomplish something that was previously done by a few lines of shell scripting. And that would be bad on its own, but the bad design is coupled with a buggy implementation; there are many known issues, besides the one I described above. Unless something drastically changes, we’re likely to see many months, if not years of software update bugs that are entirely out of our control.</p><p> 我每天都在使用MDM协议，并且已经测试了一段时间的软件更新。我什至对六月大苏尔州的情况感到乐观。苹果公司曾承诺，这将是一个全新的实现，与iOS上提供的功能更接近，并且一切都会比以前更好。但是我们的开端并不顺利，几年来我一直担心的一切都又回来了。 MDM中的OS更新设计很脆弱，需要多次远程过程调用才能完成以前由几行Shell脚本完成的工作。这本身是不好的，但是糟糕的设计与错误的实现结合在一起。除上述问题外，还有许多已知问题。除非情况发生急剧变化，否则我们可能会看到数月甚至数月的软件更新错误，而这完全是我们无法控制的。</p><p> Apple was never particularly great at building systems for the enterprise. But, until recently, the Unix components were available for software developers and system administrators to work with. The end result ended up being that if you made an investment within your organization, macOS was a great experience for end-users. It took a lot of work, but it was all achievable. Today, Apple is no better at developing systems that are required in the enterprise. But the ball is entirely in their court. Apple still makes great tools for consumers, and there will be a demand from employees to provide them with Apple gear. But, if Apple can’t start acting on our collective feedback, the experience of using a Mac in the workplace will quickly become unbearable to most.</p><p> 苹果公司从来没有特别擅长为企业构建系统。但是直到最近，Unix组件才可供软件开发人员和系统管理员使用。最终结果是，如果您在组织内进行投资，那么macOS对于最终用户而言将是一次很棒的体验。花费了很多工作，但是一切都是可以实现的。如今，Apple在开发企业所需的系统方面并没有更好的表现。但是球完全在他们的球场上。苹果仍然为消费者提供了出色的工具，并且员工会要求为他们提供苹果设备。但是，如果Apple无法根据我们的集体反馈采取行动，那么大多数人将很快无法在工作场所使用Mac。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://micromdm.io/blog/big-sur-softwareupdate/">https://micromdm.io/blog/big-sur-softwareupdate/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/错误/">#错误</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/sur/">#sur</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/apple/">#apple</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>