<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>TLS证书至少有两个时间内容 TLS certificates have at least two internal representations of time</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">TLS certificates have at least two internal representations of time<br/>TLS证书至少有两个时间内容 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-08 12:14:39</div><div class="page_narrow text-break page_content"><p>TLS certificates famously have a validity period, expressed as &#39;notbefore&#39; and &#39;not after&#39; times. These times can have a broad range,and there are some TLS Certificate Authority root certificates thatalready have &#39;not after&#39; times relatively far in the future (as Imentioned  here). All TLS certificates,including CA root certificates, are encoded in  ASN.1. Recently I was both generatinglong-lived certificates and peering very closely into them in anattempt to figure out why my new certificates weren&#39;t working, andin the process of doing so I discovered that ASN.1 has at least tworepresentations of time and what representation a TLS certificateuses depends on the specific time.</p><p>TLS证书着名有一个有效期，表达为＆＃39; andbefore＆＃39;和＃39;不是之后＆＃39;时代。这些时间可以具有广泛的范围，并且有一些TLS证书颁发机构根证明具有＆＃39;不是之后＆＃39;未来相对较远的时间（在这里暗示）。所有TLS证书（包括CA根证书）都在ASN.1中编码。最近，我既是生成的终身证书和凝视着他们在分析中盯着他们，以弄清楚为什么我的新证书Weren＆＃39; t工作，而且我发现了Asn.1至少有时间的逆时针和什么表示TLS证书取决于特定时间。</p><p> Most TLS certificates you will encounter today encode time in what&#39; openssl asn1parse&#39; calls a  UTCTIME. If you have aTLS certificate with a sufficiently far in the future time, it willinstead be represented as what OpenSSL calls a  GENERALIZEDTIME. Somewhat to mysurprise, both of these turn out to be strings under the covers andthe reason that TLS switches from one to the other isn&#39;t what Ithought it was. I&#39;ll start by showing the encoding for a not beforeand a not after date (and time) for a certificate I generated:</p><p> 大多数TLS证书您今天将遇到编码时间＆＃39; opensslasn1parse＆＃39;打电话给一个utctime。如果您在未来的时间具有足够远的ATLS证书，则它将表示为OpenSSL调用概括的时间。有些对mysurprise，这两种都在封面下串起，并且TLS从一个到另一个的原因是它的原因。我＆＃39; ll首先显示一个不是在我生成的证书的日期（和时间）之后的Not Beforeand A的编码：</p><p>  This certificate is valid from 2021-05-31 19:40 UTC to 2061-05-2119:40 UTC. The Z says this is in UTC, the &#39;194026&#39; is 19:40:26, andthe &#39;0531&#39; and &#39;0521&#39; are the month and day. The difference betweenthe two time formats is at the front; the UTCTIME starts with &#39;21&#39;while the other starts with &#39;2061&#39;.</p><p>  此证书有效期为2021-05-31 19:40 UTC至2061-05-2119：40 UTC。 Z表示这是在UTC，＆＃39; 194026＆＃39;是19:40:26，＆＃39; 0531＆＃39;和＃39; 0521＆＃39;是月份和日子。两次格式的差异在前面; utctime从＆＃39; 21＆＃39开始;而另一个开始与＃39; 2061＆＃39;</p><p> When I started looking into the details of this, I assume that thechoice between one or the other form was because of  the year 2038problem. This isnot the case, since UTCTIME is not represented as any sort of Unixepoch timestamp and has no such limits. Instead, UTCTIME&#39;s limitationis that it only uses a two-digit year. As covered in  RFC 5280, if the two yeardigits are 00 to 49, the year is 20yy, and for 50 to 99, it is 19yy.This means that a UTCTIME can only represent times up to the endof 2049. The certificate I generated is valid past that, so it mustuse the more general version.</p><p> 当我开始研究这个细节时，我假设其中一个或其他形式之间的神奇是因为2038个问题。这是这种情况，因为utctime没有表示为任何类型的Unixepoch时间戳，并且没有这样的限制。相反，utctime＆＃39;■仅使用两位数的年份。如RFC 5280所涵盖的，如果两个vAsigits是00到49，那么年份为20岁，并且50到99，它是19岁。这意味着utctime只能代表2049年的终点。我生成的证书是有效的过去，因此它消防更多的普通版本。</p><p> In theory, all code that deals with TLS certificates should be ableto deal with both forms of time. This is a low level concern thatthe ASN.1 parsing library should normally hide from programs, andboth forms have been valid since  RFC 2459 from 1999. Inpractice, I suspect that there&#39;s almost no use of the second timeformat in certificates today, so I suspect that there&#39;s at leastsome software that mishandles them. For general use, we have yearsto go before this starts to be an issue (starting with CA rootcertificates that push their expiry date into 2050 and beyond).</p><p> 理论上，处理TLS证书的所有代码都应与两种形式的时间交易。这是一个低级担心，ASN.1解析库通常应该从计划中隐藏，因此自1999年的RFC 2459自RFC 2459自1999年以来一直有效。我怀疑今天几乎没有使用第二次TimeFormat，所以我怀疑那里的至少一些软件，可以解释它们。对于一般使用，我们在这开始成为一个问题之前，我们已经走了（从CA Rocifificates开始将其到期日为2050及以后）。</p><p> For  our own use, I think I&#39;mgoing to limit certificate validity to no later than 2049. The morecautious approach is to assume that there&#39;s a Unix timestamp somewherein the chain of processing things and stick to times that don&#39;t gobeyond the  year 2038boundary.</p><p> 为了我们自己的用途，我认为我＆＃39;日后将证书有效限制在2049年。潮流性的方法是假设在某个地方的＆＃39; Sa Unix时间戳以达到加工的东西和粘附在不时的时间; T Gobeyond 201038北部。</p><p> (I think that these are the only two ASN.1 time representationsthat are considered valid in TLS certificates on the Internet, butI haven&#39;t carefully gone through the RFCs and other sources ofinformation to be sure. SO I&#39;m being cautious and saying that TLScertificates have &#39;at least&#39; two representations of time.)</p><p> （我认为这些是唯一的两个ASN.1时间代表在互联网上的TLS证书中被认为是有效的，但是仔细完成了RFC和其他信息来肯定。所以我＆＃39; m是谨慎，并表示TLOFERICES有＆＃39;至少＆＃39;两个时间的表示。） </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://utcc.utoronto.ca/~cks/space/blog/tech/TLSTimeRepresentations">https://utcc.utoronto.ca/~cks/space/blog/tech/TLSTimeRepresentations</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/tls/">#tls</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/证书/">#证书</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>