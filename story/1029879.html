<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>文档驱动的API开发：什么是文档驱动的开发，您是如何实现的，以及</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">文档驱动的API开发：什么是文档驱动的开发，您是如何实现的，以及</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-20 02:25:08</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/cc0a2cc36c57e3449faf2b6a5bc9f6c6.png"><img src="http://img2.diglog.com/img/2020/10/cc0a2cc36c57e3449faf2b6a5bc9f6c6.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>文档驱动开发是一种API开发方法，您首先编写文档，然后根据规范实现API。如果您的系统中有API的任何客户端(例如前端应用程序)，那么您也可以根据规范来实现它们。此方法通常也称为API优先。</p><p>经常有这样的想法，即API更改应该由后端驱动，并且后端可以随时更改API，然后API客户端(例如前端应用程序)必须遵守对后端所做的任意更改。</p><p>许多开发人员认为，在实现后端API之前，您不能开始在API客户端(例如前端应用程序)上工作。事实并非如此：如果您先编写文档，那么客户端应用程序和API服务器都可以同时实现。</p><p>然而，当涉及到API时，并不是所有东西都算作文档。API必须以标准格式(如OpenAPI)记录，这样我们才能利用文档驱动开发的好处。我见过很多团队使用Confluence、Google Docs、Sharepoint、Dropbox Papers等工具记录他们的API。这不起作用，因为我们无法从它们生成标准规范，以便与其他工具结合使用来测试我们的API实现。</p><p>这在实践中是如何运作的呢？它到底有没有好处呢？我将向您展示如何实践文档驱动的开发，以使用Flask开发REST API。对于任何其他类型的API，该方法都是相同的，并且它可以与任何其他框架一起使用。</p><p>我们将实现一个简单的API来管理待办事项列表。待办事项的架构将具有以下属性：</p><p>创建的属性ID将由后端设置，因此对于API客户端是只读的。属性TASK表示必须完成的任务，而STATUS属性表示任务的状态，并且只能采用枚举值之一。为了最佳实践和可靠性，我们将使包含模式中未列出的任何属性的任何请求无效。</p><p>/TODO表示待办事项的集合，我们将使用它来获取待办事项列表并创建新的待办事项。我们将使用/todo/{item_id}来管理特定任务，并使用它来检索、更新和删除特定任务的详细信息。</p><p>现在我们已经完成了设计API的过程，在开始实现之前，让我们先对其进行文档记录！</p><p>我在开始时提到过，我们将实现REST API，所以我们将使用OpenAPI来记录它。创建一个名为oas.yaml的文件，并向其中写入以下内容：</p><p>Openapi：3.0.3信息：标题：TODO API描述：允许您管理待办事项列表版本的API：1.0.0路径：/TODO/：Get：Summary：返回待办事项列表响应：&#39；200&#39；：描述：JSON任务数组内容：Application/json：Schema：Type：Array Items：$ref：&#39；#/Components/Schemas/GetTaskSchema&#39；发布：摘要：创建任务请求Body：Required：True Content：Application/Json：Schema：$ref：&#39；#/components/schemas/CreateTaskSchema&#39；响应：&#39；201&#39；：描述：创建的任务内容的Json表示形式：Application/Json：Schema：$ref：&#39；#/Components/Schemas/GetTaskSchema&#39；/todo/{item_id}：参数：-in：路径名：item_id必填：true schema：type：string format：uuid get：Summary：返回任务的详细信息响应：&#39；200&#39；：描述：任务内容的JSON表示形式：application/json：schema：$ref：&#39；#/Components/Schemas/GetTaskSchema&#39；&#39；404&#39；：$ref：&#39；#/Components/Responses/NotFound&#39；PUT：摘要：更新现有任务请求Body：Required：True Content：Application/Json：Schema：$ref：&#39；#/components/schemas/CreateTaskSchema&#39；Responses：&#39；200&#39；：描述：任务内容的Json表示形式：Application/Json：Schema：$ref：&#39；#/Components/Schemas/GetTaskSchema&#39；&#39；404&#39；：$Ref：&#39；#/Components/Responses/NotFound&#39；删除：摘要：删除现有任务响应：&#39；204&#39；：描述：已成功删除资源&#39；404&#39；：$ref：&#39；#/Components/Responses/NotFound&#39；Components：Responses：NotFound：Description：未找到指定的资源。内容：application/json：schema：$ref：&#39；#/Components/Schemas/Error&#39；架构：Error：Type：Object Properties：Code：Type：Number Message：Type：String Status：Type：String CreateTaskSchema：Type：Object Required：-任务添加属性：FALSE属性：STATUS：TYPE：String枚举：-PENDING-PROGRESS-COMPLETED DEFAULT：PENDING TASK：TYPE：String GetTaskSchema：TYPE：Object Required：-Created-id-Priority-Status-Task AdditionalProperties：FALSE属性：ID：TYPE：STRING FORMAT：UUID Created：TYPE：INTEGER DESCRIPTION：UNIX时间映射状态格式的日期：类型：字符串枚举：-挂起-进度-已完成任务：类型：字符串。</p><p>既然我们已经有了API规范，我们就可以开始实现API服务器了。如果您使用的另一个团队必须实现API的客户端应用程序(如前端应用程序)，请确保中心位置(如GitHub存储库或URL端点)的所有团队都可以使用API规范。稍后我会再写一篇文章来说明你是如何做到这一点的。</p><p>要实现该API，我们将结合使用Flask和Flask-Smorest。Flask-Smorest是一个rest API框架，它使用棉花糖来验证模式。出于说明的目的，我们将保持这一超级简单，整个应用程序将在一个文件中，项目列表将由内存中的列表表示。在真实的应用程序中，您希望使用持久存储，并确保不同的组件进入不同的模块。要使代码正常工作，您需要的唯一依赖项是最平滑的烧瓶，因此请确保安装了它。创建一个名为app.py的文件，并将以下内容复制到其中：</p><p>导入时间从flask导入UUID从flask导入Flask从flask导入MethodView从flask_momoest导入Api，Blueprint，从棉花糖中止导入架构，字段，排除，验证app=Flask(__Name__)app.config[&#39；API_Title&#39；]=&#39；TODO API&#39；app.config[&#39；API_Version&#39；]=&#39；1.0.0&#39；app.config[&#39；OPENAPI_Version&#39；]=&#39；3.0.3&#39；App.config[&#39；OPENAPI_JSON_PATH&#39；]=&#34；API-spec.json&#34；app.config[&#39；OPENAPI_URL_PREFIX&#39；]=&#34；/&#34；app.config[&#39；OPENAPI_SWAGGER_UI_PATH&#39；]=&#34；/docs&#34；app.config[&#39；OPENAPI_SWAGGER_UI_URL&#39；]=&#34；Https://cdn.jsdelivr.net/npm/swagger-ui-dist/&#34；api_title=&#39；api_version=&#39；1.0.0&#39；api=API(APP)类创建任务模式(架构)：类元：未知=排除状态=fields.String(默认值=&#39；待定&#39；，验证=有效.OneOf([&#39；待定&#39；，&#39；进度&#39；，&#39；完成&#39；])，)task=fields.String()class GetTaskSchema(CreateTaskSchema)：Created=fields.Integer(Required=True)id=fields.UUID(Required=True)Blueprint=Blueprint(&#39；TODO&#39；，&#39；TODO&#39；，url_prefix=&#39；/TODO&#39；，description=&#39；API</p><p>如果您现在运行它，您将收到一个错误，指出我们需要为/todo/{item_id}URL路径中的item_id参数提供一个示例。您还将看到一些关于规范格式问题的警告，您可以安全地忽略这些警告，因为API规范是有效的(您可以使用如下所示的外部工具进行验证：https://editor.swagger.io/).。让我们继续为item_id添加一个示例：</p><p>/todo/{item_id}：参数：-in：路径名：item_id必填：true schema：type：string format：uuid示例：d222e7a3-6afb-463a-9709-38eb70cc670d...。</p><p>如果现在再次运行Dredd，将会有5个测试通过，3个失败。如果仔细观察这些故障，您会发现所有这些故障都与/todo/{item_id}URL路径下的现有资源上的操作相关。看起来Dredd正在选择我们在规范中提供的示例ID，并期望存在具有该ID的资源。显然，在我们开始运行API之前不存在任何资源，因此我们希望Dredd首先使用post/todo/实际创建一个资源，获取创建的资源的ID，并使用它测试/todo/{item_id}URL路径下的端点。我们该怎么做呢？使用Dredd钩子！</p><p>Dredd钩子提供了一个简单的接口，允许用户在事务之前和之后执行操作。每个事务都由“名称”标识，“名称”是唯一标识操作的不同参数的组合。要列出规范中的所有可用名称，请运行以下命令：</p><p>我们需要/todo/{item_id}URL路径下成功操作的名称，即返回200和204等成功状态代码的操作(即不返回404的操作)。创建一个名为hooks.y的文件，并将以下内容复制到其中：</p><p>Import json import Dredd_Hooks Response_Stash={}@Dredd_Hooks.After(&#39；/TODO/&&gt;；创建任务&&gt;201&&gt;应用程序/json；)定义SAVE_CREATED_TASK(TRANSACTION)：RESPONSE_PAYLOAD=transaction[&#39；results&#39；][&#39；fields&#39；][&#39；body&#39；][&#39；values&#39；][&#39；actual&#39；]task_id=json.load(Response_Payload)[&#39；id&#39；]response_stash[&#39；Created_task_id&#39；]=task_id@Dredd_hooks.Being(&#39；/todo/{item_id}&gt；)返回任务&gt；200&gt；应用程序/json&#39；)def BEVER_GET_TASK(Transaction)：Transaction[&#39；fullPath&39；]=&#39；/todo/&#39；+response_stash[&#39；created_task_id&#39；]@dredd_hooks.Being(&#39；/todo/{item_id}&gt；)更新现有任务&gt；200&gt；应用程序/json&#39；def PUT_TASK(TRANSACTION)：transaction[&#39；fullPath&#39；]=&#39；/todo/&#39；+response_stash[&#39；Created_task_id&#39；]@Dredd_hooks.pre(&#39；/TODO/{Item_id}&gt；删除现有任务&gt；204&#39；)def BEFORE_DELETE_TASK(TRANSACTION)：TRANSACTION[&#39；fullPath&#39；]=&#39；/TODO/&#39；+response_stash[&#39；CREATED_TASK_ID&#39；]。</p><p>我将在另一个教程中详细介绍Dredd和Dredd Hooks。您可以使用以下命令通过这些挂钩运行Dredd：</p><p>对，所以现在我们可以确定我们的API实现符合规范。如果另一个开发前端应用程序的团队也进行了类似的测试，我们可以相当肯定的是，服务器和前端应用程序都会很好地集成在一起，并且没有错误。或者至少我们不会因为不符合API而遇到集成错误。</p><p>现在假设我们想要更改API。随着时间的推移，我们希望能够为每项任务分配优先级。这将在任务资源有效负载中产生一个称为“优先级”的新字段，该字段可能具有下列值之一：</p><p>我们应该如何对待这一变化呢？我们正在实践文档驱动的开发，所以首先我们将更改规范。一旦我们更新了规范，我们就可以同时更改后端和前端。对后端API的任何不符合规范的更改都将导致测试失败，不应该发布。</p><p>..。CreateTaskSchema：Type：Object Required：-Task AdditionalProperties：False属性：Priority：Type：String enum：-Low-Medium-High Default：Low Status：Type：String Enum：-Pending-Progress-Completed Default：Pending Task：Type：String GetTaskSchema：Type：Object Required：-Created-id-Priority-Status-Task AdditionalProperties属性：False属性：ID：Type：String Format：UUID Created：Type：Integer Description：日期格式为UNIX时间映射优先级：TYPE。用法：string枚举：-低-中-高默认：低状态：type：string枚举：-挂起-进度-已完成任务：type：string。</p><p>类CreateTaskSchema(Schema)：class Meta：UNKNOWN=排除优先级=fields.String(默认=&#39；低&#39；，&#39；，验证=validate.OneOf([&#39；低&#39；，&#39；中&#39；，&#39；高&#39；])，)status=fields.String(默认=&#39；等待&#39；，验证=validate.OneOf([&#39；等待&#39；，&#39；进度&#39；，&#39；完成&#39；])，)task=fields.String()类GetTaskSchema(CreateTaskSchema)：Created=fields.Integer(Required=True)id=fields.UUID(Required=True)。</p><p>如果再次运行dredd命令，测试现在通过。在此示例中，更新棉花糖架构足以更新应用程序。在实际的应用程序中，您将把数据持久化到数据库中，并且还需要运行一些迁移来更新模型。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/python-geek/documentation-driven-development-for-apis-what-is-it-how-do-you-do-it-and-why-you-should-do-it-b6ebbf9ba371">https://medium.com/python-geek/documentation-driven-development-for-apis-what-is-it-how-do-you-do-it-and-why-you-should-do-it-b6ebbf9ba371</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开发/">#开发</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/driven/">#driven</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/api/">#api</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1029855.html"><img src="http://img2.diglog.com/img/2020/10/thumb_40462da55165ca9c980a6bad5e066545.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029855.html">OneSignal(消息和推送通知API)正在招聘一名开发者布道者</a></div><span class="my_story_list_date">2020-10-20 1:42</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029825.html"><img src="http://img2.diglog.com/img/2020/10/thumb_22fedbd29ffc1d924d86294131024a84.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029825.html">Haskell Web Framework IHP旨在使Web开发类型安全、简单</a></div><span class="my_story_list_date">2020-10-19 23:23</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029819.html"><img src="http://img2.diglog.com/img/2020/10/thumb_35f8dedac8146a233ece24543050821b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029819.html">为什么到2030年软件开发人员可能会过时</a></div><span class="my_story_list_date">2020-10-19 23:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029798.html"><img src="http://img2.diglog.com/img/2020/10/thumb_acccd87aa2cb01824e8026f000059161.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029798.html">Facebook将Messenger API扩展到Instagram，允许开发人员和企业将Instagram的消息集成到其他应用程序中</a></div><span class="my_story_list_date">2020-10-19 21:47</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>