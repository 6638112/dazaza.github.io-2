<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ruby垃圾收集深潜水：GC :: Internal_Constants </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Ruby垃圾收集深潜水：GC :: Internal_Constants </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-27 09:55:17</div><div class="page_narrow text-break page_content"><p>有一句古老的说，我们可以通过看着他们的垃圾来学习很多人。同样可以对编程语言保持真实。更精确地，我们可以通过查看其垃圾收集来学习很多关于编程语言。这篇文章踢了一系列关于Ruby的GC的帖子（并最终是一本书）。</p><p> 在这里继续（受到宾激般的不是很棒的）隐喻，我们将首先查看ruby垃圾的始终是什么。 Ruby公开GC :: Internal_Constants，因此我们可以看到垃圾收集器中的常量是什么。</p><p>    我们将通过这些常数逐一地进行，并在定义它们时，了解Ruby如何组织内存的更多信息。</p><p>  如上：调试常量对于调试编写Ruby源代码比写Ruby程序更有用。我们运行的每个Ruby程序都有：debug =＆gt;假装，所以我们不必担心它！</p><p> 对于极其好奇的，唯一的方法：debug是true是，如果我们用cppflag设置dgc_debug到true编译红宝石源代码（参见此示例）。但是，由于大多数时候我们没有编译Ruby源代码，它几乎总是是假的。</p><p>  首先要注意的是，所有这些常量的单位都以_size结尾为字节。所以这种常量告诉我们，每个rvalue都是40个字节。</p><p> 整洁的。但是，它引起了问题，什么是rvalue？ rvalue包含有关Ruby对象的基本信息。 rvalues是C结构，这些结构是Ruby对象的各种C表示的工会。 </p><p>作为此信息的一部分，它们要么包含Ruby对象的实际值，或者如果值对于40字节限制，值太大，则它们包含对OS堆中的鼠标堆中的指针。</p><p> （除了小写，带有23个字符或更少的字符串都有存储在RValues内的值，而具有超过23个字符的字符串将其值存储在OS堆上。Pat Shaughneryy有一个有趣的博客文化解释了这种细微博语。）</p><p>  好的，接下来，heap_page_obj_limit。 409是每个堆叠的最大对象数。但是一堆堆，什么是页面？</p><p> Ruby Heap是Ruby的整个对象空间或内存。这是我们所有的rvalues住在哪里。堆被分段为页面。当垃圾收集器需要更多内存时，它不会向操作系统中对每个对象索请求新内存。正如我们上面了解的RVALUE_SIZE所学到的那样，这意味着在40个字节段中请求更多的内存，这将是非常效率的。</p><p> 相反，当堆需要更多内存时，它会要求整个新页面。这些页面每个页面最多包含409个对象。某些页面包含略低于409个对象; Aaron Patterson有一个伟大的博客文章，解释了原因。但是，正如这种常量告诉我们，409是每页对象（或rvalues）的上限。</p><p>  我们现在知道堆和页面，但是什么是位图？嗯，每个Heap_page还具有位图中其对象的表示。每个对象都由一位表示。</p><p> 好的，所以这个位图占用了56个字节的内存。这里的数学检查出来。字节中有8位。这意味着我们的56字节我们可以访问56 * 8 == 448对象，这将安全地涵盖我们想要代表的所有409个对象。 </p><p>但是，我仍然没有回答为什么我们需要这些位图以代表所有对象首先代表所有对象。这与实际算法Ruby用于垃圾收集的算法是一体的。这是一个三色标记和扫描算法。该算法的细节值得他们自己的整个博客帖子中的至少一个。 （当我写的时候，我会在这里将它链接。）现在，您只需相信它是每个页面存在的重要此位图，并且页面内的每个对象都有足够的空间。</p><p>  我必须承认，这个难过我。所以我搜索了Ruby源代码，发现它设置为4，但绝对没有使用变量本身。据我所知，这个值是未使用的。然后，我承诺，深入了解飞机的怀旧谷歌曲。</p><p> 无论如何，回到手头的事情，如果有人知道什么堆血液_bitmap_planes意味着，请告诉我，我很奇怪地学习！我有一个亨希，它是来自旧ruby版本的残余物。</p><p>  最后，我们本身的大小。 16384字节意味着每个页面都超过16kb。这些页面具有带有一些信息的标题，然后是他们的所有rvalues。存储rvalues的空间称为插槽。如此，当我们说堆_page_object_limit是409时，另一个框架的方法是每个页面的最多409个插槽。</p><p> 再次，我们可以在这里检查数学。每个页面都有足够的空间，适用于所有rvalues，以及标题信息的额外额外的空间。我们知道每个页面最多有409个rvalues，每个rvalue都是40个字节。所以409 * 40 == 16,306＆lt; 16384。</p><p>     堆（变量大小）：Ruby的对象空间或内存。 Ruby存储所有页面。</p><p>  页面（〜16 kB）：Ruby Seagents如何堆。堆积包含页面。页面包含至多409个插槽。 </p><p>rvalue（40字节）：Ruby的对象的C表示。 有时包含对象的值，有时包含一个指针到对象在OS堆中生存的指针  这一切都是为了这篇文章！ 正如我之前引用的那样，我将写一些关于垃圾收集的更多信息（博客帖子和一本书!!）。 如果您对以下帖子的跟随和听证有兴趣，请在下面留下您的电子邮件地址。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://jemma.dev/blog/gc-internal">https://jemma.dev/blog/gc-internal</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ruby/">#ruby</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/垃圾/">#垃圾</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/garbage/">#garbage</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1052636.html"><img src="http://img2.diglog.com/img/2021/3/thumb_77bd155648a2c2af8403eb5531f75ba0.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052636.html">在Rails应用程序上添加一个黑暗主题到Ruby </a></div><span class="my_story_list_date">2021-3-16 9:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1052572.html"><img src="http://img2.diglog.com/img/2021/3/thumb_01d715d232891852cc0acba5f8ba946f.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052572.html">Ruby中的一个编程谋杀魔法 </a></div><span class="my_story_list_date">2021-3-16 5:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1050863.html"><img src="http://img2.diglog.com/img/2021/3/thumb_993799b8fea41da52214e37551e2e3fd.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1050863.html">标准Ruby 1.0. </a></div><span class="my_story_list_date">2021-3-7 9:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1048454.html"><img src="http://img2.diglog.com/img/2021/2/thumb_30ba2dafe659b66092df7a85c3f2b45b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1048454.html">基本计算机游戏（移植到C＃，Java，JavaScript，Python，Ruby，VB.NET） </a></div><span class="my_story_list_date">2021-2-19 10:55</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>