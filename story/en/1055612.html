<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为Python项目编写makefiles Writing Makefiles for Python Projects</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Writing Makefiles for Python Projects<br/>为Python项目编写makefiles </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-02 04:38:32</div><div class="page_narrow text-break page_content"><p>I&#39;m a big fan of  Makefiles. Almost all  my side projects areusing them, and I&#39;ve been advocating their usage at work too.</p><p>我是makefiles的一个忠实的粉丝。几乎所有我的侧面项目都是如此，我也在工作中倡导他们的使用。</p><p> Makefiles give your contributors an entry point on how to do certain thingslike, building, testing, deploying. And if done correctly, they can massivelysimplify your CI/CD pipeline scripts as they can often just stupidly call therespective  make targets. Most importantly, they are a very convenientshortcut for you as a developer as well.</p><p> Makefiles为您的贡献者提供有关如何执行某些事情的入口点，建立，测试，部署。如果正确完成，它们可以大量地提取您的CI / CD管道脚本，因为它们通常可以愚蠢地呼叫疑妥。最重要的是，它们是一个非常普通的开发人员也是一个开发人员。</p><p> For Python projects, where I&#39;m almost always using  virtualenvironments, I&#39;ve been using two different strategies for  Makefiles:</p><p> 对于Python项目，其中我几乎总是使用虚拟环境，i＆＃39; ve一直在使用两种不同的makefiles策略：</p><p>    Let&#39;s have a look at a very simple  Makefile that allows for building,testing and releasing a Python project:</p><p>    让＆＃39; s看起来非常简单的makefile，允许建设，测试和发布Python项目：</p><p> all :  lint  test .PHONY :  test test : pytest .PHONY :  lint lint : flake8 .PHONY :  release release : python3 setup.py sdist bdist_wheel upload clean : find . -type f -name *.pyc -delete find . -type d -name __pycache__ -delete</p><p> 全部：棉绒试验。检查：测试测试：Pytest。pytest。leint lint：flake8 .phony：发布发布：python3 setup.py sdist bdist_wheel上载清洁：查找。 -type f-name * .pyc -delete查找。 -type d -name __pycache__ -delete</p><p>  Assuming there is a venv installed already, you have to activate it first andrun the  make commands afterwards:</p><p>  假设已经有一个Venv安装了，您必须首先激活它，然后修整make命令：</p><p>  The downside is of course, that you have to activate the venv for every newshell. Which can get a bit annoying when you spawn a new terminal in  tmux orput  vim into the background to run  make.</p><p>  当然，缺点当然，你必须为每个纽卡来激活venv。当您将TMUX Orput Vim中的新终端生成要运行make时，它会在TMUX Orput vim中生成新终端时有点烦人。 </p><p> Activating the venv inside make will not work, as each recipe runs in its ownshell, moreover each command in each recipe runs in its own shell too. Thereare workarounds for the latter, i.e. using the  .ONESHELL flag, but that doesnot solve the issue of a new shell in each recipe.</p><p>激活内部的Venv将无法正常工作，因为每个配方在其自己的屏蔽中运行，而且每个配方中的每个命令也在其自己的shell中运行。后者对后者的反向方法，即使用.oneshell标志，但不知道每个食谱中的新壳牌的问题。</p><p>  The second approach mitigates for the issue of activating the venv altogether.I&#39;ve borrowed this idea mostly from  makefile.venv and simplified it a lotfor my needs.</p><p>  第二种方法减轻了激活Venv Altogether.i＆＃39的问题。我借用了这个想法大多是从makefile.venv并简化了我的需求。</p><p> # system python interpreter. used only to create virtual environment PY  = python3 VENV  = venv BIN = $(VENV )/bin # make it work on windows too ifeq ($(OS), Windows_NT)  BIN = $(VENV )/Scripts  PY =python endif all :  lint  test $(VENV) :  requirements. txt  requirements- dev. txt  setup. py  $(PY ) -m venv  $(VENV )  $(BIN )/pip install --upgrade -r requirements.txt  $(BIN )/pip install --upgrade -r requirements-dev.txt  $(BIN )/pip install -e . touch  $(VENV ) .PHONY :  test test :  $( VENV )  $(BIN )/pytest .PHONY :  lint lint :  $( VENV )  $(BIN )/flake8 .PHONY :  release release :  $( VENV )  $(BIN )/python setup.py sdist bdist_wheel upload clean : rm -rf  $(VENV ) find . -type f -name *.pyc -delete find . -type d -name __pycache__ -delete</p><p> ＃系统python解释器。仅用于创建虚拟环境py = python3 venv = venv bin = $（venv）/ bin＃使它在windows上工作太多（$（os），windows_nt）bin = $（venv）/ scripts py = python endif全部：棉绒测试$（VENV）：要求。 TXT要求 - 开发。 txt设置。 PY $（py）-m venv $（venv）$（bin）/ pip安装 -  apgrade -r要求.txt $（bin）/ pip安装 -  aupgrade -r要求-dev.txt $（bin）/ pip安装-e。触摸$（venv）.phony：测试测试：$（venv）$（bin）/ pytest .phony：lint lint：$（venv）$（bin）/ flake8 .phony：发布发布：$（venv）$（bin ）/ python setup.py sdist bdist_wheel上载清洁：RM -RF $（VENV）查找。 -type f-name * .pyc -delete查找。 -type d -name __pycache__ -delete</p><p>  Instead of calling just calling  pytest,  flake8 and  python assuming thevenv is already activated or all dependencies are installed on the systemdirectly, we  explicitly call the ones from the venv by prefixing the commandwith the path to the venv&#39;s  bin directory. To ensure the venv exists, eachof the recipes is depending on the  $(VENV) target, which ensures we alwayshave an up-to-date venv installed.</p><p>  假设venvev的Plake8和Python在SystemDirectly上安装了所有依赖关系，而不是调用PyTest，而不是调用PyTest，而不是调用Pytest，而是通过向Venv＆＃39; s bin目录的路径进行前缀，从Venv中显式调用Venv。为了确保Venv存在，食谱的每一个都取决于$（VENV）目标，这确保了我们总安装了最新的VENV。</p><p> This works, because the  . venv/bin/activate-script basically just does thesame: it puts the venv before anything else in your  PATH, therefore eachcall to  python, etc. will find the one installed in the venv first.</p><p> 这是有效的，因为。 Venv / Bin / Activate-Script基本上只是撰写了这个词：它将VENV放在路径中的任何其他东西之前，因此每个都会找到一个在VENV中安装的vent。</p><p>   and don&#39;t deal with venvs directly any more (well, for those simple cases atleast...). If you don&#39;t need to support Windows, you can remove theappropriate block and the  Makefile looks relatively tame, even for peoplethat don&#39;t use  make very often.</p><p>   和Don＆＃39; t＆＃39;直接与Venvs交易（嗯，对于那些简单的案例至少......）。如果你不需要支持Windows，你可以删除TheAppr块，Makefile看起来相对驯服，即使对于Peoplethat Don＆＃39; T使用经常。</p><p>  I think the second approach is more convenient. I&#39;ve used the first approachhappily for years and only learned quite recently about the second one. Ihaven&#39;t really noticed any downsides yet, but I do realize that almost allPython projects with  Makefiles I&#39;ve checked out, seem to prefer the firstapproach. I wonder why that is?</p><p>  我认为第二种方法更方便。我已经使用了第一个接近的几年，并且只有最近就学会了第二个接近。 Ihaven＆＃39; t真的注意到了任何缺点，但我确实意识到几乎allpython项目与makefiles i＆＃39; ve检查出来，似乎更喜欢Therightach。我不知道这是为什么？ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://venthur.de/2021-03-31-python-makefiles.html">https://venthur.de/2021-03-31-python-makefiles.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/项目/">#项目</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/makefiles/">#makefiles</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/venv/">#venv</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>