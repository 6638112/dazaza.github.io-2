<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Plug‘nPwn：Apple T2自动越狱</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Plug‘nPwn：Apple T2自动越狱</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-13 22:12:14</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/eef8cdddf0e62a2971304f7e5e212b94.jpeg"><img src="http://img2.diglog.com/img/2020/10/eef8cdddf0e62a2971304f7e5e212b94.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>对于那些刚刚加入我们的人来说，上周传出了苹果T2安全处理器在最近的Mac上越狱的消息。如果你还没有读过它，你可以在这里了解这个故事，然后在家里用最新版本的checkkra1n亲自体验一下。到目前为止，我们已经声明，您必须将计算机放入DFU，然后才能运行checkkra1n来越狱T2，这仍然是正确的，但是今天我们将介绍一个更换目标Mac的EFI的演示，并发布T2调试界面的详细信息。</p><p>与应用程序开发者不同的是，为了构建自己的产品，苹果必须对核心操作系统进行调试。这就是固件、内核和调试器本身的构建和调试方式。从iPod最早的时候起，苹果就已经为构建他们的产品建造了专门的调试探测器。这些设备是从苹果总部及其工厂泄露出来的，传统上都有与猴子相关的名字，如“孔”、“坎兹”和“黑猩猩”。它们的工作方式是允许通过JTAG和UART访问CPU的特殊调试引脚(对于ARM设备称为串行线调试或SWD)以及其他芯片。JTAG是一种功能强大的协议，允许直接访问设备的组件，访问通常提供绕过大多数安全措施的能力。苹果甚至在一次Blackhat演讲中谈到了他们的调试能力，描述了有效的安全措施。苹果甚至在零售点部署了不同版本的平板电脑，以便维修iPad和Mac电脑。</p><p>另一位硬件黑客和安全研究员拉姆丁·阿明(Ramtin Amin)去年确实致力于创造一种有效的Kanzi电缆的克隆。这与axi0mX的checkm8漏洞相结合，使得iPhone 5s-X能够进行调试。</p><p>其中一个有趣的问题是，Mac如何与英特尔(Intel)CPU(MacOS)和用于DFU的T2(Bridge OS)共享USB端口。这些基本上是机箱内的独立计算机，共享相同的针脚。苹果供应商泄露的MacBook原理图(用部件号和“原理图”快速搜索)，以及对USB-C固件更新有效负载的分析显示，每个端口上都有一个组件，负责为MacBook或连接的设备充电，既负责多路复用(允许端口共享)，也负责终止USB供电(USB-PD)。进一步分析显示，此端口在以下设备之间共享：</p><p>Thunderbolt控制器，允许MacOS将端口用作Thunderbolt、USB3或DisplayPort。</p><p>Intel CPU用于调试EFI和MacOS内核的调试引脚。</p><p>与上述与iPhone相关的文档一样，Mac的调试通道只有在通过T2启用时才可用。*在checkm8漏洞之前，这需要苹果公司专门签名的有效载荷，这意味着苹果公司有一个万能钥匙来调试任何设备，包括生产机器。*多亏了checkm8，任何T2都可以降级，并且可以启用调试功能。不幸的是，英特尔将大量有关迅雷控制器和协议的信息置于保密协议之下，这意味着多年来没有对其进行适当的研究，导致了一系列漏洞。</p><p>考虑到Mac上的USB-C端口有很多功能，有必要向多路复用器指明您还想连接Mac内的哪个设备。USB-C端口规范提供了用于此目的的针脚(CC1/CC2)以及检测电缆方向的功能，从而允许电缆方向是可逆的。在CC引脚的顶部运行另一种低速协议，称为USB-PD或USB Power Delivery。它主要用于协商充电器(源)和设备(接收器)之间的电源要求。USB-PD还允许在所谓的“供应商定义的消息”或VDM中使用任意信息包。</p><p>VDM允许Apple触发操作并指定USB-C连接的目标。“我们发现USB-PD有效负载会导致T2重新启动并使T2保持在DFU状态。将这两个操作放在一起，我们可以使T2重新启动，准备通过checkkra1n越狱，而不需要任何用户交互。虽然我们还没有测试苹果序列号阅读器，但我们怀疑它的工作方式类似，可以可靠地从T2的DFU读取设备ECID和序列号。*Mac还可以与其他设备进行USB-PD通话，例如当iPad Pro在DFU模式下连接时。*苹果需要记录其产品中使用的整套VDM消息，以便消费者了解安全风险。我们发出的一组命令是未经验证的，即使它们是未经验证的，它们也是未经记录的，因此未经审查。*苹果本可以通过要求在这些VDM期间进行一些物理证明(如同时按住电源按钮)来防止这种情况。</p><p>考虑到所有这些信息，我们可以将其串在一起以反映真实世界的攻击。*通过创建一个大约有电源充电器大小的专用设备，我们可以将T2置于DFU模式，运行checkkra1n，更换EFI，并上传一个按键记录器来捕获所有键。*即使MacOS没有更改，这也是可能的(启动时的徽标是有效的，但不需要这样做)。这是因为在Mac笔记本电脑中，键盘直接连接到T2并传递到MacOS。</p><p>PlugNPwn是直接从电缆连接到DFU端口进入DFU的入口(如果它没有显示，则可能是您的广告块：https://youtu.be/LRoTr0HQP1U)。</p><p>在下一个视频中，我们将使用checkkra1n修改英特尔处理器的MacEFI有效负载(同样，广告块可能会导致它不显示https://youtu.be/uDSPlpEP-T0)。</p><p>为了促进对USB-PD安全主题的进一步研究，并允许家庭用户进行类似的实验，我们很高兴地宣布预购我们的USB-PD Screamer。它允许计算机直接对目标设备使用USB-PD。有关更多信息，请单击此处：</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.t8012.dev/plug-n-pwn/">https://blog.t8012.dev/plug-n-pwn/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/npwn/">#npwn</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/调试/">#调试</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1028352.html"><img src="http://img2.diglog.com/img/2020/10/thumb_17e0886fbf12eab8cdacfbe9816a0e86.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028352.html">
点击此处观看苹果发布新款iPhone LIVE</a></div><span class="my_story_list_date">2020-10-13 19:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028327.html"><img src="http://img2.diglog.com/img/2020/10/thumb_8e4d3a134698bfe9a51516c132ea3216.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028327.html">苹果“Hi，Speed”活动的期待：四款新iPhone，采用类似iPad Pro的设计，支持5G、更小的HomePod、耳麦、AirTags等</a></div><span class="my_story_list_date">2020-10-13 19:6</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028321.html"><img src="http://img2.diglog.com/img/2020/10/thumb_67f68fd728cef84b4cebbf9c6dee4792.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028321.html">苹果终端</a></div><span class="my_story_list_date">2020-10-13 15:58</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028308.html"><img src="http://img2.diglog.com/img/2020/10/thumb_44cad0f1c2175a901d556d1c6adda970.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028308.html">苹果、谷歌和亚马逊的网站在1999年是什么样子</a></div><span class="my_story_list_date">2020-10-12 22:9</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>