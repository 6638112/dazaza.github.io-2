<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为什么围棋的错误处理是令人敬畏的</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">为什么围棋的错误处理是令人敬畏的</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-07 20:56:11</div><div class="page_narrow text-break page_content"><p>Go臭名昭著的错误处理引起了外界对该编程语言的相当关注，该语言经常被吹捧为该语言最有问题的设计决策之一。如果您查看任何用Go编写的关于Github的项目，几乎可以保证您会比代码库中的任何其他代码更频繁地看到这些行：</p><p>尽管对于那些刚接触这门语言的人来说，这似乎是多余和没有必要的，但围棋错误被视为一等公民(价值观)的原因在编程语言理论中有着根深蒂固的历史，也是围棋作为一门语言本身的主要目标。为了改变或改进围棋处理错误的方式，人们做出了很多努力，但到目前为止，有一项建议是最成功的：</p><p>Go关于错误处理的哲学迫使开发人员将错误合并为他们编写的大多数函数的一等公民。即使您使用以下命令忽略错误，也是如此：</p><p>大多数LINTER或IDE都会发现您忽略了一个错误，并且您的团队成员在代码审查过程中肯定会看到这个错误。但是，在其他语言中，可能不清楚您的代码是否没有处理try catch代码块中的潜在异常，从而完全不透明地处理您的控制流。</p><p>没有意外的未捕获的异常日志炸毁您的终端(除了通过死机导致的实际程序崩溃)。</p><p>完全控制代码中的错误，将其作为您可以处理、返回和执行任何操作的值。</p><p>函数f()(value，error)的语法不仅容易教给新手，而且是任何围棋项目中确保一致性的标准。</p><p>需要注意的是，Go的错误语法并不强制您处理程序可能抛出的每个错误。GO简单地提供了一种模式，以确保您认为错误对程序流至关重要，但没有太多其他的东西。在程序结束时，如果出现错误，并且您使用err！=nil找到它，并且您的应用程序对此没有采取任何可行的措施，那么无论哪种方式，您都会遇到麻烦-GO不能拯救您。我们来看一个例子：</p><p>如果err：=Critical alDatabaseOperation()；err！=nil{log.。如果err：=saveUser(User)；err！=nil{log.。错误(&#34；无法保存用户：%v&#34；，错误)}。</p><p>如果出现错误，并且在调用Critical alDatabaseOperation()时出现错误！=nil，除了记录错误之外，我们不会对错误执行任何操作！我们可能会遇到数据损坏或无法智能处理的意外问题，无论是通过重试函数调用、取消进一步的程序流，还是在最坏的情况下，关闭程序。围棋并不神奇，也不能把你从这些情况中拯救出来。Go只提供了返回和使用错误作为值的标准方法，但是您仍然需要自己找出如何处理错误。</p><p>在类似Javascript Node.js运行时的环境中，您可以按如下方式构建程序，称为引发异常：</p><p>如果这些函数中的任何一个出现错误，则错误的堆栈跟踪将在运行时弹出并记录到控制台，但没有显式的、程序化的错误处理。</p><p>您的Critical alOperation函数不需要显式处理错误流，因为Try块中发生的任何异常都将在运行时引发，同时还会引发出错的堆栈跟踪。基于异常的语言的一个好处是，与Go相比，即使未处理的异常也会在运行时通过堆栈跟踪引发。在GO中，可能根本不处理关键错误，这可能会更糟糕。Go为您提供了对错误处理的完全控制，但也提供了全部责任。</p><p>对所有返回(value，error)的函数使用简单的if err！=nil代码段有助于确保首先考虑程序中的故障。您不需要纠结于复杂的嵌套try catch块，这些块可以适当地处理引发的所有可能的异常。</p><p>然而，对于基于异常的代码，您必须了解代码在没有实际处理异常的情况下可能出现的每种情况，因为它们将被try catch块捕获。也就是说，它鼓励程序员永远不要检查错误，因为他们知道，如果某些异常发生，至少会在运行时自动处理。</p><p>此代码不会确保正确处理异常。也许让上面的代码意识到异常之间的区别在于切换saveToDB(Item)和item.Text=&#39；价格更改的顺序，这是不透明的，很难推理，并且可能会助长一些懒惰的编程习惯。在函数式编程术语中，这被称为花哨的术语：违反引用透明性。这篇来自微软2005年工程博客的博文至今仍然适用，即：</p><p>我的观点不是说异常不好，我的观点是异常太难了，我还不够聪明去处理它们。</p><p>如果err！=nil，则该模式的超强功能在于它允许简单的错误链遍历程序的层次结构，直到需要处理它们的位置。例如，由程序的主函数处理的常见GO错误可能如下所示：</p><p>[2020-07-05-9：00]错误：无法创建用户：无法检查数据库中是否已存在用户：无法建立数据库连接：没有Internet。</p><p>上面的错误是(A)清楚的，(B)可操作的，(C)对于应用程序的哪些层出错有足够的上下文。我们可以将人类可读的上下文添加到这些因素中，而不是使用不可读的、隐蔽的堆栈跟踪来处理此类错误，并且应该通过如上所述的清晰错误链来处理这些错误。</p><p>此外，这种类型的错误链作为标准围棋程序结构的一部分自然出现，很可能如下所示：</p><p>//在控制器/user.go中，如果err：=database。CreateUser()；err！=nil{log.。Errorf(&#34；无法创建用户：%v&#34；，err)}//在数据库/user.go func CreateUser()错误{if err：=db。SQLQuery(UserExistsQuery)；err！=nil{return fmt。Errorf(&#34；无法检查数据库中是否已存在用户：%v&#34；，err)}.}//在数据库/sql.go函数SQLQuery()错误{if err：=sql。已连接()；err！=nil{返回fmt。错误(&#34；无法建立数据库连接：%v&#34；，err)}.}//在SQL/sql.go函数已连接()错误{if noInternet{返回错误。新建(&#34；没有互联网连接&#34；)}.}。</p><p>上面代码的美妙之处在于，这些错误中的每一个都完全由其各自的功能命名，具有信息性，并且只处理它们所知道的责任。这种使用fmt.Errorf(&#34；Something Worge Error：%v&#34；，err)的错误链接使得构建可怕的错误消息变得微不足道，这些消息可以根据您对错误的定义准确地告诉您哪里出了问题。</p><p>最重要的是，如果您还想将堆栈跟踪附加到您的函数中，您可以利用非常棒的github.com/pkg/error库，它为您提供了如下功能：</p><p>它会打印出堆栈跟踪以及您通过代码创建的人类可读的错误链。如果我能总结一下我收到的关于在Go中编写惯用错误处理的最重要的建议：</p><p>对返回的错误做点什么，不要只是将它们冒泡到main，记录它们，然后忘记它们。</p><p>当我编写GO代码时，错误处理是我从不担心的一件事，因为错误本身是我编写的每个函数的中心方面，让我完全控制如何安全、以可读的方式和负责任地处理它们。</p><p>“如果…。；err！=nil“如果你写go，你可能会打字。我不认为这是好事也不是坏事。它完成了工作，很容易理解，并且它使程序员能够在程序失败时做正确的事情。剩下的就看你的了。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://rauljordan.com/2020/07/06/why-go-error-handling-is-awesome.html">https://rauljordan.com/2020/07/06/why-go-error-handling-is-awesome.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/错误处理/">#错误处理</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/handling/">#handling</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/错误/">#错误</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>