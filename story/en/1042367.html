<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>基于堆栈的虚拟机 Stack Based Virtual Machines</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Stack Based Virtual Machines<br/>基于堆栈的虚拟机 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-29 20:33:05</div><div class="page_narrow text-break page_content"><p>In this series we’re going to delve a bit into stack based virtual machines. First we’re going to see an overview, then we’ll build our own toy VM. Next, we’re going to see how what we’ll build maps to a real CPU. Finally, we’ll discuss the most famous of all: the JVM.</p><p>在本系列中，我们将深入研究基于堆栈的虚拟机。首先，我们将看到概述，然后将构建自己的玩具虚拟机。接下来，我们将了解如何将构建的内容映射到真实的CPU。最后，我们将讨论最著名的：JVM。</p><p>  What’s a  stack based virtual machine then? It’s an abstraction of a computer, that emulates a real machine. Generally it is built as an interpreter of a special  bytecode, that translates its in real time for execution on the CPU.</p><p>  那么什么是基于堆栈的虚拟机？它是对计算机的抽象，它模仿一台真实的计算机。通常，它是作为特殊字节码的解释器构建的，该字节码可以实时转换以在CPU上执行。</p><p> Let’s start with a trivial example: suppose your program needs to add two numbers. To do that in a stack VM, the program will  push the first number to the stack,  push the second and then execute some form of the special instruction  add, that will  pop the first two elements of the stack and replace them with their sum. Let’s see it step by step:</p><p> 让我们从一个简单的示例开始：假设您的程序需要添加两个数字。要在堆栈VM中做到这一点，程序将第一个数字压入堆栈，第二个压入，然后执行某种形式的特殊指令add，这将弹出堆栈的前两个元素并将其替换为它们的总和。让我们一步一步看一下：</p><p>  The  SP is the  stack pointer, which refers to the head of the stack. The  IP is the  instruction pointer, which points to the address of the current instruction to execute. Let’s now execute the first instruction:</p><p>  SP是堆栈指针，它指向堆栈的头部。 IP是指令指针，它指向要执行的当前指令的地址。现在执行第一条指令：</p><p>  You can see that the stack now contains  1 and that the instruction pointer has been moved to the next instruction. Let’s now simulate the second instruction:</p><p>  您可以看到堆栈现在包含1，并且指令指针已移至下一条指令。现在让我们模拟第二条指令：</p><p>    The head of the stack and the previous element have been popped and replaced with their sum.</p><p>    堆栈的开头和上一个元素已弹出，并替换为其总和。</p><p>  As you have seen from the example, the main two data structures for a stack VM are the code listing, with the instruction pointer, and the stack data, which is accessed only via the stack pointer. While these two data structures seem trivial, they are more than enough to implement a lot of complex programs. By adding some external memory area (what is generally known as “memory on the heap”), this structure will become complex enough to form the basis of a real language such as Java or Scala.</p><p>  从示例中可以看到，堆栈VM的主要两个数据结构是带有指令指针的代码清单和仅通过堆栈指针访问的堆栈数据。尽管这两个数据结构看起来微不足道，但它们足以实现许多复杂的程序。通过添加一些外部存储区（通常称为“堆上的内存”），该结构将变得足够复杂以形成诸如Java或Scala之类的真实语言的基础。 </p><p> The stack will be the central structure. From what we hve seen above you should have some idea on how to use it to implement the basic arithmetic, but it is also going to be the basis of implementing loops and conditional execution (if) and even function calls! We’re going to discuss all of this while building our toy VM.</p><p>堆栈将是中心结构。从上面我们已经看到的内容，您应该对如何使用它来实现基本算术有所了解，但是它也将成为实现循环和条件执行（如果）甚至函数调用的基础！我们将在构建玩具虚拟机时讨论所有这些问题。</p><p>  Closely related to stack based VM are  register based virtual machines. They are also interpreters of bytecode, but their design is quite different, since they don’t use the stack for the operands but rather a set of registers. While they tend to be more complex, they are also generally faster at runtime, since they map much more closely to the CPU (which, as we’ll see later, is actually an hardware register machine) and thus they tend to generate and execute better efficient code.</p><p>  与基于堆栈的VM密切相关的是基于寄存器的虚拟机。它们也是字节码的解释器，但是它们的设计有很大不同，因为它们不使用堆栈作为操作数，而是使用一组寄存器。尽管它们往往更复杂，但它们通常在运行时也更快，因为它们映射到CPU的位置更紧密（正如我们将在后面看到的，它实际上是硬件寄存器机器），因此它们倾向于生成和执行效率更高的代码。</p><p> However stack based virtual machines are not just a learning toy. The most successful VM ever, the  Java Virtual Machine, is a stack-based virtual machine (and so is the  CLR, the basis of .NET). Furthermore the JVM is  extremely high performant, while still quite simple - although that has been achieved more by the  immense amount of money that has flown into its development than by some special characteristic of its architecture.</p><p> 但是，基于堆栈的虚拟机不仅仅是学习玩具。有史以来最成功的VM，Java虚拟机是基于堆栈的虚拟机（CLR，.NET的基础也是如此）。此外，JVM具有极高的性能，同时仍然非常简单-尽管通过开发投入了大量资金，而不是通过其体系结构的某些特殊特性，可以实现更大的收益。</p><p> The most famous example of a register based virtual machine is probably  LUA, which can achieve  amazing performances and is used in  many videogames as a scripting language.</p><p> 基于寄存器的虚拟机最著名的示例可能是LUA，它可以实现惊人的性能，并在许多视频游戏中用作脚本语言。</p><p>  I hope this short introduction has stimulated your curiosity. Here are a few links in case you wish to start reading something more:</p><p>  我希望这段简短的介绍能激发您的好奇心。如果您想开始阅读更多内容，这里有一些链接： </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://andreabergia.com/stack-based-virtual-machines/">https://andreabergia.com/stack-based-virtual-machines/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/虚拟机/">#虚拟机</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/堆栈/">#堆栈</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/based/">#based</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>