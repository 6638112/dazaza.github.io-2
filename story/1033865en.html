<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>解析臭名昭著的日本邮政CSV</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">解析臭名昭著的日本邮政CSV</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-08 23:50:37</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/a882f036533f788085bbc3e9d638d941.png"><img src="http://img2.diglog.com/img/2020/11/a882f036533f788085bbc3e9d638d941.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Late last year I released  posuto, a package presenting Japanese postal codedata in an easy-to-use format. It&#39;s based on  data released by JapanPost, which is infamous for being widely used but hard to parse.</p><p>去年年底，我发布了posuto，这是一个以易于使用的格式显示日本邮政编码数据的包。它是基于日本邮政发布的数据，日本邮政因被广泛使用而臭名昭著，但很难解析。</p><p>  I first became aware of the postal data when I entered my postal code in anonline form and it auto-completed my address as &#34;XXX-borough (except thefollowing buildings)&#34;. I had no idea what that parenthetical was referring to,so I looked for a common source of postal data, found the CSV, and found theissue. It turns out the CSV file contains parenthetical notes for anyonereading the CSV file and makes reference to the order of the rows.</p><p>当我在网上表格中输入我的邮政编码时，我第一次知道了邮政编码，它自动将我的地址填成了XXX-borough(以下建筑物除外)&#34；。我不知道那个插入语指的是什么，所以我寻找了一个通用的邮政数据来源，找到了CSV，发现了问题所在。原来，CSV文件包含供任何阅读CSV文件的人使用的附加注释，并引用了行的顺序。</p><p> This causes problems. The data is mainly useful one row at a time, where theparenthetical is meaningless. Since CSV is a field-delimited format, there&#39;salso no need for parentheticals - you could just add a note field.</p><p>这会带来问题。这些数据主要是一次一行有用的，其中的圆括号是没有意义的。由于CSV是一种以字段分隔的格式，因此也不需要带括号-您只需添加一个备注字段即可。</p><p> This is only one of many issues with  ken_all.csv. You can find peoplecomplaining about it regularly  on Twitter, and there waseven briefly  a blog just collecting posts from all over the webabout it. A  particularly amusing tweet describes people who expectcomputers to bend to the will of humans being punished in Hell by having toparse  ken_all.csv forever.</p><p>这只是ken_all.csv的众多问题之一。你可以发现人们经常在推特上抱怨这件事，甚至有一个短暂的博客，只是从网络上收集关于这件事的帖子。一条特别有趣的推文描述了一些人希望计算机屈从于人类在地狱中受到惩罚的意愿，永远拥有最大的ken_all.csv。</p><p> The  README for the file explains that lines with overly long fields will bebroken up into multiple lines. Specifically, if the neighborhood name is over38 characters, or if the half-width katakana ( half-width katakana)pronunciation field is over 76 characters, the line will be split into twolines. The overly-long neighborhood field will be continued and all otherfields will be duplicated. This is an abbreviated sample of what that lookslike:</p><p>该文件的自述文件解释说，具有过长字段的行将被拆分成多行。具体地说，如果邻居名称超过38个字符，或者半角片假名(半角片假名)发音字段超过76个字符，则该行将被分成两行。过长的邻域字段将继续，所有其他字段将被复制。这是一个简短的例子，展示了它的样子：</p><p> 12345,Tokyo,Minato,This place name is really12345,Tokyo,Minato,very long it didn&#39;t fit in12345,Tokyo,Minato,a single line so we had to 12345,Tokyo,Minato,split it</p><p>12345，东京，水里，这个地名真的是12345，东京，水里，很长，它不适合12345，东京，水里，一行都不合适，所以我们不得不去12345，东京，水里，平分它。</p><p> The motivation for this is not explained. Maybe there was a fixed-width bufferfor storing a line somewhere thirty years ago. I used to process CSV and otherfiles from hundreds of different providers at an old job and I saw manyhorrors, but I&#39;ve never seen this particular formatting choice anywhere else.It should also be noted that while the length limits are as stated, thelocation where line breaks are inserted in long lines appears random, occurringneither at the character limit nor at normal word boundaries.</p><p>这一行为的动机并未得到解释。也许在30年前的某个地方，有一种固定宽度的缓冲器来存储一行。在以前的工作中，我经常处理来自数百个不同提供商的CSV和其他文件，我看到了很多可怕的情况，但我在其他地方从未见过这种特殊的格式选择。还应该注意的是，虽然长度限制如上所述，但在长行中插入换行符的位置似乎是随机的，既不在字符限制上，也不在正常的单词边界上。</p><p> It&#39;s worth noting not all the issues with the CSV are inherently technical;postal codes are always complicated. The postal code with the most rows in theCSV - a stunning 66 - is 〒452-0961, which refers to the  Haruhi region ofKiyosu City in Aichi Prefecture. This has that many lines because everyneighborhood gets a separate line. (This particular case may be related to Haruhihaving been the smallest town by area in Japan from 2006 until 2009, when itwas incorporated into Kiyosu City.)</p><p>值得注意的是，CSV并不是所有的问题都是固有的技术问题；邮政编码总是很复杂。CSV中行数最多的邮政编码是〒452-0961，这个邮政编码指的是爱知县清苏市的原日地区，这一邮政编码高达惊人的66行。这里有那么多线，因为每个社区都有一条单独的线。(这个特殊的案例可能与Haruhi2006至2009年并入清苏市后一直是日本面积最小的城镇有关。)</p><p> In contrast, the longest  continued line, using the line break rules above, isthe entry for 〒602-8368 or 〒602-8374, both with eight lines. These are both inone of a few areas in Kyoto that uses  a unique, bizarre system ofintersection-based addressing. The entry looks a bit like this:</p><p>相比之下，使用上面的换行规则，最长的连续行是〒602-8368或〒602-8374的条目，这两个条目都有8行。这两个区域都位于京都少数几个使用独特的、怪异的交叉口寻址系统的区域之一。条目看起来有点像这样：</p><p> 12345,Kyoto,Kyoto,&#34;North Town (Up Lower Godsroad from&#34;12345,Kyoto,Kyoto,&#34;the West, Down Turtle Street from the&#34;12345,Kyoto,Kyoto,&#34;East, Up Old Temple Road from the&#34;12345,Kyoto,Kyoto,&#34;West)&#34;</p><p>京都，京都，12345；北镇(从京都，京都12345号往上，往下走；从京都，京都，12345号往下，往下乌龟街往东，从京都，京都，12345号往上沿着老庙路往上走)，从西向西，从老庙路往上走，从京都，京都，往西，往下走，沿着龟头街往下走，从京都，12345号街往东，从老庙路往上，从京都，京都，西往上)。</p><p> I have used quoted fields here, but the actual CSV doesn&#39;t quote fields andinstead uses a different kind of comma.</p><p>我在这里使用了带引号的字段，但实际的CSV没有引用字段，而是使用了不同类型的逗号。</p><p> There are other issues. There are catch-all postal codes for many areas, wherethe neighborhood is given as &#34;except the following&#34;, and the only thing to dois look for that exact string and exclude it. There&#39;s a variety of similarstrings, and it&#39;s hard to be sure I&#39;ve caught them all.</p><p>还有其他问题。很多地区都有通用的邮政编码，除了下面的区号外，其他地区的邮政编码都是通用的，唯一要做的就是查找这个完全相同的字符串并将其排除在外。类似的字符串有很多种，很难确定我已经把它们都抓住了。</p><p> An example of another comment is 一円. Normally this would mean &#34;one yen&#34;, butit also means &#34;the area surrounding&#34;, and is a note in the CSV that should beremoved from neighborhood names,  except for exactly one neighborhood in Shiga wherethat&#39;s actually the name (〒522-0317).</p><p>另一个评论的例子是一円。通常情况下，这意味着1日元，但它也意味着周围的区域，这是CSV中的一个注释，应该从社区名称中删除，但志贺有一个社区的名字实际上就是这个社区的名字(〒)。</p><p> There&#39;s also a  separate romaji file offered by JP Post. It&#39;s updatedless frequently than the main files, is often out of sync, and the providedromaji are extremely low quality. For the moment I&#39;m still providing the datain posuto in the name of consistency, but honestly you should just use cutlet. To give an example of bad romaji:</p><p>此外，摩根大通邮报还提供了一份单独的罗马吉档案。它比主文件更新频繁，经常不同步，而且提供的文件质量极低。目前，我仍然以一致性的名义提供数据，但老实说，你应该只使用牛排。举一个糟糕的罗马吉酒的例子：</p><p>  What&#39;s happening here is that &#34;JA&#34; is being converted to the phonetic readingin Japanese, &#34;ジェイエイ&#34;. Then ジェ, which is written &#34;large ji small e&#34; butpronounced &#34;je&#34;, is being converted to &#34;jie&#34; by treating the small character asthough it were large, and the other characters are translated as-is, turningsomething already in the latin alphabet into alphabet soup. For contrast,cutlet has no problem converting &#34;JAビル&#34; into &#34;JA building&#34; (case handlingadmittedly needs some work still). Similar issues turn &#34;Roppongi Hills&#34; into&#34;Roppongihiruzu&#34;, and &#34;Sweden Hills&#34; into &#34;Suedenhiruzu&#34;.</p><p>这里发生的事情是，日本正在被转换为日语的音标读法，ジェイエイ&34；(日语是日语，日语)。然后，ジェ(大号字母小字母，但发音为je；34；je；)将被转换为字母汤，方法是将小字符视为大字符，而其他字符则按原样翻译，将拉丁字母中已有的东西转换为字母汤。相比之下，Cutlet可以毫不费力地将JAビル改建成JA大楼(无可否认，案件处理还需要一些工作)。类似的问题使六本木山变成了Roppopgihiruzu；瑞典山变成了Suedenhiruzu。</p><p> Anyway, dealing with the file was a humbling lesson in the amount of complexityit&#39;s possible to pack into one place. I&#39;ve glossed over many details, but youcan find them covered in posuto&#39;s README.</p><p>不管怎么说，处理这些文件是一个令人羞愧的教训，因为它可能会被打包到一个地方。我已经润色了很多细节，但你可以在POSUTO的自述文件中找到它们。</p><p> You can use  posuto as a library, or if you&#39;re not using Python, justdownload the pre-processed JSON and make use of that. If you find a good usefor it I&#39;d be delighted to hear about it.</p><p>你可以把posuto当做一个库来使用，或者如果你没有使用Python，只需下载经过预处理的JSON并使用它即可。如果你觉得它有很好的用处，我很乐意听你说。</p><p> Oh, and if you need a Win3.1 or DOS program to copy the data onto an IBM Hfloppy disk, just check the bottom of  JP Post&#39;s page - they&#39;vegot you covered. Ψ</p><p>哦，如果你需要Win3.1或DOS程序来将数据复制到IBM软盘上，只需查看JP Post页面的底部-他们会为你提供担保。Ψ</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.dampfkraft.com/posuto.html">https://www.dampfkraft.com/posuto.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/日本/">#日本</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/臭名昭著/">#臭名昭著</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/infamous/">#infamous</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1032818.html"><img src="http://img2.diglog.com/img/2020/11/thumb_e8c8062869d116fba54161d786846e68.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032818.html">日本的新氢气项目</a></div><span class="my_story_list_date">2020-11-3 2:21</span></div><div class="col-sm"><div><a target="_blank" href="/story/1032506.html"><img src="http://img2.diglog.com/img/2020/11/thumb_fffc389f176cbe2ef5c428c2633cd8e9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032506.html">伪装消防喷头喷发保护日本历史村落</a></div><span class="my_story_list_date">2020-11-1 0:34</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030715.html"><img src="http://img2.diglog.com/img/2020/10/thumb_b106a7c53dd9aebf9a67030d2b9b89d5.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030715.html">日本手工酿酒厂正在将未售出的啤酒变成杜松子酒</a></div><span class="my_story_list_date">2020-10-23 12:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029943.html"><img src="http://img2.diglog.com/img/2020/10/thumb_232f63bca27233ceab7d2eb70ee54bac.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029943.html">日本发明二维码荣获全球电子影响力奖</a></div><span class="my_story_list_date">2020-10-20 10:19</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>