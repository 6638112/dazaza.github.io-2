<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Rails和Circulus 2的实时预览2 Live previews with Rails and Stimulus 2</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Live previews with Rails and Stimulus 2<br/>使用Rails和Circulus 2的实时预览2 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-23 21:52:09</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/77664b2587a7678136de2f0e8182697b.png"><img src="http://img2.diglog.com/img/2021/3/77664b2587a7678136de2f0e8182697b.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Who wouldn’t want a live preview for writing their great content? If you happen to be running Rails with Hotwire, it’s surprisingly easy with a small Stimulus controller.</p><p>谁不希望预览写入他们的巨大内容？如果您碰巧使用Hotwire运行Rails，则使用小刺激控制器令人惊讶的方便。</p><p> The core idea of our preview is that it’s rendered entirely  on the backend. This is useful since we can reuse the logic both for presentation as well as actual changes. Whatever happens with the content can come from a single Ruby method. We’ll start with a small controller and a  preview method:</p><p> 我们预览的核心思想是它完全呈现在后端。这是有用的，因为我们可以重用逻辑以供呈现以及实际更改。无论内容发生什么，都可以来自单个Ruby方法。我们将从一个小型控制器和预览方法开始：</p><p>  I depend on  request.raw_post to get the whole POST body sent to the backend. We also render it as plain text, avoiding any HTML safe escaping.</p><p>  我依赖于Request.Raw_Post来获取发送到后端的整个帖子正文。我们还将其呈现为纯文本，避免任何HTML安全逃逸。</p><p> Now we have to open a form for the model we want to preview. Let’s say it’s a  Tweet model:</p><p> 现在我们必须为我们要预览的模型打开一种表单。让我们说这是一个推文模型：</p><p> &lt; %=  form_with ( model:  tweet )  do  | form |  % &gt;  &lt;div  data-controller= &#34;composer&#34; &gt;  &lt; %  if  tweet . errors . any ?  % &gt;  &lt;div  id= &#34;error_explanation&#34; &gt;  &lt;h2&gt;&lt; %=  pluralize ( tweet . errors . count ,  &#34; error &#34;)  % &gt; prohibited this tweet from being saved: &lt;/h2&gt;  &lt;ul&gt;  &lt; %  tweet . errors . each  do  | error |  % &gt;  &lt;li&gt;&lt; %=  error . full_message  % &gt;&lt;/li&gt;  &lt; %  end  % &gt;  &lt;/ul&gt;  &lt;/div&gt;  &lt; %  end  % &gt;  &lt;div  class= &#34;field&#34; &gt;  &lt; %=  form . label  :body  % &gt;  &lt; %=  form . text_area  :body ,  placeholder:  &#34; Type  a  tweet &#34;,  data:  {  &#34; composer-target &#34; :  &#34; tweet &#34;,  &#34; action &#34; :  &#34; input- &gt;composer#preview&#34; } %&gt;  &lt;/div&gt;  &lt;div  class= &#34;actions&#34; &gt;  &lt; %=  form . submit  % &gt;  &lt;/div&gt;  &lt;div  data-composer-target= &#34;output&#34; &gt;  &lt;/div&gt;  &lt;/div&gt; &lt; %  end  % &gt;</p><p> ＆lt; ％= form_with（型号：推文）do |形式| ％＆gt; ＆lt; div data-controller =＆＃34;作曲家＆＃34; ＆gt; ＆lt; ％如果推文。错误。任何 ？ ％＆gt; ＆lt; div id =＆＃34; error_explanation＆＃34; ＆gt; ＆lt; h2＆gt;＆lt; ％=颠覆（推文。错误。计数，＆＃34;错误＆＃34;）％＆gt;禁止将此推文保存：＆lt; / h2＆gt; ＆lt; ul＆gt; ＆lt; ％推文。错误。每件事错误| ％＆gt; ＆lt; li＆gt;＆lt; ％=错误。 full_message％＆gt;＆lt; / li＆gt; ＆lt; ％end％＆gt; ＆lt; / ul＆gt; ＆lt; / div＆gt; ＆lt; ％end％＆gt; ＆lt; div类=＆＃34;字段＆＃34; ＆gt; ＆lt; ％=表格。标签：身体％＆gt; ＆lt; ％=表格。 Text_area：身体，占位符：＆＃34;键入Tweet＆＃34;，数据：{＆＃34;作曲家目标＆＃34; ：＆＃34; Tweet＆＃34 ;,＆＃34;行动＆＃34; ：＆＃34; Input-＆gt; Composer＃预览＆＃34; }％＆gt; ＆lt; / div＆gt; ＆lt; div类=＆＃34;行动＆＃34; ＆gt; ＆lt; ％=表格。提交％和gt; ＆lt; / div＆gt; ＆lt; div数据 -  composer-target =＆＃34;输出＆＃34; ＆gt; ＆lt; / div＆gt; ＆lt; / div＆gt; ＆lt; ％end％＆gt;</p><p> As you can see, I adjusted the default template with a little bit Stimulus 2 data attributes. I wrapped the whole form in a div with  data-controller set to  composer, which will be the Stimulus controller’s name. I added two data attributes to the text area:  data-composer-target identifying the text area and  data-action specifying  composer#preview action on any input. Then at the bottom, we just have a  &lt;div&gt; with  data-composer-target set to  output. This target will be used for inserting the rendered HTML from the backend.</p><p> 如您所见，我调整了具有稍微刺激2数据属性的默认模板。我在DIV中包装了一个数据控制器的DIV，该组成器将是刺激控制器的名称。我将两个数据属性添加到文本区域：数据 -  composer-target标识文本区域和数据操作指定的Composer＃预览操作。然后在底部，我们只有一个＆lt; div＆gt;使用Data-Composer-Target设置为输出。此目标将用于从后端插入呈现的HTML。</p><p> For the view to work, we’ll need to write a  composer_controller.js that will react to input changes taking data from the text area and present them to the output div.</p><p> 有关工作的视图，我们需要编写一个Composer_Controller.js，该编写将反应的输入更改从文本区域呈现数据，并将其呈现给输出DIV。 </p><p> But before we do, we have to make sure we have both Rails UJS and Stimulus set up as we’ll use UJS  Rails.ajax call. The  application.js in  app/javascript/packs needs to look similar to this:</p><p>但在我们这样做之前，我们必须确保我们拥有轨道UJS和刺激，因为我们将使用UJS Rails.ajax呼叫。 App / JavaScript / Pack中的Application.js需要看起来与此类似：</p><p> import  Rails  from  &#34; @rails/ujs &#34; import  &#34; @hotwired/turbo-rails &#34; import  *  as  ActiveStorage  from  &#34; @rails/activestorage &#34; import  &#34; channels &#34; Rails . start () ActiveStorage . start () // Stimulus.js import  {  Application  }  from  &#34; stimulus &#34; import  {  definitionsFromContext  }  from  &#34; stimulus/webpack-helpers &#34; const  application  =  Application . start () const  context  =  require . context ( &#34; ./controllers &#34; ,  true ,  / \. js$/ ) application . load ( definitionsFromContext ( context ))</p><p> 从＆＃34导入导轨; @ Rails / UJS＆＃34;进口＆＃34; @ hotwired / turbo-rails＆＃34;从＆＃34导入*作为ActiveStorage; @ Rails / ActiveStorage＆＃34;进口＆＃34;频道＆＃34;轨道。 start（）激活。 start（）// stimulus.js导入{application} from＆＃34;刺激＆＃34;从＆＃34导入{definitedsfromcontext};刺激/ webpack助手＆＃34; const应用程序=应用程序。 start（）const context =要求。背景（＆＃34; ./controllers＆＃34;，true，/ \。js $ /）应用程序。加载（定义FROMCONTEXT（上下文））</p><p>  import  {  Controller  }  from  &#34; stimulus &#34; import  Rails  from  &#34; @rails/ujs &#34; export  default  class  extends  Controller  {  static  targets  =  [  &#34; tweet &#34; ,  &#34; output &#34;  ]  connect ()  {  this . preview ()  }  preview ()  {  var  content  =  this . tweetTarget . value ;  var  preview  =  this . outputTarget ;  Rails . ajax ({  type :  &#34; post &#34; ,  url :  &#34; /preview &#34; ,  contentType :  &#34; text/plain &#34; ,  data :  content ,  success :  function ( data )  {  preview . innerHTML  =  data  }  })  } }</p><p>  从＆＃34导入{controller};刺激＆＃34;从＆＃34导入导轨; @ Rails / UJS＆＃34;导出默认类扩展控制器{静态目标= [＆＃34; Tweet＆＃34; ，＆＃34;输出＆＃34; ] connect（）{这个。 preview（）} preview（）{var content = this。 Tweettarget。价值 ; var preview =这。 outputtarget;轨道。 ajax（{type：＆＃34;帖子＆＃34;，网址：＆＃34; / preview＆＃34;，contenttype：＆＃34; text / plain＆＃34;，数据：内容，成功：功能（数据）{预览。innerHTML的数据=}}）}}</p><p> In the beginning, we define the  tweet and  output targets. We call  preview on  connect() to make sure the initial preview will be rendered and then define the primary  preview method.</p><p> 在开始，我们定义了推文和输出目标。我们在Connect（）上调用预览以确保将呈现初始预览，然后定义主预览方法。</p><p> The  preview() method then takes the content from the  tweet target and sends it using the  Rails.ajax call as  text/plain. Once we receive a preview response back, we directly inject it into the rest of the page by setting the  innerHTML attribute on the  output target.</p><p> 然后，预览（）方法从Tweet目标中获取内容，并将其使用Rails.Ajax调用作为文本/平原发送。一旦我们收到预览响应，我们通过在输出目标上设置innerhtml属性，我们将其直接注入页面的其余部分。</p><p> And that’s it. If you didn’t modify the initial method, you’d get the whole text previewed in bold.</p><p> 就是这样。如果您没有修改初始方法，则会以粗体显示预览的整个文本。</p><p>       I am writing an introductory book on web application deployment. Networking, processes, systemd, backups, and all your usual suspects.</p><p>       我正在编写关于Web应用程序部署的介绍性书。网络，流程，SystemD，备份以及您的所有常规嫌疑人。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://nts.strzibny.name/rails-stimulus-live-preview/">https://nts.strzibny.name/rails-stimulus-live-preview/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/rails/">#rails</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/previews/">#previews</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/预览/">#预览</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>