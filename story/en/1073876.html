<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>将IP与服务和套接字分离以提高解决灵活性Decoupling IP from services and sockets for addressing agility</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Decoupling IP from services and sockets for addressing agility<br/>将IP与服务和套接字分离以提高解决灵活性</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-17 17:11:52</div><div class="page_narrow text-break page_content"><p>This week’s paper is from a conference earlier in 2021 (SIGCOMM 2021). I’m also trying out a new format for the paper reviews, your thoughts are greatly appreciated.These paper reviews can  be delivered weekly to your inbox, or you can subscribe to the  Atom feed. As always, feel free to reach out on  Twitter with feedback or suggestions!</p><p>本周的论文来自2021年初的一次会议（SIGCOMM 2021）。我也在尝试一种新的论文评论格式，非常感谢您的想法。这些论文评论可以每周发送到你的收件箱，也可以订阅Atom订阅源。一如既往，请随时在Twitter上发表反馈或建议！</p><p>   The research in  The Ties that un-Bind: Decoupling IP from web services and sockets for robust addressing agility at CDN-scale describes CloudFlare’s work to decouple networking concepts (hostnames and sockets) from IP addresses.</p><p>《解除绑定的纽带：将IP与web服务和套接字分离以实现CDN级别的强大寻址灵活性》中的研究描述了CloudFlare将网络概念（主机名和套接字）与IP地址分离的工作。</p><p>  By decoupling hostnames and sockets from addresses, CloudFlare’s infrastructure can quickly change the machines that serve traffic for a given host, as well as the services running on each host - the authors call this approach  addressing agility.</p><p>通过将主机名和套接字与地址分离，CloudFlare的基础设施可以快速更改为给定主机提供流量的机器，以及每个主机上运行的服务——作者称这种方法为寻址敏捷性。</p><p>  The paper notes  reducing IP address use as the initial motivation for decoupling IP addresses from hostnames. The authors argue that CDNs don’t necessarily need large numbers of IP addresses to operate - this is in contrast with the fact that, “large CDNs have acquired a massive number of IP addresses: At the time of this writing, Cloudflare has 1.7M IPv4 addresses, Akamai has 12M, and Amazon AWS has over 51M!”</p><p>本文指出，减少IP地址的使用是将IP地址与主机名分离的最初动机。作者认为，CDN不一定需要大量IP地址才能运行——这与“大型CDN已经获得了大量IP地址：在撰写本文时，Cloudflare拥有170万个IPv4地址，Akamai拥有1200万个，Amazon AWS拥有超过5100万个！”的事实形成了对比</p><p> Traditionally, many CDNs use large numbers of IPs because their architecture (shown in the figure below) places entry and exit points on the public internet - entry points receive requests from clients, while exit points make requests to origin servers on cache miss    These docs on “What is an origin server?” are helpful. . For these machines to be reachable, they need public IP addresses.</p><p>传统上，许多CDN使用大量IP，因为它们的体系结构（如下图所示）将入口点和出口点放在公共互联网上——入口点接收来自客户端的请求，而出口点向缓存上的源服务器发出请求，但却错过了“什么是源服务器”上的这些文档有帮助。为了让这些机器可以访问，它们需要公共IP地址。</p><p>  Other factors can increase a CDN’s IP address usage. CDNs may bind specific IPs to hostnames, creating a relationship between the number of hostnames served by the CDN and the number of addresses the CDN requires. Furthermore, CDN servers normally have an upper bound on networking sockets   Network connections have read/write buffers for connections, as well as a kernel data structure called   sk_buff. More info  here. , so increased client usage also translates into more machines (and associated IP addresses).</p><p>其他因素可能会增加CDN的IP地址使用率。CDN可以将特定IP绑定到主机名，从而在CDN服务的主机名数量和CDN需要的地址数量之间建立关系。此外，CDN服务器通常在网络套接字上有一个上限，网络连接有用于连接的读/写缓冲区，以及一个名为sk_buff的内核数据结构。更多信息请点击这里，因此，客户机使用量的增加也会转化为更多的机器（以及相关的IP地址）。</p><p>   Hostname-to-address bindings control how hostnames (like  www.micahlerner.com) map to IP addresses/machines that can serve requests</p><p>主机名到地址绑定控制主机名（如www.micahlerner.com）如何映射到可以服务请求的IP地址/计算机</p><p> Address-to-socket bindings control how services running on machines   For a reference on network sockets, I have really enjoyed  Beej’s Guide to Networking Programming  service client requests.</p><p>地址到套接字绑定控制机器上运行的服务。作为网络套接字的参考，我非常喜欢Beej的网络编程服务客户端请求指南。</p><p> First, the paper describes how CloudFlare can quickly and dynamically update  hostname-to-address bindings by changing configurations called  policies - DNS servers ingest  policies and use them to decide which IP addresses to return for a given hostname.</p><p>首先，本文描述了CloudFlare如何通过更改称为策略的配置来快速、动态地更新主机名到地址绑定——DNS服务器接收策略，并使用它们来决定为给定主机名返回哪些IP地址。</p><p>  One example policy allows hostnames to map to IP addresses randomly chosen from a set of candidates (called a  pool). Using  policies instead of fixed mappings from hostnames to IP addresses is in contrast with other deployments, where changing  hostname-to-IP address mappings is both operationally complex and error-prone.</p><p>一个示例策略允许主机名映射到从一组候选主机（称为池）中随机选择的IP地址。使用策略而不是从主机名到IP地址的固定映射与其他部署形成对比，在其他部署中，更改主机名到IP地址的映射在操作上既复杂又容易出错。</p><p>  Normally a service receives traffic on a fixed set of ports - this approach has several downsides, including that each socket has overhead (meaning a fixed number of services can run on each machine) and it isn’t possible to run two services with overlapping ports on the same machine without complications   The paper notes one approach, using  INADDR_ANY (relevant documentation  here), that allows one socket to receive packets sent to all interfaces on a machine. This approach doesn’t come without its downsides, like potentially introducing security issues - if internal traffic goes to the same socket as external traffic, an internal service could accidentally respond to external requests.  (as they can’t re-use the same port).</p><p>通常一个服务在一组固定的端口上接收流量——这种方法有几个缺点，包括每个套接字都有开销（意味着在每台机器上可以运行固定数量的服务），并且不可能在同一台机器上运行两个端口重叠的服务而不造成复杂性。本文指出了一种方法，使用INADDR_ANY（此处为相关文档），允许一个套接字接收发送到机器上所有接口的数据包。这种方法并非没有缺点，比如可能会带来安全问题——如果内部流量与外部流量进入同一个套接字，内部服务可能会意外地响应外部请求。（因为它们不能重复使用同一个端口）。</p><p>  To addresses these challenges, CloudFlare’s system introduces  programmable socket lookup   The CloudFlare blog has more background  here. , using BPF   eBPF/BPF have come up a few times in past paper reviews, and I really like  this post from Julia Evans on the topic.  (as part of the implementation, the authors built   sk_lookup   There is also a greta tutorial  here. ). This approach routes traffic inside of the kernel based on rules. An example rule could route client traffic to different instances of the same service running side-by-side, with a separate socket for every instance.</p><p>为了应对这些挑战，CloudFlare的系统引入了可编程套接字查找。CloudFlare博客提供了更多背景信息，使用BPF eBPF/BPF在过去的论文评论中出现过几次，我非常喜欢Julia Evans关于这个主题的这篇文章。（作为实现的一部分，作者构建了sk_查找，这里还有一个greta教程。）。这种方法基于规则在内核内部路由流量。一个示例规则可以将客户端流量路由到并行运行的同一服务的不同实例，每个实例都有一个单独的套接字。</p><p>   The paper discusses a number of performance and security benefits that  addressing agility provides - importantly, these benefits are available with no discernible change to other important system metrics!</p><p>本文讨论了解决敏捷性问题所带来的许多性能和安全优势——重要的是，这些优势在其他重要系统指标没有明显变化的情况下可用！</p><p> First, decoupling  hostname-to-address and  address-to-socket bindings allows the CloudFlare CDN   The paper notes that the approach is transferable to external deployments as well, with a few caveats.  to operate with fewer IPs. Addresses no longer need to be reserved for use by a specific host name and machines can now have significantly more sockets. Fewer IP addresses impacts cost and lowers barrier to entry - the paper notes that the IP space owned by the major cloud providers is worth north of 500 million USD (if not more).</p><p>首先，分离主机名到地址和地址到套接字绑定允许CloudFlare CDN。本文指出，这种方法也可以转移到外部部署，但需要注意几点。使用更少的IP进行操作。地址不再需要保留供特定主机名使用，机器现在可以有更多的套接字。更少的IP地址会影响成本并降低进入壁垒——论文指出，主要云提供商拥有的IP空间价值不超过5亿美元（如果不是更多的话）。</p><p> The IP addresses that CloudFlare does continue to use are also become easier to manage. Dynamically allocating IP addresses to hostnames turns the operational task of taking machines (and the associated addresses) offline into a matter of removing addresses from the pool provided to clients.</p><p>CloudFlare继续使用的IP地址也变得更易于管理。将IP地址动态分配给主机名将使机器（以及相关地址）脱机的操作任务变成了从提供给客户端的池中删除地址的问题。</p><p> Furthermore, the randomization approach described (where IP addressess from a pool are returned in response to DNS queries) by the paper results in better load balancing.</p><p>此外，论文中描述的随机化方法（池中的IP地址响应DNS查询而返回）可以实现更好的负载平衡。</p><p>  While the paper discusses the scalability benefits  addressing agility provides, it also discusses other implications beyond limiting address use - as an example, the approach can help with Denial of Service attacks.</p><p>虽然本文讨论了寻址灵活性提供的可扩展性优势，但也讨论了限制地址使用之外的其他影响——例如，该方法可以帮助抵御拒绝服务攻击。</p><p> If a specific address is under attack, the traffic to that address can be blackholed   CloudFlare’s reference on blachole routing  here. . If a hostname is under attack, the traffic to that hostname will be distributed evenly across machines in the address pool.</p><p>如果某个特定地址受到攻击，则该地址的流量可以是blackholed CloudFlare在Blackhole路由上的参考。如果某个主机名受到攻击，则该主机名的通信量将均匀分布在地址池中的计算机上。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/服务/">#服务</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ip/">#ip</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/地址/">#地址</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>