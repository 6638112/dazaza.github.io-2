<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>两个随机选择的力量</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">两个随机选择的力量</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-26 10:57:17</div><div class="page_narrow text-break page_content"><p>在许多大型Web服务中，多层无状态和有状态服务由负载均衡器分隔。负载平衡可以使用专用硬件、使用专用软件负载平衡器、使用DNS技巧或通过客户端中的负载平衡机制来实现。在大型系统中，每一层的资源和约束可能差别很大。有些层是无状态的，可以很容易地水平扩展到许多机器。由于需要访问状态或争用某些其他共享资源，其他层可能会受到更多限制。</p><p>集中式负载平衡解决方案可以很好地将负载分布在一组机器上。它们跟踪它们发送到每台机器的负载量(通常基于简单的测量，如连接计数)。因为它们是集中式的，所以负载平衡器通常不需要担心从其他来源发送的负载。他们完全控制着荷载的分配。</p><p>尽管有这一优势，专用负载均衡器通常是不受欢迎的。它们增加了成本、延迟和复杂性，并可能引入单点故障。将负载平衡任务交给每个上游客户端也是可能的，但会带来从多个地方公平平衡负载的挑战。在具有大量客户端和相当同类调用的大型系统中，纯随机系统(如DNS循环调度)可以非常好地工作。在较小的系统中，在每个下游服务只能处理少量或并发请求的系统中，以及在请求是异构的系统中，负载平衡通常比随机负载平衡更好。</p><p>通过跨所有客户端分发有关系统负载的信息，可以实现完美的分布式负载平衡，至少在令人满意的情况下是这样。在不同的源之间不断共享准确的负载信息的开销可能很高，因此让每个源在一个缓存副本中工作是很有诱惑力的。此数据可以从下游或其他客户端定期刷新。</p><p>“两个随机选择的力量：技术和结果的调查”，Mitzenmacher et。艾尔。调查了一些与这个问题非常相关的研究。整个调查都很好读，但最有趣的结果之一是关于延迟数据(如上面提到的缓存负载结果)对负载平衡的影响。回想起来，结果相当合乎逻辑，但可能与大多数工程师的最初预期不符。</p><p>使用陈旧数据进行负载平衡会导致群组行为，在这种情况下，请求将向以前安静的主机聚集的时间比使该主机真正变得非常繁忙所需的时间长得多。下一次刷新缓存的加载数据将把服务器放在负载列表的最前面，并且它将再次变得安静。然后又忙碌起来，因为下一群牛群看到这里很安静。忙着呢。安静。忙着呢。安静。诸若此类。</p><p>一种可能的解决方案是完全放弃负载平衡，只需随机选择一台主机。根据负载率的不同，这可能是一个很好的方法。然而，对于许多典型的负载，选择随机主机会降低延迟并减少吞吐量，因为这会浪费服务器上的资源，而这些资源最终会以不幸和安静告终。</p><p>Mitzenmacher调查的研究采取的方法是尝试两个主机，然后选择负载最小的一个。这可以直接完成(通过查询主机)，但在缓存的加载数据上也运行得出奇地好。</p><p>为了说明这是如何工作的，我对一个非常简单的系统进行了模拟。每隔一秒就有一个请求到达具有10台服务器的系统。每8秒从服务器上的队列中删除最早的请求(如果有)。负载平衡是使用服务器队列长度的缓存副本完成的，每N秒更新一次。我考虑了四种方法：选择一个随机服务器，选择最好的服务器，两个随机选择中最好的和三个随机选择中最好的。</p><p>正如您所预期的那样，当有完美的、未延迟的信息可用时，选择最好的方法效果最好。在相同的情况下，随机挑选方法的效果很差，导致了所有方法中最糟糕的排队时间。随着数据年龄的增加，挑选最好的方法会因为羊群效应而变得越来越差，很快就会超过随机方法成为最差的方法。</p><p>三局四胜排在第二位，表现不错。它获得了第一名，但随着延迟的增加，它被让给了2胜2负的结果。显然，当k接近服务器数量时，k中最佳的行为将接近Best的行为。在此模拟结束的过程中，2胜2取始终是强有力的引导者。在给定这些参数的情况下，它将在刷新间隔70左右开始输给随机方法。它在从10到70的区间内是明显的领先者，对于这样一个简单的方法来说，这是一个令人印象深刻的表现。</p><p>二选一是好的，因为它结合了两种方法的优点：它使用关于负载的真实信息来选择主机(与随机不同)，但比其他两种方法更强烈地拒绝羊群行为。</p><p>看看两个随机选择的力量，以获得更有力的数学论证，以及一些更令人惊讶的地方，这个算法真的工作得很好。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://brooker.co.za/blog/2012/01/17/two-random.html">https://brooker.co.za/blog/2012/01/17/two-random.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/选择/">#选择</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/random/">#random</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/负载/">#负载</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1029254.html"><img src="http://img2.diglog.com/img/2020/10/thumb_13207cf37aed359d9851ba5ed7910693.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029254.html">婴儿的随意选择成了他们的喜好</a></div><span class="my_story_list_date">2020-10-16 23:5</span></div><div class="col-sm"><div><a target="_blank" href="/story/1025267.html"><img src="http://img2.diglog.com/img/2020/9/thumb_8357e6a2a26ba7f74c6b7ca91f04ed73.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1025267.html">Haskell RecordDotSyntax语言扩展建议(已接受)</a></div><span class="my_story_list_date">2020-9-21 9:11</span></div><div class="col-sm"><div><a target="_blank" href="/story/1024199.html"><img src="http://img2.diglog.com/img/2020/9/thumb_c7af88354ec5fa6c19edeeeeca56905f.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024199.html">空中客车公司选择GNAT Pro Ada开发无人驾驶航空系统</a></div><span class="my_story_list_date">2020-9-16 22:51</span></div><div class="col-sm"><div><a target="_blank" href="/story/1022421.html"><img src="http://img2.diglog.com/img/2020/9/thumb_3b2de7247e6a933b546d238dd55bf362.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022421.html">通过“支付选择法”</a></div><span class="my_story_list_date">2020-9-7 1:12</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>