<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>新的 WireGuardNT 打破了 Windows 上的吞吐量上限</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">新的 WireGuardNT 打破了 Windows 上的吞吐量上限</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-08-05 22:02:16</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/8/2c4e980144b0cfba6c63cf7a0cfe4f62.jpg"><img src="http://img2.diglog.com/img/2021/8/2c4e980144b0cfba6c63cf7a0cfe4f62.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>WireGuard VPN 项目今天为其 Windows 用户宣布了一个重要的里程碑 - 称为 WireGuardNT 的 VPN 协议的全新内核模式实现。新实施允许大幅提高 10Gbps LAN 连接以及许多 WI-Fi 连接的吞吐量。 WireGuard 在 Windows 上的最初实现使用了wireguard-go——一种用谷歌的 Go 编程语言编写的 WireGuard 的用户空间实现。 Wireguard-go 然后绑定到一个虚拟网络设备，其中大部分也位于用户空间。 Donenfeld 不喜欢tap-windows，OpenVPN 项目提供的虚拟网络接口——所以他从头开始实现了自己的替代品，称为Wintun。 Wintun 是对 tap-windows 的明显改进——OpenVPN 项目本身已经实现了 Wintun 支持，结果令人印象深刻（tap-windows 为 414Mbps，Wintun 为 737Mbps）。但是，虽然使用 Wintun 是对 tap-windows 的改进，但它并没有改变从内核空间（“真实”网络堆栈所在的地方）和用户空间（OpenVPN 和 wireguard-go 都所在的地方）进行持续上下文切换的需求。为了摆脱剩余的性能瓶颈，整个堆栈——虚拟适配器、加密和所有——需要被拉入内核。在 Linux 上，这意味着成为 DLKM（动态加载内核模块）。在 Windows 上，这意味着是一个合适的内核设备驱动程序。在 Windows 上抛弃 WireGuard 堆栈的用户空间组件并将所有内容保留在内核中意味着将 WireGuard 更改为在 Windows 上的工作方式，就像它在 Linux 上的工作方式一样。事实上，WireGuardNT 最初是作为 Linux 内核 WireGuard 实现的直接端口。根据 WireGuard 的创建者 Jason Donenfeld 的说法，一旦初始移植成功，“NT 代码库迅速分化以很好地适应原生 NTisms 和 NDIS API。最终结果是为 NT 内核深度集成和高性能的 WireGuard 实现，这使得使用NT 内核和 NDIS 功能的全部范围。”当然，这也意味着摆脱大量的上下文切换。最终结果是可靠的：在一对 Equinix Metal（以前称为 packet.net）c3.small 实例上使用 Ethr 测得的性能是高端性能的三倍多。</p><p>不过，与具有 10Gbps 接口的至强服务器相比，更少的上下文切换的优势进一步扩展——Donenfeld 提到，一些早期测试人员报告说，WireGuardNT 解决了有时在通过 Wi-Fi 使用 VPN 连接时出现的巨大性能损失。我们使用带有英特尔 AX201 Wi-Fi 6 卡的 HP EliteBook 直接测试了差异，该卡连接到 Plume Wi-Fi 6 Superpods 测试套件的路由器节点。尽管我们的结果不如一些早期测试者的结果那么引人注目，但它们确实证实了显着的性能提升。在相同的设备和相同的配置下，我们测得 WireGuardNT iperf3 的运行速度比 wireguard-go 和 Wintun 快 10% 到 25%。从 0.4 版开始，WireGuardNT 现在可用于 WireGuard 的一般 Windows 下载中的测试。但由于它仍被归类为实验性的，您需要手动添加一个注册表项和一个 DWORD 才能使用它。以管理员身份打开 regedit，然后浏览至 HKLM--&gt;Software。接下来，创建一个名为 WireGuard 的密钥，并在该密钥中创建一个名为 ExperimentalKernelDriver 的 DWORD。将 ExperimentalKernelDriver 设置为 1，您的隧道将使用新的 WireGuardNT 代码——没有它（或将它设置为 0），它们将使用默认行为，即旧的 wireguard-go/wintun 代码。要使更改生效，您需要右键单击系统托盘中的 WireGuard 图标，然后单击“退出”。当您再次打开 WireGuard 应用程序时，它将遵循您的 ExperimentalKernelDriver 设置。将来，WireGuardNT 将默认启用，如果您想要旧代码，则需要设置一个注册表标志。除此之外，该项目计划最终完全淘汰一般二进制文件中的wireguard-go/wintun。另一方面，项目本身将保留，因为它们具有超出股票 WireGuard 客户端的广泛用途。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/打破/">#打破</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/shatters/">#shatters</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/wireguard/">#wireguard</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1071427.html"><img src="http://img2.diglog.com/img/2021/8/thumb_b6edddabef9db32c980eab6bc4477504.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1071427.html">微软暂停其新 Windows 365 服务的免费试用，该服务允许用户在“大量需求”后通过网络浏览器流式传输 Windows 10 或 11</a></div><span class="my_story_list_date">2021-8-5 21:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1071361.html"><img src="http://img2.diglog.com/img/2021/8/thumb_8ad44b17d5f2b8976df46c56a6ea9983.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1071361.html">Windows 10 现在默认阻止可能不需要的应用程序</a></div><span class="my_story_list_date">2021-8-5 21:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1071322.html"><img src="http://img2.diglog.com/img/2021/8/thumb_b6edddabef9db32c980eab6bc4477504.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1071322.html">微软在“巨大需求”后暂停免费 Windows 365 云 PC 试用</a></div><span class="my_story_list_date">2021-8-5 20:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1071319.html"><img src="http://img2.diglog.com/img/2021/8/thumb_a9b1dd301e3b1d0adc2f22528bffd33c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1071319.html">微软删除了对其 Windows 11 外展视频的所有评论</a></div><span class="my_story_list_date">2021-8-5 20:48</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>