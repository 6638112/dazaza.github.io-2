<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在.NET Core 3.1中实现HTTPS</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在.NET Core 3.1中实现HTTPS</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-08 16:32:36</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/2ecda090a03d88776222de103106e59b.jpg"><img src="http://img.diglog.com/img/2020/7/2ecda090a03d88776222de103106e59b.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在ASP.NET核心中，默认情况下启用https。HttpsRedirect中间件类提供执行从http到https的重定向所需的功能。启动时的UseHttpsRedirect扩展方法用于强制执行此操作。默认情况下，此扩展方法发出307临时重定向响应。然后，它使用配置的https端口指定重定向端点。如果没有在代码中指定https端口，该类将从HTTPS_PORT环境变量或IServerAddress功能获取https端口。如果没有指定它们中的任何一个，那么中间件将记录一个警告，并且不会重定向。下面的代码显示了将https重定向中间件添加到服务集合并使用它的示例。下面的代码检查环境，并在生产环境中设置到HTTPS端点的永久重定向，在开发环境中设置临时重定向。</p><p>为了能够在开发环境中使用HTTPS，.Net Core提供了一个全局工具，该工具可以在本地环境上创建自签名证书。以下命令可以安装此工具。</p><p>该工具现在可以用于通过以下命令生成自签名证书。-ep标志表示将导出证书的导出路径，-p标志表示生成证书所需的密码。我们可以使用-Trust选项来信任生成的证书。</p><p>在Linux/Mac OS上，我们可以使用OpenSSL为本地环境生成证书。然而，信任证书是一个更加复杂的过程，这取决于Linux OS的版本和风格。</p><p>openssl req-new-x509-newkey rsa：2048-keyout dev-certificate.key-out dev-certificate.cer-day 365-subj/cn=localhost openssl pkcs12-export-out dev-certificate.pfx-inkey dev-certificate.key-in dev-certificate.cer。</p><p>可以使用环境变量ASPNETCORE_Kestrel__Certificates__Default__Path指定证书路径，并使用环境变量ASPNETCORE_Kestrel__Certificates__Default__Password指定密码。</p><p>Kestrel可以部署为边缘服务器，也可以使用反向代理(如IIS、NGINIX或Apache)进行部署。</p><p>当Kestrel部署为面向公共的边缘服务器时，可以使用以下代码将其配置为使用https以及特定的证书和端口</p><p>如果使用Apache或NGNIX等反向代理，则应该在调用https重定向中间件之前配置和设置转发的报头中间件。转发报头中间件应将X-Forwarded-Proto设置为https。这将启用代理处的HTTPS卸载和对Web应用的纯HTTP调用，并保证原始调用是在安全的HTTPS信道上进行的。这在非IIS场景(如NGINIX或Apache)中尤其重要。请参阅下面的代码来配置转发的报头中间件。</p><p>在集装箱化的环境中，可以选择在创建或启动容器的过程中生成证书，并在docker组合文件中指定相同的证书。然后可以使用环境文件来配置必要的环境变量，如下所示。</p><p>使用HTTPS重定向仍然存在较小的安全风险，因为用户可以在重定向到安全的HTTPS连接之前使用HTTP发出初始请求。为了克服这一点，HTTP严格传输安全(HSTS)协议在响应中添加一个标头，指示在向Web端点发送请求时只应使用HTTPS。一旦接收到HSTS标头，即使用户指定了HTTP URL，支持HSTS协议的客户端也将始终使用HTTPS向应用程序发送请求。在.Net Core3.1中，我们可以将HSTS中间件添加到管道中，如下所示。</p><p>在上面的代码中，我们将HSTS preload指定为true。HSTS预加载是浏览器中内置的一项功能，通过该功能，主机的全局列表仅在其站点上强制使用HTTPS。域被硬编码到浏览器中，这避免了最初的不安全请求，并确保仅使用HTTPS。另一个让很多人犯错的关键点是，即使您为localhost指定使用HSTS中间件，为IPv6和IPv4指定环回地址，也没有设置HSTS标头。这是因为默认情况下，ExcludeHosts参数排除这些地址。</p><p>总而言之，.NET核心提供了很多方法来为Web应用配置https，使用Kestrel作为边缘服务器，或者通过SSL卸载/TLS终止。它还提供了通过代码、配置或使用docker合成文件进行配置的选项。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://pradeeploganathan.com/aspnetcore/https-in-asp-net-core-31/">https://pradeeploganathan.com/aspnetcore/https-in-asp-net-core-31/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/实现/">#实现</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1005868.html"><img src="http://img.diglog.com/img/2020/6/thumb_21a6ce69996c811469790fc5da0a6dfa.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005868.html">英国实现无煤，可再生能源取代化石燃料</a></div><span class="my_story_list_date">2020-6-10 0:37</span></div><div class="col-sm"><div><a target="_blank" href="/story/1004842.html"><img src="http://img.diglog.com/img/2020/6/thumb_6e515fb7f92a80c7d9db1a220e7bd8a2.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1004842.html">国防部第三次尝试实现IPv6并不顺利</a></div><span class="my_story_list_date">2020-6-2 23:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003690.html"><img src="http://img.diglog.com/img/2020/5/thumb_ac90d32b417868cfe0d109c0677b8187.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003690.html">用C++实现的SmallTalk-80</a></div><span class="my_story_list_date">2020-5-25 23:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001556.html"><img src="http://img.diglog.com/img/2020/5/thumb_342a95b3397cd1f6910fff42ab7c3fc5.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001556.html">OpenMM：一种与硬件无关的分子模拟框架</a></div><span class="my_story_list_date">2020-5-11 2:19</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>