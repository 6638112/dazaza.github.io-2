<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>IHP：实时重新加载Haskell代码，其工作原理</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">IHP：实时重新加载Haskell代码，其工作原理</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-03 17:56:46</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/9e7c6568ff4200810ce20f0e508ea8fa.png"><img src="http://img2.diglog.com/img/2020/9/9e7c6568ff4200810ce20f0e508ea8fa.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>启动IHP应用程序让我们先看看当您通过运行./start来启动IHP应用程序时会发生什么。</p><p>项目中的./start脚本基本上只是一个小包装器，它确保由nix管理的所有依赖项都可用，然后调用RunDevServer二进制文件。此二进制文件是IHP的一部分，负责实际的应用程序启动和管理Postgres服务器。</p><p>您可以将RunDevServer视为一个小型进程管理器。当启动RunDevServer时，它将直接启动您的应用程序运行所需的所有进程：</p><p>所有这些进程都是并行启动的，以实现快速性能，并在开发服务器的主事件循环中同步。多亏了Haskells强大的并发能力。</p><p>最重要的进程是您的应用程序的GGCI进程。IHP不会在每次文件更改时完全重新编译您的应用程序，而是在REPL中加载您的应用程序，然后只刷新更改的文件。</p><p>首先，GGCI需要几秒钟来加载应用程序的所有Haskell文件。加载应用程序时，状态服务器正在为localhost：8000上的所有http请求提供服务。状态服务器还将显示所有类型错误，以防GHCI无法加载您的应用程序。当GGCI完成加载时，状态服务器将停止，您的应用程序将在localhost：8000上启动。</p><p>Haskell文件更改一旦应用程序启动，开发服务器主要处理文件更改。使用文件观察器，开发服务器会收到有关项目中Haskell文件的任何更改的通知。当更改Haskell文件时，在ghci进程中运行的应用程序进程将停止，并触发刷新(：r)。刷新通常非常快。一旦完成，应用程序服务器将再次启动。</p><p>一旦Haskell应用程序启动，打开的浏览器页面将使用WebSocket连接进行通知。打开的页面将通过AJAX获取当前页面，然后使用比较和补丁方法更新DOM。因此，在实时重新加载期间，仅实际更改的DOM节点将被触及。此方法将保持现有的页面状态，如滚动位置或键入到表单域中的文本。它允许非常快速且富有成效的反馈周期。</p><p>CSS文件更改IHP还支持实时重新加载CSS文件。一旦IHP发现静态目录中CSS文件的文件更改，它将通知所有使用其WebSocket连接打开的浏览器选项卡。在浏览器中发出通知后，IHP将查找任何&lt；link rel=&#34；样式表&gt；，并使用缓存缓冲器重新加载CSS文件。</p><p>这是可能的，因为NIX允许我们将包定义集固定到NIX包注册表的特定GIT提交。</p><p>键入错误有时您所做的更改会使您的应用程序停止编译。在这些错误情况下，状态服务器会介入并开始侦听localhost：8000。然后，状态服务器将显示错误消息，以便您可以快速修复：</p><p>此外，打开的浏览器选项卡将收到有关此情况的通知，并将刷新。这样，您可以立即看到错误。</p><p>电池-虽然上述步骤在技术上很复杂，但在实际开发时，您不会看到太多这样的复杂性。已经花费了大量的时间来寻找最好的方法并平滑所有的边缘情况。整个过程非常受PHP的启发，您只需更改文件即可运行。现场重装真的很管用。</p><p>开发服务器是IHP的核心，使开发过程非常高效。您可以获得类型安全的所有好处，而且开发速度与以前使用脚本语言时一样快。如果你还没有，现在是时候尝试一下了！🚀</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://ihp.digitallyinduced.com/blog/2020-08-10-ihp-live-reloading.html">https://ihp.digitallyinduced.com/blog/2020-08-10-ihp-live-reloading.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/haskell/">#haskell</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/live/">#live</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/应用程序/">#应用程序</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1021845.html"><img src="http://img2.diglog.com/img/2020/9/thumb_8e2cbb39aaadc16b296a7f42208c57e6.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021845.html">Handcalcs：从Python数学代码自动呈现Latex方程式</a></div><span class="my_story_list_date">2020-9-3 8:28</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021726.html"><img src="http://img2.diglog.com/img/2020/9/thumb_416653cb43f788b833a8f352288bd11b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021726.html">持续数十年的代码</a></div><span class="my_story_list_date">2020-9-2 16:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021534.html"><img src="http://img2.diglog.com/img/2020/9/thumb_14fcb2271a8ed870369c59a03c081a8c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021534.html">
多里安为其无代码的交互式讲故事平台筹集了325万美元</a></div><span class="my_story_list_date">2020-9-1 5:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021351.html"><img src="http://img.diglog.com/img/2020/8/thumb_732890bf3b6e44fee33f7d833c8c3cff.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021351.html">如何编写不可维护的代码</a></div><span class="my_story_list_date">2020-8-31 6:11</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>