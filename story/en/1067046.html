<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我的表演基准工作流程 My performance benchmarking workflow</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">My performance benchmarking workflow<br/>我的表演基准工作流程 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-20 23:14:02</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/d5889c862bcb37688a8dcbd246565e32.png"><img src="http://img2.diglog.com/img/2021/6/d5889c862bcb37688a8dcbd246565e32.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Benchmarking computer systems is time-consuming because setting up thenecessary environment involves a lot of work. Over time I have built a workflowthat mitigates the cost of setting up benchmarks and allows me to analyzeperformance more effectively. This blog post covers my workflow as of 2021.</p><p>基准计算机系统是耗时的，因为建立了这些环境涉及大量的工作。随着时间的推移，我建立了一个工作流程，减轻了建立基准的成本，并允许我更有效地分析单反形象。这篇博客文章涵盖了我的工作流程为2021。</p><p> Performance investigations often follow these steps: Go to Step 3 until the desired benchmark results are reached, keeping those optimizations that helped.</p><p> 性能调查通常遵循以下步骤：转到步骤3，直到达到所需的基准结果，保持这些优化帮助。</p><p> This is a long process that is costly to pause/resume or replicate again in the future. Setting up hardware and software manually is both time-consuming and error-prone. Therefore we don&#39;t want to do it more than once. There is a risk that replicating the benchmark on another machine will fail to produce identical results due to differences in environments.</p><p> 这是一个漫长的过程，暂停/恢复或再次复制。手动设置硬件和软件是耗时和错误的。因此，我们不想做一次不止一次。由于环境的差异，存在对另一台机器上的基准复制的风险将无法产生相同的结果。</p><p> The consequence of high-overhead processes is that we minimize their use since we cannot afford to run through the process as often as we&#39;d like. This means we cannot answer all the performance questions we&#39;d like to and therefore our understanding is limited. We cannot discover all the truths that would enable us to make performance improvements.</p><p> 高度开销过程的结果是，我们最小化他们的使用，因为我们不能经常像我们一样经常运行过程。这意味着我们无法回答我们＆＃39; d的所有绩效问题，因此我们的理解是有限的。我们无法发现使我们能够进行性能改进的所有真理。</p><p>    Set up hardware and software once only and be able to return to that state again in the future at the press of a button.</p><p>    仅设置硬件和软件一次，并在按钮的按钮中再次返回到该状态。</p><p>    Store benchmark results so that each run is available for further analysis in the future.</p><p>    存储基准结果，以便每次运行都可以在未来进一步分析。</p><p>  Go to Step 2 to modify the environment (e.g. apply proof-of-concept patches to software) and repeat.</p><p>  转到步骤2修改环境（例如，将概念验证修补程序应用于软件）并重复。 </p><p> Since the performance investigation is captured in a git branch it&#39;s easy to switch to another investigation without losing history.</p><p>由于绩效调查被捕获在Git分支中，而且在没有失去历史的情况下，易于切换到另一个调查。</p><p> This is actually what I do! Git provides the storage and time machine functionality for easily pausing/resuming or replicating performance investigations.</p><p> 这实际上是我做的！ Git提供存储和时间机器功能，以便轻松暂停/恢复或复制性能调查。</p><p>  Ansible provides the automation system necessary to put hardware and software into the desired state for benchmarking. Ansible&#39;s killer feature is the large ecosystem of modules for handling tasks like installing packages, configuring virtual machines and containers, etc. I find Ansible more productive than Python or shell scripting thanks to Ansible&#39;s modules collection.</p><p>  ANSIBLE提供了将硬件和软件置于所需状态所需的自动化系统，以进行基准测试。 Ansible＆＃39; S杀手功能是用于处理安装包的任务，配置虚拟机和容器等的大型生态系统。我发现ansible比python或shell脚本更高效，感谢Ansible＆＃39; s模块集合。</p><p> I&#39;ve begun collecting Ansible tasks for Linux KVM development in  virt-tasks. If you&#39;re wondering what the configuration for running a benchmark looks like, here is an Ansible playbook that builds QEMU and a guest kernel, creates a Fedora 34 virtual machine, runs the fio disk I/O benchmark, and collects the results:</p><p> 我在Virt-任务中开始收集Linux KVM开发的Ansible任务。如果您＆＃39;重新想知道运行基准的配置如上样子，这里是一个构建Qemu和客户内核的Ansible PlayBook，创建Fedora 34虚拟机，运行FIO盘I / O基准，并收集结果：</p><p> --- -  hosts : hosts  tasks :  -  include_tasks : tasks/build-qemu.yml  vars :  -  repo :  https://gitlab.com/qemu-project/qemu.git  -  version : v6.0.0  -  name : create disk image  include_tasks : tasks/virt-builder-create-image.yml  vars :  -  os_version : fedora-34  -  size : 32G  -  output : /var/lib/libvirt/images/test.img  -  format : raw  -  name : build guest kernel  include_tasks : tasks/build-kernel.yml  vars :  -  repo :  https://gitlab.com/stefanha/linux.git  -  version : cpuidle-haltpoll-virtqueue  -  config_src_path : files/.config  -  name : stop vm  virt :  name : test  state : shutdown  ignore_errors : yes  -  name : start vm  include_tasks : tasks/start-vm.yml  vars :  -  xml :  &#34; {{ lookup(&#39;file&#39;, &#39;files/test.xml&#39;) }} &#34;  -  host : 192.168.122.192 -  hosts : vms  tasks :  -  name : install fio and rsync  dnf :  state : present  name :  - fio  - rsync  -  name : run fio  script : files/fio.sh  -  name : fetch fio output files  synchronize :  src : fio-output/  dest : notebook/fio-output/poll_source-off  mode : pull  -  name : run fio  script : files/fio.sh --enable  -  name : fetch fio output files  synchronize :  src : fio-output/  dest : notebook/fio-output/poll_source-on  mode : pull -  hosts : hosts  tasks :  -  name : stop vm  virt :  name : test  state : shutdown</p><p> ---  - 主机：主机任务： -  include_tasks：tasks / build-qemu.yml vars： - 回购：https：//gitlab.com/qemu-project/qemu.git  - 版本：v6.0.0  - 名称：创建磁盘图片include_tasks：任务/ virt-builder-create-image.yml vars：--os_version：fedora-34  - 大小：32g  - 输出：/var/lib/libvirt/images/test.img  - 格式：raw  -  name：build guest内核include_tasks：任务/ build-kernel.yml vyml名称：测试状态：shutdown ignore_errors：yes  -  name：start vm include_tasks：任务/ start-vm.yml vars： -  XML：＆＃34; {{查找（＆＃39;文件＆＃39 ;,＆＃39;文件/的test.xml＆＃39;）}}＆＃34; - 主机：192.168.122.192  - 主机：VMS任务： - 名称：安装FIO和rsync DNF：状态：当前名称： -  fio  -  rsync  - 名称：运行fio脚本：files / fio.sh  - 名称：获取fio输出文件同步：SRC：FIO-Output / DEST：笔记本/ FIO-Output / Poll_source-Off模式：拉 - 姓名：运行FIO脚本：文件/ fio.sh -Enable  - 名称：获取FIO输出文件同步：SRC：FIO输出/ dest：笔记本/ fio-output / poll_source-on模式：pull  -  hosts：hosts任务： - 名称：stop vm adv：name：test状态：关机</p><p> An important point is that the Ansible playbook sets up the full environment, runs all benchmarks, and collects the results. Unlike a playbook that runs a single benchmark this one runs the full suite so that the playbook captures the entire environment that produced the results. This distinction is important when tweaking the benchmark configuration or trying out proof-of-concept optimizations. Each git commit needs to encompass the full environment so that the performance investigation is reproducible and can be resumed in the future.</p><p> 一个重要的一点是Ansible PlayBook设置完整环境，运行所有基准，并收集结果。与运行单个基准测试的PlayBook不同，此一个运行全套套件，以便PlayBook捕获产生结果的整个环境。在调整基准配置或尝试概念验证优化时，这种区别非常重要。每个Git提交都需要包含完整的环境，以便性能调查是可重复的，并可在将来恢复。</p><p>  I recently started using  JupyterLab notebooks for data analysis. It provides a convenient environment for graphing results and organizing them in documents.</p><p>  我最近开始使用jupyterlab笔记本电脑进行数据分析。它为绘制结果提供了一个方便的环境，并在文档中组织它们。 </p><p>  Thanks to the official Jupyter container images you can get a full Python data analysis environment running with just one command:</p><p>感谢jupyter容器图像的官方jupyter容器图像，您可以使用只需一个命令运行的完整Python数据分析环境：</p><p>  So far I have only scratched the surface of JupyterLab. It works well for visualizing data although the way I currently use it is not much different from writing a Python matplotlib script and running it from the command-line. In time I&#39;ll get a better appreciation for its strengths and weaknesses.</p><p>  到目前为止，我只划伤了jupyterlab的表面。它适用于可视化数据，尽管我当前使用的方式与写Python Matplotlib脚本并从命令行运行它并不大。在时间我和＃39; LL对其优势和劣势来更好地欣赏。</p><p>  A git-based workflow that automates benchmark setup and stores the results goes a long way towards mitigating the high overhead of performance investigations. If I&#39;m interrupted or need to switch to a different machine it&#39;s easy to resume the investigation. Having the results and details of the environment stored together makes it possible to revisit benchmark runs in the future to reproduce or tweak them. The combination of git, Ansible, and Jupyter achieves this workflow quite well, but if you&#39;re familiar with other tools I&#39;d love to hear!</p><p>  基于GIT的工作流程，自动化基准设置和存储结果可以很长的路要减轻性能调查的高度开销。如果i＆＃39; m中断或需要切换到不同的机器＆＃39;很容易恢复调查。具有存储在一起的环境的结果和细节使得可以在将来重新审视基准运行以重现或调整它们。 git，ansible和jupyter的组合很好地实现了这个工作流程，但如果你熟悉其他工具i＆＃39;喜欢听到！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://blog.vmsplice.net/2021/06/my-performance-benchmarking-workflow.html">http://blog.vmsplice.net/2021/06/my-performance-benchmarking-workflow.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/基准/">#基准</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>