<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>prisma，next.js，＆postgres陷阱 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">prisma，next.js，＆postgres陷阱 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-13 02:37:29</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/5/081d1b2e4a703b50e79be48cd1b524b6.png"><img src="http://img2.diglog.com/img/2021/5/081d1b2e4a703b50e79be48cd1b524b6.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在本周初，我在一个项目上完成了一些最终触摸，即我＆＃39; d一直在工作几周。在旨在构建此项目时，我的初步决定是下一个问题，因为我真的很喜欢反应。我听到了很多关于prisma的有趣的东西，所以我以为我＆＃39; d给出了镜头。当它来到数据库时，没有那么多选择，所以我和PostgreSQL一起去过我最舒服的那个，因为PRISMA大多支持SQL数据库（尽管他们有MongoDB适配器即将到来）。</p><p> 在发展中，这一切都是微风。创建模式非常容易，运行迁移，并使用prisma客户端。这几乎是真的太好了。当它来部署到Vercel的一切，那个问题开始时。</p><p>   部署到生产后，一点读一下人们通常被托管的Postgres数据库，而DigitaloCean似乎是一个非常好的替代方案。与他们的＆＃34; 1点击＆＃34;解决方案，我真的很快得到了一个生产就绪的数据库，并运行。我在这里遇到的问题是在部署到Vercel并使用API​​路由的无服务器中。问题是，数据库的活动连接数量将在几分钟后真正飙升。</p><p>  解决方案是为数据库设置一个名为Connection Pools的东西。在Digitalocean中，这真的很容易，你可以在这里阅读更多信息。在那里这个真正的伟大的YouTube视频，Prisma（Daniel Norman）的员工经历了如何解决这个问题。</p><p>   我遇到的另一个问题是我拥有我所有的服务，下一个服务，下一个问题，下一个问题.js API路由和数据库部署在不同的地理位置中。在降低请求运行所需的时间时，这效果非常重要。</p><p>  您希望确保您在大致相同的地理区域找到所有服务（彼此越越好）。在这里，您可以了解如何为Next.js客户端设置您所在的地区，并且您可以在此处阅读有关如何为API路由执行的信息。不幸的是，如果您在专业团队计划中，您只能设置API路线的地理位置。我认为这是一个漂亮的迫切举动。</p><p>   最后一个但可能是最大的，我遇到的问题是使用下一个验证进行身份验证。事实证明，当使用Neut-auth使用基于会话的身份验证时，API路由的执行时间大大慢，而不是使用基于JWT的身份验证时。 </p><p>如果您＆＃39，则要确保您手动选择基于JWT的身份验证;重新使用Next-Auth作为身份验证处理程序。在这里，您可以阅读更多关于Neut-Auth和JWT＆＃39; s的信息，您可以看到如何使用JSON Web令牌而不是会话实际保护您的API路由。</p><p>  使用现代但未经测试的堆栈将永远具有挑战性。我真的很喜欢使用这个堆栈（特别是在开发模式中），因此在进行生产时遇到了这么多问题时非常沮丧。几件事，我仍然发现有点讨厌，但我可以＆＃39; t真的逃脱了：</p><p> 加入（＆＃34;包括＆＃34;在prisma中）将为执行时间添加一定数量的额外延迟。我认为你必须通过做大量包括或者是否想要在客户端上做更多的请求来为自己提供某种评估。</p><p> 如果您想了解有关发现这些问题，解决方案和测量的过程的更多信息，您可以查看此GitHub问题。而且，如果您喜欢这种内容，您可以在Twitter @alingroen上关注我。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.albingroen.com/posts/prisma-nextjs-and-postgres-pitfalls">https://blog.albingroen.com/posts/prisma-nextjs-and-postgres-pitfalls</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/postgres/">#postgres</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数据库/">#数据库</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1055056.html"><img src="http://img2.diglog.com/img/2021/3/thumb_cc6bc33f06fe2cf0cd6654977fcbb535.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1055056.html">使用postgres作为cron </a></div><span class="my_story_list_date">2021-3-30 0:26</span></div><div class="col-sm"><div><a target="_blank" href="/story/1052964.html"><img src="http://img2.diglog.com/img/2021/3/thumb_cc6bc33f06fe2cf0cd6654977fcbb535.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052964.html">使用Postgres为强大的Cron系统 </a></div><span class="my_story_list_date">2021-3-17 19:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1052224.html"><img src="http://img2.diglog.com/img/2021/3/thumb_e167e44f3501bde03fe9c5d9449a65cf.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052224.html">使用Citus开源碎片重对者扩展Postgres </a></div><span class="my_story_list_date">2021-3-14 4:19</span></div><div class="col-sm"><div><a target="_blank" href="/story/1051054.html"><img src="http://img2.diglog.com/img/2021/3/thumb_1e4aa0c9f9e5ded7eae59321f29ae2ce.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1051054.html">清理您的Postgres数据库 </a></div><span class="my_story_list_date">2021-3-7 11:57</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>