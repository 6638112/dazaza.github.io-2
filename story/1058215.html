<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rust Shenanigans：返回类型多态性 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Rust Shenanigans：返回类型多态性 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-14 06:15:10</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/5f51a4ac5145cb45dc8076a5f03b919e.png"><img src="http://img2.diglog.com/img/2021/4/5f51a4ac5145cb45dc8076a5f03b919e.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在本文中，我将描述生锈返回类型多态性（A.K.A.通用返回），这是我最近发现的功能，并且我一直很感兴趣。</p><p> 我在编程语言中第一次看到这个功能，乍一看，它似乎是某种内置编译器魔法，仅在标准库中可用。实际上，它是一般性的功能，您可以每天使用您自己的代码。</p><p> 请记住，我仍然是一个初学者的生锈，所以我的描述可能不是最准确的，但我会尝试说明为什么我喜欢这个功能以及它如何使用一些示例。希望你会发现这个话题像我一样有趣！</p><p>   在尝试解释实际上是什么返回类型的多态性之前，请让我向您展示一些有趣的例子，如果您已经逃离生锈，您可能会熟悉：</p><p> 用    ; fn main（）{让nums = [2,17,22,48,1997,2,22];让nums_square_no_dups：＆lt; I32＆gt; = nums。 iter（）。地图（| x | x * x）。搜集 （ ） ; println！ （＆＃34; {：？}＆＃34;，nums_square_no_dups）; // {2304,484,3988009,4,289}}}}}}}}}</p><p> 好的，你看到了吗？我的意思是，世界上如何收集（）弄清楚我想从迭代器中“收集”值到整数的哈希集？的确，它给了我一个整数的哈希集！</p><p> 不相信？我们也可以轻微更改这个例子，看看会发生什么......让我们尝试使用VEC： </p><p>fn main（）{让nums = [2,17,22,48,1997,2,22];让nums_square：＆lt; I32＆gt; = nums。 iter（）。地图（| x | x * x）。搜集 （ ） ; println！ （＆＃34; {：？}＆＃34; nums_square）; // [4,289,484,2304,3988009,4,484]}</p><p> 好的，没有再删除重复的重复，它保留了元素的顺序，但这不是重点！重点是收集（）仍在给我们我们想要的东西。这次我们要求VEC，事实上，我们得到了一个VEC而不是散列画面。</p><p> 请注意，此代码与前一个代码几乎相同。除了类型声明（以及变量名称，而是无关紧要），我们没有更改以外的任何内容！</p><p> 此外，请记住，虽然生锈可以推断您的类型，但大多数情况下，您无需提供显式类型定义，当使用Collect（）所需的类型定义时。</p><p>  fn main（）{让nums = [2,17,22,48,1997,2,22];让nums_square = nums。 iter（）。地图（| x | x * x）。搜集 （ ） ; }</p><p> 此示例不会编译，因为收集不知道是什么是返回类型，因此我们得到了这个漂亮的错误：</p><p> 错误[e0282]：所需的型注释 - ＆gt; src / main.rs：3：9 | |假设nums_square = nums.iter（）。地图（| x | x * x）.collect（）; | ^^^^^^^^^^^^考虑给出`nums_square`一种类型 </p><p>我希望你开始搞定这一点。 recoll（）等一些功能可以根据预期的回报类型表现不同！返回类型需要显式，因此Rust编译器可以为您选择合适的行为。</p><p> 好的，这是在编码挑战时我在生锈中学到的第一个东西之一，我一直在想一段时间“这只是一些迭代器魔法，它可能只适用于几种标准类型”......</p><p> 然后，最近我看到了一些这样做的代码是这样做的：</p><p> fn main（）{让答：u8 = :: default（）;让B：i64 = :: default（）;让C：= :: default（）;让D：（U16，USIZIZE）=（:: default（），:: default（））; DBG！ （一种 ） ; // a = 0 dbg！ （b）; // b = 0 dbg！ （C ） ; // c =＆＃34;＆＃34; DBG！ （d）; // d =（0,0）}</p><p>  是的，没令人印象深刻，我知道......但是再次，我们总是称之为相同的函数，这次默认:: default（），它为我们提供了我们需要的特定类型的默认值！</p><p> 在所有诚实中，我几乎瞥了一眼这个思考它是一个其他漂亮的铁锈编译时间魔法，适用于内置类型。直到我注意到一小笔记“顺便说一下，如果要”，您可以为您的自定义类型带来默认值“。</p><p>  struct {x：f64，y：f64，z：f64，} //它＆＃39; syeas pal，只需实现`默认的{fn default（） - ＆gt;＆gt; self {{x：0_f64，y：0_f64，z：0_f64，}} fn main（）{let origin：= :: default（）; println！ （＆＃34; {：？}＆＃34;，起源）; // point3d {x：0.0，y：0.0，z：0.0}} </p><p>默认特性允许您定义自定义类型的默认值。特性迫使您实现一个默认（）方法，该方法必须返回给定类型（self）的实例。</p><p> 再一次，没有什么非常令人兴奋的......除了这一点，我的头部点击了，我开始问自己“所以这是每个人都可以使用的一些概括的功能......”。</p><p> 我的怀疑是默认:: default（）函数可以以某种方式以某种方式推断出预期的返回类型，如果该类型实现默认特征，那么它只需调用该类型的默认值（）函数。</p><p> 当然，我立即去了，寻找默认的实际实现:: default（）来验证我的猜测。</p><p> 现在，我不会要求我理解100％（那里有一些可爱的宏，我的大脑无法编译那些人），但我有一种感觉，我猜测了我是正确的道路。</p><p>    T有一个约束：只要它实现默认特征，它可以是任何类型</p><p> 最后（这是重要点），t是默认:: default（）必须返回的类型 </p><p>这就是魔法来自的地方。 实现实际上是返回类型的泛型。 此外，通过使用默认的特征约束，我们可以具有可扩展的定义：任何人都可以实现使用默认值:: default（）使用的新类型。 更稍后更多......  现在，这是摘要的足够的理论，让我们试着用它做点什么！  多年来，我了解到，当我可以建立使用它们时，我的大脑可以欣赏新的编程概念。 所以，我卷起了我的袖子，开始思考“好的，我能用这可以建立什么？”  我想，这里的一个好问题是“我什么时候想根据不同的预期回报类型做不同的东西？”  我想出了一个与棋盘游戏相关的简单想法。 像D＆amp; D的东西，你有不同的骰子（不同数量的面）。  我们可以使用返回型多态性能够滚动不同类型的骰子吗？  我想我们可以！ 这是越来越多的我用我的第一次尝试做了什么： </p><p>使用{thread_rng，};特质＆lt; ＆gt; {fn roll（） - ＆gt; ; }结构（U8）;结构（U8）; struct {} impl＆lt; D6和GT;对于{fn roll（） - ＆gt; d6 {d6 {0：thread_rng（）。 gen_range（1 .. = 6），}}} IMPL＆LT; D8＆gt;对于{fn roll（） - ＆gt; d8 {d8 {0：thread_rng（）。 gen_range（1 .. = 8），}}}}}}}}} fn main（）{//＆＃39; s roll a d6让roll：d6 = :: roll（）; println！ （＆＃34; {：？}＆＃34;，卷）; // d6（3）//让＆＃39; s卷d8让roll：d8 = :: roll（）; println！ （＆＃34; {：？}＆＃34;，卷）; // d8（3）}</p><p> 为简单起见，我只显示了我实现了D6和D8的方式。如果您想要完整版本，请查看我的D＆amp; D骰子生锈游乐场。</p><p> 此实现的有趣部分是我有2个不同的实现对于函数Die :: roll（），返回D6（6面板）滚动，另一个返回D8（8面向芯片）卷。</p><p> Rust将根据该调用的预期返回类型自动调用正确的实现。</p><p>    我的意思是，如果我将这段代码转换为库，有人需要使用100个面孔的自定义模具？或者如果他们想要一个总是滚动100的伎俩怎么办？</p><p>   好吧，这几乎是默认的::默认（）是这样的，所以它应该是可能的，对吧？</p><p>  现在，这种roll（）的实现只需要在t的当前类型上使用旋转性状 </p><p>这个想法不是真正的原创。我们几乎模仿默认:: default（）对特性默认值的默认值，除了它们的命名选择可能稍微令人困惑，因为模块，功能和特征都被称为默认值😰...</p><p>  使用{thread_rng，}; ///这是每个骰子需要实施的特质......＆＃34; rollable＆＃34;，吧？酒吧特征{///滚动模具fn roll（） - ＆gt;自己 ; ///从最新的卷FN Val（＆amp; self） - ＆gt; U8; } ///滚动给定芯片的通用功能。 PUB FN ROLL＆LT; ：＆gt; （） - ＆gt; {:: roll（）//＆lt;  - 请注意，这里的rollable`是给定呼叫的当前类型！ } /// D6模具（6个面）：卷会给你一个“U8”在“1”中。酒吧结构（U8）; ichar for d6 {fn roll（） - ＆gt; d6 {d6 {0：thread_rng（）。 gen_range（1 .. = 6），}} Fn Val（＆amp; self） - ＆gt; U8 {self。 0}} ///一个D8模具（8个面）：滚动会给你一个“U8”在“1”中。= 8号码。酒吧结构（U8）; ichar for d8 {fn roll（） - ＆gt; d8 {d8 {0：thread_rng（）。 gen_range（1 .. = 8），}} fn val（＆amp; self） - ＆gt; U8 {self。 0}}</p><p> 这几乎是它，现在我们可以尽可能地使用我们的D6和D8：</p><p> fn main（）{//＆＃39; s roll a d6让R：D6 = roll（）; println！ （＆＃34; {：？}＆＃34;，r）; // d6（3）//让＆＃39; s roll a d8设r：d8 = roll（）; println！ （＆＃34; {：？}＆＃34;，r）; // d8（3）}</p><p>  结构（U8）; ichar for {fn roll（） - ＆gt; {{0：100} //＆lt;  - 强制它滚动100} fn val（＆amp; self） - ＆gt; U8 {self。 0}} fn main（）{println！ （＆＃34;我敢打赌我＆＃39;这次得到100百岁！＆＃34;）;假设d：= roll（）; println！ （＆＃34;看看我得到了什么：{}！＆＃34;，d。val（））//＆lt;  - 是的，这将永远是100}</p><p>  我实际上确实最终将此愚蠢的示例发布为库。一探究竟。谁知道，也许你真的想要实施某种棋盘游戏！</p><p>   我们已经看到，当函数使用返回类型多态性时，我们需要明确声明预期的类型。 </p><p>如果您想调用实现返回类型多态性的函数，但您不想分配它？让我们说我们要立即使用返回的值，也许是另一个函数调用的参数。</p><p>    事实上，它没有！如果您尝试编译该代码，您将获得一个美丽的错误消息：</p><p> 错误[e0282]：所需的型注释 - ＆gt; SRC / MAIN.RS：47：23 | | Println！（＆＃34; {：？}＆＃34;，roll（））; | ^^^^无法在函数`t`声明的类型参数`t`中的类型</p><p> 编译器还建议运行rustc  - 例如如何解决如何解决此问题的详细指南。你必须把它交给铁锈队，他们在提供了伟大的文件方面做了如此巨大的工作！</p><p> 现在，如果您患者足够运行该命令并阅读指南，您会发现我们可以用所谓的涡轮类鱼类语法来解决这个问题！</p><p> Turbo-Fish语法看起来像......鱼：::＆lt; ......是的，有一定程度的想象力！</p><p> 因此，这是我们如何实际使用它来指定通用参数的类型： </p><p>无论如何，通过这种语法，参数t的类型不再含糊不清：我们明确说我们想要D6！  实际上，Turbo Fish是具有通用类型的函数的扩展语法，除了我们使用良好定义的类型进行分配时，Rust编译器足够智能以推断通用参数的类型，使我们的生活更轻松。  我希望你找到这个主题（和这篇文章！）尽可能有趣，并且感觉不仅仅是欢迎您在评论中告诉我，如果您已经了解了此功能。 您是否已经在某处使用它？ 我真的很想知道你的用例，所以请与我分享♥  如果您想要一个更加抛光和详细的解释，请查看此杰出博客的杰出博客，詹姆斯··················克拉兰返回生锈返回。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://loige.co/rust-shenanigans-return-type-polymorphism/">https://loige.co/rust-shenanigans-return-type-polymorphism/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/rust/">#rust</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/类型/">#类型</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1058154.html"><img src="http://img2.diglog.com/img/2021/4/thumb_c014edf17b3c7616e9b9416aef2beb32.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1058154.html">Rust，不是Firefox，是Mozilla最大的行业贡献 </a></div><span class="my_story_list_date">2021-4-14 3:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1057973.html"><img src="http://img2.diglog.com/img/2021/4/thumb_ffb174940b931619378c302fd3d710b8.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1057973.html">参议员Josh Hawley推出了一个针对大型技术的提案，这些建议将由市场上限超过100亿美元的公司升起反托拉斯法律和禁止收购 </a></div><span class="my_story_list_date">2021-4-13 9:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1057579.html"><img src="http://img2.diglog.com/img/2021/4/thumb_ab6bd500bdfa401827ea2eca77b8e213.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1057579.html">阿里巴巴以$ 2.7b反托拉斯罚款拍打 </a></div><span class="my_story_list_date">2021-4-11 9:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1057497.html"><img src="http://img2.diglog.com/img/2021/4/thumb_3dc97996f8c6e52ebf4cb8aa5594fb1c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1057497.html">掌握生锈的所有权 </a></div><span class="my_story_list_date">2021-4-10 22:38</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>