<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>尾部延迟可能超过您的想法 Tail latency might matter more than you think</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Tail latency might matter more than you think<br/>尾部延迟可能超过您的想法 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-20 15:05:00</div><div class="page_narrow text-break page_content"><p>Tail latency, also known as  high-percentile latency, refers to high latencies that clients see fairly infrequently. Things like: &#34;my service mostly responds in around 10ms, but sometimes takes around 100ms&#34;. There are many causes of tail latency in the world, including contention, garbage collection, packet loss, host failure, and weird stuff operating systems do in the background. It&#39;s tempting to look at the 99.9th percentile, and feel that it doesn&#39;t matter. After all, 999 of 1000 calls are seeing lower latency than that.</p><p>尾部延迟，也称为高百分点，指客户客户相当不经常看到的高延迟。像：＆＃34;我的服务大多数在10毫秒响应，但有时需要大约100ms＆＃34;世界上有许多原因的尾部延迟，包括争用，垃圾收集，丢包，主机故障和奇怪的东西操作系统在后台做。它＆＃39;诱人看99.9百分位数，并觉得它不起作用。毕竟，1000个呼叫中的999个看起来比该延迟更低。</p><p> Unfortunately, it&#39;s not that simple. One reason is that modern architectures (like microservices and SoA) tend to have a lot of components, so one user interaction can translate into many, many, service calls. A common pattern in these systems is that there&#39;s some  frontend, which could be a service or some Javascript or an app, which calls a number of backend services to do what it needs to do. Those services then call other services, and so on. This forms two kinds of interactions: parallel fan-out, where the service calls many backends in parallel and waits for them all to complete, and serial chains where one service calls another, which calls another, and so on.</p><p> 不幸的是，它＆＃39;没有那么简单。一个原因是现代架构（如微服务和SOA）倾向于有很多组件，因此一个用户交互可以转换为许多，许多服务呼叫。这些系统中的常见模式是有些前端，这可能是服务或一些JavaScript或App，它调用了一些后端服务来执行它需要的工作。然后那些服务调用其他服务，等等。这形成了两种交互：并行扇出，服务调用许多后端并行，并等待全部完成，并且串行链接调用另一个服务，拨打另一个服务，拨打另一个服务。</p><p>   To understand why, let&#39;s do a simple numerical experiment. Let&#39;s simplify the world so that all services respond with the same latency, and that latency follows a very simple bimodal distribution: 99% of the time with a mean of 10ms (normally distributed with a standard deviation of 2ms), and 1% of the time with a mean of 100ms (and SD of 10ms). In the real world, service latencies are almost always multi-modal like this, but typically not just a sum of normal distributions (but that doesn&#39;t matter here).</p><p>   理解为什么，让＆＃39; s做一个简单的数值实验。让＆＃39; s简化了世界，使所有服务以相同的延迟响应，并且延迟遵循一个非常简单的双峰分布：99％的时间为10ms（通常以2ms的标准偏差分布），以及1％的时间为100ms（和10ms）的平均值。在现实世界中，服务延迟几乎总是像这样的多模态，但通常不仅仅是正常分布的总和（但是这里没有重要）。</p><p>  First, let&#39;s consider parallel calls. The logic here is simple: we call N services in parallel, and wait for the slowest one. Applying our intuition suggests that as N increases, it becomes more and more likely that we&#39;ll wait for a ~100ms  slow call. With N=1, that&#39;ll happen around 1% of the time. With N=10, around 10% of the time. In this simple model, that basic intuition is right. This is what it looks like:</p><p>  首先，让＆＃39; s考虑并行呼叫。这里的逻辑很简单：我们并行调用n个服务，并等待最慢的一个。应用我们的直觉表明，随着n的增加，它变得越来越有可能＆＃39; ll等待〜100ms慢呼叫。 n = 1，那个＆＃39; ll发生在1％的时间左右。 n = 10，约10％的时间。在这个简单的模型中，基本的直觉是对的。这是它的样子：</p><p>  The tail mode, which used to be quite rare, starts to dominate as N increases. What was a rare occurrence is now normal. Nearly everybody is having a bad time.</p><p>  尾部模式，用于非常罕见的尾部模式开始占据主导地位。什么是罕见的发生现在正常。几乎每个人都有糟糕的时间。</p><p>  Serial chains are a little bit more interesting. In this model, services call services, down a chain. The final latency is the sum of all of the service latencies down the chain, and so there are a lot more cases to think about: 1  slow service, 2 slow services, etc. That means that we can expect the overall shape of the distribution to change as N increases. Thanks to the central limit theorem we could work out what that looks like as N gets large, but the journey there is interesting too.</p><p>  串行链有点有趣。在此模型中，服务呼叫服务，沿着链条。最终延迟是链条下所有服务延迟的总和，因此有很多案例才能考虑：1慢速服务，2次慢速服务等意味着我们可以期待分发的整体形状随着n的变化增加。由于中央限制定理，我们可以弄清楚，这看起来像n变大，但旅程也很有趣。</p><p> Here, we&#39;re simulating the effects of chain length on the latency of two different worlds. One  Tail world which has the bimodal distribution we describe above, and one  No Tail world which only has the primary distribution around 10ms.</p><p> 在这里，我们＆＃39;重新模拟链长对两个不同世界延迟的影响。一条尾部世界，具有我们上面描述的双峰分布，而且没有尾部世界，只有10毫秒的主要分布。 </p><p>  Again, the tail latency becomes more prominent here. That relatively rare tail increases the variance of the distribution we&#39;re converging on by a factor of 25. That&#39;s a huge difference, caused by something that didn&#39;t seem too important to start with.</p><p>同样，尾部延迟在这里变得更加突出。相对稀有的尾部增加了我们＆＃39的分布的变化</p><p> Choosing Summary StatisticsOne way that this should influence your thinking is in how you choose which latency statistics to monitor. The truth is that no summary statistic is going to give you the full picture. Looking at histograms is cool, but tends to miss the time component. You could look at some kind of windowed histogram heat map, but probably won&#39;t. Instead, make sure you&#39;re aware of the high percentiles of service latency, and consider monitoring common customer or client use-cases and monitoring their end-to-end latency experience.</p><p> 选择摘要统计信息方式，这应该影响您的思想，是如何选择要监控的延迟统计信息。事实是，没有摘要统计会给你完整的照片。看着直方图很酷，但往往会错过时间分量。你可以看一下某种窗口直方图热图，但可能赢得了＆＃39; t。相反，确保您＆＃39;重新了解服务延迟的高百分比，并考虑监控普通客户或客户使用情况并监控其结束延迟体验。</p><p> Trimmed means, winsorized means, truncated means, interquartile ranges, and other statistics which trim off some of the tail of the distribution seem to be gaining in popularity. There&#39;s a lot to like about the trimmed mean and friends, but cutting off the right tail will cause you to miss effects where that tail is very important, and may become dominant depending on how clients call your service.</p><p> 修剪的装置，Winsorized手段，截断的装置，狭义式范围，以及修剪分布的一些尾部的其他统计数据似乎是普及。有很多关于修剪的卑鄙和朋友的很多，但切断右尾部会导致你错过的是那个尾巴非常重要的效果，可能会取决于客户如何称呼您的服务。</p><p> I continue to believe that if you&#39;re going to measure just one thing, make it  the mean. However, you probably want to measure more than one thing.</p><p> 我继续相信，如果你＆＃39;重新衡量一件事，让它变得平均值。但是，你可能想要衡量多件事。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://brooker.co.za/blog/2021/04/19/latency.html">https://brooker.co.za/blog/2021/04/19/latency.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/延迟/">#延迟</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/latency/">#latency</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>