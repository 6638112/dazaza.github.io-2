<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>PGSync现在是开源的</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">PGSync现在是开源的</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-30 12:28:49</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/7bc591502507dff65f9a0b11cd23fd5f.jpeg"><img src="http://img2.diglog.com/img/2020/10/7bc591502507dff65f9a0b11cd23fd5f.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>PGSync is a middleware for syncing data from  Postgres to  Elasticsearch effortlessly.It allows you to keep  Postgres as your source of truth andexpose structured denormalized documents in  Elasticsearch.</p><p>PGSync是一个将Postgres中的数据毫不费力地同步到Elasticsearch的中间件，它允许您将Postgres作为您的真实源，并在Elasticsearch中创建结构化的非规范化文档。</p><p> Changes to nested entities are propagated to  Elasticsearch.PGSync&#39;s advanced query builder then generates optimized SQL querieson the fly based on your schema.PGSync&#39;s advisory model allows you to quickly move and transform large volumes of data quickly whilst maintaining relational integrity.</p><p>对嵌套实体的更改会传播到Elasticsearch。PGSync的高级查询构建器随后会根据您的架构动态生成优化的SQL查询。PGSync的咨询模型允许您快速移动和转换大量数据，同时保持关系完整性。</p><p> Simply describe your document structure or schema in JSON and  PGSync willcontinuously capture changes in your data and load it into  Elasticsearchwithout writing any code. PGSync transforms your relational data into a structured document format.</p><p>只需用JSON描述您的文档结构或模式，PGSync将持续捕获数据中的更改并将其加载到Elasticsearch中，而无需编写任何代码。PGSync将您的关系数据转换为结构化文档格式。</p><p> It allows you to take advantage of the expressive power and scalability of Elasticsearch directly from  Postgres.You don&#39;t have to write complex queries and transformation pipelines.PGSync is lightweight, flexible and fast.</p><p>它允许您直接从Postgres利用Elasticsearch的表达能力和可扩展性。您不必编写复杂的查询和转换流水线。PGSync是轻量级、灵活和快速的。</p><p> Elasticsearch is more suited as as secondary denormalised search engine to accompany a more traditional normalized datastore.Moreover, you shouldn&#39;t store your primary data in  Elasticsearch.</p><p>ElasticSearch更适合作为次要的非规范化搜索引擎，以配合更传统的规范化数据存储。此外，您不应该将主要数据存储在Elasticsearch中。</p><p> So how do you then get your data into  Elasticsearch in the first place?Tools like  Logstash and  Kafka can aid this task but they still require a bitof engineering and development.</p><p>那么，首先如何将数据放到Elasticsearch中呢？Logstash和Kafka等工具可以帮助完成这项任务，但它们仍然需要一些工程和开发工作。</p><p> Extract Transform Load and  Change data capture tools can be complex and require expensive engineering effort.</p><p>提取、转换、加载和变更数据捕获工具可能很复杂，并且需要昂贵的工程工作。</p><p>      At a high level, you have data in a Postgres database and you want to mirror it in Elasticsearch. This means every change to your data (  Insert,   Update,   Delete and   Truncate statements) needs to be replicated to Elasticsearch.At first, this seems easy and then it&#39;s not. Simply add some code to copy the data to Elasticsearch after updating the database (or so called dual writes).Writing SQL queries spanning multiple tables and involving multiple relationships are hard to write.Detecting changes within a nested document can also be quite hard.Of course, if your data never changed, then you could just take a snapshot in time and load it into Elasticsearch as a one-off operation.</p><p>在较高级别上，您在Postgres数据库中有数据，并且希望将其镜像到Elasticsearch中。这意味着数据的每个更改(INSERT、UPDATE、DELETE和TRUNCATE语句)都需要复制到Elasticsearch。只需在更新数据库后添加一些代码将数据复制到Elasticsearch(或所谓的双重写入)。编写跨越多个表并涉及多个关系的SQL查询很难编写。检测嵌套文档中的更改也可能相当困难。当然，如果您的数据从未更改，则只需及时拍摄快照并将其作为一次性操作加载到Elasticsearch即可。</p><p>  You have existing data in a relational database such as  Postgres and you needa secondary NoSQL database like  Elasticsearch for text-based queries or autocomplete queries to mirror the existing data without having your application perform dual writes.</p><p>您在Postgres等关系数据库中已有数据，并且需要一个辅助NoSQL数据库(如Elasticsearch)来执行基于文本的查询或自动完成查询，以镜像现有数据，而无需您的应用程序执行双重写入。</p><p> You want to keep your existing data untouched whilst taking advantage ofthe search capabilities of  Elasticsearch by exposing a view of your data without compromising the security of your relational data.</p><p>您希望保持现有数据不受影响，同时通过公开数据视图而不影响关系数据的安全性来利用Elasticsearch的搜索功能。</p><p> Or you simply want to expose a view of your relational data for search purposes.</p><p>或者您只是想公开关系数据的视图以用于搜索。</p><p>  PGSync is written in Python (supporting version 3.6 onwards) and the stack is composed of:  Redis,  Elasticsearch,  Postgres, and  SQlAlchemy.</p><p>PGSync是用Python(支持3.6版以上)编写的，堆栈由：redis、Elasticsearch、postgres和SQlAlChemy组成。</p><p> PGSync leverages the  logical decoding feature of  Postgres (introduced in PostgreSQL 9.4) to capture a continuous stream of change events.This feature needs to be enabled in your  Postgres configuration file by setting in the postgresql.conf file:</p><p>PGSync利用Postgres(PostgreSQL 9.4中引入的)的逻辑解码功能来捕获连续的更改事件流。需要在Postgres配置文件中通过在postgresql.conf文件中设置来启用此功能：</p><p>    PGSync operates in an event-driven model by creating triggers for tables in your database to handle notification events.</p><p>PGSync通过为数据库中的表创建触发器来处理通知事件，从而在事件驱动模型中运行。</p><p>  NOTE:  If you change the structure of your PGSync&#39;s schema config, you would need to rebuild your Elasticsearch indices.There are plans to support zero-downtime migrations to streamline this process.</p><p>注意：如果您更改PGSync架构配置的结构，则需要重建Elasticsearch指示器。我们计划支持零停机迁移以简化此过程。</p><p>          Enable logical decoding. you would also need to set up at least two parameters at postgresql.conf</p><p>启用逻辑解码。您还需要在postgresql.conf中至少设置两个参数</p><p> run the program with    pgsync --config schema.json or as a daemon    pgsync --config schema.json -d</p><p>使用pgsync--config schema.json或作为守护进程pgsync--config schema.json-d运行该程序。</p><p>   Transactionally consistent output in Elasticsearch. This means: writes appear only when they are committed to the database, insert, update and delete operations appear in the same order as they were committed (as opposed to eventual consistency).</p><p>Elasticsearch中的事务一致输出。这意味着：写入只有在提交到数据库时才会出现，插入、更新和删除操作的顺序与提交时的顺序相同(与最终的一致性相反)。</p><p> Fault-tolerant: does not lose data, even if processes crash or a network interruption occurs, etc. The process can be recovered from the last checkpoint.</p><p>容错：即使进程崩溃或网络中断等，也不会丢失数据。进程可以从上一个检查点恢复。</p><p>   Supports an arbitrary depth of nested entities i.e Tables having long chain of relationship dependencies.</p><p>支持任意深度的嵌套实体，即具有长关系依赖链的表。</p><p> Supports Postgres JSON data fields. This means: we can extract JSON fields in a database table as a separate field in the resulting document.</p><p>支持Postgres JSON数据字段。这意味着：我们可以将数据库表中的JSON字段提取为结果文档中的单独字段。</p><p>           With PGSync, we can simply define this  JSON schema where the   book table is the pivot.A   pivot table indicates the root of your document.</p><p>使用PGSync，我们可以简单地定义这个JSON模式，其中BOOK表是透视表，透视表表示文档的根。</p><p> {   &#34;table &#34;:   &#34;book &#34;,   &#34;columns &#34;: [   &#34;isbn &#34;,   &#34;title &#34;,   &#34;description &#34; ],   &#34;children &#34;: [ {   &#34;table &#34;:   &#34;author &#34;,   &#34;columns &#34;: [   &#34;name &#34; ] } ]}</p><p>{&#34；表&#34；：&#34；书&#34；，&#34；列&#34；：[&#34；ISBN&#34；，&#34；标题&#34；，&#34；描述&#34；]，&#34；儿童&#34；：[{&#34；表&#34；：&#34；作者&#34；，&#34；列&#34；：[&#34；名称&#34；]}]}。</p><p>  [ {   &#34;isbn &#34;:   &#34;9785811243570 &#34;,   &#34;title &#34;:   &#34;Charlie and the chocolate factory &#34;,   &#34;description &#34;:   &#34;Willy Wonka’s famous chocolate factory is opening at last! &#34;,   &#34;authors &#34;: [  &#34;Roald Dahl &#34;] }, {   &#34;isbn &#34;:   &#34;9788374950978 &#34;,   &#34;title &#34;:   &#34;Kafka on the Shore &#34;,   &#34;description &#34;:   &#34;Kafka on the Shore is a 2002 novel by Japanese author Haruki Murakami &#34;,   &#34;authors &#34;: [  &#34;Haruki Murakami &#34;,   &#34;Philip Gabriel &#34;] }, {   &#34;isbn &#34;:   &#34;9781471331435 &#34;,   &#34;title &#34;:   &#34;1984 &#34;,   &#34;description &#34;:   &#34;1984 was George Orwell’s chilling prophecy about the dystopian future &#34;,   &#34;authors &#34;: [  &#34;George Orwell &#34;] }]</p><p>[{&#34；ISBN&#34；：&#34；9785811243570&#34；，&#34；标题&#34；：&#34；查理和巧克力工厂&#34；，&#34；描述&#34；威利·旺卡著名的巧克力工厂终于开业了！&#34；，&#34；作者&#34；：[&#34；罗尔德·达尔&34；]}，{#34；ISBN&#34；：&#34；9788374950978&#34；，&#34；标题&#34；：&#34；Kafka on the Shore&#34；描述&#34；：&#34；Kafka on the Shore是日本作家村上春树2002年的小说，{&#34；，&#34；作者&#34；：[&#34；村上春树&#34；，&#34；菲利普·加布里埃尔&#34；]}，{&#34；ISBN&#34；：&#34；9781471331435&#34；，&#34；标题&#34；：&#34；，&#34；描述&#34；：&#34；1984年是乔治·奥威尔关于反乌托邦未来的令人不寒而栗的预言#34；，&#34；作者&#34；：[&#34；乔治·奥威尔&#34；]}]</p><p>  SELECT JSON_BUILD_OBJECT(   &#39;isbn &#39;,  book_1. isbn,   &#39;title &#39;,  book_1. title,   &#39;description &#39;,  book_1. description,   &#39;authors &#39;,  anon_1. authors )  AS   &#34;JSON_BUILD_OBJECT_1 &#34;,  book_1. id FROM book  AS book_1 LEFT OUTER JOIN ( SELECT JSON_AGG( anon_2. anon)  AS authors,  book_author_1. book_isbn  AS book_isbn  FROM book_author  AS book_author_1  LEFT OUTER JOIN ( SELECT  author_1. name  AS anon,  author_1. id  AS id  FROM author  AS author_1)  AS anon_2  ON  anon_2. id  =  book_author_1. author_id  GROUP BY  book_author_1. book_isbn)  AS anon_1  ON  anon_1. book_isbn  =  book_1. isbn</p><p>选择JSON_BUILD_OBJECT(&#39；ISBN&#39；，BOOK_1.ISBN，&#39；Title&#39；，BOOK_1.Title，&#39；Description&#39；，BOOK_1.Description，&#39；Authors&#39；，ANON_1.Authors)作为&#34；JSON_Build_Object_1&#34；，book_1.id from book as book_1左外部联接(选择JSON_AGG(anon_2.anon)作为作者，book_Author_1.book_ISBN作为book_ISBN from book_Author作为book_Author_1左外部联接(选择Author_1.name作为匿名，ANON_2上的AUTHER_1.ID为AUTHER_1)AS ANON_2。id=BOOK_AUTHER_1.OUTHER_ID分组BY BOOK_AUTHER_1。BOOK_ISBN)ANON_1上的AS ANON_1。BOOK_ISBN=BOOK_1。ISBN。</p><p>  {   &#34;isbn &#34;:   &#34;9781471331435 &#34;,   &#34;this_is_a_custom_title &#34;:   &#34;1984 &#34;,   &#34;desc &#34;:   &#34;1984 was George Orwell’s chilling prophecy about the dystopian future &#34;,   &#34;contributors &#34;: [  &#34;George Orwell &#34;] }</p><p>{&#34；ISBN&#34；：&#34；9781471331435&#34；，&#34；This_is_a_CUSTOM_TITLE&#34；：&#34；，&#34；Desc&#34；：&#34；1984年是乔治·奥威尔关于反乌托邦未来的令人不寒而栗的预言。#34；，&#34；贡献者&#34；：[&#34；George Orwell&#34；]}。</p><p>  What if we have lots of documents already with the same author we wanted to change the author name?</p><p>如果我们已经有很多文档具有相同的作者，我们想要更改作者姓名怎么办？</p><p>  PGSync is a simple to use out of the box solution for Change data capture.</p><p>PGSync是一种简单易用的变更数据捕获现成解决方案。</p><p>    Elasticsearch is a trademark of Elasticsearch BV, registered in the U.S. and in other countries.</p><p>Elasticsearch是Elasticsearch BV的商标，在美国和其他国家注册。</p><p>  This code is released under the  GNU Lesser General Public License, version 3.0 (LGPL-3.0). Please see  LICENSE for more details.</p><p>此代码在GNU宽松通用公共许可证3.0版(LGPL-3.0)下发布。有关更多详细信息，请参阅许可证。</p><p> You should have received a copy of the GNU Lesser General Public License along with PGSync. If not, see  https://www.gnu.org/licenses/.</p><p>您应该已经收到了与PGSync一起的GNU宽松通用公共许可证的副本。如果没有，请参阅https://www.gnu.org/licenses/.</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/toluaina/pgsync">https://github.com/toluaina/pgsync</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开源/">#开源</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/现在/">#现在</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/open/">#open</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数据/">#数据</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1032119.html"><img src="http://img2.diglog.com/img/2020/10/thumb_4626c7b9bc847cdb19c21ced1c0f07be.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032119.html">开源安全基金会在edX上推出一项新的认证计划</a></div><span class="my_story_list_date">2020-10-30 4:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1032038.html"><img src="http://img2.diglog.com/img/2020/10/thumb_eeb70b412287f99e18eb6f6f69fc0fa0.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032038.html">
SiFive的新PC使开源计算更接近现实</a></div><span class="my_story_list_date">2020-10-29 23:39</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031876.html"><img src="http://img2.diglog.com/img/2020/10/thumb_6b6739de6498c22a43a4a89275ba0e7b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031876.html">Dn2l-Dos Navigator开源项目的Linux移植</a></div><span class="my_story_list_date">2020-10-29 10:29</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031228.html"><img src="http://img2.diglog.com/img/2020/10/thumb_0c1f03d4ce6d853fbfbfa49a4f5259a2.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031228.html">ESP8266作为开源硬件</a></div><span class="my_story_list_date">2020-10-26 21:53</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>