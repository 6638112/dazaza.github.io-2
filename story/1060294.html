<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用更好的地图击败火花 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">用更好的地图击败火花 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-26 15:03:15</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/41f5cf1bcd57ee852c999a1901341c85.png"><img src="http://img2.diglog.com/img/2021/4/41f5cf1bcd57ee852c999a1901341c85.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Warning: Can only detect less than 5000 characters</p><p>在计算结束时，我们有长时间的几乎串行代码。这是为什么？从该地图的计算图中可以看到问题，从而减少作业。</p><p>  当我们下降计算时，我们将单词蒸馏成单词计数对。这是o（语料库尺寸）工作，可以是无限的并行化。但在减少步骤中，我们需要将许多小哈希图结合在一起以检索最终的HashMap。在每个级别，我们结合了一对HashMaps。在所有组合步骤中完成的总工作是O（NUM唯一单词），但要将掉落的HASHMAP对的数量与1.所以我们在结束时陷入困境，为单个工人组合最终地图。</p><p> 我们能做些什么来解决这种情况？问题源于我们的最终输出 - 从单词计算的地图 - 远远大得多串行处理。因此，无论如何，诸如地图缩小的接口，返回诸如常规的单线程Hashmap的“串行对象”（例如常规，单线程的Hashmap）被注定要在某些时候要求在一个线程上处理大O（NUM唯一单词）。</p><p> 当然，我们可以调查锁定或多线程的HashMaps，假设共享内存系统，但是每个Joe Hellerstein的“泳道”直觉，它是优选的，而是框架将本地保存到单个CPU的缓存中的框架与共享存储器方法不同，尽可能地（此偏好也适用于分布式计算）。</p><p> MAP减少依赖于以下抽象，它自然地导致单个输出“串行对象”\（u \）从类型的类型\（x \）的集合中：</p><p>\ [开始{align} \ mathrm {map}＆amp;：x \ lightarrow u \\\\\ mathrm {dreams}＆amp ;: u \ lightarrow u \ lightarrow u \ negu {senge} \] \ [\ begin {对齐} \ mathrm {flatmap}＆amp ;: x \ lightarrow [y] \\\\\ mathrm {fold}＆amp;：u \ lightarrow y \ lightarrow u \ neat {aligh} \]最终在Unix中非常自然设置，除了\（\ mathrm {flatmap}，\ mathrm {flatmap}，\ mathrm {fold} \）函数的函数没有要求。示意图，它看起来像这样：</p><p>  注意，这需要实际更改我们的结果。我们不再提供钥匙的串行HashMap，而是对禁用HashMaps的禁令。由于脱节，这无需额外的合并。 </p><p>这种方法的优势在地图上减少了键入的输入是（1）没有串行减少步骤，（2）所有计算步骤可以在线进行，并且（3）内存用法界定，与树木降低方法不同，在哪里原则上，所有键都可以在多个瞬态未更新的地图上复制。</p><p> 我实现了上面的一个版本，用于类似UNIX的文本流接口。 SLB（对于“分叉负载余额”）基本上是平行的--PIPE --Roundrobin将基于哈希分割其输入，并维护并行独立的映射器进程和折叠进程在计算结束时发出线路。这里的分离步骤只是线切级联（其中WordCount的输出线是键值对）。</p><p>  / usr / bin / time -f＆＃34;％e sec＆＃34;目标/释放/单秒钟\  - 传播器＆＃39; TR＆＃34; ＆＃34; ＆＃34; \ n＆＃34; | RG -V＆＃34; ^ $＆＃34;＆＃39; \ --folder＆＃34; awk＆＃39; {a [\ $ 0] ++}结束{for（k在a）print k，a [k]}＆＃39;＆＃34; \ --infile enwik9.clean \ --outprefix wikslb。＃6.20 seccat wikslb。* |排序--Parallel = $（nproc）-k2nr -k1 |头-5＃7797642＃4855049＃和3059322＃在2621192＃a 2332364</p><p> 好多了！ Flatmap操作Tr＆＃34; ＆＃34; ＆＃34; \ n＆＃34; | RG -V＆＃34; ^ $＆＃34;它在自己的行中放置了每个单词，是天然的UNIX线流操作。文件夹，awk＆＃39; {a [$ 0] ++}结束{for（k在a）print k，a [k]}＆＃39;满是追踪一个简单的键控计数器。这使得SLB在UNIX方式中并行化键控的键合作，这方便ML使用情况，例如：</p><p>  SLB有各种有趣的扩展;查看仓库以获取详细信息和示例。</p><p>   P.S.如今，Spark有一个更先进的API，可以看出我们并行计算的完整AST：</p><p> pyspark ...＆gt;＆gt;＆gt;来自Pyspark.sql.functions Import Split，Col，爆炸＆gt;＆gt;＆gt; ctr = spark.read.text（＆＃39; enwik9.clean＆＃39;）\ ... .select（爆炸（拆分（＆＃39;值＆＃39;），＆＃39; \ s +＆ ＃39;））。别名（＆＃39; word＆＃39;））\ ....在哪里（＆＃39; word＆＃39;）！=＃39;＆＃39;）\ .. 。.groupby（＆＃39; word＆＃39;）\ ... .count（）\ ... .collect（）＆gt;＆gt;＆gt; ctr.sort（key = lambda r：r [＆＃34; count＆＃34;]）＆gt;＆gt;＆gt; ctr [-5：] [行（word =＆＃39; a＆＃39; count = 2332364），行（word =＆＃39;在＆＃39;，count = 2621192），行（word =＆＃39 ;和＃39;，count = 3059322），行（Word =＆＃39;＆＃39;，count = 4855049），行（word =＆＃39;＆＃39;，count = 7797642）] </p><p>GroupBy部分现在在34秒内运行。 正如我们所看到的，我们也有更高的利用率： </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://vladfeinberg.com/2021/04/25/map-reduce-to-flatmap-fold.html">https://vladfeinberg.com/2021/04/25/map-reduce-to-flatmap-fold.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/击败/">#击败</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/spark/">#spark</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/串行/">#串行</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1057297.html"><img src="http://img2.diglog.com/img/2021/4/thumb_22d86bd663cca0cecab8a227b1e9e45c.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1057297.html">亚马逊在阿拉巴马州击败了联盟努力，因为计算持续 </a></div><span class="my_story_list_date">2021-4-9 23:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1053052.html"><img src="http://img2.diglog.com/img/2021/3/thumb_ef2c5b91629c41509ac5d5c00118a774.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1053052.html">Linode说它的AMD硬件击败了英特尔 </a></div><span class="my_story_list_date">2021-3-18 0:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1052016.html"><img src="http://img2.diglog.com/img/2021/3/thumb_3c039aa2326c56d4766bba35777c9890.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052016.html">为什么我正在击败追随射击覆盖范围 </a></div><span class="my_story_list_date">2021-3-13 0:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1046671.html"><img src="http://img2.diglog.com/img/2021/1/thumb_3d8430601a168e41d155675f2a637d72.gif" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1046671.html">爱好者击败专业设计师创造新颖的棋盘游戏 </a></div><span class="my_story_list_date">2021-1-29 19:20</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>