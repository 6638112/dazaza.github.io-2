<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>支持日记：1600万台主机的局域网</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">支持日记：1600万台主机的局域网</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-19 18:01:03</div><div class="page_narrow text-break page_content"><p>互联网的历史以层层创新为标志。在当时看似好的和必要的想法往往会被后来出现的更好的想法所取代。</p><p>我们有一位运行NetBSD的客户在与我们交换电子邮件时遇到问题。他们可以很好地联系其他人，但不能联系我们。</p><p>调查和调试最终确定他们的服务试图直接与我们的邮件服务器通信，而不是通过网关。该服务使用的是手动添加的IP地址。我们确定，当他们通过ifconfig添加地址时，他们没有提供网络掩码。然后，NetBSD为其分配了默认网络前缀/8。A/8将包括1600万台其他主机，这是毫无意义的。</p><p>我们最初认为这是ifconfig的默认行为，但一些工作表明，BSD内核和Linux内核中都内置了该默认行为。这一切都可以追溯到一个名为“有类网络”的系统，该系统于1981年开发，并在1993年被无类域间路由(CIDR)所取代。反过来，CIDR使用可变长子网掩码(VLSM)，而在有类网络中，子网掩码是固定的。</p><p>NetBSD正在为旧的有类系统分配与默认子网掩码关联的网络前缀。我们的网络设置了可变的网络掩码，因此使用了不同的网络前缀。这将我们的客户置于与我们不同的子网中，并破坏了我们的通信。</p><p>那么，什么是有类网络呢？为什么它一开始就存在呢？为什么现代内核仍然默认使用一个在近30年前就已经过时的系统呢？</p><p>互联网很早就遇到了可伸缩性问题。按照互联网地址的书写方式，第一次迭代只能识别256个独特的网络。网络由32位IPv4地址的前8位定义，单独的机器由其他24位或其余三个八位字节以四进制记法定义。</p><p>早期只有256个巨大的网络是不错的，当时周围唯一的网络是像ARPANET(第10号网络)和SATNET(第3号网络)这样的巨头。但很快就清楚了，最终将有超过256个网络，其中绝大多数将不需要这三个尾随的八位字节所允许的16,777,216个单独的节点。</p><p>解决方案是将IPv4地址域划分为“类”，并赋予它们不同的扩展能力。有五个班级，分配了字母A到E。</p><p>A-C类为规则网络。D类分配了组播地址，而E类保留用于特殊用途。</p><p>该系统由RFC791于1981年引入。1993年，根据RFC 1518和RFC 1519规范，CIDR取代了它。Classful Networking持续了12年，但这只是一个权宜之计。问题在于规模从C类网络(256个节点)到B类网络(65,536个节点)的巨大飞跃。许多新兴网络需要的机器远远超过256台，因此被分配到B类，但很少有真正需要超过65,000台机器的网络，所以B类地址池被浪费了。</p><p>CIDR通过使网络掩码长度可变，并以更易于写入和记忆的格式分配从网络掩码派生(也因此定义)的网络前缀来解决此问题。网络前缀只是网络掩码地址中前导1位的数量，所有其他位都设置为0。旧的有类网络掩码是固定的，因此会收到上表中定义的网络前缀。</p><p>CIDR自1993年开始使用其可变网络掩码，至今仍是使用的寻址系统。</p><p>大约在Internet从有类网络向CIDR过渡的时候，BSD和Linux的内核正在积极开发中。因此，它们将有类网络IP分配作为其默认行为的一部分。</p><p>这意味着当您使用ifconfig分配IP地址时，如果您没有指定网络掩码和/或网络前缀，则内核会将IP地址分配给五个类中的一个，并为其提供该类的默认网络掩码和前缀。</p><p>在现代内核中更改这些缺省值会破坏兼容性。所以它们一直保留到今天。</p><p>但是，如果没有向网络配置工具提供网络掩码，则警告用户不应破坏向后兼容性。如果您对一年的免费服务感兴趣，以换取将此警告添加到我们官方支持的任何分发中，请与我们联系。</p><p>特别感谢黑客新闻的sigjuus、cpach和其他人，他们提供了关于ifconfig和Linux内核历史的宝贵信息。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://prgmr.com/blog/2020/07/17/classful-networking.html">http://prgmr.com/blog/2020/07/17/classful-networking.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/支持/">#支持</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/diary/">#diary</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/网络/">#网络</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1012167.html"><img src="http://img.diglog.com/img/2020/7/thumb_76a7a85cb1067fba96a4ef02b85691d0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012167.html">
基准支持的Optimized确认已裁员15%</a></div><span class="my_story_list_date">2020-7-16 6:5</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012093.html"><img src="http://img.diglog.com/img/2020/7/thumb_bef7a50d5a607766bf88744445540182.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012093.html">Substack开始向付费订阅的美国作家提供法律支持，这些作家发表的作品可能会招致不合理的法律压力</a></div><span class="my_story_list_date">2020-7-16 2:11</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012056.html"><img src="http://img.diglog.com/img/2020/7/thumb_144e630f0954d0f6503c520dd96ca976.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012056.html">
SideKick支持使用始终在线的电话会议硬件进行远程工作</a></div><span class="my_story_list_date">2020-7-15 23:41</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011819.html"><img src="http://img.diglog.com/img/2020/7/thumb_a996d41040ed85919045e93900f7806b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011819.html">联想和AMD推出ThreadRipper Pro CPU挑战英特尔至强</a></div><span class="my_story_list_date">2020-7-15 2:29</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>