<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>向Python追溯添加变量Add variables to Python traceback</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Add variables to Python traceback<br/>向Python追溯添加变量</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-30 13:44:04</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/f7d32712ba15e47601f1a70ffe65bcb9.png"><img src="http://img2.diglog.com/img/2020/11/f7d32712ba15e47601f1a70ffe65bcb9.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Very simple to use, but versatile when needed. Try for debug and keep for production.</p><p>使用非常简单，但是在需要时可以通用。尝试进行调试，并保持生产状态。</p><p>   “It is useless work that darkens the heart.” – Ursula K. Le Guin</p><p>   “无用的工作使人的心灰暗。” – Ursula K. Le Guin</p><p> Tired of useless job of putting all your variables into debug exception messages? Just stop it.Automate it and clean your code. Once and for all.</p><p> 厌倦了将所有变量放入调试异常消息的无用工作？只需停止它即可。自动化并清理代码。一劳永逸。</p><p>                         def main(): sizes_str = sys.argv[1] h1, w1, h2, w2 = map(int, sizes_str.split())  - try: return get_avg_ratio([h1, w1], [h2, w2])  - except:  - logger.error(f&#39;something happened :(, variables = {locals()[:1000]}&#39;)  - raise  - # or  - raise MyToolException(f&#39;something happened :(, variables = {locals()[:1000]}&#39;) def get_avg_ratio(size1, size2):  - try: return mean(get_ratio(h, w) for h, w in [size1, size2])  - except:  - logger.error(f&#39;something happened :(, size1 = {size1}, size2 = {size2}&#39;)  - raise  - # or  - raise MyToolException(f&#39;something happened :(, size1 = {size1}, size2 = {size2}&#39;) def get_ratio(height, width):  - try: return height / width  - except:  - logger.error(f&#39;something happened :(, width = {width}, height = {height}&#39;)  - raise  - # or  - raise MyToolException(f&#39;something happened :(, width = {width}, height = {height}&#39;)</p><p>                         def main（）：sizes_str = sys.argv [1] h1，w1，h2，w2 = map（int，sizes_str.split（））-尝试：返回get_avg_ratio（[h1，w1]，[h2，w2]）-例外：-logger.error（发生了某事:(，变量= {locals（）[：1000]}'））-提高-＃或-提高MyToolException（发生了某事:(，变量= {locals（）[ :: 1000]}'）def get_avg_ratio（size1，size2）：-尝试：在[size1，size2]中返回均值（get_ratio（h，w）表示h，w。）-除外：-logger.error（f's something something： （，size1 = {size1}，size2 = {size2}'）-提高-＃或-提高MyToolException（发生了某事:(，size1 = {size1}，size2 = {size2}'）def get_ratio（高度，宽度）：-尝试：返回高度/宽度-例外：-logger.error（发生了某些事情:(，width = {width}，height = {height}'）-提高-＃或-提高MyToolException（发生了某些事情:(，width = {width}，height = {height}'）</p><p>  + from traceback_with_variables import activate_by_import def main(): sizes_str = sys.argv[1] h1, w1, h2, w2 = map(int, sizes_str.split()) return get_avg_ratio([h1, w1], [h2, w2]) def get_avg_ratio(size1, size2): return mean(get_ratio(h, w) for h, w in [size1, size2]) def get_ratio(height, width): return height / width</p><p>  +从traceback_with_variables导入activate_by_import def main（）：sizesstr = sys.argv [1] h1，w1，h2，w2 = map（int，sizes_str.split（））返回get_avg_ratio（[h1，w1]，[h2，w2] ）def get_avg_ratio（size1，size2）：返回平均值（[size1，size2]中h，w的get_ratio（h，w））def get_ratio（height，width）：返回高度/宽度</p><p>  Traceback with variables (most recent call last): File &#34;./temp.py&#34;, line 7, in main return get_avg_ratio([h1, w1], [h2, w2]) sizes_str = &#39;300 200 300 0&#39; h1 = 300 w1 = 200 h2 = 300 w2 = 0 File &#34;./temp.py&#34;, line 10, in get_avg_ratio return mean([get_ratio(h, w) for h, w in [size1, size2]]) size1 = [300, 200] size2 = [300, 0] File &#34;./temp.py&#34;, line 10, in &lt;listcomp&gt; return mean([get_ratio(h, w) for h, w in [size1, size2]]) .0 = &lt;tuple_iterator object at 0x7ff61e35b820&gt; h = 300 w = 0 File &#34;./temp.py&#34;, line 13, in get_ratio return height / width height = 300 width = 0builtins.ZeroDivisionError: division by zero</p><p>  具有变量的回溯（最近一次调用最近）：文件“ ./temp.py”，第7行，主返回中get_avg_ratio（[h1，w1]，[h2，w2]）Sizes_str ='300 200 300 0'h1 = 300 w1 = 200 h2 = 300 w2 = 0文件“ ./temp.py”，第10行，在get_avg_ratio中，返回均值（[[size1，size2]中h，w的[get_ratio（h，w）]）size1 = [300， 200] size2 = [300，0] 中的文件“ ./temp.py”，第10行，返回均值（[[size1，size2]中h，w的[get_ratio（h，w）]）.0 =  h = 300 w = 0文件“ ./temp.py”，第13行，在get_ratio返回高度/宽度高度= 300宽度= 0builtins.ZeroDivisionError：被零除</p><p> 2020-03-30 18:24:31 main ERROR Traceback with variables (most recent call last):2020-03-30 18:24:31 main ERROR File &#34;./temp.py&#34;, line 7, in main2020-03-30 18:24:31 main ERROR return get_avg_ratio([h1, w1], [h2, w2])2020-03-30 18:24:31 main ERROR sizes_str = &#39;300 200 300 0&#39;2020-03-30 18:24:31 main ERROR h1 = 3002020-03-30 18:24:31 main ERROR w1 = 2002020-03-30 18:24:31 main ERROR h2 = 3002020-03-30 18:24:31 main ERROR w2 = 02020-03-30 18:24:31 main ERROR File &#34;./temp.py&#34;, line 10, in get_avg_ratio2020-03-30 18:24:31 main ERROR return mean([get_ratio(h, w) for h, w in [size1, size2]])2020-03-30 18:24:31 main ERROR size1 = [300, 200]2020-03-30 18:24:31 main ERROR size2 = [300, 0]2020-03-30 18:24:31 main ERROR File &#34;./temp.py&#34;, line 10, in &lt;listcomp&gt;2020-03-30 18:24:31 main ERROR return mean([get_ratio(h, w) for h, w in [size1, size2]])2020-03-30 18:24:31 main ERROR .0 = &lt;tuple_iterator object at 0x7ff412acb820&gt;2020-03-30 18:24:31 main ERROR h = 3002020-03-30 18:24:31 main ERROR w = 02020-03-30 18:24:31 main ERROR File &#34;./temp.py&#34;, line 13, in get_ratio2020-03-30 18:24:31 main ERROR return height / width2020-03-30 18:24:31 main ERROR height = 3002020-03-30 18:24:31 main ERROR width = 02020-03-30 18:24:31 main ERROR builtins.ZeroDivisionError: division by zero</p><p> 2020-03-30 18:24:31主要错误使用变量进行追溯（最近一次调用为最新）：2020-03-30 18:24:31主要错误文件“ ./temp.py”，位于main2020-03中的第7行-30 18:24:31主要错误返回get_avg_ratio（[h1，w1]，[h2，w2]）2020-03-30 18:24:31主要错误Sizes_str ='300 200 300 0'2020-03-30 18 ：24：31主要错误h1 = 3002020-03-30 18:24:31主要错误w1 = 2002020-03-30 18:24:31主要错误h2 = 3002020-03-30 18:24:31主要错误w2 = 02020-03-30 18:24:31主要错误文件“ ./temp.py”，第10行，位于get_avg_ratio2020-03-30 18:24:31主要错误返回均值（[get_ratio（h，w）for h， w in [size1，size2]]）2020-03-30 18:24:31主要错误size1 = [300，200] 2020-03-30 18:24:31主要错误size2 = [300，0] 2020-03 -30 18:24:31主错误文件“ ./temp.py”，2020-03-30中的第10行，主错误返回均值（[h的[get_ratio（h，w）， w in [size1，size2]]）2020-03-30 18:24:31主要错误.0 =  2020-03-30 18:24:31主要错误h = 3002020-03-30 18 ：24：31主要错误w = 02020- 03-30 18:24:31主要错误文件“ ./temp.py”，第13行，在get_ratio2020-03-30 18:24:31主要错误中返回高度/宽度2020-03-30 18:24:31主要错误高度= 3002020-03-30 18:24:31主要错误宽度= 02020-03-30 18:24:31主要错误buildins.ZeroDivisionError：除以零</p><p> def  make_a_cake( sugar,  eggs,  milk,  flour,  salt,  water):  is_sweet  =  sugar  &gt;  salt  is_vegan  =  not ( eggs  or  milk)  is_huge  = ( sugar  +  eggs  +  milk  +  flour  +  salt  +  water  &gt;  10000)  if  not ( is_sweet  or  is_vegan  or  is_huge):  raise  ValueError( &#39;This is unacceptable, guess why!&#39;) ...</p><p>def make_a_cake（糖，鸡蛋，牛奶，面粉，盐，水）：is_sweet =糖>盐is_vegan =不（鸡蛋或牛奶）is_huge =（糖+鸡蛋+牛奶+面粉+盐+水> 10000）如果不是（is_sweet或is_vegan或is_huge）：引发ValueError（'这是不可接受的，猜测原因！'）...</p><p>  step 1: Notice some exception in a production service.  step 2: Add more printouts, logging, and exception messages.  step 3: Rerun the service.  step 4: Wait till (hopefully) the bug repeats.  step 5: Examine the printouts and possibly add some more info (then go back to step 2).  step 6: Erase all recently added printouts, logging and exception messages.  step 7: Go back to step 1 once bugs appear.</p><p>  步骤1：注意生产服务中的某些异常。步骤2：添加更多打印输出，日志记录和异常消息。步骤3：重新运行服务。步骤4：等待（希望）该错误重复发生。步骤5：检查打印输出，并可能添加更多信息（然后返回步骤2）。步骤6：清除所有最近添加的打印输出，日志记录和异常消息。步骤7：出现错误后，请返回步骤1。</p><p>     file_ where to print exception, a file or a wrapped logger, default= sys.stderr i.e. usual printing to console</p><p>     file_在哪里打印异常，文件或打包的记录器，默认= sys.stderr，即通常打印到控制台</p><p>           Call once in the beginning of your program, to change how traceback after an uncaught exception looks.</p><p>           在程序的开头调用一次，以更改未捕获的异常后回溯的方式。</p><p>    Function decorator, used for logging or simple printing of scoped tracebacks with variables. I.e. traceback is shorter as it includes only frames inside the function call. Program exiting due to unhandled exception still prints a usual traceback.</p><p>    函数装饰器，用于记录或简单打印带有变量的作用域跟踪。即traceback较短，因为它仅包含函数调用内的帧。由于未处理的异常而退出程序仍会打印通常的回溯。</p><p>    Context manager (i.e.  with ...), used for logging or simple printing of scoped tracebacks with variables. I.e. traceback is shorter as it includes only frames inside the  with scope. Program exiting due to unhandled exception still prints a usual traceback.</p><p>    上下文管理器（即...），用于记录或简单打印带有变量的作用域跟踪。即追溯较短，因为它仅包含with范围内的帧。由于未处理的异常而退出程序仍会打印通常的回溯。</p><p>          The default Windows console/terminal cannot print [so called  ansi] colors, but this is fixable, especially with modern Windows versions. Therefore colors are disabled by default,but you can enable them and check if it works in your case.You can force enable colors by passing  --color-scheme common (for complete list of colors pass  --help) console argument.</p><p>          默认的Windows控制台/终端无法打印[所谓的ansi]颜色，但这是可以修复的，尤其是在现代Windows版本中。因此，默认情况下颜色是禁用的，但是您可以启用它们并检查它是否适用。您可以通过传递--color-scheme common（对于完整的颜色列表，通过--help）控制台参数来强制启用颜色。</p><p> The default Windows console/terminal cannot print [so called  ansi] colors, but this is fixable, especially with modern Windows versions. If for some reason the colors are wrongly enabled by default,you can force disable colors by passing  --color-scheme none console argument.</p><p>默认的Windows控制台/终端无法打印[所谓的ansi]颜色，但这是可以修复的，尤其是在现代Windows版本中。如果由于某种原因默认启用了错误的颜色，则可以通过传递--color-scheme none控制台参数来强制禁用颜色。</p><p> Bash tools like grep sometimes fail to digest the output when used with pipes ( |) because of colors.</p><p> bash之类的bash工具在与管道（|）一起使用时有时会由于颜色而无法消化输出。</p><p> Please disable colors by passing  --color-scheme none console argument.The choice for keeping colors in piped output was made to allow convenient usage of  head,  tail, file redirection etc.In cases like  | grep it might have issues, in which case you can disable colors.</p><p> 请通过传递--color-scheme none控制台参数来禁用颜色。选择在管道输出中保留颜色是为了方便使用头，尾，文件重定向等。 grep可能有问题，在这种情况下，您可以禁用颜色。</p><p> Output redirected to a file in  &gt; output.txt manner has no colors when I  cat it.</p><p> 当我选择它时，以> output.txt方式重定向到文件的输出没有颜色。</p><p> This is considered a rare use case, so colors are disabled by default when outputting to a file.But you can force enable colors by passing  --color-scheme common (for complete list of colors pass  --help) console argument.</p><p> 这是一种罕见的用例，因此在输出到文件时默认情况下禁用颜色。但是您可以通过传递--color-scheme common（对于完整的颜色列表通过--help）控制台参数来强制启用颜色。</p><p> activate_by_import or  override_print_tb don&#39;t work in Jupiter or IPython as if not called at all.</p><p> activate_by_import或override_print_tb在Jupiter或IPython中不起作用，好像根本没有调用一样。</p><p> Don&#39;t forget to use  ipython=True or import  activate_in_ipython_by_import since Jupyer/Ipython handles exceptions differently than regular Python.</p><p> 不要忘记使用ipython = True或导入activate_in_ipython_by_import，因为Jupyer / Ipython处理异常的方式与常规Python不同。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/andy-landy/traceback_with_variables">https://github.com/andy-landy/traceback_with_variables</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/追溯/">#追溯</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/variables/">#variables</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/错误/">#错误</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>