<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>镍：以更少的成本实现更好的配置</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">镍：以更少的成本实现更好的配置</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-22 23:02:44</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/022ae1f163e3837faf7572f4d1b4761b.png"><img src="http://img2.diglog.com/img/2020/10/022ae1f163e3837faf7572f4d1b4761b.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>我们正在将镍库公之于众。镍是Tweag开发的一种实验配置语言。虽然现在还不是第一次租赁的时候，但这是一个谈论这个项目的机会。这篇文章的目标是对该项目进行一个高层次的概述。如果你的好奇心很强，但你还想学更多，那就不要害怕，因为我们将来会发布更多关于英语具体方面的博客文章。但是现在，让我们来游览一下吧！</p><p>[免责声明：Nickel的实际语法仍在研究中，出于说明的目的，我自由使用目前尚未存在的语法。但是，已经支持底层功能。]。</p><p>在Tweag，我们是NIX包管理器的忠实用户。事实证明，NIX的配置语言(也称为NIX)是一种非常好的配置语言，它不仅适用于包管理，还适用于更多的事情。</p><p>总而言之，Nix语言是一种带函数的懒惰JSON。它很简单，但功能强大。它用于生成NIX的包描述，但非常适合编写任何类型的配置(Terraform、Kubernetes等…)。。</p><p>问题在于，Nix-the-language的解释器与Nix-the-Package管理器紧密耦合。因此，按照目前的情况，将NIX语言用于包管理以外的任何事情都是一项非常痛苦的工作。</p><p>我们试图回答这个问题：如果Nix-the-language从包管理器中分离出来，它会是什么样子？同时抓住机会稍微改进一下语言，以Nix社区多年来的经验为基础。</p><p>NICI是一种轻量级通用配置语言。因为它可以取代YAML作为应用程序的配置语言。不过，与YAML不同的是，它通过可编程实现了大型配置。使用Nickel的另一种方式是生成静态配置文件(例如JSON、YAML)，然后将其提供给另一个系统。像NikeNix一样，它被设计成有一个简单的、易于理解的核心：实际上，它是带有函数的JSON。</p><p>但过去使用Nix的经验也带来了一些关于这种语言的哪些方面可以改进的见解。无论一种语言的初始范围是什么，它几乎肯定会以一种与原始计划不同的方式使用：您创建了一种配置语言来描述软件包，接下来您知道，需要有人实现拓扑排序。</p><p>Niel努力保持Nix的简单性，同时根据这个反馈对其进行扩展，不过，您可以在没有新特性的情况下做得非常好，只需编写类似Nix的代码即可。</p><p>在这一点上，您可能会想这是不是已经在其他地方做过了，似乎每天都有越来越多的语言诞生，并且肯定已经存在了与Nickel具有类似用途的配置语言：Starlark、Jsonnet、DHall或CUE，不一而足。那为什么是镍呢？</p><p>也许与其他配置语言最重要的区别在于Nickel的键入方法。</p><p>一些语言，如Jsonnet或Starlark，不是静态类型的。实际上，静态类型在配置语言中可以被视为多余的：如果您的程序只在固定输入上运行一次，那么无论如何都会在运行时报告任何类型错误。为什么要为静态类型系统而烦恼呢？</p><p>另一方面，越来越多的系统依赖于复杂的配置，如云基础设施(Terraform、Kubernetes或NixOps)，导致相应的程序变得越来越复杂，以至于静态类型是有益的。对于可重用的代码-也就是说，库函数-静态类型添加结构，作为文档，并及早消除错误。</p><p>DHall有一个功能强大的打字系统，可以打字范围很广。但它很复杂，需要一些经验才能变得流利。</p><p>CUE更接近我们的奋斗目标。它有一个可选的、行为良好的系统，有很强的保证。作为交换，人们通常不能编写Nortype高阶函数，即使一些简单的函数可以编码。</p><p>渐变类型并不引人注目：它们使你可以对程序的可重用部分进行静态类型，但是你仍然可以自由地编写没有任何类型的配置。解释器安全地处理类型化和非类型化世界之间的交互。</p><p>//文件：mylib.ncl{numToStr：Num-&gt；Str=Fun n=&gt；...；makeURL：Str-&gt；Str-&gt；Num-&gt；Str=Fun原始主机端口=&gt；&#34；${proto}：//${host}：${numToStr port}/&#34；；}。</p><p>//file：server.ncllet mylib=import&#34；mylib.ncl&#34；input host=&#34；myproject.com&#34；in{host=host；port=1；urls=[mylib.makeURL&#34；myproto&#34；host port，{protocol=&#34；proto2&#34；；server=&#34；sndserver.net&#34；；port=4242}]；}。</p><p>在第一个代码片段中，对numToStr和makeURL的主体进行了统计检查：错误地在makeURL内调用numToStr proto会引发错误，即使从未使用过makeURL。另一方面，第二个代码段没有注释，因此没有进行静态检查。特别地，我们在同一列表中将表示为字符串的URL与表示为记录的URL混合在一起。相反，解释器会插入运行时检查或契约，例如，如果make URL被误用，则程序会失败，并出现相应的错误。</p><p>渐进式类型还让我们保持类型系统的简单：即使是内部类型的代码，如果您要编写类型检查器不知道如何验证的组件，也不必对该部分进行类型检查。</p><p>作为静态类型系统的补充，Nickel提供合同。Contractsoffer精确而准确的动态类型错误报告，即使在存在函数类型的情况下也是如此。Nickel的解释器在内部使用合约在类型块和非类型块之间插入保护。合同也可供程序员使用，使他们能够以一种简单的方式在运行时强制执行类型断言。</p><p>这种设计的一个令人愉快的结果是，用户接触该类型系统的过程可以是渐进的：</p><p>编写配置的用户可以只编写类似Nix的代码，而忽略(几乎)所有关于键入的内容，因为您可以从非类型化代码无缝调用typedfunction。</p><p>基本计算块是函数，而Nickel中的基本数据块是记录(或JSON中的对象)。Ni支持编写自记录记录模式，例如：</p><p>{host|type：str|description：&#34；|default：&#34；faulback.myserver.net&#34；；port|type：num|description：&#34；|default：4242；url|type：url|description：&#34；；}。</p><p>每个字段都可以包含元数据，如描述或默认值。它们的目的是在文档中显示，或通过工具查询。</p><p>然后可以将该架构用作合同。假设一个函数在其输出中设置了两个值并返回：</p><p>没有类型，就很难捕捉到这一点。当然，错误最终会在管道的下游弹出，但如何以及何时出现错误呢？使用上面的模式可以确保，无论何时实际计算字段，函数都会被归咎于类型错误。</p><p>模式实际上是涉及将记录合并在一起的更大故事的一部分，尤其是让模式用缺省值实例化缺少的字段。它非常受NixOS模块系统和CUE语言的启发，但这是另一个时代的故事。</p><p>我希望我能让你们对Nickel想要实现的目标有个了解。我只介绍了它最突出的方面：它的渐进型系统和合同，以及内置的记录模式。但是还有更多需要探索的地方！该语言还没有准备好在现实世界的应用程序中使用，但是这里展示的设计的很大一部分已经实现。如果你对它很好奇，那就去看看吧！</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.tweag.io/blog/2020-10-22-nickel-open-sourcing/">https://www.tweag.io/blog/2020-10-22-nickel-open-sourcing/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/成本/">#成本</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/nickel/">#nickel</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/类型/">#类型</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1027429.html"><img src="http://img2.diglog.com/img/2020/10/thumb_f5c868d884f8148f1340a41233077553.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1027429.html">特斯拉轮胎10倍电池成本&我的轮胎放气计划成本90%</a></div><span class="my_story_list_date">2020-10-1 7:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1026066.html"><img src="http://img2.diglog.com/img/2020/9/thumb_e58f1e877ba00e0f9763e4bb229e7e49.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1026066.html">电池成本下降增加了石油和天然气行业的压力</a></div><span class="my_story_list_date">2020-9-24 11:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1025745.html"><img src="http://img2.diglog.com/img/2020/9/thumb_5e1a26ca40cc3921462cddc4b4abe341.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1025745.html">
未来的特斯拉将有两倍于结构的电池，使它们在提高效率、安全性和成本的同时变得更加坚硬。</a></div><span class="my_story_list_date">2020-9-23 6:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1024491.html"><img src="http://img2.diglog.com/img/2020/9/thumb_ec75e516c56363ac44446e56713e2e7c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024491.html">并发成本层次结构</a></div><span class="my_story_list_date">2020-9-17 10:11</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>