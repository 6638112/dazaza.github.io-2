<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Git抓取：通过抓取到Git存储库来跟踪随时间的变化</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Git抓取：通过抓取到Git存储库来跟踪随时间的变化</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-11 15:53:54</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/8f43b91b2571dcdfc860622aa04f3b23.png"><img src="http://img2.diglog.com/img/2020/10/8f43b91b2571dcdfc860622aa04f3b23.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Git刮是我给一种刮技术起的名字，我已经试验了几年了。它真的很有效，应该有更多的人使用它。</p><p>互联网上充满了有趣的数据，这些数据会随着时间的推移而变化。这些更改有时可能比底层的静态数据更有趣--例如，@NYT_DIFF Twitter帐户跟踪对“纽约时报”标题所做的更改，这为了解该出版物的编辑流程提供了一个有趣的视角。</p><p>我们已经有了一个很好的工具，可以有效地跟踪文本随时间的变化：Git。GitHub操作(和其他CI系统)可以轻松创建每隔几分钟运行一次的刮取器，记录资源的当前状态，并在提交历史记录中记录一段时间内对该资源的更改。</p><p>这里有一个最近的例子。加州的火灾继续肆虐，CAL火灾网站提供了一张事件地图，显示了该州周围最新的火灾活动。</p><p>启动Firefox Network窗格，过滤由XHR触发的请求，并按大小、最大值排序，首先显示此端点：</p><p>这是一个241KB的JSON端点，包含该州各种火灾的全部细节。</p><p>所以..。我开始用刮泥机来对付它。我的刮板程序位于GitHub上的simonw/ca-fire-History存储库中。</p><p>每隔20分钟，它就会获取该JSON端点的最新副本，使用JQ对其进行美化打印(为了不同的可读性)，如果更改了，则将其提交回repo。</p><p>这意味着我现在有一个关于加州火灾信息更改的提交日志。这里有一个提交示例，显示昨晚Zogg火灾的受控百分比从90%增加到92%，涉及的人员数量从968人下降到798人，响应的引擎数量从82人下降到59人。</p><p>刮取器的实现完全包含在单个GitHub操作工作流中。它位于一个名为.github/workflow/scillpe.yml的文件中，如下所示：</p><p>名称：抓取最新数据：PUSH：WORKLOW_DISPATCH：Schedule：-cron：&#39；6，26，46*&#39；作业：Scheduled：Run-On：Ubuntu-最新步骤：-Name：签出此Repo使用：Actions/Checkout@v2-Name：获取最新数据运行：|-CURL https://www.fire.ca.gov/umbraco/Api/IncidentApi/GetIncidents|JQ。&gt；events ents.json-name：更改后提交并推送运行：|-git config user.name&#34；Automated&#34；git config user.email&#34；Actions@users.noreply.github.com&#34；git add-A timeamp=$(date-u)git Commit-m&#34；最新数据：${timeamp}&#34；||退出0 git推送。</p><p>它按照时间表在每小时6分钟、26分钟和46分钟运行-我喜欢像这样抵消我的cron时间，因为我假设大多数cron正好在1小时运行，所以不准时运行感觉很礼貌。</p><p>刮取器本身的工作方式是使用cURL获取JSON，然后通过管道将其通过JQ传输。漂亮地打印它，并将结果保存到invents.json。</p><p>“如果更改则提交并推送”块使用的模式仅在文件更改时才提交和推送。几个月前，我在这篇文章中写到了这种模式。</p><p>我现在有一大堆仓库在运行git刮板。我一直在给它们贴上Git-scraping主题的标签，这样它们就会出现在GitHub的一个地方(其他人也开始使用这个主题)。</p><p>早在2017年9月，当我第一次想出以这种方式使用Git存储库的想法时，我就遇到了飓风伊尔玛(Irma)。</p><p>帮助理解2017年10月以来北湾火灾的Changelog描述了一种早期尝试，试图收集与火灾相关的信息。</p><p>为旧金山的官方树列表生成提交日志仍然是我最喜欢的这项技术的应用。旧金山市维护着一个经常更新的CSV文件，其中包括该市19万棵树，我有一个追溯到一年多前对它进行的更改的提交日志。此示例使用我的csv-diff实用程序生成人类可读的提交消息。</p><p>通过抓取git回购来跟踪PG&amp；E的停机记录了我通过抓取PG&amp；E去年的停电地图来跟踪其停电影响的尝试。我使用GitPython库将提交历史记录中记录的值转换到一个数据库中，该数据库允许我运行随时间变化的可视化。</p><p>通过使用GitHub Actions和Cloud Run部署数据API来跟踪FARA，展示了我如何在存储库中跟踪美国外国代理注册法(FARA)的新注册，并使用Datasette部署最新版本的数据。</p><p>我希望通过给这项技术命名，我可以鼓励更多的人将其添加到他们的工具箱中。随着时间的推移，这是将各种有趣的数据源转换为更改日志的一种非常有效的方式。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://simonwillison.net/2020/Oct/9/git-scraping/">https://simonwillison.net/2020/Oct/9/git-scraping/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/时间/">#时间</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/scraping/">#scraping</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1027215.html"><img src="http://img2.diglog.com/img/2020/9/thumb_ffe471891a004a35aa976766c2a04184.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1027215.html">我跟踪和分析了13159条黑客新闻帖子。这是我学到的东西</a></div><span class="my_story_list_date">2020-9-30 14:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1027073.html"><img src="http://img2.diglog.com/img/2020/9/thumb_a95c308e4036367ce3813a19c50bce2e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1027073.html">
Extra Crunch Live：今天美国东部时间下午2点/太平洋时间上午11点加入我们，与Index Ventures Nina Achadkin和Sarah Cannon讨论创业投资的未来</a></div><span class="my_story_list_date">2020-9-30 1:53</span></div><div class="col-sm"><div><a target="_blank" href="/story/1026979.html"><img src="http://img2.diglog.com/img/2020/9/thumb_02b8497b2e87629ace3c9ee11f403e01.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1026979.html">Xbox Series X的一周：加载时间、游戏性能等</a></div><span class="my_story_list_date">2020-9-29 15:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1026692.html"><img src="http://img2.diglog.com/img/2020/9/thumb_c6823078e0b18cd86d63c69779c7cdf4.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1026692.html">澳大利亚学生展示突破性的数学建模，可以在不改变现在的情况下回到过去</a></div><span class="my_story_list_date">2020-9-27 14:56</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>