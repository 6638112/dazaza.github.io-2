<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>只支持IPv6Going IPv6 Only</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Going IPv6 Only<br/>只支持IPv6</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-20 10:49:56</div><div class="page_narrow text-break page_content"><p>Since we&#39;re slowly coming up to 25 years of having IPv6, but still not actually having IPv6, I tried making a seperate local network that only has v6 access. In theory quite a few of the popular internet services should have IPv6 connectivity working.</p><p>自从我们&#39；我们使用IPv6已经慢了25年，但仍然没有真正使用IPv6，我试着制作一个单独的本地网络，它只能访问v6。理论上，很多流行的互联网服务都应该具备IPv6连接。</p><p> From previous network configuration mistakes, I&#39;ve learned that it takes quite a while before I notice the loss of IPv4 connectivity if IPv6 is still working. Usually,  I notice that by having the search engine work perfectly fine, but none of the websites I click loading.</p><p>根据之前的网络配置错误，我&#39；我了解到，如果IPv6仍在工作，我需要很长时间才能注意到IPv4连接的丢失。通常，我会注意到，通过让搜索引擎工作得非常好，但没有一个网站我点击加载。</p><p>  It was quite easy to set up the v6-only network for me. I already have all the network traffic running through a Linux router so I just made a new bridge that gets IPv6 addresses only and drop all IPv4 traffic. I&#39;ve assigned a network interface to this bridge and also an SSID on the wireless network.</p><p>为我设置仅限v6的网络非常容易。我已经让所有的网络流量通过Linux路由器运行，所以我刚刚制作了一个新的网桥，只获取IPv6地址，并删除所有IPv4流量。我&#39；我给这个网桥分配了一个网络接口，同时在无线网络上分配了一个SSID。</p><p> $ brctl addbr v6only$ iptables -A FORWARD -i v6only -j DROP$ iptables -A INPUT -i v6only -j DROP$ ip6tables -A FORWARD -i v6only -j ACCEPT$ ip6tables -A INPUT -i v6only -j ACCEPT</p><p>$brctl addbr v6only$iptables-A FORWARD-i v6only-j DROP$ip6tables-A INPUT-i v6only-j DROP$ip6tables-A FORWARD-i v6only-j ACCEPT$ip6tables-A INPUT-i v6only-j ACCEPT</p><p>  The first problem didn&#39;t take very long, I had a complete lack of ipv6 reachable nameservers in my network.</p><p>第一个问题不是&#39；没过多久，我的网络中完全没有ipv6可访问的名称服务器。</p><p> The nameserver in my network is  unbound running on a Linux machine. It&#39;s configured to do recursive resolving and caching and I had never set it up for IPv6.</p><p>我网络中的名称服务器在Linux机器上未绑定运行。它&#39；它被配置为进行递归解析和缓存，而我从未为IPv6设置过它。</p><p> I ran into a few interesting issues with setting up unbound. I had created an ACL that allowed the IPv6 subnet on my LAN to use the recursive resolver by marking that subnet as a private network. It took quite a bit of debugging to figure out why it refused to return AAAA records for my local services. I had created an AAAA record for my local Matrix server and I could resolve it just fine through third-party nameservers, but got no results at all from unbound. It turns out that marking an IPv6 subnet as private also makes DNS responses that return an address in that subnet dissapear due to the scrubber.</p><p>我在设置unbound时遇到了一些有趣的问题。我创建了一个ACL，通过将局域网上的IPv6子网标记为专用网络，该ACL允许该子网使用递归解析器。花了相当多的时间调试，才弄明白为什么它拒绝为我的本地服务返回AAAA记录。我已经为我的本地矩阵服务器创建了一个AAAA记录，我可以通过第三方名称服务器很好地解析它，但从unbound中根本没有得到任何结果。事实证明，将IPv6子网标记为私有也会使返回该子网中地址的DNS响应因洗涤器而消失。</p><p> The scrubber makes a lot of sense. It prevents a website called evil.com to make a DNS record called local.evil.com pointing to 127.0.0.1 or any other local address. The issue with such a record is that browsers will allow JavaScript to connect to services on your machine this way. This works absolutely fine for IPv4 for me, but on IPv6 the public address for the service is the same as my local address for it since there&#39;s no NAT involved. After quite a bunch of searching the fix turned out to be adding a single line to the config:</p><p>洗涤器很有道理。它阻止了一个名为“邪恶”的网站。com来创建名为local的DNS记录。恶毒的com指向127.0.0.1或任何其他本地地址。这种记录的问题在于浏览器将允许JavaScript以这种方式连接到您机器上的服务。对我来说，这对IPv4来说绝对有效，但在IPv6上，该服务的公共地址与我的本地地址相同，因为有#39；这与NAT无关。经过大量搜索后，修复结果是在配置中添加了一行：</p><p>    Now I&#39;ve been connected to the internet again I ran into my second issue. While all the postmarketOS infrastructure has IPv6 addresses, none of it had it&#39;s AAAA records created after the last infrastructure migration.  This was luckily quite easy to fix.</p><p>现在我&#39；I’’我又上网了。我遇到了第二期。虽然所有的邮戳基础设施都有IPv6地址，但没有一个有它&#39；s上次基础结构迁移后创建的AAAA记录。幸运的是，这很容易修复。</p><p> Beside the infrastructure that postmarketOS runs itself there&#39;s also  gitlab.com/postmarketOS. Luckily IPv6 is also fully supported on Gitlab. It looks like Github and Sourcehut are behind in this and are not reachable over IPv6 at all.</p><p>除了邮戳运营的基础设施之外&#39；这也是gitlab。com/邮戳。幸运的是，Gitlab也完全支持IPv6。看起来Github和Sourcehut在这方面落后了，根本无法通过IPv6访问。</p><p> This means most postmarketOS work is possible on an IPv6-only connection. Issues are mostly that the sources for quite a lot of project are on github or sourcehut which means builds are failing locally. Also the build infrastructure for postmarketOS is running on Sourcehut builds which means I can&#39;t see the logs of build failures (but the artefacts are on the postmarketOS infrastructure and accessible again)</p><p>这意味着大多数邮戳工作都可以在仅IPv6连接上进行。问题主要是很多项目的源代码都在github或sourcehut上，这意味着构建在本地失败。此外，邮政市场的构建基础设施正在Sourcehut builds上运行，这意味着我可以&#39；我看不到构建失败的日志（但这些人工制品在邮戳基础设施上，可以再次访问）</p><p>    I guess killing a bunch of the social media would make me a bit more productive. The code forge access is quite a lot more problematic. I can totally understand though that Microsoft doesn&#39;t have the funds to deploy IPv6, it&#39;s a tiny startup after all.</p><p>我想杀掉一堆社交媒体会让我更有效率。代码伪造访问的问题要大得多。虽然我完全理解微软没有&#39；我没有资金部署IPv6，它&#39；毕竟，这是一家小型初创公司。</p><p>   Running an IPv6-only network isn&#39;t super useful for daily use. There&#39;s simply too many services that still fully rely on IPv4 to function.</p><p>运行仅限IPv6的网络不是&#39；它对日常使用非常有用。那里&#39；只是太多仍然完全依赖IPv4的服务无法正常运行。</p><p> Occasionally plugging into the IPv6 testnet though is very useful. It&#39;s great for finding bugs, the kinds of bugs that lead to still not being able to use IPv6 after decades. Since practically all IPv6 deployments are dualstack it&#39;s not very noticable when IPv6 is misconfigured because practically all software silently falls back to IPv4.</p><p>偶尔插入IPv6测试网是非常有用的。它&#39；It’这对发现bug很有帮助，这些bug会导致几十年后仍然无法使用IPv6。由于几乎所有IPv6部署都是双栈it&#39；当IPv6被错误配置时，它不是很明显，因为几乎所有的软件都会悄悄地退回到IPv4。</p><p> Just using this network for an hour was enough to iron all the IPv6 issues on the postmarketOS and my own infrastructure so I&#39;d say this was worth it.</p><p>仅仅使用这个网络一个小时就足以解决邮戳和我自己的基础设施上的所有IPv6问题，所以我&#39；我认为这是值得的。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/支持/">#支持</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ipv6/">#ipv6</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>