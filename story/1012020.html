<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>指挥与征服游戏的代码：来自90年代的虫子。第二卷</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">指挥与征服游戏的代码：来自90年代的虫子。第二卷</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-15 21:52:03</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/cc5f7e7b42a057adff553060fbcf6c86.png"><img src="http://img.diglog.com/img/2020/7/cc5f7e7b42a057adff553060fbcf6c86.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>V617考虑检查条件。按位运算的&#39；(1L&lt；&lt；STRUCT_CHRONSPOPE)&#39；参数包含非零值。HOUSE.CPP 5089 tyecif enum StructType：CHAR{STRUCT_NONE=-1，STRUCT_ADVANCED_TECH，STRUCT_IRE_CREWARD，STRUCT_WEAP，STRUCT_CHRONSPOPE，//3.}#定义STRUCTF_CHRONSPOPE(1L；&lt；STRUCT_CHRONSPOPE)UrgencyType HouseClass：：CHECK_BUILD_POWER(Void)const{.。IF(状态==STATE_AWAREED||STATE==STATE_ATTECTED){IF(BScan|(STRUCTF_CHRONSPOPE)){//&lt；=紧急=紧急高；}}.}。</p><p>要检查变量中是否设置了某些位，请使用&amp；运算符，而不是|。由于此代码片断中的拼写错误，我们这里有一个始终为真的条件。v768枚举常量WWKEY_RLS_BIT&#39；用作布尔型变量。KEYBOARD.CPP 286类型枚举{WWKEY_SHIFT_BIT=0x100，WWKEY_CTRL_BIT=0x200，WWKEY_ALT_BIT=0x400，WWKEY_RLS_BIT=0x800，WWKEY_VK_BIT=0x1000，WWKEY_DBL_BIT=0x2000，WWKEY_BTN_BIT=0x8000，}WWKEY_。</p><p>我认为，在key参数中，意图是检查由WWKEY_RLS_BIT掩码设置的某个位，但是作者犯了一个打字错误。他们应该使用&amp；按位运算符而不是&amp；&amp；来检查密钥代码。V523&#39；THEN&#39；语句等同于&#39；ELSE&39；语句。RADAR.CPP 1827 void RadarClass：：Player_Names(Bool On){IsPlayerNames=on；IsToRedraw=true；if(On){Flag_to_Reraw(True)；//Flag_to_Reraw(False)；}Else{Flag_to_Reraw(True)；//强制绘制图板}}。</p><p>一位开发人员曾经评论过用于调试的代码。此后，代码中保留了在不同分支中具有相同运算符的条件运算符。找到了完全相同的两个位置：V705可能忘记或注释掉了&#39；Else&39；块，从而改变了程序的操作逻辑。NETDLG.CPP 1506静态INT NET_JOIN_DIALOG(Void){.。/*..。F4/Send/&#39；M&#39；=如果(Messages.Get_..*/_buf()==NULL){.。}Else/*..。如果我们已经在编辑一条消息，而用户单击了“发送”，请将我们的输入转换为返回，以便Messages.Input()可以正常工作。..*/IF(INPUT==(BUTTON_SEND|KN_BUTTON)){INPUT=KN_RETURN；}.}。</p><p>由于大量注释，开发人员没有看到上面未完成的条件运算符。其余的Else关键字构成具有以下条件的Else If结构，这很可能会更改原始逻辑。V519连续两次为&#39；ScoresPresent&#39；变量赋值。也许这是个错误。检查热线：539,541。INIT.CPP 541 bool Init_Game(int，char*[]){.。ScoresPresent=False；//If(CCFileClass(&#34；SCORES.MIX&#34；).Is_Available()){ScoresPresent=True；If(！ScoreMix){ScoreMix=new MixFileClass(&#34；SCORES.MIX&#34；)；ThemeClass：：Scan()；}//}。</p><p>另一个由不完全重构引起的潜在缺陷。现在还不清楚ScoresPresent变量应该设置为true还是false。V611内存使用&#39；new T[]&#39；运算符分配，但使用&#39；delete&#39；运算符释放。考虑检查此代码。使用DELETE[]POKE_DATA；&可能更好。CCDDE.CPP 410 BOOL SEND_DATA_TO_DDE_Server(char*data，int length，int Packet_type){.。char*poke_data=new char[length+2*sizeof(Int)]；//&lt；=.。IF(DDE_Class-&gt；POKE_Server(.。)==false){CCDebugString(&#34；C&amp；c95-POKE失败！\n&#34；)；DDE_Class-&gt；CLOSE_POKE_CONNECTION()；DELETE POKE_DATA；//&lt；=RETURN(FALSE)；}DDE_Class-&gt；CLOSE_POKE_CONNECTION()；DELETE POKE_DATA；//&lt；=RETURN(True)；}。</p><p>分析器发现一个错误，该错误与可以以不兼容的方式分配和释放内存有关。要释放分配给数组的内存，应该使用DELETE[]运算符，而不是DELETE。有几个这样的地方，它们都逐渐损害正在运行的应用程序(游戏)：V611内存是使用&#39；new T[]&#39；操作符分配的，但使用&#39；delete&#39；操作符释放。考虑检查此代码。使用DELETE[]POKE_DATA；&可能更好。CCDDE.CPP 416。</p><p>V611内存使用&#39；new T[]&#39；运算符分配，但使用&#39；delete&#39；运算符释放。考虑检查此代码。最好使用&#39；delete[]TEMP_BUFFER；&#39；。INIT.CPP 1302</p><p>V611内存使用&#39；new T[]&#39；运算符分配，但使用&#39；delete&#39；运算符释放。考虑检查此代码。使用&#39；delete[]Progress palette；&#39；可能更好。MAPSEL.CPP 795。</p><p>V611内存使用&#39；new T[]&#39；运算符分配，但使用&#39；delete&#39；运算符释放。考虑检查此代码。使用删除[]Grey2Palette；&#39；可能更好。MAPSEL.CPP 796。</p><p>V611内存使用&#39；new T[]&#39；运算符分配，但使用&#39；delete&#39；运算符释放。考虑检查此代码。使用DELETE[]POKE_DATA；&可能更好。CCDDE.CPP 422。</p><p>V611内存使用&#39；new T[]&#39；运算符分配，但使用&#39；delete&#39；运算符释放。考虑检查此代码。最好使用&#39；delete[]TEMP_BUFFER；&#39；。INIT.CPP 1139。</p><p>V772调用空指针的删除运算符将导致未定义的行为。ENDING.CPP 254 DELETE和DELETE[]运算符是分开的，这是有原因的。它们执行不同的任务来清除记忆。当使用非类型化指针时，编译器不知道指针指向的是哪种数据类型。在C++标准中，编译器的行为是不确定的。还有许多此类分析器警告：V772调用空指针的删除操作符将导致未定义的行为。HEAP.CPP 284。</p><p>V772调用空指针的删除运算符将导致未定义的行为。INIT.CPP 728。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MIXFILE.CPP 134。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MIXFILE.CPP 391</p><p>V772调用空指针的删除运算符将导致未定义的行为。MSGBOX.CPP 423。</p><p>V772调用空指针的删除运算符将导致未定义的行为。SOUNDDLG.CPP 407。</p><p>V772调用空指针的删除运算符将导致未定义的行为。BUFFER.CPP 126。</p><p>V772调用空指针的删除运算符将导致未定义的行为。BUFF.CPP 162。</p><p>V772调用空指针的删除运算符将导致未定义的行为。BUFF.CPP 212。</p><p>V772调用空指针的删除运算符将导致未定义的行为。BFIOFILE.CPP 330。</p><p>V772调用空指针的删除运算符将导致未定义的行为。事件.CPP 934。</p><p>V772调用空指针的删除运算符将导致未定义的行为。HEAP.CPP 318</p><p>V772调用空指针的删除运算符将导致未定义的行为。INIT.CPP 3851。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MIXFILE.CPP 130。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MIXFILE.CPP 430。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MIXFILE.CPP 447。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MIXFILE.CPP 481。</p><p>V772调用空指针的删除运算符将导致未定义的行为。MSGBOX.CPP 461。</p><p>V772调用空指针的删除运算符将导致未定义的行为。QUEUE.CPP 2982。</p><p>V772调用空指针的删除运算符将导致未定义的行为。QUEUE.CPP 3167</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；HelpClass&#39；和基类&#39；DisplayClass&#39；中函数&#39；HELP_TEXT&#39；的第四个参数。HELP.H 55。</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；MapEditClass&#39；和基类&#39；HelpClass&#39；中函数&#39；raw_it&#39；的第一个参数。MAPEDIT.H 187。</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；AnimClass&#39；和基类&#39；ObjectClass&#39；中函数&#39；Occupy_List&#39；的第一个参数。ANIM.H 80。</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；BulletClass&#39；和基类&#39；ObjectClass&#39；中函数&#39；OVERVER_LIST&#39；的第一个参数。BULLET.H 102。</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；BuildingClass&#39；和基类&#39；TechnoClass&#39；中函数&#39；remap_Table&#39；的限定符。BUILDING.H 281。</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；HelpClass&#39；和基类&#39；DisplayClass&#39；中函数&#39；HELP_TEXT&#39；的第四个参数。HELP.H 58。</p><p>V762虚拟函数可能被错误覆盖。请参阅派生类&#39；AnimClass&#39；和基类&#39；ObjectClass&#39；中函数&#39；OVERVER_LIST&#39；的第一个参数。ANIM.H 90。</p><p>V763参数&#39；coord&#39；在使用之前总是在函数体中重写。DISPLAY.CPP4031void DisplayClass：：Set_Tactical_Position(COORDINATE coord){INT xx=0；INT yy=0；CONFINE_RECT(&amp；xx，&amp；yy，TacLeptonWidth，TacLeptonHeight，Cell_to_Lepton(MapCellWidth)+GlyphXClientSidebarWidthInLepton，Cell_to_Lepton(MapCellHeight))；coord=xy_coord</p><p>coord参数立即在函数体中被覆盖。未使用旧值。当函数有参数并且不依赖于它们时，这是非常可疑的。此外，还传递了一些坐标。因此，这段代码值得检查一下：指向本地数组的V507指针存储在此数组的作用域之外。这样的指针将变为无效。MAPSEL.CPP 757游戏代码中有很多全局变量。也许，这在当时是编写代码的常用方法。然而，现在它被认为是糟糕的，甚至是危险的。InterpolationPalette指针存储在本地数组localPalette中，该指针在退出函数后将无效。两个更危险的位置：V507指向局部数组的指针存储在此数组的作用域之外。这样的指针将变为无效。MAPSEL.CPP 769。</p><p>V507指向本地数组缓冲区的指针存储在此数组的作用域之外。这样的指针将变为无效。WINDOWS.CPP 458。</p><p>正如我在第一份报告中所写的那样，让我们希望新的电子艺术项目有更好的质量。顺便说一下，游戏开发商目前正在积极购买PVS-Studio。现在游戏预算相当大，所以没有人需要额外的费用来修复生产中的错误。说到这里，在代码编写的早期阶段修复错误不会占用太多时间和其他资源。欢迎您访问我们的网站下载并在所有项目中试用PVS-Studio。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://habr.com/en/company/pvs-studio/blog/510654/">https://habr.com/en/company/pvs-studio/blog/510654/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/征服/">#征服</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/command/">#command</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/wwkey/">#wwkey</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1012001.html"><img src="http://img.diglog.com/img/2020/7/thumb_b626970df2870351f37066a66fa67115.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012001.html">用于ARM上Windows的VS代码现在可用于稳定版本</a></div><span class="my_story_list_date">2020-7-15 20:19</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011750.html"><img src="http://img.diglog.com/img/2020/7/thumb_a12988c9779731f7e539def86bfef5a3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011750.html">
Jyoti Bansal的第三家初创公司致力于代码安全</a></div><span class="my_story_list_date">2020-7-14 22:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011206.html"><img src="http://img.diglog.com/img/2020/7/thumb_e61744fa7701255597adc58d6481948b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011206.html">自复制Python代码</a></div><span class="my_story_list_date">2020-7-11 23:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011120.html"><img src="http://img.diglog.com/img/2020/7/thumb_b626970df2870351f37066a66fa67115.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011120.html">Visual Studio代码2020年6月(版本1.47)</a></div><span class="my_story_list_date">2020-7-11 7:55</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>