<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>介绍dbt +实现 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">介绍dbt +实现 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-02 04:07:04</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/bc410bce8887ade846b34256710ed7be.png"><img src="http://img2.diglog.com/img/2021/3/bc410bce8887ade846b34256710ed7be.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>管理数据非常困难。管理数据管道更加困难。跨组织转换时，数据仓库中各个表或值的含义会​​丢失。另一个团队的重构破坏了您团队的工作流程。而且，通常很难说出谁进行了更改以及何时进行了更改。</p><p> 数据构建工具dbt通过接管ETL管道中的转换步骤来减轻这些挫败感。 dbt本身不是数据处理器，而是位于包含已提取和加载的数据的数据仓库的顶部。 dbt使团队可以轻松地测试，记录和版本控制其数据转换。</p><p> 尽管dbt是转换批处理数据的好工具，但它当前不能实时转换流数据。 （dbt团队在少数情况下明确警告用户。）在Materialize，我们希望帮助世界停止批处理并开始流式传输。因此，我们*构建了一个dbt适配器，该适配器将允许您使用Materialize作为数据仓库实时转换流数据。</p><p> 本文的其余部分将探讨dbt为什么与批处理数据配合使用效果最佳，以及如何使用Materialize解锁流转换。如果您渴望入门，可以在这里找到dbt-materialize适配器，在这里找到我们的示例流项目。注意：dbt-materialize适配器是一项正在进行中的工作，尚不适用于生产用例。请提出您认为合适的问题或提交PR，我们很乐意提供反馈！</p><p> * dbt-materialize适配器最初由Josh Wills创建，并由Jeremy Cohen积极塑造。感谢您的所有工作和支持！</p><p>  dbt擅长转换批处理数据，但是它不能实时有效地转换流数据。要了解原因，让我们看一下dbt如何在后台转换数据。</p><p> dbt用户使用dbt“模型”定义所需的转换。 dbt模型是包含以下内容的SQL文件： </p><p>每次“运行”模型时，dbt都会转换您的数据。每次运行模型时，dbt都会使用该模型的SELECT语句查询基础数据仓库。然后将查询的结果集（转换后的数据）直接返回给用户，或者将其持久化到您的数据仓库中，具体取决于模型的实现参数。</p><p> 当前，dbt支持四种类型的实现：表，视图，增量和临时。表和增量实现将持久化一个表，视图实现将创建一个视图，并且短暂实现而不是持久化任何内容，而是使用通用表表达式（CTE）直接返回结果。好消息是这些数据库对象完全足以转换批处理数据。坏消息是这些数据库对象都没有有效地转换流数据。</p><p> 首先，批处理和流式传输数据是什么意思？顾名思义，批次数据是离散批次中到达的任何类型的数据。可以是每分钟一次，每小时一次或一天一次。重要的是批次之间没有新数据到达。另一方面，流数据连续到达并且没有特定的时间表。</p><p> 那么，为什么这些数据库对象足以转换批处理数据，却不能有效转换流数据？</p><p> 视图和CTE不会物理上将数据保留到您的数据仓库中。这意味着，每次查询使用视图或CTE的模型时，数据仓库都必须重新转换基础源数据。而且，每次转换源数据时，您都要付出一定的代价。虽然视图和CTE总是返回您的批处理和流数据的最新转换，但它们并没有那么高效。</p><p> 另一方面，表在物理上保留数据。更具体地说，表保留上一次其模型“ dbt运行”的结果集。与视图和CTE不同，这意味着您不必每次查询表时都要付出转换数据的代价。但是，这意味着随着新数据的到来，您转换后的数据很快就会过时。这对于批处理数据不是问题，因为您可以在每次新批处理到达时简单地“ dbt运行”表。不幸的是，流数据并不是那么简单。</p><p> 由于流数据未按计划到达，因此不再有合适的时间重新运行模型以保持模型最新。相反，您不得不在最大化数据新鲜度和最小化转换成本之间进行选择。通过限制重新创建表的频率，有效地将流数据转换为批处理数据，可以最大程度地降低成本。或者，您可以通过连续重新创建表来最大程度地提高数据的新鲜度。但是，这种方法将花费您的时间和金钱，使您容易受到错误的影响，并且仍然无法保持最新​​的结果。 </p><p>dbt目前有一种正式和一种非官方的方式来近似转换流数据。这两种方法都无法真正实时地转换流数据，而且都需要付出一定的代价。</p><p> 近似转换流数据的第一种方法是创建具有增量实现的模型。第一次运行增量模型时，dbt会将转换的结果集持久保存到数据仓库中的表中。对于后续运行，dbt仅转换模型的过滤谓词所指示的源数据的子集。 （例如，您可能有一个过滤谓词，该谓词仅会转换时间戳大于上一个模型运行时间的数据。）</p><p> 虽然增量模型降低了用户在表中保持转换时面临的权衡的严重性（数据新鲜度与成本），但它们并未完全消除权衡。通过设计，每次“ dbt”运行增量模型时，您可能会付出较少的费用。 （我在这里说“大概”是因为即使每次运行仅转换几行数据，除非您进行了巧妙的过滤，否则模型的SELECT语句仍将必须扫描整个基础源表或视图以发现这些数据行）。尽管这些较低的成本可以使您腾出更多时间运行增量模型，但您仍将无法连续运行它们。根据定义，您仍在使用批处理过程来转换流数据。</p><p> 近似转换流数据的第二种方法是非官方的“ lambda视图”方法。该方法通过查询组合的历史表和当前视图来模拟“近实时模型”上的转换。与增量实现类似，此方法会产生使用某些过滤器查询两个基础数据库对象的成本。您的数据的当前视图返回最新结果，但是每次都必须重新转换最近的数据。</p><p> 这些方法都不能实时有效地转换数据。 （而且，如果您有可能迟到的流数据，它们会带来很多麻烦。）为了有效地执行流数据的无忧实时转换，dbt将需要保留一个数据库对象，该对象将更新为新数据到达上游。幸运的是，有一个数据库对象可以为我们做到这一点：物化视图。</p><p>  传统数据库中的物化视图的行为有点像dbt的增量物化。首次创建实例化视图时，其查询结果集将物理保留在数据库中。然后，以一定间隔或在手动触发时，使用最近的数据更新存储的结果集。像渐增的实现一样，维护这些实现的视图会产生各种成本。</p><p> 这是实现Materialise所要解决的确切问题。与传统的物化视图不同，我们的物化视图会随着新数据的到达而不断更新-无需刷新。更好的是，我们提供了毫秒级延迟的最新结果。 （有关实体化和我们的实体化视图的更多信息，请查阅我们的文档。） </p><p>那么，这对dbt和流数据意味着什么呢？ 这意味着您第一次在Materialize之上运行dbt模型时，dbt会保留一个物化视图。 然后，您不必再运行模型。 无论数据到达的频率是多少，模型都将保持最新状态。 无论您何时查询视图，它都将返回新的答案。 只需通过我们的物化视图创建模型，您就可以自信，高效地实时转换流数据。  兴奋的？ 怀疑吗？ 谨慎乐观？ 自己试试吧！ 如前所述，我们有一个beta dbt-adapter和一个演示流项目。 如果您有任何想法，问题或疑虑，请随时在我们的Slack社区或dbt仓库中与我们联系。 （或者，当您启动并运行时，实时告诉我们您要进行的转换！） </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://materialize.com/introducing-dbt-materialize/">https://materialize.com/introducing-dbt-materialize/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/dbt/">#dbt</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数据/">#数据</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>