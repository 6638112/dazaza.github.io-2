<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>不信任默认超时</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">不信任默认超时</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-29 21:12:22</div><div class="page_narrow text-break page_content"><p>现代应用程序不会崩溃；它们会挂起。其中一个主要原因是假设网络是可靠的。不是的。</p><p>当您在没有设置超时的情况下进行网络调用时，您是在告诉您的代码您百分之百确信调用将会成功。你真的愿意打赌吗？</p><p>如果您正在进行一个永远不会返回的同步网络调用，那么您的线程至少会永远占用您的线程。哎呦。不返回的异步网络调用也不是免费的。当然，您没有占用线程，但是您正在泄漏套接字。任何名副其实的HTTP客户端库都使用套接字池来避免重新创建连接。而这些池子的容量是有限的。与任何其他资源泄漏一样，没有套接字也只是时间问题。当这种情况发生时，您的应用程序将在等待连接释放时停滞不前。</p><p>如果网络不可靠，为什么我们要一直创建默认超时为无穷大的API？有些API甚至一开始就没有设置超时的方法！一个好的API应该容易使用正确的方式，很难使用错误的方式。当默认超时为无穷大时，客户端很容易搬起石头砸自己的脚。</p><p>如果你记得这篇文章中的一件事，那么就让它成为这样：永远不要使用“无限”作为默认超时。</p><p>JavaScript的XMLHttpRequest是从服务器异步检索数据的Web API。它的默认超时是零，这意味着没有超时！</p><p>Var xhr=new()；xhr。Open(&#39；GET&#39；，&#39；/api&#39；，true)；//默认情况下没有超时！xhr.timeout=10000；xhr。Onload=function(){//请求完成}；xhr。Ontimeout=函数(E){//请求超时}；xhr。发送(空)；</p><p>客户端超时与服务器端超时一样重要。您的浏览器可以为特定主机打开的套接字数量是最大的。如果您发出的网络请求永远不会返回，您将耗尽套接字池。当池耗尽时，您将无法再连接到主机。</p><p>Fetch web API是XMLHttpRequest API的现代替代品，XMLHttpRequest API使用Promises。最初引入API时，根本没有办法设置超时！不过，浏览器最近添加了对中止API的试验性支持，以支持超时。</p><p>Const Controller=new()；const Signal=Controller.ignal；const fetchPromise=FETCH(url，{ignal})；//默认无超时！SetTimeout(()=&gt；控制器。Abort()，10000)；FetchPromise。则(响应=&gt；{//请求完成})。</p><p>巨蟒世界的情况也好不到哪里去。请求库使用无限大的默认超时。</p><p>去吧？Go的HTTP包在默认情况下也不使用超时。</p><p>Var client=&amp；http.Client{//默认情况下没有超时！超时：时间.秒*10，}响应，_：=客户端。Get(Url)。</p><p>用于Java和.NET的现代HTTP客户端可以做得更好，并且通常带有默认超时。例如，.Net Core的HttpClient的默认超时为100秒。虽然很松散，但总比完全没有暂停要好得多。这并不令人惊讶，因为这些语言被用来构建大规模分布式系统，这些系统需要对网络故障具有健壮性。没有超时的网络请求是分布式系统的头号静默杀手。</p><p>经验法则是，在进行网络调用时始终设置超时。如果您构建库，请始终设置合理的默认超时，并使其可为您的客户端进行配置。</p><p>您想了解更多关于分布式系统的稳定性模式和反模式的知识吗？看看我即将出版的书。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://robertovitillo.com/default-timeouts/">https://robertovitillo.com/default-timeouts/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/rust/">#rust</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/信任/">#信任</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/trust/">#trust</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/api/">#api</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1021025.html"><img src="http://img.diglog.com/img/2020/8/thumb_9e49c09f03a5a9e75898902b303332e4.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021025.html">客观-铁锈</a></div><span class="my_story_list_date">2020-8-29 5:41</span></div><div class="col-sm"><div><a target="_blank" href="/story/1020871.html"><img src="http://img.diglog.com/img/2020/8/thumb_c510cf77081d973bc368024d890ae436.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1020871.html">亚马逊：一种新的反垄断风险</a></div><span class="my_story_list_date">2020-8-28 13:51</span></div><div class="col-sm"><div><a target="_blank" href="/story/1020713.html"><img src="http://img.diglog.com/img/2020/8/thumb_10c030b2429f801a5aed8756bdece9d2.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1020713.html">铁锈1.46.0</a></div><span class="my_story_list_date">2020-8-28 0:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1020672.html"><img src="http://img.diglog.com/img/2020/8/thumb_ef1ff0ddcda0fb23a885bf7946696472.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1020672.html">Datasaurus：永远不要相信汇总统计数据；可视化您的数据(2016)</a></div><span class="my_story_list_date">2020-8-27 22:6</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>