<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Action和Event构建功能强大的交互式WebRTC数据通道应用程序</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用Action和Event构建功能强大的交互式WebRTC数据通道应用程序</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-04 00:55:20</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/8e87cfce3abb0f9783979b7abd7d54dd.gif"><img src="http://img.diglog.com/img/2020/7/8e87cfce3abb0f9783979b7abd7d54dd.gif" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>随着2.0版本的发布，Ant Media Server Enterprise Edition支持WebRTC数据通道标准，之前我们发布了3篇博客文章，与Ant Media Server EE的数据通道的设置、使用和实现有关：</p><p>我们上一篇关于此主题的博客文章将介绍通过WebRTC数据通道发送控制消息(如动作和事件)，以及通过使用这些信息创建更具交互性和复杂性的应用程序时的最佳实践。我们将通过我们的Javascript和Android SDK中的一些示例用法来检查两个用例场景，并试图使它们更容易为我们的客户所理解。</p><p>通过数据通道发送各种事件或动作是使用WebRTC实现交互式应用程序最方便、最安全的方式。通过数据信道的低等待时间和安全通信可能特别有用，特别是在交互式应用的情况下，例如在会议中、在电子学习中或在某些游戏中，其中每个参与者具有特定角色并被允许进行特定类型的动作并且可以触发特定事件。</p><p>例如，在电子学习应用程序中，学生可以举手提问，老师可以决定接受或拒绝该请求。如果请求被接受，老师和其他学生将开始播放该学生的视频流。</p><p>公司的视频会议应用也可以实现类似的场景，其中经理可以允许员工在演示期间根据要求发言。类似地，在会议或电子学习期间对主题进行投票、交流某些事件(如静音麦克风)、提醒或戳其他用户或在WebRTC游戏期间发送游戏命令和事件都可以通过数据通道轻松实现。</p><p>正如我们在与聊天应用相关的博客中提到的，我们建议将事件或用户操作作为JSON或XML的结构化数据发送。对于大多数应用程序来说，在接收端使用通用的JSON或XML解析器来解析它们就足够了，但是对于具有针对这些事件的验证模式(如XML Schema或JSON Schema)的复杂应用程序来说，在验证、解析和映射它们时可能会很有用，而且不容易出错。</p><p>当有人将麦克风静音时，JSON格式的示例事件将通过数据通道发送给会议.html页面中的所有会议参与者，如下所示：</p><p>对于更复杂的应用，需要某种类型的通信协议来管理不同用户或系统之间可能的交互。在为交互式和反应式应用程序设计此类协议时，清楚地指定和检查具有特定角色的用户可以生成哪些操作和事件，以及这些事件可以导致哪些其他状态，这一点非常重要。在这种情况下，UML序列图可以帮助记录和设计通信场景，而UML状态图可以帮助处理所有依赖于不同状态和角色的边缘和用例。接下来，我们将讨论一个简单的与用例相关的会议。</p><p>在WebRTC Android SDK中的最新版本的Conference ence.html和ConferenceActivity中，当与会者将其麦克风静音或取消静音，或者启用或禁用要发布的视频流时，会通过WebRTC数据通道向所有其他与会者发送类似上述部分的特殊事件消息。然后，所有其他流参与者解析接收到的事件，并且基于事件类型，开发人员可以定制会议.html以通知用户或在相应的流上显示图标。</p><p>在Web端，当事件收到DATA_RECEIVED信号时，调用回调函数：</p><p>函数handleNotificationEvent(Obj){.console.log(&#34；接收数据：&#34；，obj.event.data)；*var NotificationEvent=JSON.parse(obj.event.data)；*如果(NotificationEvent！=NULL&amp；&amp；typeof(NotificationEvent)==&#34；Object&#34；){*var eventStreamId=NotificationEf(NotificationEvent！=NULL&amp；&amp；typeof(NotificationEvent)==&#34；Object&#34；){**var eventStreamId=NotificationEn。){#34；摄像头关闭时间：&#34；，eventStreamId)；{#34；摄像头关闭时间：&#34；，eventStreamId)；{#34；false if(eventTyp==&#34；CAM_Turned_On&#34；){#34；摄像头打开时间：&#34；，eventStreamId)；{#34；摄像头打开时间：&#34；，eventStreamId)；*#34；其他if(eventTyp==&#34；MIC_静音&#34；){0。麦克风已静音：&#34；，eventStreamId)；麦克风}Else if(eventTyp==&#34；MIC_unmuted&#34；){_unmuted&#34；){_unmuted&#34；console.log(&#34；麦克风未静音for：&#34；，eventStreamId)；{_unmuted&#34；}}。</p><p>在本例中，为简单起见，它只将它们记录到控制台。在Android中，在ConferenceActivity onMessage方法中，通知事件的处理方式类似于Toast消息：</p><p>public void onMessage(DataChannel.Buffer，String dataChannelLabel){*ByteBuffer data=Buffer.data；*string strDataJson=new string(data.array()，StandardCharsets.UTF_8)；或try{#34；JSONObject json=new JSONObject(StrDataJson)；**字符串eventType=json.getString(&#34；eventType&#34；)。：&#34；+StreamId，Toast.LENGTH_Long).show()；**}catch(Exception E){*Log.e(getclass().getSimpleName()，e.getMessage())；**}}。</p><p>请查看Web中的会议.html页面和Android WebRTC SDK中的ConferenceActivity页面，以更好地了解这些消息是如何生成和处理的。</p><p>更复杂的情况是，学生在E-Learning应用程序中举手提问。</p><p>在我们的假设场景中，多个学生可以几乎同时通过WebRTC数据通道发送举手消息，之后教师应该决定接受或拒绝他们的请求之一。因此，教师的回答应该引用他接受或拒绝的RaiseHandRequest发送者的惟一流ID。如果他接受了请求，他会向每个人发送接受消息，请求被接受的学生将自动开始发布他的视频流，其他人将播放该视频流。</p><p>我们在这里并没有展示如何为学生和教师实现不同的角色，但是实现这一点的一种方法是，例如，为教师和学生提供不同的自定义版本的Conference ence.html和ConferenceActivity。我们还可以在我们的场景中添加以下限制：当一个学生提出问题时，其他任何学生都不能要求提出任何问题。为了实现该约束，状态信息可以以以下可能的状态存储在每个参与者中：</p><p>因此，只有当STATE为QUERK_SESSION_EMPTY和STATE为QUERK_SESSION_FULL时，学生才能提问，没有人可以举手提问。在我们的场景中，状态的协调器将是教师，在学生临时断开连接并重新连接的边缘情况下，当前状态应该由教师发送给他。(另一种选择是教师定期发送州作为某种保活消息。)。</p><p>{&#34；senderId&#34；：&#34；教师1&#34；，&#34；eventType&#34；：&#34；RaiseHandAccept&#34；，&#34；EventTime&#34；：1592602986，&#34；AnswerToRequest&#34；：&#34；学生1&#34；，&#34；描述&#34；：&#34；您只有1分钟时间提问&#34；}。</p><p>收到后，学生1开始发布他的视频流，其他人开始播放。</p><p>在这篇博客文章中，我们试图告知我们的客户一些可能的示例用例和使用WebRTC数据通道实施交互式应用程序时的最佳实践。这里我们谈论的是相对简单的用例，但是使用WebRTC数据通道和Ant Media Server SDK可以实现各种令人兴奋的交互式和复杂的项目。“我们希望指导开发人员使用我们的SDK实现他们令人惊叹的、功能丰富的项目。”</p><p>请注意，此处描述的方法和设计决策并不完整，也不是实现此类解决方案的唯一途径。根据您的需求，最适合您需求的设计可以是不同的设计。在我们的所有示例项目中都包含了Conference ence.html和ConferenceActivity，并在2.0版中通过我们的Web、Android和iOS SDK向我们的客户提供了WebRTC数据通道。如果您有任何问题，请写信联系@antmedia.io。</p><p>在举手UML时序图中，简化了可视化通信，使其更加清晰。通常，类参与者之间交换的每条消息都将通过Ant Media ServerEE，因为底层流将处于发布和播放模式。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://antmedia.io/communication-of-actions-and-events-through-webrtc-datachannels-for-interactive-applications/">https://antmedia.io/communication-of-actions-and-events-through-webrtc-datachannels-for-interactive-applications/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/webrtc/">#webrtc</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/action/">#action</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/powerful/">#powerful</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/事件/">#事件</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1006622.html"><img src="http://img.diglog.com/img/2020/6/thumb_6fbb169af0927775593e7875bb64e157.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006622.html">匿名、安全、现代、开源的WebRTC群组视频聊天和BG模糊</a></div><span class="my_story_list_date">2020-6-15 13:48</span></div><div class="col-sm"><div><a target="_blank" href="/story/1006603.html"><img src="http://img.diglog.com/img/2020/6/thumb_b882f1233c9cb611d0fef726d8a5776f.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006603.html">如何使用WebRTC创建视频呼叫应用</a></div><span class="my_story_list_date">2020-6-15 9:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005779.html"><img src="http://img.diglog.com/img/2020/6/thumb_620dae4229626ee37a27475f04dbbf53.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005779.html">Daily.co正在招聘WebRTC视频系统工程师</a></div><span class="my_story_list_date">2020-6-9 8:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005386.html"><img src="http://img.diglog.com/img/2020/6/thumb_be2f3e6d7a800823fb0a687a75822154.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005386.html">使用WebRTC的点对点通信</a></div><span class="my_story_list_date">2020-6-6 9:42</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>