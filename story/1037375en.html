<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Amazon Kindle上运行完整的桌面环境Running a full desktop environment on an Amazon Kindle</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Running a full desktop environment on an Amazon Kindle<br/>在Amazon Kindle上运行完整的桌面环境</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-01 03:58:30</div><div class="page_narrow text-break page_content"><p>In my previous post, I described running Arch on an OpenWRT router. Today, I’ll be taking it a step further and running Arch and a full LXDE installation natively on an Amazon Kindle, which can be interacted with directly using the touch screen. This is possible thanks to the Kindle’s operating system being Linux!</p><p>在我以前的文章中，我描述了在OpenWRT路由器上运行Arch的过程。今天，我将更进一步，在Amazon Kindle上本地运行Arch和完整的LXDE安装，可以直接通过触摸屏与之交互。有了Kindle的操作系统是Linux，这才有可能实现！</p><p> You can see the end result in action  here. Apologies for the shaky video - it was shot using my phone and no tripod.</p><p> 您可以在此处查看最终结果。抱歉，视频晃动-这是使用手机拍摄的，没有三脚架。</p><p> If you’re wanting to follow along, make sure you’ve  rooted your Kindle beforehand. This is essential – without it, it’s impossible to run custom scripts or binaries.</p><p> 如果您想继续学习，请确保已预先扎根Kindle。这是必不可少的-没有它，就无法运行自定义脚本或二进制文件。</p><p> I’m testing this on an 8th generation Kindle (KT3) – it should, however, work for all recent Kindles given you’ve enough storage and are rooted. You also need to set up  USBnetwork for SSH access and optionally  KUAL if you want a simple way of launching the chroot.</p><p> 我正在第8代Kindle（KT3）上对此进行测试-但是，只要您有足够的存储空间并已扎根，它就应该可以用于所有最近的Kindle。如果要启动chroot的简单方法，还需要设置USB网络以进行SSH访问，还可以选择设置KUAL。</p><p> First things first: We need to set up a filesystem and extract an Arch installation into it, which we can later chroot into. The filesystem will be a file which will be mounted as a loop device. The reason why we’re not extracting the Arch installation directly into a directory on the Kindle is because the Kindle’s storage filesystem is FAT32. FAT32 doesn’t support required features such as symbolic links, which would break the Arch installation. Please note that this also means that your chroot filesystem can be 4 gigabytes large, at maximum. This can be worked around by mounting the real root inside the chroot filesystem, which it’s still a hacky way to go about it. But I digress.</p><p> 首先，首先：我们需要建立一个文件系统并将Arch安装解压缩到其中，然后我们可以将其chroot到其中。该文件系统将是一个将作为循环设备挂载的文件。我们之所以没有将Arch安装直接解压缩到Kindle上的目录中，是因为Kindle的存储文件系统为FAT32。 FAT32不支持符号链接等必需的功能，这会破坏Arch的安装。请注意，这也意味着您的chroot文件系统最大可以为4 GB。可以通过在chroot文件系统中挂载真实根目录来解决此问题，这仍然是解决问题的一种方法。但是我离题了。</p><p> First, figure out how large your filesystem actually can be. SSH into your Kindle and see how much free space you have:</p><p> 首先，弄清楚文件系统实际上可以有多大。 SSH进入Kindle，查看您有多少可用空间：</p><p> $  ssh root@192.168.15.244  kindle#   df  -k /mnt/base-us Filesystem 1K-blocks Used Available Use% Mounted on/dev/loop/0 3188640 361856 2826784 11% /mnt/base-us</p><p> $ ssh root@192.168.15.244 kindle＃df -k / mnt / base-us已使用的文件系统1K块可用用法％已安装在/ dev / loop / 0 3188640 361856 2826784 11％/ mnt / base-us</p><p> Seems like we have around 2800000K (around 2.8G) of space available. Let’s make our filesystem 2.6G – it’s enough to host our root filesystem and some extra applications, such as LXDE. Note that I’ll be running the following commands on my PC and transferring the filesystem over later. You can also do all of this on the Kindle, but it’s simply easier and faster this way.</p><p>好像我们有大约2800000K（大约2.8G）的可用空间。让我们将文件系统设置为2.6G，足以托管我们的根文件系统和其他一些应用程序，例如LXDE。请注意，我将在PC上运行以下命令，并在以后转移文件系统。您也可以在Kindle上完成所有这些操作，但是这样做更简单，更快捷。</p><p> Let’s create a blank file of the wanted size. I’m using  dd, but you can also use  fallocate for this:</p><p> 让我们创建一个所需大小的空白文件。我使用的是dd，但您也可以为此使用fallocate：</p><p> $   dd  if =/dev/zero  of =arch.img  bs =1024  count =2600000 2600000+0 records in2600000+0 records out2662400000 bytes (2.7 GB, 2.5 GiB) copied, 6.92058 s, 385 MB/s</p><p> $ dd if = / dev / zero of = arch.img bs = 1024 count = 2600000 2600000 + 0记录in2600000 + 0记录out2662400000字节（2.7 GB，2.5 GiB）复制，6.92058 s，385 MB / s</p><p> Let’s create our filesystem on it. Since we’re doing this on the PC, we need make it 32bit and disable the  metadata_csum and  huge_file options on the filesystem, as the Kindle’s ext4 kernel doesn’t support them.</p><p> 让我们在其上创建文件系统。由于我们是在PC上执行此操作，因此需要将其设置为32位，并在文件系统上禁用metadata_csum和huge_file选项，因为Kindle的ext4内核不支持它们。</p><p> $  mkfs.ext4  -O ^64bit,^metadata_csum,^huge_file arch.img mke2fs 1.45.0 (6-Mar-2019)Discarding device blocks: done Creating filesystem with 650000 4k blocks and 162560 inodesFilesystem UUID: a4e72620-368a-44b4-81bb-9e66b2903523Superblock backups stored on blocks: 	32768, 98304, 163840, 229376, 294912Allocating group tables: done Writing inode tables: done Creating journal (16384 blocks): doneWriting superblocks and filesystem accounting information: done</p><p> $ mkfs.ext4 -O ^ 64bit，^ metadata_csum，^ huge_file arch.img mke2fs 1.45.0（2019年3月6日）丢弃设备块：已完成使用650000个4k块和162560个inode创建文件系统文件系统UUID：a4e72620-368a-44b4- 81bb-9e66b2903523存储在块上的超级块备份：32768、98304、163840、229376、294912分配组表：已完成编写inode表：已完成创建日志（16384块）：已完成写超级块和文件系统记帐信息：已完成</p><p>  $  tune2fs  -c 0  -i 0 arch.img  tune2fs 1.45.0 (6-Mar-2019) Setting maximal mount count to -1Setting interval between checks to 0 seconds</p><p>  $ tune2fs -c 0 -i 0 arch.img tune2fs 1.45.0（2019年3月6日）将最大安装计数设置为-1将两次检查之间的间隔设置为0秒</p><p>   The Kindle I’m using has a Cortex-A9-based processor, so let’s download the ARMv7 version of Arch Linux ARM from  here. You can download it and extract then, or simply download and extract at the same time:</p><p>   我正在使用的Kindle具有基于Cortex-A9的处理器，因此让我们从此处下载ARMv7版本的Arch Linux ARM。您可以下载并解压缩，也可以同时下载并解压缩：</p><p>  sudo is required to extract as it sets up a lot of files with root permissions. You can ignore the errors about  SCHILY.fflags. Verify that the files extracted successfully with  ls -l rootfs/.</p><p>需要sudo来解压缩，因为它设置了许多具有root权限的文件。您可以忽略有关SCHILY.fflags的错误。使用ls -l rootfs /验证是否成功提取了文件。</p><p> Let’s prepare our Kindle for the filesystem. I opted for hosting the filesystem in  extensions/karch as I want to use KUAL for easy launching:</p><p> 让我们为文件系统准备Kindle。我选择在扩展名/ karch中托管文件系统，因为我想使用KUAL来轻松启动：</p><p>  While we’re here, it’s also a good idea to stop the power daemon to prevent the Kindle from going into sleep mode while transferring the filesystem and interrupting our transfer:</p><p>  当我们在这里时，最好停止电源守护程序，以防止Kindle在传输文件系统和中断传输时进入睡眠模式：</p><p>     Once it’s done, let’s SSH in once again and set up our mountpoint:</p><p>     完成后，再次使用SSH并设置我们的挂载点：</p><p>  I decided to set up my own loop device, so I can have it named, but you can ignore this and opt to use  /dev/loop/12 or similar instead. Just make sure it’s already not in use with  mount.</p><p>  我决定设置自己的循环设备，因此可以为其命名，但是您可以忽略它，而选择使用/ dev / loop / 12或类似的设备。只要确保它尚未与mount一起使用即可。</p><p>    kindle#  mount  -o  bind /dev system/dev kindle#  mount  -o  bind /dev/pts system/dev/pts kindle#  mount  -o  bind /proc system/proc kindle#  mount  -o  bind /sys system/sys kindle#  mount  -o  bind /tmp system/tmp kindle#   cp /etc/hosts system/etc/</p><p>    kindle＃安装-o绑定/ dev系统/ dev kindle＃安装-o绑定/ dev / pts系统/ dev / pts kindle＃安装-o绑定/ proc系统/ proc kindle＃安装-o绑定/ sys系统/ sys kindle＃挂载-o bind / tmp system / tmp kindle＃cp / etc / hosts system / etc /</p><p> It’s time to chroot into our new system and set it up for LXDE. You can also use this opportunity to set up whatever applications you need, such as an onscreen keyboard:</p><p> 现在是时候切换到我们的新系统并将其设置为LXDE了。您还可以利用此机会来设置所需的任何应用程序，例如屏幕键盘：</p><p> kindle#   chroot system/ /bin/bash chroot#   echo  &#39;en_US.UTF-8 UTF-8&#39;  &gt; /etc/locale.gen  chroot#  locale-gen chroot#   rm /etc/resolv.conf  chroot#   echo  &#39;nameserver 8.8.8.8&#39;  &gt; /etc/resolv.conf chroot#  pacman-key  --init  # this will take a while chroot#  pacman-key  --populate chroot#  pacman  -Syu  --noconfirm chroot#  pacman  -S lxde xorg-server-xephyr  --noconfirm</p><p>kindle＃chroot系统/ / bin / bash chroot＃echo'en_US.UTF-8 UTF-8'> /etc/locale.gen chroot＃locale-gen chroot＃rm /etc/resolv.conf chroot＃echo'名称服务器8.8。 8.8'> /etc/resolv.conf chroot＃pacman-key --init＃这会花点时间chroot＃pacman-key --populate chroot＃pacman -Syu --noconfirm chroot＃pacman -S lxde xorg-server-xephyr -没有确认</p><p> We use Xephyr because it’s the easiest way to get our LXDE session up and running. Since the Kindle uses X11 natively, we can try using that. It’s possible to stop the native window manager using  stop lab126_gui outside the chroot, but then the Kindle will stop updating the screen with new data, leaving it blank – forcing you to use something like  eips to refresh the screen. The X server still works, however, and you can confirm this by using something like  x11vnc after running your own WM in it. Xephyr spawns a new X server inside the preexisting X server, which is not as efficient but a lot easier.</p><p> 我们使用Xephyr是因为它是启动和运行LXDE会话的最简单方法。由于Kindle本机使用X11，因此我们可以尝试使用它。可以使用chroot外的stop lab126_gui停止本机窗口管理器，但是Kindle将停止使用新数据更新屏幕，将其保留为空白–迫使您使用eips之类的东西来刷新屏幕。 X服务器仍然可以使用，但是您可以在其中运行自己的WM之后通过使用x11vnc之类的方法来确认这一点。 Xephyr在先前存在的X服务器中生成了一个新的X服务器，它效率不高，但容易得多。</p><p> We can however stop everything else related to the native GUI, as we need the extra memory and we can’t use it while LXDE is running anyways:</p><p> 但是，我们可以停止与本机GUI相关的所有其他操作，因为我们需要额外的内存，并且无论如何LXDE都无法运行它：</p><p> chroot#   exit kindle#   SERVICES = &#34;framework pillow webreader kb contentpackd&#34; kindle#   for service  in  ${ SERVICES } ;  do stop  ${ service } ;  done</p><p> chroot＃exit kindle＃SERVICES =“框架枕头webreader kb contentpackd” kindle＃用于$ {SERVICES}中的服务；停止$ {service};做完了</p><p>   Let’s chroot back into the system and see if we can get LXDE to run. Be sure to replace the screen size parameter if needed:</p><p>   让我们重新输入系统，看看是否可以使LXDE运行。如果需要，请确保替换屏幕尺寸参数：</p><p> kindle#   chroot system/ /bin/bash chroot#   export  DISPLAY =:0 chroot#  Xephyr :1  -title  &#34;L:A_N:application_ID:xephyr&#34;  -screen 600x800  -cc 4  -nocursor &amp; chroot#   export  DISPLAY =:1 chroot#  lxsession &amp; chroot#  xrandr  -o right</p><p> kindle＃chroot系统/ / bin / bash chroot＃export DISPLAY =：0 chroot＃Xephyr：1 -title“ L：A_N：application_ID：xephyr” -screen 600x800 -cc 4 -nocursor＆chroot＃export DISPLAY =：1 chroot＃ lxsession和chroot＃xrandr -o对</p><p> If everything goes well, you should have LXDE visible on your Kindle’s screen. Ta-da! Feel free to play around with it. I’ve found that the touch screen is suprisingly accurate, even though it is using an IR LED system to detect touches instead of a normal digitizer.</p><p> 如果一切顺利，您应该在Kindle屏幕上看到LXDE。 -随便玩吧。我发现触摸屏非常准确，即使它使用的是IR LED系统而不是普通的数字转换器来检测触摸。</p><p> Once done in the chroot, Ctrl-C + Ctrl-D can be issued to exit the chroot. We can then restore the Kindle UI by doing:</p><p>在chroot中完成后，可以发出Ctrl-C + Ctrl-D退出chroot。然后，我们可以通过执行以下操作来还原Kindle UI：</p><p>   I’ve mentioned setting up a KUAL extension to automate the entering and exiting of the chroot. You can find that  here. If you’re interested in using this, make sure you’ve set up your filesystem first and copied it over to the same directory as the extension, and that it’s named  arch.img. Everything else is not mandatory - the extension will do it for you.</p><p>   我已经提到过设置KUAL扩展程序来自动执行chroot的输入和退出。您可以在这里找到。如果您对此感兴趣，请确保先设置文件系统，然后将其复制到扩展名所在的目录中，并将其命名为arch.img。其他所有内容都不是必须的-扩展程序将为您完成。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://nns.ee/blog/2019/04/14/chroot-shenanigans-2.html">https://nns.ee/blog/2019/04/14/chroot-shenanigans-2.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/amazon/">#amazon</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/kindle/">#kindle</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/full/">#full</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>