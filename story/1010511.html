<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ariane RISC-V CPU--能够引导Linux的开源CPU</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Ariane RISC-V CPU--能够引导Linux的开源CPU</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-08 17:35:51</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/ac684880eb484ea347aae159cb09b645.png"><img src="http://img.diglog.com/img/2020/7/ac684880eb484ea347aae159cb09b645.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Ariane是实现64位RISC-V指令集的6级、单问题顺序CPU。它完全实现了第一卷：用户级ISA V2.3中指定的I、M、A和C扩展，以及草案特权扩展1.10。它实现了三个特权级别M、S、U，以完全支持类Unix操作系统。此外，它还符合外部调试规范草案0.13。</p><p>它具有可配置的大小、独立的TLB、硬件PTW和分支预测(分支目标缓冲器和分支历史表)。设计的主要目标是减少关键路径长度。</p><p>@文章{8777130，作者={F.{扎鲁巴}和L.{贝尼尼}，期刊={IEEE超大规模集成系统学报}，标题={应用级处理的成本：采用22 nm FDSOI技术的Linux1.7GHz64位RISC-V内核的能量和性能分析}，年份={8777130}，卷={27}，数量={11}，页数={2629-2640}，doi={10.1109/T。</p><p>去拿RISC-V工具。确保您的RISCV环境变量指向您的RISC-V安装(有关详细信息，请参阅RISC-V工具和相关项目)。</p><p>这将创建包括SystemVerilog包装器的核心的C++模型，并将其链接到C++testbench(在TB子文件夹中)。二进制文件可以在工作器中找到，并接受RISC-V ELF二进制文件作为参数，例如：</p><p>Verilator测试平台使用riscv-fesvr。这意味着您可以使用riscv-test存储库以及开箱即用的riscv-pk。根据一般经验，Verilator模型的行为将类似于Spike(例外情况是速度慢了几个数量级)。</p><p>Verilator模型和Questa模拟都将生成跟踪日志。Verilator跟踪更基本，但您可以将日志提供给Spike-dasm以将指令解析为助记符。遗憾的是，目前无法对Verilator跟踪文件进行值检查。</p><p>$ECHO&#39；#include&lt；stdio.h&gt；int main(int argc，char const*argv[]){printf(&#34；Hello Ariane！\\n&34；)；return 0；}&#39；&gt；hello.c$riscv64-UNKNOWN-ELF-GCC hello.c-o hello.elf</p><p>如果要使用QuestaSim运行它，可以使用以下命令：</p><p>耐心点！RTL模拟比斯派克慢得多。如果您认为遇到了问题，可以检查跟踪文件。</p><p>我们目前仅为Genesys 2主板提供支持。我们在这里提供了Genesys 2的预建码流和内存配置文件。</p><p>以太网控制器和相应的网络连接仍在运行中，目前不起作用。预计很快会有一些更新。</p><p>右键单击FPGA设备-从配置存储设备启动(或按FPGA上的程序按钮)。</p><p>默认情况下，第一阶段引导程序将从SD卡引导。给自己买一张合适的SD卡(我们用这张)。从这里获取一个预先构建的Linux映像，或者按照Ariane-SDK存储库中的自述文件自己生成Linux映像。按照Ariane-SDK存储库中的从SD卡引导一节准备SD卡。</p><p>在您插入SD卡并对FPGA进行编程之后，您可以连接到FPGA的串行端口，应该会看到引导加载程序，然后就可以启动Linux了。默认用户名为root，不需要密码。</p><p>要自己为Genesys II板运行生成FPGA位流(和内存配置)，请执行以下操作：</p><p>这将生成一个位流文件和内存配置文件(在fpga/work-fpga中)，您可以通过运行上述命令永久刷新它们。</p><p>您可以使用OpenOCD调试(和编程)FPGA。下面我们提供了两个OpenOCD示例脚本。</p><p>要开始，请将标有JTAG的微型USB端口连接到您的计算机。此端口连接到Genesys 2板上的FTDI 2232 USB转串行芯片，通常用于访问KINTEX-7 FPGA的本地JTAG接口(例如，使用Vivado对设备进行编程)。然而，FTDI芯片还暴露了第二条串行链路，该链路被路由到FPGA上的GPIO引脚，我们利用这一点从RISC-V调试模块连接JTAG。</p><p>如果您使用的是基于Ubuntu的系统，则需要将以下udev规则添加到/etc/udev/rules.d/99-ftdi.ules。</p><p>连接到系统后，键入lsusb时应会列出FTDI芯片：</p><p>Bus 005 Device 019：ID 0403：6010 Future Technology Devices International，Ltd FT2232C/D/H Dual UART/FIFO IC。</p><p>如果是这种情况，您可以继续使用fpga/ariane.cfg配置文件启动openocd：</p><p>$openocd-f fpga/ariane.cfg开放片上调试器0.10.0+dev-00195-g933cb87(2018年9月14日19：32)获得GNU GPL v2许可。有关错误报告，请阅读http://openocd.org/doc/doxygen/bugs.htmladapter速度：1000kHzInfo：自动选择第一个可用的会话传输&#34；JTAG&#34；。要覆盖使用TRANSPORT SELECT&lt；TRANSPORT&gT；&#39；.info：时钟速度1000 kHzInfo：TAP riscv.cpu没有IDCODEInfo：datacount=2程序bufsize=8Info：已检查RISC-V核心；找到1个hartsInfo：HART 0：XLEN=64，MISA=0x8000000000141105Info：侦听端口3333上的GDB连接准备</p><p>$riscv64-未知-elf-gdb/path/to/elf(Gdb)目标远程本地主机：3333(Gdb)loadLoad段.text，大小0x6508 LMA 0x80000000加载段.rodata，大小0x900 LMA 0x80006508(Gdb)b putchar(Gdb)cContinuing.Program接收信号SIGTRAP，跟踪/断点陷阱。0x00000080009126 in putcha.0x00000080009126 in putcha.0x00000080009126 in putchar。</p><p>(Gdb)x/i 0x1000 0x1000：lui t0，0x4(Gdb)set{int}0x1000=22(Gdb)set$PC=0x1000。</p><p>Ariane初步支持普林斯顿大学的OpenPiton分布式缓存系统。为此，已经开发了不同的L1高速缓存子系统(src/cache_subsystem/wt_cache_subsystem.sv)，其遵循直写协议并且支持高速缓存无效和原子。</p><p>OpenPiton GitHub存储库将发布相应的集成补丁。检查该存储库中的自述文件，了解如何在OpenPiton设置中使用Ariane。</p><p>要激活不同的缓存系统，请使用宏WT_DCACHE(默认设置)编译代码。</p><p>核心是使用QuestaSim的完整许可版本开发的。如果您自己恰好有这个模拟器，这里是如何使用它来运行内核的。</p><p>要指定要运行的测试，请使用以下命令(例如：您希望在tmp/risc-tests/build/isa文件夹内运行rv64ui-p-Sraw：</p><p>如果您使用Batch-mode=1调用sim，它将在没有GUI的情况下运行。QuestaSim也使用riscv-fesvr进行通信。</p><p>我们为运行RISCV装配测试的Travis CI和GitLab CI提供了两个CI配置文件，即RISCV基准测试和随机RISCV拷问测试。两者的区别在于Travis CI仅在Verilator上运行这些测试，而GitLab CI在QuestaSim和Verilator上运行相同的测试。</p><p>如果您想要在您的机器上本地运行CI测试套件，请遵循两个脚本ci/travis-ci-mulul.sh和ci/travis-ci-mulul.sh中的任何一个(取决于您是否有QuestaSim)。特别是，在运行任何测试套件之前，您必须获取系统所需的软件包、ci/path-setup.sh中的路径以匹配您的设置，并运行安装和构建脚本。</p><p>完成所有设置和安装后，您可以按如下方式运行测试套件(使用Verilator)：</p><p>为了运行随机化酷刑测试，您首先必须在运行模拟之前生成随机化程序：</p><p>这将在Spike和RTL目标上运行随机化程序，并检查两个签名是否匹配。随机指令混合可以在./tmp/riscv-cutry/config/default.config文件中配置。</p><p>Ariane可以在Questa中转储跟踪日志，这很容易与启用提交日志的Spike区别开来。在include/ariane_pkg.sv集中：</p><p>这将在Spike和RTL目标上运行随机化程序，并检查两个签名是否匹配。随机指令混合可以在./tmp/riscv-cutry/config/default.config文件中配置，这将转储一个名为trace_hart_*_*_comm.log的文件。</p><p>这对于调试长痕迹(例如：酷刑痕迹)很有帮助。要使用提交日志功能编译SPEKE，请执行以下操作：</p><p>$apt-get安装设备树编译器$mkdir build$cd build$../configure--prefix=$RISCV--with-fesvr=$RISCV--enable-Commitlog$make$[sudo]make install。</p><p>在标准配置中，调试模块将负责加载内存内容。它还将处理与riscv-fesvr的通信。根据场景的不同，这可能不会被禁用(例如：在模拟中预加载大型ELF或Linux引导)。您可以使用PRELOAD ELF标志来指定将被预加载的二进制文件的路径。</p><p>用于RTL模拟的零级引导加载器(ZSBL)位于boot trom/中，而FPGA的引导代码位于fpga/src/boot trom中。RTL引导代码只是跳转到DRAM的基址，在那里FSBL接管。对于FPGA，ZSBL执行额外的内务处理。两个引导加载器分别将hartid和地址传递给参数寄存器a0和a1中的设备树。</p><p>要重新生成引导代码，您可以使用这些目录中的现有Makefile。要生成SystemVerilog文件，您需要在系统上安装位串python包。</p><p>转储检查点。这是参考模型的整个建筑状态。DroMajo丢弃了主内存和引导内存。此外，它还生成引导代码。如果您要运行该代码，它将恢复整个体系结构状态。这意味着您可以通过运行这段代码使任意两个或更多核心进入完全同步的体系结构状态。</p><p>将检查点加载到RTL内存和RTL中的DroMajo实例。DroMajo作为共享库链接到模拟器。RTL通过一组DPI调用与DroMajo通信。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/openhwgroup/cva6">https://github.com/openhwgroup/cva6</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开源/">#开源</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cpu/">#cpu</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1010306.html"><img src="http://img.diglog.com/img/2020/7/thumb_06d860c4d875e6518c704867de54acff.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010306.html">爱尔兰医疗服务开源官员新冠肺炎跟踪应用</a></div><span class="my_story_list_date">2020-7-7 20:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1010115.html"><img src="http://img.diglog.com/img/2020/7/thumb_1e394671127f41c1824f89be5a0d297e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010115.html">M60-开源USB和BLE，Python驱动的热插拔机械键盘</a></div><span class="my_story_list_date">2020-7-6 22:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1010087.html"><img src="http://img.diglog.com/img/2020/7/thumb_982b6052cfae67b7a9a6f69b333fce11.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010087.html">开源货币</a></div><span class="my_story_list_date">2020-7-6 16:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1010042.html"><img src="http://img.diglog.com/img/2020/7/thumb_1556e925c616150c018b7910c7500497.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010042.html">仅限新手</a></div><span class="my_story_list_date">2020-7-6 8:48</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>