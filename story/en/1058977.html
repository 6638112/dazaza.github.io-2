<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Selenium，Cron和Python记录虚拟种族结果 Logging Virtual Race Results with Selenium, Cron and Python</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Logging Virtual Race Results with Selenium, Cron and Python<br/>使用Selenium，Cron和Python记录虚拟种族结果 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-18 18:25:37</div><div class="page_narrow text-break page_content"><p>Who else hates doing repetitive tasks that you know could be automated? I know I do  🙋‍♀️. This is part two about how I used cron jobs and python to take care of ‘the boring stuff’ ( link to Part 1). In this article I will discuss how I used Strava’s API and cron jobs to automatically post new activities for virtual races on RunSignup.</p><p>谁讨厌做你知道的重复任务可以自动化？我知道我做♥。这是关于我如何使用Cron作业和Python照顾“无聊的东西”（链接到第1部分）的第二部分。在本文中，我将讨论如何使用strava的API和Cron作业，以自动发布Runsignup上的虚拟比赛的新活动。</p><p>        Coronavirus caused all of us active outdoorsy folks to get creative about how we could continue our races. The virtual  Circumpolar Race Across the World (CRAW for short) was the one of the results. For this race you have to track all of your hikes/bikes/runs/etc and then log them online via  RunSignup.</p><p>        冠状病毒导致我们所有的户外人员都能创造着我们如何继续我们的比赛。世界上虚拟的Circumpolar竞赛（简短的爬行）是结果之一。对于这场比赛，您必须跟踪所有徒步旅行/自行车/运行/ etc，然后通过runsignup在线在线记录它们。</p><p>      It’s not a very long or complicated process, but I couldn’t get over the feeling that it was one step too long. If Strava was already keeping track of the activities why couldn’t I just have Strava tell RunSignup what I was doing instead of entering it myself?</p><p>      这不是一个非常长的或复杂的过程，但我无法克服它的感觉太长了。如果Strava已经追踪了这些活动，为什么我不能刚刚争取争夺统一，而不是自己进入它？</p><p>          In this section I’ll break down the various functions that come together to make up the python program that downloads the activities from Strava and uploads them to CRAW. They are all executed with a little bit of python glue when the file crawActivities.py is run.</p><p>          在本节中，我将分解各种函数，以组成弥补从Strava下载活动的Python程序并将其上传到爬行。当文件crawactivities.py运行时，它们都在用一点点Python胶水执行。</p><p>    This function handles accessing the app’s tokens.json file, which provides access to the Strava API. It checks to see if the token is expired, and calls refresh_token() to get a new token if it is.</p><p>    此功能处理访问应用程序的令牌.JSON文件，该文件提供对strava API的访问。它检查令牌是否已过期，并调用refresh_token（）如果是，请拨打新令牌。</p><p>      This function makes a get request to Strava’s ‘activities’ endpoint, which returns a json object consisting of an array of  SummaryActivity objects. There is no specific definition for this endpoint in the documentation, but it works similarly to the  “List Athlete Activities” endpoint. The function uses the ‘&amp;after=’ parameter to request only activities that were uploaded after the last time cron ran the program (this time is stored in the .env file and updated at the end of the program).</p><p>      此函数使请求GET请求strava的“活动”端点，该端点返回由emputeactivity对象的数组组成的JSON对象。文档中此端点没有具体定义，但它与“列出运动员活动”端点类似。该函数使用'＆amp; after ='参数来仅请求在最后一次Cron ran ran ran ran ran ran ran ran的活动（此时间存储在.env文件中并在程序结束时更新）。</p><p>    The simplest way to upload all of my activities using selenium is to upload a CSV of all the data. This involved two button clicks as opposed to five plus if Selenium had to enter each value for each activity by ‘hand’.</p><p>    使用Selenium上传所有活动的最简单方法是上传所有数据的CSV。如果Selenium必须通过“手”将每个活动输入每个活动，则这两个按钮点击，而不是五加。 </p><p>  If the json object returned by Strava is not empty and there are new activities to upload, this function handles putting the data in a the CSV. It takes the json object returned by Strava and uses csv.DictWriter to write the date, distance and type of activity out to a CSV (ignoring all the other data points). This function also reformats this data a bit to match the format required by RunSignup.</p><p>如果strava返回的JSON对象不是空的，并且有新的活动上传，则此功能将数据放在CSV中。它需要Strava返回的JSON对象，并使用CSV.DictWriter将活动的日期，距离和类型写入CSV（忽略所有其他数据点）。此功能还重新格式化此数据一部分以匹配RunSignup所需的格式。</p><p>    Here’s where the magic happens. Selenium is essentially a series of finding an element  via various methods (your web browser’s developer tools will be helpful for this) and then doing something with the element. This function opens up a Chrome web browser instance, navigates to the CRAW activity upload page, authenticates, uploads the activity CSV and checks to see if the upload was successful.</p><p>    这是魔法发生的地方。 Selenium基本上是一系列通过各种方法查找元素（您的Web浏览器的开发人员工具对此有所帮助），然后用元素做点什么。此函数打开了Chrome Web浏览器实例，导航到Craw Activity Upload页面，验证，上传活动CSV并检查上传是否成功。</p><p>  I think it’d be helpful to see the actual code, I’ve added lots of comments to help clarify what each bit is doing:</p><p>  我认为看到实际代码有所帮助，我添加了很多评论，以帮助澄清每一位正在做的事情：</p><p>        This function runs at the end of the program and it updates the date of last upload in .env file to the current date and time. By keeping track of when the upload last ran, I make sure to only upload new activities.</p><p>        此函数在程序的末尾运行，并且它将上传的日期更新为.env文件到当前日期和时间。通过跟踪上传最后一次ran时，我确保只上传新活动。</p><p>          My cron job executes the above python script everyday at 9:01 am, provided that my laptop is on and active. Setting the cron job up is quite simple. Merely run ‘crontab -e’ in your command prompt and then add the following line of code to the file:</p><p>          我的Cron作业每天在上午9:01在上午9:01执行上述Python脚本，只要我的笔记本电脑亮起。设置Cron Job Up非常简单。仅在命令提示符中运行'crontab -e'，然后将以下代码行添加到文件中：</p><p>      ‘1 9 * * *’ tells cron to run this program at 9:01 am everyday.  Learn more about how to tell cron when to run your program.  /Users/kellyfoulk/Documents/code/crawUpload/cron.sh is  the file (a bash script) that cron will run at the time listed above. &gt;&gt; /Users/kellyfoulk/Documents/code/crawUpload/cronlog.txt 2&gt;&amp;1 tells cron to send any program output (ie errors, printed statements, etc). I have the output being sent to a file cronlog.txt which is stored in the same folder as my application.</p><p>      '1 9 * * *'告诉Cron每天上午9:01运行这个程序。了解有关如何判断Cron何时运行程序的更多信息。 /users/kellyfoulk/documents/code/crawupload/cron.sh是Cron在上面列出的时间运行的文件（bash脚本）。 ＆gt;＆gt; /users/kellyfoulk/documents/code/crawupload/cronlog.txt 2＆gt;＆amp; 1告诉cron发送任何程序输出（即错误，打印语句等）。我将输出发送到文件cronlog.txt，它存储在与我的应用程序相同的文件夹中。</p><p>    Let’s talk a bit more about that bash script cron runs. It’s a simple script that activates the virtual environment, runs  crawActivities.py (the python script), and then deactivates the virtual environment. This script also tells the crontab where to find my ChromeDriver download. This is what the script looks like:</p><p>    让我们更多地谈谈Bash脚本Cron运行。它是一个激活虚拟环境的简单脚本，运行crawactivities.py（python脚本），然后取消激活虚拟环境。此脚本还告诉CRONTAB在哪里可以查找我的扫描程序下载。这是脚本的样子： </p><p>      Setting up Selenium and making sure it could access my ChromeDriver download was a bit finicky, but all in all this was a fun project that made me feel like a wizard and saves me approximately five minutes every night.</p><p>设置硒并确保它可以访问我的铬代程序下载有点挑剔，但一切都是一个有趣的项目，让我觉得自己觉得巫师并每晚拯救我大约五分钟。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://kellyfoulk.herokuapp.com/post/7">https://kellyfoulk.herokuapp.com/post/7</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/selenium/">#selenium</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/virtual/">#virtual</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/活动/">#活动</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>