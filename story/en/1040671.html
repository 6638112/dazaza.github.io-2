<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>媒体压缩算法的无声革命，公众未注意到 The silent revolution of media compression algorithms, unnoticed by the public</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">The silent revolution of media compression algorithms, unnoticed by the public<br/>媒体压缩算法的无声革命，公众未注意到 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-19 08:38:06</div><div class="page_narrow text-break page_content"><p>Emacs Conf 2020 just started creating optimized videos of theirrecordings, so I gathered the recommendations I worked out over thepast years to compress video with ffmpeg.</p><p>Emacs Conf 2020刚刚开始创建其录制的优化视频，因此我收集了过去几年制定的建议，以使用ffmpeg压缩视频。</p><p>  The typical approach is to provide low-resolution video for those withslower connections. As an alternative that I prefer, it is possible touse extreme compression settings in vp9 to get high-resolution videowith low bandwidth.</p><p>  典型的方法是为连接速度较慢的用户提供低分辨率视频。作为我更喜欢的替代方法，可以在vp9中使用极限压缩设置来获得具有低带宽的高分辨率视频。</p><p> That will take more encoding time, so it’s a mid-term solution, but itcan reduce bandwidth a lot.</p><p> 这将花费更多的编码时间，因此这是一个中期解决方案，但可以大大减少带宽。</p><p> Here’s my advice for ffmpeg-parameters that work pretty well. Adjust EXT to the extension of the filetype to transcode, and adjust  Qfor different quality settings (56 is easily enough for talks, andtext works pretty well, for high-movement scenes you might need to godown to 42, but do test first!).</p><p> 这是我对有效的ffmpeg参数的建议。将EXT调整为文件类型的扩展名以进行转码，并针对不同的质量设置调整Q（56可以很容易地进行对话，并且文本可以很好地工作，对于高动态场景，您可能需要降低到42，但是首先要进行测试！）。</p><p> These parameters were worked out by people in the  Freenet Projectwhere bandwidth is even more scarce than with self-hosting in theclearnet or on mobile platforms.</p><p> 这些参数是由Freenet项目中的人员计算出来的，与在clearnet或移动平台上进行自我托管相比，带宽更加匮乏。</p><p> Q=56;  EXT= &#34;webm&#34; time for i  in *.${ EXT};  do nice ffmpeg -y -i  &#34;$i&#34; -c:v libvpx-vp9 -b:v 0 -crf $ Q  \ -aq-mode 2 -an  \ -tile-columns 0 -tile-rows 0  \ -frame-parallel 0 -cpu-used 8  \ -auto-alt-ref 1 -lag-in-frames 25 -g 999  \ -pass 1 -f webm -threads 8  \  &#34;$( basename  &#34;$i&#34; .${EXT})&#34;.temp; nice ffmpeg -y -i  &#34;$i&#34; -c:v libvpx-vp9 -b:v 0 -crf $ Q  \ -aq-mode 2 -c:a libopus -b:a 12k  \ -tile-columns 2 -tile-rows 2  \ -frame-parallel 0 -cpu-used -5  \ -auto-alt-ref 1 -lag-in-frames 25  \ -pass 2 -g 999 -threads 8  \  &#34;$( basename  &#34;$i&#34; .${EXT})&#34;-vp9-q${ Q}.webm; done</p><p> Q = 56； EXT =＆＃34; webm＆＃34;我在*。$ {EXT}中的时间；做得很好ffmpeg -y -i＆＃34; $ i＆＃34; -c：v libvpx-vp9 -b：v 0 -crf $ Q \ -aq-mode 2 -an \ -tile-columns 0 -tile-rows 0 \ -frame-parallel 0 -cpu-used 8 \ -auto- alt-ref 1-滞后帧25 -g 999 \ -pass 1 -f webm -threads 8 \＆＃34; $（basename＆＃34; $ i＆＃34;。$ {EXT}）＆＃34 ; .temp;不错的ffmpeg -y -i＆＃34; $ i＆＃34; -c：v libvpx-vp9 -b：v 0 -crf $ Q \ -aq-mode 2 -c：a libopus -b：a 12k \ -tile-columns 2 -tile-rows 2 \ -frame-parallel 0- cpu-used -5 \ -auto-alt-ref 1-滞后帧25 \ -pass 2 -g 999 -threads 8 \＆＃34; $（basename＆＃34; $ i＆＃34;。$ { EXT}）＆＃34; -vp9-q $ {Q} .webm;完成</p><p> I’ve seen high-quality baked-in subtitles of Anime stay crisp at crfhigher than 42. For fixed video files (not live streaming) I wouldalways go for the crf-approach, since it produces fewer glitches andstill provides reasonable constraints on bandwidth.</p><p> 我已经看到高质量的动漫动画字幕在高于42的情况下仍然保持清晰。对于固定视频文件（不是实时流），我还是会采用crf方法，因为它产生的毛刺更少，并且仍然对带宽提供了合理的限制。 </p><p> To make it easier for you to check the different qualities, I uploadedan experiment I did with different encoding qualities of  New Horizons for Science. This is from2017 and AFAIK encoder quality got a bit better since then, but itshould still give you a good starting point to choose the crf(the parameter  Q in my code-snippet).</p><p>为了让您更轻松地检查不同的质量，我上传了一个实验，该实验是对《 New Horizo​​ns for Science》的不同编码质量进行的。这是从2017年开始的，此后AFAIK编码器的质量有所提高，但是它仍然可以为您选择crf（我的代码段中的参数Q）提供一个很好的起点。</p><p>  For the video above I decided to go with crf=56 after this test, because5MiB can be sent in an email without feeling big, and because it makesme smile sheepishly to send around a high-resolution video with abitrate of an audio-file from when I started into p2p networks :-).</p><p>  对于上面的视频，我决定在此测试之后使用crf = 56，因为5MiB可以通过电子邮件发送而不会感觉很大，并且因为从那时起，发送带有音频文件的高分辨率视频来发送高分辨率视频时，我的笑容令人毛骨悚然。我开始进入p2p网络:-)。</p><p> Note that if you go with CRF below 56, you might want to adjust theopus bandwidth (-b:a 12k) to 16k. Going to the extreme limit of opusfor complex audio is only worth it if you also go to the limits of thevideo, otherwise the bitrate savings of going to the limit of theaudio-stream (with Opus which is already extremely efficient in normaloperation) just isn’t relevant.</p><p> 请注意，如果您使用的CRF低于56，则可能需要将剧集带宽（-b：a 12k）调整为16k。仅当您也要达到视频的极限时，才将复杂音频的极限值设置为最高值是值得的，否则节省音频流极限的比特率（使用Opus在正常操作中已经非常有效）就不值得了。相关。</p><p>  -cpu-used -5 in pass2: This slows down encoding A LOT, but it is the highest value I found that still produces sufficient quality. You can go down to -8, but the added quality isn’t as spectacular as the added encoding time :-) (there were benchmarks that show the cutoff at -5, but I don’t have them at hand)-cpu-used 8 in pass1: This makes the first pass fast and does not impact quality. Remember to put -5 for the second pass.</p><p>  -cpu-used -5 in pass2：这会减慢A LOT的编码速度，但这是我发现仍能产生足够质量的最高值。您可以降低到-8，但是增加的质量不如增加的编码时间:-)（有些基准显示的截止值为-5，但我手边没有）-cpu-在pass1中使用了8：这使第一次通过很快，并且不影响质量。请记住将-5作为第二遍。</p><p> -g 999: This basically increases the time between keyframes to about 30s. This impacts fast-forward and jumping to specific timecodes, so you might want to use a lower value. -g 300 still gives a keyframe every 10s, so it should be less noticeable.</p><p> -g 999：这基本上将关键帧之间的时间增加到大约30s。这会影响快进并跳转到特定的时间码，因此您可能需要使用较小的值。 -g 300仍然每10秒给出一个关键帧，因此它应该不太明显。</p><p> -auto-alt-ref 1 -lag-in-frames 25: This allows encoding by taking data of &#34;future&#34; frames. It substantially improves text-overlays</p><p> -auto-alt-ref 1-滞后帧25：这允许通过获取＆＃34; future＆＃34;框架。它大大改善了文字覆盖</p><p>  To stream stuff, see  Volker Tanger’s Live Streaming HowTo (for theclearnet) or  How to stream into Freenet for experimentaldecentralized, anonymous streaming.</p><p>  要流式传输内容，请参阅Volker Tanger的Live Streaming HowTo（针对clearnet）或How to stream to Freenet以进行分散式实验性匿名流式传输。 </p><p> You might asks why I don’t suggest av1 for Emacs Conf. I’m activelyexperimenting with that, and using  -cpu-used 1 with all tricks canalmost halve the bitrate compared to the vp9 call below and still getbetter quality, but at the cost of taking 3 days to encode a mere 3minutes. That’s on a not too low-specced system (almost 10 CPU-days at4 Ghz). To re-compress the whole conference, this is currently far tooexpensive. Values for cpu-used above one actually give worse resultsthan the vp9 call. With av1 I see speeds below 0.0008x — every secondtakes 20 minutes to encode, one minute takes roughly one day toencode.</p><p>您可能会问，为什么我不建议Emacs Conf使用av1。我正在为此进行积极的实验，并且将-cpu-used 1与所有技巧结合使用，与下面的vp9调用相比，可以将比特率几乎减半，并且质量仍然更好，但是要花3天的时间才能编码3分钟。那是在不太低规格的系统上（4 GHz时将近10个CPU天）。要重新压缩整个会议，目前这太昂贵了。实际上，cpu用过的值比vp9调用要差。使用av1时，我看到速度低于0.0008倍-每秒花费20分钟进行编码，一分钟大约需要一天的时间进行编码。</p><p> That said, this is an ffmpeg-call with optimized AV1-parameters forminimum filesize (no guarantees for perfection: most of theseparameters are experimental — following the descriptions in the docs —and I could not yet test the changes due to each parameter):</p><p> 就是说，这是一个ffmpeg调用，具有优化的AV1参数以实现最小文件大小（不保证完美：这些参数中的大多数都是实验性的-遵循文档中的说明-由于每个参数我还无法测试更改）：</p><p> Q=56 &amp;&amp;  EXT= &#34;mkv&#34; &amp;&amp;  time for i  in *.${ EXT};  do nice ffmpeg -y -i  &#34;$i&#34; -c:v libaom-av1 -strict -2  \ -b:v 0 -crf $ Q  \ -aq-mode 2 -an  \ -sc_threshold 0  \ -row-mt 1 -tile-columns 2 -tile-rows 2 -threads 12  \ -cpu-used 8  \ -auto-alt-ref 1 -lag-in-frames 25 -g 999  \ -pass 1 -f webm  \  &#34;$( basename  &#34;$i&#34; .${EXT})&#34;-av1.temp nice ffmpeg -y -i  &#34;$i&#34; -c:v libaom-av1 -strict -2  \ -b:v 0 -crf $ Q -aq-mode 2  \ -sc_threshold 0  \ -row-mt 1 -tile-columns 2 -tile-rows 2 -threads 8  \ -cpu-used 1  \ -auto-alt-ref 1 -lag-in-frames 25 -g 999  \ -c:a libopus -b:a 12k  \ -pass 2 -threads 12  \  &#34;$( basename  &#34;$i&#34; .${EXT})&#34;-av1-q${ Q}-cpu-used-1.webm  #  create a preview image to use as poster; position: 5s (-ss 5) mplayer  &#34;$i&#34; -ss 5 -nosound -vo jpeg: outdir=. -frames 1 mv 00000001.jpg  &#34;$( basename  &#34;$i&#34; .${EXT})&#34;-av1.jpg  done</p><p> Q = 56＆amp;＆amp; EXT =＆＃34; mkv＆＃34; ＆amp;＆amp;我在*。$ {EXT}中的时间；做得很好ffmpeg -y -i＆＃34; $ i＆＃34; -c：v libaom-av1 -strict -2 \ -b：v 0 -crf $ Q \ -aq-mode 2 -an \ -sc_threshold 0 \ -row-mt 1 -tile-columns 2 -tile-rows 2-线程12 \ -cpu-used 8 \ -auto-alt-ref 1-滞后帧25 -g 999 \ -pass 1 -f webm \＆＃34; $（基本名称＆＃34; $ i＆＃34; 。$ {EXT}）＆＃34; -av1.temp nice ffmpeg -y -i＆＃34; $ i＆＃34; -c：v libaom-av1 -strict -2 \ -b：v 0 -crf $ Q -aq-mode 2 \ -sc_threshold 0 \ -row-mt 1 -tile-columns 2 -tile-rows 2 -threads 8 \ -cpu-used 1 \ -auto-alt-ref 1-滞后帧25 -g 999 \ -c：a libopus -b：a 12k \ -pass 2-线程12 \＆＃34; $（basename＆ ＃34; $ i＆＃34;。$ {EXT}）＆＃34; -av1-q $ {Q} -cpu-used-1.webm＃创建预览图像以用作海报；位置：5s（-ss 5）mplayer＆＃34; $ i＆＃34; -ss 5 -nosound -vo jpeg：outdir =。 -frames 1 mv 00000001.jpg＆＃34; $（basename＆＃34; $ i＆＃34;。$ {EXT}）＆＃34; -av1.jpg完成</p><p> This requires around 40h of encoding time for the 2.5 minutes ofvideo, but the result is stunning:</p><p> 对于2.5分钟的视频，这大约需要40h的编码时间，但结果令人震惊：</p><p>  The quality 60 version is down to 1MiB per minute — 128kbit/s for HDvideo, and if you don’t know where to look there is almost no visiblebreakage. If you don’t see how awesome that is, you did not grow upwith a computer in the filesharing age  :-)</p><p>  高质量60版本的速度降至每分钟1MiB — HDvideo为128kbit / s，如果您不知道在哪里看，几乎看不到破裂。如果您看不到这真棒，那您是不是在文件共享时代随计算机长大的:-)</p><p> The quality 63 version even gets down to 87.5kbits/s. Watch the videoto judge the quality yourself.</p><p> 质量为63的版本甚至降至87.5kbits / s。观看视频以自行判断质量。</p><p> With these codecs we could do swarming HD-video streaming on anancient double-ISDN line. A private DSL connection with 40Mbit/supstream would suffice to stream pre-converted low-movement HD-videoto 400 fans. This is the silent revolution of media compressionalgorithms whose potential has mostly gone un-noticed by the public.</p><p> 有了这些编解码器，我们就可以在古老的双ISDN线路上集中处理高清视频流。具有40Mbit / supstream的专用DSL连接足以将预转换的低移动高清视频流式传输到400个风扇。这是媒体压缩算法的无声革命，其潜力几乎没有被公众注意到。 </p><p> At 40MiB per hour, all the recordings from the main track of a threeday conference would fit on a simple DVD or an old 4GB USB stick (thecheapest you get). A plain CD could hold 20 hours of standup comedy,and the typical 32GB USB stick would hold 800 hours of low-movementvideo — that’s more than a full month non-stop video.</p><p>以每小时40MiB的速度，为期三天的会议的主要记录中的所有记录都可以放在简单的DVD或旧的4GB USB记忆棒上（最便宜）。一张普通的CD可以容纳20个小时的单口喜剧，而典型的32GB USB棒可以容纳800个小时的慢速运动视频，这比一个月的不间断视频还多。</p><p> From a few tests I did, high-movement video is about 5x as big, butthat still leaves us with almost one week of video on a plain 32GiBUSB stick — which is cheaper to buy than a typical monthly streamingsubscription.</p><p> 从我进行的几次测试中，高动态视频的大小大约是后者的5倍，但这仍然使我们可以在普通的32GiBUSB记忆棒上放近一周的视频，这比通常的每月流媒体订阅价格便宜。</p><p> Despite being purely digital, the encoding time vs. bandwidth clearlymakes this an  economy of scale. Do you still wonder why streamingplatforms are currently shooting up like mushrooms? However this wouldalso scale perfectly with decentralization: One gaming-PC wouldsuffice to encode the creative output of a professional youtuber withhigh production-quality like  CGP Grey or  maiLab (10-30 minutes perweek). Looking only at electricity, that’s around 50€ per month.Investing that would allow to self-compress the video enough that itcould be sent by email, avoiding the need for centralizedinfrastructure.</p><p> 尽管是纯数字格式，但编码时间与带宽的对比显然使它具有规模经济性。您是否仍然想知道为什么流媒体平台现在像蘑菇一样迅速增长？但是，这也可以通过分散进行完美地扩展：一台游戏PC足以编码具有高生产质量的专业youtuber的创意输出，例如CGP Gray或maiLab（每周10-30分钟）。仅看电，每个月大约需要50欧元。投资该视频可以将视频自动压缩到足以通过电子邮件发送的程度，而无需集中式基础设施。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.draketo.de/software/ffmpeg-compression-vp9-av1">https://www.draketo.de/software/ffmpeg-compression-vp9-av1</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/算法/">#算法</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/媒体/">#媒体</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/视频/">#视频</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>