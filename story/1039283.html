<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Google Cloud：隔夜72,000美元的账单 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Google Cloud：隔夜72,000美元的账单 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-12 22:12:51</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/d5bb938ce499ac2b9793159b77edad1f.jpg"><img src="http://img2.diglog.com/img/2020/12/d5bb938ce499ac2b9793159b77edad1f.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>初创公司Milkie Way的创始人Sudeep Chauhan在一次账单震惊的情况下遭受了惨重考验，该账单上有一笔$ 7.00的帐单预算和免费的Google Cloud Platform（GCP）数据库计划，一夜之间产生了$ 72,000的发票。</p><p>  ＆＃34;我跳下床，登录Google Cloud Billing，看到一张约5,000美元的账单，＆＃34; Chauhan在他的公司的博客上写道。 ＆＃34;超级强调，不确定发生了什么，我四处张望，试图找出正在发生的事情。我也开始考虑可能发生的事情，以及如何支付$ 5K的账单。问题是，账单每分钟都在上涨。两个小时后，它的价格略低于$ 72,000。</p><p>  尤其令人惊讶的是，乔汉（Chauhan）曾经是Google的一员，甚至曾担任支付技术项目经理两年。发生了什么？</p><p>  这个想法是建立一个可以抓取网页并将结果存储在数据库中的系统。他的团队选择了Google Cloud Run（一项运行容器的GCP服务）来完成这项工作。然后，他们发现每个实例中的代码都将超时并停止，因为它一页一页地刮到另一页。因此，他们建立了一个多实例系统，该系统可以并行处理页面，以在运行时限制内获取并存储每个页面。</p><p>  开发人员被邀请烘烤＆＃39;在Google Cloud上运行＆＃39;按钮进入git repos ...当然是Google了</p><p>  阅读更多</p><p>  Chauhan写道：＆＃34;为了克服超时限制，我建议使用POST请求（以URL作为数据）将作业发送到一个实例，并[使用]并行使用多个实例，而不是串行使用一个实例。因为Cloud Run中的每个实例只能刮取一页，所以它永远不会超时，并行（缩放）处理所有页面，并且由于Cloud Run的使用精确到毫秒，因此也得到了高度优化。 </p><p>前Googler反映，他错过了链接回彼此的页面的可能性，从而导致＆＃34;无限递归。不过，这应该没什么大不了的：他将帐单预算设置为$ 7.00，并且有免费计划的Firebase数据库。 ＆＃34;我们想象中最糟糕的情况是超出了每日免费Firestore限制，＆＃34;他说。此外，该帐户的信用卡的支出限额为100美元。</p><p>  不幸的是，结算预算不会自动限制Google Cloud或Google Maps Platform的使用/支出，＆＃34;根据文档。</p><p>  经过一天的测试，Chauhan处于睡眠状态，但Google发送了一封自动电子邮件，通知他，由于Google Cloud中的活动，他的免费Firebase计划已“升级”，＆＃34;并且此“发起了帐单”该项目。</p><p>  他发现了GCP成本控制的多个问题。结算大约需要一天的时间，这就是为什么我们第二天才注意到收费的原因， Chauhan说。接下来，＆＃34; Firebase仪表板花了超过24小时才能更新，＆＃34;他说。他说，这意味着仪表板显示的使用量在每日限制之内，当时是8600万个百分点。比显示的更多。</p><p>    GCP Cloud Run默认设置也发挥了作用。 ＆＃34; max-instances预设为1,000，并发设置为80，＆＃34;他说。如果他已将此值校正为2和1之类的较小值，则不会发生帐单冲击。</p><p>  由于这些设置，＆＃34;在Cloud Run上运行此版本的Hello World部署使Firestore读取了1,160亿次，写入了3,300万次，＆＃34;周汉说。</p><p>  大部分成本都降到了Firebase读取操作上，甚至是每100,000只$ 0.06。将其乘以1,160亿，您将获得69,600美元。另外还有16,000小时的Cloud Run Compute时间，这部分是因为应用程序没有删除服务，而是将它们留在了后台进程中。 </p><p>越野车代码的性能令人印象深刻。 ＆＃34;在高峰期，Firebase能够处理每分钟约10亿次读取，＆＃34; 他说，同时运行的Cloud Run可以每分钟处理900万个请求。  ＆＃34;快速失败，通过云快速学习是一个坏主意，＆＃34; 乔汉总结说。 如果您算出GCP文档中的页数，则可能比[一本]小说中的页数还多。 了解定价，使用情况不仅耗时，而且需要深入了解云服务的工作方式。＆＃34;  有一个幸福的结局。 ＆＃34;仔细阅读了有关此事件的冗长文档后，我们分享了自己的观点，进行了各种咨询，对话和内部讨论，Google一次性放弃了我们的账单，＆＃34; 周汉说。  不能依靠这种宽大处理。 自动扩展和按需计算存在弊端，弄清楚将要花费的成本是具有挑战性的。 建议注意。 ® </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.theregister.com/2020/12/10/google_cloud_over_run/">https://www.theregister.com/2020/12/10/google_cloud_over_run/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/google/">#google</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1039270.html"><img src="http://img2.diglog.com/img/2020/12/thumb_fdd392866b01054a6fa2390dcf0982de.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1039270.html">美国代理商称Google解雇员工参加工会活动 </a></div><span class="my_story_list_date">2020-12-12 18:40</span></div><div class="col-sm"><div><a target="_blank" href="/story/1039216.html"><img src="http://img2.diglog.com/img/2020/12/thumb_0956b50916c944487dccef3d3c111e83.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1039216.html">Google会限制您看到的酒精饮料和赌博广告 </a></div><span class="my_story_list_date">2020-12-12 9:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1039185.html"><img src="http://img2.diglog.com/img/2020/12/thumb_d44eb3742eb8c88eebfcf39399c04ce0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1039185.html">Google Cloud宣布Cloud Run的最少实例（“最少”） </a></div><span class="my_story_list_date">2020-12-12 5:51</span></div><div class="col-sm"><div><a target="_blank" href="/story/1039178.html"><img src="http://img2.diglog.com/img/2020/12/thumb_c9445aa9e67667900ba506bf905041eb.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1039178.html">归档：加利福尼亚州正在寻求加入司法部针对Google的反托拉斯诉讼，这使其成为第一个要求加入11个GOP AG的民主党州 </a></div><span class="my_story_list_date">2020-12-12 5:30</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>