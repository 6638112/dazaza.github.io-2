<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为我的用例修复D3-zoom API</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">为我的用例修复D3-zoom API</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-24 07:31:56</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/ad219b609a2ada40b9923a7e5d4373f9.png"><img src="http://img2.diglog.com/img/2020/10/ad219b609a2ada40b9923a7e5d4373f9.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>D3-ZOOM是令人难以置信的健壮、强大和灵活的。但是，它的灵活性意味着要正确配置和使用它可能相当复杂。这篇文章介绍了一种包装它的方法，降低了它的灵活性，但极大地简化了它在我的用例中的使用。</p><p>为了塑造讨论，我们将创建下面的图表，允许您使用鼠标或触摸交互平移和缩放绘图区域-。</p><p>第一节介绍了一个如何使用d3-zoom的示例。如果你已经吮吸过那个特定的鸡蛋，我建议跳到下一节。</p><p>Const prng=d3。随机正态()；常量数据=d3。范围(1 E3)。Map(d=&gt；({x：prng()，y：prng()}))；const x=d3.。Scale线性()。Domain([-5，5])；const y=d3。Scale线性()。域([-5，5])；常量x2=x。Copy()；const y2=y。Copy()；</p><p>这第一段代码只是在原点和关联的x/y标尺周围创建一些随机的x/y数据点，以呈现具有硬编码域的值。</p><p>这段代码中值得注意的部分是最后两行，它们创建刻度的副本。这些将在稍后的…中非常重要。</p><p>其余的代码片段使用D3FC组件。但是，基本概念应该熟悉香草D3，并且很容易应用到香草D3。</p><p>常量级数=fc。SeriesCanvasPoint()。CrossValue(d=&gt；d..。X)。MainValue(d=&gt；d..。Y)。大小(4)；常量缩放=d3。ZOOM()。在(&#39；缩放&#39；，事件=&gt；{x.。域(事件。变形。RescaleX(X2)。Domain())；y。域(事件。变形。重新缩放Y(Y2)。Domain())；Render()；})；</p><p>同样，这段代码开始时非常乏味，只是创建了一个配置为呈现数据点的点系列。</p><p>此代码的第二部分是大多数操作发生的地方。我们创建一个d3-zoom组件/行为，并侦听当用户与选择交互时触发的缩放事件(我们将在下面介绍这如何与选择相关联)。</p><p>在事件处理程序中，我们收到一个zoomTransform，它表示自缩放行为应用于选择(或显式重置)以来所有交互的组合效果。</p><p>这意味着我们需要在先前创建的x/y比例副本(x2/y2)上使用变换中的重缩放工具，而不是使用先前重新缩放的副本(x/y)。实际上，复制的比例表示应应用变换的基线。先前重新缩放的是已应用变换的工作比例。</p><p>常量图表=fc。图表笛卡尔(x，y)。Chart Label(画布缩放1000点)。CanvasPlotArea(系列)。装饰(sel=&gt；{sel.。输入()。选择(&#39；.Plot-Area&#39；)。在(&#39；测量范围&#39；，事件=&gt；{x2.。范围([0，事件。细节。宽度])；y2。范围([事件。细节。高度，0])；})。Call(Zoom)；})；</p><p>此代码块创建一个笛卡尔图表，然后使用x/y刻度和系列对其进行配置。装饰函数实际上是唯一有趣的部分，当创建绘图区时-。</p><p>侦听测量事件以确保x/y刻度副本上的范围值保持最新。它们由rescaleX/Y变换工具在内部使用。</p><p>最后，我们有呈现函数本身，它将数据与目标容器相关联并调用图表组件。</p><p>这样，我们就获得了上面示例所需的所有代码。向图表添加缩放行为真的不是很好的代码。D3-zoom组件为我们处理了大量的低级交互处理。</p><p>然而，组件的灵活性确实意味着API不像上面的用例那样符合人体工程学。理想情况下，我们不需要关注细节，比如维护第二组比例、将变换应用到这些比例或保持这些比例上的范围。</p><p>将上面的痛点作为更好的API的灵感来源，此用例的理想组件将另外-。</p><p>既然这个假设组件提供了一种将比例与选择相关联的简明方式，那么最好解决另一个使用d3-zoom很难实现的常见要求-。</p><p>这在多个面板共享单个x比例、小倍数图表共享两个比例或更微妙的可用性考虑因素(例如允许用户平移或缩放轴以仅改变其关联比例)的图表中会很有用。</p><p>在这个阶段，我确信我们实现了这样一个新组件并不令人惊讶。下面的图表与前面的示例几乎完全相同，使用D3FC-ZOOM创建。</p><p>要允许在轴上平移和缩放，对上面的“假设”代码唯一需要的更改是调用轴选择上的组件。它改变了装饰功能，如下所示-。</p><p>图表。装饰(sel=&gt；{sel.。输入()。选择All(&#39；.lot-Area&#39；)。调用(zoom，x，y)；sel.。输入()。选择全部(&#39；.x轴&#39；)。Call(zoom，x，null)；sel。输入()。选择全部(&#39；.y轴&#39；)。Call(zoom，null，y)；})；</p><p>尽管使用了selectAll，但每个轴只有一个容器。它在功能上等同于SELECT，但避免了对用于创建轴容器的数据联接的干扰。</p><p>在内部，该组件使用d3-zoom组件，注册其交互处理程序并响应缩放事件。它不使用转换来跟踪用户交互的状态，而是直接将该状态存储在比例域中。</p><p>这具有允许多个实例在比例域值上同步的优点。它还允许通过其他代码(例如，单击按钮、流式传输数据等)直接更新比例域，而不必担心转换。</p><p>这种方法的明显缺点是，尝试处理不连续的比例会有困难。通过直接使用比例域值作为我们的状态，我们丢失了变换的基于中间像素的表示。</p><p>公平警告：这会影响到实现的杂草。如果您只是尝试使用该组件，则不需要了解这些细节，我建议跳到下一节。</p><p>为了简化本节中的解释，我使用SCALE作为x和/或y SCALE的简写。此外，虽然组件支持多节点选择，但我假设选择只包含一个节点。</p><p>首先，让我们考虑一下d3-zoom是如何工作的。假设存在与选择相关联的现有转换(T0)。用户的交互使组件产生到该转换的增量(DT)。</p><p>这两个值组合在一起以产生传递到事件处理程序的转换(t1=t0+dt)。此转换还根据选择存储为DOM节点上的属性。</p><p>如果我们已经将先前的变换应用于比例，那么现有变换和增量的这种组合就会导致问题。在这种情况下，我们有效地双重应用了前面的转换，导致了对用户交互的一些令人兴奋/令人困惑的指数响应。</p><p>就其核心而言，D3FC-ZOOM执行的解决方法与我们上面演示的相同。当与选择相关联时，还会向该组件传递工作刻度。这与应用转换时用作基线的副本一起存储在DOM节点上。</p><p>基线比例的范围将使用工作比例的当前范围进行更新。</p><p>使用重缩放工具将基线比例与变换组合在一起，以生成结果比例。</p><p>D3FC-ZOOM的新部分允许外部修改工作秤的范围。这可以通过显式设置域或通过与相同比例相关联的不同选择上的缩放事件来实现。</p><p>为了处理这种情况，该组件另外存储-*另一个刻度的副本，表示刻度的先前或最后观察到的状态(在执行重新定标操作之后)。*表示转换的上一次或最后一次观察到的状态的转换副本。</p><p>如果它检测到工作秤的域与其先前状态不同，则它知道该域已被外部修改。在这种情况下，简单地将传递到事件处理程序的转换应用于基线刻度会产生不正确的结果，因为t0不表示前一个刻度和基线刻度之间的差异。</p><p>相反，该组件计算变换增量(dt=t1-t0)，将基线重置为工作比例的新副本，将增量(Dt)应用于此基线，然后使用结果域更新工作比例。</p><p>与编写代码相比，用语言来描述要困难得多，因此快速浏览一下实现可能会更好地理解。</p><p>我毫不怀疑，我们为D3FC-ZOOM创建的新API将不能灵活地处理其他人的用例，或者更糟糕的是，无法满足其他人的用例。但是，对于我熟悉实现的常见用例，我发现它非常强大且易于使用。</p><p>事实上，我会争辩说，通常情况下，通过给问题添加约束，你就会让自己获得更简单的解决方案。最终使您能够专注于您认为重要的细节的解决方案。</p><p>我叫克里斯·普莱斯，我住在泰恩河畔的纽卡斯尔，是斯科特逻辑公司的一名软件工程师。我每天都在为金融服务公司开发桌面/平板电脑/移动网络应用程序(不幸的是，这些应用程序大多隐藏在付费墙后面)。如果可以的话，我确实喜欢写博客，在GitHub上做一些有趣的事情。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.scottlogic.com/2020/10/22/fixing-the-d3-zoom-api.html">https://blog.scottlogic.com/2020/10/22/fixing-the-d3-zoom-api.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/修复/">#修复</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/d3/">#d3</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1029680.html"><img src="http://img2.diglog.com/img/2020/10/thumb_1f6667797a623badb3ad429c3e34e0c2.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029680.html">苹果的“一次性和不可修复”AirPods</a></div><span class="my_story_list_date">2020-10-19 7:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028970.html"><img src="http://img2.diglog.com/img/2020/10/thumb_ca041555eb481a719c19b6875f02f720.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028970.html">ReactOS</a></div><span class="my_story_list_date">2020-10-15 22:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1026266.html"><img src="http://img2.diglog.com/img/2020/9/thumb_07fdffc7e36ca792ee06a98faaa0fa97.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1026266.html">苹果在iOS14之后的第一个iOS更新刚刚问世，它修复了重置应用程序的默认设置</a></div><span class="my_story_list_date">2020-9-25 3:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021426.html"><img src="http://img.diglog.com/img/2020/8/thumb_a498557a343dfd09fe4bac13a5a04699.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021426.html">NIM-版本1.2.6和1.0.8已发布</a></div><span class="my_story_list_date">2020-8-31 21:35</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>