<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NIM中的光线跟踪</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">NIM中的光线跟踪</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-02 06:29:11</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/a498557a343dfd09fe4bac13a5a04699.png"><img src="http://img.diglog.com/img/2020/7/a498557a343dfd09fe4bac13a5a04699.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>辐射跟踪是一周光线跟踪在NIM编程语言中的实现。</p><p>特别值得一提的是，我确信(显然有偏见)，如果您想从头开始一个渲染项目(光线跟踪或其他)，NIM是最适合使用的语言，特别是如果您专注于：</p><p>渲染是一项非常耗时的任务，NIM很快，非常快，有时甚至比C++还快。</p><p>在英特尔Skylake-X i9-9980XE上，超频为4.1SSE2全核涡轮。以x86-64模式编译(仅限 )；384x216图像；每像素100射线：</p><p>单线程NIM比Cang C++快2.7%. %。多线程NIM通过编织比Cang C++快11.1 %。</p><p>以下是重现结果的步骤。请注意，如果您在不同的硬件上运行测试，结果可能与上面发布的结果略有不同。</p><p>git clone https://github.com/mratsim/weave CD weaven imble install-y#安装编织依赖项，此处为合成，如果要求则覆盖。nim-v#确保您的NIM 1.2.0或更高版本的#Threads on(默认情况下在此资源库中)nim c-d：danger-o：build/ray_threaded demos/raytracing/simpt.nim#threadoffnim c-d：danger-threads：off-o：build/ray_Single demos/ray tracing/mall pt.nimg++-O3-o build/ray_GCC_Single demos/ray tracacing/RayTracing/Smallpt.nimg++-O3-o build/ray_ray_Single Demos/RayTrac.。-o build/ray_clang_Single demos/ray Tracing/mall pt.cppclang++-O3-fopenmp-o build/ray_clang_omp demos/ray Tracing/mall pt.cpp。</p><p>NIM是少数几种可以正确建模物理单位并在编译时强制正确使用这些单位的语言之一。例如，向量和单位向量具有相同的表示形式，但类型不同。单位向量在传递给函数时可以自动转换为向量：</p><p>type Vector 3*=object x*，y*，z*：float64 UnitVector*{.borrow：`.`.}=DISTINCT Vec3#`.`注释确保可以将字段访问转换为Vec3*(UV：UnitVector)：Vec3{.inlin.}=##UnitVector可无缝转换为Vec3(但不能反之亦然)Vec3(UV)。</p><p>Point3使用与Vec3相同的内部表示，并且可以借用(共享)公共运算符的实现(即没有代码大小影响)：</p><p>type Point3*{.borrow：`.`.}=DISTINCT Vector 3#`.`注释确保可以访问字段func`*=`*(a：var Point3，标量：float64){.born.}func`*`*(a：Point3，标量：float64)：Point3{.boror.}func`*`*(scalar：float64，a：Point3)：Point3{.borrow.}。</p><p>不允许添加2个点，并带有一条漂亮的自定义错误消息，而不是编译器的默认错误。</p><p>函数`-`*(a，b：Point3)：Point3{.inlin.}=##将一个点从另一个点减去，得到一个向量结果。x=a.x-b.x result t.y=a.y-b.y result t.z=a.z-b.zfunc`+`*(p：Point3，v：Vector 3)：Point3{.inlin.}=##将向量加到一个点得到Point3(Vector 3(P)+v)funint3。v：Vector 3)：Point3{.inlin.}=##从一个点减去一个向量得到一个点Point3(ve3(P)-v)函数`+`*(a，b：Point3)：Point3{.error：&#34；添加2个点3没有实际意义。}。</p><p>我还有两种类型的颜色及其衰减(按百分比表示)，因此您不能将颜色相乘：</p><p>TYPE COLOR*{.BORROW：`.`.}=DISTINCT Vec3func`*`*(a，b：color)：COLOR{.error：&#34；将2种颜色相乘没有物理意义&#34；.}类型衰减*{.借入：`.`.}=不同颜色函数`*=`*(a：VAR衰减，b：衰减){.inline}=#将颜色乘以每个通道的衰减因子A.X*=b.x A.Y*=b.y A.Z*=b.zfunc`*`*(a，b：衰减)：衰减{.inlin.}=#将颜色乘以每个通道的衰减因子result。x=a.x*b.x result t.y=a.y*b.y result t.z=a.z*b.zfunc`*=`*(a：可变颜色，b：衰减){.inline}=#将颜色乘以每个通道的衰减因子a.x*=b.x A.Y*=b.y A.Z*=B.Z。</p><p>最后但并非最不重要的一点是，通过自动将弧度转换为浮动(并且度数将保持在较高水平)，确保您不会混合和匹配度数和弧度：</p><p>类型度*=DISTINCT FLOAT64弧度*=DISTINCT FLOAT64模板deToRad*(deg：度)：RADIANS=弧度(decToRad(float64(Deg)模板radToDeg*(rad：弧度)：Degrees=Degrees(radToDeg(float64(Rad)#目前我们不会使用正确的cos/sin/tan弧度强制#和自动转换为浮点转换器创建完整的安全单元库#。</p><p>在使用值类型(堆栈对象、seq和字符串)时，NIM在传递参数或将参数赋值给变量时需要显式变量，因为参数是可变的。</p><p>此外，C和C++开发人员可能会感兴趣地了解，当传递大型对象时(32位平台上超过12字节，64位平台上超过24字节)，NIM做正确的事情™，并且将默认通过引用传递(您可以在每个类型的基础上覆盖它，以始终通过复制传递或始终通过引用传递)。这意味着函数签名是出于易变性考虑，并且不受性能的影响(并且性能很好，正如基准测试所证明的那样)。</p><p>函数强制没有副作用，否则代码将无法编译。一些副作用示例：</p><p>如果你有一个Heisenbug，它很可能不在无副作用的函数中(除非你损坏了内存)。</p><p>这特别适合于物理学和光线追踪计算内核，因为物理方程是无副作用的。</p><p>尽管NIM具有所有功能，但它在C和C++目标下的编译速度都非常快，尤其是模板元编程的编译时间成本非常低。</p><p>这受到快速VM的支持，该VM在编译时为NIM提供Python的速度，并用于：</p><p>NIM可以编译成C和C++，并且可以无缝地调用用这两种语言编写的库，它甚至可以使用CUDA，只需稍加配置就可以调用NVCC。</p><p>虽然NIM提供了许多高级功能，但它不会强迫您先游泳或溺水。实际上，许多人报告说，NIM感觉像是一种经过编译的脚本语言。</p><p>并不是所有的事情都是小马和彩虹。NIM的主要问题是，它是一种非常年轻的语言，只有一个受支持的库的小生态系统。也就是说，您可以重用C和C++生态系统(也可以重用Javascript，因为Nim也可以编译到它)。例如，Trace of Radiance支持通过MP4从v0.2.0开始的视频输出，只需要60行的头C库包装。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://nim-lang.org/blog/2020/06/30/ray-tracing-in-nim.html">https://nim-lang.org/blog/2020/06/30/ray-tracing-in-nim.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/光线/">#光线</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/tracing/">#tracing</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/nim/">#nim</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>