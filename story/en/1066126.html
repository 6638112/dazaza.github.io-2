<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我的EC2愿望清单 My EC2 Wishlist</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">My EC2 Wishlist<br/>我的EC2愿望清单 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-16 13:07:34</div><div class="page_narrow text-break page_content"><p>I&#39;ve been using Amazon EC2 since 2006, and I&#39;ve been maintaining theFreeBSD/EC2 platform for over a decade. Overthose years I&#39;ve asked Amazon for many features; some of them, like HVMsupport (EC2 originally only support Xen/PV) and bidirectional serialconsole support (EC2 originally had an &#34;output-only&#34; serial console)eventually arrived, but I&#39;m still waiting for others — some ofwhich should be very easy for AWS to provide and would yield very largebenefits. While I&#39;ve made engineers inside Amazon aware of all of these at varioustimes, I think it&#39;s time to post my wishlist here — both so thata wider audience inside Amazon can hear more about these, and so thatthe FreeBSD community (especially the people who are financially supporting mywork) can see what I&#39;m aiming towards. FreeBSD release announcements currently include a long list of AMI IDs— two for each EC2 region — and I would publish more AMIsif it weren&#39;t for the impracticality of putting all the AMI IDs intothe announcements. One might say &#34;there&#39;s got to be a better solution&#34;— and indeed there is: AWS Systems Manager Public Parameters.Amazon publishesAMI IDs for Amazon Linux and Windows via the AWS Systems ManagerParameter Store, and Ubuntu AMI IDs are also published via the samemechanism (I assume by Canonical). I wrote code overa year ago to allow FreeBSD to publish AMI IDs the same way, butwe can&#39;t use it until Amazon authorizes the FreeBSD release engineeringaccount to publish these parameters — and we&#39;re still waiting. In addition to allowing us to publish multiple AMIs (e.g. ZFS andcloud-init), if we had this then we could publish updated AMIs afterevery security update — using the Parameter Store to allow usersto look up the latest updated version — which would dramaticallyspeed up the process of launching new FreeBSD/EC2 instances. Wishlist item #1: Please give the FreeBSD release engineering accountaccess to store AWS Systems Manager Public Parameters.  A few months ago, Amazon started supporting UEFIbooting on newer x86 instances. (ARM instances already used UEFI.) This isgreat news for FreeBSD, since we can boot much faster on UEFI than via the&#34;legacy&#34; BIOS boot mode — I/O is much faster since UEFI doesn&#39;t need tobounce disk reads through a small buffer in the bottom 1 MB of address space,and console output is much faster since we can use the UEFI console rather thana shockingly slow emulated VGA text mode. In fact, the total loader + kerneltime (starting when the boot loader starts running, and stopping when the initprocess is spawned) drops from 10.9 seconds down to 3.9 seconds! There&#39;s just one problem with this: AMIs are marked as either &#34;legacy-bios&#34; or&#34;uefi&#34;, and while legacy-bios AMIs can boot on all of the x86 instance types,the UEFI-flagged AMIs can only boot on the instance types which support UEFI.FreeBSD&#39;s AMIs are built from disk images which support both boot methods— but when we make the EC2 RegisterImage API call, we have to specifyone or the other. While we would love to make FreeBSD AMIs boot faster, wedon&#39;t want to drop support for customers who are using older instance types. Wishlist item #2: Please add a new &#34;BootMode=polyglot&#34; option, which marksAMIs as supporting both legacy-bios  and uefi boot modes, with UEFIbeing used on instances where it is available and legacy-bios being usedotherwise.  IAM Roles for EC2 are a very powerful — but very dangerous— feature, making credentials available to any process on the instancewhich can open a TCP connection to  169.254.169.254:80. Last year, Ireleased  imds-filterd,which allows access to the EC2 Instance Metadata Service (and thereby IAM Roles)to be locked down; as a result, you can now attach an IAM Role to an EC2instance without the risk that a user-nobody privilege escalation allows anattacker to access the credentials. There&#39;s only one problem: You can only attach a single IAM Role. This meansthat — even with imds-filterd restricting what each process can accessin the metadata service — there&#39;s no way to give different credentials todifferent processes. This becomes a problem if you want to use the AWSSystems Manager Agent, since it requires credentials exposed as an IAM Role;there&#39;s no way to use the SSM Agent  and another process which alsouses IAM Role credentials without them both having access to each other&#39;sprivileges. This even became a problem for Amazon a few years ago when theywanted to provide &#34;extra&#34; credentials to EC2 instances which could be used to manageSSH host keys: Because these credentials couldn&#39;t be attached as an IAMRole, they were exposed via the Instance Metadata Service as meta-data/identity-credentials/ec2/security-credentials/ec2-instancewhich Amazon&#39;s documentation helpfully marks as &#34;[Internal use only]&#34;. As it turns out, the EC2 API already supports attaching an array of IAM Rolesto an instance, and the Instance Metadata Service already supports publishingcredentials with different names — but the EC2 API throws an error ifthe array of IAM Roles has more than one name listed in it. Get rid of thatrestriction, and it will become much easier to properly effect privilegeseparation... and also easier for Amazon to provide credentials to code ithas running on customer instances. Wishlist item #3: Allow multiple IAM Roles to be attached to a single EC2instance. If you work at Amazon and can make one or all of these wishes come true,please get in touch ( cperciva@FreeBSD.org). I really don&#39;t thinkany of these should be very difficult to provide on Amazon&#39;s side, and theywould provide a huge benefit to FreeBSD. Alternatively, if you work atAmazon and you&#39;re screaming at your laptop &#34;it&#39;s not that simple Colin!&#34;,please get in touch anyway (yes, I&#39;ve signed the necessary NDAs). And if you don&#39;t work at Amazon but you work at a large AWS customer: Pleasedraw this list to the attention of your Amazonian contacts. Eventually we&#39;llfind someone who can make these happen!</p><p>Warning: Can only detect less than 5000 characters</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://www.daemonology.net/blog/2021-06-16-My-EC2-wishlist.html">http://www.daemonology.net/blog/2021-06-16-My-EC2-wishlist.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ec2/">#ec2</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/warning/">#warning</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>