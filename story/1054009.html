<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为什么我更喜欢Makefiles通过package.json脚本 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">为什么我更喜欢Makefiles通过package.json脚本 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-23 00:54:17</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/ef7beb4611413231bb4fcc6522b679fc.png"><img src="http://img2.diglog.com/img/2021/3/ef7beb4611413231bb4fcc6522b679fc.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在任何中等大小的Node.js项目上，您可能已经超过了package.json“脚本”部分。但由于增长逐渐，没有单一急性痛点，你可能没有注意到。有更好的方法。</p><p>  在大多数Node.js项目中，您将在package.json文件中找到一个脚本部分，其中包含“build”和“test”等方便的快捷方式：</p><p>   此外，具有某些名称的脚本背后存在特殊意义，如“安装”或“预付”（NPM，YARN）。</p><p> 在一个新的项目上，它通常足够无辜，具有一小部分简单，自我解释的命令。但是之后…</p><p>  我看到的一个图案通常在NPM脚本中提出的是单个脚本上的多种变体：</p><p> ＆＃34; go＆＃34 ;:＆＃34;节点go.js --do-some-stuff＆＃34 ;,＆＃34; go; go; debug＆＃34 ;:＆＃34;回声调试..; Debug = 1纱线Go＆＃34 ;,＆＃34; Go：有＃34 ;:＆＃34;纱线Go --to = \＆＃34;在那里\＆＃34;＆＃34;</p><p>  go_do_stuff = node go.js --do-some-suppygo：$ {go_do_stuff} go-debug：echo调试.. debug = 1 $ {go_do_stuff} go-with-with-with-with for thate for this参数中的空格：$ {go_do_stuff }  - 在那里=＆＃34; </p><p>另一个出现的模式 - 这是一个更险恶的一个 - 是依赖的链：</p><p> ＆＃34;分享 -  prereq＆＃34 ;:＆＃34; echo共享prereq！＆＃34 ;,＆＃34;另一个prereq＆＃34 ;:＆＃34;回声另一个prereq！＆＃34 ;,＆＃ 34;任务-One＆＃34 ;:＆＃34;纱线共享-Prereq＆amp;＆amp;回声做任务一个..＆＃34 ;,＆＃34;任务-2＆＃34 ;:＆＃34;纱线共享 -  Prereq＆amp;＆amp;纱线另一个prereq;回声做任务二..＆＃34;</p><p>  Shared-Prereq：@echo共享prereq！另一个prereq：@echo另一个prereq！任务一：共享-prereq @echo做任务一。 - 二：共享 -  Prereq另一个prereq @echo做任务二..</p><p>   在上面的例子中，我们有一系列始终运行的步骤，只询问我们要求我们询问的NPM脚本。但是可以做得更好。</p><p> 如果您的命令正在读写可预测的文件集，则可以跟踪它们并避免冗余工作。</p><p>  以下是使用make来描述代码生成器的操作的示例：</p><p> json_schemas = $（shell查找schemas -type f-name＆＃39; *。schoma.json＆＃39;）json_schema_dst = $（json_schemas：％。schema.json =％。schema.gen.ts）json2ts = yarn运行json2tsschemas /%.schema.gen.ts：schemas /％。schema.json $（json2ts）-i $＆lt; -o $ @ codegen_dst = $ {json_schema_dst} codegen：$ {codegen_dst} build：$ {codegen_dst} @echo＆＃34;我依赖于那些生成的文件！＆＃34; clean：find schemas -type f-name＆＃ 34; *。Gen。*＆＃34; -删除 </p><p>第一次运行Build Build时，它将找到所有.schema.json文件，为每个文件生成.gen.ts，然后继续构建应用程序。</p><p> 第二次运行Build Build，Make将看到生成的文件是最新的，跳过生成器，并构建您的应用程序。</p><p> 如果您编辑其中一个架构文件，请注意将注意到该文件更改，运行生成器，然后构建您的应用程序。</p><p>   在一个大型项目上，您可以在不同的目录中撒上多个makefiles，其中它们＆＃39; ll提供与该区域相关的可发现的快捷方式。</p><p> 它＆＃39;如果您的shell具有智能选项卡完成，则更可被发现：例如，在我当前的项目中，如果输入AWS /目录，并且键入make＆lt; tab＆gt;，您＆＃39; ll查看包含像这样的列表docker-login，deploy-dev和destroy-sandbox。</p><p>   BASH-3.2 $ TIME YARN任务 -  TWOYARN RUN V1.22.5 $ YARN SHARED-PREREQ＆amp;＆amp;纱线另一个prereq;回声做任务二.. $ echo共享prereq！共享prereq！$ echo另一个prereq！另一个prereq！做任务二进一程......在0.63s.real 0m0.814suser 0m0.508ssys 0m0.138sbash-3.2 $ time make  - TwoShared Prereq！另一个prereq！做任务二.. eal 0m0.021suser 0m0.008ssys 0m0.010s</p><p> 允许替代工具架空赢得＆＃39;如果您的命令采用任何有意义的时间，但是如果您碰巧有任何脚本即时执行任何脚本，则会感受到差异。 </p><p>JSON是为了序列化对象。 它＆＃39; s一个糟糕的配置格式，它＆＃39;甚至在表达复杂的构建时更糟糕。  当你堆积更多的复杂性进入你的NPM脚本时，它永远不会像你一样＆＃39;把稻草放在骆驼＆＃39;回来的那个。 但请退后一步，看看你的可怜的骆驼，并考虑使用另一个工具。  我甚至在＆＃39;它的制作时甚至不在乎。 用别的东西。 也许您的语言生态系统有一个甜蜜的构建工具，可以完成以上所有内容。 我喜欢被证明是错误的，但据我所知，在node.js（特别是用lecescript），有没有人和＃39; t。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://spin.atomicobject.com/2021/03/22/makefiles-vs-package-json-scripts/">https://spin.atomicobject.com/2021/03/22/makefiles-vs-package-json-scripts/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/makefiles/">#makefiles</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/build/">#build</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>