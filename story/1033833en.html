<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>你是马勒吗？这听起来像是马勒</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">你是马勒吗？这听起来像是马勒</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-08 18:52:18</div><div class="page_narrow text-break page_content"><p>One of the most delightful parts of being a software engineer and hardwaretinkerer is having the ability to solve my own specific (and often niche)problems. In this post, the particular problem I’ll be solving is the burningneed to know what is currently playing on  WQXR, NYC’s classical radio station.</p><p>作为一名软件工程师和硬件修补工，最令人愉快的部分之一就是有能力解决我自己的特定(通常是小众的)问题。在这篇文章中，我要解决的特别问题是，我需要知道纽约经典广播电台WQXR目前正在播放什么。</p><p> A typical Saturday for me looks like this: I wake up and make a coffee, bringit to the couch in the living room, pick up my knitting, and turn on the radio. Maybe midway through the morninga halfway-familiar piece comes on, but I’ve left my phone in the other room and won’t beable to go check the WQXR website without disentangling myself from myknitting and missing a bit of the piece that has captured my attention.</p><p>对我来说，一个典型的星期六是这样的：我醒来，煮了一杯咖啡，端到客厅的沙发上，拿起我的针织品，打开收音机。也许到了早上一半，一件熟悉的作品出现了，但我把手机落在了另一个房间，如果不把自己从编织中解脱出来，错过一小部分吸引我注意力的作品，我就无法去查看WQXR的网站。</p><p> Or how about a weekday: I’m working on a project, elbows deep in the code, with the WQXR livestream open in one of my millionbrowser tabs. I feel a glimmer of recognition, but I’m fully focused on mywork and don’t want to break my concentration to go hunt down the livestreamplayer and find out what it is.</p><p>或者工作日怎么样：我正在做一个项目，深陷代码之中，WQXR实况流在我的一个百万浏览器选项卡中打开。我感觉到了一丝认可，但我完全专注于我的工作，不想打破我的注意力去追查直播播放器，找出它是什么。</p><p> To solve this particular problem, I needed two things: a way to find out whatwas on the radio, and a place to display it.</p><p>要解决这个特殊的问题，我需要两样东西：一种找出收音机里有什么的方法，以及一个展示它的地方。</p><p> There are a couple of different ways you could find out what’s playing,including music identification services like Shazam. But those rely on alreadyhaving a recording in their database to match against, and I’m listening toclassical music where I could be hearing any one of dozens of differentrecordings (and even live performances) for any given piece, making itunlikely that such a service would be able to find a match. So I started withthe source I was already using to get this information: the WQXR website.</p><p>你可以通过几种不同的方式知道正在播放什么，包括像Shazam这样的音乐识别服务。但这些音乐依赖于他们的数据库中已经有了匹配的录音，我正在听古典音乐，在那里我可以听到任何给定作品的数十种不同录音(甚至是现场表演)中的任何一种，这使得这样的服务不太可能找到匹配的音乐。所以我从我已经用来获取这些信息的来源开始：WQXR网站。</p><p> If you leave the website open long enough, you’ll notice that it automaticallyupdates to reflect what’s currently playing. This was great news for me,because it meant that somewhere in the page a script is periodically makingajax requests to get that information, requests that I could also make myself.To find out what these requests were, I eavesdropped on my browser’s networkcalls using the developer console.</p><p>如果你让网站打开足够长的时间，你会注意到它会自动更新以反映当前正在播放的内容。这对我来说是个好消息，因为这意味着在页面的某个地方，脚本会定期发出获取信息的请求，我也可以自己发出请求。为了找出这些请求是什么，我使用开发人员控制台窃听了浏览器的网络呼叫。</p><p>  There are two calls being made here, one to an endpoint called streams,and one to something very promisingly named  whats_on. Making a request tothat second endpoint, we get a beautiful json response containing informationabout what’s playing on New York Public Radio’s various livestreams. Great!This is exactly what I need to satisfy the first piece of this project.</p><p>这里有两个调用，一个是对一个名为Streams的端点的调用，另一个是对一个非常令人满意的名为Whats_on的调用。向第二个端点发出请求后，我们得到了一个漂亮的json响应，其中包含有关纽约公共广播电台(New York Public Radio)各种直播流正在播放的内容的信息。太好了！这正是我要满足这个项目第一部分的需要。</p><p> (I honestly can’t remember how I figured this out, but you can append the callletters for the particular station you’re interested in to the URI to just getinformation for that stream, but the full response would also have worked justfine.)</p><p>(老实说，我不记得我是如何想到这一点的，但您可以将感兴趣的特定电台的呼叫信附加到URI中，以便只获取该流的信息，但完整的响应也可以很好地工作。)</p><p> Okay, cool, so I have the data. How do I get this information in front of myeyeballs when I’m listening to the radio?</p><p>好的，酷，我有数据了。当我在听收音机的时候，我怎样才能在麦麦鲍尔斯面前得到这些信息呢？</p><p> You already know from the teaser photo at the top of the post thatI ultimately put it on my mantel, but I took an iterative approach to gettingthere.</p><p>你已经从帖子顶部的预告片中知道了，我最终把它放在了壁炉架上，但我采取了一种迭代的方法来实现这一点。</p><p> I use tmux to manage my terminal sessions, and it occurred to me that thestatus bar, always there along the bottom of my terminal, might be a niceplace to have information about what’s currently playing. I wrote somelightweight python classes for fetching and parsing the radio’s API response,and a tiny script,  tmux.py that outputs the information in the format I want for thispurpose.</p><p>我使用tmux来管理我的终端会话，我突然想到，状态栏总是在我的终端底部，它可能是一个了解当前正在播放的内容的好地方。我编写了一些轻量级的python类来获取和解析收音机的API响应，并编写了一个小脚本tmux.py，它以我想要的格式输出信息。</p><p> Adding something to the tmux status bar is just a matter of adding a couple oflines to  .tmux.conf:</p><p>向tmux状态栏添加一些内容只需向.tmux.conf添加几行代码：</p><p>  This overwrote the clock that was there by default, so I added one back in. Bydefault, scripts run in  .tmux.com are executed once every 15 seconds, whichwas more than fast enough for my purpose. My status bar then looks like this:</p><p>这会覆盖默认存在的时钟，所以我又添加了一个。默认情况下，在.tmux.com中运行的脚本每15秒执行一次，这对于我的目的来说已经足够快了。然后，我的状态栏如下所示：</p><p>  This fixed the problem of not wanting to leave my terminal to find out whatI’m listening to, but what about when I’m in the living room? I knew I wanteda display, that I wanted it to update automatically, like the tmux status bar,that I wanted it to be constantly running, like an indoor thermometer readout,and that I wanted it to be readable from any position in the room, with goodview angles and readability under a variety of lighting conditions. This allsounded to me like the  perfect excuse to work with e-paper.</p><p>这解决了我不想离开终端去看我在听什么的问题，但是当我在起居室的时候呢？我知道我想要一个显示屏，我想让它像tmux状态栏一样自动更新，我想让它像室内温度计读数一样不停地运行，我想它可以从房间的任何位置读取，具有良好的视角和在各种照明条件下的可读性。在我看来，这一切都像是使用电子报的完美借口。</p><p> Pimoroni was having a sale, so I picked up two e-ink displays: the smaller inkypHAT, and thelarger inkywHAT. I also got a couple of Raspberry Pi Zero Ws to pop them ontop of (quick aside: these things cost $10 and have wifi and bluetooth, wowww).</p><p>皮莫罗尼正在打折，所以我拿起了两个电子墨水显示屏：较小的墨水HAT和较长的墨水HAT。我还买了几台覆盆子Pi Zero W手机(顺便说一句：这些手机售价10美元，有WiFi和蓝牙功能，哇)。</p><p> Starting with the inkypHAT and the code I’d already written for handling radiodata, I prototyped my idea, creating a tiny display that sits on top of mymonitor. I set the Pi Zeroes up the way I set up my larger Raspberry Pi 3,with Raspbian Lite. Without worrying too much about styling the displayaesthetically, I learned how to work with the Inky and Pillow libraries andwrote a script to get the composer and title chopped up to fit across multiplelines on the screen:</p><p>从inkypHAT和我已经编写的处理无线电数据的代码开始，我制作了我的想法的原型，在我的显示器上创建了一个微型显示器。我设置Pi Zeroes的方式就像我用Raspbian Lite设置我的更大的覆盆子Pi 3一样。我没有过多地担心如何在美学上设计显示器的样式，我学会了如何使用Inky和Pillow库，并编写了一个脚本来切割作曲家和标题，以适应屏幕上的多行：</p><p>  I have it running once a minute on a cron, and to avoid refreshing the e-inkdisplay unnecessarily, I keep the last piece written to the display in memory andupdate only if I’ve gotten something new back from WQXR.</p><p>我让它在处理器上每分钟运行一次，为了避免不必要地刷新电子墨水显示屏，我将写入显示屏的最后一件东西保存在内存中，只有在我从WQXR得到新的东西时才会更新。</p><p> Reworking this script for the larger inkywHAT display wasn’t difficult; itmostly involved tweaking font size to take advantage of the larger screen. Butsince this is meant to live on my mantel and be highly visible in my livingroom, I wanted to make it look a bit nicer than just throwing the text onthere. I found a clip-art scrollwork frame, and using only the MacOS Previewapp and ImageMagick, got it into the right size and formatfor the e-ink display.</p><p>为更大的inkywHAT显示修改这个脚本并不困难；它主要涉及调整字体大小以利用更大的屏幕。但由于这是为了放在我的壁炉架上，而且在我的起居室里很容易看到，我想让它看起来比仅仅把文字扔在上面要好看一点。我找到了一个剪贴画卷轴框架，只用了MacOS Preview app和ImageMagick，就把它弄成了适合电子墨水显示的大小和格式。</p><p> In Preview, I grabbed a corner of the frame and pasted it in again three moretimes, rotated 90 degrees each time, and carefully bumped each corner arounduntil they were lined up and could be scaled down reasonably to the rightdimensions (400x300px). Even though the image appeared to be entirely blackand white, a closer look shows this wasn’t true at all! It’s actually full ofmany different shades of gray:</p><p>在Preview中，我抓住相框的一角，再次粘贴三次，每次旋转90度，仔细地在每个角周围颠簸，直到它们排成一排，可以合理地缩小到合适的尺寸(400x300px)。尽管这张照片看起来完全是黑白的，但仔细一看就会发现这根本不是真的！它实际上充满了许多不同深浅的灰色：</p><p>  To get the image into the right format and flatten it down to just two colors,I used the  ImageMagick command-linetools. While  thisextremely thorough page in the IM docs goes pretty far in-depth with thevarious ways you can convert an image to black and white, I ultimately endedup going with:</p><p>为了将图像转换为正确的格式并将其展平为两种颜色，我使用了ImageMagick命令行工具。虽然IM文档中这一极其详尽的页面深入介绍了将图像转换为黑白的各种方法，但我最终还是总结了以下几点：</p><p>    It’s a little rough when you see it on a relatively high resolution monitor, but looks great on the 400x300 e-inkdisplay! After that, adding the text was pretty straightforward;earlier when only displaying text, I was still actually using Pillow to create an emptyimage in the correct dimensions that I drew the text onto:</p><p>当你在相对较高分辨率的显示器上看到它时，它有点粗糙，但在400x300电子墨水显示屏上看起来很棒！在那之后，添加文本非常简单；以前只显示文本时，我实际上仍在使用Pillow创建一个尺寸正确的空图像，将文本绘制到该图像上：</p><p>    The last little bit of clean-up work involved getting the text centered in theframe, and setting the margins in my script so that the line breaks werea comfortable distance from its edges.</p><p>最后一点清理工作包括让文本在框架中居中，并在我的脚本中设置边距，使换行符与其边缘保持一段舒适的距离。</p><p>  I’m happy with where this project is at; the text is clear and legible fromanywhere in my living room, and my Saturday morning listening experience hasbeen greatly improved. Eventually, it’ll get custom wooden housing, which willbe its own post, I’m sure! Feel free to dig around in  the project’s repo onGitHub to get an even better idea of how this all works.</p><p>我对这个项目的进展很满意；在我客厅里的任何地方，文本都清晰可辨，我周六早上的听力体验也得到了极大的改善。最终，它会得到定制的木制外壳，我敢肯定，这将是它自己的职位！你可以在该项目的repo on Github中随意挖掘，以更好地了解这一切是如何工作的。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://sarabee.github.io/2020/09/13/is-this-mahler/">http://sarabee.github.io/2020/09/13/is-this-mahler/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/起来/">#起来</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/mahler/">#mahler</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>