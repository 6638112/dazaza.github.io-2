<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>万劫不复-适用于DOS 6和Windows 95至Windows 10的单个EXE</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">万劫不复-适用于DOS 6和Windows 95至Windows 10的单个EXE</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-14 23:44:28</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/33afbd1c2fd02e0ab550abf151ef6af9.jpeg"><img src="http://img2.diglog.com/img/2020/11/33afbd1c2fd02e0ab550abf151ef6af9.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>A single .exe binary which runs DOOM on DOS 6, Windows 95 and Windows 10 (and probably everything in between).</p><p>一个.exe二进制文件，可以在DOS 6、Windows 95和Windows 10(以及可能介于两者之间的所有操作系统)上运行Doom。</p><p>  DOS and Windows .exe files both start with a common header (the DOS &#34;MZ&#34; header), which might suggest that you can run programs for one OS on the other one. However, this is complicated by a few facts: DOS support was dropped in Windows a long time ago (DOS binaries don&#39;t load on Windows 10, for example), and DOS programs use a completely different execution environment.</p><p>DOS和Windows.exe文件都以共同的头文件(DOS&34；MZ&34；头文件)开头，这可能意味着您可以在一个操作系统上运行另一个操作系统的程序。然而，有几个事实使情况变得复杂：Windows很久以前就放弃了对DoS的支持(例如，Windows 10不加载DOS二进制文件)，而且DOS程序使用完全不同的执行环境。</p><p> This repo builds a single .exe file with a &#34;polyglot&#34; MZ header which allows it to load one program (the original DOOM) when running inside DOS, and a different program (a custom static build of Chocolate DOOM) when running on Windows.</p><p>此repo构建了一个带有多语种MZ头的.exe文件，该文件允许它在DOS中运行时加载一个程序(原始毁灭)，并在Windows上运行时加载另一个程序(巧克力毁灭的自定义静态版本)。</p><p>  The DOS binary,  DOOMD.EXE, is exactly the original DOOM for DOS, derived from the shareware version that was widely distributed. The only difference is that it has been packed with UPX to make it a bit smaller.</p><p>DOS二进制文件DOOMD.EXE正是DOS的原始厄运，它派生自广泛分发的共享软件版本。唯一不同的是，它被装上了UPX，让它变得更小了。</p><p>  The Windows binary,  DOOMW.EXE, is a custom build of Chocolate DOOM, a source port of DOOM which hews very closely to the original. Chocolate DOOM is based on libSDL 1.2; this custom build integrates it statically rather than linking to libSDL dynamically.</p><p>Windows二进制文件DOOMW.EXE是巧克力末日的定制版本，巧克力末日的源端口与原始版本非常接近。巧克力末日是基于libSDL1.2的；这个定制版本静态地集成了它，而不是动态地链接到libSDL。</p><p>  Download and unpack the source code for Chocolate DOOM 2.2.1,  SDL 1.2.15,  SDL_mixer 1.2.7, and  SDL_net 1.2.8.</p><p>下载并解压缩Chocket DoOM 2.2.1、SDL 1.2.15、SDL_Mixer 1.2.7和SDL_Net 1.2.8的源代码。</p><p>   sudo mv /usr/local/lib/libSDL_mixer.* /usr/local/cross-tools/i386-mingw32/lib/; sudo mv /usr/local/include/SDL/SDL_mixer.h /usr/local/cross-tools/i386-mingw32/include/SDL/ (I could probably also have just set prefix correctly)</p><p>Sudo mv/usr/local/lib/libSDL_Mixer.*/usr/Local/Cross-Tools/i386-mingw32/lib/；sudo mv/usr/local/Include/SDL/SDL_Mixer.h/usr/local/cross-tools/i386-mingw32/include/SDL/(我也可能只是正确设置了前缀)。</p><p> diff -ur a/SDL_net-1.2.8/SDLnet.c SDL_net-1.2.8/SDLnet.c--- a/SDL_net-1.2.8/SDLnet.c	2012-01-15 16:20:10.000000000 +0000+++ b/SDL_net-1.2.8/SDLnet.c	2020-11-13 18:49:24.602850922 +0000@@ -212,6 +212,7 @@ 		return 0; } +#if 0 if ((dwRetVal = GetAdaptersInfo(pAdapterInfo, &amp;ulOutBufLen)) == ERROR_BUFFER_OVERFLOW) { pAdapterInfo = (IP_ADAPTER_INFO *) SDL_realloc(pAdapterInfo, ulOutBufLen); if (pAdapterInfo == NULL) {@@ -219,6 +220,9 @@ } 		dwRetVal = GetAdaptersInfo(pAdapterInfo, &amp;ulOutBufLen); }+#else+ return 0;+#endif if (dwRetVal == NO_ERROR) { for (pAdapter = pAdapterInfo; pAdapter; pAdapter = pAdapter-&gt;Next) {</p><p>差异-ur a/SDL_NET-1.2.8/SDLnet.c SDL_NET-1.2.8/SDLnet.c-a/SDL_NET-1.2.8/SDLnet.c 2012-01-15 16：20：10.000000000+0000+b/SDL_NET-1.2.8/SDLnet.c 2020-11-13 18：49：24.602850922+0000@@-212，6+212，7@@Return 0；}+#IF 0 if(dwRetVal=Getetnet.c2020-11-13 18：49：24.602850922+0000@@-212，6+212，7@@Return 0；}+#IF 0 if。UlOutBufLen))==ERROR_BUFFER_OVERFLOW){pAdapterInfo=(IP_AdapterInfo*)SDL_realloc(pAdapterInfo，ulOutBufLen)；if(pAdapterInfo==NULL){@@-219，6+220，9@@}dwRetVal=GetAdaptersInfo(pAdapterInfo，&amp；ulOutBufLen)；}+#Else+Return 0；+#enen.。</p><p>  Voila, a statically built version of Chocolate DOOM which runs on everything from Windows 95 to Windows 10 (might need  msvcrt.dll on old versions of Windows 95).</p><p>瞧，这是一个静态构建的巧克力末日版本，可以在从Windows 95到Windows 10的所有操作系统上运行(在旧版本的Windows 95上可能需要msvcrt.dll)。</p><p>  smash.py merges the two binaries together. What it basically does is extend the size of the DOS header to make room for a PE header, appends the entire Windows binary to the DOS binary, then inserts the PE header into the slack space and rewrites the section offsets appropriately. On DOS, the  next_offset in the header is ignored: DOS/4GW uses the executable size in the second and third WORDs of the DOS header to find the next binary to load. On Windows, the entire DOS header is ignored except for the  next_offset, which points to the PE header and thus loads the Windows binary.</p><p>Smash.py将两个二进制文件合并在一起。它主要做的是扩展DOS标头的大小，为PE标头腾出空间，将整个Windows二进制文件追加到DOS二进制文件中，然后将PE标头插入空闲空间，并适当地重写部分偏移量。在DOS上，会忽略报头中的NEXT_OFFSET：DOS/4GW使用DOS报头的第二个和第三个字中的可执行文件大小来查找要加载的下一个二进制文件。在Windows上，除了NEXT_OFFSET之外，整个DOS标头都被忽略，它指向PE标头，从而加载Windows二进制文件。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/nneonneo/universal-doom">https://github.com/nneonneo/universal-doom</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/适用/">#适用</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/doom/">#doom</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dos/">#dos</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1034700.html"><img src="http://img2.diglog.com/img/2020/11/thumb_d353fde42d10c082b8b3a6b01c748198.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034700.html">Windows终端预览版1.5版</a></div><span class="my_story_list_date">2020-11-12 9:58</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033938.html"><img src="http://img2.diglog.com/img/2020/11/thumb_65fe1ac55cb547c52b4d5798dd332b64.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033938.html">Windows中不可原谅的不安全感</a></div><span class="my_story_list_date">2020-11-9 6:29</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033802.html"><img src="http://img2.diglog.com/img/2020/11/thumb_dc1fad55ea711afc952976f650d78b78.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033802.html">WinApps：在Linux上运行Windows应用程序，就像它们是原生操作系统的一部分一样</a></div><span class="my_story_list_date">2020-11-8 12:57</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033759.html"><img src="http://img2.diglog.com/img/2020/11/thumb_4a03f622ee66ea3150f73ee58b19c0cd.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033759.html">SpotifyKeyDumper-从Windows Spotify客户端转储歌曲解密密钥</a></div><span class="my_story_list_date">2020-11-8 9:35</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>