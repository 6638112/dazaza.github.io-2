<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为什么像Git中的API密钥这样的秘密是个问题</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">为什么像Git中的API密钥这样的秘密是个问题</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-08 23:28:58</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/48d6c00cc799f46ef5d37585d9074897.png"><img src="http://img2.diglog.com/img/2020/9/48d6c00cc799f46ef5d37585d9074897.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>像git这样的版本控制系统(Vcs)中的秘密是当前的世界状态，尽管人们普遍认为这是一种糟糕的做法。一旦源代码进入git存储库，它就可以有机地传播到多个位置。这包括其中可能包含的任何秘密。但是，为什么git存储库中的秘密如此普遍呢？</p><p>这是关于源代码中的秘密的系列文章中的第二篇，将专门研究为什么git存储库中的秘密是一个瘟疫，为什么它如此危险，以及如何防止它。</p><p>经验丰富的开发人员可能会百思不得其解，想知道为什么有人会把秘密放在git存储库中。但事实是，git存储库内部的秘密是当前的世界状况。</p><p>在上一篇文章中，我们讨论了在访问和分发机密时，选择阻力最小的路径是如何常见的。Git充当项目的中心真理点，因此，至少从方便的角度来看，将秘密存储在私有的Git存储库中以便于分发和访问是有意义的。</p><p>但是，像这样储存秘密是在玩火，只需一个非常小的事件就会被烧毁。</p><p>除了故意将秘密存储在git中之外，当秘密管理不当时，很容易丢失它们的踪迹。机密可以硬编码到源代码中、存储为文本文件、在Slake上共享或隐藏在调试应用程序日志中。此外，开发人员可以在大型分布式团队中访问过多的秘密，同时面临更短的发布周期和越来越多的需要掌握的技术。</p><p>我们必须记住，源代码是非常容易泄露的。代码被复制和传输到任何地方。Git的设计方式允许，甚至提升，代码可以自由分发。</p><p>项目可以克隆到多台机器上，可以分叉成新的项目，可以分发给客户，也可以公之于众等等。每次在GIT上复制它时，该项目的整个历史也会被复制。</p><p>为什么将机密存储在公共存储库中是不好的，这将是显而易见的。它们对互联网上的每个人都是免费的，监控公共存储库非常容易，例如，GitHub有一个公共API来获取所有公共提交。</p><p>私人存储库不会将您的源代码公开发布到互联网上，但它也没有足够的保护措施来存储这些敏感信息。想象一下，如果有一个纯文本文件，里面有你所有的信用卡号码，你希望不会把它放进公司的git储存库，秘密也同样敏感。</p><p>组织中有权访问repo的每个人都可以访问其中的秘密(一个被泄露的帐户可以向攻击者提供访问大量秘密的权限)。</p><p>私有存储库可以公开，其中可能有隐藏在GIT历史中的秘密。</p><p>另一个重要的注意事项是，从GIT存储库中删除的代码实际上永远不会消失。</p><p>Git跟踪所做的所有更改。被删除的代码-或者更确切地说是正确的：过度提交的代码-仍然存在于GIT历史中。</p><p>有趣的是，从项目中删除的代码数量几乎相等。这意味着存储库中的代码比第一层要深得多，秘密可能隐藏在git历史的深处，隐藏在大量早已被遗忘的提交中。</p><p>备注：您在上面从HashiCorp Vault存储库看到的贡献图是一个项目历史的典型视图。你在项目贡献图中发现的规律性既令人惊讶又有趣(看看一些项目图，这似乎是自然规律)。</p><p>如果您在GitHub上搜索提交消息“已删除AWS密钥”，您将找到数千个结果。而这正好在公共储存库中。</p><p>仅在公共GitHub内，GitGuardian每天就检测到3000多个泄露的机密，这方面的例子有数千个，但下面是几个最近或值得注意的例子。</p><p>如果这似乎只是大公司需要担心的问题，那么事实并非如此。攻击者也在不断地通过密钥利用个人服务。在一个例子中，不良行为者扫描GitHub寻找AWS密钥，并利用它们挖掘加密货币，给开发人员留下了数千美元的债务。</p><p>[研究进行中]我们忘记在@GitHub上公开回购的代码中隐藏AWS密钥。在10分钟内，从两个不同的IP利用了密钥。</p><p>-鲍勃·迪亚琴科(@MayhemDayOne)2020年7月23日。</p><p>Git的一大优势是能够快速而清晰地看到所做的更改，并比较以前的代码状态和建议的代码状态。因此，人们普遍认为，如果机密在源代码中泄露，它们当然会在代码审查或拉请求中被检测到。</p><p>代码审查对于检测逻辑缺陷、维护良好的编码实践和保持高代码质量非常有用。但它们不足以保护侦察秘密。</p><p>这是因为审查通常只考虑当前状态和拟议状态之间的净差异。而不是分行的整个历史。通常在合并到主分支之前清理分支，添加临时代码然后删除，添加不必要的文件然后删除。但是现在，这些包含机密的高风险候选文件对审查者是不可见的(除非他们想要查看分支机构的整个历史)。</p><p>让我们来看看上面的例子。虽然这过于简单化了，但它讲述了一个熟悉的故事。</p><p>提交B将添加一个名为main.py的文件。创建了一个新分支来向Commit C中的main.py添加一个新函数，该特性使用API密钥，以节省测试时间，这是硬编码的。一旦功能正常工作，硬编码的API密钥就会被环境变量替换，文件就会被清除。最后，发出并接受拉请求，因为审查者查看了提交B和提交D之间的净差异，忽略了提交C。现在，未检测到的秘密被隐藏在项目的GIT历史中。</p><p>虽然这个场景非常基本，但是加上主服务器和开发分支之间的数百个提交和文件，您就可以看到在代码审查中遗漏机密是多么容易。</p><p>哇。开源的私人回购。不久之后，@GitGuardian通知我有一个旧的提交(我删除了一个Terraform tfstate文件)。谢谢各位好心人。你是我的后盾GG！https://t.co/2rpvjjuXcI🙏。</p><p>-Stefan Scherer(@stefscherer)2019年2月15日。</p><p>考虑到我们刚刚讨论的关于GIT内部秘密的所有内容，很明显，这是一个将持续存在的问题，我们不能用人工代码审查来解决这个问题。虽然自动化并不总是答案，检测秘密，特别是GIT内部的秘密，自动秘密检测是解决这个普遍存在的问题的一个明确的解决方案。</p><p>不幸的是，由于秘密的概率性质，在git中检测秘密并不像乍看起来那么容易。这使得很难区分真正的秘密和其他随机字符串，如数据库ID或其他散列。</p><p>然而，好消息是，GitGuardian已经为开发人员构建了强大的工具来探测Git中的秘密。一个包含本地GitHub和GitLab集成的很棒的仪表板，一个称为GG-Shield的CLI工具，或者您甚至可以使用GitGuardian API构建您自己的GIT秘密扫描器。</p><p>让我们快速回顾一下我们所经历的一切。Git存储库是非常常见的发现秘密的地方，它们仍然是秘密散布到多个位置的完美孵化器。Git会跟踪一个项目的历史，这可能会很深入，使得寻找秘密变得困难。由于git创建的工作流，在手动检查过程中遗漏任何机密是很常见的，应该在SDLC中引入自动机密检测。</p><p>好奇秘密侦测是如何工作的吗？在“源代码中的秘密”系列的下一集中，我们将深入探讨秘密探测的机制，包括为什么概率算法如此棘手，以及让它们发挥作用的秘诀。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.gitguardian.com/secrets-credentials-api-git/">https://blog.gitguardian.com/secrets-credentials-api-git/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/密钥/">#密钥</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/api/">#api</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/秘密/">#秘密</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1022345.html"><img src="http://img2.diglog.com/img/2020/9/thumb_435efa62c4618af66b3f153a11422f64.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022345.html">USB密钥将结束您以及如何保护您自己</a></div><span class="my_story_list_date">2020-9-6 20:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1020514.html"><img src="http://img.diglog.com/img/2020/8/thumb_32734eddc271d8f42a5f61b8243c6dca.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1020514.html">SSH密钥-RSA、DSA、ECDSA、EdDSA</a></div><span class="my_story_list_date">2020-8-27 3:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1019151.html"><img src="http://img.diglog.com/img/2020/8/thumb_3817db12c4f72126eab4402f4565d94b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1019151.html">伽利略提出的认证算法：第一部分</a></div><span class="my_story_list_date">2020-8-20 0:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012573.html"><img src="http://img.diglog.com/img/2020/7/thumb_a61f0db2c6f9ad24426302d6a8787c33.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012573.html">苹果终于接受了基于密钥的2FA。你也应该这样</a></div><span class="my_story_list_date">2020-7-18 2:9</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>