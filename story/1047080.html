<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>文件网络共享目标（2019） </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">文件网络共享目标（2019） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-02-06 19:49:26</div><div class="page_narrow text-break page_content"><p>我经常说过，为了使Web应用程序在应用程序世界中有效竞争，需要将它们集成到用户期望应用程序存在的所有位置。应用程序间通信是Web平台上最主要的缺失部分之一，特别是最后一个主要的缺失功能是本机级共享：Web应用程序需要能够将数据从其单独仓库中获取，并传送到其他网站和应用程序中；他们还需要能够从其他本机应用程序和站点接收数据。</p><p> File Share Target API是ChromeCanary中API的改变游戏规则。该API扩展了Web Share TargetAPI，该API通过将应用程序和网站集成到系统共享功能中，使应用程序和网站共享与网站的简单链接和文本。</p><p> 这个非常静态的文件博客使用了Web Share Target API，因此我可以从任何Android应用程序中快速共享对它感兴趣的链接，从上周开始，我启用了File Share Target API，以便可以直接从Android上的相机应用程序。这篇文章全是关于它如何标识的（并从Jake Archibald那里窃取了一些代码-待他发现很多错误后，他们正在将它们集成到squoosh.app中。）</p><p> File Share TargetAPI是一个非常新颖的API，因为它是完全渐进的。如果您的应用程序可以处理Form POST请求，那么您可以轻松地与此API集成。基本流程是：当用户从本机选择器中选择您的应用程序时，Chrome会将Form POST请求发送到您的服务器，由您决定（使用服务工作者或在服务器上处理）。</p><p> 要添加对将文件共享到Web应用程序的支持，您需要做两件事：</p><p>  清单向主机系统声明应如何将共享从主机应用程序映射到Web应用程序。在下面的清单中，它基本上表示＆＃34;当用户共享类型为＆＃39; image / *＆＃39;的文件时。向// share / image /＆＃39;发出表单POST请求并命名数据＆＃39;＆＃39;＆＃34;。</p><p>  {＆＃34; name＆＃34 ;:＆＃34; Blog：分享图片＆＃34 ;，＆＃34; short_name＆＃34 ;：＆＃34; Blog：分享图片＆＃34 ;、＆＃34; start_url＆＃34 ;：＆＃34; / share / image /＆＃34 ;,＆＃34; theme_color＆＃34 ;:＆＃34;＃000000＆＃34 ;,＆＃34; background_color＆＃34 ;:＆＃34;＃000000＆ ＃34;，＆＃34; icons＆＃34;：[{＆＃34; sizes ## ::＆＃34; 192x192＆＃34;，＆＃34; src＆＃34 ;：＆＃34; / images / me .png＆＃34;，＆＃34; type＆＃34 ;：＆＃34; image / png＆＃34; }]，＆＃34; share_target＆＃34;：{＆＃34; action＆＃34;：＆＃34; / share / image /＆＃34;，＆＃34;方法＆＃34;：＆＃34; POST＆ ＃34;，＆＃34; enctype＆＃34;：＆＃34; multipart / form-data＆＃34;，＆＃34; params＆＃34;：{＆＃34; files＆＃34;：[{＆＃34 ; name＆＃34 ;:＆＃34; file＆＃34 ;,＆＃34; accept＆＃34 ;: [＆＃34; image / *＆＃34;]}]}}}，＆＃34; display＆＃34; ：＆＃34;独立＆＃34 ;，＆＃34; scope＆＃34 ;：＆＃34; / share /＆＃34;} </p><p>用户共享到您的Web应用程序后，Chrome就会使用文件数据作为有效负载向您的网站发出Web请求。</p><p> 建议您在服务工作者内部处理POST请求，以便1）快速，2）无法适应网络。您可以执行以下操作：</p><p>  onfetch =异步（事件）=> {if（event。request。method！==＆＃39; POST＆＃39;）return; if（event。request。url。startsWith（＆＃39; https：//paul.kinlan.me/share/image/&#39;）=== false）返回； / *这是为了解决杰克发现* /事件的问题。 responseWith（Response。redirect（＆＃39; / share / image /＆＃39;））;事件。 waitUntil（async function（）{const data = await event。request。formData（）; const client = await self.clients.get（event.ResultingClientId || event.clientId）; //从命名元素＆＃获取数据39; file＆＃39; const file = data。get（＆＃39; file＆＃39;）;控制台.log（＆＃39; file＆＃39 ;, file）;客户端postMessage（{file，action：＆＃ 39; load-image＆＃39;}）;}（））;};</p><p>  将数据发送到打开的窗口（这是我们在第一点将用户重定向到的UI）。</p><p> 完全由您决定如何处理已发布到服务人员的数据，但是对于我的应用程序，我需要直接在UI中显示它，因此我必须找到用户正在使用的窗口并postMessage数据那里。</p><p>  航海家。 serviceWorker。 onmessage =（事件）=＆gt; {  安慰。日志（事件）; imageBlob =事件。数据。文件; //使用已共享的数据更新UI。 imageShare。 src = URL。 createObjectURL（imageBlob）;};</p><p> 就是这样。如果您已经具有用于Web表单的API终结点，那么这是您可以对网站进行的简单但功能强大的添加。 </p><p>Web Share Target API极其强大的平台原语，打破了Web应用程序在其宿主平台上遇到的另一个障碍。  我们希望人们能够在网络上获得最佳体验，而不必安装本机应用程序或在围墙花园中生产内容。  我们的团队尝试通过支持每个Chrome版本，为web.dev上的开发人员提供支持的丰富内容，为MDN做出贡献，帮助改善浏览器的兼容性以及一些最佳的开发人员工具（例如Lighthouse），使开发人员更容易在Web上进行构建 ，Workbox和Squoosh仅举几例。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://paul.kinlan.me/file-web-share-target/">https://paul.kinlan.me/file-web-share-target/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/网络共享/">#网络共享</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/应用程序/">#应用程序</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>