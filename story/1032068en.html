<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Netflix的Kotlin多平台</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Netflix的Kotlin多平台</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-30 01:07:53</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/8535110d88c394c9f4d0fcbee02d1095.png"><img src="http://img2.diglog.com/img/2020/10/8535110d88c394c9f4d0fcbee02d1095.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Over the last few years Netflix has been developing a mobile app called Prodicle to innovate i n the physical production of TV shows and movies. The world of physical production is fast-paced, and needs vary significantly between the country, region, and even from one production to the next. The nature of the work means we’re developing write-heavy software, in a distributed environment, on devices where less than ⅓ of our users have very reliable connectivity whilst on set, and with a limited margin for error. For these reasons, as a small engineering team, we’ve found that optimizing for reliability and speed of product delivery is required for us to serve our evolving customers’ needs successfully.</p><p>在过去的几年里，Netflix一直在开发一款名为Prodicle的移动应用程序，以创新电视节目和电影的实体制作。物质生产的世界是快节奏的，国家、地区之间的需求差异很大，甚至从一种生产到另一种生产也是如此。这项工作的性质意味着我们要在分布式环境中开发编写繁重的软件，在这些设备上，只有不到⅓的用户在现场具有非常可靠的连接，并且错误容限有限。出于这些原因，作为一个小型工程团队，我们发现要想成功地满足不断变化的客户需求，必须优化产品交付的可靠性和速度。</p><p> The high likelihood of unreliable network connectivity led us to lean into mobile solutions for robust client side persistence and offline support. The need for fast product delivery led us to experiment with  a multiplatform architecture. Now we’re taking this one step further by using  Kotlin Multiplatform to write platform agnostic business logic  once in Kotlin and compiling to a Kotlin library for Android and a native Universal Framework for iOS via  Kotlin/Native.</p><p>网络连接不可靠的可能性很高，这导致我们求助于移动解决方案，以实现强大的客户端持久性和离线支持。为了快速交付产品，我们尝试了多平台架构。现在我们更进一步，使用Kotlin MultiPlatform在Kotlin中编写平台无关的业务逻辑，并通过Kotlin/Native编译成适用于Android的Kotlin库和适用于iOS的本机通用框架。</p><p>   Kotlin Multiplatform allows you to use a single codebase for the business logic of iOS and Android apps. You only need to write platform-specific code where it’s necessary, for example, to implement a native UI or when working with platform-specific APIs.</p><p>Kotlin MultiPlatform允许您使用单个代码库来处理iOS和Android应用程序的业务逻辑。例如，在需要实现本机UI或使用特定于平台的API时，您只需要编写特定于平台的代码。</p><p> Kotlin Multiplatform approaches cross-platform mobile development differently from some well known technologies in the space. Where other technologies abstract away or completely replace platform specific app development, Kotlin Multiplatform is complementary to existing platform specific technologies and is geared towards replacing platform agnostic business logic. It’s a new tool in the toolbox as opposed to replacing the toolbox.</p><p>Kotlin MultiPlatform处理跨平台移动开发的方式与该领域的一些知名技术不同。在其他技术抽象或完全取代特定于平台的应用程序开发的情况下，Kotlin MultiPlatform是对现有特定于平台的技术的补充，旨在取代与平台无关的业务逻辑。这是工具箱中的一个新工具，而不是取代工具箱。</p><p>  Our Android and iOS studio apps have a shared architecture with similar or in some cases identical business logic written on both platforms.</p><p>我们的Android和iOS工作室应用程序有一个共享的架构，在两个平台上编写的业务逻辑相似，甚至在某些情况下是相同的。</p><p> Almost 50% of the production code in our Android and iOS apps is decoupled from the underlying platform.</p><p>在我们的Android和iOS应用程序中，几乎50%的生产代码与底层平台分离。</p><p> Our appetite for exploring the latest technologies offered by respective platforms (Android Jetpack Compose, Swift UI, etc) isn’t hampered in any way.</p><p>我们探索各自平台(Android Jetpack Compose、Swift UI等)提供的最新技术的胃口丝毫没有受到任何阻碍。</p><p>   As noted earlier, our user needs vary significantly from one production to the next. This translates to a large number of app configurations to toggle feature availability and optimize the in-app experience for each production. Decoupling the code that manages these configurations from the apps themselves helps to reduce complexity as the apps grow. Our first exploration with code sharing involves the implementation of a mobile SDK for our internal experience management tool, Hendrix.</p><p>如前所述，我们的用户需求从一种产品到另一种产品差别很大。这意味着需要进行大量的应用程序配置，以切换功能可用性并优化每个产品的应用内体验。将管理这些配置的代码与应用程序本身解耦有助于降低应用程序增长时的复杂性。我们对代码共享的第一次探索涉及到为我们的内部体验管理工具Hendrix实现移动SDK。</p><p> At its core, Hendrix is a simple interpreted language that expresses how configuration values should be computed. These expressions are evaluated in the current app session context, and can access data such as A/B test assignments, locality, device attributes, etc. For our use-case, we’re configuring the availability of production, version, and region specific app feature sets.</p><p>本质上，Hendrix是一种简单的解释型语言，表示应该如何计算配置值。这些表达式在当前应用程序会话上下文中求值，可以访问A/B测试分配、位置、设备属性等数据。对于我们的用例，我们正在配置特定于生产、版本和区域的应用程序功能集的可用性。</p><p> Poor network connectivity coupled with frequently changing configuration values in response to user activity means that on-device rule evaluation is preferable to server-side evaluation.</p><p>网络连通性差，加上响应用户活动而频繁更改配置值，意味着设备上的规则评估比服务器端评估更可取。</p><p> This led us to build a lightweight Hendrix mobile SDK — a great candidate for Kotlin Multiplatform as it requires significant business logic and is entirely platform agnostic.</p><p>这导致我们构建了一个轻量级的Hendrix移动SDK-Kotlin MultiPlatform的一个很好的候选者，因为它需要重要的业务逻辑，并且完全与平台无关。</p><p>  For brevity, we’ll skip over the Hendrix specific details and touch on some of the differences involved in using Kotlin Multiplatform in place of Kotlin/Swift.</p><p>为简洁起见，我们将跳过Hendrix的具体细节，并触及使用Kotlin MultiPlatform代替Kotlin/Swift所涉及的一些不同之处。</p><p>  For Android, it’s business as usual. The Hendrix Multiplatform SDK is imported via gradle as an Android library project dependency in the same fashion as any other dependency. On the iOS side, the native binary is included in the Xcode project as a universal framework.</p><p>对于Android来说，一切如常。Hendrix多平台SDK通过Gradle作为Android库项目依赖项导入，其方式与任何其他依赖项相同。在iOS端，本机二进制文件作为通用框架包含在Xcode项目中。</p><p>  Kotlin Multiplatform source code can be edited, recompiled, and can have a debugger attached with breakpoints in Android Studio and Xcode (including lldb support). Android Studio works out of the box, Xcode support is achieved via TouchLabs’  xcode-kotlin plugin.</p><p>Kotlin多平台源代码可以编辑、重新编译，并且可以在Android Studio和Xcode中附加断点的调试器(包括lldb支持)。Android Studio开箱即用，Xcode支持通过TouchLabs的Xcode-Kotlin插件实现。</p><p>   Hendrix interprets rule set(s) — remotely configurable files that get downloaded to the device. We’re using  Ktor’s Multiplatform HttpClient to embed our networking code within the SDK.</p><p>Hendrix解释规则集-下载到设备的远程可配置文件。我们使用KTOR的多平台HttpClient将我们的网络代码嵌入到SDK中。</p><p>  Of course, network connectivity may not always be available so downloaded rule sets need to be cached to disk. For this, we’re using  SQLDelight along with it’s Android and Native Database drivers for Multiplatform persistence .</p><p>当然，网络连接可能并不总是可用的，因此需要将下载的规则集缓存到磁盘。为此，我们使用SQLDelight以及它的Android和Native Database驱动程序来实现多平台持久化。</p><p>  We’ve followed the evolution of Kotlin Multiplatform keenly over the last few years and believe that the technology has reached an inflection point. The tooling and build system integrations for Xcode have improved significantly such that the complexities involved in integration and maintenance are outweighed by the benefit of not having to write and maintain multiple platform specific implementations.</p><p>在过去的几年里，我们一直在密切关注Kotlin多平台的发展，并相信这项技术已经达到了一个转折点。Xcode的工具和构建系统集成得到了显著改进，因此不必编写和维护多个特定于平台的实现的好处盖过了集成和维护所涉及的复杂性。</p><p> Opportunities for additional code sharing between our Android and iOS studio apps are plentiful. Potential future applications of the technology become even more interesting when we consider that  Javascript transpilation is also possible.</p><p>我们的Android和iOS工作室应用程序之间有大量的额外代码共享机会。当我们考虑到Javascript转换也是可能的时，这项技术的潜在未来应用变得更加有趣。</p><p> We’re excited by the possibility of evolving our studio mobile apps into thin UI layers with shared business logic and will continue to share our learnings with you on that journey.</p><p>我们很高兴我们的工作室移动应用程序可以演变成具有共享业务逻辑的薄UI层，并将继续在此过程中与您分享我们的经验教训。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/@NetflixTechBlog/netflix-android-and-ios-studio-apps-kotlin-multiplatform-d6d4d8d25d23">https://medium.com/@NetflixTechBlog/netflix-android-and-ios-studio-apps-kotlin-multiplatform-d6d4d8d25d23</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/kotlin/">#kotlin</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/平台/">#平台</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>