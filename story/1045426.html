<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Python 3的F字符串：改进的字符串格式语法 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Python 3的F字符串：改进的字符串格式语法 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-21 04:35:04</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/5e1ce5c4841c40ec311e4d4c377d529d.jpg"><img src="http://img2.diglog.com/img/2021/1/5e1ce5c4841c40ec311e4d4c377d529d.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>立即观看本教程有一个由Real Python团队创建的相关视频课程。与书面教程一起观看，以加深您的理解：Python 3的f字符串：改进的字符串格式语法</p><p> 从Python 3.6开始，f字符串是格式化字符串的一种很棒的新方法。与其他格式化方式相比，它们不仅更具可读性，更简洁且不易出错，而且速度更快！</p><p> 到本文结尾，您将了解如何以及为什么今天开始使用f弦。</p><p> 但是首先，这就是弦乐演奏之前的生活，那是当你不得不在雪地上双向步行上学的时候。</p><p>  在Python 3.6之前，您有两种主要的方式将Python表达式嵌入字符串文字中以进行格式化：％-formatting和str.format（）。您将要了解如何使用它们以及它们的局限性。</p><p>  这是Python格式的OG，从一开始就使用该语言。您可以在Python文档中阅读更多内容。请记住，文档不建议使用％格式，其中包含以下注意事项：</p><p> “这里描述的格式化操作表现出各种古怪，导致许多常见错误（例如未能正确显示元组和字典）。 </p><p>使用较新的格式化字符串文字或str.format（）接口有助于避免这些错误。这些替代方案还提供了更强大，灵活和可扩展的文本格式设置方法。” （ 资源）</p><p> 字符串对象具有使用％运算符的内置操作，可用于格式化字符串。这是实际的情况：</p><p>  为了插入多个变量，必须使用这些变量的元组。这样做的方法如下：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;名称=＆＃34; Eric＆＃34; ＆gt;＆gt;＆gt;年龄= 74＆gt;＆gt; ＆＃34;您好，％s。您是％s。＆＃34; ％（name，age）＆＃39; Hello Eric。你今年74岁。</p><p> 您上面看到的代码示例具有足够的可读性。但是，一旦开始使用多个参数和更长的字符串，您的代码将很快变得不那么易读。事情已经开始看起来有些混乱：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; first_name =＆＃34; Eric＆＃34; ＆gt;＆gt;＆gt; last_name =＆＃34; Idle＆＃34; ＆gt;＆gt;＆gt;年龄= 74＆gt;＆gt;专业=＆＃34;喜剧演员＆＃34; ＆gt;＆gt;＆gt;隶属关系=＆＃34; Monty Python＆＃34; ＆gt;＆gt;＆gt; ＆＃34;您好，％s％s。你是％s。您是％s。您是％s的成员。＆＃34; ％（first_name，last_name，年龄，专业，从属关系）＆＃39;您好，Eric Idle。你74岁。你是喜剧演员。您是Monty Python的成员。＆＃39;</p><p> 不幸的是，这种格式不好用，因为它太冗长并会导致错误，例如无法正确显示元组或字典。幸运的是，还有更美好的日子。 </p><p>Python 2.6中引入了这种完成工作的新方法。您可以查看新Python字符串格式技术指南以获得更多信息。</p><p> str.format（）是％格式的改进。它使用普通的函数调用语法，并且可以通过将__format __（）方法转换为要转换为字符串的对象来进行扩展。</p><p>     但是，如果您插入变量名，则会获得以下额外的好处：能够传递对象，然后在花括号之间引用参数和方法：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;人= {＆＃39;名字＆＃39; ：＆＃39; Eric＆＃39; ，＆＃39;年龄＆＃39; ：74}＆gt;＆gt; ＆＃34;您好，{name}。您是{age}。＆＃34; 。格式（姓名=人[＆＃39; name＆＃39;]，年龄=人[＆＃39; age＆＃39;]）＆＃39; Hello，Eric。你今年74岁。</p><p>  ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;人= {＆＃39;名字＆＃39; ：＆＃39; Eric＆＃39; ，＆＃39;年龄＆＃39; ：74}＆gt;＆gt; ＆＃34;您好，{name}。您是{age}。＆＃34; 。格式（**人）＆＃39;你好，埃里克。你今年74岁。</p><p> 与％-formatting相比，str.format（）绝对是升级，但并不是所有的玫瑰和阳光。</p><p> 使用str.format（）的代码比使用％-formatting的代码更易于阅读，但是当您处理多个参数和更长的字符串时，str.format（）仍然非常冗长。看看这个： </p><p>＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; first_name =＆＃34; Eric＆＃34; ＆gt;＆gt;＆gt; last_name =＆＃34; Idle＆＃34; ＆gt;＆gt;＆gt;年龄= 74＆gt;＆gt;专业=＆＃34;喜剧演员＆＃34; ＆gt;＆gt;＆gt;隶属关系=＆＃34; Monty Python＆＃34; ＆gt;＆gt;＆gt; print（（＆＃34;您好，{first_name} {last_name}。您是{age}。＆＃34; +＆gt;＆gt;＆gt;＆＃34;您是{profession}。您是{ }（＆＃34;）\＆gt;＆gt;＆gt;格式（first_name = first_name，last_name = last_name，age =年龄，\ gt;＆gt;＆gt;＆gt;＆gt;＆gt;＆gt;专业=职业，隶属关系=隶属关系））＆＃39;您好，埃里克·艾德（Eric Idle）。你74岁。你是喜剧演员。您是Monty Python的成员。＆＃39;</p><p> 如果您有要在字典中传递给.format（）的变量，则可以只用.format（** some_dict）解压缩并按字符串中的键引用值，但必须有一个更好的方法做到这一点的方法。</p><p> 好消息是F弦乐在这里挽救了一天。他们切片！他们骰子！他们做朱莉安薯条！好的，它们什么都不做，但是它们确实使格式化更容易。他们加入了Python 3.6。您可以在2015年8月由Eric V.Smith撰写的PEP 498中阅读所有内容。</p><p> f字符串也称为“格式化字符串文字”，是在开头带有f且花括号包含将被其值替换的表达式的字符串文字。在运行时对表达式求值，然后使用__format__协议对其进行格式化。与往常一样，当您想了解更多信息时，Python文档是您的朋友。</p><p>  该语法与您用于str.format（）的语法相似，但较为冗长。看看这是多么容易阅读：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;名称=＆＃34; Eric＆＃34; ＆gt;＆gt;＆gt;年龄= 74＆gt;＆gt; f＆＃34;您好，{name}。您是{age}。＆＃34; ＆＃39;你好，埃里克。你今年74岁。</p><p>   你喜欢f弦吗？希望在本文结尾处，您将回答＆gt;＆gt;＆gt; F＆＃34;是！＆＃34;。 </p><p>由于f字符串是在运行时求值的，因此您可以在其中放入任何和所有有效的Python表达式。这使您可以做一些漂亮的事情。</p><p>    ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; def to_lowercase（input）：...返回输入。下（）＆gt;＆gt;名称=＆＃34; Eric Idle＆＃34; ＆gt;＆gt;＆gt; f＆＃34; {to_lowercase（name）}很有趣。＆＃34; “ eric闲置很有趣。”</p><p>   您甚至可以使用从带有f字符串的类创建的对象。想象一下您有以下课程：</p><p> 喜剧演员类：def __init __（self，first_name，last_name，age）：self。 first_name = first_name self。 last_name = last_name self。 age = age def __str__（self）：返回f＆＃34; {自我。 first_name} {自我。 last_name}是{self。年龄}。＆＃34; def __repr__（self）：返回f＆＃34; {自我。 first_name} {自我。 last_name}是{self。年龄}。惊喜！＆＃34;</p><p>   __str __（）和__repr __（）方法处理对象如何以字符串形式显示，因此您需要确保在类定义中至少包括这些方法之一。如果必须选择一个，请使用__repr __（），因为它可以代替__str __（）使用。</p><p> __str __（）返回的字符串是对象的非正式字符串表示形式，应可读。 __repr __（）返回的字符串是正式表示形式，应明确。与直接使用__str __（）和__repr __（）相比，调用str（）和repr（）更可取。</p><p> 默认情况下，f字符串将使用__str __（），但是如果包含转换标志！r，则可以确保它们使用__repr __（）。 </p><p>如果您想阅读一些导致f字符串支持完整Python表达式的对话，则可以在此处进行。</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;名称=＆＃34; Eric＆＃34; ＆gt;＆gt;＆gt;专业=＆＃34;喜剧演员＆＃34; ＆gt;＆gt;＆gt;隶属关系=＆＃34; Monty Python＆＃34; ＆gt;＆gt;＆gt; message =（... f＆＃34; Hi {name}。＆＃34; ... f＆＃34; You are a {career}。＆＃34; ... f＆＃34; You are in {隶属关系}。＆＃34; ...）＆gt;＆gt;消息＆＃39; Hi Eric。你是喜剧演员。您在Monty Python中。</p><p> 但是请记住，您需要在多行字符串的每一行前面放置一个f。以下代码无效：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; message =（... f＆＃34; Hi {name}。＆＃34; ...＆＃34;您是{职业}。＆＃34; ...＆＃34;您处于{隶属关系}。＆＃34; ...）＆gt;＆gt;消息＆＃39; Hi Eric。您是{职业}。您当时处于{affiliation}。＆＃39;</p><p> 如果您没有在每行的前面都加上f，那么您将只有普通的，老式的，花园风格的琴弦，而不是闪亮的，新颖的，精美的f琴弦。</p><p> 如果要将字符串分布在多行中，还可以选择使用\来转义返回值：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; message = f＆＃34; Hi {name}。 ＆＃34; \ ... f＆＃34;您是{职业}。 ＆＃34; \ ... f＆＃34;您处于{隶属关系}。＆＃34; ...＆gt;＆gt;＆gt;消息＆＃39; Hi Eric。你是喜剧演员。您在Monty Python中。 </p><p>＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;消息= f＆＃34;＆＃34;＆＃34; ...您好{name}。 ...您是{职业}。 ...您处于{隶属关系}。 ...＆＃34;＆＃34;＆＃34; ...＆gt;＆gt;＆gt;消息＆＃39; \ n埃里克（Eric），您好。\ n您是喜剧演员。\ n您曾在Monty Python中工作。\ n＆＃39;</p><p> f字符串比％-formatting和str.format（）都快。如您所见，f字符串是在运行时求值的表达式，而不是常量值。以下是这些文档的摘录：</p><p> “ F字符串提供了一种使用最小语法在字符串文字中嵌入表达式的方法。应当注意，f字符串实际上是在运行时评估的表达式，而不是常数。在Python源代码中，f字符串是文字字符串，前缀为f，其中包含大括号内的表达式。这些表达式将替换为其值。” （ 资源）</p><p> 在运行时，大括号内的表达式在其自己的范围内求值，然后与f字符串的字符串文字部分放在一起。然后返回结果字符串。仅此而已。</p><p>  ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;导入时间＆gt;＆gt;＆gt; timeit。 timeit（＆＃34;＆＃34; name =＆＃34; Eric＆＃34; ... age = 74 ...＆＃39;％s是％s。＆＃39;％（name ，age）＆＃34;＆＃34;＆＃34 ;，数字= 10000）0.003324444866599663</p><p>    但是，情况并非总是如此。首次实施时，它们存在一些速度问题，需要比str.format（）更快。引入了特殊的BUILD_STRING操作码。</p><p> 既然您已经了解了为什么f弦很棒，我相信您一定要开始使用f弦。当您冒险进入这个勇敢的新世界时，请牢记以下一些细节。 </p><p>您可以在表达式内使用各种类型的引号。只要确保您没有在表达式中使用与f字符串相同的引号即可。</p><p>        如果发现需要在字符串的内部和外部使用相同类型的引号，则可以使用\进行转义：</p><p> 说到引号，使用字典时要当心。如果您要对字典的键使用单引号，请记住确保对包含键的f字符串使用双引号。</p><p>  ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;喜剧演员= {＆＃39;名字＆＃39; ：＆＃39; Eric Idle＆＃39; ，＆＃39;年龄＆＃39; ：74}＆gt;＆gt; f＆＃34;喜剧演员是{喜剧演员[＆＃39; name＆＃39; ]}，年龄{喜剧演员[＆＃39; age＆＃39; ]}。＆＃34;喜剧演员是埃里克·艾德（Eric Idle），现年74岁。</p><p>  ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt;喜剧演员= {＆＃39;名字＆＃39; ：＆＃39; Eric Idle＆＃39; ，＆＃39;年龄＆＃39; ：74}＆gt;＆gt; f＆＃39;喜剧演员是{喜剧演员[＆＃39; name＆＃39; ]}，年龄{喜剧演员[＆＃39; age＆＃39; ]}。＆＃39;档案＆＃34;＆lt; stdin＆gt;＆＃34 ;，第1行f＆＃39;喜剧演员是{喜剧演员[＆＃39; name＆＃39; ]}，年龄{喜剧演员[＆＃39; age＆＃39; ]}。＆＃39; ^ SyntaxError：语法无效</p><p> 如果在字典键周围使用与在f字符串外部相同的引号类型，则第一个字典键开头的引号将被解释为字符串的结尾。</p><p> 为了使大括号出现在字符串中，必须使用双大括号： </p><p>请注意，使用三重花括号将导致字符串中只有一个大括号：</p><p>  但是，如果使用的括号多于三个，则可以显示更多的括号：</p><p> 如前所述，可以在f字符串的字符串部分使用反斜杠转义符。但是，不能在F字符串的表达式部分中使用反斜杠进行转义：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; f＆＃34; {\＆＃34; Eric Idle \＆＃34; }＆＃34;文件＆＃34;＆lt; stdin＆gt;＆＃34 ;，第1行f＆＃34; {\＆＃34; Eric Idle \＆＃34; }＆＃34; ^ SyntaxError：f字符串表达式部分不能包含反斜杠</p><p> 您可以通过预先计算表达式并在f字符串中使用结果来解决此问题：</p><p> 表达式中不应包含使用＃符号的注释。您会收到语法错误：</p><p> ＆gt;＆gt;＆gt; ＆gt;＆gt;＆gt; f＆＃34; Eric是{2 * 37＃天哪！ }＆＃34;文件＆＃34;＆lt; stdin＆gt;＆＃34 ;，第1行f＆＃34; Eric是{2 * 37＃我的天哪！ }＆＃34; ^ SyntaxError：f字符串表达式部分不能包含＆＃39;＃＆＃39; </p><p>您仍然可以使用旧的格式化字符串的方法，但是使用f字符串，您现在有了更简洁，易读和方便的方法，既快捷又不易出错。如果您尚未进行切换，那么使用f字符串简化生活是开始使用Python 3.6的重要原因。 （如果您仍在使用Python 2，请不要忘记2020年即将到来！）</p><p> 根据Python Zen的说法，当您需要决定如何做某事时，那么“这应该是一种（最好只有一种）显而易见的方式。”尽管f字符串不是格式化字符串的唯一可能方法，但是它们很适合成为完成工作的一种明显方式。</p><p> 如果您想阅读有关字符串插值的扩展讨论，请查看PEP502。此外，PEP 536草案对f字符串的未来有更多的想法。</p><p> 立即观看本教程有一个由Real Python团队创建的相关视频课程。与书面教程一起观看，以加深您的理解：Python 3的f字符串：改进的字符串格式语法</p><p> 简短说明每两天就会向您的收件箱发送一个可爱的Python Trick。从来没有垃圾邮件。随时退订。由Real Python团队策划。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://realpython.com/python-f-strings/">https://realpython.com/python-f-strings/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/字符串/">#字符串</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/strings/">#strings</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1044876.html"><img src="http://img2.diglog.com/img/2021/1/thumb_b02640a2cd161f115f72b30fe682eeec.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044876.html">朱莉娅（Julia）更新：领养不断攀升； 是Python挑战者吗？ </a></div><span class="my_story_list_date">2021-1-18 20:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044495.html"><img src="http://img2.diglog.com/img/2021/1/thumb_5a2ef13fc85ac98787f91f1907d843cb.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044495.html">如何使用Python分析卷配置文件 </a></div><span class="my_story_list_date">2021-1-16 9:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044055.html"><img src="http://img2.diglog.com/img/2021/1/thumb_f0513192985d93ce58e88ed7fc13bf83.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044055.html">使用perf和VizTracer跟踪和可视化Python GIL </a></div><span class="my_story_list_date">2021-1-15 19:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1043956.html"><img src="http://img2.diglog.com/img/2021/1/thumb_4b7d9ecba1881eda1176c27aaa7da297.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1043956.html">微软拒绝开源VSCode Python语言服务器 </a></div><span class="my_story_list_date">2021-1-11 14:12</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>