<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>谷歌建议为Linux提供用户线程</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">谷歌建议为Linux提供用户线程</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-28 00:49:13</div><div class="page_narrow text-break page_content"><p>/color/Atom提要发件人：Peter Oskolkov&lt；posk@posk.io&gt；收件人：Linux内核邮件列表&lt；linux-kernel@vger.kernel.org&gt；，Thomas Gleixner&lt；tglx@linuconix.de&gt；，ingo Molnar&lt；mingo@redhat.com&gt；，ingo Molnar&lt；mingo@kernelt；抄送：Peter Oskolkov&lt；Posk@google.com&gt；，Andrei Vagin&lt；avagin@google.com&gt；，Paul Turner&lt；pjt@google.com&gt；，Ben Segall&lt；bSegall@google.com&gt；，Aaron Lu&lt；aaron.lwe@gmail.com&gt；主题：[PATCH for 5.9 0/3]Fut；[PJT@google.com&gt；，Aaron Lu&lt；aaron.lwe@gmail.com&gt；(RAW)来自：Peter Oskolkov&lt；posk@google.com&gt；正如保罗·特纳在2013年的lpc上介绍的那样...-pdf：http://pdxplumbers.osuosl.org/2013/ocw//system/presentations/1653/original/LPC%20-%20User%20Threading.pdf-视频：https://www.youtube.com/watch?v=KXuZi9aeGTw...。Google已经开发了一个由Google-private Switchto Linux内核API命名的M：N用户空间线程子系统(上面参考的PDF中的第17页)。这个子系统在Google提供延迟敏感型服务，对运行时间进行细粒度的用户空间控制/调度，并且这个子系统在内部被广泛使用(称为调度器或光纤)。这个补丁集是开源这项工作的第一步。正如链接的pdf和视频中所解释的，SwitchTo API有三个核心操作：等待、恢复和交换(=switch)。因此，此修补程序集添加了一个FUTEX_SWAP操作，除了FUTEX_WAIT和FUTEX_WAKE之外，它还将提供一个基础，在此基础上可以构建用户空间线程库。FUTEX_SWAP的另一个常见用例是在任务之间传递消息：任务/线程T1准备消息，唤醒T2处理消息，并等待结果；T2完成后，它唤醒T1并等待更多工作到来。目前实现这一点的最简单方式是ISA。T1：Futex-Wake T2，Futex-Waitb。T2：唤醒，执行已唤醒到DOC的操作。T2：Futex-WAKE T1，Futex-wait使用Futex_SWAP，上述步骤a和c可以减少为一个Futex操作，运行速度提高5-10倍。此修补程序集中的补丁程序：补丁程序1：引入内部执行WAKE+WAIT的Futex_SWAP Futex操作。此补丁程序的目的是制定API。补丁程序2：第一次粗略尝试使Futex_SWAP比WAKE+WAIT的速度更快。补丁程序3：也可用于对Futex_SWAP与Futex_WAIT+Futex_WAIT进行基准测试的自测试。Peter Oskolkov(3)：Futex：引入Futex_SWAP操作Futex/sched：ADD WAKEX_UP_PROCESS_PREER_CURRENT_CPU，在Futex_SWAP自检/Futex中使用：添加Futex_SWAP自检include/linux/Sched.h|1+include/uapi/linux/futex.h|2+kernel/futex.c|89+--kernel/sched/core.c|5+kernel/sched/air.c|3+kernel/sched/ed.h|1+.../selftest/futex/function/.gitignore|1+.../selftestore|1+.../selftest/.gitignore|1+.../selftest。|209+.../selftest/futex/include/futextest.h|19++10个文件已更改，315个插入(+)，16项删除(-)创建模式100644 tools/testing/selftests/futex/functional/futex_swap.c--2.25.1回复索引线程概述：9+消息/展开[平面|嵌套]mbox.gz Atom feed top 2020-07-22 23：45 Peter Oskolkov[此消息]2020-07-22 23：45`[5.9 1/3]Futex：介绍Futex_SWAP操作Peter Oskolkov2020-07-23 11：27`Peter Zijlstra2020-07-24 0：25`Peter Oskolkov2020-07-23 11：27`Peter Zijlstra2020-07-24 0：25`Peter Oskolkov2020-07-23 11：27`Peter Zijlstra2020-07-24 0：25`Peter Oskolkov2020。00`外曼龙2020-07-24 3：22`Peter Oskolkov2020-07-27 9：51`peterz2020-07-22 23：45`[5.9 2/3补丁]futex/sched：add WAKE_UP_PROCESS_PREER_CURRENT_CPU，在FUTEX_SWAP Peter Oskolkov2020-07-22 23：45`[5.93/3补丁程序]中使用自检/FUTEX：添加FUTEX_SWAP自测试Peter Oskolkov回复说明：您可以使用以下任何一种方法通过纯文本电子邮件公开回复此消息：*保存以下mbox文件，将其导入到您的邮件客户端，然后从那里回复给所有人：mbox避免顶部张贴，而倾向于交叉引用：https://en.wikipedia.org/wiki/Posting_style#Interleaved_style*使用--to回复，和Git-Send-Email(1)的回复开关(1)：git send-email\--in-reply-to=20200722234538.166697-1-posk@posk.io\--to=posk@posk.io\--cc=aaron.lwe@gmail.com\--cc=avagin@google.com\--cc=bSegall@google.com\--cc=dvhart@ipad.org\--cc=linux-kernel@vger.kernel.org\--cc。Com\--cc=peterz@ipadad.org\--cc=pjt@google.com\--cc=posk@google.com\--cc=tglx@linuconix.de\--cc=vincent.jittot@linaro.org\/https://kernel.org/pub/software/scm/git/docs/git-send-email.html*/to/Your_Reply MAILTO：如果您的邮件客户端支持通过MAILTO：链接设置In-Reply-To报头，尝试使用mailto：link lkml Archive on lore.kernel.org归档文件是可克隆的：git克隆--镜像https://lore.kernel.org/lkml/0 lkml/git/0.git git克隆--镜像https://lore.kernel.org/lk</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://lore.kernel.org/lkml/20200722234538.166697-1-posk@posk.io/">https://lore.kernel.org/lkml/20200722234538.166697-1-posk@posk.io/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/线程/">#线程</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/建议/">#建议</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1014452.html"><img src="http://img.diglog.com/img/2020/7/thumb_9287dcce1eb820f9036425c2006864a4.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1014452.html">谷歌将允许员工在家工作至少到明年夏天</a></div><span class="my_story_list_date">2020-7-28 0:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1014411.html"><img src="http://img.diglog.com/img/2020/7/thumb_e0a0463090a5596069c149d7681d639e.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1014411.html">在冠状病毒大流行期间，谷歌将把员工留在家里直到2021年夏天</a></div><span class="my_story_list_date">2020-7-27 22:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1014403.html"><img src="http://img.diglog.com/img/2020/7/thumb_e0a0463090a5596069c149d7681d639e.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1014403.html">消息来源：谷歌将让几乎所有员工在家工作至少到2021年7月，影响到近20万名全职和合同制员工</a></div><span class="my_story_list_date">2020-7-27 21:22</span></div><div class="col-sm"><div><a target="_blank" href="/story/1014387.html"><img src="http://img.diglog.com/img/2020/7/thumb_a734b1ff3c96d5140652af09e10e24f5.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1014387.html">澳大利亚竞争和消费者委员会起诉谷歌涉嫌在未获得明确同意的情况下扩大使用用户个人数据</a></div><span class="my_story_list_date">2020-7-27 19:8</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>