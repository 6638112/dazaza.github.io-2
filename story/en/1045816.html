<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>升级您的SSH密钥 Upgrade Your SSH Keys</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Upgrade Your SSH Keys<br/>升级您的SSH密钥 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-23 00:05:04</div><div class="page_narrow text-break page_content"><p>Whether you&#39;re a software developer or a sysadmin, I bet you&#39;re using SSH keys.Pushing your commits to Github or managing your Unix systems, it&#39;s best practice to do this over SSH with public key authentication rather than passwords.However, as time flies, many of you are using older keys and not aware of the need to generate fresh ones to protect your privates much better.In this post I&#39;ll demonstrate how to transition to an Ed25519 key smoothly, why you would want this and show some tips and tricks on the way there.</p><p>无论您是软件开发人员还是系统管理员，我打赌您都在使用SSH密钥。将您的提交推送到Github或管理Unix系统，最好的做法是通过SSH使用公钥进行此操作身份验证而不是密码。但是，随着时间的流逝，你们中的许多人都在使用较旧的密钥，并且没有意识到需要生成新的密钥来更好地保护您的私人财产。在本文中，我将演示如何过渡到Ed25519顺利输入密码，为什么要这么做，并在此过程中显示一些提示和技巧。</p><p> Generate your new key with  ssh-keygen -o -a 100 -t ed25519, specify a strong passphrase and read further if you need a smooth transition.</p><p> 使用ssh-keygen -o -a 100 -t ed25519生成新密钥，指定一个强密码短语，如果需要平滑过渡，请进一步阅读。</p><p> I&#39;m planning to publish some more posts on SSH tips &amp; tricks, so keep an eye on my blog for more.This post will focus on about SSH keys as user public key authentication.</p><p> 我计划在SSH技巧和公告上发布更多信息。技巧，因此请关注我的博客以获取更多信息。这篇文章将重点介绍SSH密钥作为用户公共密钥身份验证。</p><p>  If you&#39;ve created your key more than about four years ago with the default options it&#39;s probably insecure (RSA &lt; 2048 bits).Even worse, I&#39;ve seen tweeps, colleagues and friends still using DSA keys ( ssh-dss in OpenSSH format) recently.That&#39;s a key type similar to RSA, but limited to 1024 bits size and therefore  recommended against for a long time.It&#39;s plainly insecure and refused for valid reasons in recent OpenSSH versions (see also the  changelog for 7.0).</p><p>  如果您大约四年前使用默认选项创建了密钥，那么它可能是不安全的（RSA小于2048位）。更糟糕的是，我看到过鸣叫声，同事和朋友仍在使用DSA密钥（OpenSSH格式的ssh-dss）最近。这是一种类似于RSA的密钥类型，但限制为1024位大小，因此建议长时间使用。它显然是不安全的，出于有效原因被拒绝在最新的OpenSSH版本中（另请参见7.0的变更日志）。</p><p> The sad thing about it is that I see posts on how to re-enable DSA key support rather than moving to a more secure type of key.Really, it&#39;s unwise to follow instructions to change the configuration for  PubkeyAcceptedKeyTypes or  HostKeyAlgorithms (host keys are for a later post).Instead, upgrade your keys!</p><p> 令人遗憾的是，我看到了有关如何重新启用DSA密钥支持而不是转向更安全的密钥类型的帖子。确实，按照说明更改PubkeyAcceptedKeyTypes或HostKeyAlgorithms（主机密钥供以后使用）。相反，请升级您的密钥！</p><p>  Compare DSA with the technology of locks using keys like this one.You wouldn&#39;t want this type of key to unlock your front door, right?</p><p>  将DSA与使用这种钥匙的锁技术进行比较。您不会希望这种类型的钥匙来解锁前门吗？</p><p>       You&#39;re probably thinking… &#34;I&#39;m using my key for a long time, I don&#39;t want to change them everywhere now.&#34;Valid point, but you don&#39;t have to! It&#39;s good to know you can have multiple keys on your system and your SSH client will pick the right one for the right system automatically.</p><p>       您可能在想……我很长时间以来一直在使用我的密钥，我现在不想在任何地方更改它们。有效点，但是您不知道不必！很高兴知道您的系统上可以有多个密钥，并且SSH客户端会自动为正确的系统选择正确的密钥。 </p><p> It&#39;s part of the SSH protocol that it can offer multiple keys and the server picks the one your client will have to prove it has possession of the private key by a challenge.See it in action adding some verbosity to the SSH connect command ( -vvv).Also if you&#39;re using an SSH agent you can load multiple keys and it will discover them all.Easy as that.</p><p>它是SSH协议的一部分，它可以提供多个密钥，而服务器会选择一个客户端来证明它具有挑战性，以证明它拥有私钥。在运行中查看它会给SSH连接增加一些冗长的细节命令（-vvv）。此外，如果您正在使用SSH代理，则可以加载多个密钥，它将发现所有密钥。</p><p>  Most common is the RSA type of key, also known as  ssh-rsa with SSH.It&#39;s very compatible, but also slow and potentially insecure if created with a small amount of bits (&lt; 2048).We just learned that your SSH client can handle multiple keys, so enable yourself with the newest faster elliptic curve cryptography and enjoy the very compact key format it provides!</p><p>  最常见的是RSA类型的密钥，也称为SSH的ssh-rsa，它非常兼容，但是如果创建的比特数很少（<2048），它也很慢并且可能不安全。您的SSH客户端可以处理多个密钥，因此请使用最新的更快的椭圆曲线加密技术，并享受它提供的非常紧凑的密钥格式！</p><p> Ed25519 keys are short. Very short. If you&#39;re used to copy multiple lines of characters from system to system you&#39;ll be happily surprised with the size. The public key is just about 68 characters. It&#39;s also much faster in authentication compared to secure RSA (3072+ bits).</p><p> Ed25519键很短。很短。如果习惯于在系统之间复制多行字符，那么您会惊讶于其大小。公钥只有68个字符。与安全RSA（3072+位）相比，它的身份验证速度也快得多。</p><p> Generating an Ed25519 key is done using the  -t ed25519 option to the ssh-keygen command.</p><p> 使用ssh-keygen命令的-t ed25519选项可以生成Ed25519密钥。</p><p>   When generating the keypair, you&#39;re asked for a passphrase to encrypt the private key with.If you will ever lose your private key it should protect others from impersonating you because it will be encrypted with the passphrase.To actually prevent this, one should make sure to prevent easy brute-forcing of the passphrase.</p><p>   生成密钥对时，系统会要求您输入用于加密私钥的密码。如果您丢失了私钥，则应该保护他人以防他人冒用，因为它将使用密码进行加密。为防止这种情况，应该确保防止密码短语容易被强行使用。</p><p> OpenSSH key generator offers two options to resistance to brute-force password cracking: using the new OpenSSH key format and increasing the amount of key derivation function rounds.It slows down the process of unlocking the key, but this is what prevents efficient brute-forcing by a malicious user too.I&#39;d say experiment with the amount of rounds on your system.Start at about 100 rounds.On my system it takes about one second to decrypt and load the key once per day using an agent.Very much acceptable, imo.</p><p> OpenSSH密钥生成器提供了两种抵御暴力破解密码的选项：使用新的OpenSSH密钥格式和增加密钥派生功能回合的数量，这会减慢密钥的解锁过程，但是这阻止了有效的暴力破解我也说过要对您的系统上的回合数量进行实验。大约要进行100轮回合。在我的系统上，每天使用代理解密和加载密钥大约需要一秒钟的时间。 imo。</p><p> With  ssh-keygen use the  -o option for the new RFC4716 key format and the use of a modern key derivation function powered by bcrypt.Use the  -a &lt;num&gt; option for  &lt;num&gt; amount of rounds.</p><p> 对于ssh-keygen，对新的RFC4716密钥格式使用-o选项，并使用由bcrypt支持的现代密钥派生功能。-a＆lt; num＆gt; ＆lt; num＆gt;的选项轮数。 </p><p>  The OpenSSH manpages are not really explanatory about the &#39;new&#39; format.I found this article pretty useful:  &#34;new openssh key format and bcrypt pbkdf&#34; on www.tedunangst.com.</p><p>OpenSSH联机帮助页并没有真正说明＆＃39; new＆＃39;格式。我发现本文非常有用：＆＃34;新的openssh密钥格式和bcrypt pbkdf＆＃34;在www.tedunangst.com上。</p><p>  Use the same passphrase on all of your key types and profit with more convenience.(See also  Multi-key aware SSH client.)</p><p>  在所有密钥类型上使用相同的密码短语，可以更方便地获利（另请参见支持多密钥的SSH客户端）。</p><p> $ ssh-keygen -o -a  100 -t ed25519 Generating public/private ed25519 key pair. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/gert/.ssh/id_ed25519. Your public key has been saved in /home/gert/.ssh/id_ed25519.pub. The key fingerprint is: SHA256: [...] gert@hostname The key&#39;s randomart image is: [...]</p><p> $ ssh-keygen -o -a 100 -t ed25519生成公用/专用ed25519密钥对。输入密码（无密码时为空）：再次输入相同的密码：您的标识已保存在/home/gert/.ssh/id_ed25519中。您的公钥已保存在/home/gert/.ssh/id_ed25519.pub中。密钥指纹是：SHA256：gert @ hostname密钥的randomart图像是：[...]</p><p> Note the line &#39;Your identification has been saved in /home/gert/.ssh/id_ed25519&#39;.Your current RSA/DSA keys are next to it in the same  ~/.ssh folder.As with any other key you can copy the public key in  ~/.ssh/id_ed25519.pub to target hosts for authentication.</p><p> 请注意＆＃39;您的行已保存在/home/gert/.ssh/id_ed25519&#39;中。您当前的RSA / DSA密钥位于同一〜/ .ssh文件夹中。您可以将〜/ .ssh / id_ed25519.pub中的公钥复制到目标主机以进行身份​​验证。</p><p>  All keys available on default paths will be autodetected by SSH client applications, including the SSH agent via ssh-add.So, if you were using an application like ssh/scp/rsync before like...</p><p>  SSH客户端应用程序会自动检测默认路径上可用的所有密钥，包括通过ssh-add的SSH代理，因此，如果您之前使用过ssh / scp / rsync之类的应用程序...</p><p>  it will now offer multiple public keys to the server and the server will request proof of possession for a matching entry for authentication.And your daily use of the  ssh-add command will not change and autodiscover the Ed25519 key:</p><p>  它现在将为服务器提供多个公钥，并且服务器将请求拥有证明以提供匹配条目以进行身份​​验证。并且您每天使用ssh-add命令不会更改并自动发现Ed25519密钥：</p><p>  It not only discovered both keys, it also loaded them by entering a single passphrase (because it&#39;s the same)!</p><p>  它不仅发现了两个密钥，还通过输入一个密码短语来加载它们（因为它相同）！ </p><p> We&#39;ve reached a very important goal now.Without any change to your daily routine we can slowly change the existing configuration on remote hosts to accept the Ed25519 key.In the meantime the RSA key will still work.Great, right!?</p><p>现在我们已经实现了一个非常重要的目标。在您的日常工作中无需进行任何更改，我们就可以缓慢地更改远程主机上的现有配置以接受Ed25519密钥。与此同时RSA密钥仍然可以使用。</p><p>  If you&#39;re afraid this will change your key, don&#39;t worry.The private part of your keypair is encrypted with a passphrase which only exists locally on your machine.Change it as often as you like.This is recommended to prevent abuse in case the key file gets into the wrong hands.Repeat for all your key files to ensure a new key format with 100 bcrypt KDF rounds:</p><p>  如果您担心这会更改您的密钥，请不要担心。密钥对的私有部分使用仅在计算机本地存在的密码加密，因此您可以随时更改它。建议以防万一密钥文件被不正确的人滥用，请重复所有密钥文件以确保新的密钥格式具有100次bcrypt KDF验证：</p><p>   Using Ed25519 will (and should) work in most situations by now, but legacy systems may not support them as of yet.The best fallback is a strong RSA keypair for this.</p><p>   到目前为止，使用Ed25519可以（而且应该）在大多数情况下都可以使用，但是传统系统可能到目前为止还不支持它们。最好的后退是为此提供强大的RSA密钥对。</p><p> While the OpenSSH client supports multiple RSA keys, it requires configuration/command line options to specify the path so it&#39;s rather error-prone.Instead, I&#39;d recommend upgrading your existing key in-place to keep things simple once this is done.Depending on the strength (key size) of your current RSA key you can migrate urgently or comfortably.</p><p> 尽管OpenSSH客户端支持多个RSA密钥，但它需要配置/命令行选项来指定路径，因此它很容易出错。相反，我建议就地升级现有密钥以简化操作根据当前RSA密钥的强度（密钥大小），您可以紧急或舒适地进行迁移。</p><p> In case you have a weak RSA key still, move it out of the way from the standard path and generate a new one of 4096 bits size:</p><p> 如果您仍然有一个较弱的RSA密钥，请将其移出标准路径，并生成一个4096位大小的新密钥：</p><p> $ mv ~/.ssh/id_rsa ~/.ssh/id_rsa_legacy $ mv ~/.ssh/id_rsa.pub ~/.ssh/id_rsa_legacy.pub $ ssh-keygen -t rsa -b  4096 -o -a  100</p><p> $ mv〜/ .ssh / id_rsa〜/ .ssh / id_rsa_pubacy $ mv〜/ .ssh / id_rsa.pub〜/ .ssh / id_rsa_legacy.pub $ ssh-keygen -t rsa -b 4096 -o -a 100</p><p>   Once you are finished the transition on all remote targets you can go back to convenience and let it autodiscover your new RSA and Ed25519 keys; simply omit the keyfile arguments.</p><p>   完成所有远程目标上的转换后，您可以回到方便状态，让它自动发现新的RSA和Ed25519密钥；只需省略keyfile参数。 </p><p>  Support is available since OpenSSH 6.5 and well adopted in the Unix world OSs for workstations.Ubuntu 14.04+, Debian 8+, CentOS/RedHat 7+ etc. all support it already.(If you have details about Mac OS X please drop a line, couldn&#39;t find it with a quick search).Some software like custom desktop key agents may not like the new keys for several reasons (see below  about the Gnome-keyring for example).</p><p>自OpenSSH 6.5开始提供支持，并已在Unix世界操作系统的工作站中广泛采用.Ubuntu 14.04 +，Debian 8 +，CentOS / RedHat 7+等都已支持（如果您有Mac OS X的详细信息，请下一行，无法通过快速搜索找到它）。某些软件（例如自定义桌面密钥代理）可能由于多种原因而不喜欢新密钥（例如，有关Gnome密钥，请参见下文）。</p><p> Github works pretty well too, by the way.Launchpad and Gerrit code review however, seem to require RSA keys unfortunately.PuTTY on Windows? See below.</p><p> 顺便说一句，Github也运行得很好。但是不幸的是，Launchpad和Gerrit代码审查似乎需要RSA密钥.Windows上的PuTTY吗？见下文。</p><p>  The Gnome-keyring, as used in Ubuntu Unity at least, fails to read the new RFC4716 format keys but reports success.It&#39;s bugged.More details here in  my AskUbuntu Q&amp;A post.I&#39;d recommend disabling the Gnome keyring for SSH agent use and use the plain OpenSSH agent instead.</p><p>  至少在Ubuntu Unity中使用的Gnome密钥无法读取新的RFC4716格式密钥，但报告成功，这是有bug的。更多详细信息请参见我的AskUbuntu问题与解答。我建议禁用SSH代理使用的Gnome密钥环，请改用普通的OpenSSH代理。</p><p>  Sorry, I&#39;m not using PuTTY, but make sure to upgrade first.This page suggests Ed25519 support since a late-2015 version according to a  wishlist item.Generally speaking, I&#39;m not too excited with the speed of implementation of security features in it.</p><p>  抱歉，我没有使用PuTTY，但请确保先进行升级。根据愿望清单的内容，此页面建议从2015年末版本开始支持Ed25519。通常来说，我对这样的速度不太满意实施安全功能。</p><p>  We&#39;ve taken some steps, important ones, but it&#39;s far from ultimate security.When dealing with high assurance environments I would strongly discourage key usage like described in this post as this holds the unencrypted private key in memory.Instead, use hardware security (smart cards) to avoid leaking keys even from memory dumps.It&#39;s not covered in this post, mainly because it requires a hardware device you need to buy and secondly because the limitations are device dependent.A nice cute solution would be to make use of your TPM already built-in your PC probably, but that would definitely deserve another post.</p><p>  我们已经采取了一些重要的步骤，但是离最终的安全性还很遥远。在处理高度安全的环境时，我会强烈反对像本文所述的那样使用密钥，因为这会在内存中保存未加密的私钥。相反，请使用硬件安全性（智能卡）来避免密钥甚至从内存转储中泄漏出来。本文未对此进行介绍，主要是因为它需要您购买的硬件设备，其次是因为限制取决于设备。一个不错的解决方案可能是利用您PC上已经内置的TPM，但这绝对值得您关注。</p><p>  I&#39;m planning on writing some more on how to harden SSH a bit more; custom host keys, custom DH moduli, strong ciphers (e.g.  chacha20-poly1305) and secure KeyExchange/MACs.For now this is a great resource already:  https://stribika.github.io/2015/01/04/secure-secure-shell.html</p><p>  我计划编写更多有关如何加强SSH的内容；自定义主机密钥，自定义DH模数，强密码（例如chacha20-poly1305）和安全的KeyExchange / MAC。目前，这已经是一个不错的资源：https://stribika.github.io/2015/01/04/secure-secure -shell.html</p><p>    🔑 Upgrade your SSH keys! (blog) Use Ed25519, about a transition and other tips &amp; tricks.  https://t.co/KDY2Ufh5FC</p><p>    🔑升级您的SSH密钥！ （博客）使用Ed25519，了解过渡和其他技巧＆amp;技巧。 https://t.co/KDY2Ufh5FC </p><p>— Gert van Dijk ⚠️ (@gertvdijk)  September 23, 2016</p><p>-Gert van Dijk⚠️（@gertvdijk）2016年9月23日 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.g3rt.nl/upgrade-your-ssh-keys.html">https://blog.g3rt.nl/upgrade-your-ssh-keys.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ssh/">#ssh</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/密钥/">#密钥</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>