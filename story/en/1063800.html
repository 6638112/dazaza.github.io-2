<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>-O3编译器优化级别仍然被视为Linux内核太不安全 -O3 Compiler Optimization Level Still Deemed Too Unsafe for the Linux Kernel</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">-O3 Compiler Optimization Level Still Deemed Too Unsafe for the Linux Kernel<br/>-O3编译器优化级别仍然被视为Linux内核太不安全 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-06 11:31:25</div><div class="page_narrow text-break page_content"><p>We Rely On Your Support: Did you know that the hundreds of articles written on Phoronix each month are mostly authored by one individual working insane hours? Phoronix.com doesn&#39;t have a whole news room with unlimited resources and relies upon people reading our content without blocking ads and alternatively by people  subscribing to Phoronix Premium for our ad-free service with other extra features. You can also consider  a tip via PayPal.   Due to not too old versions of the GNU Compiler Collection (GCC) possibly generating bad code with the &#34;-O3&#34; compiler optimization level and sometimes there not being performance benefits, Linus Torvalds remains against using this optimization flag when compiling the Linux kernel.   Sent in this week as part of the networking fixes for the Linux 5.13 kernel were  WireGuard fixes that among them dropped compiling the WireGuard module with the &#34;-O3&#34; C flag.   WireGuard lead developer Jason Donenfeld had been building WireGuard with the &#34;-O3&#34; optimization level since the project&#39;s inception and has studied the generated code in the past. While he hasn&#39;t witnessed cases of bad code being generated from the &#34;-O3&#34; usage, due to guidance from Linus Torvalds, he has dropped the option moving forward.   The &#34;-O3 in general is unsafe&#34; guidance from Torvalds stems from  this recent kernel thread where some developers had been discussing -O3 usage but passing as well &#34;-fnotree-loop-vectorize&#34; to workaround some versions of GCC possibly generating bad code at the higher optimization level.   In that recent email post Torvalds summed up his current -O3 perspective:  It has historically been horribly buggy. It&#39;s gotten better, but this case clearly shows that &#34;gotten better&#34; really isn&#39;t that high of a bar.   Very few projects use -O3, which is obviously part of why it&#39;s buggy. But the other part of why it&#39;s buggy is that vectorization is simply very complicated, and honestly, judging by the last report the gcc people don&#39;t care about being careful. They literally are ok with knowingly generating an off-by-one range check, because &#34;it&#39;s undefined behavior&#34;.   With that kind of mentality, I&#39;m not personally all that inclined to say &#34;sure, use -O3&#34;. We know it has bugs even for the well-defined cases.</p><p>我们依靠您的支持：您是否知道每个月在Phoronix上写的数百篇文章主要是由一个人疯狂时间的人撰写？ Phoronix.com并不是有一个全新的新闻室，拥有无限的资源，并依赖于阅读我们的内容的人们而不阻止广告，并且通过订阅Phoronix保费的人与其他额外功能。您还可以通过PayPal考虑提示。由于GNU编译器集合（GCC）不太古老的版本可能会使用＆＃34; -O3＆＃34生成坏码;编译器优化级别且有时在编译Linux内核时，Linus Torvalds仍然没有性能优势，Linus torvalds仍然反对使用此优化标志。   本周发送，作为Linux 5.13内核的网络修复的一部分是Wioguard修复，其中包括与＆＃34; -O3＆＃34编译Wioguard模块的编译。-O3＆＃34; C国旗。   Wioguard Lead Developer Jason Donenfeld曾与＆＃34; -O3＆＃34一起建造Wioguard;项目以来的优化水平＆＃39;初始化并研究了过去的生成代码。虽然他哈德＆＃39; t的证人是从＆＃34生成的坏代码; -o3＆＃34;用法，由于林万托尔瓦尔德的指导，他已经删除了前进的选项。   ＆＃34; -O3一般是不安全的＆＃34;来自Torvalds的指导源于这个最近的内核线程，其中一些开发人员一直在讨论-o3使用，而是通过＆＃34;  -  fnotree-loop-versive＆＃34;解决一些版本的GCC可能在更高的优化级别生成错误代码。   在最近的电子邮件帖子Torvalds总结了他的当前-O3的角度：  它在历史上一直是可怕的车辆。它＆＃39;已经变得更好，但这种情况清楚地表明＆＃34;已经更好地＆＃34;真的是＆＃39;这很高的酒吧。   很少有项目使用-o3，这显然是其中的一部分是它的＆＃39; s越野车。但是，为什么它的另一部分＆＃39; S越野车是矢量化是一种简单非常复杂，老实说，最后一份报告的GCC人们不在乎谨慎。他们真实地生成了一个越野检查，因为＆＃34;它＆＃39; s未定义行为＆＃34;   与那种心态，我没有个人所有倾向于说＆＃34;当然，使用-o3＆＃34;甚至在明确的案例中也知道它具有错误。</p><p>  So WireGuard&#39;s kernel module moving forward will not be built at -O3. LZ4 and Zstd remain the only other known users of kernel code being compiled with -O3.   Given the slow cadence of many vendors moving to new compiler versions and even longer before the kernel maintainers are comfortable dropping old compiler version support, it will likely be years before the Linux kernel finds it safe to use &#34;-O3&#34; by default -- short of version checking or just enabling it for Clang or other conditions deemed safe.</p><p>  因此，Wioguard＆＃39; ekel模块向前移动，不会在-o3处构建。 LZ4和ZSTD仍然是与-O3编译编译的内核代码的其他已知用户。   鉴于许多供应商慢慢转移到新的编译器版本甚至更长的内核维护者舒适丢弃旧编译版本支持，它可能是Linux内核发现它安全使用的历年＆＃34; -O3＆＃34;默认情况下 - 短缺版本检查或仅为Clang或其他条件启用安全性。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.phoronix.com/scan.php?page=news_item&px=No-O3-For-Linux-Kernel">https://www.phoronix.com/scan.php?page=news_item&px=No-O3-For-Linux-Kernel</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/编译/">#编译</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/compiler/">#compiler</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/内核/">#内核</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>