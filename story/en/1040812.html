<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>设置自己的Nextcloud实例以脱离Google Setting up your own Nextcloud instance to get off of Google</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Setting up your own Nextcloud instance to get off of Google<br/>设置自己的Nextcloud实例以脱离Google </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-20 06:56:58</div><div class="page_narrow text-break page_content"><p>One of my goals for 2020 was to stop using Google&#39;s products. There are a lot of reasons why, but that&#39;s not the point of this post. I found out about Nextcloud last month and it turns out it&#39;s a great replacement for a lot of Google. I don&#39;t actually use all of its features, but I&#39;ve migrated my calendar, reminders, contacts, bookmarks, video calls, photos, and news feeds and I&#39;m really happy with it so far.</p><p>我2020年的目标之一是停止使用Google产品。原因很多，但这不是本文的重点。我上个月发现了有关Nextcloud的信息，事实证明它是许多Google的理想替代品。我实际上并未使用它的所有功能，但是我已经迁移了日历，提醒，联系人，书签，视频通话，照片和新闻提要，到目前为止，我真的很满意。</p><p> There are a lot of companies that will host Nextcloud for you where you just sign up for an account like anything else, but in case you&#39;re interested in hosting Nextcloud for yourself this post is basically a brain dump of how I did it that. It took me a while to cobble together all the pieces I needed to get everything working from end to end, so I&#39;m hoping this might save someone else from having to do the same. If you know your way around servers and Nextcloud already you can just skim the headings like a checklist to make sure you don&#39;t forget an important step. But if you want a succinct overview of the actual steps I did and commands I ran, each section contains those details. By the end you&#39;ll see how I installed Nextcloud on my own server, secured it, set up backups, and set up external storage for my photos.</p><p> 有很多公司将为您托管Nextcloud，您只需像其他任何方式一样注册一个帐户，但是如果您有兴趣为自己托管Nextcloud，那么这篇文章基本上是我做事的脑筋那。我花了一些时间将所有所需的所有内容整理在一起，以使所有内容都能从头到尾工作，所以我希望这可以使其他人不必这样做。如果您已经知道绕过服务器和Nextcloud的方式，则可以像清单一样略过标题，以确保您不会忘记重要的一步。但是，如果您希望简要概述我执行的实际步骤和运行的命令，则每个部分都包含这些详细信息。到最后，您将看到我如何在自己的服务器上安装Nextcloud，对其进行保护，设置备份以及为照片设置外部存储。</p><p> Some parts are pieced together from other partial guides or longer blog posts, so where relevant the references lead to those sources. This post is more of a quick start with just the essential steps. Anything in  &lt;pointy-brackets&gt; is meant to be replaced. So the actual command I ran was e.g.  adduser kira, not  adduser &lt;name&gt;.</p><p> 有些部分是从其他部分指南或更长的博客文章中拼凑而成的，因此在相关的地方引用也指向那些来源。这篇文章只是一些基本步骤的快速入门。 ＆lt;尖括号＆gt;中的任何内容被替换。所以我实际运行的命令是adduser kira，而不是adduser＆lt; name＆gt;。</p><p>    Spin up a new server with your cloud provider. I use a &#34;nanode&#34;, the smallest server available from Linode, with 1GB of RAM and 25GB of storage, which is plenty more than  Nextcloud&#39;s minimum specs.</p><p>    与您的云提供商一起启动新服务器。我使用的是nanode，这是Linode提供的最小的服务器，具有1GB的RAM和25GB的存储空间，这比Nextcloud的最低规格要高得多。</p><p> Select an operating system that can install  snap packages. I&#39;m using Ubuntu 20.04 (LTS). Nextcloud recommends at least either Ubuntu 18.04 LTS or Red Hat Enterprise Linux 7.</p><p> 选择可以安装快照程序包的操作系统。我正在使用Ubuntu 20.04（LTS）。 Nextcloud建议至少使用Ubuntu 18.04 LTS或Red Hat Enterprise Linux 7。</p><p> Add your ssh key to the server. There should be a way to do this through the UI where you manage your new server.</p><p> 将ssh密钥添加到服务器。应该有一种方法可以通过管理新服务器的UI来完成。</p><p> 1.1 ssh into your server as the root user and make yourself a new sudo user that can also ssh into the machine   1</p><p> 1.1以root用户身份进入您的服务器，并让自己成为也可以进入计算机的新sudo用户1 </p><p>  Close this ssh session and log in as your new user to make sure it works:</p><p>关闭此ssh会话，然后以新用户身份登录以确保其正常工作：</p><p>  Leave this ssh session open. The rest of the commands below are meant to be run on your server, unless otherwise stated.</p><p>  将此ssh会话保持打开状态。除非另有说明，否则以下其余命令将在您的服务器上运行。</p><p>  There should be a way to do this in the admin section for your server. On Linode&#39;s there&#39;s a &#34;Domains&#34; section in the left admin menu. From there I clicked &#34;Add a Domain&#34; in the top right, then filled in the domain name, my email address, and selected &#34;Insert default records from one of my Linodes&#34; from the &#34;Insert Defaults Records&#34; dropdown, then I selected my new Nextcloud server from the list of Linodes. The steps might be slightly different depending what cloud server provider you&#39;re using. By the end you need DNS records pointing your domain name to your Nextcloud server. If you did this through Linode (or whatever you&#39;re using), you&#39;ll also need to update the nameservers with your domain registar.</p><p>  应该在您的服务器的“管理”部分中提供一种方法。在Linode上有一个＆＃34; Domains＆＃34;管理员菜单的左侧部分。在这里，我单击了“添加域”。在右上角，然后填写域名，我的电子邮件地址，并选择＆＃34;从我的Linodes中插入默认记录＆＃34;从＆＃34;插入默认值记录＆＃34;中下拉菜单，然后从Linodes列表中选择了新的Nextcloud服务器。步骤可能会略有不同，具体取决于您所使用的云服务器提供商。最后，您需要将您的域名指向您的Nextcloud服务器的DNS记录。如果您是通过Linode（或您使用的任何方式）完成此操作的，则还需要使用您的域registar更新名称服务器。</p><p>     5. Set up your domain, enable https, and install an auto-updating certificate from lets encrypt</p><p>     5.设置您的域，启用https，并从let加密安装自动更新证书</p><p>   Log in to your new personal cloud at the domain you configured using the username and password you chose above and install the 2FA app Click on your initial in the top right corner of the Nextcloud dashboard and select &#34;Apps&#34;</p><p>   使用上面选择的用户名和密码登录到您配置的域中的新个人云，然后安装2FA应用。单击Nextcloud仪表板右上角的首字母，然后选择＆＃34; Apps＆＃34;。</p><p> In the left side bar click on &#34;Security&#34;, then search for the &#34;Two-Factor TOTP Provider&#34; app</p><p> 在左侧栏中，点击＆＃34; Security＆＃34 ;，然后搜索“两因素TOTP提供商”。应用程式</p><p> Set up 2FA with this newly installed app In the left sidebar, click on &#34;Security&#34; (in the &#34;Personal&#34; section) then check the &#34;Enable TOTP&#34; box and follow the instructions to set up 2FA</p><p> 使用此新安装的应用程序设置2FA在左侧栏中，点击＆＃34; Security＆＃34; （在“个人”部分中），然后选中“启用TOTP”。框并按照说明设置2FA </p><p> I managed to forget my password in the time between installing Nextcloud and trying to log in for the first time. If that happens to you, you can reset it by running  sudo nextcloud.occ user:resetpassword &lt;username&gt;.</p><p>在安装Nextcloud和尝试首次登录之间，我设法忘记了密码。如果您遇到这种情况，可以通过运行sudo nextcloud.occ user：resetpassword＆lt; username＆gt;来重置它。</p><p>     Enable backups for your whole server for a first layer of backups. I did this when I was setting up my Linode (there was a checkbox in the &#34;Optional Add-ons&#34; section for it). Otherwise there&#39;s a &#34;Backups&#34; tab in the admin section where you can turn them on. Linode charges $2/months for this.</p><p>     为第一层备份启用整个服务器的备份。我在设置Linode时执行了此操作（“可选附件”部分中有一个复选框）。否则，将有一个备份。标签在“管理”部分中，您可以在其中打开它们。 Linode为此收取2美元/月。</p><p>  Get the backblaze cli and configure it Copy the key secret from the app key you just made to authorize the Backblaze cli</p><p>  获取Backblaze cli并进行配置从您刚创建的用于授权Backblaze cli的应用程序密钥中复制密钥秘密</p><p> Create a new user to run the backups and disable password access for it, for security   2</p><p> 为了安全起见，创建一个新用户来运行备份并禁用其密码访问2</p><p>  sudo vim /usr/sbin/ncbackup.sh and copy the contents of the backup script below into your new file, or write your own that accomplishes the same things:  ***</p><p>  sudo vim /usr/sbin/ncbackup.sh并将以下备份脚本的内容复制到新文件中，或者编写自己的文件来完成相同的工作：***</p><p> #!/bin/bashset -eDATE=$(date &#39;+%Y-%m-%d&#39;)# Output to a logfileexec &amp;&gt; /home/ncbackup/backups/logs/${DATE}.txt# Export all your config and data from Nextcloudecho &#34;Starting Nextcloud export...&#34;nextcloud.exportecho &#34;Export complete&#34;# Compress backed up folderecho &#34;Compressing backup...&#34;tar -zcf /home/ncbackup/backups/${DATE}.tar.gz -C /var/snap/nextcloud/common/backups/ .echo &#34;Nextcloud backup successfully compressed to /home/ncbackup/backups&#34;# Remove uncompressed backup datarm -rf /var/snap/nextcloud/common/backups/*# Remove backups and logs older than 5 daysecho &#34;Removing backups older than 5 days...&#34;find /home/ncbackup/backups -type f -mtime +5 -deletefind /home/ncbackup/backups/logs -type f -mtime +5 -delete# Keep 14 days of backups in backblazeecho &#34;Uploading to backblaze...&#34;b2 sync --keepDays 14 --replaceNewer /home/ncbackup/backups b2://&lt;your-bucket-name&gt;echo &#34;Nextcloud backup completed successfully&#34;</p><p> ＃！/ bin / bashset -eDATE = $（date＆＃39; +％Y-％m-％d＆＃39;）＃输出到logfileexec＆amp; /home/ncbackup/backups/logs/${DATE}.txt#从Nextcloudecho导出所有配置和数据＆＃34;开始Nextcloud导出...＆＃34; nextcloud.exportecho＆＃34;导出完成＆＃34; ＃压缩备份的文件夹echo＆＃34; Compressing backup ...＆＃34; tar -zcf /home/ncbackup/backups/${DATE}.tar.gz -C / var / snap / nextcloud / common / backups /。回声＆＃34; Nextcloud备份成功压缩到/ home / ncbackup / backups＆＃34;＃删除未压缩的备份数据rm -rf / var / snap / nextcloud / common / backups / *＃删除5天以上的备份和日志回声＆＃34 ;删除5天之前的备份...＆＃34;查找/ home / ncbackup / backups -type f -mtime +5 -deletefind / home / ncbackup / backups / logs -type f -mtime +5 -delete＃保留14 backblazeecho中的备份天数＆＃34;正在上传到backblaze ... b2同步--keepDays 14 --replaceNewer / home / ncbackup / backups b2：//＆lt; your-bucket-name＆gt; echo＆＃34 ; Nextcloud备份成功完成＆＃34;</p><p>        0 2 * * * sudo /usr/sbin/ncbackup.sh &amp;&amp; curl -fsS -m 10 --retry 5 -o /dev/null &lt;your-ping-url&gt;</p><p>        0 2 * * * sudo /usr/sbin/ncbackup.sh＆amp;＆amp; curl -fsS -m 10-重试5 -o / dev / null＆lt; your-ping-url＆gt; </p><p> This will run your backups once per day at 2am (in your server&#39;s timezone, probably UTC), but you can set whatever time and frequency you want, just remember to update your healthcheck to match.</p><p>这将每天凌晨2点（在服务器所在的时区，可能是UTC）运行一次备份，但是您可以设置所需的任何时间和频率，只记得更新健康检查以使其匹配。</p><p>  Backups are only useful if you can use them to restore your data. Make sure yours work before you need them.</p><p>  备份仅在可以使用它们还原数据时才有用。确保需要您的工作。</p><p> To test your entire server backups you can just try restoring the whole server using Linode&#39;s (or whoever&#39;s) UI. Testing the archived backups we uploaded to backblaze is a little more involved but you&#39;ll be glad you know how to do it when you need it.</p><p> 要测试整个服务器的备份，您可以尝试使用Linode（或任何人）UI还原整个服务器。测试我们上传到Backblaze的存档备份要花些时间，但是您很高兴知道自己在需要时如何做。</p><p> Repeat steps 1-5, except you can just update the records for your domain that&#39;s already set up to point to your new server&#39;s IP address(es).</p><p> 重复步骤1-5，除了您可以只更新已经设置为指向新服务器IP地址的域的记录。</p><p>  Copy the backup onto your new server. Run this in a terminal on your machine (not in an ssh session with a remote server):</p><p>  将备份复制到新服务器上。在计算机的终端中运行此命令（而不是在与远程服务器的ssh会话中）：</p><p>  Unzip, rename, and move the backup to a place where the Nextcloud snap installation will be able to access it, then make the root user the owner</p><p>  将备份解压缩，重命名，然后将其移动到Nextcloud快照安装将能够访问它的位置，然后将root用户设为所有者</p><p> This should be all you need to restore your Nextcloud installation. It might take a while for the DNS records to propagate, so if you want to test that your restored cloud is working in the meantime you can check it directly at its IP address if you add that to the list of trusted domains:</p><p> 这应该是还原Nextcloud安装所需的全部。 DNS记录可能需要一段时间才能传播，因此，如果您要测试还原的云是否正在正常运行，如果将其添加到受信任域列表中，则可以直接在其IP地址处对其进行检查： </p><p>  Note this will only be available over http, so you might get a dramatic warning about security when you visit the ip address directly. To remove the ip address from the list of trusted domains once you&#39;re satisfied, run:</p><p>请注意，这仅可通过http使用，因此当您直接访问ip地址时，可能会收到关于安全性的强烈警告。要在满意的情况下从受信任域的列表中删除IP地址，请运行：</p><p>   It&#39;s not going to be clear exactly what the environmental impact of your server is, but it won&#39;t be nothing. You can get a rough idea how much CO 2 your server emits with tools like  this one. Then you can buy carbon offsets from a reputable carbon offset vendor, like  Less. I spent $10/year to offset half a tonne of CO 2.</p><p>   尚不清楚服务器对环境的影响到底是什么，但不会一无是处。您可以大致了解使用此类工具将服务器释放多少CO 2。然后，您可以从著名的碳补偿供应商那里购买碳补偿，例如Less。我每年花费$ 10来抵消半吨的CO 2。</p><p> I know carbon offsetting is a  long and complicated topic, and the environmental impact of computing infrastructure goes way beyond CO 2 emissions, but the point is just to be aware that doing all this stuff on your computer has potentially negative consequences in the real world and to at least try to minimize them where you can and mitigate them where you can&#39;t.</p><p> 我知道碳补偿是一个漫长而复杂的话题，计算基础架构对环境的影响已经远远超过了CO 2排放，但要注意的是，在计算机上进行所有这些操作可能会对现实世界和环境产生负面影响。至少尝试在可能的地方尽量减少它们，并在可能的地方减少它们。</p><p>   Go to &#34;Settings&#34; then, under &#34;Administration&#34; in the left side bar ( not under &#34;Personal&#34;), click &#34;External storages&#34;</p><p>   转到＆＃34;设置＆＃34;然后，在“管理”下在左侧栏中（不在“个人”下），单击“外部存储”。</p><p> Enter a name for your new folder * and select &#34;Amazon S3&#34; from the &#34;Add storage&#34; dropdown, then fill in the details for your Backblaze bucket and account</p><p> 输入新文件夹的名称*，然后选择＆＃34; Amazon S3＆＃34;从＆＃34;添加存储空间＆＃34;下拉菜单，然后填写您的Backblaze存储桶和帐户的详细信息</p><p>   If you choose the cheapest Linode server like I did it doesn&#39;t come with much storage, and depending on how much data you have and how many backups you&#39;re leaving on the server you might run it out of storage pretty quickly. There&#39;s an app called &#34;Quota warning&#34; in the monitoring category you can install to get notified if you&#39;re approaching your server&#39;s storage limits. You can configure when and how it notifies you in &#34;Additional settings&#34; after it&#39;s installed.</p><p>   如果您像我一样选择最便宜的Linode服务器，它并没有太多存储空间，并且取决于您拥有多少数据以及要在服务器上保留多少备份，您可能会耗尽存储空间很快。有一个名为“配额警告”的应用程序在监控类别中，如果您接近服务器的存储限制，则可以进行安装以获取通知。您可以在＆＃34;其他设置＆＃34;中配置通知您的时间和方式。安装之后。</p><p>  That&#39;s it! I hope this helps someone avoid hours of searching through documentation, blog posts, and outdated forums. Good luck!</p><p>  就是这样！我希望这可以帮助某人避免花费大量时间搜索文档，博客文章和过时的论坛。祝好运！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://kiramclean.com/blog/how-to-set-up-your-own-nextcloud-server/">https://kiramclean.com/blog/how-to-set-up-your-own-nextcloud-server/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/nextcloud/">#nextcloud</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/服务器/">#服务器</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>