<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Slashdot问：你对Btrfs有什么感觉？</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Slashdot问：你对Btrfs有什么感觉？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-25 07:36:38</div><div class="page_narrow text-break page_content"><p>The btrfs filesystem has taunted the Linux community for years, offering a stunning array of features and capability, but never earning universal acclaim. Btrfs is perhaps more deserving of patience, as its promised capabilities dwarf all peers, earning it vocal proponents with great influence. Still, none can argue that btrfs is unfinished, many features are very new, and stability concerns remain for common functions.</p><p>多年来，btrfs文件系统一直在嘲弄Linux社区，它提供了一系列令人惊叹的特性和功能，但从未赢得普遍赞誉。Btrfs可能更值得耐心，因为它承诺的能力让所有同行相形见绌，为它赢得了具有巨大影响力的直言不讳的支持者。尽管如此，没有人能否认btrfs尚未完成，许多特性非常新，常见功能的稳定性问题依然存在。</p><p> Most of the intended goals of btrfs  have been met. However, Red Hat  famously cut continued btrfs support from their 7.4 release, and has allowed the code to stagnate in their backported kernel since that time. The Fedora project  announced their intention to adopt btrfs as the default filesystem for variants of their distribution, in a seeming juxtaposition. SUSE has  maintained btrfs support for their own distribution and the greater community for many years.</p><p>“贸易自由贸易框架”的大部分预期目标已经实现。然而，众所周知，RedHat从7.4版中切断了对持续btrf的支持，并允许代码在此后的后端口内核中停滞不前。Fedora项目宣布他们打算采用btrfs作为其发行版变体的默认文件系统，这似乎是并列的。多年来，SUSE一直为自己的发行版和更大的社区维护btrf支持。</p><p> For users, the most desirable features of btrfs are transparent compression and snapshots; these features are stable, and relatively easy to add as a veneer to stock CentOS (and its peers). Administrators are further compelled by adjustable checksums, scrubs, and the ability to enlarge as well as (surprisingly) shrink filesystem images, while some advanced btrfs topics (i.e. deduplication, RAID, ext4 conversion) aren&#39;t really germane for minimal loopback usage. The systemd init package also has dependencies upon btrfs, among them   machinectl and   systemd-nspawn. Despite these features, there are many usage patterns that are not directly appropriate for use with btrfs. It is  hostile to most databases and many other programs with incompatible I/O, and should be approached with some care.</p><p>对于用户来说，btrf最理想的特性是透明压缩和快照；这些特性很稳定，并且相对容易作为单板添加到库存CentOS(及其同行)中。管理员还被可调整的校验和、擦除以及放大和(令人惊讶地)缩小文件系统映像的能力所驱使，而一些高级btrfs主题(即重复数据删除、RAID、ext4转换)实际上与最少的环回使用无关。Systemd init包也依赖于btrf，其中包括machinectl和systemd-nspawn。尽管有这些功能，但仍有许多使用模式不直接适合与btrf一起使用。它对大多数数据库和许多具有不兼容I/O的其他程序都是有害的，应该谨慎对待。</p><p> The two most accessible providers of CentOS-compatible btrfs-enabled kernels are the El Repo Mainline, and the Oracle Unbreakable Enterprise Kernel (UEK), but there are significant provisos on support and features with each of these options. Oracle&#39;s kernel does not implement the latest standards for btrfs checksums which enforce filesystem integrity, and there are other organizational issues from a CentOS perspective where Oracle has fallen down. The El Repo Mainline has the latest features, but the use of it is discouraged and it is not supported. Current Fedora kernels also appear to work on CentOS 8, but these installations are more invasive in removing stock kernel components. Users will face  Hobson&#39;s choice depending upon their need for advanced features or commercial support.</p><p>支持CentOS兼容btrfs的内核的两个最易访问的提供商是El Repo Mainline和Oracle UnBreak Enterprise Kernel(UEK)，但是每个选项在支持和功能方面都有重要的附带条件。Oracle的内核没有实现强制文件系统完整性的btrfs校验和的最新标准，而且从CentOS的角度来看，还有其他组织问题，Oracle已经失败。El Repo主线具有最新功能，但不鼓励使用它，也不支持它。目前的Fedora内核似乎也可以在CentOS8上运行，但这些安装在删除现有内核组件方面更具侵入性。用户将面临霍布森的选择，这取决于他们对高级功能或商业支持的需求。</p><p> Still, with a capable kernel, these features can be easily enabled on any CentOS, RedHat, or Oracle Linux OS via a loopback mount (at some performance penalty) when running on a default XFS host filesystem. In cases where these features are indispensable, they can prevent a migration to Solaris, FreeBSD, or even SUSE where advanced storage features are more commonplace.</p><p>不过，使用功能强大的内核，当在默认的XFS主机文件系统上运行时，可以通过环回挂载在任何CentOS、RedHat或Oracle Linux OS上轻松启用这些特性(但会降低一些性能)。在这些功能必不可少的情况下，它们可以阻止迁移到高级存储功能更为常见的Solaris、FreeBSD甚至SuSE。</p><p> I will make some reference here to my past article on  ZFS for Linux, to clarify and translate nomenclature between these two popular filesystems. It is not necessary to understand ZFS to grasp this discussion of btrfs, but the contrast can be helpful.</p><p>在这里，我将引用我上一篇关于ZFS for Linux的文章，以澄清和翻译这两个流行文件系统之间的术语。要理解btrf的讨论，不需要了解ZFS，但是对比会很有帮助。</p><p>  The two providers of btrfs-enabled kernels that are most compatible with a CentOS installation offer a very different experience with support and features. The installation of both kernels for evaluation is likely the most convenient, and the  Send/Receive section below assumes that their features are both present.</p><p>与CentOS安装最兼容的两个支持btrfs的内核提供商在支持和功能方面提供了截然不同的体验。安装用于评估的两个内核可能是最方便的，下面的发送/接收部分假设它们的特性都存在。</p><p> CentOS 7 did support native btrfs as a custom option in the OS installer (as a &#34;technology preview&#34;), but this was removed from the CentOS 8 installer, so it won&#39;t be conered here. CentOS 8 is used for all examples presented; CentOS 7 users should likely prefer the UEK.</p><p>CentOS 7确实支持将本机btrfs作为操作系统安装程序中的自定义选项(作为技术预览)，但该选项已从CentOS 8安装程序中删除，因此不会在此提及。CentOS8用于所有示例；CentOS7用户可能更喜欢UEK。</p><p> To install the Oracle UEK, add the following file as  /etc/yum.repos.d/uek-olx.repo (for CentOS 7, change the &#34;ol8/OL8&#34; to &#34;ol7/OL7&#34;):</p><p>要安装Oracle UEK，请将以下文件添加为/etc/yum.repos.d/uek-olx.repo(对于CentOS 7，将&#34；OL8/OL8&#34；更改为&#34；OL7/OL7&#34；)：</p><p>  Load the GPG key for the relevant repo, as (somewhat incorrectly)  described in Oracle&#39;s instructions:</p><p>加载相关回购的GPG密钥，如Oracle的说明中所述(有些不正确)：</p><p>  For an automated install of the UEK, execute the following (leave out the  devel package if you don&#39;t have a C compiler):</p><p>要自动安装UEK，请执行以下命令(如果没有C编译器，请省略devel包)：</p><p>  I have added the options  --disablerepo=AppStream,  --disablerepo=BaseOS, and  --disablerepo=extras to coerce  dnf to work through a restrictive firewall, pulling only from Oracle&#39;s repository:</p><p>我添加了选项--disablerepo=AppStream、--disablerepo=BaseOS和--disablerepo=Extras，以强制DNF穿过受限的防火墙，仅从Oracle的存储库中提取：</p><p>   Last metadata expiration check: 0:04:38 ago on Tue 15 Sep 2020 11:43:34 AM CDT.Dependencies resolved.================================================================================ Package Arch Version Repo Size================================================================================Installing: btrfs-progs x86_64 5.4.0-1.el8 ol8_UEKR6 869 k btrfs-progs-devel x86_64 5.4.0-1.el8 ol8_UEKR6 52 k kernel-uek x86_64 5.4.17-2011.6.2.el8uek ol8_UEKR6 60 MUpgrading: linux-firmware noarch 999:20200124-999.4.git1eb2408c.el8 ol8_UEKR6 100 MTransaction Summary================================================================================Install 3 PackagesUpgrade 1 PackageTotal download size: 161 MIs this ok [y/N]: yDownloading Packages:(1/4): btrfs-progs-devel-5.4.0-1.el8.x86_64.rpm 21 kB/s | 52 kB 00:02 (2/4): btrfs-progs-5.4.0-1.el8.x86_64.rpm 225 kB/s | 869 kB 00:03 (3/4): kernel-uek-5.4.17-2011.6.2.el8uek.x86_64 2.1 MB/s | 60 MB 00:29 (4/4): linux-firmware-20200124-999.4.git1eb2408 1.1 MB/s | 100 MB 01:27 --------------------------------------------------------------------------------Total 1.8 MB/s | 161 MB 01:30Latest Unbreakable Enterprise Kernel Release 6 3.0 MB/s | 3.1 kB 00:00 Importing GPG key 0xAD986DA3: Userid : &#34;Oracle OSS group (Open Source Software group) &#34; Fingerprint: 76FD 3DB1 3AB6 7410 B89D B10E 8256 2EA9 AD98 6DA3 From : /etc/pki/rpm-gpg/RPM-GPG-KEY-oracleIs this ok [y/N]: yKey imported successfullyRunning transaction checkTransaction check succeeded.Running transaction testTransaction test succeeded.Running transaction Preparing : 1/1 Upgrading : linux-firmware-999:20200124-999.4.git1eb2408c.el8.no 1/5 Installing : btrfs-progs-5.4.0-1.el8.x86_64 2/5 Installing : btrfs-progs-devel-5.4.0-1.el8.x86_64 3/5 Running scriptlet: kernel-uek-5.4.17-2011.6.2.el8uek.x86_64 4/5 Installing : kernel-uek-5.4.17-2011.6.2.el8uek.x86_64 4/5 Running scriptlet: kernel-uek-5.4.17-2011.6.2.el8uek.x86_64 4/5 Cleanup : linux-firmware-20191202-97.gite8a0f4c9.el8.noarch 5/5 Running scriptlet: kernel-uek-5.4.17-2011.6.2.el8uek.x86_64 5/5 Running scriptlet: linux-firmware-20191202-97.gite8a0f4c9.el8.noarch 5/5 Verifying : btrfs-progs-5.4.0-1.el8.x86_64 1/5 Verifying : btrfs-progs-devel-5.4.0-1.el8.x86_64 2/5 Verifying : kernel-uek-5.4.17-2011.6.2.el8uek.x86_64 3/5 Verifying : linux-firmware-999:20200124-999.4.git1eb2408c.el8.no 4/5 Verifying : linux-firmware-20191202-97.gite8a0f4c9.el8.noarch 5/5 Installed products updated.Upgraded: linux-firmware-999:20200124-999.4.git1eb2408c.el8.noarch Installed: btrfs-progs-5.4.0-1.el8.x86_64 btrfs-progs-devel-5.4.0-1.el8.x86_64 kernel-uek-5.4.17-2011.6.2.el8uek.x86_64Complete!</p><p>上次元数据到期检查：0：04：38之前，于2020年9月15日星期二11：43：34 AM CDT。依赖项resolved.====包架构版本回溯Size====Installing：btrfs-progs x86_64 5.4.0-1.el8 OL8_UEKR6 869 k btrfs-progs-devel x86_64 5.4.0-1.el8 OL8_UEKR6 52 k kernel-uek x86_64 5.4.17-2011.6.2.el8uek OL8_UEKR6 60 M升级：linux-Firmware noArch 999：20200124-999.4.git1eb2408elc.8。MTransaction Summary====Install 3包升级1级包总下载大小：161mis this ok[y/N]：y下载包：(1/4)：btrfs-progs-devel-5.4.0-1.el8.x86_64.rpm 21 kB/s|52 kB 00：02(2/4)：btrfs-progs-5.4.0-1.el8.x86_64.rpm 225 kB/s|869 kB 00：03(3/4)：kernel-uek-5.4.17-2011.6.2.el8uek.x86_。642.1MB/s|60MB 00：29(4/4)：linux-固件-20200124-999.4.git1eb24081.1MB/s|100MB 01：27--。--总计1.8 MB/s|161 MB 01：30最新UnBreak Enterprise Kernel Release 6 3.0 MB/s|3.1 kB 00：00导入GPG密钥0xAD986DA3：userid：&#34；Oracle OSS集团(开源软件集团)&#34；指纹：76FD 3DB1 3AB6 7410 B89D B10E 8256 2ea9 ad98 6DA3来自：/etc/pki/rpm-gpg/rpm-gpg-key-oracle这是否正常[y/N]：y密钥导入成功运行事务检查事务检查成功。运行事务测试事务测试成功。运行事务准备：1/1升级：linux-firmware-999:20200124-999.4.git1eb2408c.el8.no 1/5安装：btrfs-progs-5.4.0-1.el8.x86_64 2/5安装：btrfs-progs-devel-5.4.0-1。El8.x86_64 3/5运行脚本小程序：内核-uek-5.4.17-2011.6.2.el8uek.x86_64 4/5安装：内核-uek-5.4.17-2011.6.2.el8uek.x86_64 4/5运行脚本：内核-uek-5.4.17-2011.6.2.el8uek.x86_64 4/5清理：内核5/5运行脚本：linux-firmware-20191202-97.gite8a0f4c9.el8.noarch-uek-5.4.17-2011。.6.2.el8uek.x86_64 5/5运行脚本小程序：内核5/5验证：btrfs-progs-5.4.0-1.el8.x86_64 1/5验证：btrfs-progs-devel-5.4.0-1.el8.x86_64 2/5验证：linux-firmware-20191202-97.gite8a0f4c9.el8.noarch-uek-5.4.17-2011.6.2.el8uek.x86_64 3/5验证：linux-firmware-999:20200124-999.4.git1eb2408c.。El8.no 4/5验证：linux-firmware-20191202-97.gite8a0f4c9.el8.noarch 5/5安装的产品已更新。升级：安装的linux-firmware-999:20200124-999.4.git1eb2408c.el8.noarch：btrfs-progs-5.4.0-1.el8.x86_64 btrfs-progs-devel-5.4.0-1.el8.x86_64 kernel-uek-5.4.17-2011.6.2.el8uek.x86_64Complete！</p><p> For a manual install, pull the latest UEK and associated RPMs from the repository directly:</p><p>对于手动安装，请直接从存储库中提取最新的UEK和关联的RPM：</p><p>  After installation, the UEK will configure itself as the default boot kernel. Notice also that a new firmware package is installed in the  dnf session above (be prepared to downgrade it back to the CentOS version if the UEK is uninstalled).</p><p>安装后，UEK将自身配置为默认引导内核。另请注意，上面的DNF会话中安装了一个新的固件软件包(如果卸载UEK，请准备将其降级回CentOS版本)。</p><p> There are two major problems with the UEK, both in general and from the CentOS perspective.</p><p>UEK有两个主要问题，总体上和从CentOS的角度来看都是如此。</p><p> First, the Oracle UEKR6 is (currently) too old to use the latest checksum features of btrfs (explained in the next section).</p><p>首先，Oracle UEKR6(当前)太旧，无法使用btrf的最新校验和特性(将在下一节进行说明)。</p><p> Second, paid support is available for the UEK on CentOS, but  only after a conversion of the entire system to Oracle Linux. Loading the UEK does not trigger this conversion. Furthermore, the conversion process appears broken for Centos 8. When attempting to run the  centos2ol.sh converter script, it halts with an error that python2 is required. After installing python2 from AppStream, the script fails with the message: &#34;You appear to be running an unsupported distribution. For assistance, please email &lt; ksplice-support_ww@oracle.com&gt;.&#34; Examining the script, only CentOS versions 5, 6, and 7 are allowed, and the lack of CentOS 8 support is also hinted on Oracle&#39;s website (&#34; centos2ol.sh can convert your CentOS 6 and 7 systems to Oracle Linux&#34;). As the CentOS 8 platform has been available for over a year, Oracle&#39;s script appears to be badly out of date. It is questionable if Oracle supports the CentOS 8 platform at all.</p><p>其次，在CentOS上为UEK提供付费支持，但仅在将整个系统转换到Oracle Linux之后。加载UEK不会触发此转换。此外，CentOS 8的转换过程似乎已中断。当尝试运行centos2ol.sh转换器脚本时，它会停止，并显示需要python2的错误。从AppStream安装python2后，脚本失败，并显示消息：&#34；您似乎正在运行不受支持的分发版本。如需帮助，请通过电子邮件向&lt；kSplice-Support_ww@Oracle.com&gt；发送电子邮件。&#34；检查脚本时，只允许使用CentOS版本5、6和7，Oracle网站上还提示您不支持CentOS 8(&#34；centos2ol.sh可以将您的CentOS 6和7系统转换为Oracle Linux)。由于CentOS8平台已经推出一年多了，甲骨文的脚本似乎已经严重过时了。甲骨文是否完全支持CentOS 8平台是值得怀疑的。</p><p> The El Repo project  previously maintained a historic archive of the final Red Hat backported btrfs source. While this idled version was never released from testing and has been removed, the latest btrfs kernel modules are available elsewhere in their packages.</p><p>El Repo项目之前维护了最终的Red Hat后端btrfs源代码的历史档案。虽然这个空闲版本从未从测试中发布，并且已经被移除，但是最新的btrfs内核模块可以在它们的软件包中的其他地方获得。</p><p> El Repo refers to their Mainline as the &#34;kernel of  last resort&#34; which is usually a developer tool for backporting hardware drivers. It happens to contain btrfs modules with the latest features, which will work perfectly with all the functionality presented here. To load it, obtain and install the following files from the El Repo  Mainline Repository (or install the entry for the yum repository itself):</p><p>El Repo将它们的主线称为最后的内核，它通常是用于向后移植硬件驱动程序的开发工具。它恰好包含具有最新功能的btrfs模块，这些模块将与这里提供的所有功能完美地配合使用。要加载它，请从El Repo Mainline存储库获取并安装以下文件(或安装yum存储库本身的条目)：</p><p>   Verifying... ################################# [100%]Preparing... ################################# [100%]Updating / installing... 1:kernel-ml-core-5.8.5-1.el8.elrepo################################# [ 33%] 2:kernel-ml-modules-5.8.5-1.el8.elr################################# [ 67%] 3:kernel-ml-5.8.5-1.el8.elrepo ################################# [100%]</p><p>验证.。#[100%]正在准备...。#[100%]正在更新/安装...。1:kernel-ml-core-5.8.5-1.el8.elrepo##[33%]内核[67%]3：2:kernel-ml-modules-5.8.5-1.el8.elr##-ml-。5.8.5-1.el8.elrepo#[100%]。</p><p> When complete, reboot, and a new Red Hat kernel (mentioning Oopta) should appear in the Grub menu. El Repo Mainline kernel users who opt to omit the UEK should likely load Oracle&#39;s  btrfs-progs, as this will allow userspace maintenance.</p><p>完成后，重新启动，一个新的Red Hat内核(提到Oopta)应该出现在GRUB菜单中。选择省略UEK的El Repo主线内核用户应该加载Oracle的btrfs-progs，因为这将允许用户空间维护。</p><p> The Fedora  kernel listed below appears to be functional on CentOS, but Fedora components should be installed with much greater care, as they can remove stock kernel packages that are provided by CentOS (both Mainline and the UEK leave the stock kernel intact) when installed in upgrade mode. The use of a Fedora yum repository is likely not safe in this context.</p><p>下面列出的Fedora内核似乎可以在CentOS上运行，但安装Fedora组件时应该格外小心，因为在升级模式下安装时，它们可能会删除CentOS提供的常用内核软件包(主线和UEK都会保留常用内核)。在这种情况下，使用Fedora yum存储库可能不安全。</p><p>   Verifying... ################################# [100%]Preparing... ################################# [100%]Updating / installing... 1:kernel-core-5.9.0-0.rc8.20201007g################################# [ 17%] 2:kernel-modules-5.9.0-0.rc8.202010################################# [ 33%] 3:kernel-5.9.0-0.rc8.20201007git757################################# [ 50%]Cleaning up / removing... 4:kernel-4.18.0-193.el8 ################################# [ 67%] 5:kernel-modules-4.18.0-193.el8 ################################# [ 83%] 6:kernel-core-4.18.0-193.el8 ################################# [100%]kernel-5.9.0-0.rc8.20201007git7575fdda569b.30.fc34.x86_64kernel-core-5.9.0-0.rc8.20201007git7575fdda569b.30.fc34.x86_64kernel-ml-5.8.5-1.el8.elrepo.x86_64kernel-ml-core-5.8.5-1.el8.elrepo.x86_64kernel-ml-modules-5.8.5-1.el8.elrepo.x86_64kernel-modules-5.9.0-0.rc8.20201007git7575fdda569b.30.fc34.x86_64kernel-tools-4.18.0-193.el8.x86_64kernel-tools-libs-4.18.0-193.el8.x86_64kernel-uek-5.4.17-2011.6.2.el8uek.x86_64</p><p>验证.。#[100%]正在准备...。#[100%]正在更新/安装...。1:kernel-core-5.9.0-0.rc8.20201007g##[17%]2:kernel-modules-5.9.0-0.rc8.202010##[33%]3：内核-5.9.0-。0.rc8.20201007git757##[50%]正在清理/删除...。4：kernel-4.18.0-193.el8#5：kernel-module-4.18.0-193.el8#。#[100%]kernel-5.9.0-0.rc8.20201007git7575fdda569b.30.fc34.x86_64kernel-core-5.9.0-0.rc8.20201007git7575fdda569b.30.fc34.x86_64kernel-ml-5.8.5-1.el8.elrepo.x86_64kernel-ml-core-5.8.5-1.el8.elrepo.x86_64kernel-ml。-modules-5.8.5-1.el8.elrepo.x86_64kernel-modules-5.9.0-0.rc8.20201007git7575fdda569b.30.fc34.x86_64kernel-tools-4.18.0-193.el8.x86_64kernel-tools-libs-4.18.0-193.el8.x86_64kernel-uek-5.4.17-2011.6.2.el8uek.x86_64</p><p> A  btrfs-progs package can also be found in Fedora, and it likewise wipes Oracle&#39;s packages if they are present.</p><p>在Fedora中也可以找到btrfs-progs包，如果甲骨文的包存在，它同样会清除它们。</p><p>   Verifying... ################################# [100%]Preparing... ################################# [100%]Updating / installing... 1:libbtrfsutil-5.7-4.fc33 ################################# [ 17%] 2:libbtrfs-5.7-4.fc33 ################################# [ 33%] 3:btrfs-progs-5.7-4.fc33 ################################# [ 50%] 4:btrfs-progs-devel-5.7-4.fc33 ################################# [ 67%]Cleaning up / removing... 5:btrfs-progs-devel-5.4.0-1.el8 ################################# [ 83%] 6:btrfs-progs-5.4.0-1.el8 ################################# [100%]</p><p>验证.。#[100%]正在准备...。#[100%]正在更新/安装...。1：libbtrfsutil-5.7-4.fc33#2：libbtrfs-5.7-4.fc33#。#4：btrfs-progs-devel-5.7-4.fc33#。5：btrfs-progs-devel-5.4.0-1.el8#6：btrfs-progs-5.4.0-1.el8#。</p><p> The problem with the El Repo Mainline is the lack of support, edging on active discouragement of its use. Fedora is likely an &#34;even more last resort&#34; as it can remove CentOS kernel packages unless installed with great care. The latest  SUSE kernel might also be of interest, but this is not intended for CentOS, and has not been attempted here. Building a custom kernel might provide the best results, at the cost of any and all support.</p><p>El Repo主线的问题是缺乏支持，正在积极劝阻其使用。Feddora很可能是一个更不得已的选择，因为除非非常小心地安装，否则它可以删除CentOS内核软件包。最新的SUSE内核可能也会让人感兴趣，但这不是针对CentOS的，这里也没有尝试过。构建自定义内核可能会提供最好的结果，但会牺牲任何和所有支持。</p><p>  Inherent in the creation of a btrfs filesystem is the choice of block-level checksums, used to record and enforce integrity and accuracy of all content. In recent  history, this choice was limited to the CRC32C algorithm, which is prone to collisions and is not reasonably appropriate for deduplication (which is not covered here).</p><p>在创建btrfs文件系统时固有的是选择块级校验和，用于记录和实施所有内容的完整性和准确性。在最近的历史中，此选择仅限于CRC32C算法，该算法容易发生冲突，不太适合重复数据删除(此处不介绍)。</p><p> The choice of checksums is constrained by the two kernels of interest, and the options are stark.</p><p>校验和的选择受到两个感兴趣的内核的限制，选项非常简单。</p><p> Btrfs has recently implemented new checksums, details of which are described by  man 5 btrfs, excerpted here for a &#34;3.5GHz intel CPU&#34; (as stated on the manual page):</p><p>Btrfs最近实现了新的校验和，详细信息由man 5 btrfs描述，此处摘录了3.5 GHz英特尔CPU的校验和(如手册页所述)：</p><p>  The hashes above might be familiar to technical users of cryptographic applications. The NSA&#39;s SHA256 algorithm often has support with CPU primitives for fast processing, and is sufficiently collision-resistant for deduplication. The XXHASH algorithm asserts great improvement over CRC32C in avoidance of hash collisions with minimal impact to throughput.</p><p>密码应用程序的技术用户可能熟悉上述散列。NSA的SHA256算法通常支持CPU原语以实现快速处理，并且对于重复数据删除具有足够的抗冲突性。XXHASH算法在对吞吐量影响最小的情况下，在避免散列冲突方面比CRC32C有很大改进。</p><p> The problem with the above hash choices is laid plain in the manual pages: &#34;To mount such [a] filesystem [the] kernel must support the checksums as well.&#34; It must be understood that the current Oracle UEKR6 only supports CRC32C, and will not mount a btrfs filesystem created with any other hash function,  even though the userspace tools it distributes both allow and encourage it.</p><p>上述散列选择的问题在手册页中已明确说明：要挂载这样的[a]文件系统，内核也必须支持校验和。&#34；必须了解，当前的Oracle UEKR6只支持CRC32C，不会挂载使用任何其他散列函数创建的btrfs文件系统，即使它分发的用户空间工具既允许也鼓励这样做。</p><p> For the rest of this document, the following mount point will be assumed for our main btrfs filesystem. Please create this mount point to follow all further examples:</p><p>对于本文档的其余部分，将假定我们的主btrfs文件系统具有以下挂载点。请创建此装载点以遵循所有其他示例：</p><p>   for CSUM in crc32c xxhash sha256 blake2do fallocate -l 50G /home/CALDRON.BTRFS mkfs.btrfs --csum=&#34;$CSUM&#34; /home/CALDRON.BTRFS mount -o loop /home/CALDRON.BTRFS /bvault umount /bvault rm -v /home/CALDRON.BTRFSdone</p><p>对于crc32c xxhash sha256 blake2do falocate-l 50g/home/CALDRON.BTRFS mkfs.btrfs--csum=&#34；$CSUM&#34；/home/CALDRON.BTRFS mount-o loop/home/CALDRON.BTRFS/bvault umount/bvault rm-v/home/CALDRON.BTRFSone。</p><p> I choose the name &#34;caldron&#34; above in recognition of the ZFS zpool &#34;tank&#34; as a name of greater clarity for the brew of features that we are concocting, and I will occasionally refer to this as the &#34;backing store.&#34; On the Oracle UEK, only the CRC32 mount attempt will succeed, while the El Repo Mainline will run the script with all checksum types without error.</p><p>我选择上面的名称是为了识别ZFS zpool&34；TANK&#34；作为我们正在编写的功能BREW的一个更清晰的名称，我偶尔会将其称为后备存储。&#34；在Oracle UEK上，只有CRC32挂载尝试会成功，而El Repo主线将使用所有校验和类型运行脚本，而不会出现任何错误。在Oracle UEK上，只有CRC32挂载尝试会成功，而El Repo主线将使用所有校验和类型运行脚本，而不会出现错误。(注：在Oracle UEK上，只有CRC32挂载尝试会成功，而El Repo主线会正确运行所有校验和类型的脚本)。</p><p> The use of  fallocate above was inspired by a previous  article on btrfs loopback devices that seeded this discussion. Loopback mounts are commonly used on .ISO images historically written to optical media. Note that loopback filesystem mounts are generally fast, but can  suffer when  fsync() calls are excessive.</p><p>上面使用falocate的灵感来自于上一篇关于btrfs环回设备的文章，该文章引发了本讨论。环回装载通常用于历史上写入光学介质的.ISO映像。请注意，回送文件系统挂载通常很快，但当fsync()调用过多时可能会受到影响。</p><p> The Oracle UEK is a recent 5.4.17 kernel, but not recent enough to support anything beyond CRC32C, as is gleaned from  man 5 btrfs: &#34;Since kernel 5.5 there are three more [checksums] with different characteristics and trade-offs regarding speed and strength.&#34; When even Oracle neglects to backport new features, we come to see Red Hat&#39;s point.</p><p>Oracle UEK是最近的5.4.17内核，但还不够新，不足以支持CRC32C以外的任何东西，从man 5 btrfs：&#34；从内核5.5开始，又有三个[校验和]具有不同的特性，并在速度和强度方面进行了权衡。当甚至连Oracle都忽略了支持新功能时，我们就会看到Red Hat&#34；的观点。</p><p> When running the UEK, this is the best checksum available on a new btrfs filesystem:</p><p>运行UEK时，这是新btrfs文件系统上可用的最佳校验和：</p><p>  If the El Repo Mainline is the active kernel, then any checksum implemented by Oracle&#39;s  mkfs.btrfs may be used.</p><p>如果El Repo主线是活动内核，则可以使用Oracle的mkfs.btrfs实现的任何校验和。</p><p> From a ZFS perspective, this is all very primitive. ZFS allows the dynamic selection of any checksum/hash function, to be applied to any filesystem object. In any case, SHA256 is likely the preferred choice for those desiring extreme data integrity, and willing to forego support.</p><p>从ZFS的角度来看，这一切都非常原始。ZFS允许动态选择任何校验和/散列函数，以应用于任何文件系统对象。在任何情况下，SHA256很可能是那些需要极端数据完整性并愿意放弃支持的人的首选。</p><p>  Three compression types can be applied to directory or file objects within a btrfs filesystem. The available types are, in preference:  zstd,  lzo,  zlib, and  none. The assignment of these compression attributes is maintained as btrfs &#34;metadata,&#34; and the kernel will perform the file compression as content is written.</p><p>可以将三种压缩类型应用于btrfs文件系统内的目录或文件对象。可用类型优先为：zstd、lzo、zlib和NONE。这些压缩属性的分配保持为btrfs&34；元数据，并且内核将在写入内容时执行文件压缩。</p><p>  zstd - Code contributed by Facebook, and allows a numerical selector to be specified between 1 and 11, controlling the compression factor of a file applied by the kernel.</p><p>Zstd-由Facebook贡献的代码，允许指定介于1和11之间的数字选择符，控制内核应用的文件的压缩系数。</p><p>    zlib - Uses the conventional gzip algorithm, and allows a factor to be applied between 1 and 9.</p><p>Zlib-使用传统的gzip算法，并允许应用介于1和9之间的因子。</p><p>  While compression can be globally set as a mount option for the whole of the mounted filesystem, it can also be applied to specific directories or files. The syntax to assert this property is as follows:</p><p>虽然可以将压缩全局设置为整个已挂载文件系统的挂载选项，但也可以将其应用于特定的目录或文件。断言此属性的语法如下所示：</p><p> mkdir /bvault/tmpbtrfs property set /bvault/tmp compression zstdmkdir /bvault/logbtrfs property set /bvault/log compression lzobtrfs property set /bvault/log compression zlib:9btrfs property set /bvault/log compression zstd:11</p><p>Mkdir/bvault/tmpbtrfs属性集/bvault/tmp压缩zstdmkdir/bvault/logbtrfs属性集/bvault/log压缩lzobtrfs属性集/bvault/log压缩zlib：9btrfs属性集/bvault/log压缩zstd：11。</p><p>     The metadata containing the compression settings on file and directory objects cannot be backed up with  tar or other utilities that are not aware of the btrfs internals for this special status. The  Send/Receive section below is able to replicate all metadata to a new btrfs filesystem, and is the only file movement utility that captures these hidden settings.</p><p>包含文件和目录对象压缩设置的元数据不能使用tar或其他不知道此特殊状态的btrfs内部机制的实用程序进行备份。下面的发送/接收部分能够将所有元数据复制到新的btrfs文件系统，并且是唯一捕获这些隐藏设置的文件移动实用程序。</p><p> Unfortunately, no reporting tools are present within the btrfs-progs package to discern compression ratios of files on disk. A brute force method is available, lacking granular reporting, using df in a simple shell function to report only desired mounts.</p><p>不幸的是，btrfs-progs包中没有报告工具来识别磁盘上文件的压缩比。有一种暴力方法可用，它缺少粒度报告，在一个简单的shell函数中使用df只报告所需的挂载。</p><p> The following shell function will be used in later examples, please make note of it.</p><p>下面的shell函数将在后面的示例中使用，请注意。</p><p> function ddf { typeset a b IFS=\|; df | while read a do [[ -z &#34;$b&#34; ]] &amp;&amp; printf &#39;%s\n&#39; &#34;$a&#34;; for b; do case &#34;$a&#34; in *&#34;$b&#34;*) printf &#39;%s\n&#39; &#34;$a&#34;;; esac; done; done }</p><p>函数ddf{type set a b IFS=\|；df|同时读取a do[[-z&#34；$b&#34；]]&amp；&amp；printf&#39；%s\n&#39；&#34；$a&#34；；对于*&#34；$b&#34；$b&#34；中的b；do case&#34；$b&#34；*)printf&#39；%s\n&#39；&#34；$a&#34；ESAC；Done；Done}。</p><p>    Filesystem 1K-blocks Used Available Use% Mounted on/dev/loop0 52428800 1989740 50009460 4% /test1/dev/loop1 52428800 19106016 32844480 37% /test2</p><p>文件系统1K-已用数据块可用使用率装载在/dev/loop0 52428800 1989740 50009460 4%/test1/dev/loop1 52428800 19106016 32844480 37%/test2。</p><p> A more granular utility  is available as C source. &#34;[The]  compsize [program] takes a list of files on a btrfs filesystem and measures used compression types and effective compression ratio. There is a patch adding support for that; currently it&#39;s not merged. You can kind of guess at its compressed size by comparing the output from the df command before and after writing a file, if this is available to you.&#34;</p><p>有一个更细粒度的实用程序可以作为C源代码使用。&#34；[the]compsize[program]获取btrfs文件系统上的文件列表，并测量使用的压缩类型和有效压缩比。有一个补丁添加了对此的支持；目前它还没有合并。如果可以的话，您可以通过比较df命令在写文件前后的输出来猜测它的压缩大小。</p><p> To make use of this granular reporting utility, assuming that you have access to a Linux C compiler and are able to prepare  compsize, ensure that you have installed the following package:</p><p>要使用此精细报告实用程序，假设您有权访问Linux C编译器并能够准备compsize，请确保您已安装了以下软件包：</p><p>      Test the program. Notice the sync event below - compsize may fail without it, as a sync event appears to prompt kernel compression:</p><p>测试程序。请注意，下面的sync事件-compsize在没有它的情况下可能会失败，因为同步事件似乎会提示内核压缩：</p><p>   Processed 2 files, 15 regular extents (15 refs), 0 inline.Type Perc Disk Usage Uncompressed Referenced TOTAL 17% 316K 1.7M 1.7M zstd 17% 316K 1.7M 1.7M</p><p>已处理2个文件，15个常规扩展区(15个参考)，0个内联。类型Perc磁盘使用未压缩引用总计17%316k 1.7M 1.7M zstd 17%316k 1.7M 1.7M。</p><p>      Administrators of classic UNIX systems often face requests for recovery from backups, and often these requests cannot be met due to cron schedules of tar that fall outside of and do not capture critical activities. Once-a-day backups do not cover temporary data that is delivered, processed, and deleted between the triggered backup cycles.</p><p>传统UNIX系统的管理员经常面临从备份恢复的请求，而且通常由于tar的cron计划在关键活动之外且不捕获关键活动，这些请求无法得到满足。一天一次的备份不包括在触发的备份周期之间传递、处理和删除的临时数据。</p><p> Snapshots are &#34;instant photographs&#34; of file system state that are created very quickly. As the filesystem changes blocks, a snapshot retains the old content, preserving it exactly as it appeared. Many snapshots can be taken of a btrfs filesystem and retained as long as disk space is available.</p><p>快照是非常快速地创建的文件系统状态的即时照片。当文件系统更改数据块时，快照将保留旧内容，并保持其显示的原样。只要磁盘空间可用，就可以对btrfs文件系统拍摄许多快照并保留这些快照。</p><p>        The default snapshots created in btrfs are not read-only objects; content can be added or changed within them:</p><p>在btrf中创建的默认快照不是只读对象；可以在其中添加或更改内容：</p><p>    Read-only snapshots can be created with the  -r option. This is likely preferable for backups, and read-only status is required for  Send/Receive functions, described below.</p><p>可以使用-r选项创建只读快照。这对于备份可能更可取，并且发送/接收功能需要只读状态，如下所述。</p><p> There is some discussion in the manual pages of the  noatime mount option, relating specifically to snapshots, and a  URL is mentioned as a resource for extended discussion. The  noatime option has long been known to boost filesystem performance on most UNIX systems, and it takes on additional meaning with btrfs in preventing snapshot growth, playing a further role with critical limits in btrfs, described below.</p><p>Noatime mount选项的手册页中有一些专门与快照相关的讨论，其中提到URL作为扩展讨论的资源。人们很早就知道noatime选项可以提高大多数UNIX系统上的文件系统性能，在btrfs中，它在防止快照增长方面具有额外的意义，在btrfs中发挥了进一步的作用，如下所述。</p><p> Snapshots are spe</p><p>快照是SPE。</p><p>......</p><p>.</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.linuxjournal.com/content/btrfs-centos-living-loopback">https://www.linuxjournal.com/content/btrfs-centos-living-loopback</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/btrfs/">#btrfs</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/asks/">#asks</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>