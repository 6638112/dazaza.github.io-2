<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>锈蚀提示和技巧</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">锈蚀提示和技巧</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-12 06:12:38</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/d3923db1d66b19076ef33c61e2e2a675.jpg"><img src="http://img.diglog.com/img/2020/7/d3923db1d66b19076ef33c61e2e2a675.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Rust是一种面向速度和安全性的编程语言。在过去的几年里，Rust获得了大量的采用，开发人员非常喜欢它。尽管有许多其他的系统编程语言，但Rust是极少数能够在性能方面站稳脚跟的C/C++替代语言之一。</p><p>铁锈是我们在Polyath为我们即将推出的区块链Polymesh选择的语言。在这篇文章中，我将分享一些我最喜欢的Rust技巧和一些给新开发人员的提示。</p><p>枚举的大小可以容纳它们最大的变体。因此，建议在枚举中使用类似大小的变体，以避免内存布局不是最优的。如果需要，您可以考虑装箱较大的变体。请考虑以下示例：</p><p>enum foo{A(U64)，B([U64；1000])，}enum FooBoxing{A(U64)，B(Box&lt；[U64；1000]&gt；)}fn main(){let x=foo：：A(0)；//其大小为8008字节。设y=FooBoxing：：a(0)；//大小只有16个字节。println！(&#34；foo size{：？}&#34；，std：：mem：：size_of_val(&amp；x))；println！(&#34；FooBoxing size{：？}&#34；，std：：mem：：size_of_val(&amp；y))；}。</p><p>在上面的示例中，枚举foo的变体A在大小上比变体B小得多，但是用于两个变体的存储器布局将是相同的，因此当使用变体A时，它将具有非最佳性能。</p><p>对变量调用.clone()会创建其数据的副本，创建副本需要资源。因此，在大多数情况下，克隆会对性能产生负面影响，应该避免。通常，您可以将相同变量的引用传递给不同的函数，而不需要克隆它们。例如：</p><p>fn main(){let x=foo：：new()；func(x.clone())；func(x.clone())；//不需要此克隆}fn main(){let x=foo：：new()；func(x.clone())；func(X)；//在此调用后不需要//使用x}fn main(){let x=foo：：new()；//如果您能够编辑函数，则//您很可能能够将其修改为使用引用。//那么您将不需要使用任何克隆。函数(&amp；x)；函数(&amp；x)；}。</p><p>然后，这些测试中的每一个都被编译为单独的二进制文件，这需要更多的编译时间和空间。相反，您可以将测试文件作为模块添加到单个测试中，以便只生成单个二进制文件。您的新测试结构将如下所示：</p><p>使用这个技巧，我能够将我们在Polymesh的CI测试时间从26分钟缩短到8分钟。它的缺点是您不能更改一个测试文件并只编译该文件。即使您只更改了一个测试文件，它也将始终编译完整的二进制文件。对我们来说，编译单个文件仅比编译完整的二进制文件快约10秒，因此我们决定采用这种方法。</p><p>DBG宏可用于将EXPRESS的值和源代码打印到stderr。示例用法：</p><p>交换函数允许您直接交换两个变量，而无需创建临时变量。</p><p>使用std：：mem；让mut x=5；让mut y=42；mem：：exchange(&amp；mut x，&amp；mut y)；assert_eq！(42，x)；assert_eq！(5，y)；</p><p>你可能已经知道了，是吗？可以想象为返回错误而不是恐慌的展开。而不是直接返回错误，是吗？实际上返回err(from：：from(Err))。这意味着如果错误是可转换的，它将自动转换为正确的类型。</p><p>可以使用相同的名称声明宏、函数和类型(如Enum)，然后使用一条IMPORT语句将它们全部导入到其他地方。</p><p>sccache可以缓存货物构建构件，以便它们可以跨工作区重用。这意味着，如果您有多个Rust项目，并且它们使用相同的依赖项，则sccache将允许您编译该依赖项一次，然后跨项目重用。它将为您节省编译时间和磁盘空间。锈蚀目标目录已经很大了，没有理由在那里存储冗余的二进制文件。</p><p>您可以使用Cargo：Cargo install sccache安装sccache。要启用sccache，您需要将RUSTC_wrapper=sccache添加到您的构建环境中。要做到这一点，一种方法是将export RUSTC_wrapper=sccache添加到您的.bashrc中。</p><p>它们是我最喜欢的两种防锈工具，如果你还没有用过，可以试一试。Clippy可以在您的代码中捕获各种Lint，并帮助您编写惯用的代码。要安装Clippy，请运行Rustup Component add clippy，要在您的工作区中运行Clippy，请执行Cargo Clippy。有关更多信息，请访问Clippy的GitHub。</p><p>顾名思义，rustfmt是一种根据样式准则格式化Rust代码的工具。要安装rustfmt，请运行rustup component add rustfmt，要在您的工作区中运行rustfmt，请执行Cargo fmt。有关更多信息，请访问rustfmt的GitHub。</p><p>我还想对锈蚀分析员进行大喊答题。它是Rust语言的实验性模块化编译器前端。对于我来说，它比任何其他的Rust编译器前端都工作得更好。我强烈建议大家试一试。</p><p>铁锈有很多东西可以提供，你每天都可以学到一些关于铁锈的新知识。我希望你从这篇文章中学到一些新的东西。如果您想添加什么或需要帮助，请随时留言或通过其他媒体联系我。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://mudit.blog/rust-tips-and-tricks/">https://mudit.blog/rust-tips-and-tricks/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/rust/">#rust</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/提示/">#提示</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/tips/">#tips</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1011225.html"><img src="http://img.diglog.com/img/2020/7/thumb_c68dc8a5a2ba8b48972a932df030601b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011225.html">大型科技公司为反垄断斗争召集了一支右倾盟友大军</a></div><span class="my_story_list_date">2020-7-12 0:46</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011153.html"><img src="http://img.diglog.com/img/2020/7/thumb_32780d6cb45e96fb723f478c4ed69bfe.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011153.html">会所是最新一个忽视节制直到它成为危机的社交网络，以及为什么它的创建者不应该把信任和安全视为事后考虑</a></div><span class="my_story_list_date">2020-7-11 14:5</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011095.html"><img src="http://img.diglog.com/img/2020/7/thumb_35bbe6e829a6d72c70c854e65a309277.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011095.html">
谷歌的Fitbit交易可以通过同意不将健康数据用于广告来避免欧盟反垄断调查</a></div><span class="my_story_list_date">2020-7-11 5:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1010948.html"><img src="http://img.diglog.com/img/2020/7/thumb_b3b76efbce8ecaf220524a5ab5d53138.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010948.html">
据报道，加州对谷歌发起反垄断调查</a></div><span class="my_story_list_date">2020-7-10 14:45</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>