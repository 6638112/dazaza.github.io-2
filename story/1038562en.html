<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Nanos中的Unikernel卷 Working with Unikernel Volumes in Nanos</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Working with Unikernel Volumes in Nanos<br/>使用Nanos中的Unikernel卷 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-09 19:45:05</div><div class="page_narrow text-break page_content"><p>Today&#39;s article is about working with external volumes for yourunikernel instance. Many applications won&#39;t use this feature but thereare also situations where this makes sense.</p><p>今天的文章是关于为您的Unikernel实例使用外部卷的。许多应用程序不会使用此功能，但在某些情况下这是有意义的。</p><p> The most obvious time when you would want to attach a volume to yourunikernel instance is when you are working with a database. Yourdatabase image probably doesn&#39;t change that much but many databases cangrow very large and it makes no sense to keep the same data volume inyour base image.</p><p> 您想要将卷附加到您的Unikernel实例上时，最明显的时间是使用数据库时。您的数据库映像可能变化不大，但是许多数据库可能增长得非常大，因此将相同的数据量保留在您的基础映像中毫无意义。</p><p> The second use-case is when you have a base image, say a webserver,and you want to package additional files or configuation as a buildstep. For instance some companies will rotate certificates every fewhours in the day to protect access to various services and this rotationis usually done out-of-band of deploys. Now unikernel deploys for smallwebservers are typically fairly fast but the ability to put yourconfiguration on a separate partition and re-mount the volume on the flyevery few hours is definitely enticing.</p><p> 第二个用例是当您拥有一个基本映像（例如Web服务器）并且要打包其他文件或进行配置作为构建步骤时。例如，有些公司将在一天中每隔几个小时轮换一次证书，以保护对各种服务的访问，而这种轮换通常是在带外进行的。现在，用于小型Web服务器的unikernel部署通常相当快，但是每隔几个小时就将您的配置放在一个单独的分区上并重新挂载该卷的能力无疑是诱人的。</p><p> Ok, let&#39;s start with the code. For this example we have a simplelittle go webserver that implements a root filesystem filewalker. We&#39;vedeclared that there is a separate partition called &#39;mnt&#39; in the code butit is non-existent right now.</p><p> 好的，让我们从代码开始。对于此示例，我们有一个简单的go网络服务器，该服务器实现了根文件系统filewalker。我们已经声明了一个名为＆mnt＆＃39;的单独分区。在代码中，但现在不存在。</p><p> import ( &#34;fmt&#34; &#34;io/ioutil&#34; &#34;net/http&#34; &#34;os&#34; &#34;path/filepath&#34;)func printDir() { err := filepath.Walk(&#34;/&#34;, func(path string, info os.FileInfo, err error) error { if err != nil { return err } fmt.Println(path, info.Size()) return nil }) if err != nil { fmt.Println(err) }}func main() { printDir() b, err := ioutil.ReadFile(&#34;/mnt/bob.txt&#34;) if err != nil { fmt.Println(err) } fmt.Println(string(b)) http.HandleFunc(&#34;/&#34;, func(w http.ResponseWriter, r *http.Request) { printDir() b, err := ioutil.ReadFile(&#34;/mnt/bob.txt&#34;) if err != nil { fmt.Println(err) } fmt.Println(string(b)) fmt.Fprintf(w, &#34;Welcome to my website!&#34;) }) fs := http.FileServer(http.Dir(&#34;static/&#34;)) http.Handle(&#34;/static/&#34;, http.StripPrefix(&#34;/static/&#34;, fs)) go func() { err = http.ListenAndServe(&#34;:80&#34;, nil) if err != nil { fmt.Println(err) } }() http.ListenAndServe(&#34;:8080&#34;, nil)}</p><p> 导入（＆＃34; fmt＆＃34;＆＃34; io / ioutil＆＃34;＆＃34; net / http＆＃34;＆＃34; os＆＃34;＆＃34; path / filepath＆＃34;） printDir（）{err：= filepath.Walk（＆＃34; /＆＃34 ;, func（路径字符串，info os.FileInfo，err错误）错误{如果err！= nil {return err} fmt.Println（path ，info.Size（））返回nil}），如果err！= nil {fmt.Println（err）}} func main（）{printDir（）b，err：= ioutil.ReadFile（＆＃34; / mnt / bob .txt＆＃34;）如果err！= nil {fmt.Println（err）} fmt.Println（string（b））http.HandleFunc（＆＃34; /＆＃34 ;, func（w http.ResponseWriter，r * http.Request）{printDir（）b，err：= ioutil.ReadFile（＆＃34; /mnt/bob.txt&#34;）如果err！= nil {fmt.Println（err）} fmt.Println（string （b））fmt.Fprintf（w，＆＃34; Welcome to my website！＆＃34;）}）fs：= http.FileServer（http.Dir（＆＃34; static /＆＃34;））http .Handle（＆＃34; / static /＆＃34 ;, http.StripPrefix（＆＃34; / static /＆＃34 ;, fs））转到func（）{err = http.ListenAndServe（＆＃34 ;: 80＆＃34 ;, nil）如果err！= nil {fmt.Println（err）}}（）http.ListenAndServe（＆＃34;：8080＆＃34 ;, nil）}</p><p>If you run it locally you should see something like this: ➜ g2 ops run -p 8080 g2booting /Users/eyberg/.ops/images/g2.img ...assigned: 10.0.2.15/ 0/dev 0/dev/null 0/dev/urandom 0/etc 0/etc/passwd 33/etc/resolv.conf 18/etc/ssl 0/etc/ssl/certs 0/etc/ssl/certs/ca-certificates.crt 207436/g2 7533614/lib 0/lib/x86_64-linux-gnu 0/lib/x86_64-linux-gnu/libnss_dns.so.2 26936/proc 0/proc/self 0/proc/self/exe 0/proc/self/maps 0/proc/sys 0/proc/sys/kernel 0/proc/sys/kernel/hostname 7/sys 0/sys/devices 0/sys/devices/system 0/sys/devices/system/cpu 0/sys/devices/system/cpu/cpu0 0/sys/devices/system/cpu/online 0open /mnt/bob.txt: no such file or directory</p><p>如果在本地运行它，应该会看到类似以下内容的内容：➜g2 ops运行-p 8080 g2booting /Users/eyberg/.ops/images/g2.img ...已分配：10.0.2.15/ 0 / dev 0 / dev / null 0 / dev / urandom 0 / etc 0 / etc / passwd 33 / etc / resolv.conf 18 / etc / ssl 0 / etc / ssl / certs 0 / etc / ssl / certs / ca-certificates.crt 207436 / g2 7533614 / lib 0 / lib / x86_64-linux-gnu 0 / lib / x86_64-linux-gnu / libnss_dns.so.2 26936 / proc 0 / proc / self 0 / proc / self / exe 0 / proc / self / maps 0 / proc / sys 0 / proc / sys /内核0 / proc / sys /内核/主机名7 / sys 0 / sys /设备0 / sys /设备/系统0 / sys /设备/系统/ cpu 0 / sys /设备/系统/ cpu / cpu0 0 / sys / devices / system / cpu / online 0open /mnt/bob.txt：无此类文件或目录</p><p>   mkdir mntecho &#34;Hi - I&#39;m a text file&#34; &gt; mnt/bob.txt➜ g2 ops volume create mnt -d mnt2020/12/08 11:12:35 volume: mnt created with UUID 04c56e4a-5b8b-512c-eaa3-b82b4cd46d9e and label mnt</p><p>   mkdir mntecho＆＃34;嗨-我是一个文本文件＆＃34; ＆gt; mnt /bob.txt➜g2 ops卷创建mnt -d mnt2020 / 12/08 11:12:35卷：使用UUID 04c56e4a-5b8b-512c-eaa3-b82b4cd46d9e和标签mnt创建的mnt </p><p>You&#39;ll see that we can now see it in our local volume store: ➜ g2 ops volume list+--------------------------------------+------+--------+-----------+-------------------------------------------------------------------------+---------+----------+| UUID | NAME | STATUS | SIZE (GB) | LOCATION | CREATED | ATTACHED |+--------------------------------------+------+--------+-----------+-------------------------------------------------------------------------+---------+----------+| 04c56e4a-5b8b-512c-eaa3-b82b4cd46d9e | mnt | | 1.6 MB | /Users/eyberg/.ops/volumes/mnt:04c56e4a-5b8b-512c-eaa3-b82b4cd46d9e.raw | | |+--------------------------------------+------+--------+-----------+-------------------------------------------------------------------------+---------+----------+</p><p>您会看到我们现在可以在本地卷存储中看到它：➜g2 ops卷列表+ --------------------------- ----------- + ------ + -------- + ----------- + ---------- -------------------------------------------------- ------------- + --------- + ---------- + | UUID | NAME |状态|大小（GB）|位置|创建|附加| + -------------------------------------- + ------ +- ------- + ----------- + ------------------------------ ------------------------------------------- + ------ --- + ---------- + | 04c56e4a-5b8b-512c-eaa3-b82b4cd46d9e | mnt | | 1.6 MB | /Users/eyberg/.ops/volumes/mnt:04c56e4a-5b8b-512c-eaa3-b82b4cd46d9e.raw | | | + -------------------------------------- + ------ +- ------ + ----------- + ------------------------------- ------------------------------------------ + ------- -+ ---------- +</p><p>  You can attach a volume to an instance that is expecting one. So thatmeans when we create the image we&#39;ll want to pass any mount points withthe volume label and mount path - this is loosely similar to howsomething in /etc/fstab would work. Ran locally you can test with &#39;opsrun&#39; but you can pass the same &#39;--mounts&#39; flag when issuing &#39;ops imagecreate&#39; for images ran on Google or AWS. Let&#39;s try it out locally:</p><p>  您可以将一个卷附加到需要一个实例的实例上。因此，这意味着在我们创建映像时，我们将要传递带有卷标和安装路径的所有安装点-大致类似于/ etc / fstab中的工作方式。您可以在本地运行“＆＃39; opsrun＆＃39;但您可以传递相同的＆＃39;-mounts＆＃39;发出“ ops imagecreate”的标志用于在Google或AWS上运行的图像。让我们在本地尝试一下：</p><p> ➜ g2 ops run -p 8080 g2 --mounts mnt:/mntbooting /Users/eyberg/.ops/images/g2.img ...assigned: 10.0.2.15/ 0/dev 0/dev/null 0/dev/urandom 0/etc 0/etc/passwd 33/etc/resolv.conf 18/etc/ssl 0/etc/ssl/certs 0/etc/ssl/certs/ca-certificates.crt 207436/g2 7533614/lib 0/lib/x86_64-linux-gnu 0/lib/x86_64-linux-gnu/libnss_dns.so.2 26936/mnt 0/mnt/bob.txt 21/proc 0/proc/self 0/proc/self/exe 0/proc/self/maps 0/proc/sys 0/proc/sys/kernel 0/proc/sys/kernel/hostname 7/sys 0/sys/devices 0/sys/devices/system 0/sys/devices/system/cpu 0/sys/devices/system/cpu/cpu0 0/sys/devices/system/cpu/online 0Hi - I&#39;m a text file</p><p> ➜g2 ops运行-p 8080 g2 --mounts mnt：/ mntbooting /Users/eyberg/.ops/images/g2.img ...已分配：10.0.2.15/ 0 / dev 0 / dev / null 0 / dev / urandom 0 / etc 0 / etc / passwd 33 / etc / resolv.conf 18 / etc / ssl 0 / etc / ssl / certs 0 / etc / ssl / certs / ca-certificates.crt 207436 / g2 7533614 / lib 0 / lib / x86_64-linux-gnu 0 / lib / x86_64-linux-gnu / libnss_dns.so.2 26936 / mnt 0 / mnt / bob.txt 21 / proc 0 / proc / self 0 / proc / self / exe 0 / proc / self / maps 0 / proc / sys 0 / proc / sys / kernel 0 / proc / sys / kernel / hostname 7 / sys 0 / sys / devices 0 / sys / devices / system 0 / sys / devices / system / cpu 0 / sys / devices / system / cpu / cpu0 0 / sys / devices / system / cpu / online 0嗨-I＆ma文本文件</p><p>  echo &#34;New text has come to light.&#34; &gt; mnt/bob.txt➜ g2 ops volume create mnt2 -d mnt2020/12/08 11:19:41 volume: mnt2 created with UUID f82da0e3-3980-ddd8-5720-e1b320e21371 and label mnt2</p><p>  回声＆＃34;新文本已经曝光。 ＆gt; mnt /bob.txt➜g2 ops卷创建mnt2 -d mnt2020 / 12/08 11:19:41卷：使用UUID f82da0e3-3980-ddd8-5720-e1b320e21371和标签mnt2创建的mnt2</p><p> Keep in mind we are creating a *new* volume with new contents and then re-attaching the volume to the instance.</p><p> 请记住，我们正在创建具有新内容的* new *卷，然后将该卷重新附加到实例。</p><p> ➜ g2 ops run -p 8080 g2 --mounts mnt2:/mntbooting /Users/eyberg/.ops/images/g2.img ...assigned: 10.0.2.15/ 0/dev 0/dev/null 0/dev/urandom 0/etc 0/etc/passwd 33/etc/resolv.conf 18/etc/ssl 0/etc/ssl/certs 0/etc/ssl/certs/ca-certificates.crt 207436/g2 7533614/lib 0/lib/x86_64-linux-gnu 0/lib/x86_64-linux-gnu/libnss_dns.so.2 26936/mnt 0/mnt/bob.txt 28/proc 0/proc/self 0/proc/self/exe 0/proc/self/maps 0/proc/sys 0/proc/sys/kernel 0/proc/sys/kernel/hostname 7/sys 0/sys/devices 0/sys/devices/system 0/sys/devices/system/cpu 0/sys/devices/system/cpu/cpu0 0/sys/devices/system/cpu/online 0New text has come to light.</p><p> ➜g2 ops运行-p 8080 g2 --mounts mnt2：/ mntbooting /Users/eyberg/.ops/images/g2.img ...已分配：10.0.2.15/ 0 / dev 0 / dev / null 0 / dev / urandom 0 / etc 0 / etc / passwd 33 / etc / resolv.conf 18 / etc / ssl 0 / etc / ssl / certs 0 / etc / ssl / certs / ca-certificates.crt 207436 / g2 7533614 / lib 0 / lib / x86_64-linux-gnu 0 / lib / x86_64-linux-gnu / libnss_dns.so.2 26936 / mnt 0 / mnt / bob.txt 28 / proc 0 / proc / self 0 / proc / self / exe 0 / proc / self / maps 0 / proc / sys 0 / proc / sys / kernel 0 / proc / sys / kernel / hostname 7 / sys 0 / sys / devices 0 / sys / devices / system 0 / sys / devices / system / cpu 0 / sys / devices / system / cpu / cpu0 0 / sys / devices / system / cpu / online 0新文本显示。</p><p> If you are attaching the volume to an instance on Google or AWS you&#39;duse the attach command:</p><p> 如果要将卷附加到Google或AWS上的实例，请使用attach命令： </p><p>    What&#39;s really great about unikernel volumes when working on AWS orGoogle is that this is all managed for you by the cloud provider of choice. There is no duplicate storage layeryou have to manage like you do in container land. Now you know the basics of mounting external volumes into your unikernel images.</p><p>在AWS或Google上工作时，Unikernel卷的真正优势在于，所有这些都由您选择的云提供商来管理。 没有重复的存储层，您必须像在集装箱土地上一样进行管理。 现在，您已经知道将外部卷安装到unikernel映像中的基本知识。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://nanovms.com/dev/tutorials/working-with-unikernel-volumes-in-nanos">https://nanovms.com/dev/tutorials/working-with-unikernel-volumes-in-nanos</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/unikernel/">#unikernel</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/mnt/">#mnt</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>