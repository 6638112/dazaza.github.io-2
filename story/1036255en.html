<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Web应用程序演示的DOM记录DOM recording for web application demos</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">DOM recording for web application demos<br/>Web应用程序演示的DOM记录</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-24 14:41:09</div><div class="page_narrow text-break page_content"><p>To show off the power of our  Pernosco debugger, we wanted many short demo videos of the application interface. Regular videos are relatively heavyweight and lossy; we wanted something more like  Asciinema, but for our Web application, not just a terminal. So we created  DOMRec, a DOM recorder. The approach is surprisingly straightforward. To record a demo, we inject the DOMRec script into our application. DOMRec captures the current DOM state and uses a  DOM Mutation Observer to record all DOM state changes with associated timestamps. To replay the demo, we create an  iframe, fill it with the recorded initial DOM state, then replay the DOM state changes over time. Replay inserts links to the original stylesheets but doesn&#39;t load or execute the original scripts. (Of course it couldn&#39;t be quite that simple ... see below.)   The resulting demos are compact (most of ours are less than 100KB gzipped), work on almost any browser/device, and are pixel-perfect at any zoom level. DOMRec supports single-frame screenshots when dynamism is not required. We can&#39;t use browser HTML5 video controls but we implement play/pause/fullscreen buttons. Capturing DOM state isn&#39;t quite enough because some rendering-relevant state isn&#39;t in the DOM. DOMRec logs mouse movement and click events and during replay, displays a fake mouse cursor and click effect. DOMRec tracks focus changes, and during replay sets &#34;fake focus&#34; classes on relevant DOM elements; our application style sheets check those classes in addition to the real  :focus and  :focus-within pseudoclasses. When necessary DOMRec creates a fake caret. DOMRec captures scroll offsets and makes a best-effort attempt to match scroll positions during recording and replay.  Canvas drawing operations don&#39;t change the DOM and don&#39;t trigger events, so our application manually triggers a &#34;didDrawCanvas&#34; DOM event which DOMRec listens for. Sometimes the Pernosco client needs to trigger a style flush to get CSS transitions to work properly, which also needs to happen during replay, so we fire a special notification event for that too. It&#39;s a bit ad-hoc — we implemented just enough for needs, and no more — but it does at least handle Microsoft&#39;s  Monaco editor correctly, which is pretty complicated. DOMRec can record demos executed manually, but in practice our demos are scripted using Selenium so that we can rebuild the demo movie when our application interface has changed. This kind of thing has certainly been built many times — see  Inspectlet and its competitors — so when I first looked into this problem a few years ago I assumed I would find an open-source off-the-shelf solution. Unfortunately I couldn&#39;t find one that looked easy to consume. Now we&#39;re releasing  DOMRec with an MIT license. To tell the truth, we&#39;re not trying hard to make DOMRec easy to consume, either; as noted above, some applications need to be tweaked to work with it, and this blog post is about all you&#39;re going to get in terms of documentation. Still, it&#39;s only 1200 lines of standalone Javascript so people may find it easier than starting from scratch.</p><p>为了展示我们的Pernosco调试器的功能，我们需要许多有关应用程序界面的简短演示视频。常规视频相对较重且有损；我们想要更多类似Asciinema的东西，但是对于我们的Web应用程序，不仅仅是终端。因此，我们创建了DOMRec，一个DOM记录器。该方法非常简单。为了录制演示，我们将DOMRec脚本注入到我们的应用程序中。 DOMRec捕获当前DOM状态，并使用DOM Mutation Observer记录所有DOM状态更改以及相关的时间戳。要重放该演示，我们创建一个iframe，将其记录为初始DOM状态，然后重放DOM状态随时间的变化。重播会插入指向原始样式表的链接，但不会加载或执行原始脚本。 （当然，不可能这么简单...请参见下文。）最终的演示非常紧凑（我们的大多数演示压缩后不到100KB），几乎可以在任何浏览器/设备上使用，并且在任何缩放下都具有完美的像素水平。当不需要动态时，DOMRec支持单帧屏幕截图。我们无法使用浏览器HTML5视频控件，但我们实现了播放/暂停/全屏按钮。捕获DOM状态还不够，因为DOM中没有某些与渲染相关的状态。 DOMRec记录鼠标移动和单击事件，并在重播期间显示伪造的鼠标光标和单击效果。 DOMRec跟踪焦点更改，并在重播期间对相关DOM元素设置“假焦点”类；除了真正的：focus和：focus-with伪类外，我们的应用程序样式表还会检查这些类。必要时，DOMRec会创建一个假插入符。 DOMRec捕获滚动偏移，并尽最大努力在记录和重放期间匹配滚动位置。画布绘制操作不会更改DOM，也不会触发事件，因此我们的应用程序手动触发DOMRec侦听的“ didDrawCanvas” DOM事件。有时Pernosco客户端需要触发样式刷新以使CSS转换正常工作，这也需要在重播期间发生，因此我们也为此触发了一个特殊的通知事件。这有点特别-我们仅实现了满足需求的内容，而没有更多内容-但是它至少可以正确处理Microsoft的Monaco编辑器，这非常复杂。 DOMRec可以记录手动执行的演示，但是实际上，我们的演示是使用Selenium编写的脚本，以便我们可以在应用程序界面更改后重建演示影片。这种事情肯定已经建立了很多次（请参阅Inspectlet及其竞争对手），因此，几年前我第一次研究此问题时，我以为我会找到一个开源的现成解决方案。不幸的是，我找不到一个看起来容易使用的东西。现在，我们发布具有MIT许可证的DOMRec。说实话，我们也不是在努力使DOMRec易于使用。如上所述，需要调整某些应用程序才能使用它，并且此博客文章介绍了有关文档方面的所有内容。尽管如此，它只有1200行独立的Javascript，所以人们可能会发现它比从头开始更容易。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://robert.ocallahan.org/2020/11/dom-recording-for-web-application-demos.html">https://robert.ocallahan.org/2020/11/dom-recording-for-web-application-demos.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/应用程序/">#应用程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/recording/">#recording</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dom/">#dom</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>