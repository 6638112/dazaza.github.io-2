<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>通过BLE信标，ESP32和机器学习将猫本地化 Localize your cat at home with BLE beacon, ESP32s, and Machine Learning</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Localize your cat at home with BLE beacon, ESP32s, and Machine Learning<br/>通过BLE信标，ESP32和机器学习将猫本地化 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-02-06 19:58:13</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/2/9bb6de680a0024fccf2c58d5c3cb1b99.png"><img src="http://img2.diglog.com/img/2021/2/9bb6de680a0024fccf2c58d5c3cb1b99.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>tl;dr / abstract. System which can be used for localization the position of a cat in a building using bluetooth low energy (BLE) beacons attached to the object, a set of cheap ESP32 detectors, and Machine Learning models.</p><p>tl; dr /摘要。该系统可用于使用附着在物体上的蓝牙低功耗（BLE）信标，一组廉价的ESP32探测器和机器学习模型来对猫在建筑物中的位置进行定位。</p><p>   This is an overwiev of a pipeline for creating an inhouse cat locator. Actually, it can be applied to any animal (including humans) or object, and any building. The system works as follows:</p><p>   这是用于创建内部猫定位器的管道的概述。实际上，它可以应用于任何动物（包括人类）或物体以及任何建筑物。该系统的工作原理如下：</p><p>  BLE signal is detected by ESP32s located here and there; they are measuring he signal strength of the BLE beacon.</p><p>  BLE信号由位于此处和此处的ESP32检测到;他们正在测量BLE信标的信号强度。</p><p>  The python program is fetching the last measurements from all ESP32 detectors (i.e., signal strenght values)</p><p>  python程序正在从所有ESP32检测器获取最近的测量值（即信号强度值）</p><p> 💡 The challenge here is to use a number of detectors which is significantly lower than the number of rooms and make ML do the rest.</p><p> here这里的挑战是使用许多探测器，这些探测器的数量远远少于房间的数量，而让ML来完成其余的工作。</p><p> 💡 This is  not a ready-to-use set of programs. As each situation is different (i.e, hardware setup, house size, number of rooms etc), please treat this repo as a framework to build and customize your own system.</p><p> is这不是现成的程序集。由于每种情况都不同（即硬件设置，房屋大小，房间数量等），请将此仓库视为构建和自定义系统的框架。</p><p>  Moving object to track. A cat. A dog is also fine. Be careful with fishes. Can be more than one. I used two cats.  💰 ~ 0 $</p><p>  要跟踪的移动对象。一只猫。狗也可以。小心鱼。可以不止一个。我用两只猫。 💰〜0 $ </p><p> BLE transmitters.  A BLE beacon. Anything will be good. I used  NotiOne buttons, they work well and has an additional functionality (not used here). But something cheaper will work too.  💰 n x 10-20 $</p><p>BLE发射器。 BLE信标。一切都会好。我使用了NotiOne按钮，它们运作良好并且具有其他功能（此处未使用）。但是更便宜的东西也可以。 💰n x 10-20 $</p><p> BLE detectors. I used four ESP32. I guess 4-6 for moderate house/flat should be enough. One can use also modern raspberry pi with BLE.  💰 n x 4 $</p><p> BLE检测器。我用了四个ESP32。我猜中等房屋/公寓的4-6应该足够了。可以将现代树莓派与BLE结合使用。 💰n x 4 $</p><p> Data processing. A server/computer. I worked with amd64 Debian, but any Raspberry Pi should be also good. Can be remote. Can be done in a microcontroller (see:  further directions)</p><p> 数据处理。服务器/计算机。我使用过amd64 Debian，但任何Raspberry Pi都应该不错。可以是远程的。可以在微控制器中完成（请参阅：更多说明）</p><p>        I provide a simple C/Arduino code for the detector. Of course it can do much more (my ESPs also measure temperature, humidity and other parameters):</p><p>        我为检测器提供了一个简单的C / Arduino代码。当然，它可以做得更多（我的ESP还可以测量温度，湿度和其他参数）：</p><p>  Many things can be tuned and optimized (eg array of MAC addreses instead of single variables, reading MAC addresses from the server etc).</p><p>  许多事情可以调整和优化（例如，MAC地址数组而不是单个变量，从服务器读取MAC地址等）。</p><p>   Raspberry Pi with a BLE capability can be included in the set of detectors. The commands here are:</p><p>   具有BLE功能的Raspberry Pi可以包含在检测器组中。这里的命令是：</p><p>     We need a server with a database. I use influx, but any will be good (MySQL or even text files!)</p><p>     我们需要一台带有数据库的服务器。我使用influx，但是任何都会好用的（MySQL甚至文本文件！） </p><p>   remember that the trained ML models must be next used in the same environment (the same scikit and numpy version!); this can be guaranteed by using the dedicated cond environment</p><p>请记住，必须在相同的环境（相同的scikit和numpy版本！）中再次使用经过训练的ML模型。这可以通过使用专用的cond环境来保证</p><p>     Training of ML models can be done on any computer (eg laptop) and next models transfered to the main server. Remember to keep the same modules version (use conda environment). See the next section on model training.</p><p>     可以在任何计算机（例如笔记本电脑）上进行ML模型的训练，并将下一模型转移到主服务器。记住要保持相同的模块版本（使用conda环境）。请参阅下一节模型训练。</p><p>  When models are trained and ready (see the next section), we use python program to fetch last BLE signal strength data and - basing on this - predict localization of the cat. Please see the section  Detecting for more info and code samples.</p><p>  训练好模型并准备就绪时（请参阅下一节），我们使用python程序来获取最后的BLE信号强度数据，并基于此来预测猫的定位。请参阅检测部分以获取更多信息和代码示例。</p><p>   Here we collect data for training ML algorithms. This means we have to collect signal strength data from all sensors WITH associated localization of the beacon. I.e, lets assume we have four ESP32 sensors, we need to create table like this one:</p><p>   在这里，我们收集用于训练ML算法的数据。这意味着我们必须从所有带有信标定位的传感器中收集信号强度数据。也就是说，假设我们有四个ESP32传感器，我们需要创建一个像这样的表：</p><p>  where each row (measurement) represent RSSI values read from beacon at a given location  at the same time. Please see  jupyter notebook for the data preprocessing.</p><p>  其中每行（度量）表示同时从给定位置的信标读取的RSSI值。请参阅jupyter笔记本进行数据预处理。</p><p>  The number of data points (i.e, different locations of BLE beacon) for each room is variable and depends on the room size. In my case it was like here:</p><p>  每个房间的数据点的数量（即BLE信标的不同位置）是可变的，并取决于房间的大小。就我而言，就像这里：</p><p>  Remember to sample space available for your cats, so not only flors, but also tables, wardrobes, or chandelier etc ;-)</p><p>  记住要为您的猫准备可用的空间，不仅是花朵，还包括桌子，衣柜或枝形吊灯等；-) </p><p>  Now we will probe several preprocessing algorithms together with several Machine Learning methods. We don&#39;t know which one will be the best in our case, so we will probe them all in a cross-validation experiment.</p><p>现在，我们将探讨几种预处理算法以及几种机器学习方法。我们不知道哪种情况最适合我们，因此我们将在交叉验证实验中对它们全部进行探查。</p><p>  The final models will be build with at 75% of the dataset (training), while 25% will seve as a testing dataset.</p><p>  最终的模型将使用75％的数据集（训练）构建，而25％的模型将作为测试数据集。</p><p>    we can see that in our case, the MLP Classifier with Min-Max Scaler gives the best results.</p><p>    我们可以看到，在本例中，带有Min-Max Scaler的MLP分类器可提供最佳结果。</p><p>   The nswer is no. The best accuracy here is the same as an initial setup (0.83), so we will stay with the MLP Classifier with Min-Max Scaler.</p><p>   nswer不是。此处的最佳精度与初始设置（0.83）相同，因此我们将使用带有Min-Max Scaler的MLP分类器。</p><p> The final models build with MLP Classifier with Min-Max Scaler gives the balanced accuracy equal 0.88. Very good! If we look at the confusion matrix:</p><p> 使用带有最小-最大缩放器的MLP分类器构建的最终模型可提供等于0.88的平衡精度。挺好！如果我们看混淆矩阵：</p><p>  we will see that (believe me or not) all miss-labelled predictions are for locations which are close to each other (eg. room_m is close in space to the office etc.). So this makes a perfect sense.</p><p>  我们将看到（信不信由你）所有未贴标签的预测都是针对彼此靠近的位置（例如，room_m在办公室附近的空间等）中。因此，这很合理。</p><p>  For the detection you can use the code snippet in the section 6 of  jupyter notebook or the code of the  simple program. The program uses numpy array as a data source, but it can be read from the file or fetched from the database.</p><p>  为了进行检测，您可以使用jupyter Notebook第6节中的代码段或简单程序的代码。该程序使用numpy数组作为数据源，但是可以从文件中读取或从数据库中获取它。 </p><p>  gathering data for training ML. I used 1-minutes interval of collecting data. This gave me time to change the position of beacons in the room. Measurements were automatically stored in the database (influx). I noted the time span of collectiong data in a given room and then fetched data from db for this time period, assigned a room label, and saved in a csv file.</p><p>收集用于训练ML的数据。我每隔1分钟收集一次数据。这给了我时间来更改信标在房间中的位置。测量值自动存储在数据库中（入库）。我记下了在给定房间中收集数据的时间跨度，然后在该时间段内从db中获取数据，分配了房间标签，并保存在csv文件中。</p><p> for collection of data for a flat surfaces (floors) you can use devices such as roomba with beacons attached at the top of it. Works fine!</p><p> 要收集平坦表面（地板）的数据，可以使用诸如Roomba之类的设备，该设备顶部装有信标。工作正常！</p><p>  Optimization of the position of ESP32 detectors, to cover whole space and give unique signal patterns for each rooms</p><p>  优化ESP32检测器的位置，以覆盖整个空间并为每个房间提供独特的信号模式</p><p>   (?) Take into account the battery level of the BLE beacon, as this could have impact on the transmitting power. I&#39;m not sure.</p><p>   （？）考虑BLE信标的电池电量，因为这可能会影响发射功率。我不确定。</p><p>  after some time of collecting the localization data for objects, we may create another ML model for predicting the localization of object in time (i.e., if it is Monday morning, the cat is near the fridge, if it is Saturday afternoon, the cat is sleeping in the bathroom, etc). This could involve another variables, like room temperature, humidity etc.</p><p>  在收集对象的定位数据一段时间后，我们可以创建另一个ML模型来及时预测对象的定位（即，如果是星期一早上，则猫在冰箱附近；如果是星期六下午，则猫是睡在浴室等）。这可能涉及其他变量，例如室温，湿度等。</p><p> move the prediction step to (another) microcontroller (ESP32, ESP8266) with such (cool!) project:  https://github.com/eloquentarduino/micromlgen (no need to have a dedicated server for predictions)</p><p> 使用以下（cool！）项目将预测步骤移至（另一个）微控制器（ESP32，ESP8266）：https://github.com/eloquentarduino/micromlgen（无需具有专用的预测服务器） </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/filipsPL/cat-localizer">https://github.com/filipsPL/cat-localizer</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/信标/">#信标</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cat/">#cat</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>