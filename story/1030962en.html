<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Amazon SNS FIFO-先进先出发布/订阅消息</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Amazon SNS FIFO-先进先出发布/订阅消息</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-24 20:47:32</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/5c422cb33c0f6b57de23bf7719b616a7.png"><img src="http://img2.diglog.com/img/2020/10/5c422cb33c0f6b57de23bf7719b616a7.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>When designing a distributed software architecture, it is important to define how services exchange information. For example, the use of asynchronous communication decouples components and simplifies scaling, reducing the impact of changes and making it easier to release new features.</p><p>在设计分布式软件体系结构时，定义服务如何交换信息非常重要。例如，异步通信的使用将组件解耦并简化了扩展，从而降低了更改的影响，并使发布新功能变得更容易。</p><p>  The two most common forms of asynchronous service-to-service communication are  message queues and  publish/subscribe messaging:</p><p>两种最常见的异步服务到服务通信形式是消息队列和发布/订阅消息传递：</p><p>  With  message queues, messages are stored on the queue until they are processed and deleted by a consumer. On AWS,  Amazon Simple Queue Service (SQS) provides a fully managed message queuing service with no administrative overhead.</p><p>使用消息队列，消息将存储在队列中，直到使用者处理和删除它们。在AWS上，Amazon Simple Queue Service(SQS)提供完全托管的消息队列服务，几乎没有管理开销。</p><p>  With  pub/sub messaging, a message published to a topic is delivered to all subscribers to the topic. On AWS,  Amazon Simple Notification Service (SNS) is a fully managed pub/sub messaging service that enables message delivery to a large number of subscribers. Each subscriber can also set a filter policy to receive only the messages that it cares about.</p><p>通过发布/订阅消息，发布到主题的消息将传递给该主题的所有订阅者。在AWS上，Amazon Simple Notification Service(SNS)是一种完全托管的发布/订阅消息传递服务，可将消息传递给大量订阅者。每个订阅者还可以设置过滤策略，以仅接收其关心的消息。</p><p>  You can use topics when you want to fan out messages to multiple applications, and queues when you want to send messages to one application. Using topics and queues together, you can decouple  microservices,  distributed systems, and  serverless applications.</p><p>当您想要将邮件散布到多个应用程序时，可以使用主题；当您想要将邮件发送到一个应用程序时，可以使用队列。将主题和队列一起使用，可以将微服务、分布式系统和无服务器应用程序解耦。</p><p>  With SQS, you can use  FIFO (First-In-First-Out) queues to preserve the order in which messages are sent and received, and to avoid that a message is processed more than once.</p><p>使用SQS，您可以使用先进先出(FIFO)队列来保持邮件发送和接收的顺序，并避免多次处理一封邮件。</p><p>  Introducing SNS FIFO Topics  Today, we are adding similar capabilities for pub/sub messaging with the introduction of  SNS FIFO topics, providing strict message ordering and deduplicated message delivery to one or more subscribers.</p><p>介绍SNS FIFO主题今天，我们通过引入SNS FIFO主题，为发布/订阅消息传递添加了类似的功能，为一个或多个订阅者提供严格的消息排序和经过重复数据消除的消息传递。</p><p>    Ordering – You configure a  message group by including a  message group ID when publishing a message to a FIFO topic. For each message group ID, all messages are sent and delivered in order of their arrival. For example, to ensure the delivery of messages related to the same customer in order, you can publish these messages to the topic using the customer’s account number as the message group ID. There is no limit in the number of message groups with FIFO topics and queues. You don’t need to declare in advance the message group ID, any value will work. If you don’t have a logical distinction between messages, you can simply use the same message group ID for all and have a single group of ordered messages. The message group ID is  passed to any subscribed FIFO queue.</p><p>排序-在将消息发布到FIFO主题时，您可以通过包含消息组ID来配置消息组。对于每个消息组ID，所有消息都按照它们到达的顺序发送和传递。例如，为了保证与同一客户相关的消息按顺序投递，您可以使用客户的账号作为消息组ID将这些消息发布到主题，具有FIFO主题和队列的消息组数量没有限制。您不需要事先声明消息组ID，任何值都可以。如果您在消息之间没有逻辑区别，您可以简单地对所有消息使用相同的消息组ID，并拥有单个有序消息组。消息组ID被传递到任何订阅的FIFO队列。</p><p>  Deduplication – Distributed systems (like SNS) and client applications sometimes generate duplicate messages. You can  avoid duplicated message deliveries from the topic in two ways: either by enabling  content-based deduplication on the topic, or by adding a  deduplication ID to the messages that you publish. With message content-based deduplication, SNS uses a  SHA-256 hash to generate the message deduplication ID using the  body of the message. After a message with a specific deduplication ID is published successfully, there is a 5-minute interval during which any message with the same deduplication ID is accepted but not delivered. If you subscribe a FIFO queue to a FIFO topic, the deduplication ID is  passed to the queue and it is used by SQS to avoid duplicate messages being received.</p><p>重复数据消除-分布式系统(如SNS)和客户端应用程序有时会生成重复消息。您可以通过两种方式避免主题中的重复邮件传递：一种是在主题上启用基于内容的重复数据删除，另一种是向发布的邮件添加重复数据消除ID。对于基于邮件内容的重复数据删除，SNS使用SHA-256散列来使用邮件正文生成邮件重复数据消除ID。具有特定重复数据消除ID的邮件成功发布后，有5分钟的间隔，在此期间，任何具有相同重复数据消除ID的邮件都会被接受，但不会被传递。如果您为FIFO队列订阅FIFO主题，则重复数据消除ID将传递给队列，SQS使用它来避免接收重复消息。</p><p>  You can use FIFO topics and queues together to simplify the implementation of applications where the order of operations and events is critical, or when you cannot tolerate duplicates. For example, to process financial operations and inventory updates, or to asynchronously apply commands that you receive from a client device. FIFO queues can use  message filtering in FIFO topics to selectively receive only a subset of messages rather than every message published to the topic.</p><p>您可以将FIFO主题和队列一起使用，以简化操作和事件顺序非常关键的应用程序的实现，或者在您不能容忍重复的情况下使用FIFO主题和队列。例如，处理财务操作和库存更新，或异步应用从客户端设备接收的命令。FIFO队列可以在FIFO主题中使用消息筛选，有选择地只接收消息子集，而不是发布到主题的每条消息。</p><p>  How to Use SNS FIFO Topics  A common scenario where FIFO topics can help is when you receive updates that need to be processed in order. For example, I can use a FIFO topic to receive updates from an application where my customers edit their account profiles. Then, I subscribe an SQS FIFO queue to the FIFO topic, and use the queue as trigger for a Lambda function that applies the account updates to an  Amazon DynamoDB table used by my  Customer management system that needs to be kept in sync.</p><p>如何使用SNS FIFO主题FIFO主题可以提供帮助的常见情况是当您收到需要按顺序处理的更新时。例如，我可以使用FIFO主题从我的客户编辑其帐户配置文件的应用程序接收更新。然后，我为FIFO主题订阅了一个SQS FIFO队列，并将该队列用作Lambda函数的触发器，该函数将帐户更新应用于我的客户管理系统使用的Amazon DynamoDB表，该表需要保持同步。</p><p>    The decoupling introduced by the FIFO topic makes it easier to add new functionality with minimal impact to existing applications. For example, to reward my loyal customers with additional promotions, I add a new  Loyalty application that is storing information in a relational database managed by  Amazon Aurora. To keep the customer’s information stored in the Loyalty database in sync with my other applications, I can subscribe a new FIFO queue to the same FIFO topic, and add a new Lambda function that receives customer updates in the same order as they are generated, and applies them to the Loyalty database. In this way, I don’t need to change code and configuration of other applications to integrate the new Loyalty app.</p><p>FIFO主题引入的解耦使添加新功能变得更容易，而对现有应用程序的影响最小。例如，为了用额外的促销来奖励我的忠实客户，我添加了一个新的忠诚度应用程序，该应用程序将信息存储在由Amazon Aurora管理的关系数据库中。要使存储在忠诚度数据库中的客户信息与我的其他应用程序保持同步，我可以向相同的FIFO主题订阅一个新的FIFO队列，并添加一个新的Lambda函数，该函数以生成客户更新的相同顺序接收客户更新，并将它们应用到忠诚度数据库。这样，我就不需要更改其他应用程序的代码和配置来集成新的忠诚应用程序。</p><p>    First, I create two FIFO queues in the  SQS console, leaving all options to their defaults:</p><p>首先，我在SQS控制台中创建了两个FIFO队列，将所有选项保留为默认值：</p><p>  The  loyalty.fifo queue to help me collect and store customer updates for the Loyalty application.</p><p>Loyalty.Fipo队列帮助我收集和存储忠诚度应用程序的客户更新。</p><p>  In the  SNS console, I create the  updates.fifo topic. I select  FIFO as type, and enable  Content-based message deduplication.</p><p>在SNS控制台中，我创建了Dupdates.Fio主题。我选择FIFO作为类型，并启用基于内容的邮件重复数据删除。</p><p>        To be able to receive messages, I add a statement to the  access policy of both queues granting the  updates.fifo topic permissions to send messages to the queues. For example, for the  customer.fifo queue the statement is:</p><p>为了能够接收消息，我在两个队列的访问策略中添加了一条语句，授予updates.Fio主题向队列发送消息的权限。例如，对于customer.fio队列，语句为：</p><p>  { &#34;Effect&#34;: &#34;Allow&#34;, &#34;Principal&#34;: { &#34;Service&#34;: &#34;sns.amazonaws.com&#34; }, &#34;Action&#34;: &#34;SQS:SendMessage&#34;, &#34;Resource&#34;: &#34;arn:aws:sqs:us-east-2:123412341234:customer.fifo&#34;, &#34;Condition&#34;: { &#34;ArnLike&#34;: { &#34;aws:SourceArn&#34;: &#34;arn:aws:sns:us-east-2:123412341234:updates.fifo&#34; } }}</p><p>{&#34；效果&#34；：&#34；允许&#34；，&#34；主体&#34；：{&#34；服务&#34；：&#34；sns.amazonaws.com&#34；},&#34；操作&#34；：&#34；SQS：SendMessage&#34；，&#34；资源&#34；：&#34；arn:aws:sqs:us-east-2:123412341234:customer.fifo&#34；，&#34；条件&#34；：{&#34；ArnLike&#34；：{Aws：SourceArn&#34；：&#34；arn:aws:sns:us-east-2:123412341234:updates.fifo&#34；}}}。</p><p>  Now, I use the SNS console to publish  4 messages in sequence. For all messages, I use the same message group ID. In this way, they are all in the same message group. The only part that is different is the message body, where I use in order:</p><p>现在，我使用SNS控制台按顺序发布4条消息。对于所有消息，我都使用相同的消息组ID。这样，它们都在同一个消息组中。唯一不同的部分是消息正文，我在其中按顺序使用：</p><p>    In the SQS console, I see that only  3 messages have been delivered to the FIFO queues:</p><p>在SQS控制台中，我看到只有3条消息传递到FIFO队列：</p><p>    Why is that? When I created the FIFO topics, I enabled  content-based deduplication. The 4 messages were sent within the 5-minute deduplication window. The last message has been recognized as a duplicate of the first one and has not been delivered to the subscribed queues.</p><p>为什么会这样呢？创建FIFO主题时，我启用了基于内容的重复数据删除。这4封邮件是在5分钟重复数据消除窗口内发送的。最后一条消息已被识别为第一条消息的副本，并且尚未传递到订阅队列。</p><p>  Let’s see the actual messages in the queues. I use the  AWS Command Line Interface (CLI) to receive the messages from SQS, and the   jq command-line JSON processor to format the output and get only the  Message in the  Body.</p><p>让我们看看队列中的实际消息。我使用AWS命令行界面(CLI)从SQS接收消息，使用JQ命令行JSON处理器格式化输出并仅获取正文中的消息。</p><p>    $ aws sqs receive-message --queue-url https://sqs.us-east-2.amazonaws.com/123412341234/customer.fifo --max-number-of-messages 10 | jq &#39;.Messages[].Body | fromjson | .Message&#39;&#34;Update One&#34;&#34;Update Two&#34;&#34;Update Three&#34;</p><p>$AWSSQS接收消息--队列-url https://sqs.us-east-2.amazonaws.com/123412341234/customer.fifo--最大消息数10|jq；.Messages[].Body|Fromjson|.Message&39；&#34；更新一个&#34；&#34；更新两个&#34；&#34；更新三&#34；</p><p>    $ aws sqs receive-message --queue-url https://sqs.us-east-2.amazonaws.com/123412341234/loyalty.fifo --max-number-of-messages 10 | jq &#39;.Messages[].Body | fromjson | .Message&#39;&#34;Update One&#34;&#34;Update Two&#34;&#34;Update Three&#34;</p><p>$AWSSQS接收消息--队列-url https://sqs.us-east-2.amazonaws.com/123412341234/loyalty.fifo--最大消息数10|jq；.Messages[].Body|Fromjson|.Message&39；&#34；更新一个&#34；&#34；更新两个&#34；&#34；更新三&#34；</p><p>  As expected, the 3 messages with unique content have been delivered to both queues in the same order as they were sent.</p><p>不出所料，具有独特内容的3条消息已按照与发送顺序相同的顺序传送到两个队列。</p><p>  Available Now  You can use SNS FIFO topics in all commercial regions. You can process up to 300 transactions per second (TPS) per FIFO topic or FIFO queue. With SNS, you pay only for what you use, you can find more information in the  pricing page.</p><p>现已提供，您可以在所有商业区域使用SNS FIFO主题服务。每个FIFO主题或FIFO队列最高每秒可处理300笔交易(TPS)。使用SNS，您只需为使用的内容付费，您可以在服务定价页面中找到更多信息。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://aws.amazon.com/blogs/aws/introducing-amazon-sns-fifo-first-in-first-out-pub-sub-messaging/">https://aws.amazon.com/blogs/aws/introducing-amazon-sns-fifo-first-in-first-out-pub-sub-messaging/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/amazon/">#amazon</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/发布/">#发布</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/sns/">#sns</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/消息/">#消息</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1030922.html"><img src="http://img2.diglog.com/img/2020/10/thumb_59abf42ca20f04d1c852861e4c803fcf.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030922.html">1号员工--与亚马逊首位员工Shel Kaphan的对话(2016)</a></div><span class="my_story_list_date">2020-10-24 12:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030737.html"><img src="http://img2.diglog.com/img/2020/10/thumb_27037f3d6116bb61e74f4c78d02e50b4.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030737.html">我们刚刚推出了亚马逊SNS FIFO主题</a></div><span class="my_story_list_date">2020-10-23 12:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030706.html"><img src="http://img2.diglog.com/img/2020/10/thumb_d7e28534c904b04352a2153d484bcbe6.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030706.html">Amazon Prime Day 2020-由AWS提供支持</a></div><span class="my_story_list_date">2020-10-23 11:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030642.html"><img src="http://img2.diglog.com/img/2020/10/thumb_c05a0e60c4283be0394d163770b23ccb.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030642.html">今天，亚马逊的一捆捆设备又回到了黄金日的价格</a></div><span class="my_story_list_date">2020-10-23 3:4</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>