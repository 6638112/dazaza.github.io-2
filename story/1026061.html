<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>MacOS容器的缺陷和默认设置</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">MacOS容器的缺陷和默认设置</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-24 10:36:50</div><div class="page_narrow text-break page_content"><p>本文是Dan Moren的文章“在Big Sur和Catalina上启用Safari14中的调试菜单”的后续文章。在过去，您可以在终端应用程序中使用命令default write com.apple.Safari IncludeInternalDebugMenu-bool true在Safari中启用隐藏的Debug菜单。然而，Dan发现这对他不再起作用，为了启用Debug菜单，他被迫手动编辑PLIST文件。那么这里发生了什么事？这是我的博客文章将要回答的问题。</p><p>Dan正确地指出，Safari的首选项文件已经从~/Library/Preferences/com.apple.Safari.plist移到了Safari容器中的~/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist，。丹没有意识到的是，这和Safari 14没有关系。实际上这已经发生了很久了，我相信是在去年Safari 13的时候。Safari 13第一次被沙盒包住了。如果您在终端中执行CoDesign--Display--Entiments-/Applications/Safari.app，您将看到沙盒应用的指示器：</p><p>Safari 12和更早版本没有沙箱，Safari首选项始终存储在首选项文件的传统位置，即~/Library/Preferences文件夹。然而，沙盒应用程序只能有限地访问Mac上的文件系统。例如，沙盒应用程序不能读取或写入~/Library/Preferences文件夹。这就是为什么每个沙盒应用程序都有自己的特殊容器来存储它需要的文件。对于Safari，它是~/Library/Containers/com.apple.Safari文件夹。因此，Safari首选项文件的位置必须在Safari 13中移动。问题是，如果您在Mac上运行过Safari 12或更早版本，旧的~/Library/Preferences/com.apple.Safari.plist文件会被遗留！</p><p>除了沙箱，在这个场景中还有另一个因素在起作用：系统完整性保护，也就是SIP。Mac上的某些文件和文件夹受系统保护，没有特殊权限就无法访问，即使是非沙盒应用程序也无法访问。原来Safari的容器就是其中一个受保护的文件夹。默认情况下，Finder拥有访问整个文件系统的特殊权限，但终端APP默认没有特殊权限。因此，如果您尝试列出Safari容器中的内容，您就不能。</p><p>如果要向终端授予特殊权限，则必须打开系统首选项、安全和隐私窗格、隐私选项卡，在列表中选择完全磁盘访问权限，使用管理员密码解锁，添加终端，如果终端已在运行，则重新启动终端。(最后一步至关重要。)。现在您可以访问Safari的容器了。</p><p>这对缺省命令行工具有什么影响？如果终端应用程序具有完全磁盘访问权限，则默认写入com.apple.Safari足够智能，可以使用Safari容器中的首选项文件。但是，如果终端没有完全的磁盘访问权限，则默认值将回退到~/Library/Preferences文件夹中的首选项！因此，如果在没有完全磁盘访问的情况下默认写入com.apple.Safari IncludeInternalDebugMenu-bool true，它将写入~/Library/Preferences/com.apple.Safari.plist，但这没有任何效果，因为Safari是沙箱的，并且只从它自己的容器中读取首选项。请注意，即使~/Library/Preferences/com.apple.Safari.plist中没有旧文件，也会发生这种情况，因为默认设置将在必要时创建新文件。</p><p>$DEFAULTS读取com.apple.Safarie.Safari2020-09-22 08：17：23.053默认值[1782：31894]域com.apple.Safari不存在$DEFAULTS写入com.apple.Safari IncludeInternalDebugMenu-bool true$Defaults Read com.apple.Safari{IncludeInternalDebugMenu=1；}。</p><p>这个故事有三个寓意，第一，如果你想让默认写入在Safari上正常工作，你需要给终端提供完全的磁盘访问权限。其次，如果您想避免混淆，请确保删除旧的~/Library/Preferences/com.apple.Safari.plist文件，因为Safari不再使用它，但默认情况下可能会使用它，这会带来很多乐趣。例如，默认值为com.apple.Safari IncludeInternalDebugMenu可能会显示错误的值。如果您想了解这是如何发生的，请比较默认设置为com.apple.Safari NewestLaunchedSafariVersion在具有和没有完全磁盘访问的情况下的结果。他们是不同的！</p><p>这个故事的第三个也是最后一个寓意是，SIP和沙盒很可怕，应该废除。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://lapcatsoftware.com/articles/containers.html">https://lapcatsoftware.com/articles/containers.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/容器/">#容器</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/macos/">#macos</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/safari/">#safari</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1021645.html"><img src="http://img2.diglog.com/img/2020/9/thumb_cec2909557a8611e525cf6e4cbf59eee.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021645.html">Bottlerocket，一个为运行容器而构建的开源Linux发行版</a></div><span class="my_story_list_date">2020-9-2 5:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021638.html"><img src="http://img2.diglog.com/img/2020/9/thumb_4c9a2e558ab936b0f8118e46868f0441.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021638.html">GitHub容器注册表</a></div><span class="my_story_list_date">2020-9-2 4:48</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021073.html"><img src="http://img.diglog.com/img/2020/8/thumb_3784dc110fc890967203836fc494bb9a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021073.html">Linux容器-技术介绍(2015)</a></div><span class="my_story_list_date">2020-8-29 9:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007759.html"><img src="http://img.diglog.com/img/2020/6/thumb_e5bf63fc2e4310ead0536049d41281df.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007759.html">艰难的集装箱：Gocker：用Go编写的迷你码头</a></div><span class="my_story_list_date">2020-6-23 12:19</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>