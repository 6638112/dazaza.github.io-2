<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在慢连接上的现代网络（2017） The modern web on a slow connection (2017)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">The modern web on a slow connection (2017)<br/>在慢连接上的现代网络（2017） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-06 06:53:25</div><div class="page_narrow text-break page_content"><p>The modern web on a slow connection    A couple years ago, I took a road trip from Wisconsin to Washington and mostly stayed in rural hotels on the way. I expected the internet in rural areas too sparse to have cable internet to be slow, but I was still surprised that a large fraction of the web was inaccessible. Some blogs with lightweight styling were readable, as were pages by academics who hadn’t updated the styling on their website since 1995. But very few commercial websites were usable (other than Google). When I measured my connection, I found that the bandwidth was roughly comparable to what I got with a 56k modem in the 90s. The latency and packetloss were significantly worse than the average day on dialup: latency varied between 500ms and 1000ms and packetloss varied between 1% and 10%. Those numbers are comparable to what I’d see on dialup on a bad day.</p><p>几年前，现代网络在速度缓慢，我从威斯康星州到华盛顿的公路旅行，大多在途中住在乡村酒店。我预计互联网在农村地区过于稀疏，有电网互联网缓慢，但我仍然感到惊讶的是，大部分的网是无法进入的。一些具有轻量级造型的博客是可读的，因为自1995年以来没有在其网站上更新造型的学术界的页面。但很少有商业网站是可用的（谷歌除外）。当我测量我的连接时，我发现带宽与90s中的56k调制解调器大致相当。延迟和数据项明显差，而不是平均拨号日期：延迟在500ms和1000ms之间变化，并且Packetloss之间的不同程化量为1％和10％。这些数字与我在糟糕的一天中看到的东西相当。</p><p>  Despite my connection being only a bit worse than it was in the 90s, the vast majority of the web wouldn’t load. Why shouldn’t the web work with dialup or a dialup-like connection? It would be one thing if I tried to watch youtube and read pinterest. It’s hard to serve videos and images without bandwidth. But my online interests are quite boring from a media standpoint. Pretty much everything I consume online is plain text, even if it happens to be styled with images and fancy javascript. In fact, I recently tried using w3m (a terminal-based web browser that, by default, doesn’t support css, javascript, or even images) for a week and it turns out there are only two websites I regularly visit that don’t really work in w3m (twitter and zulip, both fundamentally text based sites, at least as I use them)  1.</p><p>  尽管我的连接只有90多岁的差，但绝大多数网络都不会加载。为什么网络不应该使用拨号或类似拨号连接？如果我试图观看YouTube并阅读Pinterest，那将是一件事。很难在没有带宽的情况下服务视频和图像。但我的在线兴趣从媒体角度来看非常无聊。几乎所有我在线消耗的东西都是纯文本，即使它发生在用图像和花哨的JavaScript设计。事实上，我最近尝试了一周使用W3M（默认情况下，默认情况下，不支持CSS，JavaScript或偶数图像），它只有两个我经常访问Don'的网站T真的在W3M中工作（Twitter和Zulip，两个基于基于文本的网站，至少在我使用它们时）1。</p><p>  More recently, I was reminded of how poorly the web works for people on slow connections when I tried to read a joelonsoftware post while using a flaky mobile connection. The HTML loaded but either one of the five CSS requests or one of the thirteen javascript requests timed out, leaving me with a broken page. Instead of seeing the article, I saw  three entire pages of sidebar, menu, and ads before getting to the title because the page required some kind of layout modification to display reasonably. Pages are often designed so that they&#39;re hard or impossible to read if some dependency fails to load. On a slow connection, it&#39;s quite common for at least one depedency to fail. After refreshing the page twice, the page loaded as it was supposed to and I was able to read the blog post, a fairly compelling post on eliminating dependencies.</p><p>  最近，我想提醒我们在使用刷新移动连接时读取Joelonsoftware Post时，Web对人们的工作有多差。加载HTML，但是五个CSS请求之一或十三个JavaScript请求超时，让我带着一个破损的页面。我在获得标题之前看到了三个侧边栏，菜单和广告的三页，因为页面需要某种布局修改以合理地显示。通常设计页面，使它们＆＃39;如果某些依赖性无法加载，则重新读取，或者不可能读取。在慢速连接上，它与至少一个缺陷的缺点相当常见。刷新页面后两次，装入页面后的页面，我能够阅读博客文章，一个相当令人信服的帖子，在消除依赖项。</p><p>  Complaining that people don’t care about performance like they used to and that we’re letting bloat slow things down for no good reason is “old man yells at cloud” territory; I probably sound like that dude who complains that his word processor, which used to take 1MB of RAM, takes 1GB of RAM. Sure, that could be trimmed down, but there’s a real cost to spending time doing optimization and even a $300 laptop comes with 2GB of RAM, so why bother? But it’s not quite the same situation -- it’s not just nerds like me who care about web performance. When Microsoft looked at actual measured connection speeds, they found that  half of Americans don&#39;t have broadband speed. Heck, AOL had 2 million dial-up subscribers in 2015, just AOL alone. Outside of the U.S., there are even more people with slow connections. I recently chatted with Ben Kuhn, who spends a fair amount of time in Africa, about his internet connection:</p><p>  抱怨人们不关心他们曾经的表现，而且我们让我们让臃肿的慢动作没有好理由是“老人大喊大叫着云”领土;我可能听起来像那个抱怨他的文字处理器，它用于服用1MB的RAM，需要1GB的RAM。当然，这可以修剪下来，但花费时间做出优化的真正成本甚至300美元的笔记本电脑配有2GB的RAM，所以为什么要打扰？但这不是相同的情况 - 这不仅仅是像我一样关心网络性能的书呆子。当微软看待实际测量的连接速度时，他们发现一半的美国人不会有宽带速度。哎呀，AOL在2015年拥有200万台拨号用户，只是AOL独自一人。在美国之外，有更多的人有缓慢的​​联系。我最近与Ben Kuhn聊天，他在非洲度过了相当多的时间，关于他的互联网连接：</p><p>  I&#39;ve seen ping latencies as bad as ~45 sec and packet loss as bad as 50% on a mobile hotspot in the evenings from Jijiga, Ethiopia. (I&#39;m here now and currently I have 150ms ping with no packet loss but it&#39;s 10am). There are some periods of the day where it ~never gets better than 10 sec and ~10% loss. The internet has gotten a lot better in the past ~year; it used to be that bad all the time except in the early mornings.</p><p>  在埃塞俄比亚吉捷国吉捷卡的夜晚，我看到Ping Latence在〜45秒和数据包损失和差距中的数据包丢失和差不多有50％。 （I＆＃39; M在这里，目前我有150ms ping，没有数据包丢失，但它＆＃39; s 10am）。有一天的时间〜从未得到10秒，损失约为10％。过去〜年互联网已经更好了;除了在清晨，它曾经是那么糟糕。</p><p>    Speedtest.net reports 2.6 mbps download, 0.6 mbps upload. I realized I probably shouldn&#39;t run a speed test on my mobile data because bandwidth is really expensive.</p><p>    SpeedTest.net报告2.6 Mbps下载，0.6 Mbps上传。我意识到我可能应该在我的移动数据上运行速度测试，因为带宽真的很贵。</p><p>  Our server in Ethiopia is has a fiber uplink, but it frequently goes down and we fall back to a 16kbps satellite connection, though I think normal people would just stop using the Internet in that case.</p><p>  我们在埃塞俄比亚的服务器具有光纤上行链路，但它经常下降，我们返回到16kbps的卫星连接，尽管我认为正常的人只是在这种情况下停止使用互联网。 </p><p>  If you think  browsing on a 56k connection is bad, try a 16k connection from Ethiopia!</p><p>如果您认为56K连接浏览不好，请从埃塞俄比亚尝试16K连接！</p><p>  Everything we’ve seen so far is anecdotal. Let’s load some websites that programmers might frequent with a variety of simulated connections to get data on page load times.  webpagetest lets us see how long it takes a web site to load (and why it takes that long) from locations all over the world. It even lets us simulate different kinds of connections as well as load sites on a variety of mobile devices. The times listed in the table below are the time until the page is “visually complete”; as measured by webpagetest, that’s the time until the above-the-fold content stops changing.</p><p>  到目前为止我们看到的一切都是轶事。让我们加载一些网站，程序员可能经常使用各种模拟连接来获取页面加载时间的数据。 WebPageTest让我们看看它需要多长时间才能从世界各地的地点加载（以及为什么需要那漫长的时间）。它甚至让我们模拟各种各样的连接以及在各种移动设备上的负载网站。下表中列出的时间是页面“视觉完全”的时间;通过WebPageTest来衡量，即在上述内容中的时间停止变化。</p><p>     Each row is a website. For sites that support both plain HTTP as well as HTTPS, both were tested; URLs are HTTPS except where explicitly specified as HTTP. The first two columns show the amount of data transferred over the wire in MB (which includes headers, handshaking, compression, etc.) and the number of TCP connections made. The rest of the columns show the time in seconds to load the page on a variety of connections from fiber (FIOS) to less good connections. “Bad” has the bandwidth of dialup, but with 1000ms ping and 10% packetloss, which is roughly what I saw when using the internet in small rural hotels. “😱” simulates a 16kbps satellite connection from Jijiga, Ethiopia. Rows are sorted by the measured amount of data transferred.</p><p>     每行都是一个网站。对于支持普通HTTP以及HTTPS的站点，都进行了测试; URL是HTTPS，除非明确指定为HTTP。前两列显示在MB（包括标题，握手，压缩等）中传输的数据量和所做的TCP连接数。该列的其余部分显示在从光纤（FIOS）各种连接上加载页面的时间以秒为单位，以更大的连接。 “糟糕”具有拨号的带宽，但用1000ms ping和10％packetloss，这是在使用互联网在小型乡村酒店时所看到的。 “😱”模拟埃塞俄比亚吉捷卡的16kbps卫星连接。通过传输的数据量排序行。</p><p>  The timeout for tests was 6 minutes; anything slower than that is listed as FAIL. Pages that failed to load are also listed as FAIL. A few things that jump out from the table are:</p><p>  测试的超时为6分钟;任何慢的东西都被列为失败。无法加载的页面也列为失败。从桌子上跳出的一些东西是：</p><p>  A large fraction of the web is unusable on a bad connection. Even on a good (0% packetloss, no ping spike) dialup connection, some sites won’t load.</p><p>  在一个不好的连接上，幅材的大部分是不可用的。即使在一个好的（0％packetloss，没有ping spike）拨号连接，某些站点也不会加载。</p><p>    As commercial websites go, Google is basically as good as it gets for people on a slow connection. On dialup, the 50%-ile page load time is a minute and a half. But at least it loads -- when I was on a slow, shared, satellite connection in rural Montana, virtually no commercial websites would load at all. I could view websites that only had static content via Google cache, but the live site had no hope of loading.</p><p>    作为商业网站，谷歌基本上与慢速连接的人一样好。在拨号上，50％-10％的页面加载时间为一分钟半。但至少是它的装载 - 当我在蒙大拿州农村的慢速，共享，卫星连接时，几乎没有商业网站完全可以加载。我可以查看仅通过Google缓存具有静态内容的网站，但实时站点没有加载的希望。</p><p>    Although only two really big sites were tested here, there are plenty of sites that will use 10MB or 20MB of data. If you’re reading this from the U.S., maybe you don’t care, but if you’re browsing from Mauritania, Madagascar, or Vanuatu, loading codinghorror once will cost you  more than 10% of the daily per capita GNI.</p><p>    虽然这里只测试了两个真正的大网站，但有很多网站将使用10MB或20MB的数据。如果您从美国阅读这一点，也许您不在乎，但如果您从Mauritania，Madagascar或Vanuatu浏览，请加载Codinghorror一次将您花费超过每日人均GNI的10％以上。 </p><p>    Despite the best efforts of  Maciej, the meme that page weight doesn’t matter keeps getting spread around. AFAICT, the top HN link of all time on web page optimization is to an article titled “Ludicrously Fast Page Loads - A Guide for Full-Stack Devs”. At the bottom of the page, the author links to another one of his posts, titled “Page Weight Doesn’t Matter”.</p><p>尽管Maciej的最佳努力，页面重量并不重要的MEME继续蔓延。 AFAICT，Web页面优化的所有时间的顶部HN链接是标题为“荒谬的快速页面加载 - 全堆栈DEVS指南”的文章。在页面的底部，作者链接到他的另一个帖子，标题为“页面重量并不重要”。</p><p>  Usually, the boogeyman that gets pointed at is bandwidth: users in low-bandwidth areas (3G, developing world) are getting shafted. But the math doesn’t quite work out. Akamai puts the global connection speed average at 3.9 megabits per second.</p><p>  通常，被指向的斗牛员是带宽：低带宽区域（3G，发展世界）的用户正在得到轴。但数学并不完全锻炼。 Akamai将全球连接速度平均为每秒3.9兆位。</p><p>  The “ludicrously fast” guide fails to display properly on dialup or slow mobile connections because the images time out. On reddit,  it also fails under load: &#34;Ironically, that page took so long to load that I closed the window.&#34;, &#34;a lot of … gifs that do nothing but make your viewing experience worse&#34;, &#34;I didn&#39;t even make it to the gifs; the header loaded then it just hung.&#34;, etc.</p><p>  由于图像超时，“灯密快速”导向器未能在拨号或慢速移动连接上显示。在Reddit上，它也在负载下失败：＆＃34;具有讽刺意味的是，该页面花了很长时间才能加载我关闭窗口。＆＃34;＆＃34;很多...... GIF，除了您的观看体验更糟糕的是＆＃34 ;,＆＃34;我甚至没有把它交给gif;标题加载然后它只是挂了。＆＃34;等等。</p><p>  The flaw in the “page weight doesn’t matter because average speed is fast” is that if you average the connection of someone in my apartment building (which is wired for 1Gbps internet) and someone on 56k dialup, you get an average speed of 500 Mbps. That doesn’t mean the person on dialup is actually going to be able to load a 5MB website. The average speed of 3.9 Mbps comes from a 2014 Akamai report, but it’s just an average. If you look at Akamai’s 2016 report, you can find entire countries where more than 90% of IP addresses are slower than that!</p><p>  “重量的缺陷无关紧要，因为平均速度快速”是，如果你平均地在我的公寓大楼里的联系（这是用于1Gbps互联网的人）和56K拨号的人，你会获得平均速度500 Mbps。这并不意味着拨号人员实际上将能够加载5MB的网站。 3.9 Mbps的平均速度来自2014年Akamai报告，但它只是平均水平。如果您查看Akamai的2016年报告，您可以找到整个国家，超过90％的IP地址慢！</p><p>  Yes, there are a lot of factors besides page weight that matter, and yes it&#39;s possible to create a contrived page that&#39;s very small but loads slowly, as well as a huge page that loads ok because all of the weight isn&#39;t blocking, but total page weight is still pretty decently correlated with load time.</p><p>  是的，除了页面重量之外，还有很多因素，且是的，它可以创建一个＆＃39; s非常小但加载缓慢的创建页面，以及加载正常的巨大页面重量是＆＃39; t阻断，但总页重量仍然与负载时间相当不相关。</p><p>  Since its publication, the &#34;ludicrously fast&#34; guide was updated with some javascript that only loads images if you scroll down far enough. That makes it look a lot better on webpagetest if you&#39;re looking at the page size number (if webpagetest isn&#39;t being scripted to scroll), but it&#39;s a worse user experience for people on slow connections who want to read the page. If you&#39;re going to read the entire page anyway, the weight increases, and you can no longer preload images by loading the site. Instead, if you&#39;re reading, you have to stop for a few minutes at every section to wait for the images from that section to load. And that&#39;s if you&#39;re lucky and the javascript for loading images didn&#39;t fail to load.</p><p>  自发表以来，＆＃34;赤裸上快速＆＃34;使用一些JavaScript更新了指南，如果您向下滚动到足够远，只能加载图像。如果你＆＃39看页面尺寸编号（如果webpagetest isn＆＃39; t脚本滚动），则使它在webspagepest上看起来更好想要读取该页面。如果您＆＃39;无论如何都要阅读整个页面，重量增加，您无法通过加载该站点来预先加载图像。相反，如果您＆＃39;重新阅读，您必须在每个部分停止几分钟，以等待从该部分中加载的图像。如果你＆＃39;＆＃39;＆＃39;重新幸运和加载图像的javascript didn＆＃39; t无法加载。</p><p>    Just like many people develop with an average connection speed in mind, many people have a fixed view of who a user is. Maybe they think there are customers with a lot of money with fast connections and customers who won&#39;t spend money on slow connections. That is, very roughly speaking, perhaps true on average, but sites don&#39;t operate on average, they operate in particular domains. Jamie Brandon writes the following about his experience with Airbnb:</p><p>    就像许多人都以平均连接速度发展，许多人都有一个用户是谁的固定视图。也许他们认为有很多钱有很多钱，赢得了快速的联系和赢得了越来越慢的连接。这是非常粗略地说，也许是真实的平均，但网站不平均运作，他们在特定领域运行。 Jamie Brandon写了以下关于他的Airbnb经验： </p><p>  I spent three hours last night trying to book a room on airbnb through an overloaded wifi and presumably a satellite connection. OAuth seems to be particularly bad over poor connections. Facebook&#39;s OAuth wouldn&#39;t load at all and Google&#39;s sent me round a &#39;pick an account&#39; -&gt; &#39;please reenter you password&#39; -&gt; &#39;pick an account&#39; loop several times. It took so many attempts to log in that I triggered some 2fa nonsense on airbnb that also didn&#39;t work (the confirmation link from the email led to a page that said &#39;please log in to view this page&#39;) and eventually I was just told to send an email to account.disabled@airbnb.com, who haven&#39;t replied.</p><p>我昨晚花了三个小时试图通过超载的WiFi预订Airbnb上的房间，大概是卫星连接。 OAuth似乎特别糟糕的联系。 Facebook＆＃39; S OAuth＆＃39;谷歌＆＃39; S圆满了＆＃39;选择一个账户＆＃39; - ＆gt; ＆＃39;请重新输入您的密码＆＃39; - ＆gt; ＆＃39;选择一个帐户＆＃39;循环几次。登录的尝试需要很多尝试，我在Airbnb上触发了一些2FA废话，也没有工作（来自电子邮件的确认链接导致了说＆＃39的页面;请登录查看此页面＆＃39 ;）最终我刚刚被告知要发送电子邮件到Account.disabled@airbnb.com，谁哈登＆＃39回复。</p><p>  It&#39;s particularly galling that airbnb doesn&#39;t test this stuff, because traveling is pretty much the whole point of the site so they can&#39;t even claim that there&#39;s no money in servicing people with poor connections.</p><p>  它＆＃39;它特别掌握了airbnb并测试了这些东西，因为旅行几乎是该网站的整个点，所以他们甚至可以宣称那里的人＆＃39;没有钱为人民服务联系差。</p><p>    My original plan for this was post was to show 50%-ile, 90%-ile, 99%-ile, etc., tail load times. But the 50%-ile results are so bad that I don’t know if there’s any point to showing the other results. If you were to look at the 90%-ile results, you’d see that most pages fail to load on dialup and the “Bad” and “😱” connections are hopeless for almost all sites.</p><p>    我的原始计划是帖子是显示50％-10％，90％-99％-1等，尾部加载时间。但是，50％的结果是如此糟糕，我不知道是否有任何点表明其他结果。如果您要查看90％的结果，您将看到大多数页面无法加载拨号，“坏”和“😱”连接对于几乎所有网站都无望。</p><p>      You can see that for a very small site that doesn’t load many blocking resources, HTTPS is noticeably slower than HTTP, especially on slow connections. Practically speaking, this doesn’t matter today because virtually no sites are that small, but if you design a web site as if people with slow connections actually matter, this is noticeable.</p><p>      您可以看到，对于一个不加载许多阻塞资源的非常小的网站，HTTPS明显慢于HTTP，尤其是在慢速连接上。实际上是说，这今天没关系，因为几乎没有网站是那么小，但如果你设计一个网站，就像有慢连接的人一样重要，这是明显的。</p><p>    The long version is, to really understand what’s going on, considering reading  high-performance browser networking, a great book on web performance that’s avaiable for free.</p><p>    很长的版本是，要真正了解发生了什么，考虑阅读高性能浏览器网络，这是一本关于免费的Web性能的书籍。</p><p>  The short version is that most sites are so poorly optimized that someone who has no idea what they’re doing can get a 10x improvement in page load times for a site whose job is to serve up text with the occasional image. When I started this blog in 2013, I used Octopress because Jekyll/Octopress was the most widely recommended static site generator back then. A plain blog post with one or two images took 11s to load on a cable connection because the Octopress defaults included multiple useless javascript files in the header (for never-used-by-me things like embedding flash videos and delicious integration), which blocked page rendering. Just moving those javascript includes to the footer halved page load time, and  making a few other tweaks decreased page load time by another order of magnitude. At the time I made those changes, I knew nothing about web page optimization, other than what I heard during a 2-minute blurb on optimization from a 40-minute talk on how the internet works and I was able to get a 20x speedup on my blog in a few hours. You might argue that I’ve now gone too far and removed too much CSS, but I got a 20x speedup for people on fast connections before making changes that affected the site’s appearance (and the speedup on slow connections was much larger).</p><p>  简短的版本是大多数网站都很优化，没有想到他们所做的事情可以在页面加载时间内获得10倍的工具，其作业是使用偶尔的图像向上服务文本的网站。当我在2013年开始这篇博客时，我使用了八章，因为Jekyll / Octopress是最广泛推荐的静态站点发电机。具有一个或两个图像的普通博客帖子需要11秒钟，以便在电缆连接上加载，因为八八页默认值包括标题中的多个无用的JavaScript文件（对于嵌入Flash视频和美味集成而言，逐个使用的东西）被阻止页面呈现。只需移动那些JavaScript到页脚减半页面加载时间，并使其他一些调整减少了另一种幅度的页面加载时间。当我制作这些变化时，我对网页优化一无所知，除了在2分钟的优化中听到的，除了互联网如何运作的40分钟，我能够获得20倍的加速度我的博客几个小时。您可能会争辩说，我现在已经走得太远了，删除了太多的CSS，但我在快速连接之前获得了20倍的加速，然后在制作影响网站的外观（并且慢连接上的加速度更大的加速）之前有一个20倍的人。</p><p>  That’s normal. Popular themes for many different kinds of blogging software and CMSs contain anti-optimizations so blatant that any programmer, even someone with no front-end experience, can find large gains by just pointing  webpagetest at their site and looking at the output.</p><p>  那是正常的。适用于许多不同类型的博客软件和CMS的流行主题包含反优化如此明显，即任何程序员，甚至没有前端体验的人，也可以通过在他们的网站上指向WebPageSt并查看输出来找到大的收益。 </p><p>    While it&#39;s easy to blame page authors because there&#39;s a lot of low-hanging fruit on the page side, there&#39;s just as much low-hanging fruit on the browser side. Why does my browser open up 6 TCP connections to try to download six images at once when I&#39;m on a slow satellite connection? That just guarantees that all six images will time out! Even if I tweak the timeout on the client side, servers that are configured to protect against DoS attacks won&#39;t allow long lived connections that aren&#39;t doing anything. I can sometimes get some images to load by refreshing the page a few times (and waiting ten minutes each time), but why shouldn&#39;t the browser handle retries for me? If you think about it for a few minutes, there are a lot of optimiztions that browsers could do for people on slow connections, but because they don&#39;t, the best current solution for users appears to be: use w3m when you can, and then switch to a browser with ad-blocking when that doesn&#39;t work. But why should users have to use two entirely different programs, one of which has a text-based interface only computer nerds will find palatable?</p><p>虽然它＆＃39;很容易归咎于页面作者，因为有很多在页面上的很多低悬挂水果，那里就在浏览器侧的低悬挂水果。为什么我的浏览器打开6个TCP连接，试图在慢卫星连接上时立即下载六个图像？这只是保证所有六种图像都会超时！即使我在客户端调整超时，配置为防止DOS攻击的服务器仍然留下了长寿的连接，且＃39; T做任何事情。我有时可以通过刷新页面几次（每次等待十分钟）来获得一些图像，但为什么＆＃39; t浏览器为我处理重试？如果您考虑了几分钟，则浏览器可以为慢速连接的人员做很多优化，但由于他们不，他们的最佳电流解决方案似乎是：当您可以使用W3M ，然后在＆＃39工作时用ad-blocking切换到浏览器。但为什么用户必须使用两个完全不同的程序，其中一个是基于文本的界面，只有计算机书呆子会发现可易娱乐？</p><p>    When I was at Google, someone told me a story about a time that “they” completed a big optimization push only to find that measured page load times increased. When they dug into the data, they found that the reason load times had increased was that they got a lot more traffic from Africa after doing the optimizations. The team’s product went from being unusable for people with slow connections to usable, which caused so many users with slow connections to start using the product that load times actually increased.</p><p>    当我在谷歌时，有人告诉我一个关于时间的故事，“他们”完成了一个大的优化推动，只发现测量的页面加载时间增加了。当他们挖掘数据时，他们发现装载时间增加的原因是，在做优化后，他们从非洲获得了更多的流量。该团队的产品从无法使用的人才无法使用，这导致了许多具有缓慢连接的用户，以开始使用加载时间实际增加的产品。</p><p>  Last night, at a presentation on the websockets protocol, Gary Bernhardt made the observation that the people who designed the websockets protocol did things like using a variable length field for frame length to save a few bytes. By contrast, if you look at the Alexa top 100 sites, almost all of them have a huge amount of slop in them; it’s plausible that the total bandwidth used for those 100 sites is probably greater than the total bandwidth for all websockets connections combined. Despite that, if we just look at the three top 35 sites tested in this post, two send uncompressed javascript over the wire, two redirect the bare domain to the www subdomain, and two send a lot of extraneous information by not compressing images as much as they could be compressed without sacrificing quality. If you look at twitter, which isn’t in our table but was mentioned above, they actually do  an anti-optimization where, if you upload a PNG which isn’t even particularly well optimized, they’ll re-encode it as a jpeg which is larger and has visible artifacts!</p><p>  昨晚，在WebSockets协议的演示文稿中，Gary Bernhardt将观察到设计WebSockets协议的人员使用可变长度字段进行帧长度的东西，以节省几个字节。相比之下，如果你看一下Alexa Top 100个网站，那么几乎所有的人都有大量的雪橇;对于这些100个站点使用的总带宽可能大于所有WebSockets连接组合的总带宽可能大。尽管如此，如果我们只看在此帖子中测试的三个前35个站点，而且两个在线发送未压缩的JavaScript，两个将裸露的域重定向到www子域，两个通过不按压图像发送大量无关信息因为它们可以在不牺牲质量的情况下压缩。如果您看看Twitter，其中在我们的桌子中被提到，但在上面提到，他们实际上可以做一个反优化，如果上传一个甚至特别优化的PNG，他们将重新编码它JPEG较大，具有可见的伪影！</p><p>  “Use bcrypt” has become the mantra for a reasonable default if you’re not sure what to do when storing passwords. The web would be a nicer place if “use webpagetest” caught on in the same way. It’s not always the best tool for the job, but it sure beats the current defaults.</p><p>  如果您不确定在存储密码时要做什么，则“使用bcrypt”已成为Mantra。如果“使用WebPageTest”以相同的方式夹具，那么网络将是一个更好的地方。这并不总是这项工作的最佳工具，但它确实击败了当前的默认值。</p><p>    The above tests were done by repeatedly loading pages via a private webpagetest image in AWS west 2, on a c4.xlarge VM, with simulated connections on a first page load in Chrome with no other tabs open and nothing running on the VM other than the webpagetest software and the browser. This is unrealistic in many ways.</p><p>    通过在C4.xlarge VM上反复加载页面，在C4.xlarge VM上重复加载页面进行上述测试，在Chrome中的第一页加载上的模拟连接，没有其他标签打开，而不是在VM上运行WebPageTest软件和浏览器。这在许多方面都是不现实的。</p><p>  In relative terms, this disadvantages sites that have a large edge presence. When I was in rural Montana, I ran some tests and found that I had noticeably better latency to Google than to basically any other site. This is not reflected in the test results. Furthermore, this setup means that pages are nearly certain to be served from a CDN cache. That shouldn&#39;t make any difference for sites like Google and Amazon, but it reduces the page load time of less-trafficked sites that aren&#39;t &#34;always&#34; served out of cache. For example, when I don&#39;t have a post trending on social media, between 55% and 75% of traffic is served out of a CDN cache, and when I do have something trending on social media, it&#39;s more like 90% to 99%. But the test setup means that the CDN cache hit rate during the test is likely to be &gt; 99% for my site and other blogs which aren&#39;t so widely read that they&#39;d normally always have a cached copy available.</p><p>  在相对术语中，这种具有大边缘存在的缺点位点。当我在蒙大拿州农村时，我跑了一些测试，发现我明显更好地延迟了谷歌而不是基本上是任何其他网站。这在测试结果中没有反映。此外，该设置意味着几乎确定从CDN高速缓存提供的页面。这应该与谷歌和亚马逊这样的网站有任何差异，但它减少了逃离的贩运网站的页面加载时间，且＃39; T＆＃34;始终＆＃34;从缓存中提供。例如，当我没有关于社交媒体的培训后，在CDN缓存中提供55％和75％的流量，当我有社交媒体上的东西时，它＆＃39; s更像90％到99％。但测试设置意味着测试期间CDN缓存命中率可能是＆gt;我的网站和其他博客的99％，又称＆＃39; t如此广泛地读到它们＆＃39; d通常总是有缓存的副本。</p><p>  All tests were run assuming a first page load, but it’s entirely reasonable for sites like Google and Amazon to assume that many or most of their assets are cached. Testing first page load times is perhaps reasonable for sites with a traffic profile like mine, where much of the traffic comes from social media referrals of people who’ve never visited the site before.</p><p>  所有测试都是假设第一页加载的运行，但对于像谷歌和亚马逊这样的网站来说，它完全合理，以假设他们的许多资产被缓存。测试首页加载时间可能是具有像我的流量概况的网站，其中大部分流量来自于从未访问过网站的人的社交媒体推荐。 </p><p>  A c4.xlarge is a fairly powerful machine. Today, most page loads come from mobile and even the fastest mobile devices aren’t as fast as a c4.xlarge; most mobile devices are much slower than the fastest mobile devices. Most desktop page loads will also be from a machine that’s slower than a c4.xlarge. Although the results aren’t shown, I also ran a set of tests using a t2.micro instance: for simple sites, like mine, the difference was negligible, but for complex sites, like Amazon, page load times were as much as 2x worse. As you might expect, for any particular site, the difference got smaller as the connection got slower.</p><p>一个c4.xlarge是一个相当强大的机器。今天，大多数页面加载来自移动，即使是最快的移动设备也不像C4.xlarge那么快;大多数移动设备比最快的移动设备慢得多。大多数桌面页面加载也将来自的机器比C4.xlarge慢。虽然结果未显示，但我也使用t2.micro实例运行一组测试：对于简单的网站，像我一样，差异可以忽略不计，但对于复杂的网站，像亚马逊一样，页面加载时间与2x一样多更差。正如您所希望的，对于任何特定网站，随着连接较慢的情况，差异变小。</p><p>  As Joey Hess pointed out, many dialup providers attempt to do compression or other tricks to reduce the effective weight of pages and none of these tests take that into account.</p><p>  正如Joey Hess所指出的那样，许多拨号提供商试图进行压缩或其他技巧以减少页面的有效权重，这些测试都没有考虑到这一点。</p><p>  Firefox, IE, and Edge often have substantially different performance characteristics from Chrome. For that matter, different versions of Chrome can have different performance characteristics. I just used Chrome because it’s the most widely used desktop browser, and running this set of tests took over a full day of VM time with a single-browser.</p><p>  Firefox，即Edge通常具有来自铬具有基本不同的性能特征。就此而言，不同版本的Chrome可以具有不同的性能特征。我刚刚使用了Chrome，因为它是最广泛使用的桌面浏览器，并运行这组测试占用了一个单一浏览器的全天VM时间。</p><p>  The simulated bad connections add a constant latency and fixed (10%) packetloss. In reality, poor connections have highly variable latency with peaks that are much higher than the simulated latency and periods of much higher packetloss than can last for minutes, hours, or days. Putting 😱 at the rightmost side of the table may make it seem like the worst possible connection, but packetloss can get much worse.</p><p>  模拟的错误连接添加了恒定的延迟和固定（10％）PacketLOSS。实际上，差的连接具有高度变化的延迟，峰值远高于模拟延迟和高于持续时间几分钟，小时或几天的数据延迟的延迟。在桌子的最右侧放置😱可能会使它看起来像是最糟糕的连接，但是Packetloss可能会变得更加糟糕。</p><p>  Similarly, while codinghorror happens to be at the bottom of the page, it&#39;s nowhere to being the slowest loading page. Just for example, I originally considered including slashdot in the table but it was so slow that it caused a significant increase in total test run time because it timed out at six minutes so many times. Even on FIOS it takes 15s to load by making a whopping 223 req</p><p>  同样，虽然Codinghorror发生在页面的底部，但它与最慢的加载页面无处可行。例如，我最初被认为包括桌面中的斜面，但它却导致总测试运行时间显着增加，因为它在六分钟内超时了。即使在FIOS上，通过制作往返223 req需要15岁</p><p>......</p><p>...... </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://danluu.com/web-bloat/">https://danluu.com/web-bloat/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/现代/">#现代</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/页面/">#页面</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>