<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Microsoft Teams策略仅应用于客户端，可以绕过</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Microsoft Teams策略仅应用于客户端，可以绕过</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-28 00:32:48</div><div class="page_narrow text-break page_content"><p>In this blog, I’ll show that these policies are applied only in client and thus can be easily bypassed.</p><p>在本博客中，我将说明这些策略仅适用于客户端，因此可以很容易地绕过。</p><p>   Policies are used in Microsoft Office 365 and Azure AD for securing access to services and data. Besides the  common identity and device access policies,Microsoft has provided a set of  Teams specific policies:</p><p>Microsoft Office 365和Azure AD中使用策略来保护对服务和数据的访问。除了通用的身份和设备访问策略外，Microsoft还提供了一组特定于团队的策略：</p><p>  For example, administrators can configure Teams so that external users are not able to edit or delete any messages they’ve sent. Or, an owner of a Teams site can disable message editing for members of a certain channel.</p><p>例如，管理员可以配置团队，使外部用户无法编辑或删除他们发送的任何邮件。或者，团队站点的所有者可以禁用对特定频道成员的消息编辑。</p><p>   While I was working with the previous version (v0.4.4) of  AADInternals Teams functions I noticed an interesting thing: I was able to edit and delete chat messages using AADInternals as a guesteven when it was not allowed.</p><p>当我使用AADInternals team函数的前一个版本(v0.4.4)时，我注意到一件有趣的事情：我可以使用AADInternals作为猜测来编辑和删除聊天消息，而这是不允许的。</p><p> This led to a question that  what if the policies are applied only at the client end? In practice this would mean that the Teams service tells to your Teams client that “Though shall not edit messages!” but the clientcould still do so.</p><p>这就产生了一个问题，如果这些策略只应用于客户端怎么办？在实践中，这将意味着团队服务告诉您的团队客户“虽然不能编辑消息！”但客户仍然可以这样做。</p><p>  I started by watching what was going on between the client and cloud when the Teams client started. The first observation was that the client made about 120 http requests to the cloud.While browsing through those requests, I spotted one that caught my interest (headers stripped):</p><p>当团队客户端启动时，我从观察客户端和云之间发生的事情开始。第一个观察结果是，客户端向云发出了大约120个http请求。在浏览这些请求时，我发现了一个我感兴趣的请求(标题被剥离)：</p><p> POST https://teams.microsoft.com/api/mt/part/emea-02/beta/users/useraggregatesettings HTTP/1.1{ &#34;tenantSettingsV2&#34;: true, &#34;userResourcesSettings&#34;: true, &#34;messagingPolicy&#34;: true, &#34;clientSettings&#34;: true, &#34;targetingPolicy&#34;: true, &#34;tenantSiteUrl&#34;: true, &#34;userPropertiesSettings&#34;: true, &#34;callingPolicy&#34;: true, &#34;meetingPolicy&#34;: true, &#34;educationAssignmentsAppPolicy&#34;: true}</p><p>发布https://teams.microsoft.com/api/mt/part/emea-02/beta/users/useraggregatesettings Http/1{&#34；tenantSettingsV2&#34；：TRUE，&#34；userResourcesSettings&#34；：TRUE，&#34；messagingPolicy&#34；：TRUE，&#34；clientSettings&#34；：TRUE，&#34；targetingPolicy&#34；：TRUE，&#34；tenantSiteUrl&#34；：TRUE，&#34；用户属性设置&#34；：TRUE，&#34；CallingPolicy&#34；：TRUE，&34；MeetingPolicy&#34；：TRUE，&34；Education AssignmentsAppPolicy&#34；：TRUE}。</p><p> The response contained all the settings and policies the Teams client is allowed to do as the logged in user. Below can be seen the  messagingPolicy section: &#34;messagingPolicy&#34; :  {	 &#34;value&#34; :  {		 &#34;allowUserEditMessage&#34; :  true ,		 &#34;allowUserDeleteMessage&#34; :  true ,		 &#34;allowUserChat&#34; :  true ,		 &#34;allowGiphy&#34; :  true ,		 &#34;giphyRatingType&#34; :  &#34;Moderate&#34; ,		 &#34;allowGiphyDisplay&#34; :  true ,		 &#34;allowPasteInternetImage&#34; :  true ,		 &#34;allowMemes&#34; :  true ,		 &#34;allowStickers&#34; :  true ,		 &#34;allowUserTranslation&#34; :  true ,		 &#34;allowUrlPreviews&#34; :  true ,		 &#34;readReceiptsEnabledType&#34; :  &#34;UserPreference&#34; ,		 &#34;allowImmersiveReader&#34; :  true ,		 &#34;allowPriorityMessages&#34; :  true ,		 &#34;audioMessageEnabledType&#34; :  &#34;ChatsAndChannels&#34; ,		 &#34;channelsInChatListEnabledType&#34; :  &#34;DisabledUserOverride&#34; ,		 &#34;allowRemoveUser&#34; :  true ,		 &#34;allowSmartReply&#34; :  true	 } }</p><p>响应包含允许团队客户端以登录用户身份执行的所有设置和策略。下面可以看到messagingPolicy部分：&#34；messagingPolicy&#34；：{&#34；value&#34；：{&#34；allowUserEditMessage&#34；：true，&#34；allowUserDeleteMessage&#34；：true，&#34；allowUserChat&#34；：true，&#34；allowGiphy&#34；：true，&#34；giphyRatingType&#34；：&#34；Medium&#34；，&#34；AllowGiphyDisplay&#34；：true，&#34；allowPasteInternetImage&#34；：true，&#34；allowMemes&#34；：true，&#34；allowStickers&#34；：true，&#34；allowUserTranslate&#34；：true，&#34；allowUrlPreviews&#34；：true，&#34；readReceiptsEnabledType&#34；：&#34；UserPreference&#34；，&#34；ImmersiveReader&#34；：true，&#34；AllowPriorityMessages&#34；：true，&#34；audioMessageEnabledType&#34；：&#34；ChatsAndChannels&#34；，&#34；channel elsInChatListEnabledType&#34；：&#34；DisabledUserOverride&#34；，&#34；allowRemoveUser&#34；：true，&#34；allowSmartReply&#34；：true}}</p><p> What we can learn here is that the Teams client asks from the cloud what the current user is allowed to do, which was the expected behaviour.</p><p>我们在这里可以了解到的是，团队客户端会从云中询问当前用户被允许做什么，这是预期的行为。</p><p>   I created a new Messaging policy to disable editing and deleting of sent messages.  I applied the policy to a single demo user:     Now I had two policies, the default organisation wide and the restricted one for demo user:</p><p>我创建了一个新的邮件策略，以禁止编辑和删除已发送的邮件。我将该策略应用于单个演示用户：现在我有两个策略，默认组织范围内的策略和针对演示用户的受限策略：</p><p> I restarted the Teams client and noticed that the editing and deleting were correctly disabled (didn’t exists).</p><p>我重新启动了团队客户端，并注意到编辑和删除被正确禁用(不存在)。</p><p> I compared the returned policies from the  useraggregatesettings requests and as we can see, the request was missing two lines:</p><p>我比较了从用户聚合设置请求返回的策略，如我们所见，请求缺少两行：</p><p> I closed the client and configured Fiddler to do an autoresponse using the saved http response from above:     Now, when the client is requesting the settings file, it will be served the one that allows editing and deleting.</p><p>我关闭了客户端，并将Fiddler配置为使用上面保存的http响应执行自动响应：现在，当客户端请求设置文件时，将为其提供允许编辑和删除的文件。</p><p> What we can lean here is that  we can lie to Teams client 😂  Moreover, we learnt that  Teams policies are applied only on the client 🤦‍♂</p><p>我们可以在这里学到的是，我们可以对团队客户端😂撒谎。此外，我们了解到团队策略仅应用于客户端🤦‍♂。</p><p> Below is a video that shows in action that this works also with  cloud file storage restrictions:</p><p>下面的视频实际展示了这也适用于云文件存储限制：</p><p>  As far as I know, the “uncompliant” Teams client behaviour can not be detected.</p><p>据我所知，“不合规”的团队客户行为是无法检测到的。</p><p> Same verdict with protecting. Well, one could try to use Conditional Access (CA) with device ownership and compliance restrictions, but that doesn’t cover all scenarios.</p><p>对保护的判决是一样的。嗯，人们可以尝试使用具有设备所有权和合规性限制的条件访问(CA)，但这并不涵盖所有场景。</p><p>   If the user (or guest) is utilising Teams APIs directly, using for instance AADInternals  Teams functionality, he or she can bypass the restrictions set by the policies.</p><p>如果用户(或访客)直接使用Teams API，例如使用AADInternals Teams功能，他或她可以绕过策略设置的限制。</p><p>   ⚠️  Teams policies are NOT a security measure and organisations should not rely on them! ⚠️</p><p>⚠️团队策略不是安全措施，组织不应依赖它们！⚠️</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://o365blog.com/post/teams-policies/">https://o365blog.com/post/teams-policies/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/microsoft/">#microsoft</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/teams/">#teams</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/客户端/">#客户端</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1031394.html"><img src="http://img2.diglog.com/img/2020/10/thumb_07449f3ce34dbe1e624e4a624ab8bc20.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031394.html">因YouTube-dl关闭要求要求微软辞去RIAA职务</a></div><span class="my_story_list_date">2020-10-27 10:28</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031368.html"><img src="http://img2.diglog.com/img/2020/10/thumb_380b9ae565ff33e093e2794c7ce0e0f5.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031368.html">
Microsoft Office为iPad提供鼠标和触摸板支持</a></div><span class="my_story_list_date">2020-10-27 6:35</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030856.html"><img src="http://img2.diglog.com/img/2020/10/thumb_9a5520fddb66d2afe0ad8c8b42c9a0f1.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030856.html">微软在欧洲反垄断文件中抨击松懈投诉</a></div><span class="my_story_list_date">2020-10-24 7:44</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030734.html"><img src="http://img2.diglog.com/img/2020/10/thumb_e3fbe2a5dfb3388e0556a54d075dd3dc.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030734.html">Microsoft Research展示Pivot，将VR对象放到您的手中</a></div><span class="my_story_list_date">2020-10-23 12:31</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>