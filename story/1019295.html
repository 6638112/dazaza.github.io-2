<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>适用于Kubernetes的AWS控制器</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">适用于Kubernetes的AWS控制器</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-20 12:35:20</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/58a94cb805bdcff9a62f7efd0f2efe01.png"><img src="http://img.diglog.com/img/2020/8/58a94cb805bdcff9a62f7efd0f2efe01.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>AWS Controls for Kubernetes(ACK)是一款新工具，可让您直接从Kubernetes管理AWS服务。ACK使构建利用AWS服务的可扩展且高度可用的Kubernetes应用程序变得简单。</p><p>在这篇文章中，我们将向您简要介绍ACK项目的历史，向您展示ACK是如何工作的，以及您如何开始使用ACK或做出贡献。</p><p>2018年末，Chris Hein将AWS Service Operator作为试验性个人项目推出。我们审查了来自社区和内部利益相关者的反馈，并决定将其作为第一级开源项目重新启动。在此过程中，我们将该项目重命名为AWS Controls for Kubernetes(ACK)。我们提出的原则是：</p><p>ACK针对生产用途进行了优化，具有全面的测试覆盖范围，包括性能和可伸缩性测试套件。</p><p>ACK努力成为通过Kubernetes操作员公开AWS服务的唯一代码库。</p><p>在过去的一年里，我们显著改进了项目的设计，继续与内部利益相关者进行讨论(稍后将详细介绍这一点的重要性)，并审查了该领域的相关项目。在此特别向CrossPlane项目喊话，该项目在跨云用例方面做得非常出色，同时也当之无愧地成为了CNCF项目。</p><p>新的ACK项目延续了最初AWS服务运营商的精神，但有一些更新：</p><p>AWS云资源直接通过AWS API管理，而不是通过CloudForment管理。这允许Kubernetes成为资源所需状态的单一“真理源”。</p><p>控制器和自定义资源定义的代码由AWS Go SDK自动生成，并由人工编辑和审批。这使我们能够以更少的人工工作支持更多的服务，并使项目与最新的创新保持同步。</p><p>这是由AWS Kubernetes团队构建和维护的官方项目。我们计划与AWS的同事一起继续投资此项目。</p><p>我们使用ACK的目标是为AWS提供一致的Kubernetes界面，而不考虑AWS服务API。这方面的一个示例是确保AWS资源之间的字段名称和标识符标准化，并以相同的方式处理标签。</p><p>我们，就像在“由作者领导的项目团队”中一样，生成并维护一组工件(二进制文件、容器图像、Helm图表等)。这些构件自动派生自AWS服务API，代表了如何从Kubernetes中管理AWS资源的业务逻辑。</p><p>作为群集管理员，您可以选择一个或多个要为您负责的群集安装和配置的ACK控制器。</p><p>相应的ACK控制器(在步骤2中安装)。管理所述自定义资源以及随之而来的基础AWS资源。根据步骤3中定义的自定义资源，控制器使用AWS API创建、更新或删除底层AWS资源。</p><p>现在，让我们使用一个具体的示例更详细地了解一下工作流。</p><p>工件生成会创建所需的代码组件，使您可以使用Kubernetes管理AWS服务。我们采取了多阶段方法，产生了混合的自定义+控制器运行时：</p><p>首先，我们使用有关AWS服务的规范真相来源的模型信息。我们确定了真相的来源，即来自AWS/AWS-SDK-GO存储库的模型文件。AWS SDK会定期更新所有API更改，因此这是一个准确的信息来源，并密切跟踪服务API可用性。在此阶段，我们生成包含代码的文件，这些代码公开在那里找到的对象和接口的GO类型。</p><p>在为AWS API公开的顶级资源生成Kubernetes API类型定义之后，我们需要生成接口实现，以启用这些顶级资源和类型定义供Kubernetes运行时包使用。</p><p>接下来，我们生成自定义资源定义(CRD)配置文件，每个配置文件对应于前面步骤中标识的每个顶级资源。然后，我们为目标服务生成ACK控制器的实现。除了Go中的这些控制器实现之外，此步骤还为部署输出一组Kubernetes清单，并为下一步输出角色的ClusterRoleBinding。</p><p>最后，我们为运行各自ACK服务控制器的Kubernetes部署生成Kubernetes角色的Kubernetes清单。遵循最小特权原则，此角色需要具有读取和写入所述服务控制器管理的那种自定义资源的确切权限。</p><p>上述工件-GO代码、容器图像、CRD的Kubernetes清单、角色、部署等-代表了如何从Kubernetes内部管理AWS资源的业务逻辑，并由AWS服务团队负责创建和维护以及来自社区的输入。</p><p>要在群集中使用ACK，您需要安装所需的AWS服务控制器，考虑到以下情况：</p><p>您可以为ACK自定义资源设置相应的Kubernetes Role-Based Access Control(RBAC)权限。请注意，每个ACK服务控制器都在其自己的Pod中运行，您可以且应该强制实施现有IAM控制，包括权限边界或服务控制策略，以定义谁有权访问哪些资源，并通过RBAC过渡性地定义这些资源。</p><p>您可以将AWS帐户ID与Kubernetes命名空间相关联。因此，这意味着每个ACK自定义资源都必须命名空间(没有群集范围的自定义资源)。</p><p>根据AWS共享责任模型，在群集管理环境中，您负责定期升级ACK服务控制器，并在安全补丁可用时应用它们。</p><p>作为应用程序开发人员，您可以在一个启用ACK的集群中创建命名空间的自定义资源。例如，假设您希望ACK创建一个Amazon Elastic Container Registry(ECR)存储库，您将定义并随后应用如下内容：</p><p>ApiVersion：&#34；ecr.services.k8s.aws/v1alpha1&#34；种类：存储库元数据：名称：&#34；my-ecr-repo&#34；规格：RepositoryName：&#34；Encrypted-repo-Managed-by-ack&#34；加密配置：加密类型：AES256标签：-密钥：&#34；是加密的&#34；值：&#34；true&#34；</p><p>群集管理员安装的ACK服务控制器可以根据开发人员在上一步定义的自定义资源中找到的意图来创建、更新或删除AWS资源。这意味着在启用ACK的目标群集中，一旦应用自定义资源，将创建相应的AWS资源(在我们的示例中为ECR repo)，您可以访问它。</p><p>让我们更多地关注来自Kubernetes的AWS资源的创建和管理，因为这是大多数用户与ACK交互的方式。在我们的示例中，我们将从我们的集群创建一个S3存储桶。</p><p>在以下内容中，我们希望使用ACK为我们管理S3存储桶。鉴于这是一个开发者预览版，我们将按照贡献者文档使用测试说明。在此上下文中，我们使用Kind进行本地端到端测试，并将Docker作为其唯一依赖项。</p><p>使用make Kind-test-s service=s3命令构建S3服务控制器的容器映像、创建集群并部署所有资源，第一次可能需要大约45分钟(冷缓存)。完成后，您可以查看ACK设置：</p><p>$kubectl-n ack-system获取全部名称就绪状态重新启动时间Pod/ACK-S3-控制器-86d9cf5cd7-z71421/1运行0 10m姓名就绪最新可用年龄部署.apps/ACK-S3-控制器1/1 1 1 10M命名所需的当前就绪时间Replicaset.apps/ack-s3-Controller-86d9cf5cd7 1 1 1 10</p><p>此外，我们预计S3CRD将在测试集群中安装并可用，实际上：</p><p>根据CRD，我们还希望找到S3存储桶自定义资源：</p><p>现在让我们对S3存储桶客户资源进行集群查看(注意：这里显示的是集成测试中自动生成的自定义资源，为了可读性进行了编辑)：</p><p>$kubectl Get Buckets ack-test-Smoke-s3-o YAMLApiVersion：s3.services.k8s.aws/v1alpha1种类：桶元数据：名称：ACK-TEST-Smoke-S3名称空间：默认规格：名称：ACK-TEST-Smoke-S3。</p><p>好的，完成此动手操作后，您现在应该对ACK的工作方式有了一个了解。现在让我们把注意力转向你们如何订婚以及接下来会发生什么。</p><p>我们非常高兴，从今天起，ACK可以作为开发者预览版提供，支持以下AWS服务：</p><p>您可以开始使用我们的文档安装和使用ACK。请注意，开发人员预览意味着面向最终用户的安装机制尚未到位。</p><p>随着时间的推移，我们希望支持和启用尽可能多的AWS服务，并为它们提供对ACK的全面支持。具体地说，在未来几个月，我们计划重点关注：</p><p>除了RDS和ElastiCache之外，我们还在考虑支持Amazon Elastic Kubernetes Service(EKS)和Amazon Managed Streaming for Apache Kafka(MSK)。</p><p>我们正在开发的重要功能，在接下来的几周和几个月内也应该可以使用，包括：</p><p>ACK仍然是一个新项目，我们正在寻求您的意见来帮助指导我们的开发。从概念上讲，我们对您对以下方面的反馈感兴趣：</p><p>从今天开始，在AWS集装箱日期间以及整个KubeCon EU 2020期间，我们将有很多机会讨论ACK的现状和下一步行动。启动你的集群，我们迫不及待地想看看你建造了什么！</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://aws.amazon.com/blogs/containers/aws-controllers-for-kubernetes-ack/">https://aws.amazon.com/blogs/containers/aws-controllers-for-kubernetes-ack/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ack/">#ack</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>