<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>XPath发生了什么变化？</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">XPath发生了什么变化？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-30 20:55:12</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/d3121fe04a0497ee68f87df70f26ce8b.jpeg"><img src="http://img2.diglog.com/img/2020/10/d3121fe04a0497ee68f87df70f26ce8b.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>After  being revolutionary in 2007 to unleash CSS selectors that never existed, the specification moved from v1.0 to the  current, recommended, v3.1, but browsers stopped with v1.0 … and we’re missing out!</p><p>在2007年革命性地释放了从来不存在的css选择器之后，该规范从v1.0升级到了当前推荐的v3.1，但是浏览器在v1.0…中停止了。我们要错过了！</p><p>  The fundamental difference between these two standards is that one was born to crawl and analyze the  DOM tree in all “ axes”, while the other one job is to live-style the  DOM, without any way to crawl its content.</p><p>这两个标准之间的根本区别在于，一个标准生来就是在所有“轴”上爬行和分析DOM树，而另一个工作是对DOM进行实况处理，而没有任何方法爬行它的内容。</p><p> That’s it:  XPath is a searching tool while  CSS is a real-time “ drawing” tool, hence rich in functionalities to style, but poor in terms of  DOM tree analysis.</p><p>仅此而已：XPath是一个搜索工具，而CSS是一个实时“绘图”工具，因此具有丰富的样式功能，但在DOM树分析方面很差。</p><p>  H ere an example: even if the  CSS  :has(...) selector is part of the most recent specifications,  no browser has implemented it to date, while in  XPath is:</p><p>这里有一个示例：即使css：有(...)。选择器是最新规范的一部分，到目前为止还没有浏览器实现它，而在XPath中是：</p><p>  and that’s scratching only the surface of what’s possible to do in  XPath, but it’s not possible via  CSS.</p><p>这只触及了XPath中可能实现的功能的皮毛，但是通过CSS是不可能实现的。</p><p>  In this example we find an element that matches any expression we could have within  [ squared brackets  ] and then crawl the DOM tree up to find its wrapper, the same way  element.closest(&#39;div.wrap&#39;) would do, except with XPath the condition is checked through the browser, no  JS needed, no  if (el.closest(...)) to verify: if it’s found, it’s returned.</p><p>在本例中，我们找到一个与[方括号]内的任何表达式相匹配的元素，然后向上爬行DOM树以找到它的包装器，方法与element.est(&#39；div.wire&#39；)相同，除非使用XPath通过浏览器检查条件，不需要JS，不需要if(el.est(...))。验证：如果找到，则返回。</p><p> Strawberry on top,  XPath can query, and return,  text nodes too, something  CSS wouldn’t care/know at all!</p><p>最上面是草莓，XPath也可以查询和返回文本节点，这是CSS根本不会关心/知道的！</p><p>  To start with, check this awesome  CSS to XPath translator, read extra cases provided by such translator, and check its source code to find even more extras, such as  icontains(...) to match anything in a case-insensitive fashion, then open devtools and type  $x to realize there is an  XPath utility provided out of the box. Try  $x(&#39;//body&#39;) to read out the result, and play around with any sort of query you can think about.</p><p>首先，检查这个非常棒的CSS到XPath转换程序，阅读该转换程序提供的额外案例，并检查其源代码以查找更多额外的内容，例如图标(...)。要以不区分大小写的方式匹配任何内容，请打开DevTools并键入$x，以意识到提供了开箱即用的XPath实用程序。尝试$x(&#39；//body&#39；)读出结果，并尝试您能想到的任何类型的查询。</p><p>  Unfortunately, in 2007, the year  XPath appeared as super-charged  CSS selector in most famous frameworks, is the same year  somebody decided that it wasn’t planned to update the  XPath engine any further, so we’re stuck with v1.0, at least  consistently implemented across browsers.</p><p>不幸的是，2007年，也就是XPath在大多数著名框架中作为超级CSS选择器出现的那一年，有人决定不再计划进一步更新XPath引擎，所以我们只能使用1.0版，至少在不同浏览器之间一致实现。</p><p> Here a cross browser, and cross env function, that replicates what devtools  $x(...) helper brings in:</p><p>这里有一个跨浏览器和跨环境函数，它复制了DevTools$x(...)。帮助者带来：</p><p> // basic XPath helper that works with JSDOM too function X(Path, root = document) {  const flag = XPathResult.ORDERED_NODE_SNAPSHOT_TYPE;  const query = document.evaluate(Path, root, null, flag, null);  const result = [];  for (let i = 0, {snapshotLength} = query; i &lt; snapshotLength; i++)  result.push(query.snapshotItem(i));  return result; }</p><p>//使用JSDOM Too函数的基本XPath帮助器X(path，root=document){const flag=XPathResult.ORDERED_NODE_SNAPSHOT_TYPE；const query=document(path，root，null，flag，null)；const result=[]；for(let i=0，{snapshotLength}=query；i&lt；snapshotLength；i++)result t.ush(query.snapshotItem(I))；return result；}。</p><p> … and now that we have a way to perform powerful queries, all we are  missing is the ability to use  regular expressions, something  introduced in 2010 via  XPath 2.0, and yet something never shipped in any browser … or is it?</p><p>…。现在我们有了一种执行强大查询的方法，我们所缺少的就是使用正则表达式的能力，这是在2010年通过XPath2.0引入的，但是在任何浏览器…中都没有提供。是吗？</p><p>  Since the current version is 3.1, I believe there are still plenty of use cases out there for  XPath, but when it comes to  Selenium tests, it looks like everyone is updated with at least v2.0 … but why on earth if  XPath is considered such a powerful tool for crawlers, the browser shouldn’t provide  JS a way to unleash full  XPath potentials too?</p><p>由于当前版本是3.1，我相信仍然有很多关于xpath的用例，但是当谈到Selenium测试时，看起来每个人都至少更新了v2.0…。但是，如果XPath被认为是爬虫程序的强大工具，那么浏览器为什么不能为JS提供一种释放XPath全部潜力的方法呢？</p><p> The best part of  XPath is that virtually no  JS is needed to perform tons of operations in one go, instead of querying one target, verify via  JS its surrounding conditions, then find a possible parent, then … we all know this dance, and it’s boring, slower, and more error prone than any  XPath query could be, as if there’s no target node, there is no target node, nothing to check/filter, the engine does that for us already, and this is  gold!</p><p>Xpath的最好之处在于，几乎不需要JS来一次执行大量操作，而不是查询一个目标，通过JS验证其周围条件，然后找到可能的父级，然后执行…。我们都知道这种舞蹈，它比任何XPath查询都枯燥、缓慢，而且更容易出错，就好像没有目标节点、没有目标节点、没有要检查/过滤的东西一样，引擎已经为我们做了这些，这就是黄金！</p><p>  This is like “ my Xmas wish” for the  Web platform: there is a very powerful querying language that runs natively in the browser and could help reducing a lot of hand written  JS operations to reach desired nodes, plus, there is a language born to satisfy any  DOM tree crawling need, targeting nodes in every direction, and adding  RegExp to the equation would make complex search a “ one liner” so I hope browser vendors would ship ASAP what could be a renascence of  XPath for the modern, and complex,  SPAs and  PWAs world out there.</p><p>这就像Web平台的“我的圣诞愿望”：有一种非常强大的查询语言，它在浏览器中本地运行，可以帮助减少许多手写的JS操作来到达所需的节点，另外，有一种语言天生就能满足任何DOM树搜索需要，它可以定位各个方向的节点，将RegExp添加到等式中将使复杂的搜索成为“一行程序”，所以我希望浏览器供应商能尽快提供XPath的复兴，以适应现代复杂的SPA和PWAS世界。</p><p> Thank you for considering this improvement to the platform, and thanks for reading ♥️</p><p>感谢您考虑对平台进行这次改进，也感谢您阅读♥️</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://webreflection.medium.com/what-happened-to-xpath-1409aa3dbd57">https://webreflection.medium.com/what-happened-to-xpath-1409aa3dbd57</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/发生/">#发生</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/happened/">#happened</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/xpath/">#xpath</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>