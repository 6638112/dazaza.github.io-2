<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NixOS Linux NixOS Linux</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">NixOS Linux<br/>NixOS Linux </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-11 11:38:19</div><div class="page_narrow text-break page_content"><p>$  # Hi! $  # Wondering how to start using Nix? $  # Here are a few examples: $ node -e &#34;console.log(1+1)&#34; node: command not found $  # Interesting, no node on this machine $  # No problem with Nix! $ nix-shell -p nodejs  (nix-shell) $ node -e &#34;console.log(1+1)&#34; 2  (nix-shell) $  # And now our environment has node.  (nix-shell) $  # Without cluttering the user environment! :) $  # Typing &#34;nix-shell -p ...&#34; each time can be tedious. We can do better. $  # We can write everything down in shell.nix $ cat -n shell.nix  1 { pkgs ? import &lt;nixpkgs&gt; {} # here we import the nixpkgs package set  2 }:  3 pkgs.mkShell { # mkShell is a helper function  4 name=&#34;dev-environment&#34;; # that requires a name  5 buildInputs = [ # and a list of packages  6 pkgs.nodejs  7 ];  8 shellHook = &#39;&#39; # bash to run when you enter the shell  9 echo &#34;Start developing...&#34;  10 &#39;&#39;;  11 } $  # Pause the video to understand the shell.nix $  # To enter dev-environment simply run: $ nix-shell Start developing...  (nix-shell) $ node -e &#34;console.log(1+1)&#34; 2  (nix-shell) $  # Now go ahead commit shell.nix to your repository  (nix-shell) $  # and share your development environment with your coworkers $  # For the last example, let us build a minimal docker image with Nix $ cat -n docker-redis.nix  1 { pkgs ? import &lt;nixpkgs&gt; { system = &#34;x86_64-linux&#34;;}  2 }: # nixpkgs package set  3 pkgs.dockerTools.buildLayeredImage { # helper to build docker image  4 name = &#34;nix-redis&#34;; # give docker image a name  5 tag = &#34;latest&#34;; # provide a tag  6 contents = [ pkgs.redis ]; # packages in docker image  7 } $  # Pause the video and take the time to understand docker-redis.nix file $  # Now let&#39;s build the docker image and load it into docker $ nix-build docker-redis.nix -o ./result ... SKIPPING OUTPUT ... /nix/store/1crapx24sjgqm2j1wmq17k6f6a9wy66d-docker-image-nix-redis.tar.gz $ docker load -i ./result Loaded image: nix-redis:latest $ docker images | grep redis debian-redis latest 8366943c77e8 3 days ago 136MB alpine-redis latest aae644cd3417 3 days ago 6.99MB nix-redis latest 30486183a209 50 years ago 45.4MB $  # The size of our docker image is somewhere between a Debian and $  # an Alpine image $  # The redis packaged in nixpkgs is not optimized for small size $  # Let us fix this! $ cat -n redis-minimal.nix  1 { pkgs ? import &lt;nixpkgs&gt; {}  2 }:  3 pkgs.redis.overrideAttrs (old: {  4 # no need for systemd support in our docker image  5 makeFlags = old.makeFlags ++ [&#34;USE_SYSTEMD=no&#34;];  6 # build static binary with musl  7 preBuild = &#39;&#39;  8 makeFlagsArray=(PREFIX=&#34;$out&#34;  9 CC=&#34;${pkgs.musl.dev}/bin/musl-gcc -static&#34;  10 CFLAGS=&#34;-I${pkgs.musl.dev}/include&#34;  11 LDFLAGS=&#34;-L${pkgs.musl.dev}/lib&#34;)  12 &#39;&#39;;  13 # Let&#39;s remove some binaries which we don&#39;t need  14 postInstall = &#34;rm -f $out/bin/redis-{benchmark,check-*,cli}&#34;;  15 }) $  # In redis-minimal.nix we override the default redis build with three changes: $  # 1.) Remove the redis systemd support $  # 2.) Build a statically linked binary with musl $  # 3.) Remove all binaries apart from redis-server $  # Now let&#39;s build the docker image with our newly created minimal redis $ cat -n docker-redis-minimal.nix  1 { pkgs ? import &lt;nixpkgs&gt; { system = &#34;x86_64-linux&#34;;}  2 }: # nixpkgs package set  3 let  4 redisMinimal = import ./redis-minimal.nix { inherit pkgs; };  5 in  6 pkgs.dockerTools.buildLayeredImage { # helper to build docker image  7 name = &#34;nix-redis-minimal&#34;; # give docker image a name  8 tag = &#34;latest&#34;; # provide a tag  9 contents = [ redisMinimal ]; # use redisMinimal package  10 } $  # Let&#39;s build the new docker image now $ nix-build docker-redis-minimal.nix -o ./result  ... SKIPPING OUTPUT ... /nix/store/83zcgs5xvzrgx09iv8s82wkabl8xkr03-docker-image-nix-redis-minimal.tar.gz $ docker load -i ./result Loaded image: nix-redis-minimal:latest $ docker images | grep redis debian-redis latest 8366943c77e8 3 days ago 136MB alpine-redis latest aae644cd3417 3 days ago 6.99MB nix-redis latest 30486183a209 50 years ago 45.4MB nix-redis-minimal latest a21238890680 50 years ago 2.02MB $  # Did we just produce a docker image _smaller_ than Alpine? Interesting! $  # Go tell your friends :) $  # This was a quick taste of what Nix can do. $  # I hope we made you eager to try it for yourself. $  # Happy Nixing!</p><p>$＃嗨！ $＃想知道如何开始使用Nix？ $＃以下是一些示例：$ node -e＆＃34; console.log（1 + 1）＆＃34; node：找不到命令$＃有趣的是，这台机器上没有节点$＃Nix没问题！ $ nix-shell -p nodejs（nix-shell）$节点-e＆＃34; console.log（1 + 1）＆＃34; 2（nix-shell）$＃现在我们的环境有了节点。 （nix-shell）$＃不会使用户环境混乱！ :) $＃输入＆＃34; nix-shell -p ...＆＃34;每次都可能很乏味。我们可以做得更好。 $＃我们可以将所有内容记入shell.nix $ cat -n shell.nix 1 {pkgs？导入＆lt; nixpkgs＆gt; {}＃这里我们导入了nixpkgs软件包集2}：3 pkgs.mkShell {＃mkShell是一个辅助函数4 name =＆＃34; dev-environment＆＃34 ;; ＃需要名称5 buildInputs = [＃和软件包列表6 pkgs.nodejs 7]； 8 shellHook =＆＃39;＆＃39; ＃输入外壳程序9时要运行的bash echo＆＃34;开始开发...＆＃34; 10＆＃39;＆＃39 ;; 11} $＃暂停视频以了解shell.nix $＃只需运行以下命令即可进入dev-environment：$ nix-shell开始开发...（nix-shell）$ node -e＆＃34; console.log（1 +1）＆＃34; 2（nix-shell）$＃现在继续将shell.nix提交到您的存储库（nix-shell）$＃并与您的同事共享您的开发环境$＃对于最后一个示例，让我们使用Nix构建一个最小的docker映像$ cat -n docker-redis.nix 1 {pkgs吗？导入＆lt; nixpkgs＆gt; {system =＆＃34; x86_64-linux＆＃34 ;;} 2}：＃nixpkgs软件包设置了3个pkgs.dockerTools.buildLayeredImage {＃帮助构建docker映像4的助手=＆＃34; nix-redis＆＃34 ;; ＃为Docker映像命名5个标签=＆＃34; latest＆＃34 ;; ＃提供标签6个内容= [pkgs.redis]; ＃docker镜像中的软件包7} $＃暂停视频，花点时间了解docker-redis.nix文件$＃现在让我们构建docker镜像并将其加载到docker $ nix-build docker-redis.nix -o ./result ...跳过输出... /nix/store/1crapx24sjgqm2j1wmq17k6f6a9wy66d-docker-image-nix-redis.tar.gz $ docker load -i ./result加载的图像：nix-redis：latest $ docker images | grep redis debian-redis最新的8366943c77e8 3天前13​​6MB alpine-redis最新的aae644cd3417 3天前6.99MB nix-redis最新30486183a209 50年前45.4MB $＃我们的docker映像的大小介于Debian和$之间＃高山映像＃＃nixpkgs中打包的redis尚未针对小尺寸进行优化$＃让我们修复此问题！ $ cat -n redis-minimal.nix 1 {pkgs？导入＆lt; nixpkgs＆gt; {} 2}：3 pkgs.redis.overrideAttrs（旧：{4＃在我们的docker映像中不需要系统支持5 makeFlags = old.makeFlags ++ [＆＃34; USE_SYSTEMD = no＆＃34;]; 6＃构建带有musl 7 preBuild的静态二进制=＆＃39;＆＃39; 8 makeFlagsArray =（PREFIX =＆＃34; $ out＆＃34; 9 CC =＆＃34; $ {pkgs.musl.dev} / bin / musl- gcc -static＆＃34; 10 CFLAGS =＆＃34; -I $ {pkgs.musl.dev} / include＆＃34; 11 LDFLAGS =＆＃34; -L $ {pkgs.musl.dev} / lib＆＃34; ）12＆＃39;＆＃39; 13＃让我们删除一些不需要的二进制文件14 postInstall =＆＃34; rm -f $ out / bin / redis- {benchmark，check -*，cli}＆＃34 ;; 15}）$＃在redis-minimal.nix中，我们通过以下三个更改覆盖了默认的redis构建：$＃1.）删除redis systemd支持$＃2。）构建静态链接使用musl $＃二进制文件。3.）除去redis-server $＃之外的所有二进制文件现在，让我们使用我们新创建的最小redis $ cat -n docker-redis-minimal.nix 1 {pkgs吗？导入＆lt; nixpkgs＆gt; {system =＆＃34; x86_64-linux＆＃34 ;;} 2}：＃nixpkgs软件包设置3令4 redisMinimal = import ./redis-minimal.nix {继承pkgs; }; 6之5中的pkgs.dockerTools.buildLayeredImage {＃构建Docker映像的助手7名称=＆＃34; nix-redis-minimal＆＃34 ;; ＃为docker image命名为8 tag =＆＃34; latest＆＃34 ;; ＃提供标签9的内容= [redisMinimal]; ＃使用redisMinimal软件包10} $＃现在构建新的docker镜像$ nix-build docker-redis-minimal.nix -o ./result ...跳过输出... / nix / store / 83zcgs5xvzrgx09iv8s82wkabl8xkr03- $ docker load -i ./result加载的图像：nix-redis-minimal：latest $ docker images | | docker-image-nix-redis-minimal.tar.gz $ grep redis debian-redis最新消息3366943c77e8 3天前13​​6MB alpine-redis最新消息aae644cd3417 3天前6.99MB nix-redis最新消息50年前45.4MB nix-redis-minimal最新消息a21238890680 50年前2.02MB $＃我们只是产生了码头工人的图像比高山的_小？有趣！ $＃去告诉你的朋友:) $＃这是Nix可以做的快速尝试。 $＃我希望我们让您渴望自己尝试一下。 $＃快乐的幸福！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://nixos.org/">https://nixos.org/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/nixos/">#nixos</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/nix/">#nix</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>