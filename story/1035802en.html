<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>HopsFS：比AWS S3快100倍HopsFS: 100x Times Faster Than AWS S3</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">HopsFS: 100x Times Faster Than AWS S3<br/>HopsFS：比AWS S3快100倍</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-22 04:35:03</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/96aae29179c61e082ed553ec154d25b1.png"><img src="http://img2.diglog.com/img/2020/11/96aae29179c61e082ed553ec154d25b1.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>TLDR; Many developers believe S3 is the &#34;end of file system history&#34;. It is impossible to build a file/object storage system on AWS that can compete with S3 on cost. But what if you could build on top of S3 a distributed file system with a HDFS API that gives you POSIX goodness and improved performance? That’s what we have done with a cloud-native release of HopsFS that is highly available across availability zones, has the same cost as S3, but has 100X the performance of S3 for file move/rename operations, and 3.4X the read throughput of S3 (EMRFS) for the DFSIO Benchmark (peer reviewed at ACM Middleware 2020).</p><p>TLDR；许多开发人员认为S3是“文件系统历史记录的终结”。在AWS上构建可以与S3竞争成本的文件/对象存储系统是不可能的。但是，如果您可以在S3之上构建具有HDFS API的分布式文件系统，该系统可为您提供POSIX优势并提高性能呢？这就是我们使用云本地版本的HopsFS所做的工作，该版本在可用性区域中具有很高的可用性，成本与S3相同，但是在文件移动/重命名操作方面，S3的性能是S3的100倍，而S3的读取吞吐量是3.4倍（EMRFS）用于DFSIO基准测试（同行评审在ACM中间件2020中进行）。</p><p>    S3 has become the de-facto platform for storage in AWS due to its scalability, high availability, and low cost. However, S3 provides weaker guarantees and lower performance compared to distributed hierarchical file systems. Despite this, many developers erroneously believe that S3 is the end of file system history - there is no alternative to S3, so just re-write your applications to account for its limitations (such as slow and inconsistent file listings, non atomic file/dir rename, closed metadata, and limited change data capture (CDC) support). Azure has built an improved file system,  Azure Data Lake Storage (ADLS) V2, on top of Azure Blob Storage (ABS) service. ADLS provides a HDFS API to access data stored in a ABS container, giving improved performance and POSIX-like goodness. But, until today, there has been no equivalent to ADLS for S3. Today, we are launching HopsFS as part of  Hopsworks.</p><p>    由于其可扩展性，高可用性和低成本，S3已成为AWS中事实上的存储平台。但是，与分布式分层文件系统相比，S3提供的保证较弱且性能较低。尽管如此，许多开发人员错误地认为S3是文件系统历史的终结-没有替代S3的选择，因此只需重新编写应用程序以解决其限制（例如缓慢且不一致的文件列表，非原子文件/目录）重命名，封闭的元数据和有限更改数据捕获（CDC）支持）。 Azure在Azure Blob存储（ABS）服务的基础上构建了改进的文件系统Azure数据湖存储（ADLS）V2。 ADLS提供了HDFS API来访问存储在ABS容器中的数据，从而提高了性能并具有类似POSIX的优势。但是，直到今天，S3还没有等效于ADLS的产品。今天，我们将HopsFS作为Hopsworks的一部分启动。</p><p>  Hierarchical distributed file systems (like HDFS, CephFS, GlusterFS) were not scalable enough or highly available across availability zones in the cloud, motivating the move to S3 as the scalable storage service of choice. In addition to the technical challenges, AWS have priced virtual machine storage and inter-availability zone network traffic so high that no third party vendor could build a storage system that offers a per-byte storage cost close in price to S3.</p><p>  分层的分布式文件系统（如HDFS，CephFS，GlusterFS）在云中的可用区域中的可伸缩性不足或高度不可用，从而促使人们选择S3作为可伸缩存储服务。除了技术挑战之外，AWS还对虚拟机存储和互用性区域网络流量定价过高，以至于没有第三方供应商可以构建一个存储系统，其每字节存储成本的价格接近S3。</p><p> However, the move to S3 has not been without costs. Many applications need to be rewritten as the stronger POSIX-like behaviour of hierarchical file systems (atomic move/rename, consistent file listings, consistent read-after-writes) has been replaced by weakened guarantees in S3. Even simple tasks, such as finding out what files you have, cannot be easily done on S3 when you have enough files, so a  new service was introduced to enable you to pay extra to get a stale listing of your files. Most analytical applications (e.g., on EMR) use  EMRFS, instead of S3, which is a new metadata layer for S3 that provides slightly stronger guarantees than S3 - such as consistent file listings.</p><p> 但是，迁移到S3并非没有代价。许多应用程序需要重写，因为S3中弱化了的保证已取代了分层文件系统中更强的类似于POSIX的行为（原子移动/重命名，一致的文件列表，一致的写后读）。当您拥有足够的文件时，即使简单的任务（例如找出您拥有的文件）也无法在S3上轻松完成，因此引入了一项新服务，使您可以支付更多费用来获取文件的陈旧清单。大多数分析应用程序（例如在EMR上）使用EMRFS而不是S3，这是S3的新元数据层，它提供比S3稍强的保证-例如一致的文件列表。</p><p>  The journey from a stronger POSIX-like file system to a weaker object storage paradigm and back again has parallels in the journey that databases have made in recent years. Databases made the transition from strongly consistent single-host systems (relational databases) to highly available (HA), eventually consistent distributed systems (NoSQL systems) to handle the massive increases in data managed by databases. However,  NoSQL is just too hard for developers, and databases are returning to strongly consistent (but now scalable) NewSQL systems, with databases such as Spanner, CockroachDB, SingleSQL, and MySQL Cluster.</p><p>  从更强大的类似于POSIX的文件系统到较弱的对象存储范式再到返回的过程，与数据库近年来的过程相似。数据库从高度一致的单主机系统（关系数据库）过渡到高可用性（HA），最终从一致的分布式系统（NoSQL系统）过渡到处理由数据库管理的数据的大量增加。但是，对于开发人员而言，NoSQL太难了，并且数据库正在返回具有诸如Spanner，CockroachDB，SingleSQL和MySQL Cluster之类的数据库的高度一致（但现在可扩展）的NewSQL系统。</p><p> In this blog, we show that distributed hierarchical file systems are completing a similar journey, going from strongly consistent POSIX-compliant file systems to object stores (with their weaker consistency models, but high availability across data centers), and back to distributed hierarchical file systems that are HA across data centers, without any loss in performance and, crucially, without any increase in cost, as we will use S3 as block storage for our file system.</p><p>在此博客中，我们展示了分布式分层文件系统正在完成类似的过程，从高度一致的POSIX兼容文件系统到对象存储（具有较弱的一致性模型，但跨数据中心的可用性很高），再回到分布式分层文件跨数据中心的高可用性系统，而不会造成性能损失，并且最重要的是不会增加成本，因为我们将S3用作文件系统的块存储。</p><p>  HopsFS is a distributed hierarchical file system that provides a HDFS API (POSIX-like API), but stores its data in a bucket in S3. We redesigned HopsFS to (1) be  highly available across availability zones in the cloud and (2) to  transparently use S3 to store the file’s blocks without sacrificing the file system’s semantics. The original data nodes in HopsFS have now become stateless workers (part of a standard Hopsworks cluster) that include a new block caching service to leverage faster local VM storage for hot blocks. It is important to note that the cache is a global cache - not a local worker cache found in other vendor’s Spark workers - that includes secure access control to the cache. In our experiments, we show that HopsFS outperforms  EMRFS (S3 with metadata in DynamoDB for improved performance) for IO-bound workloads, with up to 20% higher performance and delivers up to 3.4X the aggregated read throughput of EMRFS. Moreover, we demonstrate that metadata operations on HopsFS (such as directory rename or file move) are up to two orders of magnitude faster than EMRFS. Finally, HopsFS opens up the currently closed metadata in S3, enabling correctly-ordered change notifications with HopsFS’ change data capture (CDC) API and customized extensions to metadata.</p><p>  HopsFS是一个分布式的分层文件系统，提供了HDFS API（类似于POSIX的API），但将其数据存储在S3的存储桶中。我们将HopsFS重新设计为（1）在云中的各个可用区域具有高可用性，并且（2）在不牺牲文件系统语义的情况下透明地使用S3存储文件块。 HopsFS中的原始数据节点现在已成为无状态工作程序（标准Hopsworks集群的一部分），其中包括新的块缓存服务，以利用更快的本地VM存储来处理热块。需要特别注意的是，缓存是全局缓存，而不是其他供应商的Spark工作者中发现的本地工作者缓存，其中包括对缓存的安全访问控制。在我们的实验中，我们显示出HopsFS优于IO绑定工作负载的EMRFS（在DynamoDB中具有元数据的S3，以提高性能），性能提高了20％，并提供了3.4倍的EMRFS聚合读取吞吐量。此外，我们证明了HopsFS上的元数据操作（例如目录重命名或文件移动）比EMRFS快两个数量级。最后，HopsFS在S3中打开当前关闭的元数据，并通过HopsFS的变更数据捕获（CDC）API和元数据的自定义扩展来启用正确排序的变更通知。</p><p> At Logical Clocks, we have leveraged HopsFS’ capabilities to build the industry’s first feature store for machine learning ( Hopsworks Feature Store). The Hopsworks Feature Store is built on  Hops Hive and customized metadata extensions to HopsFS, ensuring strong consistency between the offline Feature Store, the online Feature Store ( NDB Cluster), and data files in HopsFS.</p><p> 在Logical Clocks，我们利用HopsFS的功能构建了业界第一个用于机器学习的功能存储（Hopsworks功能存储）。 Hopsworks Feature Store建立在Hops Hive和对HopsFS的自定义元数据扩展的基础上，从而确保了脱机Feature Store，在线Feature Store（NDB群集）和HopsFS中的数据文件之间的高度一致性。</p><p>        Correctly ordered stream of file system mutation events delivered with low latency to downstream clients by  ePipe.</p><p>        ePipe以正确的顺序将文件系统突变事件流以低延迟交付给下游客户端。</p><p>  File system namespace metadata changes can be transparently replicated to Elasticsearch for low-latency free-text search of the namespace and its extended metadata. This service is provided by Hopsworks.</p><p>  可以将文件系统名称空间元数据更改透明地复制到Elasticsearch，以进行名称空间及其扩展元数据的低延迟自由文本搜索。该服务由Hopsworks提供。</p><p>      Workers in HopsFS securely cache file blocks on behalf of clients using local VM storage. NameNodes are cache-aware and redirect clients to securely read the cached block from the correct worker.</p><p>HopsFS中的工作人员使用本地VM存储代表客户端安全地缓存文件块。 NameNode具有缓存意识，并重定向客户端以安全地从正确的工作程序中读取缓存的块。</p><p>    We compared the performance of EMRFS instead of S3 with HopsFS, as EMRFS provides stronger guarantees than S3 for consisting listing of files and  consistent read-after-updates for objects. EMRFS uses DynamoDB to store a partial replica of S3’s metadata (such as what files/directories are found in a given directory), enabling faster listing of files/dirs compared to S3 and  stronger consistency (consistent file listings and consistent read-after-update, although no atomic rename) .</p><p>    我们将HopfFS与EMRFS而非S3的性能进行了比较，因为EMRFS在组成文件列表和对对象进行一致的更新后读取方面提供了比S3更强的保证。 EMRFS使用DynamoDB存储S3元数据的部分副本（例如在给定目录中找到了哪些文件/目录），与S3相比，可以更快地列出文件/目录，并具有更高的一致性（一致的文件列表和一致的更新后读取） ，尽管没有原子重命名）。</p><p> Here are some selected results from our peer-reviewed research paper accepted for publication at ACM/IFIP Middleware 2020. The paper includes more results than shown below, and for writes, HopsFS is on-average about 90% of the performance of EMRFS - as HopsFS has the overhead of first writing to workers who then write to S3.  HopsFS has a global worker cache (if the block is cached at any worker, clients will retrieve the data directly from the worker)  for faster reads and the HopsFS’ metadata layer is built on NDB cluster for faster metadata operations.</p><p> 以下是我们经过同行评审的研究论文中的一些精选结果，这些研究论文被接受在ACM / IFIP Middleware 2020上发表。该论文包含的结果超过了下表所示的内容，并且对于写作，HopsFS平均约占EMRFS性能的90％- HopsFS的开销是先写给工作人员，然后再写给S3。 HopsFS具有全局工作程序缓存（如果将块缓存在任何工作程序上，则客户端将直接从工作程序中检索数据）以加快读取速度，并且HopsFS的元数据层建立在NDB群集上以加快元数据操作。</p><p>  *Enhanced DFSIO Benchmark Results with 16 concurrent tasks reading 1GB files. For higher concurrency levels (64 tasks), the performance improvement drops from 3.4X to 1.7X.</p><p>  *增强的DFSIO基准测试结果，具有16个并发任务，可读取1GB文件。对于更高的并发级别（64个任务），性能提高从3.4倍降至1.7倍。</p><p> ** As of November 2020, 3500 ops/sec is the maximum number of PUT/COPY/POST/DELETE per second per S3 prefix, while the maximum number of GET/HEAD requests per prefix is 5500 reads/sec. You can increase throughput in S3 by reading/writing in parallel to different prefixes, but this will probably require rewriting your application code and increasing the risk of bugs. For HopsFS (without S3),  we showed that it can reach 1.6m metadata ops/sec across 3 availability zones.</p><p> **截至2020年11月，每个S3前缀每秒最大PUT / COPY / POST / DELETE数量为3500 ops / sec，而每个前缀最大GET / HEAD请求数量为5500次读取/秒。您可以通过并行读/写不同的前缀来提高S3中的吞吐量，但这可能需要重写应用程序代码并增加错误的风险。对于HopsFS（不带S3），我们证明了它可以在3个可用区中达到160万个元数据操作/秒。</p><p> In our  paper published at ICDCS, we measured the throughput of HopsFS when deployed in HA mode over 3 availability zones. Using a workload from Spotify, we compared the performance with CephFS. HopsFS (1.6M ops/sec) reaches 2X the throughput of CephFS (800K ops/sec) when both are deployed in full HA mode. CephFS, however, does not currently support storing its data in S3 buckets.</p><p>在ICDCS上发表的论文中，我们在3个可用区上以HA模式部署时测量了HopsFS的吞吐量。使用Spotify的工作负载，我们将性能与CephFS进行了比较。当两者均以完全HA模式部署时，HopsFS（1.6M ops / sec）达到CephFS吞吐量（800K ops / sec）的2倍。但是，CephFS当前不支持将其数据存储在S3存储桶中。</p><p>  HopsFS is available as  open-source (Apache V2). However, cloud-native HopsFS is currently only available as part of the  hopsworks.ai platform. Hopsworks.ai is a platform for the design and operation of AI applications at scale with support for scalable compute in the form of Spark, Flink, TensorFlow, etc (comparable to Databricks or AWS EMR). You can also connect Hopsworks.ai to a Kubernetes cluster and launch jobs on Kubernetes that can read/write from HopsFS. You connect your cluster to a S3 bucket in your AWS account or on Azure to a Azure Blob Storage bucket. You can dynamically add/remove workers to/from your cluster, and the workers act as part of the HopsFS cluster - using minimal resources, but reading/writing to/from S3 or ABS on behalf of clients, providing access control, and caching blocks for faster retrieval.</p><p>  HopsFS可作为开源（Apache V2）使用。但是，云本地HopsFS当前仅作为hopsworks.ai平台的一部分提供。 Hopsworks.ai是用于大规模设计和运行AI应用程序的平台，并支持Spark，Flink，TensorFlow等形式的可扩展计算（与Databricks或AWS EMR相比）。您还可以将Hopsworks.ai连接到Kubernetes集群，并在Kubernetes上启动可以从HopsFS读取/写入的作业。您将群集连接到您的AWS账户中的S3存储桶，或者将Azure上的连接到Azure Blob存储存储桶。您可以动态地向集群添加/从集群中删除工作程序，并且工作程序充当HopsFS集群的一部分-使用最少的资源，但代表客户端向S3或ABS读写数据，提供访问控制和缓存块以便更快地检索。</p><p>  Ismail Mahmoud, Salman Niazi, Gautier Berthou, Mikael Ronström, Seif Haridi, Jim Dowling.  HopsFS-S3: Extending Object Stores with POSIX-like Semantics and more. ACM/IFIP Middleware 2020.</p><p>  Ismail Mahmoud，Salman Niazi，Gautier Berthou，MikaelRonström，Seif Haridi，Jim Dowling。 HopsFS-S3：使用类似POSIX的语义等扩展对象存储。 ACM / IFIP中间件2020。</p><p> Ismail Mahmoud, Salman Niazi, Mauritz Sundell, Mikael Ronström, Seif Haridi, Jim Dowling. Distributed Hierarchical File Systems strike back in the Cloud. ICDCS 2020.</p><p> Ismail Mahmoud，Salman Niazi，Mauritz Sundell，MikaelRonström，Seif Haridi，Jim Dowling。分布式分层文件系统在云中反击。 ICDCS 2020。</p><p> Ismail Mahmoud, Mikael Ronström, Seif Haridi, Jim Dowling.  ePipe: Near Real-Time Polyglot Persistence of HopsFS Metadata. CC Grid 2019.</p><p> Ismail Mahmoud，MikaelRonström，Seif Haridi，Jim Dowling。 ePipe：HopsFS元数据的接近实时多语种持久性。 CC Grid 2019。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.logicalclocks.com/blog/hopsfs-100x-times-faster-than-aws-s3">https://www.logicalclocks.com/blog/hopsfs-100x-times-faster-than-aws-s3</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/aws/">#aws</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/faster/">#faster</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/s3/">#s3</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>