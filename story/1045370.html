<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Duolingo要求追踪 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在Duolingo要求追踪 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-21 00:53:54</div><div class="page_narrow text-break page_content"><p>Duolingo致力于为所有学习者改善我们应用程序的性能。随着Duolingo随着新课程，功能和数百万其他用户的不断发展，一些团队正在幕后进行工作，以确保事情顺利进行。这篇文章将重点介绍称为“请求跟踪”的后端功能，该功能已导致性能显着提高。</p><p> Duolingo不断地从单片架构（一些大型的，紧密耦合的服务）迁移到微服务架构（许多小型的，松散耦合的服务）。这有其优点，但也有一些折衷，包括操作复杂性和可观察性。</p><p> 例如，使用隔离的服务，可以很容易地记录其请求并进行一些简单的分析，以了解调用在做什么。但是，当许多服务相互作用时（如微服务体系结构那样），您如何获得这种可观察性？为此，我们最近在Duolingo中添加了请求跟踪，这使我们可以观察到并深入了解我们的服务。</p><p>     Jaeger是一个很棒的开源请求跟踪工具，我们于2019年开始使用。有大量的请求跟踪器，但是我们选择Jaeger是因为它对堆栈具有最佳的兼容性和支持（主要是Python和JVM服务）。</p><p> 通常将Jaeger之类的工具配置为跟踪少量请求。这避免了使用繁重的基础架构来分析，报告和存储所有跟踪的需求，并且避免了对所跟踪服务的潜在性能冲击。</p><p> 在早期测试中，我们发现最大的旧版服务效率低下。一种非常常见的内部方法是多次查询Dynamo以获取基本相同的数据，而不是缓存。尽管最初添加时是合理的，但多年来这种模式的效率下降了：查询更多数据，并且被越来越频繁地调用。</p><p> 缓存可以使Duolingo的整体延迟减少10％，同时也可以大幅度降低成本。这是一个很好的迹象，表明请求跟踪将很有用！ </p><p>抽样跟踪对于某些问题（但不是全部问题）非常有用。再现罕见的错误或特定用户的问题仍然是困难的任务，因为通常无法获得跟踪。理想情况下，我们希望跟踪每个请求，而又不需要昂贵的基础架构或导致应用程序运行缓慢。</p><p>  Amazon Web Services（AWS）具有由＆＃34; X-Amzn-Trace-Id＆＃34;支持的请求跟踪功能。标头字段；这通常仅由AWS X-Ray（另一个采样的跟踪器）使用。通过打开访问日志记录，我们可以访问该功能，但并未使用它。</p><p> 但是，此功能支持任意字段。如果我们可以传播标题并添加＆＃34; Caller＆＃34;字段（请参见下文），我们可以为任何请求派生一个调用堆栈！</p><p>  调用5种服务的堆栈，其中svc-A调用svc-B和svc-E。通过我们的微服务传播此自定义标头相对简单。通过AWS Athena和Python将各种应用程序日志条目解析和缝合在一起。这项工作的大部分工作是由刘瑞东作为Duolingo实习项目完成的。</p><p>   处理每个请求上的所有链接数据将不必要地昂贵，但是如果明智地使用（按需），则将非常有价值。这是我们发现的一些按需应用程序：</p><p> 跟踪特定请求。原始请求ID可以通过AWS ELB日志找到，但对于开发人员而言，通常很难找到。但是，由于它是通过带有自定义字段的标头生成的，因此它也可以输出到异常数据中（从错误警报服务中报告），或者与元数据（例如用户ID）进行交叉引用。在我们的例子中，使用Jaeger UI，可以轻松地可视化生成的数据：</p><p>  从AWS ELB日志和自定义标头生成的Jaeger跟踪。延迟和错误调查，例如＆＃34;什么服务导致了从1:13 pm开始的速度降低？＆＃34;通过解析高延迟或失败的呼叫，并与常规行为的快照进行比较，我们可以找到可疑服务。然后，我们使用排名算法（例如PageRank）来查找最可能的服务： </p><p>服务，按造成中断的可能性排序。 可视化服务依赖关系，并按流量，请求和响应大小或其他元数据进行过滤。 这可能会导致令人惊讶的见解，例如发现未压缩的响应，重复的错误或微服务之间的延迟。  带有过滤选项的服务依赖关系的可视化。 在“可观察性和追踪”空间中正在进行令人激动的工作！ 特别是，我们计划采用即将推出的OpenTelemetry标准，包括AWS在内的许多供应商也支持该标准。 Grafana Tempo类似于Always-On跟踪（同时开发）； 它不仅是对我们方法的验证，而且可能是一种统一和标准化该功能基础架构的方法。  对Duolingo的软件工程感兴趣？ 我们正在招聘全职和实习职位！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.duolingo.com/improving-the-duolingo-experience-with-request-tracing/">https://blog.duolingo.com/improving-the-duolingo-experience-with-request-tracing/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/tracing/">#tracing</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/服务/">#服务</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1043269.html"><img src="http://img2.diglog.com/img/2021/1/thumb_472913719af7bc7d20e52f5bcc72c30d.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1043269.html">新加坡现在表示，当地执法部门可以访问COVID-19联系人跟踪数据。 其78％的人口已采用TraceTogether应用和可穿戴式代币 </a></div><span class="my_story_list_date">2021-1-5 3:23</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035339.html"><img src="http://img2.diglog.com/img/2020/11/thumb_fa090186754a6a8de7fc9a59d0fc0917.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035339.html">挪威新冠肺炎联系人追踪APP被数据保护局禁止</a></div><span class="my_story_list_date">2020-11-16 7:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033968.html"><img src="http://img2.diglog.com/img/2020/11/thumb_7b8a4eaf6881bef7433cce84816b56f7.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033968.html">巴比伦路径追踪的背景与实现</a></div><span class="my_story_list_date">2020-11-9 10:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030507.html"><img src="http://img2.diglog.com/img/2020/10/thumb_0a8d081a8b12901a554b294184727000.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030507.html">由于缺乏单一的全国性应用程序，美国的联系人追踪一直受到阻碍，10个州和华盛顿特区创建了自己的应用程序，而大多数州根本没有应用程序</a></div><span class="my_story_list_date">2020-10-22 18:38</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>