<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>宿醉，在arm64/ppc64le/x86_64 Linux和x86_64 Mac上运行Win64/Win32应用程序</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">宿醉，在arm64/ppc64le/x86_64 Linux和x86_64 Mac上运行Win64/Win32应用程序</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-02 08:58:46</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/bc91e48814f073ca121501ea5751bfa1.png"><img src="http://img2.diglog.com/img/2020/11/bc91e48814f073ca121501ea5751bfa1.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This is Hangover, a project started by Stefan Dösinger and André Hentschel to runx86_64/x86_32 Windows applications on aarch64/ppc64le/x86_64 Wine.</p><p>这是一个由Stefan Dösinger和AndréHentschel发起的项目，旨在aarch64/ppc64le/x86_64Wine上运行x86_64/x86_32 Windows应用程序。</p><p>  We have one Wine on the host in 64-bit only mode and two on the guest side for 64-bit and 32-bit.Inbetween sits a modified version of Qemu that runs the x86(_64) code.To glue it all together there are thunks, lot&#39;s of them handwritten to understand in which situationa pointer is valid and in which situation it could point to a random address and should be ignored,and how to handle writes to resulting structures in case of errors etc.</p><p>我们在主机上有一个64位纯模式的Wine，在客户端有两个64位和32位模式的Wine。中间是运行x86(_64)代码的QEMU的修改版本。为了将它们粘合在一起，有很多块是手写的，以了解指针在哪种情况下是有效的，在什么情况下它可能指向随机地址而应该被忽略，以及在出现错误的情况下如何处理对结果结构的写入，等等。</p><p>  Hangover currently runs a small number of 32 bit and 64 bit Windows applications.A list of applications the authors have tested is listed below. Other applications may work,but don&#39;t expect too much. Direct3D is working if you have a host OpenGL implementation thatsupports regular desktop GL. Wine&#39;s d3d implementation currently does not support OpenGL:ES wellenough to be usable. Once this changes, Hangover will support it without any changes.</p><p>“宿醉”目前运行少量的32位和64位Windows应用程序。下面列出了作者测试过的应用程序列表。其他应用程序也可以使用，但不要期望太高。如果您的主机OpenGL实现支持常规桌面GL，则Direct3D可以正常工作。Wine的d3d实现目前还不能很好地支持OpenGL：ES，无法使用。一旦这一点改变，Hangover将在没有任何改变的情况下支持它。</p><p> Debugger support is nonexistent and exception handling has known bugs.Due to these reasons copy protection and anti-cheat systems are likelyto be in worse shape than in reguar Wine.</p><p>调试器支持是不存在的，异常处理也有已知的缺陷。由于这些原因，复制保护和反作弊系统可能比普通的Wine更糟糕。</p><p> You can generally expect 64 bit applications to be in better shape than 32 bitapplications because no data structure thunking is necessary.</p><p>您通常可以期望64位应用程序比32位应用程序状态更好，因为不需要数据结构thunking。</p><p>  Hangover is tested on aarch64 Linux, ppc64le Linux, x86_64 Linux and x86_64 MacOS.No Intel x86 libraries are needed on the host system. No 32 bit multilib is required.</p><p>宿醉在aarch64 Linux、ppc64le Linux、x86_64 Linux和x86_64 MacOS上进行了测试。主机系统上不需要英特尔x86库。不需要32位的multilib。</p><p>       In theory everything should be built by running  make. In practise you&#39;ll probably run into somebugs in our build system. Parallel builds should work, but if they fail try a non-parallel one first.</p><p>理论上，一切都应该通过运行make来构建。在实践中，您可能会在我们的构建系统中遇到一些错误。并行构建应该可以工作，但如果它们失败了，请先尝试非并行构建。</p><p> Some 32 bit programs and DLLs built with mingw depend on  libgcc_s_sjlj-1.dll.You can symlink the DLL from your mingw installation to  build/qemu/x86_64-windows-user/qemu_guest_dll32.</p><p>某些使用mingw构建的32位程序和DLL依赖于libgcc_s_sjlj-1.dll。</p><p>     Wine&#39;s programs can be found in  build/wine-guest/programs/* and  build/wine-guest32/programs/*. build/wine-[guest|guest32]/ also contain PE builds of Wine&#39;s tests.</p><p>WINE的程序可以在build/win-Guest/Programs/*和build/win-guest32/Programs/*中找到。Build/win-[Guest|guest32]/还包含Wine的测试的PE版本。</p><p>  Don&#39;t expect this to be fast. The main bottleneck at the moment is the speed of the code qemugenerates from the input x86 code. To provide a rough comparison, my Nvidia Shield Android TVdevice (running a regular desktop Linux, not Android) runs games from the late 1990s to early2000s at playable speed. The DirectX 9 SDK samples run fairly well because they contain littlelogic of their own and just call out of the VM into d3d, so all the heavy lifting is done natively.Warhammer 40k: Dawn of War starts a fresh game at around 30 fps but slows to a crawl as soon asa few units are built.</p><p>不要指望这会很快。目前的主要瓶颈是qemu从输入的x86代码生成代码的速度。粗略比较一下，我的Nvidia Shield Android电视设备(运行的是普通桌面Linux，而不是Android)以可播放的速度运行20世纪90年代末到21世纪初的游戏。DirectX 9 SDK示例运行得相当好，因为它们本身包含很少的逻辑，只需从VM调用进入d3D，所以所有的繁重任务都是本地完成的。《战锤40k：战争的黎明》以大约30fps的速度开始一款新游戏，但一旦构建了几个单位，就会变得非常缓慢。</p><p>  The host Wine is always built as a 64 bit application. Hangover handles 32 bit applications bytranslating structures passed between the application and Wine. The LLP64 model of Windows keepsmost structures compatible between 32 and 64 bit, but translating is still a big effort.</p><p>主机Wine始终构建为64位应用程序。Resgover通过转换应用程序和Wine之间传递的结构来处理32位应用程序。Windows的LLP64模型使大部分结构在32位和64位之间保持兼容，但是转换仍然是一项很大的工作。</p><p> The address space is limited to 4 GB by reserving every address below 4 GB, then calling mmap toreserve remaining space until we run out of free address space and then freeing up the bottom 4 GBagain. Most host Wine libraries are loaded earlier above 4 GB to keep the previous space below 4 GBas free as possible. The drawback of this is that starting a new process takes about 2 seconds.</p><p>地址空间被限制为4 GB，方法是保留低于4 GB的每个地址，然后调用mmap保留剩余空间，直到我们用完可用地址空间，然后再次释放底部的4 GB。大多数主机Wine库都在较早的时候加载到4 GB以上，以使之前低于4 GB的空间尽可能保持空闲。这样做的缺点是启动一个新进程需要大约2秒。</p><p> Wine sees every process as a 64 bit process, so its WoW64 layer is not active. This will work OK forpure 32 bit or pure 64 bit applications, but it will cause problems for mixed applications thatexpect a distinction between e.g. C:\windows\system32 and C:\windows\syswow64.</p><p>WINE将每个进程视为64位进程，因此其WOW64层处于非活动状态。这对于纯32位或纯64位应用程序可以正常工作，但对于混合应用程序(例如C：\WINDOWS\system32和C：\WINDOWS\syswow64)会产生问题。</p><p>  Support for Win16 does not yet exist, but should be possible by using Wine&#39;s regular Win16-&gt;Win32thunks and taking it from there. Some changes to the way Wine sets up 16 bit protected modesegments will be needed.</p><p>目前还不存在对Win16的支持，但通过使用Wine&#39；的常规Win16-&gt;Win32thunks并从那里获取它，应该可以实现。需要对Wine设置16位保护模式的方式进行一些更改。</p><p> For vm86 (DOS) support install  dosbox on your host. Wine will call it for you.</p><p>要获得vm86(DOS)支持，请在主机上安装DOSBOX。葡萄酒会帮你叫醒的。</p><p>  Support for 32 bit host systems is not implemented. It should not be hard to do, but you willprobably have to put some effort into making sure the address space layout works OK and the loadaddress of the main .exe file remains free until qemu loads it. There&#39;s initial work for arm32already.</p><p>未实施对32位主机系统的支持。这应该不难做到，但是您可能需要付出一些努力来确保地址空间布局工作正常，并且在QEMU加载之前，主.exe文件的加载地址保持空闲。已经有了针对arm32的初步工作。</p><p>  Porting to little endian host architectures should be fairly simple. You will have to replace afew bits of host specific assembler code. The compiler will make you aware of those places through#error statements in ifdef guards.</p><p>移植到低端主机体系结构应该相当简单。您将不得不替换一些主机特定的汇编器代码。编译器将通过ifdef卫士中的#error语句让您知道这些位置。</p><p> If you want this to work on big endian platforms forget about it. It would require converting every Win32 structure, not just those with pointers or pointer sized integers in it.It will not happen.</p><p>如果您想让它在大的字节顺序平台上工作，那就别管它了。这将需要转换每个Win32结构，而不仅仅是其中包含指针或指针大小的整数的结构。这是不会发生的。</p><p>  This is a list of applications the authors tested. There is hope that they will work for you as well.If an application is marked as &#34;installer: no&#34; that means that the installer doesn&#39;t work for somereason. You&#39;ll have to install it elsewhere and copy the directory and registry keys.</p><p>这是作者测试的应用程序列表。希望它们也能为您工作。如果应用程序标记为Installer：no，这意味着该安装程序不适用于Smereason。您必须将其安装到别处，并复制目录和注册表项。</p><p> Age of Wonders: Installer works, but 1.36 update does not install. Game version 1.36 works</p><p>奇迹年代：安装程序可以工作，但不能安装1.36更新。游戏版本1.36工作正常。</p><p>  The Settlers II 10th Anniversary: Installer works, updater works, game runs but is too slow to be playable. Needs native d3dx9 and d3dcompiler libs.</p><p>定居者II 10周年纪念：安装程序工作，更新程序工作，游戏运行，但速度太慢，不能玩。需要本机d3dx9和d3d编译库。</p><p>  Worms 2: Installer fails because it needs Win16, game is playable. Game needs Audio CD support, otherwise it will complain that it doesn&#39;t find the CD.</p><p>蠕虫2：安装失败，因为它需要Win16，游戏可以玩。游戏需要音频CD支持，否则它会抱怨找不到CD。</p><p> Worms Armageddon: Works with the right Wine settings. Despite having the same graphics as Worms 2 it is noticeably slower but borderline playable.</p><p>蠕虫世界末日：使用正确的葡萄酒设置。尽管有与蠕虫2相同的图形，但它的速度明显较慢，但可以边缘播放。</p><p>    To run Wine&#39;s tests inside Hangover you can use scripts/hangover-test.sh as $WINETEST_WRAPPER. Youalso have to create an empty file server/wineserver (just touch it, it doesn&#39;t need anything special)to make Wine&#39;s tools/runtest happy. See comments in scripts/hangover-test.sh for more details</p><p>要在Hangover内部运行Wine的测试，可以使用脚本/hangover-test.sh作为$WINETEST_Wrapper。您还必须创建一个空的文件服务器/wineserver(只需触摸它，它不需要任何特殊设置)才能使Wine的工具/runtest满意。有关更多详细信息，请参见script/hangover-test.sh中的注释</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/AndreRH/hangover">https://github.com/AndreRH/hangover</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/x86/">#x86</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/win64/">#win64</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/wine/">#wine</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1032274.html"><img src="http://img2.diglog.com/img/2020/10/thumb_b25bd6c3aa1ce3fe07da872ea5f6a4e0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032274.html">Value将他们的Linux游戏容器源代码放在GitLab上</a></div><span class="my_story_list_date">2020-10-30 21:27</span></div><div class="col-sm"><div><a target="_blank" href="/story/1032172.html"><img src="http://img2.diglog.com/img/2020/10/thumb_8e14106858486c437024bab167895bd9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032172.html">Linux游戏将会变得更好</a></div><span class="my_story_list_date">2020-10-30 6:35</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031923.html"><img src="http://img2.diglog.com/img/2020/10/thumb_99194f67e5542018f2c1c325832cade0.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031923.html">Linux可执行文件中有什么？</a></div><span class="my_story_list_date">2020-10-29 12:5</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031876.html"><img src="http://img2.diglog.com/img/2020/10/thumb_6b6739de6498c22a43a4a89275ba0e7b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031876.html">Dn2l-Dos Navigator开源项目的Linux移植</a></div><span class="my_story_list_date">2020-10-29 10:29</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>