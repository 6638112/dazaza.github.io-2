<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Postgres 14：将环绕声故障添加到真空中 Postgres 14: Add wraparound failsafe to VACUUM</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Postgres 14: Add wraparound failsafe to VACUUM<br/>Postgres 14：将环绕声故障添加到真空中 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-10 07:53:49</div><div class="page_narrow text-break page_content"><p>Add wraparound failsafe to VACUUM.  Add a failsafe mechanism that is triggered by VACUUM when it notices that the table&#39;s relfrozenxid and/or relminmxid are dangerously far in the past.  VACUUM checks the age of the table dynamically, at regular intervals.  When the failsafe triggers, VACUUM takes extraordinary measures to finish as quickly as possible so that relfrozenxid and/or relminmxid can be advanced.  VACUUM will stop applying any cost-based delay that may be in effect.  VACUUM will also bypass any further index vacuuming and heap vacuuming -- it only completes whatever remaining pruning and freezing is required.  Bypassing index/heap vacuuming is enabled by commit  8523492d, which made it possible to dynamically trigger the mechanism already used within VACUUM when it is run with INDEX_CLEANUP off.  It is expected that the failsafe will almost always trigger within an autovacuum to prevent wraparound, long after the autovacuum began. However, the failsafe mechanism can trigger in any VACUUM operation. Even in a non-aggressive VACUUM, where we&#39;re likely to not advance relfrozenxid, it still seems like a good idea to finish off remaining pruning and freezing.   An aggressive/anti-wraparound VACUUM will be launched immediately afterwards.  Note that the anti-wraparound VACUUM that follows will itself trigger the failsafe, usually before it even begins its first (and only) pass over the heap.  The failsafe is controlled by two new GUCs: vacuum_failsafe_age, and vacuum_multixact_failsafe_age.  There are no equivalent reloptions, since that isn&#39;t expected to be useful.  The GUCs have rather high defaults (both default to 1.6 billion), and are expected to generally only be used to make the failsafe trigger sooner/more frequently.  Author: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; Author: Peter Geoghegan &lt;pg@bowt.ie&gt; Discussion: https://postgr.es/m/CAD21AoD0SkE11fMw4jD4RENAwBMcw1wasVnwpJVw3tVqPOQgAw@mail.gmail.com Discussion: https://postgr.es/m/CAH2-WzmgH3ySGYeC-m-eOBsa2=sDwa292-CFghV4rESYo39FsQ@mail.gmail.com</p><p>将环绕声故障添加到真空。添加故障安全机制，当它注意到表＆＃39; s Relfrozenxid和/或Relminmxid过去危险时，它会被真空触发。真空以定期的间隔动态地检查表格的年龄。当故障安全触发器时，真空采取非凡的措施，尽可能快地完成，以便可以先进，以便可以提前使用Relfrozenxid和/或Relminmxid。真空将停止应用任何可能有效的基于成本的延迟。真空还将绕过任何进一步的指标吸尘和堆吸尘 - 它只能完成需要剩余的沉淀和冻结。通过提交8523492D绕过索引/堆真空，这使得可以动态触发在使用Index_Cleanup运行时已在真空中使用的机制。预计故障安全几乎始终触发Autovacuum内的触发，以防止包裹，在Autovacuum开始后长。但是，故障安全机制可以在任何真空操作中触发。即使在一个非侵略性的真空中，我们也可以在那里＆＃39;重新开始前进，它仍然看起来像完成剩余的修剪和冻结的好主意。发生攻击性/反环绕式真空将立即启动。请注意，遵循的反环绕性真空本身将触发故障安全，通常在其之前首先（并且仅）通过堆。故障安全由两个新的GUCS：VACUUM_FAILSAFE_AGE和VACUUM_MULLIXACT_FAILSAFE_AGE控制。没有等效的重选，因为它是必要的。 GUCS具有相当高的默认值（默认为16亿），预计通常仅用于更快地使用故障安全触发器。作者：Masahiko Sawada＆lt; sawada.mshk@gmail.com& gt;作者：Peter Geoghegan＆lt; pg@bowt.ie& gt;讨论：https://postgr.es/m/cad21aod0ske11fmw4jd4renawbmcw1wasvnwpvww3tvqpoqgaw@mail.gmail.com讨论：https：//postgr.es/m/cah2-wzmgh3ysgyec-m-chv4resyo39fsq@mail.gmail.com </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=1e55e7d1755cefbb44982fbacc7da461fa8684e6">https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=1e55e7d1755cefbb44982fbacc7da461fa8684e6</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/故障/">#故障</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/真空/">#真空</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>