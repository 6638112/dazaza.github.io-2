<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Temporal Tables PostgreSQL扩展 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Temporal Tables PostgreSQL扩展 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-11 14:45:59</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/b335c0b1f228ca05658c7a83be2f7191.png"><img src="http://img2.diglog.com/img/2021/4/b335c0b1f228ca05658c7a83be2f7191.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>时间表是记录行为有效期的时间段的表。有两种类型的时间段：应用程序周期（也称为有效时机业务 - 时间）和系统时段（也称为事务 - 时间）。</p><p> 系统时段是一个列（或一对列），其系统维护值包含行从Databaseperspective有效的时间段。将行插入此类表时，系统会自动生成句点开始和结尾的值。从系统周期时间表更新ordelete行时，旧行被归档为其他表，该表被称为历史表。</p><p> 应用程序时期是一个列（或一对列），其具有anapplication-valual的值，该值包含从应用程序透视图中的行无效时的时间段。此列由Anapplication填充。</p><p> 请注意，对于单个事实，这两个时间段不一定是相同的。例如，您可能有一个存储有关历史或偶数事实的数据的时间表。这些事实的应用程序周期与SystemPeriod不同，当我们在表中添加或修改事实时设置的SystemPeriod。</p><p>    使用Clark Dave撰写的时间TablExeQuals，有一个奇妙的Tutorialon使用和查询PostgreSQL中的时间表。</p><p>    如果您正在运行Linux，则安装扩展的最简单方法即可浏览PGXN客户端。</p><p>  或者，如果您愿意坚持使用良好的旧制作，您可以设置突出邮件： </p><p>您需要使用GNU Make，这可能会在您的系统上安装为Gmake：  确保您安装了pg_config和路径中的pg_config。 如果使用Apackage Management System（如RPM）安装PostgreSQL，请确保还安装了-Devel包。 如有必要，请告诉构建过程，其中tofind it：  您需要使用超级用户运行测试套件，例如默认和＃34; Postgres＆＃34; 超级用户：  如果您正在运行Windows，则需要在Visual Studio命令提示符中运行MSBuildCommand。  可用的平台是x64和x86，配置为9.2,9.3,9.4和9.5。  然后，您必须将DLL从项目中复制到PostgreSQL＆＃39; s libdirectory和.sql和.control文件到目录共享\扩展名。  安装扩展后，您可以将其添加到数据库中。 连接到Adatabase作为超级用户，执行此操作： </p><p>必须在插入或更新或删除在Asystem-句时间表上触发功能。您要指定系统时期列名称，Ahistory表名称和＆＃34;调整＆＃34;参数（请参阅更新数据部分fordetail）。</p><p>    要使此表系统 - 期间时间表我们应该首先添加ASYSTEM期间列：</p><p>  然后我们需要一个包含我们表的存档行的历史表。创建它的最简单方法是使用like语句：</p><p>  请注意，历史表不必具有与理论者相同的结构。例如，您可能希望存档原始列的某些列，但忽略其他列，或者历史表可能包含原始表中不需要某些有用的信息。 Ahistory表的唯一要求是：</p><p> 历史表必须包含具有与原始文件相同的名称anddata类型的系统时期列。</p><p> 如果历史表和原始历史表都包含列，则在这两个表中，此列的Thata类型必须相同。</p><p> 最后，我们在我们的表格上创建一个触发器，以将其与历史表链接： </p><p>在每行执行过程版本控制（＆＃39; sys_period＆＃39;＆＃39;＆＃39;＆＃39;雇员_history＆＃39;，＆＃39;＆＃39;＆＃39;，＆＃39;＆＃39;，，更新或删除employees上的插入或更新或删除</p><p>  对于将数据插入系统 - 周期时间表中的用户与常规表中的数据相似。例如，下列数据于2006年8月8日至表员工（桌面）是：</p><p> 插入员工（姓名，部门，薪水）值（＆＃39;伯纳尔马克思＆＃39;＆＃39;孵化场和调理中心＆＃39; 10000）;插入员工（姓名，部门，薪水）值（＆＃39; Lenina Crowne＆＃39;＆＃39;孵化场和调理中心＆＃39; 7000）;插入员工（姓名，部门，薪水）值（＆＃39;赫尔默霍尔斯沃森＆＃39;＆＃39;情感工程学院＆＃39;，18500）;</p><p>     sys_period列的开始表示行成为当前行的时间。触发器通过使用Current_Timestamp值来生成此值，该值在其在Thecurrent事务中执行第一个数据更改语句时的时间。</p><p>  当用户更新系统周期的行中列的值时，触发器将旧行的副本插入关联的历史记录中。如果单个事务对同一行进行多次更新，则会生成历史记录行。例如，以下数据在表员工中onfegrucons 27,2007更新：</p><p>       当多个事务更新同一行时，可能会发生更新冲突。例如，两个事务A和B同时执行针对employees表的语句：</p><p>     在时间t4，触发器必须将行的SYS_PERIOD列的开始设置为T1和将以下行插入历史表： </p><p>但是，T2＆gt;无法插入t1和行。在这种情况下，UpdateAt时间T4将失败，SQLState 22000将失败。为避免此类故障，您可以释放＆＃34;调整＆＃34;触发器的参数并将其设置为＆＃34;真＆＃34;然后，在时间t4的Startof Sys_Period列被设置为时间t2 plus增量（小时间间隔，通常等于1微秒）。经过此调整和交易A的完成后，员工表如下所示：</p><p>     当用户从系统周期时间表中删除数据时，触发器addsrows到关联的历史表。例如，以下数据于2012年12月24日从表员工中丢弃：</p><p>       您可能希望设置自定义系统时间才能伪造触发器。它对于从系统时间创建数据仓库是有用的，您希望使用该时间。</p><p>  要将其恢复回默认行为，请使用null调用函数作为Itsargument。</p><p>  如果在呈现的事务中发出set_system_time函数，则撤消所有更改。如果事务已提交，则TheChanges将持续到会话结束。</p><p>   在上面的示例中，我们使用的语句创建历史表，有时会更好地使用此任务的继承。例如：</p><p> 创建表员工_History（名称文本不是null，部门文本，薪资数字（20,2），sys_period tstzrange not null）; </p><p>历史表始终成长，因此消耗了越来越多的洞穴。您可以使用几种方法从历史表中修剪旧数据：</p><p> 使用历史表中的分区和分隔旧分区（用于表格分析上的MoreInformation，请参阅PostgreSQL文档）。</p><p>   您还可以为历史表设置另一个表空间，以将其移动到DepainerStorage上。</p><p>  可以使用系统周期时间表进行数据审核。 forexample，您可以添加以下触发器以保存已修改的用户的用户，该命令当前行：</p><p> 创建功能员工_modify（）返回触发器，因为$$开始新。 user_modified = session_user;返回新的;结束; $$语言plpgsql;创建触发器雇员_modifyBefore插入或更新Employees的每行执行过程employees_modify（）;创建功能员工_delete（）返回触发器，因为$$开始新。 user_deleted = session_user;返回新的;结束; $$语言plpgsql;在每个行执行过程employees_delete（）中，创建触发器员工_deletebefore插入</p><p>  在BSD 2-Clauselicense的条款下分发时间表扩展。请参阅许可证或http://www.opensource.org/licenses/bsd-license.php formore详细信息。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/arkhipov/temporal_tables">https://github.com/arkhipov/temporal_tables</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/tables/">#tables</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>