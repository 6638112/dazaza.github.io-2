<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>通过Quectel EG25-G调制解调器上的AT命令以root用户身份执行代码（2021年）Code execution as root via AT commands on the Quectel EG25-G modem (2021)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Code execution as root via AT commands on the Quectel EG25-G modem (2021)<br/>通过Quectel EG25-G调制解调器上的AT命令以root用户身份执行代码（2021年）</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-14 20:15:34</div><div class="page_narrow text-break page_content"><p>As I mentioned towards the end of my  previous blog post, where I detailed running my blog on the PinePhone&#39;s GSM/WWAN/GPS modem, I suspected that the daemon responsible for parsing AT commands on the modem&#39;s side is susceptible to OS command injection, as it uses a  lot of  system() calls. My hunch turned out to be true.</p><p>正如我在上一篇博文末尾提到的，我详细介绍了在PinePhone上运行我的博客&#39；在GSM/WWAN/GPS调制解调器上，我怀疑负责解析调制解调器上AT命令的守护进程&#39；s端易受OS命令注入的影响，因为它使用了大量的system（）调用。我的直觉证明是真的。</p><p>     Among other channels, the PinePhone communicates with the Quectel modem by sending  AT commands to the modem over a serial line -  /dev/ttyUSB2 on the PinePhone&#39;s side and  /dev/ttyHSL0 on the modem&#39;s side.</p><p>在其他通道中，PinePhone通过PinePhone上的串行线-/dev/ttyUSB2&#39；s侧和调制解调器上的/dev/ttyHSL0&#39；s方。</p><p>  The modem, which runs a  full Linux install separate from the PinePhone&#39;s main OS, receives these commands, parses them, and executes them according to program logic. After this, the modem either returns  OK or  ERROR over the serial line back to the PinePhone. The daemon primarily responsible for this is  atfwd_daemon.</p><p>调制解调器，与PinePhone#39分开运行完整的Linux安装；s主操作系统，接收这些命令，解析它们，并根据程序逻辑执行它们。之后，调制解调器会通过串行线路返回OK（正常）或ERROR（错误）到手机。主要负责此操作的守护程序是atfwd_守护程序。</p><p>    Getting the daemon is easy. It&#39;s possible to set up   adb access and extract it using  adb. It&#39;s also possible to simply extract it from the firmware&#39;s update packages, as it&#39;s not encrypted in any way.</p><p>获取守护进程很容易。它&#39；设置adb访问并使用adb提取是可能的。它&#39；也可以简单地从固件中提取它&#39；更新软件包，因为它&#39；它没有任何加密方式。</p><p>  Loading  atfwd_daemon in Ghidra reveals that the executable uses  system() in 233 different places across the file. That&#39;s… quite a lot.</p><p>在Ghidra中加载atfwd_守护进程表明，可执行文件在文件的233个不同位置使用system（）。那&#39；s、 很多。</p><p>  While using  system() with user input is never a good idea, most of the calls cannot be exploited due to being hardcoded or the fact that user input is converted to an integer using  sprintf():</p><p>虽然将system（）与用户输入一起使用从来都不是一个好主意，但大多数调用都无法被利用，因为它们是硬编码的，或者用户输入使用sprintf（）转换为整数：</p><p>    However, there are a few places where user input is  sprintf()-d as  %s and no checks or sanitization is performed on user input.</p><p>但是，在一些地方，用户输入是sprintf（）-d，作为%s，并且没有对用户输入执行检查或清理。</p><p>      Here we can see that  param1[1] is being formatted as  ipth_dme -dmacc %s &amp;, which is then passed to  system(). What&#39;s interesting to note here is that  ipth_dme does not exist on the system at all, so this program would never run.</p><p>在这里，我们可以看到param1[1]被格式化为ipth_dme-dmacc%s；，然后将其传递给system（）。什么&#39；值得注意的是，系统上根本不存在ipth_dme，因此该程序永远不会运行。</p><p>  Traversing the program execution flow, we can see that the switch case in the previous screenshot is triggered when some part of user input begins with &#34;dmacc&#34;. This is checked in a routine called  quectel_parse_fumo_cfg_cmd_params():</p><p>遍历程序执行流程，我们可以看到上一个屏幕截图中的切换情况是在用户输入的某些部分以&#34开头时触发的；dmacc&#34；。这是在一个名为quectel_parse_fumo_cfg_cmd_params（）的例程中检查的：</p><p>      Going further up the program flow, we can see that the command in question which parses this input is  +QFUMOCFG:</p><p>进一步向上看，我们可以看到解析该输入的相关命令是+QFUMOCFG：</p><p>      From this, we can deduce that arbitrary command execution is possible. We can, for example, use backticks to execute our commands in a subshell. As an example, to reboot the modem:</p><p>由此，我们可以推断任意命令的执行是可能的。例如，我们可以使用backticks在子shell中执行命令。例如，要重新启动调制解调器：</p><p>    Due to the fact that the daemon runs as root, the code is also being executed as the root user on the modem.</p><p>由于守护进程以root用户身份运行，因此代码也以root用户身份在调制解调器上执行。</p><p>  As an example, in this  Asciinema recording, I  cat /etc/passwd and run  id, and return the data to the PinePhone&#39;s OS over a serial line:</p><p>例如，在这个Asciinema记录中，我cat/etc/passwd并运行id，然后将数据返回到PinePhone&#39；通过串行线路传输操作系统：</p><p>    It&#39;s very possible that this vulnerability affects other Quectel products as well, as firmware is commonly reused, but I do not possess other hardware to test it on.</p><p>它&#39；很可能这个漏洞也会影响其他Quectel产品，因为固件通常会被重用，但我没有其他硬件来测试它。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/eg25/">#eg25</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/execution/">#execution</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/命令/">#命令</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1072461.html"><img src="http://img2.diglog.com/img/2022/1/thumb_fb508e6cf18e791c484b3c2c3c695664.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072461.html">代码审查方式</a></div><span class="my_story_list_date">2022-1-9 21:58</span></div><div class="col-sm"><div><a target="_blank" href="/story/1072457.html"><img src="http://img2.diglog.com/img/2022/1/thumb_44cc3c562cfb3896f12902316e131f35.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072457.html">绕过门密码</a></div><span class="my_story_list_date">2022-1-9 21:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1072403.html"><img src="http://img2.diglog.com/img/2021/8/thumb_85e5202f76bb0f0b03afa2d1ee761760.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072403.html">明天新 OpenAI 代码编写技术的现场演示</a></div><span class="my_story_list_date">2021-8-10 4:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1072393.html"><img src="http://img2.diglog.com/img/2021/8/thumb_6b556d6fd050f0203839396803172378.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072393.html">联合国 IPCC 关于气候变化的报告听起来像是地球的“红色代码”</a></div><span class="my_story_list_date">2021-8-10 3:47</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>