<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>关于GraphQL中“可嵌入字段”的建议</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">关于GraphQL中“可嵌入字段”的建议</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-27 04:53:05</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/30781efdb874f4497edbc80788b80215.png"><img src="http://img2.diglog.com/img/2020/9/30781efdb874f4497edbc80788b80215.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>我想为GraphQL提出一个新特性的建议，不是附加到官方规范中，而是作为GraphQL服务器可能决定支持的一个可选特性(类似于GraphQL光标连接规范)。</p><p>这篇文章是了解GraphQL社区是否支持此功能的基础工作的一部分。如果有，只有那时我才会把它作为新的问题提交给GraphQL规范回收站进行彻底的讨论，并提出成为它的拥护者。</p><p>注意：POP的GraphQL已经支持此功能。在本文中，请单击GraphiQL客户端上的“运行”按钮，以执行查询并查看预期的响应。</p><p>可嵌入字段是一种语法构造，它允许使用胡子语法{{field}}为同一类型的另一个字段解析参数内的字段。</p><p>注意：为了方便使用，可以将字段echo(value：string)：string添加到模式中，如本文中的示例所示。</p><p>注意：将可嵌入字段与指令@SKIP和@INCLUDE一起使用是一个有趣的用例。但是，条件IF需要的是布尔值，而不是字符串；即使可以在服务器中正确解析查询，客户端中也存在类型不匹配的问题。</p><p>此建议可能建议接受嵌入字段本身，而不仅仅是在字符串中，这样就可以将它们强制转换为自己的类型：@Skip(if：{{hasComments}})。下面是关于这一点的更多信息。</p><p>此查询以两种不同的方式解析字段标题，具体取决于帖子是否有评论：</p><p>为什么我们希望GraphQL查询支持可嵌入字段？以下是我到目前为止已经确定的好处。</p><p>在大多数情况下，我们有一个客户端从GraphQL服务器请求数据并将其转换为所需的格式。</p><p>例如，客户端的网站可以使用JavaScript处理数据，如将字段Title和Date转换为描述：</p><p>但是，在某些情况下，我们可能需要检索我们不能控制的服务的数据，并且该服务不提供处理结果的工具。</p><p>例如，时事通讯服务(如Mailchnp)可以接受定义从中检索时事通讯数据的端点。端点返回的任何数据都是最终数据；在注入时事通讯之前，不能对其进行处理。</p><p>在这些站点中，查询可以使用可嵌入字段将响应操作为所需的格式。当通过HTTP访问GraphQL时，这可能特别有用。</p><p>还可以通过向模式中添加额外的Post.description ptionForNewsetter字段来满足上面的用例。但是这个解决方案使模式变得杂乱无章，而可嵌入字段可以被认为是一个更优雅的解决方案。</p><p>可以将可嵌入字段与JavaScript中的箭头函数进行比较，后者在语法上优于该语言中已有的功能。</p><p>因此，该特性成为该语言中受欢迎的特性，从而产生更好的开发体验。</p><p>目前，@SKIP和@INCLUDE指令的参数&#34；IF&#34；只能是实际的布尔值(TRUE或FALSE)或具有布尔值的变量。此行为相当静态。</p><p>通过从对象本身评估某些属性上的条件，可嵌入字段将使此行为更具动态性。</p><p>有一个问题需要解决：如果是布尔值，而不是字符串，因此为了避免类型冲突，GraphQL语法可能还需要单独接受嵌入的字段，而不是将其括在字符串引号中：</p><p>不需要在引号&#34；&#34；之间换行{{}}将为除字符串之外的所有标量类型解决这个问题，而不仅仅是布尔值(使用droid查看下面的示例，使用可嵌入字段解析ID)。</p><p>可嵌入字段允许在GraphQL查询本身中嵌入模板，这将使GraphQL服务更具配置友好性。</p><p>例如，结合扁平链语法和嵌套突变(还建议用于规范的另外两个特性)，我们可以生成以下查询，该查询向用户发送一封电子邮件，通知他/她的评论已得到回复：</p><p>突变{COMMENT(：1){replyToComment(：Data){id@sendEmail(：&#34；{{parentComment.auth.email}}&#34；，：&#34；{{Auth.name}已于{{comment.date(：\&#34；d/m/Y\&#34；))回复了您在{{comment.date(：\&#34；d/m/Y\&#34；{{comment.date(：\&#34；d/m/Y\&#34；{{comment.date(：\&#34；d/m/Y\&#34；)}}，{{Author.name}}：&lt；/p&gt；&lt；BLOCKQUOTE&gt；{{comment.content}}&lt；/BLOBQUTE&gt；&lt；p&gt；读取：{{comment.url}}&lt；/p&gt；&#34；)}}</p><p>建议的功能[RFC]在查询之间导出变量尝试@导出字段的值，并将其注入到同一查询中的另一个字段中：</p><p>查询A{HERO{id@export(：&#34；droidId&#34；)}}查询B($droidId：string！){droid(：$droidId){name}}。</p><p>使用可嵌入字段和扁平链语法，此用例可以满足如下要求：</p><p>一旦编写了查询，它应该始终具有相同的含义并返回相同形状的结果。未来的更改不应更改现有模式或查询的含义，也不应以任何其他方式导致现有兼容GraphQL服务变得不符合以前版本的规范。</p><p>使用可嵌入字段，上面的查询将生成不同的响应，而且，它甚至可能生成错误消息，就像没有字段Root.world时一样。</p><p>另外，考虑字符串引号&#34；&#34；之间没有对{{}}换行的情况，如下查询所示：</p><p>目前，此查询会产生语法错误，显示在GraphiQL客户端中，并且可能无法由服务器解析。这种行为将会改变。</p><p>由于向后不兼容，建议将可嵌入字段设置为可选加入功能，提示用户在启用前要充分意识到后果。</p><p>可嵌入字段会影响GraphQL工作流中的某些组件。这些问题应该如何处理呢？</p><p>当字段不存在时，或者如果字段参数接收的值的类型与架构中声明的类型不同，以及其他潜在错误，GraphiQL客户端将显示错误消息。此信息是否也可用于可嵌入字段？</p><p>为此，GraphiQL需要解析字段参数输入并识别所有{{fieldName(FieldArgs)}}实例，以便执行验证并显示错误消息。</p><p>当嵌入字段不存在时会发生什么情况？例如，如果在下面的查询中，字段{{name}}存在，但{{surname}}不存在：</p><p>{&#34；错误&#34；：[&#34；字段&#39；姓氏&#39；不存在，因此&#39；ECHO(值：\&#34；{{姓名}}{{姓氏}}\&#34；)&#39；无法解析&#34；]}。</p><p>或者是否应该跳过缺少的字段，但仍然解析该字段，并可能显示警告？例：</p><p>{&#34；警告&#34；：[&#34；字段&#39；姓氏&#34；]，&#34；数据&#34；：{&#34；用户&#34；：[{&#34；fullName&#34；：&#34；Juan{{surname}}&#34；}，{&#34；fullName&#34；：&#34；佩德罗{{SURNAME}}&#34；}，{&#34；FULLNAME&#34；：&#34；Manuel{{SURNAME}}&#34；}]}}。</p><p>还是应该将失败的领域全部移除？(请注意，每个解析值的末尾仍有一个空格)：</p><p>{&#34；警告&#34；：[&#34；字段&#39；姓氏&#39；不存在&#34；]，&#34；数据&#34；：{&#34；用户&#34；：[{&#34；fullName&#34；：&#34；Juan&#34；}，{&#34；fullName&#34；：&#34；Pedro&#34；}，{&#34；fullName&#34；：&#34；Manuel&#34；}]}}。</p><p>如果我们实际上想打印响应中的字符串&#34；{{field}}&#34；而不进行解析，应该怎么做呢？</p><p>它不是GraphQL规范的一部分，而是作为附加的可选规范，并作为GraphQL服务器的选择加入功能提供。</p><p>如果仅在字符串中解析，则可嵌入字段不需要更改GraphQL语法。</p><p>让一个字段解析另一个字段的值只发生在下一层，而不是像可组合字段那样向下多层。</p><p>可嵌入字段由POP支持在GraphQL服务器GraphQL中，以及它对WordPress GraphQL API for WordPress的实现，两者都是一种选择加入的功能。</p><p>如果对此功能有足够的支持，我将在GraphQL规范中添加一个RFC问题。欢迎大家在这篇Reddit帖子中提供反馈：</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://leoloso.com/posts/proposal-for-embeddable-fields-in-graphql-query/">https://leoloso.com/posts/proposal-for-embeddable-fields-in-graphql-query/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/graphql/">#graphql</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/嵌入/">#嵌入</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1022772.html"><img src="http://img2.diglog.com/img/2020/9/thumb_958cc229c7ef1d75189575312ca93cd3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022772.html">
Hasura筹集了2500万美元的B系列资金，并在其GraphQL服务中增加了对MySQL的支持</a></div><span class="my_story_list_date">2020-9-9 0:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1022650.html"><img src="http://img2.diglog.com/img/2020/9/thumb_803b3b7a76e49ef4a7e6dc20afe81dae.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022650.html">在没有SDL的情况下向GraphQL架构添加指令</a></div><span class="my_story_list_date">2020-9-8 11:16</span></div><div class="col-sm"><div><a target="_blank" href="/story/1019604.html"><img src="http://img.diglog.com/img/2020/8/thumb_9271efbd7560d4a88aa5081ff9236a38.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1019604.html">我们[OkayCupid]决定不使用GraphQL进行当地州管理</a></div><span class="my_story_list_date">2020-8-22 0:2</span></div><div class="col-sm"><div><a target="_blank" href="/story/1017319.html"><img src="http://img.diglog.com/img/2020/8/thumb_ed945ca34bbac407ed202969cf81610d.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1017319.html">我在周末创建的MikroOrm v4/w GraphQL示例项目</a></div><span class="my_story_list_date">2020-8-10 19:54</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>