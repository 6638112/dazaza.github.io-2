<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>发现新的VGA模式（2016） Discovering a new VGA mode (2016)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Discovering a new VGA mode (2016)<br/>发现新的VGA模式（2016） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-30 00:13:38</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/a9223c7d2dbdfa7d4f90c141b8fc33ac.jpg"><img src="http://img2.diglog.com/img/2021/3/a9223c7d2dbdfa7d4f90c141b8fc33ac.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Given that the CL-GD5429 on the Beckman motherboard only has 512KB of memory, yet supports 1280x1024 modes (and 1600x1200 interlaced), I began to look into ways to support higher resolution modes about a year ago, sometime in early 2016. 1280x1024x4bpp uses 640KB of video memory. If I could find a way to reduce the bit depth to 1 or 2bpp, I would cut the memory usage down enough to support a 1280x1024 display in the limited 512KB of memory available to the 5429.</p><p>鉴于Beckman主板上的CL-GD5429只有512KB的内存，但支持1280x1024模式（和1600x1200隔行扫描），我开始调查一年前高度分辨率模式的方法，2016年初的某个时间.1280x1024x4bpp使用640kb视频内存。如果我能找到减少1或2bpp的比特深度的方法，我会将内存用法降低到足以支持1280x1024在5429可用的限量内存中显示器。</p><p> Having some experience with the common modes supported on VGA, I knew that there were CGA compatibility modes using 1 and 2bpp color depths, so this is where I began my search. However, I quickly realized that these modes were not efficient with memory. They were designed purely for compatibility, and nothing else, effectively being 4bpp modes themselves that masked off 2 or 3 bits resulting in the 1 and 2bpp modes. This was a dead end.</p><p> 拥有VGA上支持的常见模式的经验，我知道使用1和2BPP颜色深度有CGA兼容模式，因此这是我开始搜索的地方。但是，我很快意识到这些模式与内存没有效率。它们纯粹是为兼容性而设计的，没有别的，有效地是4BPP模式本身，屏蔽了2或3位，导致1和2BPP模式。这是一个死胡同。</p><p> However, during my browsing of the 5429 technical reference manual, I noticed a pair of bits that sounded promising. These two were the &#39;Shift and Load 32&#39; and &#39;Shift and Load 16&#39; bits in the VGA Sequencer&#39;s clocking register (SR1).</p><p> 但是，在我浏览5429技术参考手册期间，我注意到一对听起来有希望的比特。这两个是＆＃39;转移和负载32＆＃39;和＃39;换档和装载16＆＃39; VGA定序器中的位＆＃39; s时钟寄存器（SR1）。</p><p> According to the Cirrus Logic technical reference, the Shift and Load 32 bit, &#34;controls the Display Data Shifters in the Graphics Controller according to the following table:&#34;</p><p> 根据Cirrus逻辑技术参考，转移和负载32位，＆＃34;根据下表控制图形控制器中的显示数据移位器：＆＃34;</p><p>  To me, these two fields sounded potentially like the answer to 1 and 2bpp modes. One &#39;character&#39; on the VGA when doing graphics was 8 pixels. Due to the organization of VGA memory being (logically) 32 bits wide, 8 4-bit pixels normally fit into one word, meaning you would logically load the video shift registers once per character clock. Together, the &#39;4&#39; video shifters would shift out 4 bits at a time, one set of 4 for each pixel. However, in 2 or 1bpp modes, you would have 16 or 32 pixels per word respectively, equaling 2 or 4 characters worth of pixels each. So, in this case, you would load the data shifters once every 2 or 4 character clocks since one word now was equivalent to that number of characters worth of pixels. While the video shift registers are normally thought to be 4 independent 8-bit shift registers, I theorize (at least in these modes) that the shift registers actually feed into each other, producing a 32 bit shift register chain, with &#39;taps&#39; every 8 bits for the bits which go to the attribute controller (which translates 4 bit values into the 8-bit color values going to the pallette DAC).</p><p>  对我来说，这两个领域听起来可能就像1和2BPP模式的答案一样。一个＆＃39;字符＆＃39;在vga上进行图形时为8像素。由于VGA内存的组织（逻辑上）32位宽，8个4位像素通常适合一个单词，这意味着您将在每个字符时钟逻辑上加载视频移位寄存器。一起，＆＃39; 4＆＃39;视频移位器会一次向4位移动，每个像素一组4。但是，在2或1BPP模式中，每个单词的32像素分别为16或32像素，每个单词每个单词每个单词每个单词。因此，在这种情况下，您将每2或4个字符时钟加载一次数据移位器，因为现在一个单词相当于价值像素的字符数。虽然视频移位寄存器通常被认为是4个独立的8位移位寄存器，但我理论上（至少在这些模式中），换档寄存器实际彼此馈送，产生32位移位寄存器链，具有＆＃39;水龙头和＃39;每8位用于转到属性控制器的位（将4位值转换为将到Pallette DAC的8位颜色值）。</p><p> However, this brings up another point: 4 bits still go to the attribute controller, even in these cases where only 1 or 2 bits should be used. These can cause odd colors to be produced as the bits shift through the shifters, and the farther right pixels act as more significant bits. For example, suppose we have a monochrome bit stream loaded into the shifters like this:</p><p> 但是，这会带来另一个点：4位仍然转到属性控制器，即使在应该使用1或2位的这些情况下。当比特通过移位器移位时，它们会导致产生奇怪的颜色，并且较右侧像素的作用是更高的比特。例如，假设我们有一个装入这样的单色比特流，如下所示：</p><p>    In the first example, the 4 bit attribute is 0110, while in the second it is 0011. For a 1bpp mode, we actually only care about the LSB of this nibble. Luckily, there are ways to remedy this in the attribute controller. The first way, is to use the &#39;Enable Color Plane&#39; bits in the &#39;Color Plane Enable Register&#39; (AR12). These bits allow you to AND mask off the other bits in the attributes. Loading with a value of 0001 selects just the LSB for 1bpp modes, and loading with a value of 0101 selects the two relevant bits for 2bpp modes. The other way to remedy this issue is to load the attribute controller palette registers such that the colors selected are independent of the bits which should not influence the color. For example, making all of the even attributes one color, while all the odd attributes are another color, effectively ignores all but the LSB, giving the same effect. Similarly, making colors 0000, 0010, 1000, and 1010 all the same effectively ignores bit 1 and 3 for 2bpp modes. Either method of ignoring the irrelevant bits works correctly. This is also a point to bring up potential differences in VGA chipsets. It&#39;s possible that on certain chips, the roles of bits may be reversed. On some chipsets, the bit that should be used is the MSB, while the bits to ignore are the 3 lower bits, and similar for 2bpp modes. I have not encountered a chip like this, but that doesn&#39;t mean it doesn&#39;t exist (small tested sample size of 2).</p><p>    在第一个示例中，4位属性为0110，而在第二个中，它是0011.对于1BPP模式，我们实际上只关心该啃的LSB。幸运的是，有些方法可以在属性控制器中纠正它。首先，是使用＆＃39;使能颜色平面＆＃39; ＆＃39中的位;颜色平面启用寄存器＆＃39; （AR12）。这些位允许您和屏蔽属性中的其他位。使用值为0001的加载只选择1bpp模式的LSB，并且使用值为0101的加载选择2bpp模式的两个相关位。补救此问题的另一种方法是加载属性控制器调色板寄存器，使得所选颜色独立于不应影响颜色的比特。例如，使所有偶数属于一种颜色，而所有奇数属性都是另一种颜色，有效地忽略所有但LSB，给出相同的效果。类似地，使颜色0000,0010,1000和1010均有相同的有效忽略2bpp模式的位1和3。无论忽略无关位的方法都正确工作。这也是在VGA芯片组中提出潜在差异的点。它可能在某些芯片上，比特的角色可以颠倒。在某些芯片组上，应该使用的位是MSB，而忽略的位是3个较低位，并且类似于2BPP模式。我没有遇到这样的芯片，但这并不是意味着它没有存在（存在小的测试样本大小2）。 </p><p> Lastly, a timing issue seems to arise causing the display to repeat the first 24 pixels on the left before the display properly begins. This is solved by setting another field properly, this time in the CRTC. The display enable skew field in the &#39;Horizontal Blanking End Register&#39; (CR3) should be set to 3, and this appears to remedy the issue.</p><p>最后，定时问题似乎导致显示器在显示屏上正确开始之前重复左侧的前24个像素。这是通过正确设置另一个领域的解决方案来解决，这次在CRTC中。显示屏在＆＃39中启用偏斜字段;水平消隐结束寄存器＆＃39; （CR3）应该设置为3，这似乎弥补了这个问题。</p><p> Sometime in january of 2016, I managed to finally test and implement the 1bpp variant of this mode successfully. Somewhat through trial and error, I was able to find out the third point about display enable skew, as well as the general behavior, after much experimentation, with the various &#39;shift and load&#39; bit settings described in the first part. The important thing is that the mode worked. I then became curious what other chipsets this mode was possible on. I had proven it on a CL-GD5429, but did it work on others? Unfortunately, I don&#39;t have a genuine IBM VGA controller to try this on, but I also managed to test it on my Compaq 4/50CX, which has some sort of WDC SVGA controller. I initially had issues with this, but eventually I realized that using the laptop panel ignored settings in the various CRTC registers, including the display enable skew settings. By changing to an externally connected VGA display, I was able to change the timing and the mode worked. Given a datasheet for the exact chip in the laptop, I&#39;m sure I could develop a specific fix, but this is one limitation of the mode. If the CRTC registers are ignored like this on other laptops, this can cause the same issue making the 24-pixel repeat issue unfixable. I tested on a more modern pentium 4 era machine, but could not get this mode to work at all regardless of what I tried. I suspect the graphics chip simply doesn&#39;t support it. I got strange erratic behavior on the video output as soon as I set the shift and load 32 bit. I also attempted to run on my modern intel i5 laptop, however I couldn&#39;t get it to boot DOS and run the QBASIC program I had made to test this, so I didn&#39;t manage to test it here.</p><p> 在2016年1月的某个时间，我终于成功地测试并实现了这个模式的1BPP变体。有些通过试验和错误，我能够找到关于显示的第三点，并且在许多实验之后，与各种＆＃39;换档和装载＆＃39;第一部分中描述的位设置。重要的是模式工作。然后，我变得好奇其他芯片组这种模式是可能的。我在CL-GD5429上证明了它，但它对他人有工作吗？不幸的是，我没有一个真正的IBM VGA控制器尝试这一点，但我也设法在我的Compaq 4 / 50cx上测试，它有某种WDC SVGA控制器。我最初有此问题，但最终我意识到使用笔记本电脑面板忽略各种CRTC寄存器中的设置，包括显示屏使能偏斜设置。通过更改为外部连接的VGA显示器，我能够改变正时和模式。给出了笔记本电脑中精确芯片的数据表，我确定我可以开发一个特定的修复，但这是模式的一个限制。如果在其他笔记本电脑上忽略了CRTC寄存器，这可能会导致同样的问题使得24像素重复发出不可装配。我在更现代化的奔腾4时代机器上测试了，但无论我尝试的内容如何，​​都无法获得这种模式。我怀疑图形芯片简单地支持它。一旦我设置班次和加载32位，我就在视频输出上奇怪了不稳定的行为。我也试图在我的现代英特尔I5笔记本电脑上运行，但是我可以让它启动DOS并运行我所做的QBASIC程序，所以我没有设法在这里测试它。</p><p> Given the way that the purpose of otherwise mysterious bits and fields within the VGA registers seemed to just fall into place once I began working on this, I theorize that the intention of the designers of the IBM VGA chip was to support these modes to begin with. However, the software to use them was never implemented, and the documentation was too poor for anyone to implement them in low level software. Furthermore, the falling prices of RAM meant that soon the low-memory variants of VGA would have gone away, meaning that 640x480x4bpp was supported by most, if not all VGA cards soon after introduction of the VGA controller. Given that the VGA card hardly supported any higher resolution modes than the normal 640x480, there would have been no need to attempt to squeeze more pixels out of the memory available (256KB on normal VGA).</p><p> 鉴于VGA寄存器中的其他差别比特和字段的目的似乎只是落入到另一个地方，一旦我开始致力于这一点，我理论大小IBM VGA芯片的设计者的意图是支持这些模式开始。但是，要使用它们的软件从未实施过，并且任何人都在低级软件中实现它们的文档太差了。此外，RAM的下降意味着很快VGA的低记忆变体将消失，这意味着大多数人支持640x480x4bpp，如果不是所有VGA卡在引入VGA控制器后即可。鉴于VGA卡几乎不支持任何更高的分辨率模式，比正常的640x480更高，都不需要尝试从可用的内存中挤出更多像素（正常VGA上256kb）。</p><p> I also don&#39;t know how many different cards would have supported this mode. For that matter, I don&#39;t know if IBM VGA supports this mode.</p><p> 我也没有知道这个模式有多少张不同的卡片。就此而言，我知道IBM VGA是否支持此模式。</p><p> The usefulness of these modes are limited on the VGA controller anyway. One thing they do allow is a larger virtual framebuffer, which the VGA&#39;s window into can pan and scroll around within. Speaking of which, panning and scrolling is still fully supported even with 1 and 2bpp modes, which seems like more evidence of planned support for these modes in the VGA hardware. Normally, you can achieve 1-word panning on VGA easily by changing the display start address. 1 word in 4bpp mode corresponds to 8 pixels. However, the VGA supports hardware fine panning of 32 pixels through a combination of two fields. In 1bpp mode, the 1-word panning ends up producing 32 pixels of panning. This, combined with fine panning, still allows individual single-pixel panning capabilities. This seems to suggest the creators of VGA designed this with a 1bpp mode in mind, since otherwise only 8 pixels of fine panning are required in a 4bpp mode. The fields used for &#39;fine&#39; panning are actually the combination of an 8-pixel coarse &#39;byte&#39; panning field in CR8 and a 1 pixel fine panning field in AR13. Together they give a range of 0-31 pixels of panning, combined with the memory address word-panning, allowing full panning of any image.</p><p> 无论如何，这些模式的有用性在VGA控制器上限制。他们确实允许的一件事是一个更大的虚拟帧缓冲器，VGA＆＃39; S窗口进入CAN PAN并在内部滚动。谈论，即使使用1和2BPP模式，仍然完全支持平移和滚动，这似乎是在VGA硬件中对这些模式的计划支持的更多证据。通常，通过更改显示开始地址，您可以轻松实现1字达到VGA上的平移。 4BPP模式中的1字对应于8个像素。然而，VGA通过两个字段的组合支持32像素的硬件细腻平移。在1BPP模式下，1字平移最终产生32像素的平移。这与精细平移结合，仍然允许单个像素平移能力。这似乎建议VGA的创建者以1BPP模式设计，因此在4BPP模式下只需要8个像素的精细平移。用于＆＃39的字段;罚款＆＃39;平移实际上是8像素粗＆＃39的组合;字节＆＃39; CR8的平移场和AR13中的1像素精细平移场。它们一起给出了一个0-31像素的平移，结合了存储器地址字，允许完全平移任何图像。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://hackaday.io/project/6150-beckman-du-600-reverse-engineering/log/50756-discovering-a-new-vga-mode">https://hackaday.io/project/6150-beckman-du-600-reverse-engineering/log/50756-discovering-a-new-vga-mode</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/vga/">#vga</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/模式/">#模式</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>