<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用F＃编写iRacing SDK实现 Writing an iRacing SDK Implementation in F#</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Writing an iRacing SDK Implementation in F#<br/>用F＃编写iRacing SDK实现 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-09 14:17:13</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/2ba56bde2815d1597141f903973070c0.jpg"><img src="http://img2.diglog.com/img/2021/1/2ba56bde2815d1597141f903973070c0.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In my  previous post, I discussed how I’ve decided to learn F# in 2021 for a number of reasons. Around the same time, I also happened to setup my Sim Racing rig so that I could continue to play  iRacing with my VR headset (HTC Vive). Its been several years since I’ve last played, but with COVID-related curfews being implemented here in Montreal tomorrow, I’ve been increasingly taking up home-based pursuits which I didn’t always have the time for pre-lockdown. Since the last time I played iRacing, I’m running a PC with a much better processor, motherboard, and only SSDs. The VR performance has been a huge leap forward since I used to play with my old machine and I was quite impressed. After spending a couple of hours setting up, here’s what my current humble racing setup looks like:</p><p>在上一篇文章中，我讨论了由于多种原因如何决定在2021年学习F＃。大约在同一时间，我也碰巧设置了Sim Racing装备，以便我可以继续使用VR耳机（HTC Vive）玩iRacing。自从我上场比赛以来已经有好几年了，但是明天明天在蒙特利尔在这里实施与COVID相关的宵禁，我已经越来越多地从事家庭式运动，而我并不总是有时间进行锁定。自从我上次玩iRacing以来，我一直在运行一台具有更好处理器，主板和仅SSD的PC。自从我过去玩旧机器以来，VR的性能有了巨大的飞跃，给我留下了深刻的印象。在花了几个小时的设置之后，这就是我目前的拙劣赛车设置：</p><p>  Having a dedicated table really helps, as in my old apartment it was fairly difficult to setup a station with limited space, but now I can fortunately just jump in. Despite the past limitations, I was able to get fairly competitive and still remember the thrill of my first win agaisnt a field of real racers in a Mazda MX-5:</p><p>  拥有专用的桌子确实有帮助，因为在我的旧公寓中，很难设置空间有限的车站，但是现在我可以跳进去了。尽管过去有很多限制，但我仍然能够保持相当的竞争力，并且仍然记得那激动我的第一场胜利与马自达MX-5上的真实赛车场有关：</p><p>  Inspired by setting everything up and doing some laps to practice for an eventual return to comeptition, I started thinking about how I once experimented with using the  Python implementation of the iRacing SDK to connect to an arduino and display a speedometer readout in realtime on a small screen. In reminiscing about the experience, I thought about how I could look into writing an F# implementation of the SDK as a learning project. In addition to learning through the project, it also has the benefit of being of use in a future project involving an iRacing stats tracker web app that I’ve been thinking about writing as a project for my upcoming  cloud computing courses.</p><p>  受到一切准备工作的启发，并花了一些时间进行练习以最终回到彗星竞赛中，我开始思考如何曾经尝试使用iRacing SDK的Python实现连接到arduino并在小屏幕上实时显示车速表读数屏幕。为了回想这段经历，我考虑了如何将SDK的F＃实现编写为一个学习项目。除了通过项目进行学习之外，它还具有在将来涉及iRacing stats跟踪器网络应用程序的项目中使用的好处，我一直在考虑将其作为即将到来的云计算课程的项目编写。</p><p>  I tend to learn best when projects are slightly outside of my comfort zone, and this would be both my first time writing a library, as well as writing one in a functional language! Having used an array of libraries at this point, I had some confidence in choosing an organizational structure, and the Python implementation is only  739 lines of code which felt doable compared to some of the larger libraries out there.</p><p>  当项目稍微超出我的舒适范围时，我往往会学得最好，这既是我第一次编写库，还是用功能语言编写一个库！在这一点上使用了一系列库之后，我对选择组织结构有了一定的信心，并且与只有一些较大的库相比，Python实现只有739行代码是可行的。</p><p>   and I figured that this would be a good featureset to aim for in the final version of the F# SDK. Out of these features, the session data and live telemetry data would be the ones I plan to implement first.</p><p>   并且我认为这将是F＃SDK最终版本中针对的一个很好的功能集。从这些功能中，会话数据和实时遥测数据将是我计划首先实现的功能。</p><p>  After coming up with some desired features, the first step was to create a new FSharp solution called iRacingFSharp. Inside the solution, I created two projects. One was our actual library, called iRacingFSharp, and the other was a basic console app called SDKReader (located in the Examples Folder) to test the functionality of the library as I worked on it. Note, if you’d like to see the full codebase you can  here on github.</p><p>  提出了一些所需的功能之后，第一步是创建一个名为iRacingFSharp的新FSharp解决方案。在解决方案内部，我创建了两个项目。一个是我们的实际库，称为iRacingFSharp，另一个是基本的控制台应用程序，称为SDKReader（位于Examples文件夹中），用于在我处理库时测试其功能。请注意，如果您想查看完整的代码库，可以在github上找到。</p><p>  Starting small, I decided that a good first function would be to find out the state of the simulator. Fortunately, the iRacing SDK allows you to check if the sim is running using the following URL which points to a localhost server:</p><p>  从小开始，我认为一个好的第一功能就是找出模拟器的状态。幸运的是，iRacing SDK允许您使用以下指向本地服务器的URL检查sim是否正在运行： </p><p>    I decided to make use of the  F# Data HTTP library in order to download the response and so I installed it from NuGet at this point.</p><p>我决定使用F＃Data HTTP库来下载响应，因此我此时从NuGet安装了它。</p><p> Next, inside my iRacingFSharp project I created a file called Irsdk.fs and wrote the following code:</p><p> 接下来，在我的iRacingFSharp项目中，我创建了一个名为Irsdk.fs的文件，并编写了以下代码：</p><p> namespace  IrsdkFS open  FSharp . Data ///&lt;summary&gt;F# implementation of the iRacing SDK.&lt;/summary&gt; module  IrsdkFS  =  ///&lt;summary&gt;Returns the simStatus in string format&lt;/summary&gt;  let  SimStatus ()  =  let  simStatusURL  =  &#34;http://127.0.0.1:32034/get_sim_status?object=simStatus&#34;  let  simStatusObject  =  Http . RequestString ( simStatusURL )  simStatusObject</p><p> 命名空间IrsdkFS打开FSharp。 iRacing SDK的数据///＆lt; summary＆gt; F＃实现。＆lt; / summary＆gt;。模块IrsdkFS = ///＆lt; summary＆gt;以字符串格式＆lt; / summary＆gt;返回simStatus。 let SimStatus（）= let simStatusURL =＆＃34; http：//127.0.0.1：32034 / get_sim_status？object = simStatus＆＃34;让simStatusObject = Http。 RequestString（simStatusURL）simStatusObject</p><p> In the above code, I’ve created a module which contains a function called SimStatus that takes no parameters. It then binds the JSON response to simStatusURL and passes it to the HTTP library via Http.RequestString(). Finally, simStatusObject is returned in string format which can be parsed further by another function in a later step.</p><p> 在上面的代码中，我创建了一个模块，其中包含一个名为SimStatus的函数，该函数不带任何参数。然后，它将JSON响应绑定到simStatusURL，并通过Http.RequestString（）将其传递到HTTP库。最后，以字符串格式返回simStatusObject，该字符串格式可以在以后的步骤中由另一个函数进一步解析。</p><p>  With this simple function in place, the next step was to create SDKReader.fs inside my SDKReader console app. This file contained code to call the SimStatus() function and print the output:</p><p>  有了这个简单的功能，下一步就是在我的SDKReader控制台应用程序中创建SDKReader.fs。该文件包含用于调用SimStatus（）函数并打印输出的代码：</p><p> [&lt; EntryPoint &gt;] let  main  argv  =  let  test  =  IrsdkFS . SimStatus ()  printf  &#34;%s&#34;  test  0  // return an integer exit code</p><p> [＆lt; EntryPoint＆gt;] let main argv = let test = IrsdkFS。 SimStatus（）printf＆＃34;％s＆＃34;测试0 //返回整数退出代码</p><p> Running dotnet build inside the SDKReader folder displayed the following output while iRacing was running:</p><p> iRacing运行时，SDKReader文件夹中正在运行的dotnet构建显示以下输出： </p><p>  Success! With this method working, we now have the very beginnings of an F# implementation of the iRacing SDK! Although it is a small step, we were also able to create and structure the project. Lastly, I also setup a a basic .NET build through Github Actions for CI.</p><p>成功！有了这种方法，我们现在就可以开始iRacing SDK的F＃实现了！尽管这只是一小步，但我们也能够创建和构建项目。最后，我还通过Github Actions for CI建立了一个基本的.NET构建。</p><p>  iRacing’s API telemetry comes in three variations; data written to a .ibt file 60 times a second, live data exposed to the telemetry API 60 times per second, and a session string in YAML format that contains more or less static information about the session. The YAML string is appended to the end of the .ibt file but only a small portion of that data is exposed. This means that going forward, I’ll need to look into parsing the YAML as well as mapping more of the API endpoints. The iRacing API appears to be nonstandard and so it may take a little more work than just a typical REST API.</p><p>  iRacing的API遥测技术分为三种：每秒写入.ibt文件60次的数据，每秒60次暴露给遥测API的实时数据以及YAML格式的会话字符串，其中包含或多或少的有关会话的静态信息。 YAML字符串被附加到.ibt文件的末尾，但是只暴露了该数据的一小部分。这意味着，我将需要研究解析YAML以及映射更多API端点。 iRacing API似乎是非标准的，因此它可能需要比典型的REST API多得多的工作。</p><p> Stay tuned for Part Two where I plan to implement some telemetry functions and look into parsing the aforementioned YAML. In addition, be sure to follow along with the  Github Repo here if you’re interested in seeing how to project progresses (or would like to contribute)!</p><p> 请继续关注第二部分，在第二部分中，我计划实现一些遥测功能并考虑解析上述YAML。此外，如果您有兴趣了解如何计划进度（或希望为您做出贡献），请务必在此处跟随Github Repo！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://markjames.dev/2021-01-08-writing-an-iracing-sdk-implementation-fsharp/">https://markjames.dev/2021-01-08-writing-an-iracing-sdk-implementation-fsharp/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/iracing/">#iracing</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>