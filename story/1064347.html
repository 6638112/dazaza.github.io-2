<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Netflix如何在网络洞察中使用EBPF流量日志 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Netflix如何在网络洞察中使用EBPF流量日志 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-08 22:07:49</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/ef8b69dbc4dcf8641974826ce57e3b6b.png"><img src="http://img2.diglog.com/img/2021/6/ef8b69dbc4dcf8641974826ce57e3b6b.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Netflix开发了一种网络可观察性Sidecar称为流量出口商，该出口商使用EBPF TRACePoints来捕获TCP在近实时流动。实例上的CPU和内存的低于1％，这一高度性能的Sidecar在网络洞察中以规模提供流量数据。</p><p>  NetFlix今天利用的云网络基础设施包括AWS服务，例如VPC，DirectConnect，VPC窥视，过境网关，NAT网关等和Netflix拥有的设备。 Netflix软件基础架构是一个大型分布式生态系统，包括在AWS和Netflix拥有的服务上运营的专用功能层。虽然我们努力保持生态系统简单，但利用各种技术的固有性质将导致我们面临挑战：</p><p> 应用程序依赖关系和数据流映射：在没有理解的情况下生长的微型服务数量，并且具有应用程序的依赖关系和数据流的可见性，这两个服务所有者和集中团队都很难识别系统问题。</p><p> 途径验证：生产流和工作室环境中的更改的Netflix速度可能导致与其他资源进行通信的服务无法实现。</p><p> 服务分割：云部署的易于导致多个AWS帐户，部署实践，互连实践等的有机增长。没有网络可见性，难以提高我们的可靠性，安全性和容量姿势。</p><p> 网络可用性：我们生态系统的预期持续增长使得难以理解我们可能达到的网络瓶颈和潜在限制。</p><p> 云网络Insight是一套解决方案，可在云网络基础架构中提供运营和分析洞察，以解决所识别的问题。通过收集，访问和分析来自VPC流日志等各种来源的网络数据，ELB Access Logs，EBPF流程日志在实例等，我们可以通过像Lumen，Atlas这样的多个数据可视化技术为用户和中央团队提供网络洞察力， 等等。 </p><p>Flow Exporter是一个Sidecar，它使用EBPF TRACePoints在电源电源的实例上捕获TCP流量，该实例可以为Netflix微恒星架构提供电源。</p><p>  Berkeley Packet Filter（BPF）是一个过程中的内核执行引擎，用于处理虚拟指令集，并已作为EBPF扩展，以提供扩展内核功能的安全方法。在某些方面，EBPF对内核为网站做了什么：它允许创建各种新的应用程序。</p><p> EBPF流日志记录表示一个包含在可变聚合间隔内的TCP / IP统计信息的一个或多个网络流。</p><p> 通过利用高度性能的EBPF以及仔细选择的传输协议来实现Sidecar来实现，以在我们的船队中的任何实例上消耗少于1％的CPU和内存。单击GRPC，HTTPS＆amp等传输协议的选择; UDP是依赖于实例放置的特征的运行时。</p><p> 可以通过快速属性通过配置更改动态管理流量导出器的运行时行为。流量出口商还向地图集发布各种操作指标。这些度量标准使用流明，自助仪表板基础设施可视化。</p><p>  流量收集器是一种摄取和丰富流动的区域服务。云中的IP地址可以随时间从一个EC2实例或TITUS容器移动到另一个EC2实例或TITUS容器。我们使用声纳将IP地址归因于特定时间的特定应用程序。 SONAR是IPv6和IPv4地址标识跟踪服务。</p><p> 流量收集器消耗了两个数据流，从流量出口商Sidecars通过Kafka和EBPF流日志数据的Sonar的IP地址更改事件。它使用Sonar使用应用程序元数据执行流数据的实时归属。归属流被推送到梯形通石，将它们路由到Hive和DruID数据存储。 </p><p>该归属流数据在NetFlix中驱动各种用例，如网络监视和网络使用预测通过Lumen仪表板和基于机器学习的网络分段。 数据也用于安全性和其他合作伙伴团队进行洞察力和事件分析。  通过EBPF和高度可扩展和高效的流量流水线，可以提供对云网络基础设施的网络洞察云网络基础架构。 经过几次架构和一些调谐的迭代后，解决方案已被证明能够扩展。  我们目前每小时摄取和丰富数十亿的EBPF流日志，并为我们的云生态系统提供可见性。 丰富的数据允许我们分析各种维度（例如可用性，性能和安全性）的网络，以确保应用程序可以在全球分散的基于云的生态系统上有效地提供其数据有效载荷。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://netflixtechblog.com/how-netflix-uses-ebpf-flow-logs-at-scale-for-network-insight-e3ea997dca96">https://netflixtechblog.com/how-netflix-uses-ebpf-flow-logs-at-scale-for-network-insight-e3ea997dca96</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/网络/">#网络</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ebpf/">#ebpf</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1064111.html"><img src="http://img2.diglog.com/img/2021/6/thumb_58c0a18c1e3ca53cf91afb154d7a6860.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1064111.html">FaceTime通过网络来到Android和Windows </a></div><span class="my_story_list_date">2021-6-8 3:8</span></div><div class="col-sm"><div><a target="_blank" href="/story/1063946.html"><img src="http://img2.diglog.com/img/2021/6/thumb_1f8b2b31403c167024c4b8f74bd80d46.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1063946.html">拜登行政仔细考虑俄罗斯黑客的网络攻击 </a></div><span class="my_story_list_date">2021-6-7 6:44</span></div><div class="col-sm"><div><a target="_blank" href="/story/1063494.html"><img src="http://img2.diglog.com/img/2021/6/thumb_8523377c75cfe1e663d275d2dbda8e70.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1063494.html">Ransomware现在将在司法部获得优先待遇 </a></div><span class="my_story_list_date">2021-6-4 20:38</span></div><div class="col-sm"><div><a target="_blank" href="/story/1063399.html"><img src="http://img2.diglog.com/img/2021/6/thumb_c164091687178dc7ef9fd6315b64b4d6.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1063399.html">美国将赎金瓶黑客作为恐怖主义的优先权 </a></div><span class="my_story_list_date">2021-6-4 6:41</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>