<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>放大路由环的风险和危险 The Risks and Dangers of Amplified Routing Loops</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">The Risks and Dangers of Amplified Routing Loops<br/>放大路由环的风险和危险 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-13 04:52:32</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/bb26297256fbefab6de857e84d3316b4.jpeg"><img src="http://img2.diglog.com/img/2021/4/bb26297256fbefab6de857e84d3316b4.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This article will take a closer look at network loops and how they can be abused as part of DDoS attacks. Network loops combined with existing reflection-based attacks can create a traffic amplification factor of over a thousand. In this article, we’ll see how an attacker will only need 50mb/s to fill up a 100gb/s link. I&#39;ll demonstrate this in a lab environment.</p><p>本文将仔细研究网络循环以及如何将其作为DDOS攻击的一部分滥用。网络循环结合现有的基于反射攻击可以创建超过一千的流量放大因子。在本文中，我们会看到攻击者如何只需要50MB / s来填充100GB / s的链接。我＆＃39; ll在实验室环境中展示这一点。</p><p> This blog is also a call to action for all network engineers to clean up those lingering network loops as they aren’t just bad hygiene but a significant operational DDoS risk.</p><p> 此博客也是对所有网络工程师进行操作的呼吁，以清理那些挥之不去的网络循环，因为它们不仅仅是卫生而且具有重要的运营DDOS风险。</p><p>  All network engineers are familiar with network loops. A network loop causes an individual packet to bounce around in a network while consuming valuable network resources (bandwidth and PPS). There are various reasons IP networks can have loops, typically caused by configuration mistakes. The only real “protection” against network loops is the Time To Live (TTL) check. However, the Time To Live check is less of protection against loops, and more protection against them looping forever.</p><p>  所有网络工程师都熟悉网络环路。网络循环使单个数据包在网络中反弹，同时消耗有价值的网络资源（带宽和PPS）。 IP网络可以具有循环的各种原因，通常由配置错误引起。对网络循环的唯一真正的“保护”是居住（TTL）检查的时间。然而，实时检查的时间较少保护对抗循环的保护，以及永远对他们的保护。</p><p> The Time to Live (TTL) refers to the amount of time or “hops” that a packet is set to exist inside a network before being discarded by a router. The TTL is an 8-bit field in the IP header, and so it has a maximum value of 255. The typical TTL value on most operating systems is 64, which should work fine in most cases.</p><p> 生存时间（TTL）的时间是指数据包在网络中设置为存在的时间量或“跳”在路由器丢弃之前。 TTL是IP报头中的8比特字段，因此它具有255的最大值。大多数操作系统上的典型TTL值为64，在大多数情况下应该正常工作。</p><p> Most network engineers know loops are bad hygiene. I think it’s much less understood (or thought about) what the operational risk of a loop is. In my experience, most loops are for IP addresses that aren’t actually in use (otherwise, it would be an outage), so typically, solving this ends up on the backburner.</p><p> 大多数网络工程师知道循环是坏卫生。我认为它不太了解（或思考）循环的操作风险是什么。在我的经验中，大多数循环都是针对实际使用的IP地址（否则，这将是一个停电），因此，解决这一目标是在Backburner上。</p><p>  Let’s look at a simple example. The diagram below shows two routers; imagine those being your core or edge routers in your datacenter.</p><p>  让我们来看看一个简单的例子。下图显示了两个路由器;想象那些在数据中心中是您的核心或边缘路由器。</p><p>  For whatever reason, they both believe 192.0.2.0/24 is reachable via the other router. As a result, packets for that destination will bounce between the two routers. Depending on the TTL value, the bandwidth used for that one packet will be:</p><p>  无论出于何种原因，他们都认为192.0.2.0/24通过其他路由器可以访问。因此，该目的地的数据包将在两个路由器之间反弹。根据TTL值，用于该数据包的带宽将是： </p><p>  Meaning for a 512 byte packet and a TTL of 60, the amount bandwidth used is 245Kbs. In other words, the 512 byte packet turned into 307,20 bytes (60x) before it was discarded. You could think of this number 60 as the amplification factor.</p><p>意思是512字节数据包和60的TTL，所使用的量带宽为245kbs。换句话说，在丢弃它之前，512字节数据包变成了307,20字节（60倍）。您可以将该号码60视为放大因子。</p><p>  That depends on your definition of rare. The good folks at  Qrator monitor for loops on the Internet. According to the Qrator measurements, there are roughly twenty million unique loops (measured as unique router pairs).</p><p>  这取决于你对罕见的定义。 QRator监视器的良好人士在互联网上进行循环。根据QRator测量，大约有2万件独特的环路（测量为独特的路由器对）。</p><p>   Now that we’ve covered the risk of loops and their potential &gt; 100x (the TLL) amplification factor, this may remind you of the traditional DDoS attacks.</p><p>   现在我们已经涵盖了循环的风险及其潜力。 100x（TLL）放大因子，这可能会提醒您传统的DDOS攻击。</p><p> The record high DDOS attacks you read about in the news are now hitting hundreds of Gigabits per second and peaking into the Terabits. All these large volume metric attacks are mostly the same type of attack and are commonly known as amplification or reflection attacks.</p><p> 您在新闻中阅读的记录高DDOS攻击现在每秒达到数百千兆位，并达到Terabits。所有这些大批量度量攻击大多是相同的攻击类型，并且通常称为放大或反射攻击。</p><p> They rely on an attacker sending a small packet with a spoofed source IP, which is then reflected and amplified to the attack target. The reflectors/amplifiers are typically some kind of open UDP service that takes a small request and yields a large answer. Typical examples are DNS, NTP, SSDP, and LDAP. The large attacks you read about in the news typically combine a few of these services.</p><p> 他们依靠攻击者发送带有欺骗源IP的小型数据包，然后反映并放大到攻击目标。反射器/放大器通常是某种开放式UDP服务，该服务需要一个小的请求，并产生一个大的答案。典型示例是DNS，NTP，SSDP和LDAP。您在新闻中阅读的大型攻击通常会结合少数这些服务。</p><p> By now, it may be clear what the danger of combining these two types of scenarios can be. Let’s look at an example. A typical DNS amplification query could be something like this, and RRSIG query for irs.gov</p><p> 到目前为止，可能会清楚结合这两种情景的危险是否可以。让我们来看看一个例子。典型的DNS放大查询可能是这样的，而RRSIG查询对于IRS.GOV</p><p>  This query is 64 bytes on the wire. The resulting answer is large and needs to be sent in two packets; the first packet is 1500 bytes, the second packet 944 bytes. So in total, we have an amplification factor of (1500+944)/64 = 38.</p><p>  此查询在线上为64个字节。由此产生的答案很大，需要在两个数据包中发送;第一个数据包是1500字节，第二分组944字节。因此，我们的放大因子（1500 + 944）/ 64 = 38。 </p><p> IP (tos 0x0, ttl 64, id 32810, offset 0, flags [none], proto UDP (17), length 64) 192.168.0.30.57327 &gt; 8.8.8.8.53: 42548+ [1au] RRSIG? irs.gov. (36)IP (tos 0x0, ttl 123, id 15817, offset 0, flags [+], proto UDP (17), length 1500) 8.8.8.8.53 &gt; 192.168.0.30.57327: 42548 8/0/1 irs.gov. RRSIG, irs.gov. RRSIG, irs.gov. RRSIG, irs.gov. RRSIG, irs.gov. RRSIG[|domain] IP (tos 0x0, ttl 123, id 15817, offset 1448, flags [none], proto UDP (17), length 944) 8.8.8.8 &gt; 192.168.0.30: ip-proto-17</p><p>IP（TOS 0x0，TTL 64，ID 32810，偏移0，标志[无]，PROTO UDP（17），长度64）192.168.0.30.57327＆gt; 8.8.8.8.53：42548+ [1AU] RRSIG？ IRS.GOV。 （36）IP（TOS 0x0，TTL 123，ID 15817，偏移0，标志[+]，PROTO UDP（17），长度1500）8.8.8.8.53＆gt; 192.168.0.30.57327：42548 8/0/1 IRS.GOV。 RRSIG，IRS.GOV。 RRSIG，IRS.GOV。 RRSIG，IRS.GOV。 RRSIG，IRS.GOV。 RRSIG [|域] IP（TOS 0x0，TTL 123，ID 15817，Offset 1448，Flags [None]，ProTO UDP（17），长度944）8.8.8.8＆gt; 192.168.0.30：IP-PROTO-17</p><p> Note: There are many different types of amplification attacks. This is just a modest and straightforward DNS example. Also, note that common open reflectors, such as Public DNS resolvers typically have smart mechanisms to limit suspicious traffic to reduce the negative impact these services could have.</p><p> 注意：有许多不同类型的放大攻击。这只是一个适度和简单的DNS示例。另外，请注意，公共DNS解压器等公共DNS解反射器通常具有智能机制，以限制可疑流量以减少这些服务可能具有的负面影响。</p><p> The tcpdump output above shows that when the answer arrives back from Google’s DNS service, the TTL value is 123; this is higher than most other public DNS resolvers (most appear to default to 64).</p><p> 上面的TCPDUMP输出显示，当答案从谷歌的DNS服务回来时，TTL值为123;这高于大多数其他公共DNS解析器（大多数似乎默认为64）。</p><p> If we combine this attack with the ‘loop’ factor we looked at previously (determined by the TTL value), we have the total amplification factor.</p><p> 如果我们将这种攻击与我们先前查看的“循环”因子相结合，我们具有总放大因子。</p><p>  Ok, so let’s continue to work on the DNS amplification example. The amplification number of 38 and a TTL of 123, would result in a total amplification number of :</p><p>  好的，让我们继续在DNS放大器上工作。扩增数为38和123的TTL，将导致总扩增数：</p><p>  Note that I’m dividing the TTL number by two so that we get a per receive (RX) and transmit(tx) number.</p><p>  请注意，我将TTL号码划分为两个，以便我们获得每个接收（Rx）和发送（Tx）编号。</p><p> For now, let’s use 2,337 as a reasonable total amplification number. What kind of traffic would an attacker need to generate 10G or 100G of traffic? One would need just about 5Mbs/s to saturate a 10g link and say ~50Mbs to saturate a 100Gbs link! These numbers are low enough to generate from a simple home connection. Now imagine what an attacker with bad intentions and access to a larger botnet could do…</p><p> 目前，让我们使用2,337作为合理的总放大号。攻击者需要生成10G或100G交通的哪些交通？一个需要大约5Mbs / s来饱和10g链接并说〜50mbs来饱和100gbs链接！这些数字足够低，可以从简单的家庭连接生成。现在想象一下，攻击者有不好的意图和访问更大的僵尸网络可以做...... </p><p>  To make sure this is indeed all possible and the math adds up, I decided to build a lab to reproduce the scenario we looked at above.</p><p>为了确保这确实是所有可能的，数学都会增加，我决定建立一个实验室来重现我们上面看的情景。</p><p>   An  attacker: initiating a DNS-based reflection attack. The (spoofed) source IP is set to 192.0.2.53</p><p>   攻击者：启动基于DNS的反射攻击。 （欺骗）源IP设置为192.0.2.53</p><p> A  DNS resolver: receiving the DNS queries (with a spoofed source IP) and replying with an answer that is 38 times larger than the original question. The IP TTL value in the DNS answer is 123.</p><p> DNS解析器：接收DNS查询（具有欺骗源IP）并回答的答案比原始问题大38倍。 DNS答案中的IP TTL值为123。</p><p> A  router pair (rtr1 — rtr2): Both routers have a route for 192.0.2.0/24 pointing to each other. As a result, the DNS answer with a destination IP of 192.0.2.53 will bounce back and forth between the two routers until the TTL expires.</p><p> 路由器对（rtr1  -  rtr2）：两个路由器都有一个192.0.2.0/24的路由指向彼此。因此，带有192.0.2.53的目的IP的DNS答案将在两个路由器之间来回反弹，直到TTL到期。</p><p>  In the screenshot above, we see the attacker on the top left sending queries at a rate of 5.9Mbs. On the bottom left, we see the DNS resolver receiving traffic at 5.9Mbs from the client and answering the queries at a rate of ~173mbs. The IP packets with the DNS responses have a TTL of 123.</p><p>  在上面的屏幕截图中，我们看到左上方的攻击者以5.9MBS的速率发送查询。在左下方，我们看到从客户端5.9MBS接收流量的DNS解析器，并以〜173MBS的速率接听查询。具有DNS响应的IP数据包具有123的TTL。</p><p> We see the router pair on the right-hand side: rtr1 on the top right and rtr2 on the bottom right. As you can see, both devices are sending and receiving at 10Gb/s. So, in this case, we observe how the client (attacker) turned 6mb/s into 10Gb/s.</p><p> 我们在右侧看到路由器对：右上角的RTR1和右下角的RTR2。如您所见，这两个设备都在10GB / s时发送和接收。因此，在这种情况下，我们观察客户（攻击者）将6MB / s转化为10GB / s。</p><p>  In this blog, we looked at the danger of network loops. I hope it’s clear that loops aren’t just a hygiene or cosmetic issue but instead expose a significant vulnerability that should be cleaned up ASAP.</p><p>  在这个博客中，我们看着网络环路的危险。我希望很明显循环不仅仅是卫生或美容问题，而是暴露出应该尽快清理的重大脆弱性。 </p><p> We saw that loops are by no means rare and that there are millions of router pairs with network loops. In fact, according to Qrator data, over 30% of all Autonomous Systems (ASns), including many of the big cloud providers, have networks with loops in them.</p><p>我们看到循环绝不是罕见的，并且有数百万路由器对具有网络环路。事实上，根据QRator数据，超过30％的所有自治系统（ASN），包括许多大云提供者，都有网络中的网络。</p><p> We observed that an attacker can easily saturate a 10G link with 85Mbs (at a TTL of 240) without any UDP amplification. Or if combined with a typical UDP amplification attack, 6Mbs of seed traffic will result in 10G on a looped path, or 60Mb/s could potentially fill up a 100Gbs path!</p><p> 我们观察到攻击者可以轻松饱和85MB（在240的TTL）中的10g链路，而没有任何UDP放大。或者如果结合典型的UDP放大攻击，6MBS的种子流量将导致环路路径10G，或者60MB / s可能填充100GBS路径！</p><p>  Most loops happen between two adjacent routers; quite a few of those appear to occur between an ISP’s router and the customer router. I have also seen loops happen involving up to eight hops (routers) spanning various metro areas while looping between Europe and the US. These transatlantic loops are expensive and hard to scale up quickly. As a result, loops on links like these will have a more significant impact.</p><p>  大多数循环发生在两个相邻的路由器之间;在ISP的路由器和客户路由器之间发生了相当多的人。我还看到循环发生涉及多达八叉（路由器），遍布各种地铁区，同时欧洲和美国之间的循环。这些跨大气循环昂贵且难以快速放大。因此，这些链接上的循环将产生更大的影响。</p><p>  I hope this article convinced you to check your network for loops and make sure you won’t be affected by attacks like these. Consider signing up for the free  Qrator service, and you’ll get alerted when new loops (or other issues) are detected in your network.</p><p>  我希望这篇文章确信你检查你的网络循环，并确保您不会受到这样的攻击的影响。考虑注册免费QRator服务，您将在网络中检测到新的循环（或其他问题）时提醒通知。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://toonk.io/the-risks-and-dangers-of-amplified-routing-loops/index.html">https://toonk.io/the-risks-and-dangers-of-amplified-routing-loops/index.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/路由/">#路由</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dangers/">#dangers</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/循环/">#循环</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>