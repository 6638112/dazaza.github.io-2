<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>恢复1973年的Unix文本到语音翻译器 Reviving the 1973 Unix text to voice translator</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Reviving the 1973 Unix text to voice translator<br/>恢复1973年的Unix文本到语音翻译器 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-04 20:34:30</div><div class="page_narrow text-break page_content"><p>The early Research Edition Unix versions featured a program that would turn a stream of ASCII text into utterances that could be played by a voice synthesizer. The source code of this program was lost for years. Here&#39;s the story of how I brought it back to life.</p><p>早期的Research Edition Unix版本具有一个程序，该程序可以将ASCII文本流转换为语音合成器可以播放的语音。该程序的源代码丢失了多年。这是我如何重获新生的故事。</p><p>    The (early 1973) Third Research Edition of Unix  documented a program that would receive as input ASCII text and convert it into phonemes that could then be played by a  Votrax voice synthesizer made by the Vocal Interface Division of Federal Screw Works. The program was written by  M. D. McIlroy, who documented its operation in a detailed  technical report.</p><p>    Unix（1973年初）的第三个研究版记录了一个程序，该程序可以接收ASCII文本作为输入并将其转换成音素，然后由联邦Screw Works的Vocal接口部制造的Votrax语音合成器播放。该程序由M. D. McIlroy编写，他在详细的技术报告中记录了该程序的运行。</p><p>  Although the program appeared in the Unix manual pages up to the 1975  Sixth Research Edition, its source code was missing from the archives that had survived. Even its author lacked a copy.</p><p>  尽管该程序出现在1975年第六研究版之前的Unix手册页中，但是仍然存在的档案中缺少其源代码。即使是其作者也没有副本。</p><p>  Fortunately, in 2011, Jonathan Gevaryahu  found most parts of the program&#39;s source code in unallocated space of a Sixth Research Edition disk dump. (This means that the code was once stored on disk, but was later deleted, and the parts where it resided were never allocated to other uses.) Even better, he could reconstruct a single block that was missing from the program&#39;s compiled version, which was also available. Based on these findings, I added the  speak source code and the  speech rules to the  GiHub repository of Unix history I am maintaining.</p><p>  幸运的是，在2011年，乔纳森·格瓦里亚胡（Jonathan Gevaryahu）在第六研究版磁盘转储的未分配空间中找到了程序源代码的大部分内容。 （这意味着该代码曾经存储在磁盘上，但是后来被删除了，并且它所在的部分从未分配给其他用途。）甚至更好的是，他可以重建程序中缺少的单个块。编译版本，也可用。基于这些发现，我将语音源代码和语音规则添加到我维护的Unix历史的GiHub存储库中。</p><p>    To see how the program was working, I experimented with making it run and compile. As the program was written in an ancient dialect of C and was also unlikely to be portable, I first tried to make it work on a Sixth Edition Unix running on a  SIMH PDP-11 emulator. This attempt quickly failed, because the console wasn&#39;t reliable enough to allow me to transfer the code via copy-paste.</p><p>    为了查看程序的工作方式，我尝试使其运行和编译。由于该程序是用古老的C语言编写的，而且不太可能移植，因此我首先尝试使其能够在SIMH PDP-11仿真器上运行的第六版Unix上运行。这项尝试很快失败了，因为控制台不够可靠，无法让我通过复制粘贴来传输代码。</p><p>  I then run the PDP-11 2.11 BSD Unix on the same emulator, which offers rudimentary internet connection capabilities. After configuring a  .rhosts file to allow remote copying (to obtain remote access, you simply add your remote host and user name), I was able to move the code to that machine.</p><p>  然后，我在同一台模拟器上运行PDP-11 2.11 BSD Unix，该模拟器提供基本的Internet连接功能。配置.rhosts文件以允许远程复制（要获得远程访问后，只需添加远程主机和用户名），我便能够将代码移至该计算机上。</p><p>    inserted an assignment operator in initialized constants ( int tflag 0; became  int tflag = 0; — I didn&#39;t even know this form ever existed),</p><p>    在初始化常量中插入一个赋值运算符（int tflag 0;成为int tflag = 0; —我什至不知道这种形式曾经存在过）， </p><p>  At that stage the program could compile, but was crashing when I tried to run it. Given that 2.11 BSD lacked  gdb and was generally slow and difficult to use, I decided to port the program to modern Unix/Linux. I also added more declarations, including full function prototypes to find other problems. (In early versions of C you didn&#39;t need to declare a function before using it.) I then methodically removed all compiler warnings, which allowed me to pinpoint a variable that was declared as a pointer but used as an integer. By correcting its declaration I fixed the initial crash.</p><p>在那个阶段程序可以编译，但是当我尝试运行它时崩溃了。鉴于2.11 BSD缺少gdb且通常运行缓慢且难以使用，我决定将该程序移植到现代Unix / Linux上。我还添加了更多的声明，包括用于查找其他问题的全功能原型。 （在C的早期版本中，在使用它之前不需要声明一个函数。）然后我有条不紊地删除了所有编译器警告，这使我可以查明一个声明为指针但用作整数的变量。通过更正其声明，我修复了最初的崩溃。</p><p>  Now I had a program that compiled and run, but was still crashing in some cases, and also wasn&#39;t producing correct output. For this further changes were needed.</p><p>  现在，我有了一个可以编译并运行的程序，但在某些情况下仍然崩溃，并且没有产生正确的输出。为此，需要进一步的更改。</p><p>  I replaced integers initialized as pairs of characters (e.g.  &#39;u1&#39;) with a macro that initialized the value in an endian-neutral manner.</p><p>  我用一个以字节序中性的方式初始化该值的宏替换了初始化为字符对的整数（例如＆＃39; u1＆＃39;）。</p><p>  After these changes the program was able to compile the rules file and produce  Votrax phoneme codes.</p><p>  完成这些更改后，程序便能够编译规则文件并生成Votrax音素代码。</p><p>    Votrax voice synthesizers and their descendant chips (which appear to use similar phoneme codes)  are not longer marketed. In order to listen to the generated voice I needed a workaround. My first attempt was to use samples from the  votrax-speak GitHub repository. Converting the phoneme Votrax codes into their mnemonic names, and passing the corresponding sample files as arguments to  SoX, allowed me to create a sound file consisting of the phonemes played together. However, the generated sound file was almost unintelligible. As I read later, a great advantage of Votrax synthesizers was how they merged together the phonemes into continuous speech, which was not the case with my approach.</p><p>    Votrax语音合成器及其后代芯片（似乎使用类似的音素代码）已不再销售。为了听生成的声音，我需要一种解决方法。我的第一次尝试是使用votrax-speak GitHub存储库中的示例。将音素Votrax代码转换为它们的助记符名称，并将相应的示例文件作为参数传递给SoX，使我能够创建一个由一起播放的音素组成的声音文件。但是，生成的声音文件几乎无法理解。正如我稍后阅读的那样，Votrax合成器的一大优势是它们如何将音素合并为连续的语音，而我的方法却并非如此。</p><p>  My second attempt involved using the phoneme output functionality of the  espeak-ng program. For this I created  a map between the Votrax phoneme codes and the corresponding  espeak phonemes, which I then coded into a  sed script that would feed  espeak with the output of Unix  speak. Through this method I was finally able to produce somewhat intelligible speech with a pipeline, such as the following.</p><p>  我的第二次尝试涉及使用espeak-ng程序的音素输出功能。为此，我在Votrax音素代码和相应的espeak音素之间创建了一个映射，然后将其编码到sed脚本中，该脚本将espeak与Unix语音的输出一起提供。通过这种方法，我终于能够通过管道产生一些可理解的语音，例如以下内容。</p><p>          Read and post comments, or share through</p><p>          阅读和发表评论，或通过分享 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.spinellis.gr/blog/20210102/">https://www.spinellis.gr/blog/20210102/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/文本/">#文本</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/text/">#text</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>