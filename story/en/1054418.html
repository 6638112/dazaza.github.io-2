<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>缓冲区溢出，许可证违规以及坏代码：FreeBSD 13的近期电话 Buffer overruns, license violations, and bad code: FreeBSD 13’s close call</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Buffer overruns, license violations, and bad code: FreeBSD 13’s close call<br/>缓冲区溢出，许可证违规以及坏代码：FreeBSD 13的近期电话 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-26 20:08:03</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/c6beaad8c2e71c741b5387d104b7a265.jpg"><img src="http://img2.diglog.com/img/2021/3/c6beaad8c2e71c741b5387d104b7a265.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>At first glance, Matthew Macy seemed like a perfectly reasonable choice to port WireGuard into the FreeBSD kernel. WireGuard is an encrypted point-to-point tunneling protocol, part of what most people think of as a &#34;VPN.&#34; FreeBSD is a Unix-like operating system that powers everything from Cisco and Juniper routers to Netflix&#39;s network stack, and Macy had plenty of experience on its dev team, including work on multiple network drivers. So when Jim Thompson, the CEO of Netgate, which makes FreeBSD-powered routers, decided it was time for FreeBSD to enjoy the same level of in-kernel WireGuard support that Linux does, he reached out to offer Macy a contract. Macy would port WireGuard into the FreeBSD kernel, where Netgate could then use it in the company&#39;s popular pfSense router distribution. The contract was offered without deadlines or milestones; Macy was simply to get the job done on his own schedule.</p><p>乍一看，马修梅西似乎是一个完全合理的选择Winoguard进入FreeBSD内核。 Wioguard是一个加密的点对点隧道协议，大多数人认为是A＆＃34的一部分; VPN。＆＃34; FreeBSD是一种像UNIX的操作系统，将来自思科和瞻博网络的所有内容带到Netflix＆＃39; S网络堆栈中，并且媒体在其开发团队中有大量的经验，包括在多个网络驱动程序上工作。因此，当Netgate的首席执行官Jim Thompson，这使得FreeBSD驱动器路由器决定是FreeBSD享受相同水平的Linux所做的内核Wineuard支持的时候，他伸出款提供梅西的合同。 Macy将Winoguard港口进入FreeBSD内核，其中网格可以在公司中使用它＆＃39; S流行的PFSense路由器分发。合同没有截止日期或里程碑;梅西只是为了完成自己的时间表完成的工作。</p><p> With Macy&#39;s level of experience—with kernel coding and network stacks in particular—the project looked like a slam dunk. But things went awry almost immediately. WireGuard founding developer Jason Donenfeld didn&#39;t hear about the project until it surfaced on a FreeBSD mailing list, and Macy didn&#39;t seem interested in Donenfeld&#39;s assistance when offered. After roughly nine months of part-time development, Macy committed his port—largely unreviewed and inadequately tested—directly into the HEAD section of FreeBSD&#39;s code repository, where it was scheduled for incorporation into FreeBSD 13.0-RELEASE.</p><p> 与Macy＆＃39;在核心编码和网络堆栈中的级别 - 这个项目看起来像一个垃圾扣篮。但事情几乎立即出现了。 Tweoguard创始人Jason Donenfeld Didn＆＃39; T关于该项目，直到它在FreeBSD邮件列表中浮出水面，莫斯特没有在Donenfeld＆＃39;在提供的帮助下感兴趣。经过大约九个月的兼职发展，Macy致力于他的港口 - 主要是未录制的，并且直接测试到FreeBSD＆＃39; S代码存储库的头部部分，在那里计划成于FreeBSD 13.0-Release。</p><p> This unexpected commit raised the stakes for Donenfeld, whose project would ultimately be judged on the quality of any production release under the WireGuard name. Donenfeld identified numerous problems with Macy&#39;s code, but rather than object to the port&#39;s release, Donenfeld decided to fix the issues. He collaborated with FreeBSD developer Kyle Evans and with Matt Dunwoodie, an OpenBSD developer who had worked on WireGuard for that operating system. The three replaced almost all of Macy&#39;s code in a mad week-long sprint.</p><p> 这一意外的提交提出了Donenfeld的赌注，其项目最终将根据建议院名称下的任何生产释放的质量来判断。 Donenfeld确定了莫景的众多问题＆＃39; s代码，而不是对象来到端口＆＃39; s发布，Donenfeld决定解决问题。他与FreeBSD开发商Kyle Evans合作，并使用Matt Dunwoodie，这是一个在Wineoard的OpenBSD开发人员进行那个操作系统。这三者几乎替换了几乎所有的Macy＆＃39;在疯狂的一周冲刺中。</p><p>    This went over very poorly with Netgate, which sponsored Macy&#39;s work. Netgate had already taken Macy&#39;s beta code from a FreeBSD 13 release candidate and placed it into production in pfSense&#39;s 2.5.0 release. The forklift upgrade performed by Donenfeld and collaborators—along with Donenfeld&#39;s sharp characterization of Macy&#39;s code—presented the company with a serious PR problem.</p><p>    与网络数据师一起越来越差，赞助梅西和工作。 Netgate已经采取了梅西级＆＃39; S博士代码来自FreeBSD 13释放候选人，并将其放入PFSense＆＃39; s 2.5.0发行版中。 Donenfeld和合作者执行的叉车升级 - 以及Donenfeld＆＃39; Syacy的尖锐表征＆＃39;代码为本公司呈现出严重的PR问题。</p><p> Netgate&#39;s public response included  accusations of &#34;irrational bias against mmacy and Netgate&#34; and irresponsible  disclosure of &#34;a number of zero-day exploits&#34;—despite Netgate&#39;s near-simultaneous  declaration that no actual vulnerabilities existed.</p><p> Netgate＆＃39;答案包括对＆＃34的指控;非理性偏见对抗Mmacy和Netgate＆＃34; ＆＃34的不负责任的披露;一些零点漏洞利用＆＃34;  - 近同时宣言，没有存在实际漏洞的近同时声明。</p><p> This combative response from Netgate raised increased scrutiny from many sources, which uncovered surprising elements of Macy&#39;s own past. He and his wife Nicole had been  arrested in 2008 after two years spent attempting to illegally evict tenants from a small San Francisco apartment building the pair had bought.</p><p> 来自网络的这种良好的响应提高了许多来源的审查，其中发现了令人惊讶的梅西奇怪的元素＆＃39;他自己的过去。他和他的妻子尼科尔于2008年被逮捕了两年后，试图非法撤销一座小型旧金山公寓楼的租户。</p><p> OH MY GOD THE PERSON WHO WROTE THE PFSENSE WIREGUARD CODE IS THIS GUY  https://t.co/e3m2ETLv2c</p><p> 哦，我的上帝写了pfsense wioguard代码的人是这个家伙https://t.co/e3m2etlv2c </p><p>— Matthew Garrett (@mjg59)  March 16, 2021</p><p>-  Matthew Garrett（@ MJG59）3月16日，2021年3月16日</p><p> The Macys&#39; attempts to force their tenants out included sawing through floor support joists to make the building unfit for human habitation, sawing  holes directly through the floors of tenants&#39; apartments, and forging extremely threatening emails appearing to be from the tenants themselves. The couple  fled to Italy to avoid prosecution but were eventually extradited back to the US—where they pled guilty to a reduced set of felonies and served four years and four months each.</p><p> macys＆＃39;试图迫使他们的租户在落地支撑床上包括锯切，以使建筑物不适合人类居住，直接穿过租户的楼层锯切洞＆＃39;公寓，并锻造极度威胁的电子邮件出现在租户本身。这对夫妇逃到了意大利，避免起诉，但最终被引渡回美国 - 他们对减少一套重罪有罪，每四年和四个月服务。</p><p> Macy&#39;s history as a landlord, unsurprisingly, dogged him professionally—which contributed to his own lack of attention to the doomed WireGuard port.</p><p> 梅西奇怪的历史作为房东，不出所料，顽固地守护着他的专业 - 这导致了他自己缺乏关注被注定的WioGuard港口。</p><p> &#34;I didn&#39;t even want to do this work,&#34; Macy eventually told us. &#34;I was burned out, spent many months with post-COVID syndrome... I&#39;d suffered through years of verbal abuse from non-doers and semi-non-doers in the project whose one big one up on me is that they aren&#39;t felons. I jumped at the opportunity to leave the project in December... I just felt a moral obligation to get [the WireGuard port] over the finish line. So you&#39;ll have to forgive me if my final efforts were a bit half-hearted.&#34;</p><p> ＆＃34;我甚至想做这项工作，＆＃34;梅西最终告诉我们。 ＆＃34;我被烧毁了，在covid综合征的情况下花了很多个月......我患有多年的口头滥用来自非行家和半非行者的辱骂，其一个大的一个大人物我是他们aren＆＃39; t felons。我有机会在12月离开项目......我只是感到道德义务，让[Wioguard Port]通过终点线获得[Wioguard Port]。所以你＆＃39;如果我的最终努力有点半，我必须原谅我。＆＃34;</p><p>    This admission answers why such an experienced, qualified developer might produce inferior code—but it raises much larger questions about process and procedure within the FreeBSD core committee itself.</p><p>    此录取答案为什么这样的经验丰富的合格开发人员可能会产生劣质代码 - 但它对FreeBSD核心委员会本身内的过程和程序提出了更大的问题。</p><p> How did so much sub-par code make it so far into a major open source operating system? Where was the code review which should have stopped it? And why did both the FreeBSD core team and Netgate seem more focused on the fact that the code was being disparaged than its actual quality?</p><p> 这么多的子标准是如何进入一个主要的开源操作系统？代码审查应该停止哪些代码审查？为什么FreeBSD核心团队和网络网似乎更加专注于代码脱离的事实，而不是其实际质量？</p><p>  The first issue is whether Macy&#39;s code actually had significant problems. Donenfeld said that it did, and he identified a number of major issues:</p><p>  第一个问题是Macy＆＃39; S代码实际上存在重大问题。 Donenfeld表示，它确认了许多主要问题： </p><p>  But Netgate argued that Donenfeld had gone overboard with his negative assessment. The original Macy code, they argued, was simply not that bad.</p><p>但网络数据师认为Donenfeld与他的负面评估一起过世。他们争辩的原始媒体代码根本并不那么糟糕。</p><p> Despite not having any kernel developers on-staff, Ars was able to verify at least some of Donenfeld&#39;s claims directly, quickly, and without external assistance. For instance, finding a validation function which simply returned true—and  printf statements buried deep in cryptographic loops—required nothing more complicated than  grep.</p><p> 尽管没有任何内核开发人员，但ARS能够直接验证Donenfeld的一些索赔，迅速，无需外部援助。例如，查找验证函数，这些功能只是返回了加密循环深度深入的True-and Printf语句 - 无需比Grep更复杂。</p><p>  In order to confirm or deny the claim of an empty validation function—one which always &#34;returns true&#34; rather than actually validating the data passed to it—we searched for instances of  return true or  return (true) in Macy&#39;s  if_wg code, as checked into FreeBSD  13.0-HEAD.</p><p>  为了确认或否认一个始终＆＃34的空验证函数的索赔 - 返回真实＆＃34;而不是实际验证传递给它的数据 - 我们搜索了Macy＆＃39; s if_wg代码中的返回真实或返回（true）的实例，如freebsd 13.0-head。</p><p>  This is a small enough number of returns to easily hand-audit, so we then used  grep to find the same data but with three lines of code coming immediately before and after each  return true:</p><p>  这是一个足够的返回数量易于审核，所以我们使用grep找到相同的数据，但是每次返回之前都会立即到达三行代码：</p><p>  Among the valid uses of  return true, we discovered one empty validation function, in  module/module.c:</p><p>  在返回true的有效用途中，我们发现了一个空验证函数，模块/ module.c：</p><p>  It&#39;s probably worth mentioning that this empty validation function is not buried at the bottom of a sprawling mass of code— module.c as written is only 863 total lines of code.</p><p>  它可能值得一提的是，这个空验证功能没有埋在庞大的代码模块底部的底部，因为写入仅仅是863总数的代码。</p><p> We did not attempt to chase down the use of this function any further, but it appears to be intended to check whether a packet&#39;s source and/or destination belongs to WireGuard&#39;s  allowed-ips list, which determines what packets may be routed down a given WireGuard tunnel.</p><p> 我们没有进一步追逐这种功能的使用，但它似乎旨在检查数据包＆＃39; s源和/或目的地是否属于wioguard＆＃39; s允许的-ips列表，这决定了什么可以将数据包路由到给定的Wiguard隧道。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://arstechnica.com/gadgets/2021/03/buffer-overruns-license-violations-and-bad-code-freebsd-13s-close-call/">https://arstechnica.com/gadgets/2021/03/buffer-overruns-license-violations-and-bad-code-freebsd-13s-close-call/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/溢出/">#溢出</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/overruns/">#overruns</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>