<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>KDE Kate文本编辑器–搜索文件和多线程 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">KDE Kate文本编辑器–搜索文件和多线程 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-30 23:17:47</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/c5407a537cc47a61eba6e87d2930eb02.png"><img src="http://img2.diglog.com/img/2021/1/c5407a537cc47a61eba6e87d2930eb02.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>多年来，Kate在文件插件中进行了非常漂亮的搜索，它允许进行多文件搜索和替换。</p><p>  但是，尽管自从第一个版本就已经非常有用，并且在最近几年中进行了很多改进，但到目前为止，它并不是最快的文件搜索。老实说：例如，Visual Studio Code速度很快，但我们速度很慢，那很糟糕：= P</p><p> 对于21.04版本，KåreSärs（该插件的原始作者和维护者），Waqar Ahmed和我尝试​​纠正此问题。</p><p>   实际的搜索已经有一些后台线程，但是仍然非常尴尬地直接填充到窗口小部件中。</p><p> Kåre在这里将其移植到适当的模型视图抽象中，这是实际计划的基础：不仅仅是一个搜索线程。</p><p> 之后，Waqar在此处进行了更多微调，以为我们仍然使用一个后台线程进行完整搜索，这已经产生了大大提高的搜索性能。</p><p> 在我2021年1月的摘要帖子中（太糟糕了，现在仍然是1月＆amp; mldr），我已经提到了不错的改进，结果的视觉表示也得到了很好的改观。 </p><p>然后，Kåre做了下一步：使用带有一些QRunnable对象的QThreadPool允许多个后台搜索线程。  有趣的是，对于他的实验，只有两个线程产生了实实在在的好处，更多的线程则相反。  鉴于我有一台具有很多真实内核（16）和快速SSD的机器，因此我尝试对此进行更多试验。  我认为两个线程不会完全饱和内核或SSD。  这确实导致了第三步：尝试优化多线程并扩展2个线程。  首先，我只是在更快的计算机上尝试了当前的实现，是的，即使有16或32个线程，实际上2个线程还是差不多了，但是速度只有一点点。  一个想法是：在我们最初的方法中，我们只是将要搜索的文件分成了X个块。我认为这可能不是很好的平衡。 </p><p>因此，我只是添加了一个简单的工作清单，这些工作清单是单个工人从中撤出的工作，没有任何初始静态拆分。</p><p>    实际上，这本来应该是第一步，但是，嘿，总是有些猜测，因为谁不知道具体问题是什么，他就不知道解决方案。</p><p>  作为分析数据集，我使用了linux.git克隆并在其中搜索“ Linus”，是的，非常有创意； =）</p><p> 确实有2个线程需要9秒钟，而16个线程则需要8秒钟，正如我所说的那样。</p><p> 让我们看一下理想线程数为16的运行的性能配置文件。</p><p>   QMimeData可见，大约15％=>不好，只是整理二进制文件，而不是您要花那么多时间的事情</p><p>  QRegularExpression是写时复制的隐式共享对象。将表达式从主线程传递到可运行对象，它将不会被复制，但这意味着，在大多数操作（例如match）上，它将进行内部锁定，例如match要优化实例之间仍然共享的表达式。 </p><p>SearchDiskFiles :: SearchDiskFiles（SearchDiskFilesWorkList＆amp; worklist，const QRegularExpression＆amp; regexp，const bool includeBinaryFiles）：m_worklist（worklist），m_regExp（regexp。pattern（），regexp。patternOptions（））//我们想杀死共享，否则我们死定了！ ，m_includeBinaryFiles（includeBinaryFiles）</p><p> 此操作和删除QMimeData查找（如果我们在匹配过程中从文件中读取二进制废话，则替换为一些琐碎的启发式搜索）可将搜索的运行时间缩短至约0.6秒。</p><p> 在下面的此改进版本的性能概要中，即使比将大多数其他部分都更容易看到将排队的信号发送到主线程所涉及的锁定。</p><p>  像kate.git克隆中的东西之类的较小搜索现在或多或少是瞬时的，例如约0.1秒。</p><p> 可以肯定的是，正如个人资料所示，还有更多可以调整的内容，但总的来说，我认为当前状态非常好。我们现在可以与其他现代编辑器相提并论了，它在处理多文件搜索方面再次变得明智。</p><p>          我们有很多想法，但只有少量的奴才（我是指有价值的贡献者）才能实现它们：） </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://kate-editor.org/post/2021/2021-01-29-search-in-files-multi-threading/">https://kate-editor.org/post/2021/2021-01-29-search-in-files-multi-threading/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/线程/">#线程</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/kate/">#kate</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/搜索/">#搜索</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1044914.html"><img src="http://img2.diglog.com/img/2021/1/thumb_7d093e1d3fb8a11e36218efe5105031d.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044914.html">将Reddit线程转换为ace律师场景的机器人 </a></div><span class="my_story_list_date">2021-1-19 0:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1043119.html"><img src="http://img2.diglog.com/img/2021/1/thumb_44b8988ff8f2ebf2f2a5427ca35e4815.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1043119.html">多线程加速JPEG编码 </a></div><span class="my_story_list_date">2021-1-4 20:18</span></div><div class="col-sm"><div><a target="_blank" href="/story/1042158.html"><img src="http://img2.diglog.com/img/2020/12/thumb_b484c25d63d71ebbbbe847690efb56a3.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042158.html">10 KB俱乐部：每个网站的链接均包含流行的HN，Reddit，Lobsters线程 </a></div><span class="my_story_list_date">2020-12-28 15:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1040545.html"><img src="http://img2.diglog.com/img/2020/12/thumb_1efb9d22cd8bdf56d1e85ee4d3b25667.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1040545.html">Cerulean：适用于Matrix的实验性微博客应用 </a></div><span class="my_story_list_date">2020-12-18 23:21</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>