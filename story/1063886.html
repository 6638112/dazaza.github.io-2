<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我们如何实现每秒1.4米行的写入速度 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">我们如何实现每秒1.4米行的写入速度 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-07 01:21:26</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/f3003f83172e75ffebdbaab8046d4cfc.png"><img src="http://img2.diglog.com/img/2021/6/f3003f83172e75ffebdbaab8046d4cfc.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>今天的旅程＆＃39; s的questdb在2013年开始使用原始原型，我们＆＃39; Ve描述了在我们的HN去年发布期间发表的帖子以来发生了什么。在项目的可归阶段，我们通过基于矢量的附录 - 唯一的系统，如KDB +，因为速度的优点和简单的代码路径模型带来了。我们还需要将行时间戳存储在升序中，导致快速时间序列查询，没有昂贵的索引。</p><p> 我们发现此模型不适合所有数据采集用例，如此无序数据。虽然有几种解决方法，但我们希望Top播放此功能，而不会失去我们花费多年建议的性能。</p><p> 我们研究了现有的方法，大多数人都以威尔伦＆＃39的表现成本为止。像我们的整个CodeBase一样，Wepresent今天的解决方案是从头开始构建的。到了9个月来才能到弗劳登德添加了一个进一步的65K行代码。</p><p> 在这里，我们构建了什么，为什么我们建造它，我们沿途所学到的，以及比较QuestDB到涌入的，点击房和时间纪录。</p><p>  我们的数据模型具有一个致命的缺陷 - 如果通过时间戳出现订购（O3），则丢弃记录，与现有数据相比。在实际应用中，由于网络抖动，延迟或时钟同步问题，有效载荷数据不会像这样。</p><p>  我们知道缺乏无序的支持是一些用户的展示者，我们需要坚实的解决方案。有可能的解决方法，例如使用每个数据源的ASINGE表或定期重新排序表，但对于最大的人来说，这不方便和不可持续。</p><p>  当我们审查了我们的数据模型时，一种可能性是从我们已经拥有的内容使用的东西，例如包括LSM树或B树，通常用于时间序列数据库。添加树将带来能够在不使用替代商店从头开始订购数据的福利。 </p><p>困扰我们最多的方法是，每个后续读取操作都会面临绩效惩罚与存储在数组中的数据。我们不会通过为有序数据的存储模型和另一个无序数据提供复杂性来引入复杂性。</p><p> 一个更有前途的选择是将一个分类和合并的阶段引入数据到来。这方面，我们可以保持存储型号不变，同时合并在yly上的数据，有序向量作为输出降落在磁盘上。</p><p>    前两个步骤是简单且易于实现的，并且唯一的难以变化的数据。只有当暂存区域时才会踢重犯罪。这种设计的奖金是输出是向量，这意味着我们的向量基础读者仍然兼容。</p><p> 此预先提交的排序和合并为伴随性能惩罚添加了额外的处理阶段来摄取额外的处理阶段。尽管如此，我们决定探索这个人，看看我们可以通过优化重新组织来减少惩罚。</p><p>  处理散装中的分期区域为我们提供了一个全面分析Thedata的独特机会。这种分析旨在避免在可能的地方完全合并的物理合并，也许逃离快速和简单的麦比静脉数据移动方法。由于基于OuRColumn的存储，这种方法可以是并行化的。我们可以采用SIMD和非时间数据访问，其中ITMAKES有所不同。</p><p> 我们通过Radix排序的优化版本将时间戳列从暂存区域进行排序，结果索引用于重新清除剩余列的分段区域：</p><p>  从现有分区数据映射了现在排序的临时区域。从一开始可能并不明显，但我们正在尝试建立所需的类型和下面三组中的每一个的尺寸： </p><p>以这种方式合并数据集时，前缀和后缀组可以是持久的数据，无序数据或无。 Merge组是在More ShiT出现的情况下，可以通过持久数据，无序数据，无序和批准数据占用。</p><p> 当它＆＃39; s清楚如何在暂存区域中进行组和治疗数据时，Wheckers的池执行所需的操作，调用微小案例和筛选到其他一切的SIMD优化代码。使用前缀，合并，和您uffix拆分，提交的最大兴趣（有多易于嘟嘟C的CPU容量）是partitions_affecty x number_of_columns x 3。</p><p>  因为我们的目标是最依赖Memcpy，我们基准测试了不可享受的代码：</p><p>  与__memcpy作为愤怒雾＆＃39; sasmlib a_memcpy，在一个实例和glibc＆＃39; s另一个。</p><p>    GLIBC对我们的用例，AVX512可能会缓慢且不一致。 Wespulate an_memcpy确实更好，因为它使用非时间函数标记。</p><p>   以上是填充具有相同64位模式的内存缓冲器。如果所有字节相同，它可以归类为Memset。它也可以写入倒退的代码，它在Store_nt Vector方法中使用平台特定于特定于平台的_MM ?? _ St​​ream_PS（p，？mm），如下所示：</p><p>  结果非常令人惊讶。非TEMP SIMD指令显示最易于的结果与MEMSET类似的性能。 </p><p>不幸的是，与其他功能的基准结果较少。 Someperform使用手写的SIMD和一些与GCC＆＃39; SSE4Generated代码一起快速，即使在AVX512系统上运行也是如此。</p><p> 手写SIMD指令既耗时和冗长。只有在性能优势扩展代码维护时，我们最终通过SIMD求助了代码库的部分。</p><p>  虽然能够快速复制数据是一个很好的选择，我们认为在大多数时间序列摄取方案中可以避免重型数据贴图。假设最多的实时超出情况是由送货机制和硬件抖动引起的，我们可以推断时间戳分布将由某些边界局部地定位。</p><p> 例如，如果任何新的时间戳值都有高概率落入先前接收值的10秒内，则边界为10秒，并且我们称之为该边界滞后。</p><p> 当TimeStamp值遵循此模式时，推迟提交可以陈得不出常规追加操作。无序系统可以达到各种各样的迟到，但如果传入数据在延迟中迟到，则优先考虑更快的处理。</p><p>  我们看到时间序列基准套件（TSBS）定期在讨论数据库性能和Decidedwe公司应该提供基准与其他系统的QuestDB的能力。</p><p> TSB是生成数据集的Go程序的集合，然后是基准录制和写性能。套件是可扩展的，因此可以在系统中包含不同的使用情况和查询类型。 </p><p>以下是我们的基准测试结果，其中包含ob of of oves ec2 m5.8xlarge实例上的tofourteen工人使用16个核心。</p><p>  我们使用四个线程达到最大的摄取性能，而其他系统需要更多的CPU资源来达到最大吞吐量。 QuestDB达到了4个线程的959k行/秒。我们发现，涌入量需要14个线程以达到最大摄入率（334k行/秒），而时间尺寸达到145k行/秒4个线程。 Clickhouse击中914k行/秒，其中两个线程asquestdb。</p><p> 在4个线程上运行时，QuestDB比Clickhouse更快，6.4x更快，6.5倍快，比时间尺寸快。</p><p>  因为我们的摄入格式（ILP）重复每行标签值，Clickhouse Andtimescaledb在QuestDB的总数据总量中的三分之二左右，因为QuestDB在相同的基准中运行。我们选择坚持ILP，因为它在时间序列中普及，但我们可能会使用更有效的格式来改善未来摄取性能。</p><p> 最后，超出了4名工人的劣化性能可以通过超出系统的能力增加来解释。我们认为，一个LimitingFactor可能是我们绑定，因为我们在基于FasterAmd的系统上更好地扩展到高达30％。</p><p> 当我们使用AMD Ryzen5处理器再次运行套件时，我们发现我们可以使用5个线程命中每秒1430万行的最大吞吐量。这与我们在使用中的英特尔Xeon铂金相比我们的参考基准M5。 .8xlarge在AWS上的实例。</p><p>   我们打开了拉动请求（＃157  -  QuestDB基准支持）IntimescaledB＆＃39; S TSBS GitHub存储库，它增加了运行基准制动力QuestDB的能力。与此同时，读者可能会克隆我们的叉形套件，并运行最近的结果，以便自己看到结果。 </p><p>为了增加无序支持，我们去了一个新的解决方案，它会产生良好的性能，而不是基于B树的良好的方法，如B-Trees orlsm的摄入框架。 我们很高兴共享旅程，以及我们急切地等待社区的反馈。  有关更多详细信息，GitHub版本为6.0版本，此版本中的添加和修复的变更。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://questdb.io/blog/2021/05/10/questdb-release-6-0-tsbs-benchmark">https://questdb.io/blog/2021/05/10/questdb-release-6-0-tsbs-benchmark</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/写入/">#写入</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/write/">#write</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数据/">#数据</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1024784.html"><img src="http://img2.diglog.com/img/2020/9/thumb_41b739e6fcf7ccc7b25fba1d52942df1.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024784.html">Mmap()写入时复制技巧：减少数组副本的内存使用量</a></div><span class="my_story_list_date">2020-9-18 14:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021787.html"><img src="http://img2.diglog.com/img/2020/9/thumb_0415c58aec6fbce3e221bea5037b263b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021787.html">三星意外泄露即将推出的980 Pro NVMe固态硬盘细节</a></div><span class="my_story_list_date">2020-9-2 23:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1013861.html"><img src="http://img.diglog.com/img/2020/7/thumb_4629681a77cfe7cf98388fb10ec187cf.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1013861.html">前Facebook工程师表示，该公司已将失败写入其政策</a></div><span class="my_story_list_date">2020-7-24 5:38</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011117.html"><img src="http://img.diglog.com/img/2020/7/thumb_bf3b605c82d5ec6d5e413ff7e13444d9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011117.html">将一部GB 400的BBC Micro(1981)变成4万美元的光盘刻录机(1987)</a></div><span class="my_story_list_date">2020-7-11 7:34</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>