<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Kraken-P2P Docker注册表</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Kraken-P2P Docker注册表</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-03 17:43:54</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/332bb03fa233c678c2dfb5877fdcf1f3.png"><img src="http://img2.diglog.com/img/2020/11/332bb03fa233c678c2dfb5877fdcf1f3.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Kraken是一个P2P驱动的Docker注册中心，专注于可伸缩性和可用性。它专为混合云环境中的Docker映像管理、复制和分发而设计。借助可插拔的后端支持，Kraken可以轻松集成到现有的Docker注册表设置中作为分布层。</p><p>自2018年初以来，Kraken一直在优步生产。在我们最繁忙的集群中，Kraken每天分发100多万个斑点，其中包括10万个1G+斑点。在峰值生产负载下，Kraken在30秒内分发20K 100MB-1G斑点。</p><p>高度可扩展。Kraken能够在每台主机上以最大下载量的50%分发Docker映像(速度限制)。集群大小和映像大小对下载速度没有显著影响。支持任意大的斑点/层。为了获得最佳性能，我们通常将最大大小限制为20G。</p><p>可插拔存储选项。Kraken不再管理数据，而是插入可靠的BLOB存储选项，如S3、GCS、ECR、HDFS或其他注册表。存储界面简单，新选项易于添加。</p><p>Kraken的高级想法是让少量专用主机向集群中每个主机上运行的代理网络播种内容。</p><p>中心组件，跟踪器，将协调网络中的所有参与者以形成伪随机规则图。</p><p>这样的图具有高连通性和小直径。因此，即使只有一个种子机，同时有数千个对等点加入，所有参与者在理论上也可以达到最低80%的最大上传/下载速度(当前实现为60%)，并且性能不会随着BLOB大小和集群大小的增加而大幅下降。有关更多详细信息，请参阅KubeCon+CloudNativeCon上团队的TechTalk。</p><p>以下数据来自一项测试，其中2600台主机同时下载一个2层的3G Docker映像(5200次BLOB下载)，所有代理的速度限制为300MB/s(使用5个跟踪器和5个源)：</p><p>您可以使用我们的示例Helm图表在您的K8S群集上部署Kraken(使用示例HTTP文件服务器后端)：</p><p>部署后，每个节点都将在localhost上公开一个docker注册表API：30081。有关从Kraken代理拉取图像的Pod规范，请参见示例。</p><p>启动带有开发配置的羊群容器(包含源、跟踪器、构建索引和代理)和两个agenttainers：</p><p>在笔记本电脑上运行dev-cluster需要Docker-for-Mac。有关devcluster的更多信息，请查看devcluster自述文件。</p><p>蜻蜓群集有一个或几个超级节点，它们协调群集中每4MB数据块的传输。</p><p>虽然超级节点将能够做出最优决策，但是整个集群的吞吐量受到一个或几个主机的处理能力的限制，并且性能将随着BLOB大小或集群大小的增加而线性下降。</p><p>Kraken的跟踪器只帮助协调连接图，并将实际数据传输的协商留给各个同行，因此Kraken使用大的BLOB可以更好地扩展。最重要的是，Kraken是HA并支持跨群集复制，这两者都是可靠的混合云设置所必需的。</p><p>Kraken最初是使用BitTorrent驱动程序构建的，但是，我们最终实现了基于BitTorrent协议的P2P驱动程序，以便与存储解决方案更紧密地集成，并更好地控制性能优化。</p><p>Kraken的问题空间与BitTorrent的设计目标略有不同。Kraken的目标是在稳定的环境中减少全球最大下载时间和通信开销，而BitTorrent是为不可预测和充满敌意的环境而设计的，因此它需要保留稀缺数据的大部分副本，并防御恶意或不良行为的同行。</p><p>尽管有这些不同之处，我们还是会不时地重新检查Kraken的协议，如果它是可行的，我们希望它能再次与BitTorrent兼容。</p><p>如果Docker注册表吞吐量不是您部署工作流程中的瓶颈，那么切换到Kraken不会神奇地加快您的Docker获取速度。为了加快扩展坞拉取速度，请考虑在构建时切换到Makisu以提高层的可重用性，或者调整压缩比，因为扩展坞拉取会将大部分时间花在数据解压缩上。</p><p>允许变异标签(例如更新最新的标签)，但是，有几件事不会起作用：由于Nginx缓存，紧接着的标签查找仍将返回旧值，并且复制可能不会触发。我们正在努力更好地支持这一功能。如果您现在需要标签转换支持，请减少构建索引组件的缓存间隔。如果您还需要在多群集设置中进行复制，请考虑将另一个Docker注册表设置为Kraken sbackend。</p><p>从理论上讲，Kraken应该分发任何大小的斑点而不会显著降低性能，但在优步，我们执行20G的限制，不能支持超大型斑点(即100G+)的生产使用。对等点在每个斑点的基础上实施连接限制，如果没有对等点相对较快地成为种子点，则新的对等点可能会缺乏连接。如果您有想要分发的超大块，我们建议您先将它们分成10G块。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/uber/kraken">https://github.com/uber/kraken</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/docker/">#docker</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/p2p/">#p2p</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/kraken/">#kraken</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1032645.html"><img src="http://img2.diglog.com/img/2020/11/thumb_e2d2cb3132e376fe7f69d08d8c3d8a92.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032645.html">在没有码头工人的情况下建造集装箱</a></div><span class="my_story_list_date">2020-11-2 1:2</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031859.html"><img src="http://img2.diglog.com/img/2020/10/thumb_916a4bb375c3015e55b3fdd880d8aa8d.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031859.html">Docker Hub映像保留策略延迟</a></div><span class="my_story_list_date">2020-10-29 10:21</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031217.html"><img src="http://img2.diglog.com/img/2020/10/thumb_683f76973c3deabfab3d9be9c2e0a460.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031217.html">如何使用Docker图像、容器和Dockerfile</a></div><span class="my_story_list_date">2020-10-26 21:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029348.html"><img src="http://img2.diglog.com/img/2020/10/thumb_c51e4db2a1d234d9b999247de43b0b4d.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029348.html">使用多阶段构建的较小的Docker映像</a></div><span class="my_story_list_date">2020-10-17 6:42</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>