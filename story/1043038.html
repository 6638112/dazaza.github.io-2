<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>加密备份枪战 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">加密备份枪战 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-03 11:13:39</div><div class="page_narrow text-break page_content"><p>最近，我一直在花时间来提高bupstash（我的加密备份工具）的性能，并想将其与一些现有工具进行比较，以尝试在备份工具领域中找到其相对性能。</p><p> 这篇文章比较了一系列简单的基准测试中的bupstash，restic，borg备份和普通的tar + gzip + GPG。</p><p>   随时查看项目网站以了解更多信息，让我们进入基准测试。</p><p>    该测试计算机具有AMD Ryzen Threadripper 1950X 16核处理器，16 GB内存和NVMe SSD硬盘驱动器。最好只是相对地比较结果，因为要完全复制我的测试环境将很困难。</p><p> 我用于基准测试的脚本可以在这里找到，尽管它们确实需要针对您的环境进行调整。</p><p>  对于此基准测试，我们采用20个连续的Linux内核源代码版本，并将它们全部添加到同一目录中，然后创建快照并测量生成的tarball /存储库的大小。</p><p> 为此测试选择的linux内核版本是5.9版之前的所有连续git commit，其结果目录包含21 GB的未压缩文件。 </p><p>该基准测试表明，与普通的tarball相比，更先进的工具具有优势，当将相似的数据多次添加到备份存储库中时，它们都具有极好的压缩率。</p><p>    快照都是针对tmpfs创建的，因此希望不会测量网络或磁盘活动引起的延迟。</p><p>       该基准与新鲜的本地快照基准相同，只不过这些文件是通过ssh发送到托管在Google云上的远程服务器的。该基准仅应视为延迟对工具性能的影响的近似值，因为它取决于网络速度。</p><p> 在进行基准测试时，与远程服务器的连接可以总结如下：</p><p>      普通的tar赢得了胜利，Restic在这里表现不佳，它具有对时延敏感的上传协议。</p><p>  该基准与新的本地快照基准相同，除了现在我们使用工具的内置缓存机制来测量增量快照的时间。这意味着每个工具都会记录其已发送的文件，并且能够跳过此工作。</p><p>     增量tar是这里的明显赢家，但是为什么其他工具速度较慢？我认为这主要是因为其他工具将每个快照作为完整备份呈现给用户，因此进行了额外的工作以使最终用户免于手动管理增量备份。 </p><p>我也很有趣，bupstash put比其他类似工具快一个数量级，尽管我目前无法清楚地解释为什么可能是这种情况。</p><p>  该基准与增量本地快照基准相同，只不过这些文件是通过ssh发送到托管在Google云上的远程服务器的。</p><p>        在此基准测试中，我们会将在新的本地快照基准测试中创建的快照还原到tmpfs。这是衡量需要从备份存储库进行批量灾难恢复时发生的情况的信息。</p><p>       在此基准测试中，我们会将在新的远程快照基准测试中创建的快照还原到tmpfs。与以前的基准测试的主要区别是在备份存储库和还原点之间引入了Internet连接。</p><p>      有趣的是，网络的引入使tar领先于bupstash进行备份还原-这是我非常有兴趣进一步研究的事情。</p><p>  在此基准测试中，我们将从同一台计算机上的备份存储库中删除旧快照。对于此测试，我们生成一个备份存储库，其中包含不同版本的Linux内核源代码的50个不同的快照，然后确定删除其中一个快照所花的时间。当不再需要旧基准备份时，此基准可以模拟将旧备份从备份存储库中循环出来。</p><p> 具有增量备份的Tar无法轻易支持对旧备份的修剪，因此不参与此基准测试。 </p><p>在修剪备份存储库时，bupstash垃圾收集器的速度比restic和borg快了一个数量级。</p><p>  在此基准测试中，我们将从存储在远程服务器上的备份存储库中删除旧快照。远程服务器与新鲜远程快照基准测试中使用的服务器相同，测试数据与本地修剪基准标记相同。</p><p>       对于此基准，我们重复新的快照基准，但是要测量“ time”命令报告的客户端ram峰值使用量（RSS）。对于tar，我们通过将tar，gpg和gzip的峰值内存使用量相加来近似得出。</p><p>     与restic和borg相比，Bupstash的存储效率非常高，但最终却失去了tar + gzip + GPG的简单性。</p><p>  GNU Tar + gzip + gpg是一个出色的加密备份选项，性能比我预期的要好。我认为tar和gpg对于喜欢自己备份自己的备份脚本的用户来说仍然是一个不错的选择。考虑到这一点，我们必须问其他工具解决的tar问题是什么？我的观点是，与使用borg / restic / bupstash相比，使用增量tar时管理增量备份，重复数据删除，修剪和搜索备份要困难得多。使用增量tar，很快很难跟踪哪些增量tarball相互依赖，并且您通常需要定期进行完整快照-失去了大部分速度优势。</p><p> 作为bupstash有偏见的作者，我也对bupstash的表现感到满意，并希望我将来能将其进一步推广。 Restic，尽管在本地操作上速度很快，但是当网络延迟变得混乱时，似乎落后于其他工具。 Borg是一个全方位的出色工具，并且表现出色。</p><p> 我可以看到每种测试工具的优点和改进的余地，并鼓励大家尝试一下，如果您还没有尝试过的话。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://acha.ninja/blog/encrypted_backup_shootout/">https://acha.ninja/blog/encrypted_backup_shootout/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/备份/">#备份</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/backup/">#backup</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1041905.html"><img src="http://img2.diglog.com/img/2020/12/thumb_7cf484ceeae6bc7fc2161eddc603cd15.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1041905.html">与NNCP的异步通信：Tor，SSH和UUCP之间的交叉 </a></div><span class="my_story_list_date">2020-12-26 19:29</span></div><div class="col-sm"><div><a target="_blank" href="/story/1023024.html"><img src="http://img2.diglog.com/img/2020/9/thumb_8c1a71ac34aba7c4ae1625b0f97d6feb.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1023024.html">将PostgreSQL备份到云</a></div><span class="my_story_list_date">2020-9-10 3:2</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012594.html"><img src="http://img.diglog.com/img/2020/7/thumb_95785de10ff858fac9b74ab502fd72a6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012594.html">PostgreSQL中的物理备份与逻辑备份</a></div><span class="my_story_list_date">2020-7-18 2:38</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005776.html"><img src="http://img.diglog.com/img/2020/6/thumb_0086f7ab50a46d9c83bfa546aba8dd01.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005776.html">我终于找到了一个适用于Linux桌面的备份解决方案：Borg+Vorta</a></div><span class="my_story_list_date">2020-6-9 7:46</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>