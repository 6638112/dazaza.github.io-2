<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>小心异步/等待</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">小心异步/等待</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-31 00:04:31</div><div class="page_narrow text-break page_content"><p>712 Brandon Smith异步函数getPeople(){const Members=等待获取(&#34；/Members&#34；)；const非成员=等待获取(&#34；/Non-Members&#34；)；返回成员。Concat(非成员)；}。</p><p>花点时间看一下。类似这样的代码可能存在于更多的JavaScript代码库中。有时，它就在更了解情况的人的眼皮底下，包括我自己。事实上，我在一个案例中犯了这个错误，这就是促使我最初写这篇文章的原因。</p><p>你现在看到了吗？实际上，甚至编写这个版本都很棘手，因为如果没有异步/等待，就很难犯这个错误。</p><p>我们采用了两个独立的异步任务，并将它们放入一个序列中。此功能所需的时间是所需时间的两倍。</p><p>异步函数getPeople(){const Members=FETCH(&#34；/Members&#34；)；Const Non Members=Fetch(&#34；/Non-Members&#34；)；Const Both=等待承诺。All([Members，NonMembers])；返回两者[0]。Concat(两者均为[1])；}。</p><p>函数getPeople(){const Members=Fetch(&#34；/Members&#34；)；const Non Members=Fetch(&#34；/Non-Members&#34；)；Return Promise。全部([成员，非成员])。则(Both=&gt；Both[0]。CONCAT(两者[1]))；}。</p><p>请注意，当写成简单的承诺时，糟糕的版本要复杂得多。Promises API鼓励并行性，当您需要按顺序放置东西时，它会变得笨拙。异步/等待在很大程度上是作为一种解决方案出现的，用于当您确实需要按顺序发生事情时，比如当您需要将一个请求的输出作为参数提供给下一个请求时。而且可以说，这至少让这两个案件都变得更干净了。但重要的是，它颠倒了它们，使顺序流比平行流更容易。</p><p>即使您理解语法最终要转换成的承诺代码，也很容易落入这种陷阱。如果你还不了解承诺以及异步/等待到底在做什么，那就更不用说了。</p><p>我不会说异步/等待是不好的(或者，也许被认为是有害的)。特别是在那些没有合理API(如承诺)的语言中，或者在闭包方面有其他限制使它们不那么容易使用的语言中，异步/等待可以使代码总体上更具可读性。</p><p>但它们确实伴随着一个相当大的陷阱。该语法的优点和缺点都在于，它允许我们接受异步的事物，并假装它们再次是连续的。我们的大脑更容易对顺序过程进行推理。</p><p>但我认为，使用Async/AWait编写内容的最简单、最清晰的方法往往是错误的，这是一种遗憾。并以一种可能永远不会被注意到的微妙方式出错，因为它只影响性能，而不影响正确性。</p><p>我是语言和图书馆的忠实拥护者，因为语言和图书馆让做通常正确的事情变得容易，做通常错误的事情变得困难。这就是说，对于异步/等待如何能够以不同的方式实现，我没有一个建议。我只是后悔事情变成这样。</p><p>但至少，我认为随着越来越多的语言采用这种语法，人们意识到它很容易被误用，这一点变得越来越重要。</p><p>如果您不确定代码是如何运行的，请查看瀑布图，看看是否有机会使应用程序更快。</p><p>您还可以使用这个经验法则：如果等待的函数调用没有使用另一个等待的函数调用的结果(或从结果派生的结果)，则应该使用Promise.all()使它们同时发生。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.brandonsmith.ninja/blog/async-await">https://www.brandonsmith.ninja/blog/async-await</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/小心/">#小心</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/async/">#async</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>