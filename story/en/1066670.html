<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我的公寓里有多少苍蝇？ How many flies are in my apartment?</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">How many flies are in my apartment?<br/>我的公寓里有多少苍蝇？ </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-18 17:32:05</div><div class="page_narrow text-break page_content"><p>Recently, I was sitting on my fire escape with the window to my apartment slightly open. As there are no screens, I wanted to keep it as closed as possible to keep out any bugs. However, I needed to keep it somewhat open so that I&#39;d be able to get back indoors.</p><p>最近，我坐在我的火上，靠着窗户略微打开。由于没有屏幕，我想保持它尽可能关闭以防止任何错误。但是，我需要保持稍微开放，以便我能够回到室内。</p><p> As it was a hot, smelly day in New York City, the flies were abuzz. I found it hard to relax on my illegal balcony knowing that I was basically inviting all of the flies into my apartment for an all-you-can-eat buffet of human detritus.</p><p> 因为它在纽约市是一个热的，臭味的一天，苍蝇是Abuzz。我发现在我的非法阳台上很难放松，知道我基本上邀请所有的苍蝇进入我的公寓，以便为一体的人类碎屑的自助餐。</p><p> This got me thinking how effective the partially closed window is at keeping out the flies. What does the function of flies in my apartment over time look like? The perfect question for a Sunday afternoon when you have no friends (unless you count the flies).</p><p> 这让我思考了部分闭合的窗户在保持苍蝇的效果。随着时间的推移，我的公寓里的苍蝇的功能是什么样的？当你没有朋友时，周日下午的完美问题（除非你计算苍蝇）。</p><p>  In order to run this simulation, we need a model of how a fly navigates its trash-filled world. As a first pass, I&#39;ll model a fly as moving in a random direction with a random speed for each timestep of the simulation. Pretty simple, but flies do appear to be relatively simple creatures.</p><p>  为了运行此模拟，我们需要一个模型，飞行如何导航其垃圾充填世界。作为第一次通过，I＆＃39; LL模型是在随机方向上移动，随机速度为每次模拟的时间。相当简单，但苍蝇似乎是相对简单的生物。</p><p> If we take a look at the trajectory of a single fly using this model, it does indeed look random:</p><p> 如果我们使用此模型看一只蝇轨的轨迹，它确实看起来很随机：</p><p>  Now let&#39;s simulate a bunch of flies. To do this, first we initialize an array  xs to hold the position of the flies. We&#39;ll normally distributed this in a  2*WORLDHEIGHT x WORLDHEIGHT square. We&#39;ll also initialize all the flies to be outside (setting the window to be at  x = 0 and indoors to be  x &gt; 0).</p><p>  现在让＆＃39; s模拟一堆苍蝇。为此，首先我们初始化数组XS以保持恒定的位置。我们＆＃39; ll通常在2 * worldheight x worldheight广场分发了这一点。我们＆＃39; LL还初始化到外面的所有苍蝇（将窗口设置为x = 0，室内为x＆gt; 0）。</p><p> xs  =  np . random . randn ( NFLIES ,  2 )  *  np . array ([[ WORLDHEIGHT  *  2 ,  WORLDHEIGHT ]]) xs [( xs [:, 0 ]  &gt;  0 ), 0 ]  *=  - 1 xs [( xs [:, 1 ]  &lt;  0 ), 1 ]  *=  - 1</p><p> xs = np。随机的 。 Randn（Nflies，2）* NP。阵列（[[worldheight * 2，worldheight]] xs [（xs [：，0]＆gt; 0），0] * =  -  1 xs [（xs [：，1]＆lt; 0），1] * = -  1 </p><p>    def  update ( xs ,  vs ):  # 1. Propagate the flies.  xps  =  xs  +  vs  *  dt  # 2. Make sure flies can&#39;t go through the glass.  inoutmask  =  ( np . sign ( xps [:, 0 ])  *  np . sign ( xs [:, 0 ]))  ==  - 1  m  =  ( xps [ inoutmask , 1 ]  -  xs [ inoutmask , 1 ])  /  ( xps [ inoutmask , 0 ]  -  xs [ inoutmask , 0 ]  +  1e-7 )  b  =  xps [ inoutmask , 1 ]  -  m  *  xps [ inoutmask , 0 ]  invalidmask  =  b  &gt;  WINDOWHEIGHT  idxs  =  np . where ( inoutmask )[ 0 ][ invalidmask ]  xps [ idxs , 0 ]  =  1e-4  *  np . sign ( xs [ idxs , 0 ])  xps [ idxs , 1 ]  =  b [ invalidmask ]  # 3. Bound the flies.  xps [( xps [:, 0 ]  &gt;  WORLDHEIGHT ), 0 ]  =  WORLDHEIGHT  xps [(( xps [:, 1 ]  &gt;  WORLDHEIGHT )  &amp;  ( xps [:, 0 ]  &gt;  0 )), 1 ]  =  WORLDHEIGHT  xps [( xps [:, 1 ]  &lt;  0 ), 1 ]  =  0  # 4. Set the new positions and velocities.  xs  =  xps  vs  =  np . random . randn ( NFLIES ,  2 )  vs  =  ( vs  /  np . sqrt (( vs  **  2 ). sum ( 1 )[:, np . newaxis ]))  *  maxv  return  ( xs ,  vs )</p><p>def更新（xs，vs）：＃1.传播苍蝇。 xps = xs + vs * dt＃2.确保苍蝇可以＆＃39; t穿过玻璃。 INOUTMASK =（NP。符号（XPS [：，0]）* NP。符号（xs [：0]））==  -  1 m =（XPS [INOUTMASK，1]  -  XS [INOUTMASK，1]）/（ XPS [INOUTMASK，0]  -  XS [INOUTMASK，0] + 1E-7）B = XPS [INOUTMASK，1]  -  M * XPS [INOUTMASK，0] InvalidMASK = B＆GT; WindowHeight IDXS = NP。其中（InoutMask）[0] [InvalidMask] XPS [IDXS，0] = 1E-4 * NP。标志（xs [idxs，0]）xps [idxs，1] = b [InvalidMask]＃3。绑定苍蝇。 XPS [（XPS [：，0]＆gt; worldheight），0] = worldheight xps [（（xps [：，1]＆gt; worldheight）＆amp;（xps [：，0]＆gt; 0）），1] = WorldHeight XPS [（XPS [：，1]＆lt; 0），1] = 0＃4。设置新的位置和速度。 xs = xps vs = np。随机的 。 randn（nflies，2）vs =（vs / np。sqrt（（vs ** 2）。和（1）[：，np。newaxis]））* maxv返回（xs，vs）</p><p> Step 2 might require a little explaining. Every timestep, each fly travels in a line from its previous position to its new position. We only want the flies to be able to travel through the crack at the bottom, so we need a way to ensure they can&#39;t travel through the glass.</p><p> 步骤2可能需要一点解释。每次时间，每次飞行都会从其以前的位置行进到其新位置。我们只希望苍蝇能够穿过底部的裂缝，所以我们需要一种方法来确保它们可以＆＃39; T穿过玻璃。</p><p> To do that, we first find all of the flies that changed indoor/outdoor state this timestep ( inoutmask). This can be done by comparing the sign of the previous and current  x since the window is at  x = 0. We can then calculate where the fly crossed the line  x = 0 using some middle school math.</p><p> 为此，我们首先找到所有更换室内/室外状态的苍蝇这个时间戳（InoutMask）。这可以通过比较前一个和当前x的符号来完成，因为窗口在x = 0.然后，我们可以使用一些中学数学来计算飞行x = 0的速度。</p><p> It should be impossible for the fly&#39;s y-intercept to be greater than the height of the window crack, we for thos flies ( invalidmask), we set their y to be where they tried to cross the window and their x to be some small epsilon on the side that they came from. I don&#39;t just set it to 0 because then the fly would not get picked up by  inoutmask and may be able to travel through the glass on the next iteration.</p><p> 飞行应该是不可能大于窗户裂缝的高度，我们为苍蝇（InvalidMask），我们将他们设置为他们试图穿过窗口的地方和他们的X在他们来自的一边是一些小epsilon。我不要把它设置为0，因为那么飞行不会被inoutmask拿起，并且可能能够在下一次迭代上穿过玻璃。</p><p> Step 3 just makes sure that the fly does not go through the arbitrary walls of the world. Currently, only the floor and the walls of my apartment are defined so a fly can escape to infinity in the -x or +y directions while outdoors. Here&#39;s a diagram of the world for the visually-inclined:</p><p> 第3步只是确保飞行不通过世界的任意墙壁。目前，只定义了我的公寓的地板和墙壁，所以飞行可以在室外逃离-X或+ y方向的无限远。这里的视觉倾向的世界图和＃39;</p><p> ---------------- y = h | | | | | | | _________________________________| x = -h x = 0 x = h</p><p> ---------------- y = h | | | | | | | _________________________________ | x = -h x = 0 x = h</p><p> OK, we can finally see the flies fly! Because of the random velocity vectors, they unsurprisingly look quite jittery:</p><p> 好的，我们终于可以看到苍蝇飞！由于随机速度向量，他们不想到的看起来非常吉特： </p><p>    This is great and all but the flies don&#39;t look too realistic. Let&#39;s make their velocity vectors vary smoothly so that they don&#39;t look like a dubstep light show.</p><p>这是伟大的，除了苍蝇Don＆＃39; t看起来太现实了。让＆＃39;■使他们的速度矢量变得平滑，使得他们不像Dubstep Light展示。</p><p> To do this, we&#39;ll pick a random angle in the range  [-pi/8, pi/8] to rotate each fly&#39;s velocity vector by. In this simulation, we won&#39;t vary the magnitude of their velocities at all.</p><p> 为此，我们＆＃39; ll在[-pi / 8，pi / 8]范围内挑选一个随机角度，每个飞行旋转＆＃39; s速度向量。在这个模拟中，我们赢得了＆＃39; t完全改变了它们的速度的大小。</p><p>    def  update ( xs ,  vs ):  ...  # 2. Make sure flies can&#39;t go through the glass.  ...  # 2.5. Flip the x-velocity of the invalid flies.  vs [ idxs , 0 ]  *=  - 1  # 3. Bound the flies.  ...  # 4. Set the new positions and velocities.  ...  dthetas  =  np . random . randn ( NFLIES )  *  np . pi  /  8.  Cs ,  Ss  =  np . cos ( dthetas ),  np . sin ( dthetas )  Rs  =  np . array ([[ Cs ,  - Ss ],  [ Ss ,  Cs ]]). transpose ( 2 ,  0 ,  1 )  vs  =  ( Rs  *  vs . reshape ( NFLIES ,  2 ,  1 )). sum ( axis = 1 )</p><p>    def更新（xs，vs）：...＃2.确保苍蝇可以＆＃39; t穿过玻璃。 ...＃2.5。翻转无效苍蝇的X速度。 vs [idxs，0] * =  -  1＃3.绑定了苍蝇。 ...＃4。设置新的位置和速度。 ... dthetas = np。随机的 。 Randn（Nflies）* NP。 PI / 8.CS，SS = NP。 COS（DTHETAS），NP。 SIN（DTHETAS）RS = NP。数组（[[CS，SS]，[SS，CS]）。转置（2,0,1）vs =（Rs * vs。重塑（nflies，2,1））。总和（轴= 1）</p><p> While not necessary, Step 2.5 was added so that the flies don&#39;t take get stuck keep trying to go through the window as their velocity rotates slowly.</p><p> 虽然没有必要，加入步骤2.5，使得苍蝇不＆＃39; T取得卡住随着速度慢慢旋转而持续尝试通过窗户。</p><p> In Step 4, instead of choosing new random values for  vs, we create a random rotation matrix for each fly and rotate their initial velocities by it.</p><p> 在步骤4中，我们为每个飞行创建随机旋转矩阵而不是选择新的随机值，而不是为随机旋转矩阵创建一个随机旋转矩阵，并通过它旋转它们的初始速度。</p><p> If we take a look at the animation now, we can see the flies look slightly more realistic (if not still a bit spazzy):</p><p> 如果我们现在看看动画，我们可以看到苍蝇看起来有点逼真（如果不是有点差不多）：</p><p>   While the flies now obey the laws of aviation, there&#39;s still something that seems missing. Normally, flies  want to get indoors. They  need to get indoors. So to simulate this, I added an attractor (maybe a rotting piece of fruit) at a position  A indoors to lure the flies.</p><p>   虽然苍蝇现在遵守航空法律，但仍然存在似乎缺失的东西。通常，苍蝇想要在室内。他们需要在室内。所以要模拟这一点，我在室内的位置添加了吸引物（也许是腐烂的水果），以引诱苍蝇。 </p><p> To do this, I added one variable to the fly&#39;s state: a scalar value  a which represents how close they are to the delicious piece of fruit. The fly will be able to remember the most recent value of  a so that it can know whether it&#39;s getting warmer or colder.</p><p>为此，我将一个变量添加到飞行和＃39; s状态：标量值a，表示它们是多么近的果实。飞行将能够记住一个最近的一个值，所以它可以知道它是否越来越温暖或更冷。</p><p>  def  attraction ( x ,  A ):  return  1.  /  ( 1e-7  +  np . sqrt ((( x  -  A . reshape ( 1 ,  2 ))  **  2 ). sum ( 1 ))) def  update ( xs ,  vs ,  ats ):  # 1. Propagate the flies.  ...  ats  =  attraction ( xs ,  A )  atps  =  attraction ( xps ,  A )  # 4. Set the new positions and velocities.  ...  dthetas  =  np . random . randn ( NFLIES )  *  np . pi  /  16.  wrongmask  =  atps  &lt;  ats  dthetas [ wrongmask ]  +=  np . random . randn ( wrongmask . sum ())  *  np . pi  /  8.  ...  return  ( xs ,  vs ,  ats )</p><p>  def attraction（x，a）：返回1. /（1e-7 + np。sqrt（（（x-a。重塑（1,2））** 2）。总和（1）））def更新（xs， vs，ats）：＃1.传播苍蝇。 ... ATS =吸引力（XS，A）ATP =吸引力（XPS，A）＃4.设置新的位置和速度。 ... dthetas = np。随机的 。 Randn（Nflies）* NP。 PI / 16. WorlMask = ATPS＆lt; ATS DTHETAS [WorlMask] + = NP。随机的 。 randn（worlmask。sum（））* np。 pi / 8. ...返回（xs，vs，ats）</p><p>  If the attraction increased from the previous timestep, keep going in the same direction (do nothing)</p><p>  如果吸引力从上一步的时间增加，继续沿同一方向（什么都不做）</p><p> We add another random rotation in the range of  [-pi/16, pi/16] just to keep things interesting.</p><p> 我们在[-pi / 16，pi / 16]范围内添加另一个随机旋转，只是为了保持有趣的东西。</p><p> The fly will keep going in a straight line (with some random jitter) as long as the attraction it sense is increasing. If it senses that it&#39;s going in the wrong direction, it will more aggressively explore its neighborhood until it finds a good direction to head in.</p><p> 只要它感觉越来越多，飞行就会继续直线（有一些随机抖动）。如果它感觉到它呈现错误的方向，它将更积极地探索其邻居，直到它找到了良好的前往。</p><p> As you can see by the new trajectory, this seems to work fairly well for simulating a stupid but well-motivated fly:</p><p> 正如你可以看到的新轨迹所看到的那样，这似乎相当好，因为模拟了一个愚蠢但积极的飞行：</p><p>  However, it seems on the aggregate, the flies just swarm the attractor. Thankfully this isn&#39;t the case in real life as I currently only have two flies in my apartment.</p><p>  但是，似乎在骨料上，苍蝇只是盛行的吸引子。谢天谢地，这是现实生活中的案例，因为我目前只有两个苍蝇在我的公寓里。 </p><p>   With this information in hand, I finally wanted to answer the popular game show question: &#34;How many flies are in my apartment?&#34;</p><p>通过手头的这些信息，我终于想回答了流行的游戏显示问题：＆＃34;我的公寓里有多少苍蝇？＆＃34;</p><p> The first experiment I ran was to plot the average number of flies given how open the window was over a few max velocities. Here is the result for the random flies:</p><p> 第一个实验我ran是为了绘制窗户的平均苍蝇数量超过几个最大速度。以下是随机苍蝇的结果：</p><p>  Quite nicely, it turns out that as the window, gets more open, the number of flies indoors increases linearly.</p><p>  非常好，事实证明，随着窗口，变得更加开放，苍蝇的数量在室内线性增加。</p><p> For the smooth flies, we see a less linear function. I&#39;m not quite sure why.</p><p> 对于光滑的苍蝇，我们看到了较少的线性函数。我并不肯定为什么＆＃39。</p><p>  The attracted flies produce an even more asymptotic (is that a word?) plot. My hypothesis is that this is because the flies are more likely to find their way to the trash than in other models so it doesn&#39;t help them as much when the window is more open.</p><p>  被吸引的苍蝇产生了更加渐近的（是一个词？）情节。我的假设是，这是因为苍蝇更有可能找到他们的垃圾而不是在其他模型中，所以它在窗户更加开放时帮助它们。</p><p>  Then I wanted to see how long the simulation ran for affected the number of flies. We see similar results for the random and smooth flies. With faster moving flies (the orange and green plots), random moving or in the smooth case randomly initialized flies are more likely to barrel off towards infinity when outside. Therefore, the total number of flies decreases as the simulation progresses.</p><p>  然后我想看看模拟运行的时间有多长时间受到影响的苍蝇数量。我们看到随机和平滑苍蝇的结果。具有更快的移动苍蝇（橙色和绿色地块），随机移动或在平滑情况下随机初始化苍蝇更可能在外部朝向无穷大。因此，随着仿真进展的进展，蝇的总数减少。</p><p>  In the case of the attracted flies, we again see that a higher max velocity results in the number of flies peaking earlier. However, because the flies have some knowledge as to what direction to go in, they tend not to drift out into the ether and the population eventually plateaus.</p><p>  在被吸引的苍蝇的情况下，我们再次看到更高的最大速度导致前面达到峰值的峰值。但是，因为苍蝇有一些关于进入的方向的知识，所以他们往往不会进入乙醚和人口最终是平坦的。 </p><p>   Thanks for joining me on this pointless exerise and in case you missed it the answer to the titular question is two. Their names are Buzz and Neil.</p><p>谢谢你加入这个毫无意义的运动，如果你错过了这个问题的答案是两个。 他们的名字是嗡嗡声和尼尔。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://saml98.github.io/jekyll/update/2021/06/13/flies.html">https://saml98.github.io/jekyll/update/2021/06/13/flies.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/公寓/">#公寓</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/flies/">#flies</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/苍蝇/">#苍蝇</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>