<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>保护您的PostgreSQL数据库 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">保护您的PostgreSQL数据库 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-03 04:08:06</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/21137f6a309a78dd12682fe7473eb64c.png"><img src="http://img2.diglog.com/img/2021/4/21137f6a309a78dd12682fe7473eb64c.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>数据库是黑客的圣杯，因此，必须遵守最大的小心。这是一系列文章中的第一个，其中我们将介绍保障您的数据库的最佳实践概述。我们开始符合最受欢迎的开源数据库，PostgreSQL，并将过度达到您需要思考的安全水平：</p><p>    在理想的世界中，您的PostgreSQL服务器将完全孤立，并不允许任何入站连接，SSH或PSQL。遗憾的是，这种类型的空中安装程序不是PostgreSQL的东西支持的东西。</p><p> 您可以做的下一个最佳方法可以改善数据库Server的安全性，以锁定对数据库正在运行的节点的端口级访问。默认情况下，PostgreSQL在TCP端口5432上侦听。根据操作系统，可能会有不同的方法来阻止其他端口。但是使用inlux最广泛使用的防火墙实用程序，以下将成为技巧：</p><p> ＃确保不要删除已建立的连接。-A输入-M状态--State已建立，相关--j接受＃允许ssh.ptables -a输入-p tcp-m状态 -  state new --dport 22 -j接受＃允许postgreesql.partabes-a输入-p tcp-m状态--state new --dport 5432 -j接受＃允许所有出站，删除其他inbound.past -a-a output -j acceptiptables -a输入-j dropiptables -a转发-J降</p><p> 注意：更新iptables规则时，使用iptables-applytool是一个好主意，它会自动滚动更改，以防您锁定自己。</p><p> 上面的PostgreSQL规则将允许任何人连接到端口5432.只需接受来自某些IP地址或SUBNETS的连接即可更严格：</p><p> ＃只允许访问本地子网的PostgreSQL端口。-a输入-p tcp-m状态 -  state new --dport 5432-s 192.168.1.0/24 -J接受 </p><p>回到我们理想的方案，能够完全防止端口5432的inboundConnection将需要某种本地代理，该代理将持久的出站连接与客户端节点（-s）进行持久的出站连接，并且可以举办到本地PostgreSQL实例的代理流量。</p><p> 此技术称为“反向隧道”，可以使用SShremote端口转发功能进行演示。您可以通过从PostgreSQL数据库运行的节点运行文件来打开反向隧道：</p><p>  当然，＆lt; client-host＆gt;应该从PostgreSQL节点访问，并运行SSH守护程序。该命令将在客户端计算机上的端口5432上将端口5432转发到端口5432，并且您将能够通过隧道将数据库连接到数据库：</p><p>   一个很好的做法，可以使用listens_addresses配置文件指令限制服务器正在侦听前链接连接的地址。如果节点PostgreSQL运行有多个网络接口，请使用它捣碎，确保服务器仅在侦听该界面（-S）上，以其将连接到它：</p><p>  如果连接到数据库的客户端始终驻留在同一节点上（或者说，请与作为侧面配置文件运行的PostgreSQL一起使用的Poctgr​​eSQL），则禁用TCP套接字侦听可以完全消除来自图片的网络。将收听地址设置为空字符串使服务器接受acceptonly unix-domain套接字连接：</p><p>   随着世界上大部分网络迁移到HTTPS，还有很少的借口，使用强大的传输加密，对于数据库连接而不是，因此PostgresQL支持TLS（仍称为文档，配置和CLI的SSL）本地性和提供了使用它的方法，包括服务器和客户端身份验证。</p><p>  对于服务器身份验证，您首先需要获取提供给连接客户端的ServerWill的证书。让我们加密使得它真的很容易忘记免费X.509证书，例如使用CESTBOTCLI工具： </p><p>请记住，默认情况下，默认情况下使用HTTP-01ACME挑战来验证证书请求，该挑战需要指向要打开的节点和端口80的所请求域的有效DNS的证书请求。</p><p> 如果您无法使用允许员加密某种原因并希望生成所有秘密接种，则可以使用OpenSSL CLI工具来执行以下操作：</p><p> ＃制作自签名服务器ca.openssl req -sha256 -new-x509 -days 365-nodes \ -out server-ca.crt \ -keyout server-ca.key＃生成服务器csr。将主机名置于CN Fields.Openssl req -sha256中的#todation to to to＃the divels。 \ -out server.csr \ -keyout server.key＃sign一个服务器证书。apenssl x509 -req -sha256 -days 365 \ -in server.csr \ -ca server-ca.crt \ -cakey server-ca.key \ -cacreateserial \ -out server.crt</p><p> 当然，在生产环境中，您要确保在到期日之前更新复杂化物。</p><p>  客户端证书身份验证允许服务器通过验证TheClient呈现的X.509证书来验证AConnecting客户端的标识。由可信证书颁发机构签名。</p><p> 使用不同的证书机构来发出Client Andserver证书是一个很好的想法，因此让我们创建一个客户端CA并使用它来签署ClientCertificate：</p><p> ＃制作一个自签名的客户端ca.openssl req -sha256 -new-x509 -days 365-nodes \ -out client-ca.crt \ -keyout client-ca.key＃生成客户端csr。 CN必须包含您＃的数据库角色的名称，您将使用它来连接到Database.openssl req -sha256 -new -nodes \ -subj＆＃34; / cn = Alice＆＃34; \ -out client.csr \ -keyout server.key＃签名客户端证书.Openssl x509 -req -sha256 -days 365 \ -in client.csr \ -ca client-ca.crt \ -cakey client-ca.key \ -cacreateserial \ -out client.crt </p><p>请注意，客户端证书的公共名称（CN）字段必须包含客户端连接到的数据库帐户的名称。 postgreSQL服务器威尔斯建立客户的身份。</p><p>  将所有的作品放在一起，您现在可以配置PostgreSQL Server TOACcept TLS连接：</p><p> ssl = onssl_cert_file =＆＃39; /path/to/server.crt&#39; ssl_key_file =＆＃39; /path/to/server.key&#39; ssl_ca_file =＆＃39; / path / to / client-ca .crt＆＃39; ＃此设置默认情况下，但是当涉及到Security.ssl_prefer_server_ciphers =上，＃tls 1.3将提供最强大的安全性，并在＃控制服务器和客户端时建议＃3.ssl_min_protocol_version =＆＃39 ; tlsv1.3＆＃39;</p><p> 最后一个配置的配置是要更新基于PostgreSQL ServerHost的身份验证文件（PG_HBA.conf），以要求所有连接的TLS使用X.509证书对客户端进行身份验证：</p><p>  现在，连接到数据库服务器的客户端必须呈现由客户端证书颁发机构签名的validCertificate：</p><p>  请注意，默认情况下，默认情况下，PSQL不会执行服务器证书验证，因此必须将“SSLMode”设置为验证 - 完全或验证-CA，具体取决于使用与编码X.509证书的相同主机名是否与PostgreSQL服务器连接到PostgreSQL服务器场地。</p><p> 要减少命令的详细程度，不必输入要连接到数据库的TLS秘密时间的路径，可以使用PostgreSQLConnection服务文件。它允许您将连接参数分组为“服务”，然后通过“服务”参数在连接字符串中引用。 </p><p>现在，在连接到数据库时，您只需要指定服务命名为要连接的数据库的名称：</p><p>    到目前为止，我们已经探索了如何保护PostgreSQL数据库服务器从销售网络连接，使用强大的传输加密，并使服务器和客户端可以相互信任相互TLSAuthentication的彼此的身份。另一个拼图是弄清楚用户可以在连接到数据库和HATTHEIR身份验证的情况下访问的内容。这通常被称为授权。</p><p> PostgreSQL具有全面的用户权限系统，该系统围绕Colescolscolce构建。在现代PostgreSQL版本（8.1和较新）中“角色”与“用户”签名，因此使用PSQL（例如“User = Alice”）的任何数据库帐户名称，实际上是具有Login属性的角色，允许ITConnect数据库。实际上，以下SQL命令等同于：</p><p>  除了登录的能力之外，角色可以具有其他属性，允许它们绕过所有权限检查（超级用户），创建数据库（创建的），创建其他角色（CreereeLe）等。</p><p> 除了属性之外，角色可以被授予可以分离的权限两类：其他角色和数据库对象权限的成员身份.Llet看看这些工作如何行动。</p><p>   创建表server_inventory（ID INT主键，描述文本，IP_Address文本，环境文本，所有者文本，）;</p><p> 默认情况下，PostgreSQL安装包括用于引导数据库的超级用户角色（通常称为“postgres”）。对所有数据库过程使用此角色相当于始终使用Linux上的“root”登录，这不是一个好主意。相反，让我们在最不特权原则之后根据需要创建一个不特权的角色和分配。 </p><p>您可以单独为每个新用户/角色分配权限，而不是为每个新用户/角色分配权限，而是Cancreate将“组角色”并授予此组中的其他角色（映射到各个用户）。说，您希望允许您的开发人员，Alice和Bob，查看服务器库存，但不会修改它：</p><p>  - 创建一个＆＃39; t的组角色，它具有自己登录的能力 - 授予它在服务器清单表上选择权限。创建角色开发人员;在server_inventory上授予选择到开发人员; - 创建两个将继承的用户帐户＆＃34;开发人员＆＃34;权限次登录到数据库。创建角色Alice Login继承;创建角色Bob登录继承; - 将用户帐户分配给＆＃34;开发人员＆＃34;团体角色。授予爱丽丝的开发人员，鲍勃;</p><p> 现在，当连接到数据库时，Alice和Bob都将继承“开发人员”组角色的权限，并能够在服务器库存上运行查询。</p><p> 默认情况下，SELECT权限适用于所有表列，但它并没有。说，您只想允许您的实习生查看一般的ServerInventory信息而不让他们通过隐藏IP地址来连接：</p><p> 创建角色实习生;授予server_inventory的select（id，description）到实习生;创建角色查理登录继承;授予查理实习生;</p><p> 其他最常用的数据库对象权限是插入，更新，删除和截断对应于相应的SQL语句，但也可以分配用于连接到特定数据库，在模式中创建新的数据库，创建函数等的特定数据库的权限，执行函数等。在PostgreSQL文档的特权上拍摄Alook以查看整个列表。</p><p>  postgreSQL权限系统的更高级功能之一是行 - 水彩安全，允许您授予表中的行的子集。这包括可以用SELECT语句查询的两行，因为可以插入的WELLAS行，更新和删除。 </p><p>要开始使用行级安全性，您需要两件事：使其能够为表anddefine控制行级访问的策略。</p><p> 在我们上一个示例的建筑物上，假设您希望允许用户只授予自己的服务器。首先，在表上启用RLS：</p><p>  没有定义的任何策略，PostgreSQL默认为均扮演角色（表所有者除了创建的角色）的角色（表所有者）有任何访问权限。</p><p> 行安全策略是PostgreSQL的布尔表达式将评估应该退回或更新的Foreach行。选择语句返回的行按使用子句指定的表达式检查，而通过插入，更新或deleteStatememed更新的行将针对带检查表达式检查。</p><p> 让我们定义几个策略，允许用户查看所有服务器，而是仅由表的“所有者”字段所确定的：</p><p> 在server_inventory上创建策略select_all_servers以供选择（true）;在server_inventory上创建策略update_own_servers for使用check（current_user =所有者）使用（current_user =所有者）更新;</p><p> 请注意，只有表的所有者只能为其创建或更新行安全策略。 </p><p>到目前为止，我们大多符合先发制人的安全措施。在基石安全原则之后，防守深入，我们已经互相探讨了Howthey层，以帮助减慢假设的攻击者通过系统进行前进。</p><p> 保持准确且详细的审计跟踪是经常被忽视的系统的安全属性之一。监视数据库服务器的网络级别或节点级别是此帖子的范围，但是让我们在PostgreSQL Server本身时获取我们有哪些选项。</p><p> 您可以做的最基本的事情，以提高对MobileWithIn在数据库中的内容的可见性，以便启用详细日志记录。添加以下DirectIvesto服务器配置文件以打开所有连接尝试的日志记录，所有已执行的SQL语句：</p><p> ;日志成功和不成功的连接尝试。 log_connections =上;日志终止会话。 log_disconnections =上;记录所有执行的SQL语句。 log_statement =全部</p><p> 不幸的是，这几乎是您可以在箱子外安装的标准托管的PostgreSQL安装程度。这比无所事事更好，但它不会超越少数数据库服务器和简单的“Grepping”。</p><p> 对于更高级的PostgreSQL审核解决方案，您可以使用诸如PGAudit的第3个PartyExtension。如果您正在使用自托管的Postgresqlinstance，则您将手动安装分机。一些托管版本，例如AWS RDS支持它的框中，因此您需要启用它。</p><p> PGaudit为记录的陈述带来了更多的结构和粒度。但是，请记住，它仍然是基于日志的，这使得使用IFYOU将以结构化格式将您的审计日志运送到外部SIEM System，这使得其挑战是有挑战性的。 </p><p>传送数据库访问中的开源项目，我们建立了帮助，以帮助您实现在此帖子中呈现的PostgreSQL（和其他）数据库的最值实践。</p><p> 用户可以通过单点登录流程和useShort Live X.509证书访问数据库，而不是RengalCredentials。</p><p> 数据库不需要在公共互联网上暴露，并且可以使用Teleport的内置反向隧道系统安全地在空调环境中进行安全。</p><p> 管理员和审核员可以看到数据库活动，例如与特定用户在审核日志中的特定用户身份相关联的Sessionsand SQL语句，并可选择将其运送到外部系统。</p><p> 如果您有兴趣，您可以开始使用Teleport Database Access and，浏览演示，读取文档，下载开源版本，并在Github上探索代码。</p><p>  与任何具有安全性的系统一样，正确保护的访问Toyour数据库实例需要对堆栈的多个级别采取保护措施。</p><p> 在本文中，我们已经了解了在多个级别保护您的yourpostgresql数据库访问的最佳实践，从网络和触发安全性开始，并探索了如何使用PostgreSQL灵活的用户权限。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://goteleport.com/blog/securing-postgres-postgresql/">https://goteleport.com/blog/securing-postgres-postgresql/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/数据库/">#数据库</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/database/">#database</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1055768.html"><img src="http://img2.diglog.com/img/2021/4/thumb_083854c0b5de819f1605193abcaa12ad.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1055768.html">lexisnexis将个人信息的巨大数据库提供给冰 </a></div><span class="my_story_list_date">2021-4-3 0:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1055227.html"><img src="http://img2.diglog.com/img/2021/3/thumb_72e701b20106d205840f6f7ca649a1cc.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1055227.html">关于打开的刮擦数据库的注意事项 </a></div><span class="my_story_list_date">2021-3-30 14:46</span></div><div class="col-sm"><div><a target="_blank" href="/story/1055199.html"><img src="http://img2.diglog.com/img/2021/3/thumb_196e028a44975a51d816988253681cd6.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1055199.html">传送6.0：数据库访问简单 </a></div><span class="my_story_list_date">2021-3-30 7:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1054674.html"><img src="http://img2.diglog.com/img/2021/3/thumb_7fed01dc1a47bfea82901895897006fe.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1054674.html">使用DataLoaders将数据库查询缩短到最小值 </a></div><span class="my_story_list_date">2021-3-27 6:34</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>