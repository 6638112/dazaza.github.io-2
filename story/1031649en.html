<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>教程：使用GO进行内存中Git克隆、提交和推送</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">教程：使用GO进行内存中Git克隆、提交和推送</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-28 07:16:32</div><div class="page_narrow text-break page_content"><p>Today’s article is a tutorial on how set up and use the go-git library to clone and update a repository with an in-memory filesystem. This procedure is quite useful if you want to push against or clone a repository without touching the OS filesystem and deal with permissions or temporary files. Albeit, there’s documentation about git-go, I find it not really clear and sometimes misleading due to the different versions and names of the library. For this reason, I’ve decided to share this tutorial, and hopefully will be helpful to someone. For the purpose of this tutorial, we will do everything inside a main.go file, however you might want something more sofisticated for your use case :)</p><p>今天的文章是关于如何设置和使用Go-Git库来克隆和更新具有内存文件系统的存储库的教程。如果您希望推送或克隆存储库，而不接触操作系统文件系统并处理权限或临时文件，则此过程非常有用。尽管有关于Git-Go的文档，但我发现由于库的版本和名称不同，所以不是很清楚，有时还会产生误导。基于这个原因，我决定分享这篇教程，希望能对某些人有所帮助。出于本教程的目的，我们将在main.go文件中执行所有操作，但是您可能希望针对您的用例使用更柔和的文件：)。</p><p>  An https Git repository (Github, Bitbucket doesn’t really matter as long as it’s accessible via https.)</p><p>一个https Git存储库(Github、Bitbucket其实并不重要，只要它可以通过https访问即可。)。</p><p>  To set up the in-memory filesystem, we will use two packages storage and memfs.The storer will contain the objects, references and other metadata (normally what the directory  .git would do). The memfs filesystem will be our filesystem to read, create, remove any kind of file in our repository. First step, we need to create the two objects (the storer and the filesystem).</p><p>要设置内存中的文件系统，我们将使用两个包storage和memf。存储程序将包含对象、引用和其他元数据(通常与目录.git相同)。Memfs文件系统将成为我们的文件系统，用于读取、创建和删除存储库中的任何类型的文件。第一步，我们需要创建两个对象(存储器和文件系统)。</p><p> package mainimport ( &#34;fmt&#34; billy &#34;github.com/go-git/go-billy/v5&#34; memfs &#34;github.com/go-git/go-billy/v5/memfs&#34; git &#34;github.com/go-git/go-git/v5&#34; http &#34;github.com/go-git/go-git/v5/plumbing/transport/http&#34; memory &#34;github.com/go-git/go-git/v5/storage/memory&#34;)var storer *memory.Storagevar fs billy.Filesystemfunc main() { storer = memory.NewStorage() fs = memfs.New()...</p><p>软件包mainimport(&#34；fmt&#34；billy&#34；github.com/go-git/go-billy/v5&#34；memfs&#34；github.com/go-git/go-billy/v5/memfs&#34；git&#34；github.com/go-git/go-git/v5&#34；http&#34；github.com/go-git/go-git/v5/plumbing/transport/http&#34；Memory&#34；Github.com/go-git/go-git/v5/storage/memory&#34；)var存储器*Memory.Storagevar fs billy.Filesystemfunc Main(){STORLER=Memory.NewStorage()fs=memfs.New()...。</p><p>  Second step, in order to have our repository in the in-memory filesystem, we need to  clone it and create the  worktree object. The function  Clone() will also return the Repository interface that we will then use to  Push() to the remote. The method  Worktree() will return the Worktree object that we will need to  Add() &amp;  Commit() our changes. Finally, if our repository is private, we would need to set up the basic authentication to clone it (We need the basic authentication to push anyway so better to set up it here!).</p><p>第二步，为了将我们的存储库放在内存文件系统中，我们需要克隆它并创建工作树对象。函数Clone()还将返回Repository接口，然后我们将使用该接口将()推送到远程。方法Worktree()将返回我们需要添加()&amp；Commit()更改的Worktree对象。最后，如果我们的存储库是私有的，我们将需要设置基本身份验证来克隆它(无论如何我们都需要基本身份验证来推送，所以最好在这里设置它！)。</p><p> ... // Authentication auth := &amp;http.BasicAuth{ Username: &#34;your-git-user&#34;, Password: &#34;your-git-pass&#34;, } repository := &#34;https://github.com/your-org/your-repo&#34; r, err := git.Clone(storer, fs, &amp;git.CloneOptions{ URL: repository, Auth: auth, }) if err != nil { fmt.Printf(&#34;%v&#34;, err) return } fmt.Println(&#34;Repository cloned&#34;) w, err := r.Worktree() if err != nil { fmt.Printf(&#34;%v&#34;, err) return }</p><p>...//身份验证身份验证：=&amp；http.BasicAuth{用户名：&#34；您的-git-用户，密码：&#34；您的-git-pass&#34；，}存储库：=&#34；https://github.com/your-org/your-repo&#34；r，err：=git.Clone(存储器，文件，&amp；git.CloneOptions{url：存储库，身份验证：身份验证，})如果err！=空{fmt.Printf(&#34；%v&#34；，err)return}fmt.Println(&#34；存储库克隆&#34；)w，err：=r.Worktree()if err！=nil{fmt.Printf(&#34；%v&#34；，err)return}。</p><p>  Now, will we use the  fs object to create an actual file, add &amp; commit it to the Worktree().</p><p>现在，我们将使用fs对象创建一个实际的文件，并将其添加&amp；提交到Worktree()。</p><p>  For some reason (unknown to me), if the filename starts with ”/” it will create a folder and not a file. E.g.: /hello/world.txt (world.txt would be a directory) hello/world.txt (world.txt would be a file inside the folder hello)</p><p>由于某种原因(我不知道)，如果文件名以“/”开头，它将创建一个文件夹，而不是一个文件。例如：/hello/world.txt(world.txt将是一个目录)hello/world.txt(world.txt将是hello文件夹内的文件)</p><p> ... // Create new file filePath := &#34;my-new-ififif.txt&#34; newFile, err := fs.Create(filePath) if err != nil { return } newFile.Write([]byte(&#34;My new file&#34;)) newFile.Close() // Run git status before adding the file to the worktree fmt.Println(w.Status()) // git add $filePath w.Add(filePath) // Run git status after the file has been added adding to the worktree fmt.Println(w.Status()) // git commit -m $message w.Commit(&#34;Added my new file&#34;, &amp;git.CommitOptions{})</p><p>...//新建文件filePath：=&#34；my-new-ifiFi.txt&#34；newFile，err：=fs.Create(FilePath)if err！=nil{return}newFile.Write([]byte(&#34；my new file&#34；)newFile.Close()//在将文件添加到工作树fmt.Println(w.Status())//git add$filePath w.Add(FilePath)//在文件添加到工作树之后运行git状态fmt.Println(w.Status())//git Commit-m$message w.Commit(&#34；Added My New File&#34；，&amp；git.Committee Options{})。</p><p>  The Push() will be performed using the method of the Repository interface as shown below.</p><p>Push()将使用Repository接口的方法执行，如下所示。</p><p> ... //Push the code to the remote err = r.Push(&amp;git.PushOptions{ RemoteName: &#34;origin&#34;, Auth: auth, }) if err != nil { return } fmt.Println(&#34;Remote updated.&#34;, filePath) return}</p><p>...//如果err！=nil{return}fmt.Println(&#34；远程更新.&#34；，filePath)return}，则将代码推送到远程err=r.Push(&amp；git.PushOptions{RemoteName：&#34；Origin&#34；，Auth：Auth，})。</p><p>    go mod initgo buildgo run main.go Repository cloned ?? my-new-file.txt &lt;nil&gt; A my-new-file.txt &lt;nil&gt; Remote updated. my-new-file.txt</p><p>Go mod initgo buildgo run main.go Repository Clone？？My-new-file.txt&lt；nil&gt；A my-new-file.txt&lt；nil&gt；远程更新。My-new-file.txt。</p><p> I know this is quite a specific topic, but I hope this tutorial will help someone!</p><p>我知道这是一个相当具体的主题，但我希望这篇教程能对某些人有所帮助！</p><p>  Ciao! This is Ish(~) and here&#39;s my blog. A bunch of articles, posts and considerations mostly from projects I am currently following. I would love to read your opinions or answer the questions you might have, so please feel free to get in touch on   Twitter! :D</p><p>再见！这是ISH(~)，这是我的博客。一堆文章、帖子和考虑大多来自我目前正在关注的项目。我很乐意阅读您的意见或回答您可能有的问题，所以请随时在Twitter上联系！：d</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://ish-ar.io/tutorial-go-git/">https://ish-ar.io/tutorial-go-git/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/内存/">#内存</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/教程/">#教程</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/memory/">#memory</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/git/">#git</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1031631.html"><img src="http://img2.diglog.com/img/2020/10/thumb_444d759ef07609563082147df13a7e22.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031631.html">Linus Torvalds欢呼“历史性的”Linux5.10抛弃了废弃的地址artef</a></div><span class="my_story_list_date">2020-10-28 6:6</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030601.html"><img src="http://img2.diglog.com/img/2020/10/thumb_af62daf8ef2bb0719075fe04e35ad4e0.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030601.html">让我们用GPU构建一个高性能的模糊器</a></div><span class="my_story_list_date">2020-10-23 0:41</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029373.html"><img src="http://img2.diglog.com/img/2020/10/thumb_9854fc37c69b2457fc46b68960629e34.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029373.html">关于学校的按需寻呼，他们不会告诉你什么？™</a></div><span class="my_story_list_date">2020-10-17 10:6</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028949.html"><img src="http://img2.diglog.com/img/2020/10/thumb_88fa04aeeb654e035c0473fba57113e3.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028949.html">从内存中窃取未加密的SSH代理密钥(2014)</a></div><span class="my_story_list_date">2020-10-15 10:45</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>