<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我如何劫持主权国家的顶级域名 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">我如何劫持主权国家的顶级域名 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-15 22:03:45</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/1f08dd270132c844211f52c08e70f4a7.png"><img src="http://img2.diglog.com/img/2021/1/1f08dd270132c844211f52c08e70f4a7.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>注意：此问题已解决，.cd ccTLD不再将NS委托发送到受感染的域。</p><p> TL; DR：想象一下，如果一个主权国家的国家/地区代码顶级域（ccTLD）落入错误的人手中，将会发生什么情况。这是我（@Almroot）为NS代表团购买的用于刚果民主共和国（.cd）ccTLD的域名的方式，并临时接管了该TLD的所有DNS流量的50％，这些流量可能已被MITM或其他虐待。</p><p>   ‘在2020年圣诞节前的一周，我决定对全球所有TLD使用的所有NS记录进行分析。但是有一件事引起了我的注意。域名“ scpt-network.com”的EPP状态代码为“ redemptionPeriod”，这意味着某人未能及时更新其域名（支付发票？）。</p><p>  almroot @ x：〜$挖NS + trace cd | grep＆＃34; cd。＆＃34;光盘。 172800 IN NS ns-root-5.scpt-network.com。光盘。 172800 IN NS igubu.saix.net。光盘。 172800 IN NS sangoma.saix.net。光盘。 172800 IN NS ns-root-2.scpt-network.com。光盘。 172800 IN NS sabela.saix.net。光盘。 172800 IN NS ns-root-1.scpt-network.com。</p><p> 因此，我认为我也可以制作一个bash脚本来ping域的任何EPP状态更改。</p><p> 令我惊讶的是，大约一周左右后，我发现该域已达到“ pendingDelete”状态。</p><p> 我意识到了这一点的严重性。该域名很快将可供Internet上的任何人购买，这意味着掌握该域名的人还将获得.cd的NS功能。 </p><p>我修改了脚本，并开始仔细检查注册服务商是否有任何其他状态更改。</p><p> 12月30日晚上，我接到了Ping。我打开笔记本电脑并购买了域名，以防止它落入他人之手。</p><p>  由于剩下的三个指向SAIX（南非互联网交换）的代表团仍在工作，因此TLD在这段时间内一直可操作（尽管对任何域查询的性能都有轻微影响）。</p><p> 由于我拥有scpt-network.com，因此可以随意在区域下配置任何子域。如果我创建了一个新的子域（例如ns-root-1），并带有指向IP 1.3.3.7的A指针，则1.3.3.7将获得合法的传入DNS查询，该查询用于.cd。调用者将接受对这些查询的任何DNS响应。</p><p>  不回复将导致呼叫者超时，并且将假定状态码为SERVFAIL。这很好，因为SERVFAIL将强制调用方尝试访问该区域（.cd）的任何其他名称服务器（NS记录）。也就是说，呼叫者最终将击中合法的SAIX记录之一，并被适当地路由到正确的目的地。</p><p>  劫持一个主权国家的国家/地区代码顶级域名会带来严重的负面影响，特别是如果该域名属于网络犯罪分子或外国对手的手中。刚果民主共和国（DRC）不是一个小国。大约有9000万人，更不用说许多使用.cd网站运营的国际公司和组织。</p><p> 涉及整个国家/地区顶级域名（TLD）的DNS劫持很少，但并非闻所未闻。例如，前苏联（.su）的ccTLD在过去曾被网络犯罪分子劫持，而越南的Lenovo和Google网站（.vn）在2015年也成为DNS劫持的受害者。从合法的DNS流量重定向。从cd网站到钓鱼网站显然是一种潜在的滥用行为，但还有更多。 </p><p>使新域名“凭空” –想象一下如果利用这些功能实现快速Fluxing</p><p> 在本地网络上发起了远程代码执行（RCE）攻击-并针对使用WPAD查询公共DNS服务器的公司</p><p> 使用伪造的DNS响应来回复合法的DNS查询-并完全接管具有.cd网站的公司或机构的目标顶点域，甚至发起DDoS攻击。</p><p> 例如，我本可以制作一个完全劫持.cd下特定顶点域的漏洞利用程序。假设我总是向NS ns-root-1.scpt-network.com（而不是这四个：[ns1，ns2，n3，ns4] .google.com）回复，以回答对google.cd的任何NS请求。现在，调用者将看到此消息，然后对我控制的ns-root-1.scpt-network.com进行任何后续DNS请求。</p><p> 这也让我开始思考，如果我回复所有NS查询并返回自己的引用该怎么办。然后，对于以1.3.3.7答复的任何A问题，任何顶点或子域的所有域查找最终都会命中我操纵的A指针。然后将所有后续网络流量重定向到1.3.3.7并引发DDoS攻击。</p><p> 实际上，这也将影响整个TLD的可用性。 50％的DNS流量将出现故障，并且可以通过在DNS答复中设置较高的TTL来放大（两种）DoS攻击的影响。</p><p> 进一步说，我要明确地定位为google.cd服务的TXT记录。然后，我将能够滥用“让我们加密DNS-01”挑战，为google.cd颁发有效证书，并有效地破坏SSL / TLS通信。 </p><p>由于我可以控制任何.cd顶点域的NS委派并获得有效的证书，因此即使目标强制实施SSL / TLS，我也能够执行MITM攻击。</p><p> 尽管Google针对此类滥用行为采取了各种对策和缓解措施，但可以肯定地说，.cd下的所有apex域名都并非如此。可以在BR 1.7.3中找到有关CA如何验证域名所有权的更多信息。</p><p> 最后但并非最不重要的一点是，通过对具有DNS控制的上游主机的特权访问，我什至可以渗透到公司的本地网络（如下面的屏幕快照中所示），该公司通过监视查询，欺骗回复和重定向本地来为WPAD发送DNS查找网络调用方可以通过Internet下载并执行基于JS的恶意代理配置。 WPAD协议存在许多问题，包括Google Project Zero讨论的RCE漏洞。</p><p>   1月7日，我联系了IANA网页上列出的.cd的行政和技术联系人。我最初的想法是将域名的所有权转移回运营.cd的实体。</p><p> 尽管其中一位联系人进行了回复并委托给他们的同事，但在撰写本文时，我还没有收到有关他们已解决此问题的任何后续确认。尽管如此，由于我之前为.cd控制的DNS流量已被重定向到scpt-network .net，因此在与他们联系后不久，该问题似乎已得到解决。</p><p> 我还于1月8日向HackerOne上的Internet Bug Bounty提交了一份报告，很期待看到他们的回应。</p><p>  ccTLD的DNS劫持的潜在影响是广泛的，并且具有极端的负面影响，尤其是在攻击者的意图不当的情况下。此漏洞不仅影响单个网站，子域，甚至单个顶点域。所有.cd网站，包括大型国际公司，金融机构和在非洲第二人口大国拥有.cd域的其他组织的网站，都可能成为网络钓鱼，MITM或DDoS等滥用行为的受害者。 </p><p>在撰写本文时，尽管ccTLD .cd的NS代表团似乎在2021年1月8日左右在我1月7日与ccTLD联系人联系后就停止了访问，但我仍然拥有scpt-network.com的域名。 我这样做是为了防止恶意行为者在狭窄的时间范围内劫持刚果民主共和国的ccTLD，而管理.cd TLD的名称服务器之一的域名可能已被任何人接管。 幸运的是，在这种情况下，似乎没有损坏。  有兴趣与我加入Detectify Crowdsource道德黑客社区吗？ 应对我们的挑战，并在https://cs.detectify.com/apply上了解您是否有所需。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://labs.detectify.com/2021/01/15/how-i-hijacked-the-top-level-domain-of-a-sovereign-state/">https://labs.detectify.com/2021/01/15/how-i-hijacked-the-top-level-domain-of-a-sovereign-state/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/域名/">#域名</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/主权国家/">#主权国家</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/top/">#top</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1044237.html"><img src="http://img2.diglog.com/img/2021/1/thumb_bb800dde528f701b61ccb0af675eeb54.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044237.html">安全研究人员征服了一个国家/地区已过期的顶级域，以防止黑客入侵 </a></div><span class="my_story_list_date">2021-1-15 20:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1043421.html"><img src="http://img2.diglog.com/img/2021/1/thumb_f1ea61e10dc2eab5f252102cfa6c54ce.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1043421.html">随着英国退欧的进展，由50,000名英国公民注册的81K .eu域名被暂停，并给予了三个月的时间来转移域名或表明欧盟公民身份 </a></div><span class="my_story_list_date">2021-1-6 21:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1040784.html"><img src="http://img2.diglog.com/img/2020/12/thumb_51e4cb757a2db2d8c5539e17ef938847.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1040784.html">不要买他妈的域名 </a></div><span class="my_story_list_date">2020-12-20 3:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038396.html"><img src="http://img2.diglog.com/img/2020/12/thumb_9c2be276c4bd5f83104d5ca2679b8634.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038396.html">我的百万美元域名爱好 </a></div><span class="my_story_list_date">2020-12-8 17:39</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>