<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用Go从头开始播放音频：弗雷尔·雅克(Frère Jacques)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">用Go从头开始播放音频：弗雷尔·雅克(Frère Jacques)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-17 03:41:53</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/0497d644aa18c8c917f30a7602184b66.png"><img src="http://img2.diglog.com/img/2020/9/0497d644aa18c8c917f30a7602184b66.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在上一篇文章中，我最后说我们将能够使用GoAudio来生成一些简单的曲目，在这篇文章中，我们将对此进行测试。点击视频收听最终结果：)。</p><p>约翰/弗雷尔·雅克兄弟(Brother John/Frère Jacques)是一首流行的护理韵律，也是我小时候想要弹的为数不多的几首钢琴曲子之一。因此，我认为这次尝试编写这首歌是合适的。演奏这首歌的注释取自true-piano-essons.com。代码采用从C键开始的注释。(也许既然它在围棋中，我应该从G开始。请随意更改它)。</p><p>在之前的帖子中，我们实际上忽略了将音符转换为频率的问题。GoAudio以给定的频率工作。因此，我们需要首先实现一种将音符转换为频率的方法。为此，我想出了一个有点疯狂的解决方案，但除了硬编码之外，我不知道还有什么更好的方法。</p><p>当我们使用等调音阶制作音乐时，我们可以计算每个音符的频率，给定一个参考频率。我使用中间C作为参考频率，可以这样从音乐会A(A440)导出：MidleC=(Concerta*math.Pow(2，3/12))/2。</p><p>为了了解我们是如何得出每个音符的频率的，我建议大家看看维基百科。然而，基本的想法是，我们在一个八度中有12个半音，所以对于每个八度，我们必须根据参考频率产生12个半音。然而，令人困惑的是，一个八度从C开始，而不是从A开始(它确实循环)，所以我们得到：C，D，E，F，G，B。每次我们循环回到C，我们就上升一个八度(意味着更高的频率，因此更高的音高)。</p><p>您可以在此处查看从C0(倍频程为0的C)到B8(倍频程为8的B)的所有频率表。</p><p>这方面的代码有点老套，所以如果你有更好的方法，请让我知道！：-)。</p><p>Var(NOTES=[]string{&#34；C&#34；，&#34；C#&#34；，&#34；D&#34；，&#34；D#&#34；，&#34；E&#34；，&#34；F&#34；，&#34；G&#34；，&#34；G#&#34；，&#34；A&#34；，&#34；A#&#34；，&#34；B&#34；})//GenerateNotes基于参考频率FR创建&lt；音符、频率&&gt;映射。//参考频率设置为440函数GenerateNotes()map[string]float64{ni：=0 Concerta：=440。中C：=(协奏曲*数学。POW(2，3./12.))/2.对于i：=0；i&lt；24；i++{fk：=FR*MATH，fr：=midleC notemap：=map[String]float64{}。战俘(2，Float64(I)/12.)注意：=NOTES[ni%len(NOTES)]八度：=4+i/12var octs字符串，如果八度！=0{octs=strconv.。Itoa(八度)}notemmap[注+octs]=fk ni++}notemap[&#34；wait&#34；]=0。返回notemap}</p><p>在这里，我从C4-&gt；B5产生第四和第五个八度。如果我们打印由该代码生成的地图，我们会得到(缩写)。</p><p>还要注意，我在其中添加了频率为0的等待。这有点老生常谈(在围棋中也是不必要的)。我添加了这个，这样我们可以在播放歌曲的不同部分之间有更多的等待时间。因为浮点数的缺省零值是零，并且因为您可以在缺少Akey的情况下安全地访问地图，所以这是没有必要的。我们可以只用等待键调用地图，即使它没有插入，我们的结果仍然是正确的。</p><p>如果你正在读这篇文章，你很有可能知道这一点。但我想强调一下，因为我认为这是围棋的一个相当酷的功能！然而，在这种情况下，我选择了明确说明等待通知的意图。</p><p>好的，我们有我们的音符和与之相关的频率。我们实际上还需要产生一个波。为此，我引入了方便的函数“play”，它接受几个参数并返回一个帧：</p><p>这与过去有关ADSR的内容非常相似，就像在那篇文章中一样，我们也会在这里将ADSR信封应用于信号。请注意，“Play”需要一个LookupOscillator，在上一篇文章中，我们构建了几个LookupOscillator，用于生成正弦波、三角形、正方形等。</p><p>这个函数告诉我们，用给定的振荡器播放音符一定的持续时间(以秒为单位)，然后返回一段帧。此功能允许我快速更改波形类型，并处理针对不同时间跨度演奏不同音符的结果。</p><p>Func Play(l*synth.。LookupOscillator，Note String，Duration float64，notefreqs map[String]float64)[]wave。FRAME{freq：=notefreqs[NOTE]FRAMES：=生成([]WAVE。Frame，int(持续时间*sr))变量adsrtime int for i：=范围帧{value：=synth.。ADSR(0.8，持续时间，0.2，0.1，0.5，持续时间-0.05，sr，adsrtime)adsrtime++帧[i]=波形。Frame(value*l.InterpolateTick(Freq))}返回帧}。</p><p>让ADSR信封听起来像我想要的那样，老实说，这是一种古老的反复试验的方式。😅.</p><p>我们终于把一切都准备好了，可以谱写这首歌了。下面的代码肯定不漂亮，但是它完成了工作！首先我们生成音符，然后我们创建一个我们想要的形状的波形表。我们将其插入振荡器，然后开始使用所需的音符调用Play函数。</p><p>为方便起见，我添加了一些变量来方便地调整歌曲各部分的时长。变量，耶！</p><p>Func main(){nm：=GenerateNotes()st，err：=synth。NewTriangleTable(8*1024，11)如果err！=nil{Panic(Err)}OSC，则err：=synth。新查找振荡器(sr，st，0)if err！=nil{Panic(Err)}waitdur：=.1cdecdur：=0.6cagfecdur：=0.5cgcdur：=0.5cgcdur：=0.5//备注：https://www.true-piano-lessons.com/frere-jacques.html输出：=[]波。FRAME{}//Frere Jacues输出=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；d5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；E5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；C5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；d5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；E5&#34；，cdecdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；C5&#34；，cdecdur，nm)...)Output=append(output，play(osc，&#34；wait&#34；，waitdur，nm)...)//dormez-vous output=append(output，play(osc，&#34；E5&#34；，efgdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；F5&#34；，efgdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；G5&#34；，efgdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；WAIT&#34；，0.2，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；E5&#34；，efgdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；F5&#34；，efgdur，nm)...)Output=append(output，play(osc，&#34；G5&#34；，efgdur，nm)...)//sonnez les Matines output=append(output，play(osc，&#34；G5&#34；，gagfedur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；A5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；G5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；F5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；E5&#34；，gagfedur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；WAIT&#34；，0.2，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；G5&#34；，gagfedur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；A5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；G5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；F5&#34；，gagect dur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；E5&#34；，gagfedur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，gagect dur，nm)...)Output=append(output，play(osc，&#34；wait&#34；，gagfecdur，nm)...)//dindindon output=append(output，play(osc，&#34；C5&#34；，cgcdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；G5&#34；，cgcdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，cgcdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(OSC，&#34；WAIT&#34；，0.1，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，cgcdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；G5&#34；，cgcdur，nm)...)OUTPUT=APPEND(OUTPUT，PLAY(osc，&#34；C5&#34；，cgcdur，nm)...)WFMT：=波浪。NewWaveFmt(1，1，Sr，16，Nil)波。WriteFrames(output，wfmt，&#34；frereJacq.wav&#34；)}。</p><p>如果你喜欢这篇文章，并想知道我什么时候写了新帖子，最好的更新方式就是在Twitter上关注我。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://dylanmeeus.github.io/posts/audio-from-scratch-pt12/">https://dylanmeeus.github.io/posts/audio-from-scratch-pt12/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/播放/">#播放</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/scratch/">#scratch</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/频率/">#频率</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>