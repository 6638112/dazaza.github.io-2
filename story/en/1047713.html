<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>从一本27岁的Unix书中学到的教训 Lessons learned from a 27 years old Unix book</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Lessons learned from a 27 years old Unix book<br/>从一本27岁的Unix书中学到的教训 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-02-17 18:07:39</div><div class="page_narrow text-break page_content"><p>One of the Amazon reviewers of &#34;Sun Performance and Tuning: Java and theInternet&#34; gave it 3/5 stars. While still a nice introduction, the book byAdrian Cockcroft has become dated — claimed Roland in 2003, which believe itor not was 18 years ago. The book Roland reviewed was published in 1998, and itis a second edition. The first edition (1994) has a significantly differenttitle: &#34; Sparc &amp; Solaris&#34;,is the focus instead of &#34;Java and the Internet&#34;. Other than reflecting a majorshift in Sun’s focus happened between &#39;94, and &#39;98, the two editions also havea different price tag. &#34;Java and the Internet&#34; costs 15.97 EUR, while one canget &#34;Sparc &amp; Solaris&#34; used in allegedly  Very Good conditions for 1.94. IfI’m buying an outdated book I’m gonna get the most outdated version possible, Ifigured, plus imagine the embarrassment if someone would find a book about Javain my bookshelf. Shipping is 3 bucks, for a grand total of 4.94 EUR the book isin my hands 15 days after placing the order.</p><p>Amazon的＆＃34; Sun性能和调整：Java和Internet＆＃34;的评论者之一。给它3/5星。虽然仍然是不错的介绍，但阿德里安·考克克罗夫特（Adrian Cockcroft）所著的书已过时-罗兰（Roland）在2003年宣称，相信这不是18年前。罗兰评论的书于1998年出版，第二版。第一版（1994）具有明显不同的标题：＆＃34; Sparc＆amp; Solaris是代替Java和Internet的焦点。这两个版本除了反映出Sun的关注重点发生了重大变化外，分别在94和98之间，它们的价格也有所不同。 ＆＃34; Java和Internet＆＃34;费用为15.97欧元，而一个可享“ Sparc＆amp; Solaris＆＃34;在据说很好的条件下使用1.94。如果我要购买一本过时的书，那么我将获得尽可能多的过时的书，如果被igigured，再想想如果有人在我的书架上找到一本有关Java的书，那会很尴尬。运费为3块钱，总计4.94 EUR，下订单后15天就在我手中。</p><p>  &#34;The Porsche Book&#34; is quick to explain the analogy between UNIX and the Porsche911 featured on the cover: both were created in the &#39;60s, in a form similar tothe current one. Both represent the latest and greatest of products still aroundin 1994, and indeed 2021, despite their quirks.</p><p>  ＆＃34;保时捷书＆＃34;我很快就解释了UNIX和封面上的保时捷911之间的类比：两者都是在60年代创建的，形式类似于当前版本。尽管它们有古怪之处，但它们都代表了1994年甚至2021年左右仍在生产的最新和最伟大的产品。</p><p> A valid question at this point clearly is: why do you care about a bookpublished 30 years ago when there’s so much recent and surely more usefulmaterial? One reason is that I find the history of Sun Microsystemsparticularly interesting. I’ve read and very much enjoyed High Noon as well as Sunburst — dealing withrecent history there’s the privilege of having plenty of primary sourcesreadily available, which is great. When it comes to the Porsche book, I find itfascinating to read about the most common usage scenarios of Sun servers in the&#39;90s, and I can’t help but feel sorry for the admin who didn’t know that forSunOS 4, only filenames up to 14 characters long are cached in the DirectoryName Lookup Cache (DNLC). In this article, however, I want to focus on theinformation contained in the book which is still valid today. In a world thatmoves as quickly as the world of computing, you could argue that all books areoutdated to begin with. If some of the information in &#34;Sun Performance andTuning&#34; was valid in 1994 and is still valid in 2021, there’s a good chancethat it will still be valid 30 years from now.</p><p> 在这一点上，一个有效的问题显然是：为什么您关心30年前出版的一本书，而最近出版的书又如此之多，而且肯定更有用？原因之一是我发现Sun Microsystem的历史特别有趣。我已经阅读并非常喜欢正午和森伯斯特（Sunburst）的交易-回顾最近的历史，很荣幸有很多现成的主要资源可供使用，这很棒。在谈到保时捷书时，我发现阅读90年代最常见的Sun服务器使用场景非常着迷，对于不知道forSunOS 4的管理员，我不禁感到抱歉。 DirectoryName查找缓存（DNLC）中仅缓存最长14个字符的文件名。但是，在本文中，我想重点介绍本书中包含的信息，该信息至今仍然有效。在一个与计算机世界一样快的世界中，您可能会说所有书籍都是过时的。如果“ Sun Performance andTuning”中的某些信息；有效期是1994年，有效期是2021年，很有可能从现在起30年内仍然有效。</p><p> It seems to me that we can categorize tech knowledge as follows: theoreticalknowledge, generic practical information, and implementation details. Of thethree, theoretical knowledge is the most likely to stay relevant with time,followed by generic practical information which might still apply some yearslater, and finally implementation details which are very likely to becomeirrelevant as time goes by. Those details are far from being useless however:in fact they provide the distinction between novice and experiencedpractitioner. To give an example: the chapter about Networks opens with adescription of the built-in  le network interface, pointing out that it sharedits DMA connection with the SCSI interface. Crucially, the network interface hadhigher priority: heavy network activity was likely to reduce disk throughput. In1994 you would have needed to see multiple workstations with bad diskperformance before concluding that network traffic had anything to do with it — or read the book.</p><p> 在我看来，我们可以将技术知识分类如下：理论知识，通用实践信息和实施细节。在这三种方法中，理论知识最有可能与时间保持联系，其次是通用实践信息，这些信息可能仍会应用数年，最后是实施细节，随着时间的流逝，它们很可能变得无关紧要。但是，这些细节并非毫无用处：实际上，它们区分了新手和经验丰富的从业者。举个例子：关于网络的章节以内置的网络接口的说明开始，指出它与SCSI接口共享DMA连接。至关重要的是，网络接口具有更高的优先级：繁重的网络活动可能会降低磁盘吞吐量。在1994年，您可能需要先查看多个磁盘性能差的工作站，然后才能得出结论，网络流量与它有任何关系-或阅读本书。</p><p>  When performing a set of tests, there are multiple settings and knobs one canwork with, each having various options to choose from. Which filesystem are weusing? What’s the version of the application we’re testing? Kernel buffersize?</p><p>  当执行一组测试时，可以使用多个设置和旋钮，每个都有不同的选项可供选择。我们正在使用哪个文件系统？我们正在测试的应用程序是什么版本？内核缓冲区大小？</p><p>  To measure every combination of 6 different factors with 4 levels each wouldtake 4^6 = 4096 measurements, which clearly is madness. By reducing the levelswe consider to 2, still evaluating all 6 different factors in all possiblecombination, we get down to 2^6 = 64 measurements instead.</p><p>  要测量6种不同因素的每种组合（每4个级别）将进行4 ^ 6 = 4096次测量，这显然是疯狂的。通过将我们考虑的级别减少到2，仍然在所有可能的组合中评估所有6个不同的因素，我们得出的结果是2 ^ 6 = 64个测量值。</p><p> Throughput — the amount of work performed in a given amount of time — was athing in the &#39;60s, it’s the same thing today, and it will still be  work/timein 2050. Your web server might have a maximum throughput of 10000 requests persecond (rps), that’s something you can use to compare it with another one. Response time (latency) is defined as the amount of time the user has towait. For example, how long did a given database transaction take. Utilization is how much of the computer’s resources were used to do the work.The values reported by  sar and  iostat, two tools very much still in usetoday, are an example of Utilization measures.</p><p> 吞吐量-在给定的时间内完成的工作量-大约是60年代，今天还是一样，到2050年仍将是工作/时间。您的Web服务器的最大吞吐量可能为10000每秒请求数（rps），您可以将其与另一个请求进行比较。响应时间（等待时间）定义为用户必须等待的时间。例如，给定的数据库事务花费了多长时间。利用率是指计算机使用了多少资源来完成这项工作。sar和iostat报告的值（这两种工具至今仍在使用）是利用率度量的一个示例。 </p><p> The author suggests taking multiple  sar Utilization measurements at variousload levels and combine them with  awk to get an overview of how the systembehaves. We do have  Prometheus, Grafana, and friends nowadays, but the  sar | awk ideais a useful reminder that quick, simple measurements can go a long way too!</p><p>作者建议在各种负载水平下进行多次sar利用率测量，并将其与awk结合使用，以大致了解系统的运行方式。如今，我们确实有Prometheus，Grafana和朋友，但是sar | awk idea提醒您快速，简单的测量也可以大有帮助！</p><p> vmstat and  sar are described in detail, with a focus on runnable queue,blocked queue, swap usage, and so forth. The Linux versions of  vmstat and sar from  procps and sysstat are a bit different thanthe Solaris ones, but the main ideas still apply.</p><p> 详细介绍了vmstat和sar，重点关注可运行队列，阻塞队列，交换使用情况等。 procps和sysstat的vmstat和sar的Linux版本与Solaris有所不同，但是主要思想仍然适用。</p><p> The three commands are also used in the  Rules and Tunables Quick ReferenceTables section. For each subsystem (Disk, Network, Memory, CPU), the authorspecified a list of Rules involving the commands and the action to take if therule applies. Rules consist in the name of the command with any options, then a&#34;.&#34; followed by the name of the variable to take into account. For example, thefollowing indicates a disk bottleneck:  35% &lt; iostat-D30.util &lt; 65%. Theaction to take is to try balance the I/O load on other disks too, or get moredisks.</p><p> 在“规则和可调参数快速参考表”部分中也使用了这三个命令。对于每个子系统（磁盘，网络，内存，CPU），作者指定了一个规则列表，其中涉及命令和规则适用时要采取的措施。规则由带有任何选项的命令名称组成，然后为a＆＃34;。后跟要考虑的变量名称。例如，以下指示磁盘瓶颈：35％ iostat-D30.util＆lt; 65％。采取的措施是尝试也平衡其他磁盘上的I / O负载，或获得更多磁盘。</p><p> Interrupts in Solaris 2.2 were load-balanced among all available CPUs. Thedrawback was that, in case of heavy interrupt load from a given device, cachehit rate would suffer: the OS allowed to statically assign IRQs to CPUs as animprovement instead.</p><p> Solaris 2.2中的中断在所有可用CPU之间进行了负载均衡。缺点是，如果给定设备的中断负载很重，则缓存命中率将受到影响：操作系统允许将IRQ静态分配给CPU作为改进。</p><p> Nowadays a very similar problem occurs with the  irqbalance daemon on Linux,which on systems doing lots of network activity should not be used. SMPaffinity should instead be configured to ensure the interrupts of multiqueuenetwork cards are statically mapped among CPUs.</p><p> 如今，Linux上的irqbalance守护程序发生了非常类似的问题，该守护程序不应在进行大量网络活动的系统上使用。相反，应该配置SMPaffinity以确保多队列网卡的中断在CPU之间静态映射。</p><p> There’s more information in &#34;Sun Performance and Tuning&#34; that can still providevaluable lessons today, as well as some true historical gems for those intosuch things. Go  check itout on the Internet Archive if you’re interested!</p><p> ＆＃34; Sun Performance and Tuning＆＃34;中有更多信息。到今天仍然可以提供宝贵的经验教训，以及那些东西真正的历史瑰宝。如果您有兴趣，请在Internet存档上查看！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.linux.it/~ema/posts/porsche-book/">https://www.linux.it/~ema/posts/porsche-book/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/中学/">#中学</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/unix/">#unix</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>