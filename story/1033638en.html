<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>皮姆卡诺：泰亚诺已死，泰亚诺万岁</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">皮姆卡诺：泰亚诺已死，泰亚诺万岁</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-07 11:21:18</div><div class="page_narrow text-break page_content"><p>In this post we’d like to make a major announcement about where PyMC is headed, how we got here, and what our reasons for this direction are.</p><p>在这篇文章中，我们想要宣布一个重要的消息，关于PyMC的发展方向，我们是如何做到这一点的，以及我们选择这个方向的原因是什么。</p><p> TL;DR: PyMC3 on Theano with the new JAX backend is the future, PyMC4 based on TensorFlow Probability will not be developed further.</p><p>TL；DR：基于Theano的PyMC3和新的JAX后端是未来的趋势，基于TensorFlow概率的PyMC4将不会进一步开发。</p><p> In 2017, the original authors of Theano annou nced that they would stop development of their excellent library. This left PyMC3, which relies on Theano as its computational backend, in a difficult position and prompted us to start work on PyMC4 which is based on TensorFlow instead. Through this process, we learned that building an interactive probabilistic programming library in TF was not as easy as we thought (more on that below).</p><p>2017年，Theano的原著作者表示，他们将停止开发他们的优秀图书馆。这让依赖Theano作为其计算后端的PyMC3陷入了困境，并促使我们开始开发基于TensorFlow的PyMC4。通过这个过程，我们了解到在TF中构建交互式概率编程库并不像我们想象的那么容易(下面将详细介绍)。</p><p> In parallel to this, in an effort to extend the life of PyMC3, we took over maintenance of Theano from the Mila team, hosted under  Theano-PyMC. Working with the Theano code base, we realized that everything we needed was already present. Moreover, we saw that we could extend the code base in promising ways, such as by adding support for new execution backends like JAX.</p><p>与此同时，为了延长PyMC3的使用寿命，我们从由Theano-PyMC主持的Mila团队手中接管了Theano的维护工作。使用Theano代码库，我们意识到我们需要的一切都已经存在。此外，我们看到我们可以通过一些有前途的方式扩展代码库，例如通过添加对新的执行后端(如JAX)的支持。</p><p> Here is the idea: Theano builds up a static computational graph of operations (“Ops”) to perform in sequence. This graph structure is very useful for many reasons: you can do optimizations by fusing computations or replace certain operations with alternatives that are numerically more stable. Critically, you can then take that graph and compile it to different execution backends. By default, Theano supports two execution backends (i.e. implementations for Ops): Python and C.</p><p>这个想法是这样的：Theano构建了一个静态的运算图(“Ops”)，以便按顺序执行。这种图表结构非常有用，原因有很多：您可以通过融合计算来进行优化，或者用数值上更稳定的替代方案替换某些操作。最重要的是，您可以获取该图并将其编译到不同的执行后端。默认情况下，Theano支持两个执行后端(即Ops的实现)：Python和C。</p><p> The Python backend is understandably slow as it just runs your graph using mostly NumPy functions chained together. Thus for speed, Theano relies on its C backend (mostly implemented in CPython). After graph transformation and simplification, the resulting Ops get compiled into their appropriate C analogues and then the resulting C-source files are compiled to a shared library, which is then called by Python.</p><p>可以理解，Python后端速度很慢，因为它主要使用链接在一起的NumPy函数来运行您的图形。因此，就速度而言，Theano依赖于它的C后端(主要是用CPython实现的)。经过图形转换和简化后，生成的操作被编译成它们相应的C类似物，然后生成的C源代码文件被编译到一个共享库中，然后由Python调用该共享库。</p><p> While this is quite fast, maintaining this C-backend is quite a burden. More importantly, however, it cuts Theano off from all the amazing developments in compiler technology (e.g. XLA) and processor architecture (e.g. TPUs) as we would have to hand-write C-code for those too.</p><p>虽然这是相当快的，但维护这个C后端是一个相当大的负担。然而，更重要的是，它切断了Theano在编译技术(例如XLA)和处理器体系结构(例如TPU)方面的所有令人惊叹的发展，因为我们也必须为这些技术手写C代码。</p><p> The solution to this problem turned out to be relatively straightforward: compile the Theano graph to other modern tensor computation libraries. We just need to provide JAX implementations for each Theano Ops. Since JAX shares almost an identical API with NumPy/SciPy this turned out to be surprisingly simple, and we had a working prototype within a few days.</p><p>这个问题的解决方案被证明是相对简单的：将Theano图编译成其他现代张量计算库。我们只需要为每个Theano Ops提供JAX实现。由于JAX与NumPy/SciPy共享几乎完全相同的API，这被证明是出人意料的简单，我们在几天内就有了一个可以工作的原型。</p><p> Currently, most PyMC3 models already work with the current master branch of Theano-PyMC using our NUTS and SMC samplers. In our limited experiments on small models, the C-backend is still a bit faster than the JAX one, but we anticipate further improvements in performance. To take full advantage of JAX, we need to convert the sampling functions into JAX-jittable functions as well.</p><p>目前，大多数PyMC3型号已经使用我们的坚果采样器和SMC采样器与Theano-PyMC当前的主分支机构配合使用。在我们对小型模型的有限实验中，C后端仍然比JAX后端快一点，但我们预计性能会有进一步的提高。为了充分利用JAX，我们还需要将采样函数转换为JAX-jittable函数。</p><p>  This is where things become really interesting. We first compile a PyMC3 model to JAX using the new JAX linker in Theano. We can then take the resulting JAX-graph (at this point there is no more Theano or PyMC3 specific code present, just a JAX function that computes a logp of a model) and pass it to existing JAX implementations of other MCMC samplers found in TFP and NumPyro.</p><p>这就是事情变得真正有趣的地方。我们首先使用Theano中新的JAX链接器将一个PyMC3模型编译成JAX。然后，我们可以获取生成的JAX图(此时不再存在特定于Theano或PyMC3的代码，只有一个计算模型对数的JAX函数)，并将其传递给TFP和NumPyro中的其他MCMC采样器的现有JAX实现。</p><p> The result:   the sampler and model are together fully compiled into a unified JAX graph that can be executed on CPU, GPU, or TPU. The speed in these first experiments is incredible and totally blows our Python-based samplers out of the water.</p><p>结果是：采样器和模型一起被完全编译成一个统一的JAX图，可以在CPU、GPU或TPU上执行。这些第一次实验的速度令人难以置信，完全让我们的基于Python的采样器大吃一惊。</p><p>  With the ability to compile Theano graphs to JAX and the availability of JAX-based MCMC samplers, we are at the cusp of a major transformation of PyMC3. Without any changes to the PyMC3 code base, we can switch our backend to JAX and use external JAX-based samplers for lightning-fast sampling of small-to-huge models.</p><p>有了将Theano图编译成JAX的能力，以及基于JAX的MCMC采样器的可用性，我们正处于对PyMC3的重大转变的风口浪尖。在不对PyMC3代码库进行任何更改的情况下，我们可以将后端切换到JAX，并使用基于JAX的外部采样器对从小到大的模型进行闪电般的采样。</p><p> The coolest part is that you, as a user, won’t have to change anything on your existing PyMC3 model code in order to run your models on a modern backend, modern hardware, and JAX-ified samplers, and get amazing speed-ups for free.</p><p>最酷的部分是，作为用户，您不需要更改现有的PyMC3模型代码，就可以在现代后端、现代硬件和JAX采样器上运行模型，并免费获得惊人的加速。</p><p> In addition, with PyTorch and TF being focused on dynamic graphs, there is currently no other good static graph library in Python. Static graphs, however, have many advantages over dynamic graphs. We thus believe that Theano will have a bright future ahead of itself as a mature, powerful library with an accessible graph representation that can be modified in all kinds of interesting ways and executed on various modern backends.</p><p>此外，随着PyTorch和TF专注于动态图形，目前在Python中还没有其他好的静态图形库。然而，与动态图形相比，静态图形有很多优点。因此，我们相信Theano将会有一个光明的未来，作为一个成熟的、强大的库，它具有可访问的图形表示，可以通过各种有趣的方式进行修改，并在各种现代后端上执行。</p><p>  PyMC4, which is based on TensorFlow, will not be developed further. It was a very interesting and worthwhile experiment that let us learn a lot, but the main obstacle was TensorFlow’s eager mode, along with a variety of technical issues that we could not resolve ourselves. In probabilistic programming, having a static graph of the global state which you can compile and modify is a great strength, as we explained above; Theano is the perfect library for this.</p><p>基于TensorFlow的PyMC4将不会进一步开发。这是一个非常有趣和值得的实验，让我们学到了很多，但主要的障碍是TensorFlow的渴望模式，以及各种我们自己无法解决的技术问题。在概率编程中，拥有一个可以编译和修改的全局状态静态图是一个很大的优势，正如我们在上面所解释的；Theano就是这方面的完美库。</p><p> We would like to express our gratitude to users and developers during our exploration of PyMC4. Especially to all GSoC students who contributed features and bug fixes to the libraries, and explored what could be done in a functional modeling approach. We also would like to thank Rif A. Saurous and the Tensorflow Probability Team, who sponsored us two developer summits, with many fruitful discussions. We believe that these efforts will not be lost and it provides us insight to building a better PPL. We are looking forward to incorporating these ideas into future versions of PyMC3.</p><p>在探索PyMC4的过程中，我们要对用户和开发人员表示感谢。特别是对所有GSOC的学生，他们为这些库贡献了特性和错误修复，并探索了在功能建模方法中可以做些什么。我们也要感谢Rif A.Sauous和TensorFlow Probability团队，他们赞助了我们两次开发者峰会，并进行了许多富有成效的讨论。我们相信，这些努力不会白费，这为我们建设更好的PPL提供了启示。我们期待着将这些想法融入到未来版本的PyMC3中。</p><p>  This is a really exciting time for PyMC3 and Theano. If you want to have an impact, this is the perfect time to get involved. You can check out the low-hanging fruit on the Theano and PyMC3 repos. We look forward to your pull requests.</p><p>对于PyMC3和Theano来说，这真的是一个激动人心的时刻。如果你想产生影响，现在是参与进来的最佳时机。你可以在Theano和PyMC3上查看容易摘到的水果。我们期待着您的拉式请求。</p><p> If you are looking for professional help with Bayesian modeling, we recently launched a PyMC3 consultancy, get in touch at  thomas.wiecki@pymc-labs.io.</p><p>如果您正在寻找贝叶斯建模方面的专业帮助，我们最近推出了一项PyMC3咨询服务，请联系thomas.wiecki@pymc-labs.io。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://pymc-devs.medium.com/the-future-of-pymc3-or-theano-is-dead-long-live-theano-d8005f8a0e9b">https://pymc-devs.medium.com/the-future-of-pymc3-or-theano-is-dead-long-live-theano-d8005f8a0e9b</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/theano/">#theano</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>