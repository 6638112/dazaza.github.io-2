<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reddit用户通过反编译修复了Cyberpunk 2077 Steam控制器输入错误 Reddit user fixes Cyberpunk 2077 steam controller input bug through decompiling</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Reddit user fixes Cyberpunk 2077 steam controller input bug through decompiling<br/>Reddit用户通过反编译修复了Cyberpunk 2077 Steam控制器输入错误 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-13 03:11:56</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/791452ca31139d0845c5b11ef9b3b46a.png"><img src="http://img2.diglog.com/img/2020/12/791452ca31139d0845c5b11ef9b3b46a.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>I started by googling for methods in which some games like Valorant block virtual input and saw a lot of posts saying you can use the windows api function SetWindowsHookEx with WH_KEYBOARD_LL in order to check for the LLKHF_INJECTED flag that determines if the input was fake. I used the x64dbg debugger on the game to breakpoint on SetWindowsHookEx and checked if WH_KEYBOARD_LL was being used and it wasn&#39;t so this was a dead end. This was day 1 and I gave up assuming someone else would come up with a fix.</p><p>我从谷歌搜索方法开始，其中一些游戏（如Valorant）会阻止虚拟输入，并看到很多帖子说您可以将Windows api函数SetWindowsHookEx与WH_KEYBOARD_LL一起使用，以检查确定输入是否为假的LLKHF_INJECTED标志。我在游戏上使用x64dbg调试器在SetWindowsHookEx上设置了断点，并检查是否正在使用WH_KEYBOARD_LL，并且没有使用WH_KEYBOARD_LL，所以这是死路一条。这是第一天，我放弃了，假设其他人会提出解决方案。</p><p>   I had a feeling it was something to do with raw input so this looked promising. Loaded the game in IDA Pro which is a very popular disassembler/decompiler and is what&#39;s seen in my screenshot. Checked if the game used GetRawInputData and it did - once. I looked around the code where it was being used with the decompiler so I don&#39;t have to read assembly. Saw another call to GetRawInputDeviceInfoW nearby and googled it -  https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfow</p><p>   我觉得这与原始输入有关，因此看起来很有希望。在IDA Pro中加载了游戏，IDA Pro是一种非常流行的反汇编程序/反编译器，这就是我的屏幕截图。检查游戏是否使用了GetRawInputData，并且确实使用过一次。我环顾了与反编译器一起使用的代码，因此不必阅读汇编。在附近看到另一个对GetRawInputDeviceInfoW的呼叫并对其进行了搜索-https://docs.microsoft.com/zh-cn/windows/win32/api/winuser/nf-winuser-getrawinputdeviceinfow</p><p> Game seemed to be using this function to determine if the current raw input event processing from WM_INPUT is either keyboard or mouse. Used x64dbg again to break on this and noticed the function was returning an error and the game wasn&#39;t handling it so the game didn&#39;t determine if it was keyboard or mouse and stopped handling the event. Still don&#39;t exactly know why, but the HANDLE GetRawInputData was returning which was being passed to GetRawInputDeviceInfoW is zero / invalid - causing the bug. Then on the msdn docs I noticed the RAWINPUTHEADER returned from GetRawInputData already contains the info to determine if keyboard/mouse - RIM_TYPEMOUSE 0 / RIM_TYPEKEYBOARD 1.</p><p> 游戏似乎正在使用此功能来确定WM_INPUT当前处理的原始输入事件是键盘还是鼠标。再次使用x64dbg打破了这一点，并注意到该函数正在返回错误，并且游戏没有对其进行处理，因此游戏无法确定它是键盘还是鼠标，并停止处理该事件。仍然不完全知道为什么，但是正在返回的HANDLE GetRawInputData传递给GetRawInputDeviceInfoW为零/无效-导致该错误。然后在msdn docs上，我注意到从GetRawInputData返回的RAWINPUTHEADER已经包含确定键盘/鼠标是否为信息-RIM_TYPEMOUSE 0 / RIM_TYPEKEYBOARD 1。</p><p> So I noticed they never had to use GetRawInputDeviceInfoW in the first place. The hex change just makes it ignore what was returned from GetRawInputDeviceInfoW and instead use the info already obtained from GetRawInputData via pretty basic x86 assembly knowledge.</p><p> 因此，我注意到他们从来不需要首先使用GetRawInputDeviceInfoW。十六进制更改只会使其忽略从GetRawInputDeviceInfoW返回的内容，而是使用已经通过相当基本的x86汇编知识从GetRawInputData获得的信息。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.reddit.com/r/cyberpunkgame/comments/kb73fr/comment/gfht16e">https://www.reddit.com/r/cyberpunkgame/comments/kb73fr/comment/gfht16e</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/编译/">#编译</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/输入/">#输入</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fixes/">#fixes</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1038775.html"><img src="http://img2.diglog.com/img/2020/12/thumb_39e5a1a2cf9b16f7d483e691b5369055.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038775.html">Deno 1.6支持将TypeScript编译为单个可执行文件 </a></div><span class="my_story_list_date">2020-12-10 7:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038050.html"><img src="http://img2.diglog.com/img/2020/12/thumb_38ab2f586e1efef00a85f89bcea553e2.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038050.html">基于MIR（中等内部表示）的轻量级JIT编译器 </a></div><span class="my_story_list_date">2020-12-6 20:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038019.html"><img src="http://img2.diglog.com/img/2020/12/thumb_022ae1f163e3837faf7572f4d1b4761b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038019.html">Template Haskell和交叉编译的故事 </a></div><span class="my_story_list_date">2020-12-6 14:57</span></div><div class="col-sm"><div><a target="_blank" href="/story/1037150.html"><img src="http://img2.diglog.com/img/2020/11/thumb_b5310b7ab14bd3f2dcb5e98a7f9dc32a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1037150.html">Richard Miller的RISC-V计划9 C编译器[视频]</a></div><span class="my_story_list_date">2020-11-30 0:30</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>