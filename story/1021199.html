<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用HTTP API服务集成构建存储优先的无服务器应用程序</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用HTTP API服务集成构建存储优先的无服务器应用程序</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-30 03:39:17</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/873fc59dae2eb556e8698c2f994673cf.png"><img src="http://img.diglog.com/img/2020/8/873fc59dae2eb556e8698c2f994673cf.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在过去的一年里，我一直在谈论“存储优先”的无服务器模式。使用这些模式，可以在应用任何业务逻辑之前持久存储数据。此模式的优势在于提高了应用程序的弹性。通过在处理前持久化数据，原始数据在发生错误时仍然可用。</p><p>使用Amazon API Gateway作为AWS Lambda函数的代理是无服务器应用程序中的常见模式。Lambda功能处理业务逻辑，并与其他AWS或第三方服务通信，以路由、修改或存储处理后的数据。一种选择是将数据放在Amazon Simple Queue Service(SQS)队列中，以便下游处理。在此模式中，开发人员负责处理Lambda函数代码中的错误和重试逻辑。</p><p>存储第一个模式将这一点颠倒过来。在运行任何代码之前，它在SQS层使用带有重试逻辑或死信队列(DLQ)的本机错误处理。通过将API Gateway直接集成到SQS中，开发人员可以在减少代码行的同时提高应用程序的可靠性。</p><p>以前，直接集成需要具有用Velocity模板语言(Velocity Template Language，VTL)编写的转换模板的RESTAPI。然而，开发人员告诉我们，他们希望以一种更简单的方式直接与服务集成，而不使用VTL。因此，HTTP API现在能够直接与五个AWS服务集成，而不需要转换模板或代码层。</p><p>此版本的HTTP API直接集成包括Amazon EventBridge、Amazon Kinesis数据流、简单队列服务(SQS)、AWS System Manager的AppConfig和AWS STEP函数。通过这些新集成，客户可以为托管在这些AWS服务中的业务逻辑创建API和WebHook。他们还可以利用HTTP API功能(如授权器、节流和增强的可观察性)来保护和监控这些应用程序。</p><p>用于EventBridge的HTTP API直接集成使用PutEvents API来支持客户端应用程序将事件放置在EventBridge总线上。一旦事件在总线上，EventBridge就会根据EventBridge过滤规则将事件路由到特定目标。</p><p>该集成是存储优先模式，因为在应用任何路由或逻辑之前将数据写入总线。如果下游目标服务有问题，则EventBridge将实施最多24小时增量后退的重试策略。此外，该集成还通过在总线上过滤事件来帮助开发人员减少代码。它路由到下游目标，而不需要Lambda作为传输层。</p><p>用于Kinesis数据流的HTTP API直接集成提供PutRecord集成操作，使客户端应用程序能够将事件放置在Kinesis数据流上。Kinesis数据流设计为每个碎片每秒可处理多达1,000次写入，有效负载大小高达1 MB。开发者可以通过增加数据流中的分片数量来提高吞吐量。您可以将传入数据路由到Amazon S3存储桶等目标，将其作为数据湖或Kinesis数据分析应用程序的一部分进行实时分析。</p><p>此集成是存储优先选项，因为数据在流中存储最多七天，直到被处理并路由到其他地方。当使用Lambda函数处理流事件时，通过可配置的错误处理策略在Lambda层处理错误。</p><p>针对Amazon SQS的HTTP API直接集成提供SendMessage、ReceiveMessage、DeleteMessage和PurgeQueue集成操作。此集成与EventBridge和Kinesis集成的不同之处在于数据双向流动。可以通过HTTP API端点通过REST调用从SQS队列创建、读取和删除事件。此外，可以使用PurgeQueue操作管理队列的完全清除。</p><p>此模式是存储优先模式，因为默认情况下，数据在队列中保留4天(可配置为14天)，除非对其进行处理和删除。当Lambda服务轮询队列时，返回的消息在队列中隐藏一段时间。一旦调用服务处理了这些消息，它就会使用DeleteMessage API永久删除这些消息。</p><p>当使用SQS队列触发Lambda函数时，Lambda服务在内部管理此过程。但是，HTTPAPI与SQS的直接集成使开发人员能够将此过程转移到客户端应用程序，而不需要Lambda功能作为传输层。</p><p>AWS AppConfig的HTTP API直接集成提供GetConfiguration集成操作，并允许应用程序检查应用程序配置更新。通过HTTP API端点公开系统参数API，开发人员可以自动更改其应用程序的配置。虽然此集成不被视为存储优先集成，但它确实支持从外部服务到AppConfig的直接通信，而不需要Lambda功能作为传输层。</p><p>步骤函数的HTTP API直接集成提供了StartExecution和StopExecution集成操作。这些动作允许通过API对步骤函数状态机进行编程控制。当启动步骤函数工作流时，JSON数据在请求中传递并映射到状态机。停止执行时，错误消息也会映射到状态机。</p><p>此模式提供存储优先集成，因为步骤函数在编排的工作流的生命周期中维护持久状态。STEP函数还支持服务集成，允许工作流在不需要Lambda函数作为传输层的情况下发送和接收数据。</p><p>HTTP API服务集成可以使用AWS CLI、AWS SAM或通过API网关控制台构建。控制台通过上下文选择来帮助您了解每个集成需要什么。每个集成还包括一个高级部分，以提供集成的附加信息。</p><p>构建集成后，您可以将其导出为OpenAPI模板，该模板可与基础设施即代码(IAC)工具(如AWS SAM)配合使用。导出的模板还可以包括定义特定集成信息的API网关扩展。</p><p>从HTTP API到SQS的直接集成示例位于Sessions with SAM存储库中。此示例包括以下架构：</p><p>AWS SAM模板创建所需的HTTP API、SQS队列、Lambda函数以及身份和访问管理(IAM)角色。这都是由58行代码生成的，如下所示：</p><p>AWSTemplateFormatVersion：&#39；2010-09-09&#39；转型：AWS：：Serverless-2016-10-31说明：HTTP API直接集成资源：我的队列：类型：aws：：sqs：：QueueMyHttpApi：类型：aws：：Serverless：：HttpApi物业：DefinitionBody：&#39；fn：：Transform&#39；：名称：&#39；aws：：include&#39；参数：地点：&#39；./api.yaml&#39；MyHttpApiRole：类型：&#34；Aws：：iam：：Role&#34；物业：AssumeRolePolicyDocument：版本：&#34；2012-10-17&#34；声明：-效果：&#34；允许&#34；委托人：服务：&#34；apigateway.amazonaws.com&#34；行动：-&#34；STS：AssumeRole&#34；政策：-PolicyName：ApiDirectWriteToSQSPolicyDocument：版本：&#39；2012-10-17&#39；声明：行动：-SQS：SendMessage效果：允许资源：-！GetAtt MyQueue.ArnMyTriggeredLambda：类型：AWS：：Serverless：：Function物业：CodeUri：src/处理程序：app.lambdaHandler运行时：nodejs12.x政策：-SQSPollerPolicy：QueueName：！GetAtt MyQueue.QueueName活动：SQSTrigger：类型：SQS物业：队列：！GetAtt MyQueue.Arn产出：端点：说明：&#34；HTTP API端点URL&#34；值：！SUB&#34；Https://${MyHttpApi}.execute-api.${AWS：：Region}.amazonaws.com&#34；</p><p>OpenAPI模板处理HTTP API配置的路由定义并配置服务集成。模板如下所示：</p><p>Openapi：&#34；3.0.1&#34；信息：标题：&#34；my-sqs-api&#34；路径：/：帖子：回应：默认：说明：&#34；POST默认响应/&#34；X-Amazon-apigateway-集成：集成子类型：&#34；SQS-SendMessage&#34；凭据：Fn：：GetAtt：[MyHttpApiRole，Arn]RequestParameters：MessageBody：&#34；$request.body.MessageBody&#34；QueueUrl：参考：MyQueuePayloadFormatVersion：&#34；1.0&#34；类型：&#34；AWS_PROXY“ConnectionType：&#34；互联网&#34；X-Amazon-apigateway-import export-version：&#34；1.0&#34；</p><p>由于OpenAPI模板通过转换包含在AWS SAM模板中，因此API Gateway集成可以引用在AWS SAM模板中创建的角色和服务。</p><p>这篇文章介绍了存储优先集成模式的概念，以及新的HTTPAPI直接集成如何提供帮助。我将介绍当前的五个集成以及每个集成可能的用例。此外，我还演示了如何使用AWS SAM将基础设施作为代码来构建和管理集成的应用程序。</p><p>将存储优先模式与直接集成结合使用可以帮助开发人员用更少的代码行构建更持久的无服务器应用程序。将数据从API端点传输到所需服务不再需要Lambda函数。相反，可以使用Lambda函数调用来区分业务逻辑。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://aws.amazon.com/blogs/compute/building-storage-first-applications-with-http-apis-service-integrations/">https://aws.amazon.com/blogs/compute/building-storage-first-applications-with-http-apis-service-integrations/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/http/">#http</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/storage/">#storage</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/集成/">#集成</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1021184.html"><img src="http://img.diglog.com/img/2020/8/thumb_2741b20fd4e008ac9f4d0fe89cce75db.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021184.html">SC-IM-终端的ncurses电子表格程序</a></div><span class="my_story_list_date">2020-8-30 3:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021112.html"><img src="http://img.diglog.com/img/2020/8/thumb_4d5651aa098ff22d48c18f6b2de4f288.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021112.html">松弛桌面应用程序中的远程代码执行</a></div><span class="my_story_list_date">2020-8-29 15:47</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021085.html"><img src="http://img.diglog.com/img/2020/8/thumb_febcda577f3efa16e06664cb7ee33725.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021085.html">谷歌正在从Play Store中删除访问FeDISTIC的应用程序，称FeDISTICATION可以用来访问托管带有仇恨言论的内容的服务器</a></div><span class="my_story_list_date">2020-8-29 11:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021019.html"><img src="http://img.diglog.com/img/2020/8/thumb_3530f1edfeebf395f0b2f53a9f6e0ed6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021019.html">Windows新功能：直接从PC访问Android手机的应用程序</a></div><span class="my_story_list_date">2020-8-29 5:38</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>