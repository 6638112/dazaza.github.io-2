<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ebpf在windows上 eBPF on Windows</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">eBPF on Windows<br/>ebpf在windows上 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-11 02:42:51</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/5/5ddb6c87d13cc234673b8443c82556bc.png"><img src="http://img2.diglog.com/img/2021/5/5ddb6c87d13cc234673b8443c82556bc.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>eBPF is a well-known technology for providing programmability and agility, especially for extending anOS kernel, for use cases such as DoS protection and observability. This project is a work-in-progress thatallows using existing eBPFtoolchains and APIs familiar in the Linux ecosystem to be used on top of Windows. That is, this projecttakes existing eBPF projects as submodules and adds the layer in between to make them run on top of Windows.</p><p>EBPF是一种众所周知的技术，用于提供可编程性和敏捷性，特别是用于扩展ANOS内核，用于使用DOS保护和可观察性。此项目是使用现有的EBPFTOOLCHAINS和Linux生态系统中的APIS熟悉的工作进展，以便在Windows之上使用。也就是说，这将现有的EBPF项目作为子模块，并在介于Windows的顶部添加它们之间的图层。</p><p>      As shown in the diagram, existing eBPF toolchains (clang, etc.) can be used to generate eBPF bytecode fromsource code in various languages. Bytecode can be consumed by any application, or via the Netsh command line tool, which use a shared librarythat exposes  Libbpf APIs,though this is still in progress.</p><p>      如图所示，现有的EBPF Toolchains（Clang等）可用于以各种语言从源代码生成EBPF字节码。字节码可以由任何应用程序消耗，或者通过NetSh命令行工具，它使用共享的库，虽然这仍然正在进行中。</p><p> The eBPF bytecode is sent to a static verifier (the  PREVAIL verifier)that is hosted in a user-mode  protected process(a Windows security environment that allows a kernel component to trust a user-mode daemon signed bya key that it trusts). If the bytecode passes all the verifier checks, it can be either loaded intoan interpreter (from  uBPF in the kernel-mode execution context, orJIT compiled (via the  uBPF JIT compiler) and have native code loadinto the kernel-mode execution context (but see the FAQ at bottom about HVCI).</p><p> EBPF字节码将被发送到静态验证器（PREVAIL验证程序），该静态验证器（以Windows安全环境托管）托管（允许内核组件信任用户模式守护程序的Windows安全环境签名）。如果字节码通过所有验证者检查，它可以加载到解释器（从内核模式执行上下文中的UBPF中，编译（通过UBPF JIT编译器）并具有本质代码LoadInto内核模式执行上下文（但请参阅关于HVCI底部的常见问题解答）。</p><p> Temporary Note: some parts are still under development and may not appearwhen building the master branch, but the end-to-end functionality can still be tested immediatelywhile the security hardening is still in progress.</p><p> 临时注意：有些部分仍在开发中，可能不会出现在构建主分支机构时，但仍然可以立即测试端到端功能，而安全硬化仍在进行中。</p><p> eBPF programs installed into the kernel-mode execution context can attach to various hooks (currentlytwo hooks so far: XDP and a socket bind hook) and call various helper APIs exposed by the eBPF shim,which internally wraps public Windows kernel APIs, allowing the use of eBPF on existing versions of Windows.More hooks and helpers will be added over time.</p><p> 安装到内核模式执行上下文中的EBPF程序可以附加到各种钩子（到目前为止的挂钩：XDP和套接字绑定挂钩），并通过EBPF Shim呼叫各种助手API，内部包裹公共Windows内核API，允许使用eBPF在现有版本的Windows中.Oore Hooks和Helpers将随时间添加。</p><p>  This project supports eBPF on Windows 10, and on Windows Server 2016 or later.To try out this project, see our  Getting Started Guide.</p><p>  此项目支持Windows 10上的EBPF，以及Windows Server 2016或更高版本。尝试此项目，请参阅我们的入门指南。</p><p>     The eBPF for Windows project leverages existing projects, includingthe  IOVisor uBPF project andthe  PREVAIL verifier,running them on top of Windows by adding the Windows-specific hosting environment for that code.</p><p>     Windows项目的EBPF利用现有项目，包括IOVISOR UBPF项目和PREVAIL验证者，通过为该代码添加特定于Windows的托管环境，在Windows之上运行它们。 </p><p>  The intent is to provide source code compatibility for code that uses commonhooks and helpers that apply across OS ecosystems.</p><p>意图是为使用应用于操作系统生态系统的CommonHooks和帮助程序的代码提供源代码兼容性。</p><p> Linux provides many hooks and helpers, some of which are very Linux specific (e.g., usingLinux internal data structs) that would not be applicable to other platforms.Other hooks and helpers are generically applicable and the intent is to support them for eBPFprograms.</p><p> Linux提供了许多钩子和帮助者，其中一些是非常适用于其他平台的Linux特定的</p><p> Similarly, the eBPF for Windows project exposes  Libbpf APIsto provide source code compatibility for applications that interact with eBPF programs.</p><p> 同样，Windows项目的EBPF公开了libbpf apisto为与ebpf程序交互的应用程序提供源代码兼容性。</p><p>  eBPF programs can be run either in an interpreter or natively using a JIT compiler.</p><p>  EBPF程序可以在解释器中或使用JIT编译器进行处理。</p><p> HyperVisor-enforced Code Integrity (HVCI)is a mechanismwhereby a hypervisor, such as Hyper-V, uses hardware virtualization to protect kernel-mode processes againstthe injection and execution of malicious or unverified code. Code integrity validation is performed in a secureenvironment that is resistant to attack from malicious software, and page permissions for kernel mode are set andmaintained by the hypervisor.</p><p> 管理程序强制守则Integrity（HVCI）是一个机制来自Hyper-V，如Hyper-V，使用硬件虚拟化来保护内核模式进程反对注入和执行恶意或未验证的代码。代码完整性验证是在抵抗恶意软件攻击的安全环境中执行的，并且通过管理程序设置内核模式的页面权限。</p><p> Since a hypervisor doing such code integrity checks will refuse to accept code pages that aren&#39;t signed bya key that the hypervisor trusts, this does impact eBPF programs running natively. As such, when HVCIis enabled, eBPF programs work fine in interpreted mode, but not when using JIT compilation.</p><p> 由于执行此类代码完整性检查的虚拟机管理程序将拒绝接受aren＆＃39; t签名的代码页面，符号为管理程序信任，这确实会影响自然运行的EBPF程序。因此，当启用HVCIIS时，EBPF程序以解释模式工作正常，但在使用JIT编译时不起作用。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/microsoft/ebpf-for-windows">https://github.com/microsoft/ebpf-for-windows</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ebpf/">#ebpf</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>