<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>负载平衡系统的惊人经济性</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">负载平衡系统的惊人经济性</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-08 18:48:53</div><div class="page_narrow text-break page_content"><p>我有一个具有c个服务器的系统，每个服务器只能处理单个并发请求，并且没有内部队列。服务器位于负载均衡器之后，负载均衡器包含无限队列。不限数量的客户端平均每秒向负载均衡提供c*0.8个请求。换句话说，我们使用c线性增加提供的负载，以保持每台服务器的负载恒定。一旦请求到达服务器，平均需要一秒钟来处理。客户端观察到的平均请求时间如何随c变化？</p><p>选项A是平均等待时间迅速减少，随着c的增加逐渐接近一秒(换句话说，排队时间接近于零)。选项B是恒定的。选项C是线性改进，而D是延迟的线性降低。直观地说，您认为延迟将遵循哪条曲线？</p><p>稍微分解一下这个问题将有助于找出哪一个是正确的答案。首先是名字。在排队论的术语中，这是一个M/M/c排队系统：泊松到达过程、指数分布的客户服务时间和c个后端服务器。在电信业务工程中，它指的是Erlang的延迟系统(或者，因为术语有趣，叫M/M/n)。我们可以使用排队论的一个经典结果来分析这个系统：Erlang的C公式E2，n(A)，该公式根据服务器数量(n又称为c)和提供的流量A计算进入队列(而不是立即处理)的客户请求的概率。有关详细信息，请参阅电信业务工程手册的第194页。以下是曲线的基本形状(使用我们相同的参数)：</p><p>沿着蓝线走到饱和点的一半，在2.5 RPS提供的负载下，看看概率是如何在13%左右的。现在请看饱和点的一半处的紫色线条，即5 RPS。只有3.6%。因此，在负载减半的情况下，5台服务器的系统无需排队即可处理87%的流量，在双倍负载和双倍服务器的情况下，我们无需排队即可处理96.4%的流量。这意味着只有3.6%的人看到任何额外的延迟。</p><p>事实证明，这一改善实际上是渐近接近1的。推特民意调查的正确答案是A。</p><p>使用平均数来衡量潜伏期是有争议的(尽管或许它不应该如此)。为了避免这种争议，我们需要知道百分位数是否以同样的速度改善。在封闭的形式下做这件事有点复杂，但这个系统超级简单，所以我们可以用蒙特卡罗模拟把它们画出来。结果如下所示：</p><p>这完全是个好消息。中位数(P50)很好地遵循平均线，高百分位数(第99和99.9个百分位数)形状相似。没有隐藏的问题。</p><p>对于云计算和服务经济来说，这也是个好消息。使用较大的c，我们可以在相同利用率的情况下获得更好的延迟，或者在相同延迟的情况下获得更好的利用率，所有这些都是在相同的每台服务器吞吐量下实现的。这不仅仅对大型服务来说是个好消息，因为大部分好处都发生在相对较小的c。随着c的增加，几乎没有什么与规模和分布式系统相关的问题会变得更容易。这是其中之一。</p><p>有一些合理的后续问题。对于我们随意选择的0.8，结果稳健吗？是的，它们是1。对于典型的服务，泊松到达和指数服务时间的M/M/c假设是否合理？我要说它们是合理的，尽管是错误的。指数服务时间尤其错误：现实的服务往往更像是对数正态分布。这可能无关紧要。有关这一点的更多信息，下次再说吧。</p><p>更新：Dan Ports用一个迷人的Twitter帖子回应了我的帖子，该帖子指向了SoCC&#39；14的尾部延迟的硬件、操作系统和应用程序级来源，该帖子研究了这种影响在野外的情况。</p><p>在一定程度上。一旦平均到达率超过系统完成请求的能力，队列就会无限制地增长，等待时间就会变得无限长。在我们的示例中，当请求负载超过c时就会发生这种情况。更一般地，要使此系统稳定，λ/cμ必须小于1，其中λ是平均到达率，μ是服务器处理请求所用的平均时间。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://brooker.co.za/blog/2020/08/06/erlang.html">http://brooker.co.za/blog/2020/08/06/erlang.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/负载平衡/">#负载平衡</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/economics/">#economics</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/服务器/">#服务器</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>