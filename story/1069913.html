<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>编译你的软件</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">编译你的软件</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-07-27 07:03:46</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/7/c5187e2fee2ed9dbaa2614aaf051b529.png"><img src="http://img2.diglog.com/img/2021/7/c5187e2fee2ed9dbaa2614aaf051b529.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>几周前，我举办了一个关于 Kubernetes/Docker 的会议（法语，抱歉，但幻灯片在这里），我在声明中声明，有些人理所当然地让我负责：Docker 镜像很慢，因为它们正在使用旧技术！但是Loïc，这个尺度到底是什么？你本该是个科学家，却给了我们这个便便？我是说，如果你自己编译你的软件（在容器内或不在容器内），你将会有很大的改进。但是人们不相信我。所以为了证明他们是错的，因为我的自我真的很痛苦，我决定根据Redis的编译尝试一个合适的测试场景。 Redis 是最常用的对性能有巨大影响的软件之一。它在行业中被广泛使用，主要用作缓存或快速 KV 内存存储。您可以清楚地想象这种系统的性能影响。所以我们做了我们通常做的事情（以及很多人应该做的事情），我们查看了文档。我们发现了什么？ redis 基准。 Redis 包含 redis-benchmark 实用程序，它模拟 N 个客户端同时发送 M 个查询（它类似于 Apache 的 ab 实用程序）执行的运行命令。</p><p>我们想要一个可靠且廉价的基础设施来测试我们的系统。像往常一样，我们选择了Scaleway。但是等等，Redis 是单线程的，为什么我们需要 4 个内核？因为 4 个内核被调度为： 我们的 celery 配置为具有 1 的并发性，所以没有在机器上同时运行多个测试。我们的结果服务器是一个较小的服务器，具有最具创新性的数据平台之一：Warp10。 Warp10 允许我们以非常高的速度和低延迟处理数字。任务将通过 celery 调度，底层使用 Kalvad 的 RabbitMQ 集群。我们对使用这项技术的兴趣是：任务的代码可以在这里找到。如您所见，我们正在通过 python 子进程启动 redis-benchmark，要求以 CSV 格式输出，然后我们对其进行解析并将其推送到 Warp10 上。简单的。</p><p>-d 1000 是以字节为单位的 SET/GET 值的数据大小（默认为 2），我们认为 1kB 更现实 -p 是要测试的端口，我们做了一些很棒的事情：我们每个端口运行一个 redis（更多细节如下）redis-benchmark -q -n 100000 --csv -d 1000 --threads 2 -p 6379&quot;test&quot;,&quot;rps&quot;,&quot;avg_latency_ms&quot;,&quot;min_latency_ms&quot;,&quot;p50_latency_ms&quot;,&quot;p95_latency_ms&quot;,&quot; p99_latency_ms&quot;,&quot;max_latency_ms&quot;&quot;PING_INLINE&quot;,&quot;200000.00&quot;,&quot;0.157&quot;,&quot;0.032&quot;,&quot;0.143&quot;,&quot;0.271&quot;,&quot;0.359&quot;,&quot;0.623&quot;&quot;PING_MBULK&quot;,&quot;0000.00&quot;,&quot;.819 0.024&quot;,&quot;0.127&quot;,&quot;0.239&quot;,&quot;0.319&quot;,&quot;0.807&quot;&quot;SET&quot;,&quot;200000.00&quot;,&quot;0.153&quot;,&quot;0.032&quot;,&quot;0.143&quot;,&quot;0.239&quot;,&quot;0.279&quot;,&quot;1&quot;1 GET&quot;,&quot;199600.80&quot;,&quot;0.154&quot;,&quot;0.032&quot;,&quot;0.151&quot;,&quot;0.271&quot;,&quot;0.327&quot;,&quot;0.599&quot;&quot;INCR&quot;,&quot;200000.00&quot;,&quot;0.159&quot;,&quot;0.032&quot;,&quot;0.032&quot;,&quot;0.327&quot; &quot;0.255&quot;,&quot;0.303&quot;,&quot;0.519&quot;&quot;LPUSH&quot;,&quot;199600.80&quot;,&quot;0.178&quot;,&quot;0.040&quot;,&quot;0.167&quot;,&quot;0.287&quot;,&quot;0.327&quot;,&quot;0.751&quot;&quot;RPUSH&quot;,&quot;2000&quot; “0.169”、“0.040”、“0.159”、“0.239”、“0.319”、“0.559”“LPOP”、“200000.00”、“0.184”、“0.032”、“0.167”、“0.303”、“0.3039” ,&quot;1.079&quot;&quot;RPOP&quot;,&quot;199203.20&quot;,&quot;0.182&quot;,&quot;0.040&quot;,&quot;0.175&quot;,&quot;0.295&quot;,&quot;0.359&quot; ,&quot;1.439&quot;&quot;SADD&quot;,&quot;200000.00&quot;,&quot;0.154&quot;,&quot;0.032&quot;,&quot;0.143&quot;,&quot;0.247&quot;,&quot;0.303&quot;,&quot;0.511&quot;&quot;HSET&quot;,&quot;199600.80&quot;,&quot;0.1302&quot; ,&quot;0.143&quot;,&quot;0.199&quot;,&quot;0.279&quot;,&quot;0.519&quot;&quot;SPOP&quot;,&quot;199600.80&quot;,&quot;0.144&quot;,&quot;0.032&quot;,&quot;0.143&quot;,&quot;0.239&quot;,&quot;0.287&quot;,&quot;1.103&quot; ,&quot;200000.00&quot;,&quot;0.163&quot;,&quot;0.032&quot;,&quot;0.151&quot;,&quot;0.255&quot;,&quot;0.303&quot;,&quot;0.567&quot;&quot;ZPOPMIN&quot;,&quot;200000.00&quot;,&quot;0.155&quot;,&quot;0.032&quot;,&quot;40&quot;,&quot;70&quot; &quot;,&quot;0.287&quot;,&quot;0.535&quot;&quot;LPUSH (需要对 LRANGE 进行基准测试)&quot;,&quot;199600.80&quot;,&quot;0.177&quot;,&quot;0.040&quot;,&quot;0.167&quot;,&quot;0.263&quot;,&quot;0.319&quot;,&quot;0.615&quot;&quot;0first (LRANGE_first) 100 个元素)&quot;,&quot;30750.31&quot;,&quot;1.096&quot;,&quot;0.144&quot;,&quot;1.071&quot;,&quot;1.455&quot;,&quot;1.551&quot;,&quot;2.895&quot;&quot;LRANGE_300（前 300 个元素）&quot;,&quot;11106.18&quot;,&quot;1&quot; 0.136&quot;、&quot;1.559&quot;、&quot;2.367&quot;、&quot;2.831&quot;、&quot;5.423&quot;&quot;LRANGE_500（前 500 个元素）&quot;、&quot;6663.56&quot;、&quot;1.496&quot;、&quot;0.216&quot;、&quot;1.471&quot;、&quot;2.070&quot; ,&quot;8.639&quot;&quot;LRANGE_600 (前 600 个元素)&quot;,&quot;5125.84&quot;,&quot;1.773&quot;,&quot;0.272&quot;,&quot;1.695&quot;,&quot;2.615&quot;,&quot;3.079&quot;,&quot;10.119&quot;&quot;MSET (10 个键)&quot;,3333.133 &quot;,&quot;0.257&quot;,&quot;0.056&quot;,&quot;0.223&quot;,&quot;0.351&quot;,&quot;0.407&quot;,&quot;2.359&quot; 如您所见，我们有 20 个测试，有 7 个指标，这意味着每次测试，我们将产生140 个指标。为了验证我们的概念，我们选择使用多个 Redis 6.2.4 服务器。请注意，编译后的服务器应该通过执行 make 测试来验证 redis 设置，他们做到了我们只是在容器内的 arch 存储库中使用了默认的 redis。 Redis Stock Arch 正在使用：同样的故事，我们只是采用了测试时可用的最新 Redis 版本。它有以下设置：</p><p>几个月前我看到一篇文章，其中有人使用 zig 在 ARM 上编译一些 C 代码，我喜欢这个想法，所以我们想在我们的测试中包含这个设置。这是 Kalvad 的历史性构建，但我们使用 mimalloc 项目而不是使用 jemalloc。完整的 gts 可在此处获得，因此您可以将原始结果导入您自己的 Warp10 实例中。首先，Redis 正在大量使用内存，而我们使用相同版本的 jemalloc 的事实正在减少影响。其次是CPU。 AMD EPYC 7281 于 2017 年第四季度发布，这是旧的。它没有可以进行更多改进的完整指令集。 zig 的味道在这里是一个笑话，但事实证明这是一个很好的笑话：Zig 编译 Redis 比股票 arch 慢 0.288%！齐格干得好！无论您使用何种打包技术，当您开始使用 4 年历史的库和为整个地球编译的软件时，您都会得到这样的结果：慢 142.92%。惊喜：我们之前的测试显示出更好的改进，所以这个结果让我们有点失望。</p><p>简单的。出于同样的原因，优化风格并没有太大不同：CPU。我们使用 AMD EPYC 7282（于 2019 年第四季度发布）进行了一些测试，我们看到了更大的改进。这是我们在 Kalvad 应用的规则，我们知道有些我们非常尊重的人也在做同样的事情（你好 CleverCloud）。它将帮助您理解它，使您的应用程序更快、更安全（例如，通过删除 NGiNX 的邮件网关），并将向您展示哪些软件易于维护和可靠。如果您遇到问题而没有其他人可以提供帮助。也许您可以聘请 Kalvad-Team。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.kalvad.com/compile-your-softwares/">https://blog.kalvad.com/compile-your-softwares/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/编译/">#编译</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/compile/">#compile</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/quot/">#quot</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>