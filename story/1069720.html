<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>如何使用有限状态机和 XState 在 React 中对应用程序流进行建模</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">如何使用有限状态机和 XState 在 React 中对应用程序流进行建模</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-07-26 04:20:13</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/7/71098a09c52054c5494ce71a3adf002c.png"><img src="http://img2.diglog.com/img/2021/7/71098a09c52054c5494ce71a3adf002c.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>前端客户端中的应用程序状态是一种复杂性，充其量是可以管理的，最糟糕的是您无法交付新功能的原因。在现代前端应用程序中，有很多方法可以处理应用程序状态。您可能熟悉 React 的 useState/useReducer 钩子、Redux 或许多其他状态管理库之一。但是，当您将该状态与业务逻辑配对时，有限状态机可能是一种更好的管理方式。有限状态机是计算的数学模型。它是一个抽象的“机器”，可以在任何给定时间处于有限数量的状态中的一个。机器可以响应某些已知输入从一种状态转换到另一种状态作为事件。您可以通过状态列表、初始状态和触发每个转换的事件来定义有限状态机。让我们举一个真实世界的化妆 (😝) 示例。您正在为您的应用程序构建一个配置文件页面。当用户第一次使用你的应用程序时，他们有一个空白的配置文件。当用户进入个人资料页面时，如果用户有个人资料，您希望个人资料页面显示该个人资料。如果他们没有个人资料，您希望为他们提供一种创建和保存个人资料的方法。如果他们确实有个人资料，您还希望为他们提供编辑和保存个人资料的方式。我们可以在流程图中定义它，而不是将命令式业务逻辑分散在代码中，从开发人员到利益相关者都可以看到和理解。</p><p>配置文件加载状态 - 服务器响应配置文件请求时 线条和箭头显示了我们如何从状态转换到状态。有时我们直接转换，有时根据我们转换到一种或另一种状态的条件。现在我们知道所有状态以及如何在它们之间转换，我们可以继续使用 XState 创建我们的状态机。 XState 是最全面的 Javascript 有限状态机库之一，具有可视化等附加工具。我们将首先使用 createMachine 创建一个 XState 机器。我们将给它一个 id 和一个初始状态，我们将称其为正在加载，我们将为 profile 和 error 添加一个空值到您可以想到的上下文中类似于 React 的状态对象。我们也会列出所有可能的状态。我们将添加一个 invoke 属性，该属性指向在 createMachine 调用的第二个参数中定义的 fetchProfile 服务。这意味着当机器处于加载状态时，它会调用 fetchProfile 服务中定义的函数。这是一个 API 调用，它返回一个承诺和一些数据。我们已经在加载状态调用属性上定义了 onDone 和 onError 属性。这些在承诺解决或拒绝时被调用。</p><p>如果我们得到一个成功的响应，我们就会触发 XState 的分配操作，用事件数据更新上下文，然后转到 profileLoaded 状态。接下来，让我们将名为 hasProfile 的保护添加到传递给 createMachine 对象的第二个参数中。如果配置文件存在，这将返回一个布尔值。我们还将设置 profileLoaded 状态以检查配置文件是否存在。如果是，则移至 showProfile 状态，如果不是，则移至 noProfile 状态。我们在这里使用“eventless” always 属性来根据守卫自动移动到下一个状态。我们在 noProfile 状态上添加了一个 CREATE_NEW_PROFILE 事件，当触发时，会将状态转换为 createdProfile 状态。我们还在创建配置文件状态上添加了事件来处理保存和取消创建的配置文件。最后，我们将根据我们从前面的步骤中了解到的信息填写其余的状态、转换和服务，最终得到这样的结果：</p><p>由于布局的原因，我们的最终状态图可能看起来有点忙，但它与上面的原始流程图具有相同的步骤。此图表示通常定义不明确且分散在整个代码中的业务逻辑。使用 FSM 的优点是我们必须预先考虑这种状态，以便我们可以更好地理解和定义它。仅此一项就可以减少构建过程、维护和附加功能构建期间的错误和沟通不畅。现在要在 React 中使用它，我们只需添加 @xstate/react 包并导入 useMachine 钩子状态是一个具有值（当前机器状态）和上下文（具有我们的配置文件和错误的对象）的对象。状态对象上还有一个匹配函数，可用于匹配状态。我们可以通过发送函数向机器发送状态适当的事件。例如，当处于 showProfile 状态时，我们可以调用 send(&#39;EDIT_PROFILE&#39;) 并且状态将从 showProfile 转换为正在编辑的配置文件。</p><p>当状态对象发生更改时，组件将重新渲染，允许您使用适当的 UI 代码响应这些状态更改。有限状态机是一种非常好的方式，可以迫使您预先考虑应用程序可能处于的状态，然后将这些状态编码到驱动您的用户体验的机器中。我们经常使用多个 useState 或 useReducer 钩子或全局状态管理解决方案来处理 React 中的这种复杂性。这种方法不需要替换它们，但它在您的工具箱中提供了一个有用的工具来控制您可能会遇到的一些更复杂的工作流时不时遇到。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://engineering.kablamo.com.au/posts/2021/finite-state-machines-and-xstate">https://engineering.kablamo.com.au/posts/2021/finite-state-machines-and-xstate</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/xstate/">#xstate</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/状态/">#状态</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1069681.html"><img src="http://img2.diglog.com/img/2021/7/thumb_3e2087b53635a6bd78af6d2425c51dcf.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1069681.html">Ampache：一个开源的基于网络的音频/视频流应用程序和文件管理器</a></div><span class="my_story_list_date">2021-7-25 22:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1069674.html"><img src="http://img2.diglog.com/img/2021/7/thumb_5dcbbd3b57ae59d20e5c7b24f917b008.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1069674.html">每个程序员都必须知道的（类）算法</a></div><span class="my_story_list_date">2021-7-25 21:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1069568.html"><img src="http://img2.diglog.com/img/2021/7/thumb_6749c7cc928dac02d1da4b4c850972bd.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1069568.html">Windows Sysinternals：高级系统实用程序和技术信息</a></div><span class="my_story_list_date">2021-7-25 15:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1069508.html"><img src="http://img2.diglog.com/img/2021/7/thumb_9c9197eddd72691970b84bcd3f490061.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1069508.html">卡巴斯基警告假 Windows 11 安装程序正在传播恶意软件</a></div><span class="my_story_list_date">2021-7-25 5:7</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>