<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Zig有多安全？ How Safe Is Zig?</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">How Safe Is Zig?<br/>Zig有多安全？ </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-22 17:04:34</div><div class="page_narrow text-break page_content"><p>For various common safety issues, we can look at protections that are present in software as it is typically shipped (ie excluding tools like AddressSanitizer that are  not recommended for production use):</p><p>对于各种常见的安全问题，我们可以看出软件中存在的保护，因为它通常发货（即不包括不推荐用于生产使用的地址硬化器等工具）：</p><p>  only when using tagged unions, doesn&#39;t protect against holding a pointer to value while changing tag</p><p>  只有在使用标记的联合时，＆＃39; t防止在更改标签时保持指针到值</p><p>  Spatial memory safety. Mostly runtime mitigations. Nearly identical in both zig and rust. These are easy to implement and probably sufficiently non-controversial that any new systems language will have similar features.</p><p>  空间记忆安全。主要是运行时的缓解。在Zig和Rust中几乎相同。这些易于实施，并且可能充分地非争议，任何新系统语言都有类似的功能。</p><p> Temporal memory safety and data race safety. Mostly compile time mitigations. Unique to rust. These are novel, non-trivial to implement and add a significant amount of complexity to the language.</p><p> 时间记忆安全和数据竞争安全。主要是编制时间缓解。独特的生锈。这些是新颖的，不琐碎的实施，并为语言增加大量复杂性。</p><p> So we can say that zigs spatial memory safety is roughly comparable to rust, and its temporal memory safety and data race safety are roughly comparable to c.</p><p> 因此，我们可以说，Zigs空间记忆安全性大致与锈硬相当，其时间记忆安全性和数据竞争安全性大致与C相当。</p><p>   The standard library includes a set of allocators which don&#39;t reuse allocations, preventing use-after-free, and which catch double-free. I&#39;m not clear yet on how high the runtime and memory overhead are though, which will dictate when it is practical to use these.</p><p>   标准图书馆包括一组分配者，其中不用重复使用分配，防止无用，并捕获双重。我＆＃39;虽然虽然是如何高的，但虽然是如何高的，但是在使用这些时，它将决定。</p><p> In c unitialized variables are often used when they can&#39;t easily be initialized by a single expression. In zig it&#39;s possible to use a labeled block that returns the initial value, or to use an optional type and initialize it to null.</p><p> 在C单调的变量中，通常可以使用单个表达式初始化时＆＃39; t。在Zig IT＆＃39中可以使用标记的块返回初始值，或使用可选类型并将其初始化为NULL。 </p><p> The pervasive allocator api makes it easier to use arena allocation or garbage-collected pools which simplify lifetime management.</p><p>普遍的分配器API使得更容易使用竞技场分配或垃圾收集的池，这简化了寿命管理。</p><p> Using  defer and  errdefer simplifies resource cleanup inside complicated control flow, reducing the possibility of mistakes.</p><p> 使用DEFER和ERRDEFER简化了复杂控制流程内的资源清理，从而减少了错误的可能性。</p><p> Zig also has a number of tools to help detect violations of temporal memory safety during testing. These are useful, but experience with c indicates that they won&#39;t be sufficient to eliminate vulnerabilities.</p><p> ZIG还拥有许多工具，以帮助检测在测试期间违反时间内存安全性的工具。这些是有用的，但C的经验表明他们赢得了＆＃39; t足以消除漏洞。</p><p>  I tried looking at some public breakdowns of security issues from various projects written in c and c++ (mostly sourced from  Alex Gaynors handy summary) to get a sense of the relative frequencies:</p><p>  我尝试从C和C ++编写的各种项目中查看一些公开的安全问题（主要来自Alex Gaynors Handy Summary），以获得相对频率的感觉：</p><p> Windows: Some of the categories don&#39;t map neatly to spatial vs temporal. If we assume that &#39;stack corruption&#39; is always temporal but &#39;heap corruption&#39; could go either way then we have 23-36% spatial vs 28-41% temporal for 2018. If we narrow down to exploited issues then it&#39;s 0% spatial vs 75% temporal.</p><p> Windows：一些类别Don＆＃39; T整齐地映射到空间VS时间。如果我们假设和＃39;堆栈腐败＆＃39;始终是颞率的，但＆＃39;堆腐败＆＃39;无论哪种方式，我们都有23-36％的空间与2018年的时间。如果我们缩小到被剥削的问题，那么它＆＃39; s 0％空间与75％的时间。</p><p> Curl: 45% spatial vs 7% temporal (the pie-chart breakdown is only for the 52% of security issues related to memory safety)</p><p> 卷曲：45％空间与7％的时间（饼图击穿仅适用于与内存安全相关的安全问题的52％）</p><p> 0day in the wild: Insufficient detail on most, but if we look just at those explicitly marked as &#39;use after free&#39; then we have 5/25 in 2020, 5/21 in 2019, 6/13 in 2018 etc so possibly &gt;50% temporal?</p><p> 在野外：大多数情况下的细节不足，但如果我们看看那些明确标记为＆＃39的那些;免费使用＆＃39;然后我们在2019年的2020年5月25日，2018年5月21日，2018年6月12日等所以可能＆gt; 50％的时间？ </p><p> This isn&#39;t a very clear picture. The percentages vary wildly between projects. The categories are sufficiently vague that I could be classifying them all wrong. Looking only at fixed issues tells us nothing about how easy they are to exploit, but looking at existing exploits limits us to a very small dataset.</p><p>这是一个非常清晰的画面。项目之间的百分比变得越来越大。这些类别足够含糊，我可以将它们分类错误。看起来只关注固定问题就会告诉我们它们是多么容易利用，但看现有的利用将我们限制在一个非常小的数据集中。</p><p> It certainly seems like just fixing spatial memory safety (going from c to zig) is a non-trivial improvement. But I&#39;d like to better understand why actual exploits appear here to rely more often on violating temporal memory safety.</p><p> 它肯定似乎只是修复空间记忆安全（从C到Zig）是一种非琐碎的改进。但是，我喜欢更好地了解为什么实际的漏洞在这里依赖于违反时间记忆安全性的原因。</p><p>  Rust bears additional complexity and friction to buy temporal memory safety and data race safety. But sometimes we might be able to buy those more cheaply eg:</p><p>  铁锈额外复杂和摩擦，以购买时间记忆安全和数据竞争安全。但有时我们可能能够更便宜地购买，例如：</p><p> Systems that can approach temporal memory safety by: Making use of some specialized system for managing long-lived state (eg  fossil&#39;s use of sqlite,  edge&#39;s use of memgc)</p><p> 可以通过以下方式接近时间记忆安全的系统：利用一些专业系统管理长寿状态（例如化石＆＃39;使用SQLite，Edge＆＃39;使用Memgc）</p><p> Sometimes we might also just choose the bear the cost. For systems with low risk profiles (eg internal software that is never exposed to hostile input) we might decide that debugging the occasional use-after-free is preferable to adding development friction.</p><p> 有时我们也可以选择承担成本。对于具有低风险简档的系统（例如从未暴露于敌对输入的内部软件），我们可能决定调试偶尔的使用是可以添加开发摩擦。</p><p> There are certainly systems though where none of the above are options. For example, the web spec pretty much mandates that browsers must have complicated ownership models, use pervasive sharing between threads and be constantly exposed to hostile inputs. In such cases it&#39;s hard to make an argument for zig.</p><p> 肯定有系统，虽然以上都不是选项。例如，Web Spec几乎授权浏览器必须具有复杂的所有权模型，在线之间使用普及共享并不断地暴露于敌对输入。在这种情况下，它很难对Zig作出争论。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://scattered-thoughts.net/writing/how-safe-is-zig/">https://scattered-thoughts.net/writing/how-safe-is-zig/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/zig/">#zig</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/safe/">#safe</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>