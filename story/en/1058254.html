<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>2021年Netbooting Raspberry PI的状态 State of netbooting Raspberry Pi in 2021</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">State of netbooting Raspberry Pi in 2021<br/>2021年Netbooting Raspberry PI的状态 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-14 11:15:09</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/a37a03a01f2ae07458754d67d9748038.jpeg"><img src="http://img2.diglog.com/img/2021/4/a37a03a01f2ae07458754d67d9748038.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>TLDR; When I tried netbooting 24 RPi3s in 2017, it failed miserably. Find out what changed when I built my private cloud with the newer Raspberry Pi 4s and K3s.</p><p>TLDR;当我在2017年尝试NetBooting 24 RPI3S时，它失败了。当我用较新的raspberry pi 4s和K3s建立我的私有云时，找出更改的内容。</p><p> Just over three years ago,  I wrote up a blog post exploring why netbooting was interesting for Raspberry Pi, and what kind of problems I ran into due to issues with the firmware available at the time.</p><p> 在三年前，我写了一个博客文章探索为什么Netbooting对Raspberry PI有趣，并且由于当时可用的固件问题而遇到了什么样的问题。</p><p> My original rig had 24 early-generation Raspberry Pi 3s, which had a timing bug rendering them unreliable for netbooting.</p><p> 我的原装有24个早期覆盆子PI 3s，它有一个定时虫，使他们对NetBooting不可靠。</p><p> In this post, I&#39;ll give you an update (things are much better now) and I&#39;ll also tell you about my new rig which I&#39;m running K3s on.</p><p> 在这篇文章中，我会给你一个更新（现在的东西更好）和我＆＃39; LL也告诉你我的新钻机，我跑了K3s。</p><p>   You&#39;ll also find a link to  my new workshop and eBook which has a Bill of Materials and step-by-step instructions for netbooting your own Raspberry Pis.</p><p>   您还可以找到一个链接到我的新研讨会和电子书，它具有用于Netbooting您自己的覆盆子PIS的材料和逐步说明。</p><p>  My original hopes were that I could save on the costs and management of 24 SD cards. These are notoriously unreliable due to their limited write cycles. When used in a Raspberry Pi cluster running  Kubernetes, the cards would be written to constantly meaning the cards will eventually fail.</p><p>  我的原始希望是我可以节省24个SD卡的成本和管理。由于其有限的写入周期，这些是众所周知的不可靠性。当在运行Kubernetes的Raspberry Pi群集中使用时，将写入卡片以不断意味着卡最终将失败。</p><p>  Given the bug with netbooting the variant of the RPi3 that I had, this was the only way to get it working</p><p>  鉴于NetBooting的错误，我所拥有的RPI3的变体，这是让它工作的唯一方法 </p><p> Even with automation, it&#39;s a time-consuming and manual process to flash, label and update 24 SD cards. I did actually go through this process and got all of the nodes functioning.</p><p>即使是自动化，它也是闪存，标签和更新24 SD卡的耗时和手动过程。我实际上已经完成了这个过程，并获得了所有节点运行。</p><p>   I ran Docker Swarm on the cluster originally, before Swarm fell out of fashion, and Kubernetes took over to bring clustering to containers. Swarm was always light-weight and fast on Raspberry Pi, and Kubernetes using kubeadm was always slow and difficult to use.</p><p>   我最初在集群上跑了船坞群，在群体脱离时尚之后，Kubernetes接过到将集群带到容器。 Swarm总是轻轻且快速地在覆盆子pi上，使用Kubeadm的Kubernetes总是缓慢而且难以使用。</p><p> Fortunately  Darren Shepherd came up with a novel idea of taking way the things he didn&#39;t want in Kubernetes and created a &#34;distro&#34; called  K3s (3 is less than 8).</p><p> 幸运的是，丹伦牧羊人提出了一种新颖的想法，以便在Kubernetes中采取他没有的东西，并创造了一个＆＃34;发行版和＃34;被称为K3s（3小于8）。</p><p> Where  kubeadm created a headache for Raspberry Pi, K3s made things simple with an easy boostrap, low resource requirements and a single binary for distribution and updates.</p><p> 如果Kubeadm为Raspberry PI创建了头痛，K3S将简单的东西具有简单的Boostrap，资源要求，以及用于分发和更新的单个二进制文件。</p><p> Given how much I&#39;d liked the Docker experience of &#34;docker swarm init&#34; and &#34;docker swarm join&#34;, I decided to re-create a similar experience for K3s in the  k3sup tool.</p><p> 鉴于我和＃39多少; D喜欢＆＃34; Docker Swarm Init＆＃34;和＆＃34; Docker Swarm加入＆＃34;我决定在K3SUP工具中重新创建类似的K3s的类似体验。</p><p> k3sup installs K3s over SSH and also makes creating a multi-server configuration easier through CLI flags.</p><p> K3SUP通过SSH安装K3S，并通过CLI标志更轻松地创建多服务器配置。</p><p>  Conceptual workflow showing the  install and  join commands run with a hostname or IP address over SSH.</p><p>  概念性工作流显示安装和加入命令使用ssh的主机名或IP地址运行。 </p><p>  I was helping the team at  Equinix Metal get their Open Source provisioning software  Tinkerbell ready for general use. That meant going through examples to check that they worked, building new examples and giving feedback on the developer- and user-experience.</p><p>我在Equinix Metal上帮助团队获得他们的开源供应软件Tinkerbell准备好使用。这意味着通过示例来检查他们的工作，构建新示例并提供有关开发人员和用户体验的反馈。</p><p> As part of the project I wrote up a feature-length article for  The New Stack to link the ideas of Cloud Native computing (a relatively new and trendy area) to bare-metal provisioning (something which has used the same basic tools for 20-25 years).</p><p> 作为项目的一部分，我为新堆栈编写了一个特征长度物品，以将云本机计算（相对新的和时尚区域）的想法链接到裸金属配置（使用相同的基本工具20  - 25年）。</p><p> My post  Bare Metal in a Cloud Native World also helped me refresh my own memory on TFTP, DHCP and on NFS.</p><p> 我在云天主世界中裸露的金属也帮助我在TFTP，DHCP和NFS上刷新自己的内存。</p><p>   One of the other things I built out for the client was a GitHub repository collecting other Open Source awesome baremetal projects:  awesome-baremetal</p><p>   我为客户建立的其他一件事是一个GitHub存储库，收集其他开源令人敬畏的aremetal项目：令人敬畏的 -  aremetal</p><p> As I was kicking the tires with Tinkerbell and testing out netbooting with a few Intel NUCs, my interest in the Raspberry Pi got stirred again. With the popularity of  K3s and my  K3s bootstrapping tool k3sup (&#39;k3sup&#39;), it seemed like a good time to revisit the problems I&#39;d had in 2017.</p><p> 当我用Tinkerbell踢出轮胎并用几个英特尔NUCS测试NetBooting时，我对覆盆子PI的兴趣再次激动。随着K3S和我的K3S引导工具K3SUP（＆＃39; K3SUP＆＃39;）的普及，它似乎是在2017年重新审视问题的好时机。</p><p>  In 2021, I wanted to take what I&#39;d learned during the previous year and bundle it up into a workshop that anyone could follow to access netbooting. It took me about two weeks to fully understand, document, automate and test the setup.</p><p>  在2021年，我想采取我在上一年中学到的内容，并将其捆绑成一个人可以追随访问NetBooting的研讨会。我花了大约两周时间来完全理解，文件，自动化和测试设置。</p><p> Whilst you can spend a lot of money here, I was fortunate to have an old PC I could use as a server, and the kit that BitScope had sent me. Note: the 2GB Raspberry Pi only costs 35 USD now, and you only really need one to try this out.</p><p> 虽然你可以在这里花很多钱，但我很幸运能拥有一个旧的电脑，我可以用作服务器，而Bitscope发给我的套件。注意：2GB覆盆子PI现在只需花费35 USD，您只需要一个尝试速度。 </p><p> For the initial configuration I used an Intel NUC as the netbooting server with a four Raspberry Pi 4s with 2GB of RAM each. That would be enough to run Kubernetes and a few workloads like  OpenFaaS.</p><p>对于初始配置，我使用Intel NUC作为NetBooting服务器，其中包含四个覆盆子PI 4S，每个RAM为2G。这足以运行kubernetes和一些像OpenFaas的工作负载。</p><p> I used the official 32-bit Raspberry Pi Operating System which supports PXE booting. Ubuntu 20.04 (Focal Fossa), a 64-bit Operating System also works with some modifications and is needed if you want to run a project that is only made available for 64-bit Operating Systems. The Raspberry Pi is capable of running both, but the 32-bit OS is better supported and understood by the community.</p><p> 我使用了官方32位覆盆子PI操作系统，支持PXE引导。 Ubuntu 20.04（焦点FOSEA），64位操作系统也适用于某些修改，如果要运行仅适用于64位操作系统的项目，则需要进行一些修改。 Raspberry PI能够运行两者，但是社区最好支持和理解32位操作系统。</p><p> After assembling the hardware, the process involves flashing a new firmware to each node, setting up a boot order, configuring a server with TFTP, NFS, a DHCP server and IP forwarding to act as a router.</p><p> 组装硬件后，该过程涉及到每个节点闪烁新固件，设置引导顺序，配置具有TFTP，NFS，DHCP服务器和IP转发的服务器，以充当路由器。</p><p>  I flashed each of the Raspberry Pis using the same SD card, then I could close the case and take a note of each MAC address and serial number for later on.</p><p>  我使用相同的SD卡闪烁了每个覆盆子PI，然后我可以关闭案例并记下每个MAC地址和序列号的序列。</p><p> This is the network topology, where everything runs in its own subnet, on a separate LAN and switch.</p><p> 这是网络拓扑，其中一切都在其自己的子网中运行，在一个单独的LAN和Switch上。</p><p>   Once you have everything configured, it&#39;s then a case of picking a case or enclosure to host your nodes.</p><p>   一旦您配置了所有内容，它就＆＃39; s然后选择案例或机箱以托管您的节点。</p><p> BitScope had sent me a newer version of their product called the  Cluster Blade - this time just for 8 nodes. It was aimed at edge computing and could be rack-mounted. Do not confuse this with the previous generation product called &#34;The BitScope Blade&#34;, which is designed for Raspberry Pi 3.</p><p> Bitscope已向我发送了一个较新版本的产品，称为群集刀片 - 这次只是8个节点。它的目标是Edge Computing，可以安装架。不要将此与上一代称为＆＃34; Bitscope Blade＆＃34 ;,为覆盆子PI 3设计。 </p><p> They also kindly sent over an additional 4x nodes for me so that I could fully populate the cluster with 8 nodes.</p><p>他们还友好地向我发送了额外的4x节点，以便我可以用8个节点完全填充群集。</p><p>  This gave me a total of 40GB of RAM and 32 CPU cores. My netbooting server also had a 500GB NVMe installed and shared for NFS, so there was plenty of space available too.</p><p>  这给了我共有40GB的RAM和32个CPU核心。我的NetBooting Server还有一个500GB的NVME为NFS安装并共享，因此也有很多空间。</p><p> With each of the nodes running, I observed around 30-31 Watts of power being drawn through the power supply. The 24-node RPi3 cluster drew ~ 21 Watts, so considering the increase in I/O speed and RAM per node, this seems reasonable.</p><p> 随着每个节点运行，我观察到通过电源绘制大约30-31瓦的功率。 24节点RPI3群集绘制〜21瓦，因此考虑每个节点的I / O速度和RAM的增加，这似乎是合理的。</p><p>  The use-case that BitScope see for these racks is where customers want to move off AWS EC2 and onto their own private cloud, which they can run on-premises or at the edge at a customer site.</p><p>  BitScope看到这些机架的用例是客户想要从AWS EC2和自己的私有云移开，它们可以在客户站在房地或边缘处运行。</p><p> If an application already runs in a container, then it shouldn&#39;t take too much work to port it over to K3s. One of the tricky parts is in the ecosystem, and making sure that everything that needs to run is available for an Arm CPU.</p><p> 如果应用程序已经在容器中运行，那么它就应该＆＃39; T取得太多的工作以将其移植到K3s。其中一个棘手的部分位于生态系统中，并确保可用于ARM CPU的所有需要​​运行的东西。</p><p>  Things are much better than they were in 2017, with the following key components available with Arm support: cert-manager, ingress-nginx, Postgresql, OpenFaaS, NATS, Prometheus, Docker registry, Grafana, Minio, Portainer, .NET Core, Node.js, Python 3, Go and many others. If you&#39;re a Kubernetes or K3s user, then you may also find  the arkade tool useful for discovering and installing apps with a single command line.</p><p>  事情比2017年的事情要好得多，带有ARM支持的以下主要组件.js，python 3，去做许多其他人。如果您＆＃39;重新kubernetes或k3s用户，那么您还可以找到有用的Arkade工具，可用于使用单个命令行发现和安装应用程序。</p><p>  People often ask me about storage. Many modern microservices are built to be stateless, and not to need to read or write from a disk, but you may need underlying object storage or a SQL database. That is where I tend to need persistent storage when working with OpenFaaS functions.</p><p>  人们经常问我关于存储。许多现代微服务都是无状态的，而不需要从磁盘读取或写入，但您可能需要底层对象存储或SQL数据库。这就是我在使用OpenFAAS功能时倾向于需要持久存储的地方。 </p><p> Fortunately, K3s comes with a storage driver that can use the local disk of the node and is called  Local path provisioner. There are other options available such as  OpenEBS and  Longhorn, but since we already have NFS in place, we may as well use the  NFS volume provisioner.</p><p>幸运的是，K3S附带一个存储驱动程序，可以使用节点的本地磁盘，并称为本地路径配置程序。有其他选项可用，如OpeneB和Longhorn，但由于我们已经有了NFS，我们也可以使用NFS卷配置器。</p><p>  Some people are content with having no Ingress to their clusters at all, but I&#39;m not one of those people. If I need to expose a Kubernetes LoadBalancer, then I want it to have a public and accessible IP address. For that reason I built the  inlets-operator, a Kubernetes controller that can provision a VM and then create a network tunnel to enable TCP or HTTPS traffic to enter the cluster from behind NAT, firewalls and captive portals.</p><p>  有些人是内容，没有进入他们的集群，但我不是那些人之一。如果我需要公开Kubernetes LoadBalancer，那么我希望它有一个公共和可访问的IP地址。因此，我构建了Inlets-Operator，一个Kubernetes控制器，可以配置VM，然后创建网络隧道，以使TCP或HTTPS流量能够从NAT，防火墙和俘虏门户中输入群集。</p><p>    Loosely defined, GitOps (coined by  Alexis Richardson) is storing deployment configuration in a Git repository for continuous deployment and is very much in vogue in 2021.</p><p>    松散定义，GITOPS（由Alexis Richardson创建）在GIT存储库中存储部署配置以进行连续部署，并且在2021中非常流行。</p><p> Johan Siebens wrote up a blog post showing how ArgoCD can be used to bring GitOps to one or more Raspberry Pi clusters, or a fleet of clusters.  ArgoCD for your private Raspberry Pi k3s cluster</p><p> Johan Siebens写了一个博客文章，显示了Argocd如何用于将GITOPS带到一个或多个覆盆子PI集群，或群集群。 ARGOCD为您的私人覆盆子PI K3S集群</p><p> Rancher&#39;s Fleet project (another one of of Darren&#39;s inventions) is designed to manage  fleets of up to 1 Million clusters.</p><p> 牧场主＆＃39;舰队项目（另一个Darren＆＃39; Siling）旨在管理高达100万集群的车队。</p><p>  Whatever I said about netbooting in 2017 is still large correct apart from one thing. It is now much more reliable and easier than ever to get started with, whether you have one or 100 Raspberry Pis.</p><p>  无论我在2017年对Netbooting说什么仍然是大的，除了一件事。无论您有一个或100个覆盆子PI，它现在都比以往任何时候都更可靠和更容易。</p><p> So however many Raspberry Pis you have, booting over the network means you can quickly provision and manage your nodes, even if they are just running PiHole, Plex, or a Ghost blog. Removing the SD cards makes the filesystem faster, and more reliable.</p><p> 因此，您拥有许多Raspberry PIS，通过网络引导意味着您即使只是运行Pihole，Plex或Ghost博客，也可以快速配置和管理您的节点。删除SD卡使文件系统更快，更可靠。 </p><p> It should be noted that a local NVMe over USB3 is faster, by a large margin, however it is also much more costly to scale 8x NVMe drives plus their caddies, vs. one NVMe in an old PC or server that you may already own.</p><p>应该指出的是，通过大幅度，um3上的本地NVME是更快的，但是，在可能已经拥有的旧PC或服务器中，将8倍的NVME驱动器加上其CADDIES，旧的PC或服务器中的CADDIES更昂贵。</p><p> Let me leave you with some resources and further links so that you can keep on learning.</p><p> 让我留下一些资源和进一步的链接，以便您可以继续学习。</p><p>  Is there something I didn&#39;t cover? It may be included in my workshop, or you can  reach out to me over Twitter if you already have a copy.</p><p>  有什么我没有覆盖的东西＆＃39;它可能包含在我的工作室中，或者如果您已经有副本，您可以通过Twitter联系到我。</p><p> If you&#39;d like to build your own private cloud, or just learn more about networking, you can pick up  my eBook or video workshop package with 30 USD off until 9th April.</p><p> 如果您喜欢建立自己的私有云，或者只是了解有关网络的更多信息，您可以拿起我的电子书或视频工作室套餐，直到4月9日。</p><p>   Would you like to learn more of the journey over the past 5 years of Docker and Kubernetes on Raspberry Pi? Are you curious about the costs and the real-life use-cases?  The Past, Present, and Future of Kubernetes on Raspberry Pi</p><p>   您想在过去5年的覆盆子PI上的Docker和Kubernetes中了解更多的旅程吗？你对成本和现实生活用例感到好奇吗？在覆盆子pi上的过去，现在和未来的kubernetes</p><p> Would you like to try booting your Raspberry Pi from a local disk?  Upgrade your Raspberry Pi 4 with a NVMe boot drive</p><p> 您想尝试从本地磁盘启动raspberry pi吗？使用NVME启动驱动器升级覆盆子PI 4</p><p> Want to try K3s? You can do so with an SD card in around 15 minutes with my  K3s walk-through</p><p> 想尝试k3s？您可以在大约15分钟内使用SD卡进行此操作，我的K3S步行 </p><p>  Learn how to deploy and run self-hosted, open-source serverless functions and automate your workflows with Node.js</p><p>了解如何部署和运行自托管，打开源无服务器功能，并使用Node.js自动化工作流程 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.alexellis.io/state-of-netbooting-raspberry-pi-in-2021/">https://blog.alexellis.io/state-of-netbooting-raspberry-pi-in-2021/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/raspberry/">#raspberry</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/k3s/">#k3s</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>