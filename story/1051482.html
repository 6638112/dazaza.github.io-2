<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>解码的GNU Coreutils：探索GNU公用事业的设计 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">解码的GNU Coreutils：探索GNU公用事业的设计 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-11 01:02:39</div><div class="page_narrow text-break page_content"><p>这是一个长期的项目，用于解码版本8.3中的所有GNU Coreutils。</p><p>  此资源用于探索命令行实用程序设计的新手程序员。它最好用作提供有用背景的伴奏，同时阅读您可能感兴趣的实用程序的源代码。这不是用户指南 - 有关使用这些实用程序的说明，请参阅适用的人页面。</p><p>  状态：完成！ 阶段1 [完成]  - 每个实用程序都有一个专用页面讨论命名空间和执行概述。</p><p>  第2阶段[完整]  - 扩展了关于重要设计决策和算法的探讨。从UNIX和早期COREUTILS进行跟踪效用谱系。将内容移植到更协作的内容。增强源演练以更有用的东西。创建源代码Evolution Visualizer</p><p>  阶段无限线通过线路代码行演进，每用实用程序将在很长一段时间内完成。 github repo可用于收集逐行的笔记。由于一致反馈，读者对高级讨论更感兴趣，这段部门被推迟。</p><p>      I＆＃39; ll将实用程序页面链接到顶部。单击命令名称有关解码该实用程序的详细页面的命令名称。每个页面都可以使用讨论，源代码和演练。粗体公用事业已被扩展为阶段2.享受！</p><p>    GNU Coreutils有其披风。许多这些公用事业都在进行30岁，多年来包括许多人的修订。以下是阅读代码时要记住的一些事情： 微小的程序 - 这些实用程序很小，（大多数）单源文件程序，旨在做一件事并做得好。它们不是设计长寿或超越其角色。因此，我们看到经常考虑的设计＆＃39;糟糕的练习＆＃39;如： </p><p>了解POSIX  - 从实用程序语法准则开始。通常，POSIX通过定义适当的输入和输出来支持互操作性，但留下＆＃39;工作＆＃39;实施。虽然GNU Coreutils可能无法严格符合POSIX，但许多想法都是根本的：权限位，UID / GID，环境变量，退出状态以及大约3718页的更多琐事。</p><p>  外部帮助 - 可移植性是一个复杂的问题，Coreutils依赖于相关项目的额外帮助：Gnulib。几乎每个实用程序都包括来自Gnulib的功能，专门为各种系统中许多地方使用的常见问题而设计 - 无需重新发明轮子。</p><p>  从shell启动 - 核心实用程序希望从Bash，Zsh，Ksh等壳牌等支持。 Shell fors / clones进入实用程序，通过参数，设置环境，通过管道重定向I / O，并保留退出值。</p><p>  三个家庭 -  GNU Coreutils最初是壳牌，文本和文件实用程序的三个不同的套餐。同一类型中的实用程序共享许多相同的设计模式。</p><p>            这是框架i＆＃39; ll用于组织每个实用程序的解码。我们＆＃39; LL看到每个人都有一个独特的变体，从几行到数千行。 D分为三组中的变体：琐碎，包装器和完整的公用事业</p><p>  琐碎的公用事业琐碎的实用程序有一个唯一的设置阶段，它定义了几条线的宏。然后＆＃39;包括＆＃39;宏强制特定流量控制的另一个实用程序的来源。示例包括：arch，dir和vdir</p><p>  包装工具包装器执行设置和解析命令行选项，该选项将直接作为参数传递给syscall。 Syscall的结果是该实用程序的结果。这些公用事业公司自行处理。示例包括：链接，whoami，hostId，logname等 </p><p>全部公用事业上图显示了用于完整实用程序的设计。设置阶段，选项/参数解析阶段和执行。执行意味着处理输入数据，并且可以沿着处理更多数据的方式调用许多SYSCALL，直到完成。大多数公用事业都属于此类别。</p><p>      让＆＃39;我们经历了许多公用事业共享的最常见的想法。事先知道这些概念应该加快代码阅读。</p><p>      initialize_main（＆amp; argc，＆amp; argv）; set_program_name（argv [0]）; setlocale（lc_all，＆＃34;＆＃34;）; BindTextDomain（包，Localedir）; 侄子（包）; atexit（close_stdout）;</p><p>  该序言解决了一些行政问题;其中最重要的是国际化和分配退出行动。我＆＃39; ll下面穿过这些线条。这条线不会影响效用的具体行动。</p><p>    曾经想过为什么指挥线公用事业公司在过去的40年里有同样的外观和感觉？您可以感谢getopt工具集。你需要知道的最小值遵循coreutils是：</p><p>  命令行选项可以是＆＃39;短＆＃39;和＃39;长＆＃39;，分别以（ - ）和（ - ）为前缀。当长选项使用结构时，短选项定义为字符串。</p><p>  短选项使用1）如果选项没有参数，则只有一个字母，2）对于强制参数，一个单个冒号（:)，和（：:)用于可选参数。例如，kill的短选项字符串是：lln：s：t。这说L，L，T没有参数，但是n和s需要一个论点。 </p><p>UNIX的系统通常支持FTS库以轻松管理通过文件系统的步行。基本的手摇细节是：</p><p>  树由通过在路径上调用fts_open（）或xfts_open（）构建的FTS结构表示。</p><p>      ftsent-＆gt; fts_info字段描述了条目。它经常用于决定如何处理该条目。</p><p>    Coreutils经常通过包装纸和借口来调用Syscalls，超出Libc提供的那些。许多人通过gnulib项目链接。</p><p>    libc提供了许多文本编写功能，例如fwrite（），用于缓冲流访问，以及Write（）Syscall包装器。 Coreutils带来了Full_Write（）等非标准函数。除非存在困难故障，否则Full_Write（）函数连续重试写入。它依赖于safe_write（）来重试跨中断的写入（）syscall。其他写入相关的助手仅在单个实用程序中使用。如DD，CWRITE（）中的IWRITE（）。我＆＃39; ll讨论公用事业中的人。</p><p>      使用（）函数显示包含输入参数，其含义和适当语法列表的实用程序的帮助。</p><p>  _（）函数真的是系统中定义的宏，它在gnu getText.h中将简单的语言支持功能绑定到母语支持功能。如果它＆＃39; s字符串意味着向用户展示，它可能会用这个函数包裹。 </p><p>#include＆＃34; system.h＆＃34;此标题定义了系统相关的MarcoS，变量和有用的非标准函数。它提供＆＃39;翻译和＃39;必要的是让Coreutils尽可能多地构建。总的来说，这个标题是缺乏严重组织的角落案件的拼凑 - 但它有效！此标题中包含许多C标准和POSIX标头，例如：unistd.h，limits.h，ctypes.h，time.h，string.h，errno.h，stdbool.h，stdlib.h，fcntl.h，fcnt.h ，inttypes.h和locale.h。</p><p>  #define program_name＆＃34; cat＆＃34;定义实用程序的官方名称。用于＆＃39;版本＆＃39;查看。</p><p>  #define authors perfect_name（＆＃34;理查德M. Stallman＆＃34;）定义实用程序的作者。用于＆＃39;版本＆＃39;查看。</p><p>  emit_try_help（）在输出失败后打印帮助建议。包括与在线文档的链接。这将出现在使用开始（）</p><p>  emit_ancillary_info（program_name）在命令特定输出后打印常见的额外帮助信息。包括与在线文档的链接。这似乎接近使用结束（）</p><p>  退出（状态）Syscall将使用给定状态结束执行。这在使用结束时出现（）</p><p>  initialize_main（＆amp; argc，＆amp; argv）用于VM的特殊处理程序强制内置通配符扩展。这是对大多数其他操作系统的定义 </p><p>set_program_name（argv [0]）;使用第一个输入参数保存基本程序名称。丢弃ARGV的路径分量[0]。</p><p>        atexit（close_stdout）;在程序结束时注册Close_stdout函数以进行调用。除了关闭外，这刷新了缓冲蒸汽。</p><p>  if_lint（某事）;如果使用包括宫内内的代码，请抑制GCC警告如果使用LINTER。通常这是nop</p><p>    在Coreutils来源中有一些习语可能是初学者不熟悉的。 ！双重惊吓点正是您所看到的，双重无需操作。目的是强迫一个霸勃的价值。它常用于函数返回值的标志。</p><p>  do {...} while（0）非循环通常包含多语句宏，以确保在预处理器替换后正确令牌化。核心用例是结果： 请注意，在C代码中宏后手动添加半冒号缺乏半冒号。</p><p>      Coreutils等活动项目总是在不断发展。通常，更新继续三个弧：</p><p>  项目范围内更改 - 这些是对所有公用事业的基础架构和依赖性的更大规模。一些亮点包括：  1995年：通过GNU GetText项目增加了母语支持。这在大多数文本输出线周围并入了_（）宏。国际化支持于1996年扩展，将几个初始化者添加到主（）中，如前一节所述 </p><p>2016：Die（）宏将大多数Exit（）和错误（）函数替换为故障路径的函数，以避免编译器警告</p><p>  实用程序特定更新 - 许多更改仅适用于子集或单个实用程序。这些案例通常分为三类：错误修复，新功能和优化。每种类型的示例包括：</p><p>  BUG：加入，排序和UNIQ命令易于溢出攻击，直到2016年修补</p><p>  年度维护 - 至少，所有公用事业公司的版权年份都会更新。另一个管理变更包括更新FSF地址。这些变化对执行没有影响</p><p>  对于好奇的读者，我包括一个＆＃39;进化＆＃39;在每个实用程序页面中的视图以可视化实用程序随时间的变化。</p><p>    有兴趣的人应该在GNU项目页面上阅读所有内容。拒绝特征的贡献指南和列表尤为开悟。最后，通过邮件列表档案来了解最有价值的贡献。在编写任何代码之前需要考虑的很短的清单：</p><p>          Veteran开发商寻找偷看这些公用事业公司的理由可能希望在这里开始旅程。 </p><p>最短的实用程序：假（2行 - 与Arch，Dir和Vdir绑定）最短独立实用程序：真实（80行） - 第一个版本几乎是最低的C程序！最长的效用：LS（5308线）</p><p>  许多公用事业在20世纪70年代追溯到研究UNIX。甚至进一步回到多个</p><p>  最古老的精神祖先是CTSS listf命令（〜1963）。谢天谢地短暂到LS DD实用程序的独特语法是请联想到OS / 360职能控制语言（20世纪60年代初）。</p><p>        DF实用程序比du更快。前者使用设备元数据，而后者检查所有文件</p><p>  cksum包括两个入口点，一个用于正常操作，一个用于生成CRC-32表</p><p>        我的个人最不使用的公用事业是Tsort和PTX  - 我在20世纪90年代后期测试了一次</p><p>            好的项目！我如何捐出以支持这项努力？谢谢你的想法;不幸的是，我没有被配置为获得个人捐款。但随时与自由软件基金会分享您的时间或金钱 - 以及所有合作努力发生的地方！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://maizure.org/projects/decoded-gnu-coreutils/">http://maizure.org/projects/decoded-gnu-coreutils/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/gnu/">#gnu</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/实用程序/">#实用程序</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1051467.html"><img src="http://img2.diglog.com/img/2021/3/thumb_481430e2c39ab7201be7b66d50fa01a3.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1051467.html">他妈的用户界面设计，我发誓 </a></div><span class="my_story_list_date">2021-3-11 0:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1051378.html"><img src="http://img2.diglog.com/img/2021/3/thumb_db7b7d5fdca7718adffb921a98d87da5.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1051378.html">Chrome OS 89带来了Android控件，新图标设计和“快速答案” </a></div><span class="my_story_list_date">2021-3-10 23:53</span></div><div class="col-sm"><div><a target="_blank" href="/story/1051370.html"><img src="http://img2.diglog.com/img/2021/3/thumb_11c8100db7bbaeb75af82372594aad8c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1051370.html">特斯拉：“全自动驾驶测试版”并非专为全驾驶而设计 </a></div><span class="my_story_list_date">2021-3-10 23:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1051279.html"><img src="http://img2.diglog.com/img/2021/3/thumb_73cd8e11bb3f5ddaf485972e415c3447.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1051279.html">音乐软件和不良界面设计：Avid的Sibelius（2018）[视频] </a></div><span class="my_story_list_date">2021-3-10 21:42</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>