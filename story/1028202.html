<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>易趣的Stratix V加速卡</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">易趣的Stratix V加速卡</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-12 07:08:50</div><div class="page_narrow text-break page_content"><p>几周前，@rombik_su在Twitter上指出了eBay上一款非常便宜的FPGA加速卡。该电路板包含一个专有的Samtec板对板连接器，很可能承载电源、PCI Express和辅助信号(JTAG、IPMI到BMC等)、两个隐藏在散热片下面的QSFP框架DDR3和一个大型FPGA。</p><p>我对所有与FPGA相关的东西都充满热情，而且冠状病毒锁定限制了有趣的事情的数量，我决定买下这块电路板。这种估价工具很容易就要几千美元，而40美元是非常划算的。</p><p>在等待董事会到来的同时，我做了一些初步调查。易趣上的描述相当隐晦。清单的标题包括了黑板上标签上的所有文字，包括指示强制空气通过黑板的方向的标签。</p><p>最有成效的线索之一是董事会上的微软标签。几年前就广为人知的是，微软正在使用FPGA加速Bing搜索，这可能是服务器中使用的主板之一。</p><p>请记住，微软使用Altera(现在的Intel PSG)，而且那是几年前的事了，很可能该卡包含一个Stratix V FPGA。</p><p>Google上的第一个链接(或者我应该用必应吗？FPGA会意识到我在寻找关于他们的信息吗？)。微软Catapult Stratix v&34；提供了一些概念上类似的卡片，但并不完全相同。</p><p>本文还提到了广泛使用的OpenCompute服务器，它可以提供有关Samtec连接器上的引脚的一些信息。由于OpenCompute项目标准化的夹层卡格式繁多，而且找到匹配的格式也不是一件容易的事，所以我决定将这项任务留待以后完成。</p><p>进一步挖掘搜索结果，我还能够找到另一张卸下散热片的电路板照片。</p><p>去掉了FPGA上的标记，但我们已经知道它是Stratix V，并且从以前的文档中预计会有一些事情，例如，5个DDR3芯片组合成9个芯片，用于72位DDR3数据宽度)。</p><p>我在这张图片中发现的有趣之处是右上角有一个闪存(Micron 25Q256)，这意味着FPGA的映像最有可能存储在主板上，而不是在启动时通过连接器下载。也有可能是通过协议进行配置，并且只有基本映像存储在Flash中。</p><p>然后有一天，董事会终于来了。这块板与前面提到的文章中的描述相符。</p><p>在这一点上，是时候开始试验电路板了。FT232H似乎由USB总线电压供电：J3的引脚1连接到FT232H的引脚40(VREGIN)。这就是为什么我决定先从USB开始。使用FT232H的数据表，很容易确定连接器上的引脚分配。我不想直接焊接在连接器引脚上，因为我想在将来做一条合适的电缆。</p><p>在这一点上，我可以开始尝试反向工程连接器引脚。我设法找出了以下联系：</p><p>输入电源：有几个管脚连接到大型MOSFET的漏极。我还假设电平为12V，因为PCIe卡很常见。</p><p>连接器附近有16对交流耦合电容器。PCIe标准要求在发送端使用电容器，因此我假设这是PCIe_Tx。由于不知道确切的车道编号，我决定用字母而不是数字来列举它们。</p><p>一些引脚连接到连接器上方的电路-我已经注释了这些引脚，但现在我不清楚用途是什么。我把那些大头针注释为AUX。</p><p>我已经连接了Q12(FDMS0310AS)漏极侧的12V，这也为Samtec连接器上的PU12和+12V引脚供电。然而，功耗仅为3 mA，并且MOSFET处于闭合状态。</p><p>我找不到任何有关PU12(L536FCD)的信息。我假设它是一种限流保护，测量通过0.01欧姆并联电阻的电流，并控制Q12的栅极引脚。</p><p>为了从字面上绕过这个问题，我决定也在Q12的另一边连接12V。这产生了一些结果：功耗提高到695 mA，这是人们对这种电路板的预期，LED也变亮了。</p><p>在电路的各个点上，我还可以测量人们期望在这样的电路中找到的所有电压：</p><p>散热片覆盖了电路板顶侧的大部分，包括用于FPGA配置的闪存。然而，使用示波器探头仍然可以到达引脚8和9(分别为DQ1和DQ2)。</p><p>在电路板通电后，我们可以观察到FPGA在大约一秒钟内编程完成。这高于PCIe标准要求的100毫秒/200毫秒的限制，但在此自定义外形因子中，该值可能会有所不同。</p><p>板上的LED也由FPGA驱动，并保持亮起一秒钟，直到FPGA未被编程，这是FPGA从存储器配置的另一个指示。</p><p>电路板上的另一个存储器是一个128Kbit的小EEPROM，它可能存储MAC地址、序列号和其他类似信息。</p><p>非常有趣的是，SDA和SCL线路在一段时间后仍然保持低电平。可能根本不使用EEPROM，或者电路的某些其他部分正在将EEPROM接口状态机保持在复位状态。</p><p>在电路板通电的情况下，我可以测量连接器引脚上的电压。正如预期的那样，在16对差分对上，我可以检测到PCIerReceiver的偏置电压，约为0.7V。</p><p>一些辅助引脚有轻微的偏置，但这可能是由于旁路电阻和其他组件造成的。要完全了解这些别针的用途，还需要更多的调查。</p><p>插入QSFP电缆只会略微增加功耗。很明显，高速电路被禁用，很可能是因为内部寄存器配置，也不太可能是因为电缆不兼容，即电路板解析EEPROM并且不启用高速电路。</p><p>我已经探测了我认为是DDR3端接电阻的东西(在底部，在顶部第五个DDR3组件的另一侧)，没有观察到任何开关活动。DDR3控制器似乎一直处于重置状态。</p><p>第一次调出过程相当成功；我已经设法打开电路板而没有损坏它，并弄清楚了连接器的基本引脚。</p><p>下一步，我计划调查OpenCompute网站，如果存在描述连接器引脚的文档。仍有待确定的是参考时钟和来自连接器的使能信号。</p><p>最终，我计划生产一种小型PCB，可以将这块电路板插入普通的PCIe卡插槽。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://j-marjanovic.io/stratix-v-accelerator-card-from-ebay.html">https://j-marjanovic.io/stratix-v-accelerator-card-from-ebay.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/stratix/">#stratix</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fpga/">#fpga</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>