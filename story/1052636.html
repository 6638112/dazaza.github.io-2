<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Rails应用程序上添加一个黑暗主题到Ruby </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在Rails应用程序上添加一个黑暗主题到Ruby </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-16 09:47:40</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/77bd155648a2c2af8403eb5531f75ba0.png"><img src="http://img2.diglog.com/img/2021/3/77bd155648a2c2af8403eb5531f75ba0.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>使用SCS和资产管道在Rails应用程序上添加一个黑暗的主题替代品的替代品。</p><p>  黑暗主题最近引起了很多关注，因为苹果或谷歌等大多数操作系统部署的企业 -  IOS，MacOS，Android  - ，替代默认接口颜色的替代品主要是光线。</p><p> 微软遵循了趋势，并在风OWS上添加了相同的选择。虽然允许人们在晚上使用他们的电脑或移动而不会伤害他们的眼睛是一个很好的功能，但这种实现是不完整的。实际上，为了使这个功能真的很闪耀，使操作系统接口黑暗是不够的。开发人员必须遵循规则，并将一个黑暗的主题添加到他们的软件上。否则，这是毫无意义的。</p><p> 更重要的是，Web开发人员还要考虑以否则为他们的网站添加一个黑暗的主题选项，无论您的操作系统接口都很亮，网站仍然会像以前一样。如果，就像谷歌的主页一样，它充满了白色而且非常明亮，如果你的OS接口设置为黑暗，那就太糟糕了。</p><p> 幸运的是，由于CSS规范中的“Preves-Color-Spection”属性，很容易快速创建一个暗版本的网站。</p><p>  CSS媒体特征更喜欢 - 颜色方案可以采用两个值：“光”或“暗”。它允许Web开发人员在用户的操作系统接口设置为默认值（大多数时间，“暗”一个）或“黑暗”之后，调整其网站的设计。</p><p> 例如，如果我们想将我们网站的背景更改为黑色，如果用户在其操作系统上启用了黑暗模式选项，则可以简单地执行以下操作： </p><p>/ * style.css * // *如果操作系统在黑暗模式* / @media（更喜欢 - 颜色方案：暗）{body {背景 - 颜色：＃000！重要; }}</p><p> 这是非常方便的，因为我们现在可以检测用户的接口模式并调整我们网站的颜色来匹配它。</p><p> 更有趣的是，此CSS功能将立即检测OS接口更改。例如，在MACOS上，您可以安排操作系统自动在日落时从灯切换到黑暗。与日出相反。</p><p> 每个应用程序都会改变其颜色。这很酷。如果在浏览使用更喜欢颜色方案的网站时发生此开关，它将自动使用深色，而无需刷新页面。</p><p>   对于我的大多数Web项目，我喜欢在Rails上使用Ruby进行快速原型设计，用于在生产中部署的实际项目。这是Whaththemovie.com的情况，电影测验游戏，人们上传电影快照，另一名玩家必须猜测图像所拍摄的电影。</p><p>  如果您有兴趣，我对此项目进行了两篇文章，我解释了我如何创建数据集和AI模型，以建议电影快照包含或属于的标记。</p><p> 与许多其他Rails应用程序一样，它大量使用资产管道处理资产 - 图像，JavaScript，字体，样式表等。 </p><p>不幸的是，我们的设计非常过时，而不是现代 - 它来自2008年，从字面上开始。例如，我们的按钮源自图像，以在现在，您可以简单地使用线性渐变CSS函数来执行相同的功能，在一行！我的观点是：如果你的设计老了，它会更加困难，需要更多的工作。</p><p> 如果您使用例如CSS变量，您将看到创建黑暗模式并更快地更容易，因为您基本上只需更改这些变量的颜色，并且您就完成了。</p><p>  我们要做的第一件事是保留档案组织并尊重资产管道指南。因此，要创建我们的黑暗主题，我们将在应用/资产/样式表中添加一个名为DarkMode.scss的新文件。</p><p> 我们还必须确保我们的Rails应用程序现在将此文件和其内容集成到我们将在生产中的CSS文件中。为此，我们在应用/资产/样式表/ application.scs中添加了对我们新的SCSS文件的引用。</p><p>  确保在已包含其他所有内容之后，请务必终止SCSS文件。由于我们将更改或覆盖样式，因此在设置所有设置后添加黑暗主题是很重要的。</p><p> 现在是时候用一些深色的方式了解我们的网站！为此，我们将使用SCSS函数的组合，例如Mixin，包括HTML数据属性和Ruby Gem以保存和检索用户偏好。</p><p> 请参阅SCSS Mixin功能作为定义要在稍后重新使用的样式的方式，而无需维护许多版本的同一次。我们将创建一个名为“黑暗”的Mixin，它将包含任何使我们的元素，选择器，标识符，更暗的更改。 </p><p>/ *应用程序/资产/样式表/暗声。 @Media（更喜欢 - 颜色方案：黑暗）{@include黑暗; }</p><p> Mixin“暗”的内容将自动包含在所谓的部分中。这是介绍概念的愚蠢示例。</p><p> 现在，我们需要考虑如何处理用户真正想要的东西。每个可能的场景。</p><p>  在创建将自动遵循的网站的替代暗版本，而用户OS接口颜色可能不尊重用户真正希望的内容。</p><p> 例如，用户可能希望使用浅色的OS接口，但浏览网站并启用了暗主题。在相反的方向上同样：与其OS接口设置为黑暗的用户可能仍然希望浏览我们的网站与旧的光线。</p><p> 因此，我们有三种方案来处理和提供给用户的选项：</p><p> 自动模式：此选项描述了我们迄今讨论的。该网站将自动遵循用户OS接口颜色。如果OS接口设置为灯，则网站上的主题是光线。如果它是黑暗的，那么主题将是黑暗的; </p><p>轻质主题：此选项强制使用旧光主题，无论用户OS接口设置为何;</p><p> 黑暗主题：此选项迫使使用新的黑暗主题，无论设置为用户OS接口是否设置为。这是友好的，因为许多用户在提供了光和黑暗模式的操作系统上运行。因此，如果他们想使用黑暗的主题，这是唯一的方法。</p><p> 这是SCSS功能和HTML数据属性真正闪耀的位置。要处理这三种方案，我们将使用称为数据颜色模式的数据属性，可以采用三个值：“自动”，“光”或“黑暗”。我们将使用它，与Mixin结合，包括和更喜欢的颜色方案，为每个人提供这个黑暗的主题：</p><p> / *应用程序/资产/样式表/暗摩尔兹/ @mixin暗{/ *所有颜色/ css更改为使网站黑暗* /} / *当OS接口为Light * / @Media时强制暗模式（更喜欢-Color-scheme：light）{[数据 - 颜色模式=＆＃34;黑暗＆＃34;] {@include黑暗; }} / *遵循操作系统界面颜色或强制暗主题* / @Media（更喜欢 - 颜色方案：暗）{[数据 - 颜色模式=＆＃34;自动＆＃34;]，[数据颜色 - mode =＆＃34;黑暗＆＃34;] {@include黑暗; }}</p><p> 使用此代码段，我们现在处理三种可能的方案：如果用户对灯光设置为光线但是要使用黑暗主题等。我们现在必须让用户选择它喜欢的选择，保存，检索它并将其设置为HTML数据属性数据颜色模式。</p><p>  要在我们的网站上保持用户设置，我们使用Ruby GEM首选项。使用很简单，使用简单。我强烈推荐它。要将用户设置添加到存储，我们将此行添加到用户型号：</p><p>  使用这一行，我们将用户偏好存储为网站设计为“主题”，并将其设置为“自动”默认情况下。 </p><p>现在让我们编辑用户设置表单以添加更改主题的功能并保存用户选择：</p><p> ＃应用/视图/用户/设置.html.erb [...]＆lt; h2＆gt;外观＆lt; / h2＆gt; ＆lt; p＆gt;选择WTM如何了解您。设置主题首选项以遵循您的系统设置，或选择始终使用光线或暗主题。＆lt; / p＆gt; ＆lt; ul class =＆＃34; standard_form＆＃34;＆gt; ＆lt; li＆gt; ＆lt; div类=＆＃34;标题＆＃34;＆gt;主题＆lt; / div＆gt; ＆lt; div类=＆＃34;内容＆＃34;＆gt; ＆lt;％= f.radio_button（：prefers_theme，＆＃34; auto＆＃34;）％＆gt; ＆lt; =＆＃34的标签; user_theme_auto＆＃34;＆gt;默认为系统＆lt; / label＆gt; ＆lt;％= f.radio_button（：prefers_theme，＆＃34;光和＃34;）％＆gt; ＆lt; for =＆＃34的标签; user_theme_light＆＃34;＆gt;光＆lt; / label＆gt; ＆lt;％= f.radio_button（：prefers_theme，＆＃34;黑暗＆＃34;）％＆gt; ＆lt; =＆＃34的标签; user_theme_dark＆＃34;＆gt;暗＆lt; / label＆gt; ＆lt; / div＆gt; ＆lt; / li＆gt; ＆lt; / ul＆gt;</p><p>   最后要做的是在我们的主应用程序布局中添加我们的HTML数据属性数据颜色模式，并将其值设置为从数据库中检索的用户首选项，以便使我们的SCSS功能工作：</p><p>  我们利用安全导航运营商＆amp;在Ruby 2.3中介绍，处理当前访问者/用户未登录的情况。如果尚未登录，则会返回nil并将数据颜色模式值设置为“自动”。如果登录当前用户，它将检索其关于网站主题的首选项，并在数据属性中设置正确的值。</p><p>    由于我们的设计很古老，这种方法非常好，易于实施。不幸的是，它带来了一些奇怪的行为。实际上，SCSS和资产管道生成的CSS文件在我们的情况下非常大。</p><p> 似乎编译器需要在每个元素，选择器或标识符，数据属性的前面添加：</p><p> [数据 - 颜色模式=＆＃34;自动＆＃34;] ul.disclist li a，[data-color-mode =＆＃34;自动＆＃34;] .profile_info a，[data-color-mode =＆ ＃34;自动＆＃34;] .profile_user_links li a，[data-color-mode =＆＃34;自动＆＃34;] .thumb_overlay a span，[data-color-mode =＆＃34;自动＆＃34;] Li.sotd H4a，[数据 - 颜色模式=＆＃34;自动＆＃34;] #online_users .footer_box a，[data-color-mode =＆＃34;黑暗＆＃34;] ul.disclist li a， [数据 - 颜色模式=＆＃34;黑暗＆＃34;] .profile_info a，[data-color-mode =＆＃34;黑暗＆＃34;] .profile_user_links li a，[data-color-mode =＆＃ 34;黑暗＆＃34;] .thumb_overlay a span，[data-color-mode =＆＃34;黑暗＆＃34;] li.sotd h4a，[data-color-mode =＆＃34;黑暗＆＃34;] #online_users .footer_box a {颜色：＃7c7c7c！重要; } </p><p>它会导致具有大量行生成的文件。虽然这对我们来说可能不是那么多问题，但它可能对你来说。除非我们早先谈论它，否则您的设计很好并使用CSS变量。在这种情况下，生成的代码将非常小，因为您只需要更改CSS变量值。</p><p> 即使我不推荐它，我发现了一种方法，通过将该值设置为“自动”或“黑暗”时，通过组合数据属性，找到了一种方法来优化编译的CSS文件。</p><p>  / * app /资产/ styleshss / darkmode.scss * / @mixin暗{} @media（prefers-color-scheme：light）{[data-color-mode * =＆＃34; d＆＃34;] {@include黑暗的; @Media（喜欢 - 颜色方案：暗）{[数据 - 颜色模式* =＆＃34; A＆＃34;] {@include黑暗; }}</p><p> 此技巧利用* =属性选择器，基本上说：如果数据颜色模式值包含字母“A”，则执行某些内容。由于“自动”和“黑暗”包含这封信，但不是“光”，它有效！</p><p> 我用[Data-Color-Mode * =＆＃34; D＆＃34;]的[Data-Color-Mode =＆＃34;暗＆＃34;]的[Data-Color-Mode =＆＃34;]。这种小方法导致去除超过400行。</p><p> 我发布在stackoverflow上，要求帮助优化它，而无需重新制作我的所有设计，但到目前为止，没有答案。如果您有任何想法，请分享它们！</p><p>  当您开始为您的网站制作黑暗主题时，您必须记住的东西是可访问性的。在暗中选择文本颜色时，在暗背景上读取文本没有什么比在暗背景上更痛苦的了。 </p><p>当您创建深模式颜色调色板时，请考虑它：文本是否可读？这两个元素之间的对比是否足够？</p><p> GitHub，最近发布了一个黑暗主题的网站，因为某些元素之间缺乏对比，对此受到了一些批评。</p><p> 幸运的是，Web内容可访问性指南（WCAG）有助于我们通过计算元素之间的对比度来选择正确的颜色。</p><p>   在AAA水平应该是目标的地方，AACHIVE AA已经很好。</p><p> 为了帮助我们计算元素之间的对比度，您可以使用浏览器的开发人员工具：</p><p>  如在Chrome上看到的，当您打开文本元素的颜色选择器时，可以看到与其背景的对比度和两个级别阈值。在此示例中，两个级别都受到尊重。</p><p> 如果您的浏览器没有这样的功能，则Webaim或CooloR等多个网站提供了一种方法来轻松计算两种颜色之间的对比度。 </p><p>如果没有那么多工作，我们就可以向我们现有的Ruby上添加一个黑暗的主题。 尽管没有Web开发人员或网络设计师，我们的小主题似乎似乎取得了一些成功：超过74％的活动用户默认启用它，它不包括启用“自动”的用户 自动将主题从“灯”切换到“暗”，反之亦然。  当您考虑它时，有关电影的网站，展示使用电影院的电影快照和周围的窗帘提供了有意义的，为用户提供了更好的体验。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://yann-defretin.medium.com/add-a-dark-theme-to-a-ruby-on-rails-app-898562d2b6cc">https://yann-defretin.medium.com/add-a-dark-theme-to-a-ruby-on-rails-app-898562d2b6cc</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ruby/">#ruby</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/rails/">#rails</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dark/">#dark</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1052572.html"><img src="http://img2.diglog.com/img/2021/3/thumb_01d715d232891852cc0acba5f8ba946f.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052572.html">Ruby中的一个编程谋杀魔法 </a></div><span class="my_story_list_date">2021-3-16 5:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1050863.html"><img src="http://img2.diglog.com/img/2021/3/thumb_993799b8fea41da52214e37551e2e3fd.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1050863.html">标准Ruby 1.0. </a></div><span class="my_story_list_date">2021-3-7 9:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1048454.html"><img src="http://img2.diglog.com/img/2021/2/thumb_30ba2dafe659b66092df7a85c3f2b45b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1048454.html">基本计算机游戏（移植到C＃，Java，JavaScript，Python，Ruby，VB.NET） </a></div><span class="my_story_list_date">2021-2-19 10:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/1047754.html"><img src="http://img2.diglog.com/img/2021/2/thumb_5cd12ff2c9feea7fd822acfacd34bef0.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1047754.html">学习Ruby：我喜欢的东西，Python遗忘的东西 </a></div><span class="my_story_list_date">2021-2-17 18:19</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>