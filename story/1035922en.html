<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>构建类似漫游，网络化，高度自定义的实时编辑器，第1部分Building a roam-like, networked, heavily-customized realtime editor, part 1</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Building a roam-like, networked, heavily-customized realtime editor, part 1<br/>构建类似漫游，网络化，高度自定义的实时编辑器，第1部分</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-22 23:02:20</div><div class="page_narrow text-break page_content"><p>Bi-directional networked tools like  roam-research and  obsidian are on the trend for a while now.  The idea behind them is not brand new, yet the much evolved web-based tech makes them possible.</p><p>双向网络工具（如漫游研究和黑曜石）目前处于流行趋势。它们背后的想法并不是崭新的，但是基于网络的技术的不断发展使它们成为可能。</p><p>  I record my building of  fiber-note in this series of dev posts, what I want to build is:</p><p>  我在这一系列开发文章中记录了我的fibre-note建筑，我要构建的是：</p><p> a highly-customized editor  enforce a custom schema to control the layout of the documents  say everything is a list item, there may be only text and tags in paragraph, etc.</p><p> 高度自定义的编辑器强制执行自定义架构以控制文档的布局，比如说所有内容都是列表项，段落中可能只有文本和标签，等等。</p><p>   I placed the source  here, which could be hosted by yourself. There’s even a configured deploy-to-heroku button for one-click hosting.</p><p>   我将源放在这里，可以自己托管。甚至还为一键式托管配置了“部署到heroku”按钮。</p><p>   I always use rails as my first choice for web projects, and the first code name for this project is  roam-on-rails, which is a bad joke since I’ve already got a project called  ruby on rust.</p><p>   我始终将Rails用作Web项目的首选，并且该项目的第一个代号是roam-on-rails，这是一个很不好的玩笑，因为我已经有了一个名为ruby on rust的项目。</p><p> I’m bad at this, so I just picked the word  fiber as a synonym for  network from the thesaurus.</p><p> 我对此很不好，所以我只是从词库中选择了纤维一词作为网络的同义词。</p><p>     The whole database is structured as a directed graph. The basic unit is a  block, a node in the graph, representing a paragraph, bearing data like its content and optional tags.</p><p>     整个数据库被构造为有向图。基本单位是一个块，是图中的一个节点，代表一个段落，承载着类似其内容和可选标签的数据。</p><p> Every block-node may have one parent. Thus a note, spawning from the root (a parent-free block-node), forms a tree and the whole database forms a forest.</p><p>每个块节点可以有一个父节点。因此，从根（无父级块节点）产生的注释形成一棵树，而整个数据库形成一个森林。</p><p>    Apparently we need to maintain a graph, yet I didn’t choose a graph-oriented database like  neo4j. Using good old SQL to simulate one is good enough for now.</p><p>    显然，我们需要维护一个图形，但是我没有选择像neo4j这样的面向图形的数据库。使用良好的旧SQL来模拟一个就足够了。</p><p> There’re both plugins to do graph on database level ( AGE for postgresql), and rails level (like  edge). For the initial implementation, I chose to hand-written everything from the grounded up for faster iteration because I was constantly changing things.</p><p> 这两个插件都可以在数据库级别（Postgresql的AGE）和Rails级别（如Edge）进行图形绘制。对于最初的实现，我选择从头开始手写所有内容，以加快迭代速度，因为我不断地进行更改。</p><p>  This is gonna be a front-end-heavy project, I have to choose an editor as one of the first steps.</p><p>  这将是一个繁重的前端项目，我必须选择编辑器作为第一步。</p><p>  restrict the doc to a special set of content types (like list, list item, inline tags)</p><p>  将文档限制为一组特殊的内容类型（例如列表，列表项，内联标签）</p><p>    inspect and manipulate input from the user  enforce a limitation on what type of contents may input (list item, paragraph, inline span, etc.)</p><p>    检查和操作来自用户的输入，从而限制了可以输入哪种类型的内容（列表项，段落，内联跨度等）</p><p>   I tried a few options. At the end I settled with  prose-mirror to build fiber-note due to thorough guides and references, up-to-date maintaining, and  a friendly forum.</p><p>   我尝试了一些选择。最后，由于详尽的指南和参考资料，最新的维护以及一个友好的论坛，我与散文镜定居下来，建立了纤维笔记。</p><p>  As a rails user, my first thought are  actiontext and  trix. Trix is perfect for adding out-of-box rich-text editing to a normal rails app, like rails, it just works.</p><p>作为Rails用户，我的第一个想法是actiontext和trix。 Trix非常适合将常规的Rails应用（例如rails）添加开箱即用的富文本编辑功能。</p><p>  it completely intertwined with rails’ components like  actionview (rendering) and  activestorage (image uploading), it’s hard to mutate the saved content without hacking into hidden methods.</p><p>  它与动作视图（渲染）和活动存储（图像上传）之类的Rails组件完全交织在一起，如果不侵入隐藏的方法，就很难对保存的内容进行变异。</p><p>  it saves content as raw HTML fragment, which is bad because  it’s slow to parse and manipulate the content (say tags detection, image processing, table mutation, etc.)</p><p>  会将内容另存为原始HTML片段，这很不好，因为解析和处理内容的速度很慢（例如标记检测，图像处理，表格突变等）。</p><p>  it doesn’t come with detailed docs/specs about the format of generated HTML docs, which is not reliable when you system relies on processing the content on-the-fly.</p><p>  它没有附带有关生成的HTML文档格式的详细文档/规范，当您的系统依赖于即时处理内容时，这是不可靠的。</p><p>  quill is another competitive candidate, regarding elaborated docs, data format specs, themes, and typescript support.</p><p>  在详细的文档，数据格式规范，主题和打字稿支持方面，鹅毛笔是另一个有竞争力的候选人。</p><p> It’s easy to integrate the library, tweak some configurations, and apply different themes. You can add markdown syntax support in like 10 minutes.</p><p> 可以轻松集成库，调整一些配置并应用不同的主题。您可以在10分钟内添加markdown语法支持。</p><p> It’s not easy to limit what kind of content is allowed in the document, or what would happen if a special formatted text is pasted.</p><p> 限制文档中允许的内容种类或粘贴特殊格式的文本会发生什么都不容易。</p><p> It’s hard to pragmatically control the mutation of the data to manually implement functions like “create another list item with the same indent when  return is pressed and current cursor on the end of a list item, including the end of an inline span of a list item”.</p><p>很难实用地控制数据的突变以手动实现以下功能：“按下回车键时创建另一个具有相同缩进的列表项，并且当前光标位于列表项的末尾，包括列表项的内联跨度的结尾”。</p><p> It’s not impossible, yet it will get over-complicated if you need many mutations like this.</p><p> 这并非不可能，但是如果您需要许多这样的变异，它将变得过于复杂。</p><p>  prose-mirror has the most complicated structure. You have to import  at least ten packages to build a simple demo, each managing a single aspect of the editor (model, view, schema definitions, keymaps, etc.).</p><p>  散文镜的结构最复杂。您必须导入至少十个软件包才能构建一个简单的演示，每个软件包都管理编辑器的一个方面（模型，视图，模式定义，键映射等）。</p><p> There’s a starter kit kind of package ( prosemirror-example-setup) which makes the journey a little bit easier. I’d recommend that kit to users who demand only basic features, while for complex functions you’ll have to compose each part and piece them together for better control. It’s like how advanced users almost never want the pre-set default preferences or  rails scaffold.</p><p> 有一种入门工具包（prosemirror-example-setup），可以使旅途更轻松。我建议向只需要基本功能的用户使用该套件，而对于复杂功能，则必须将每个部分组成并将它们拼凑在一起以实现更好的控制。就像高级用户几乎不希望使用预设的默认首选项或Rails支架一样。</p><p> Verbosity and redundancy means total control and vice versa, it just have to be like this. You posses the ability to custom the schema, listen to each key press, oversee every transaction of the model, and to arrange how to create (also parse, and wrap, and truncate during drag-n-drop, etc.) different kind of element.</p><p> 详尽和冗余意味着完全控制，反之亦然，只是必须这样。您将具有以下能力：自定义架构，听每一次按键，监督模型的每笔交易，以及安排如何创建（在拖放过程中也分析，包装和截断）不同类型的对象。元件。</p><p> You’ll spend a lot of time jumping between the  guides, the  references for individual packages, and even the source code. I can promise you that the guide will be a great read about the designing of a complicated modular system.</p><p> 您将花费大量时间在指南，各个软件包的参考乃至源代码之间切换。我可以向您保证，该指南将对复杂的模块化系统的设计有所帮助。</p><p>  Thanks, in the next chapter, let’s discuss how to build and tweak the editor to meet our demand.</p><p>  谢谢，在下一章中，让我们讨论如何构建和调整编辑器以满足我们的需求。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://namiwang.github.io/2020/11/12/building-a-roam-like-networked-heavily-customized-realtime-editor-part-1.html">https://namiwang.github.io/2020/11/12/building-a-roam-like-networked-heavily-customized-realtime-editor-part-1.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/高度/">#高度</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/roam/">#roam</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/内容/">#内容</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>