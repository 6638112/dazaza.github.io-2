<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Uhubctl –在智能USB集线器上控制每个端口的USB电源 Uhubctl – control USB power per-port on smart USB hubs</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Uhubctl – control USB power per-port on smart USB hubs<br/>Uhubctl –在智能USB集线器上控制每个端口的USB电源 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-13 18:14:10</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/952434346ee5c5774acf485dd441cf8f.png"><img src="http://img2.diglog.com/img/2020/12/952434346ee5c5774acf485dd441cf8f.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>uhubctl is utility to control USB power per-port on smart USB hubs.Smart hub is defined as one that implements per-port power switching.</p><p>uhubctl是用于控制智能USB集线器上每个端口的USB电源的实用程序。智能集线器定义为实现每个端口电源切换的设备。</p><p>   Note that very few hubs actually support per-port power switching.Some of them are no longer manufactured and can be hard to find.</p><p>   请注意，实际上很少有集线器支持每个端口的电源交换，其中一些不再制造并且很难找到。</p><p>   This table is by no means complete.If your hub works with  uhubctl, but is not listed above, please report itby opening new issue at  https://github.com/mvp/uhubctl/issues,so we can add it to supported table. In your report, please provideexact product model and add output from  uhubctland please test VBUS off support as described below in FAQ.</p><p>   该表绝不是完整的。如果您的集线器可与uhubctl一起使用，但未在上面列出，请通过在https://github.com/mvp/uhubctl/issues中打开新问题进行报告，以便将其添加到支持的表。在您的报告中，请提供确切的产品型号并添加uhubctland的输出，请按照常见问题解答中的以下说明测试VBUS关闭支持。</p><p> Note that quite a few modern motherboards have built-in root hubs thatdo support this feature - you may not even need to buy any external hub.</p><p> 请注意，相当多的现代主板具有支持此功能的内置根集线器-您甚至不需要购买任何外部集线器。</p><p>  If you have USB 3.0 hub connected to USB3 upstream port, it will be detectedas 2 independent virtual hubs: USB2 and USB3, and your USB devices will be connectedto USB2 or USB3 virtual hub depending on their capabilities and connection speed.To control power for such hubs, it is necessary to turn off/on power on  both USB2 and USB3virtual hubs for power off/on changes to take effect.  uhubctl will try to do this automatically(unless you disable this behavior with option  -e).</p><p>  如果您将USB 3.0集线器连接到USB3上游端口，它将被检测为2个独立的虚拟集线器：USB2和USB3，并且您的USB设备将根据其功能和连接速度连接到USB2或USB3虚拟集线器。集线器，必须关闭/打开USB2和USB3虚拟集线器的电源，以使电源关闭/打开更改生效。 uhubctl将尝试自动执行此操作（除非您使用选项-e禁用此行为）。</p><p> Unfortunately, while most hubs will cut off data USB connection, some may still not cut off VBUS to port,which means connected phone may still continue to charge from port that is powered off by  uhubctl.</p><p> 不幸的是，尽管大多数集线器会断开数据USB连接，但有些集线器可能仍无法断开VBUS到端口的连接，这意味着所连接的电话可能仍会继续从uhubctl断电的端口继续充电。</p><p>  This utility was tested to compile and work on Linux(Ubuntu/Debian, Redhat/Fedora/CentOS, Arch Linux, Gentoo, openSUSE, Buildroot), FreeBSD, NetBSD, SunOS and MacOS.</p><p>  该实用程序经过了测试，可以在Linux（Ubuntu / Debian，Redhat / Fedora / CentOS，Arch Linux，Gentoo，openSUSE，Buildroot），FreeBSD，NetBSD，SunOS和MacOS上编译和运行。 </p><p> While  uhubctl compiles on Windows, USB power switching does not work on Windows because  libusbis using  winusb.sys driver, which according to Microsoft does not support necessary USB control requests.This may be fixed if  libusb starts supporting different driver on Windows.</p><p>尽管uhubctl在Windows上编译，但USB电源切换在Windows上不起作用，因为libusbis使用winusb.sys驱动程序，根据Microsoft的说法，该驱动程序不支持必要的USB控制请求。如果libusb开始在Windows上支持其他驱动程序，则可以修复此问题。</p><p> Note that it is highly recommended to have  pkg-config installed (many platforms provide it by default).</p><p> 请注意，强烈建议安装pkg-config（许多平台默认提供）。</p><p> First, you need to install library libusb-1.0 (version 1.0.12 or later, 1.0.16 or later is recommended):</p><p> 首先，您需要安装库libusb-1.0（版本1.0.12或更高版本，建议使用1.0.16或更高版本）：</p><p>    To compile, simply run  make - this will generate  uhubctl binary.Note that on some OS (e.g. FreeBSD/NetBSD) you need to use  gmake instead to build.</p><p>    要编译，只需运行make-这将生成uhubctl二进制文件。请注意，在某些操作系统（例如FreeBSD / NetBSD）上，您需要使用gmake进行编译。</p><p>        This means operate on default smart hub and turn power off ( -a off, or  -a 0)on port 2 ( -p 2). Supported actions are  off/ on/ cycle (or  0/ 1/ 2). cycle means turn power off, wait some delay (configurable with  -d) and turn it back on.Ports can be comma separated list, and may use  - for ranges e.g.  2, or  2,4, or  2-5, or  1-2,5-8.</p><p>        这意味着在默认的智能集线器上运行并关闭端口2（-p 2）的电源（-a关闭或-a 0）。支持的操作为关闭/打开/循环（或0/1/2）。循环意味着关闭电源，等待一些延迟（可通过-d配置）然后重新打开。端口可以是逗号分隔的列表，并且可以使用-表示范围，例如2或2,4或2-5或1-2,5-8。</p><p> ⚠️ Turning off built-in USB ports may cut off your keyboard or mouse,so be careful which ports you are turning off!</p><p> ⚠️关闭内置USB端口可能会切断键盘或鼠标，因此请注意要关闭哪些端口！</p><p> If you have more than one smart USB hub connected, you should choosespecific hub to control using  -l (location) parameter.To find hub locations, simply run  uhubctl without any parameters.Hub locations look like  b-x.y.z, where  b is USB bus number, and  x,  y,  z...are port numbers for all hubs in chain, starting from root hub for a given USB bus.This address is semi-stable - it will not change if you unplug/replug (or turn off/on)USB device into the same physical USB port (this method is also used in Linux kernel).</p><p> 如果连接了多个智能USB集线器，则应使用-l（位置）参数选择特定的集线器进行控制。要找到集线器位置，只需运行不带任何参数的uhubctl。集线器位置类似于bx.yz，其中b是USB总线数字和x，y，z ...是链中所有集线器的端口号，从给定USB总线的根集线器开始。此地址是半稳定的-如果拔出/重新插入（或关闭），则该地址不会更改/ on）将USB设备插入相同的物理USB端口（Linux内核中也使用此方法）。 </p><p>  On Linux, you should configure  udev USB permissions (otherwise you will have to run it as root using  sudo uhubctl).To fix USB permissions, first run  sudo uhubctl and note all  vid:pid for hubs you need to control.Then, add one or more udev rules like below to file  /etc/udev/rules.d/52-usb.rules (replace with your vendor id):</p><p>在Linux上，您应该配置udev USB权限（否则必须使用sudo uhubctl以root身份运行它）。要修复USB权限，请先运行sudo uhubctl并注意所有vid：pid所需要控制的集线器，然后添加一个或更多类似下面的udev规则来归档/etc/udev/rules.d/52-usb.rules（替换为您的供应商ID）：</p><p>  Note that for USB3 hubs, some hubs use different vendor ID for USB2 vs USB3 components of the same chip,and both need permissions to make uhubctl work properly. E.g. for Raspberry Pi 4B, you need to add these 2 lines:</p><p>  请注意，对于USB3集线器，某些集线器对同一芯片的USB2和USB3组件使用不同的供应商ID，并且两个集线器都需要具有权限才能使uhubctl正常工作。例如。对于Raspberry Pi 4B，您需要添加以下两行：</p><p>  If you don&#39;t like wide open mode  0666, you can restrict access by group like this:</p><p>  如果您不喜欢全开模式0666，则可以按组限制访问，如下所示：</p><p>        According to USB 2.0 specification, USB hubs can advertise no power switching,ganged (all ports at once) power switching or per-port (individual) power switching.Note that  uhubctl will only detect USB hubs which support per-port power switching.You can find what kind of power switching your hardware supports by using  sudo lsusb -v:</p><p>        根据USB 2.0规范，USB集线器不能通告任何电源切换，成组（所有端口一次）电源切换或每个端口（单个）电源切换。请注意，uhubctl仅会检测支持每个端口电源切换的USB集线器。通过使用sudo lsusb -v可以找到您的硬件支持哪种电源切换：</p><p>        Run  sudo uhubctl. If your hub is not listed, it is not supported.Alternatively, you can run  sudo lsusb -v and check for Per-port power switching - if you cannot see such line in lsusb output,hub is not supported.</p><p>        运行sudo uhubctl。如果未列出您的集线器，则不支持该集线器。或者，您可以运行sudo lsusb -v并检查每端口电源切换-如果在lsusb输出中看不到该行，则不支持集线器。</p><p> Check for VBUS (voltage) off support: plug a phone, USB lightor USB fan into USB port of your hub.Try using  uhubctl to turn power off on that port, and checkthat phone stops charging, USB light stops shining or USB fan stops spinning.If VBUS doesn&#39;t turn off, your hub manufacturer did not include circuitryto actually cut power off. Such hub would still workto cut off USB data connection, but it cannot turn off power,and we do not consider this supported device.</p><p> 检查是否支持VBUS（电压）关闭：将电话，USB照明器或USB风扇插入集线器的USB端口。尝试使用uhubctl关闭该端口的电源，然后检查电话是否停止充电，USB指示灯停止闪烁或USB风扇停止旋转如果VBUS无法关闭，则您的集线器制造商未提供实际切断电源的电路。这样的集线器仍然可以断开USB数据连接，但无法关闭电源，因此我们不考虑此支持的设备。</p><p> If tests above were successful, please report your hubby opening new issue at  https://github.com/mvp/uhubctl/issues,so we can add it to list of supported devices.</p><p> 如果以上测试成功，请在https://github.com/mvp/uhubctl/issues上打开新版本报告您的中心，以便我们将其添加到支持的设备列表中。 </p><p>  After powering down USB port, udev does not get any event, so it keeps the device files around.However, trying to access the device files will lead to an IO error.</p><p>关闭USB端口电源后，udev不会发生任何事件，因此会保留设备文件，但是尝试访问设备文件将导致IO错误。</p><p> This is Linux kernel issue. It may be eventually fixed in kernel, see more discussion  here.Basically what happens here is that kernel USB driver knows about power off,but doesn&#39;t send notification about it to udev.</p><p> 这是Linux内核问题。它可能最终会在内核中修复，请参见此处的更多讨论。基本上，这里发生的是内核USB驱动程序知道关闭电源，但不会将有关它的通知发送给udev。</p><p>   Device file will be removed by udev, but USB device will be still visible in  lsusb.Note that path  /sys/bus/usb/devices/${location}.${port} will only exist if device was detected on that port.When you turn power back on, device should re-enumerate properly (no need to call  udevadm again).</p><p>   设备文件将被udev删除，但USB设备在lsusb中仍然可见。请注意，路径/sys/bus/usb/devices/${location}。${port}仅在该端口上检测到设备时存在。重新打开电源后，设备应正确重新枚举（无需再次调用udevadm）。</p><p>  Some device drivers in kernel are surprised by USB device being turned off and automatically try to power it back on.</p><p>  USB设备被关闭并自动尝试重新打开电源后，内核中的某些设备驱动程序会感到惊讶。</p><p> You can use option  -r N where N is some number from 10 to 1000 to fix this - uhubctl will try to turn power off many times in quick succession, and it should suppress that.This may be eventually fixed in kernel, see more discussion  here.</p><p> 您可以使用-r N选项（其中N是从10到1000的某个数字）来解决此问题-uhubctl会尝试快速连续多次关闭电源，并且应该禁止这样做。最终可能会在内核中修复，请参见更多讨论这里。</p><p> Disabling USB authorization for device in question before turning power off with  uhubctl should help:</p><p> 在使用uhubctl关闭电源之前，为有问题的设备禁用USB授权应该可以：</p><p>  If your device is USB mass storage, invoking  udisksctl before calling  uhubctl should help too:</p><p>  如果您的设备是USB大容量存储，则在调用uhubctl之前调用udisksctl应该也有帮助： </p><p>   Many hub manufacturers build their USB hubs using basic 4 port USB chips.E.g. to make 7 port hub, they daisy-chain two 4 port hubs - 1 port is lost to daisy-chaining,so it makes it 4+4-1=7 port hub. Similarly, 10 port hub could be built as 3 4-port hubsdaisy-chained together, which gives 4+4+4-2=10 usable ports.</p><p>许多集线器制造商使用基本的4端口USB芯片来构建其USB集线器。要制作7个端口集线器，它们将两个4端口集线器以菊花链方式连接-菊花链丢失了1个端口，因此它成为4 + 4-1 = 7端口集线器。同样，可以将10个端口集线器构建为3个4端口集线器，以菊花链方式链接在一起，从而提供4 + 4 + 4-2 = 10个可用端口。</p><p> Note that you should never try to change power state for ports used to daisy-chain internal hubs together.Doing so will confuse internal hub circuitry and will cause unpredictable behavior.</p><p> 请注意，切勿尝试将用于将内部集线器以菊花链方式连接在一起的端口的电源状态更改为电源状态，否则会混淆内部集线器电路并导致不可预知的行为。</p><p>       Main hub  1-1, all 4 ports ganged, all controlled by port  2 (turns off secondary hub ports as well).Port  1 connects hub  1-1.1 below, ports  2 and  3 are wired outside, port  4 not wired.</p><p>       主集线器1-1，所有4个端口组合在一起，都由端口2控制（也关闭了辅助集线器端口）。端口1连接下面的集线器1-1.1，端口2和3外部布线，端口4不布线。</p><p> Secondary hub  1-1.1 (daisy-chained to main): 3 ports,port  1 is used for Ethernet+WiFi, and ports  2 and  3 are wired outside.</p><p> 备用集线器1-1.1（以菊花链方式连接到主集线器）：3个端口，端口1用于以太网+ WiFi，端口2和3连接到外部。</p><p>  ⚠️ If your VL805 firmware is older than  00137ad (check with  sudo rpi-eeprom-update),you have to  update firmwareto make power switching work on RPi 4B.</p><p>  ⚠️如果您的VL805固件版本早于00137ad（请使用sudo rpi-eeprom-update检查），则必须更新固件才能在RPi 4B上进行电源切换。</p><p>  As a workaround, you can buy any external USB hub from supported list,attach it to any USB port of Raspberry Pi, and control power on its ports independently.</p><p>  解决方法是，您可以从支持的列表中购买任何外部USB集线器，将其连接到Raspberry Pi的任何USB端口，并独立控制其端口的电源。</p><p>     This file can be distributed under the terms and conditions of theGNU General Public License version 2.</p><p>     可以根据GNU通用公共许可证版本2的条款和条件分发此文件。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/mvp/uhubctl">https://github.com/mvp/uhubctl</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/usb/">#usb</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>