<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>AWS虚拟等候室——在高峰或突发流量期间缓冲用户AWS Virtual Waiting Room – buffer users during peak or bursty traffic</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">AWS Virtual Waiting Room – buffer users during peak or bursty traffic<br/>AWS虚拟等候室——在高峰或突发流量期间缓冲用户</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-15 14:37:00</div><div class="page_narrow text-break page_content"><p>This post is written by Justin Pirtle, Principal Solutions Architect, Joan Morgan, Software Developer Engineer, and Jim Thario, Software Developer Engineer.</p><p>本文由首席解决方案架构师贾斯汀·皮尔特尔、软件开发工程师琼·摩根和软件开发工程师吉姆·塔里奥撰写。</p><p>  Today, AWS is introducing an official  AWS Virtual Waiting Room solution. You can integrate this new, open-source solution with existing web and mobile applications. It can help buffer users during times of peak demand and sudden bursts of traffic, preventing systems from resource exhaustion.</p><p>今天，AWS推出了官方的AWS虚拟候诊室解决方案。您可以将这个新的开源解决方案与现有的web和移动应用程序集成。它可以在高峰需求和突发流量期间帮助缓冲用户，防止系统资源耗尽。</p><p>  Events commonly use virtual waiting rooms where there is either unknown demand or expected large bursts of traffic. Examples of such events include concert ticket sales, Black Friday promotions, COVID-19 vaccine registrations, and more. Virtual waiting rooms allow a quota of users to view, select, and complete their transactions directly. They shield the application’s backend environment from traffic by buffering users in a waiting room until it is their turn in line.</p><p>活动通常使用虚拟等候室，那里要么有未知的需求，要么预计会出现大量流量。2019冠状病毒疾病的销售包括音乐会门票销售、黑色星期五促销活动、CVID-19疫苗注册等。虚拟等候室允许一定数量的用户直接查看、选择和完成交易。它们通过在等候室中缓冲用户，直到轮到他们排队，从而保护应用程序的后端环境不受流量影响。</p><p>  Like any real-life queuing system, a user enters the AWS Virtual Waiting Room and requests a number in line. After receiving a number corresponding to the unique device ID, the browser then polls regularly for updates. The update provides the current number being served and anticipated time until they are front of line.</p><p>像任何现实生活中的排队系统一样，用户进入AWS虚拟等候室，排队申请号码。在收到与唯一设备ID对应的号码后，浏览器会定期轮询更新。该更新提供了当前的服务号码和到达前线前的预期时间。</p><p>  After reaching the front of the line, the user can exchange the number and device ID for a secure session token. This is included with their downstream requests to authenticate users securely.</p><p>到达前线后，用户可以将号码和设备ID交换为安全会话令牌。这包括在他们的下游请求中，以安全地对用户进行身份验证。</p><p>  If a user discovers the backend endpoint and tries to send requests, they are redirected into the waiting room. The API requests are denied access until they have a valid token. This prevents the backend from needing to scale to accommodate all users at a single time.</p><p>如果用户发现后端端点并尝试发送请求，它们将被重定向到等候室。API请求在拥有有效令牌之前被拒绝访问。这就避免了后端需要在同一时间扩展以容纳所有用户。</p><p>    Integration steps depend on the integration pattern for your application. You can decide if all users are routed through the waiting room or only during periods of excessive traffic. You can also choose to protect only the web host serving the backend webpages or one or more APIs powering backend commerce services.</p><p>集成步骤取决于应用程序的集成模式。您可以决定是让所有用户通过候诊室，还是只在流量过大的时段使用。您还可以选择仅保护为后端网页提供服务的web主机，或一个或多个为后端商务服务供电的API。</p><p>    Upstream redirection of all traffic from the main target site to flow through AWS Virtual Waiting Room. This option sends all user traffic through the waiting room with the initial capacity of users permitted to the protected system. The traffic passes through transparently, then it buffers the remaining users. It admits new users as capacity becomes available. The target system is only accessible by users who pass through the waiting room.</p><p>从主要目标站点向上游重定向所有流量，使其流经AWS虚拟等候室。该选项通过等候室发送所有用户流量，初始容量为受保护系统允许的用户。流量以透明的方式通过，然后缓冲剩余的用户。随着容量的增加，它将接纳新用户。只有通过候诊室的用户才能访问目标系统。</p><p>  Downstream redirection to the virtual waiting room from the target site. This option sends all traffic to the target site. The target site conditionally redirects requests that need to enter the waiting room. No DNS or upstream modifications are needed. The target site must be able to handle the initial user requests and redirection responses.</p><p>从目标站点向下重定向到虚拟等候室。此选项将所有流量发送到目标站点。目标站点有条件地重定向需要进入等候室的请求。不需要DNS或上游修改。目标站点必须能够处理初始用户请求和重定向响应。</p><p>  Direct target site API integration for buffering users from an existing website without any redirection. Your web or mobile application integrates the virtual waiting room at the API-level. This does not need any redirection to a different waiting room endpoint or site. This can offer a seamless user experience but may require more development for the integration.</p><p>直接目标站点API集成，用于缓冲现有网站的用户，而无需任何重定向。您的web或移动应用程序在API级别集成了虚拟等候室。这不需要重定向到其他等候室端点或站点。这可以提供无缝的用户体验，但可能需要更多的集成开发。</p><p>  OpenID Connect (OIDC) adapter. This option offers no-code native integration of the waiting room with OpenID Connect-enabled system components, such as the AWS Application Load Balancer (ALB). Users are redirected by the load balancer or similar component to the waiting room. They are buffered until issued a signed, time-limited  JSON Web Token (JWT). Once the user’s JWT token is issued, the load balancer then forwards user requests to the target backend systems.</p><p>OpenID连接（OIDC）适配器。此选项不提供候诊室与启用OpenID Connect的系统组件（如AWS应用程序负载平衡器（ALB））的代码本机集成。负载平衡器或类似组件会将用户重定向到候诊室。它们被缓冲，直到发出一个签名的、有时间限制的JSON Web令牌（JWT）。一旦用户的JWT令牌发出，负载平衡器就会将用户请求转发到目标后端系统。</p><p>      Core APIs. The main resources deployed include two  Amazon API Gateway deployments, a VPC, several  AWS Lambda functions, an  Amazon DynamoDB table, and an  Amazon ElastiCache cluster. This API provides the basic mechanisms for tracking clients entering the waiting room. It requests status of the line progression and an authentication token to enter the target protected site.</p><p>核心API。部署的主要资源包括两个Amazon API网关部署、一个VPC、几个AWS Lambda函数、一个Amazon DynamoDB表和一个Amazon ElastiCache集群。该API提供了跟踪进入等候室的客户的基本机制。它请求线路进程的状态和身份验证令牌以进入目标受保护站点。</p><p>  Waiting room front-end website. The waiting room static site is shown to users awaiting their turn. This site dynamically updates the position being served and their place in line on a configurable interval. You customize this site’s HTML, CSS, and JavaScript to match your frontend styling and theme.</p><p>等候室前端网站。等待室静态站点显示给等待轮到他们的用户。该网站在可配置的时间间隔内动态更新所服务的职位及其位置。您可以自定义此网站的HTML、CSS和JavaScript，以匹配前端样式和主题。</p><p>  Lambda authorizer for protected target system. The Lambda authorizer wraps and protects the downstream protected target system’s APIs. This ensures that all user invocations have a validated time-limited token issued by the waiting room core API. It helps to prevent users from bypassing the waiting room.</p><p>受保护目标系统的Lambda授权人。Lambda授权人包装并保护下游受保护目标系统的API。这确保了所有用户调用都有一个由候诊室核心API发出的经过验证的限时令牌。它有助于防止用户绕过候诊室。</p><p>      Amazon API Gateway public API resources to process queue requests from the virtual waiting room, track the queue position, and support validation of tokens that allow access to the target website.</p><p>Amazon API Gateway公共API资源，用于处理来自虚拟等候室的队列请求，跟踪队列位置，并支持对允许访问目标网站的令牌进行验证。</p><p>  An  Amazon Simple Queue Service (Amazon SQS) queue to regulate traffic to the  AWS Lambda function that processes the queue messages. Instead of invoking the Lambda function for each request, the SQS queue batches the incoming bursts of requests.</p><p>Amazon简单队列服务（Amazon SQS）队列，用于调节AWS Lambda函数的流量，该函数处理队列消息。SQS队列不是为每个请求调用Lambda函数，而是对传入的突发请求进行批处理。</p><p>    Lambda functions to validate and process public and private API requests, and return the appropriate responses.</p><p>Lambda函数用于验证和处理公共和私有API请求，并返回适当的响应。</p><p>  Amazon Virtual Private Cloud (VPC) to host the Lambda functions that interact directly with the  Amazon ElastiCache for Redis cluster. VPC endpoints allow Lambda functions in the VPC to communicate with services within the solution.</p><p>Amazon虚拟私有云（VPC）承载Lambda功能，这些功能直接与Amazon ElastiCache for Redis群集交互。VPC端点允许VPC中的Lambda功能与解决方案中的服务进行通信。</p><p>  An  Amazon CloudWatch rule to invoke a Lambda function that works with a custom  Amazon EventBridge bus to periodically broadcast status updates.</p><p>Amazon CloudWatch规则，用于调用Lambda函数，该函数与自定义Amazon EventBridge总线一起工作，以定期广播状态更新。</p><p>      (Optional) Authorizer component consisting of an  AWS Identity and Access Management (IAM) role and a Lambda function to validate signatures for your API calls. The only requirement for the authorizer to protect your API is to use API Gateway.</p><p>（可选）由AWS身份和访问管理（IAM）角色和Lambda函数组成的授权器组件，用于验证API调用的签名。授权人保护API的唯一要求是使用API网关。</p><p>  (Optional)  Amazon Simple Notification Service (Amazon SNS), CloudWatch, and Lambda functions to support two inlet strategies.</p><p>（可选）亚马逊简单通知服务（Amazon SNS）、CloudWatch和Lambda功能支持两种入口策略。</p><p>  (Optional) OpenID adaptor component with API Gateway and Lambda functions to allow an OpenID provider to authenticate users to your website. CloudFront distribution with an  Amazon Simple Storage Service (Amazon S3) bucket for the waiting room page for this component.</p><p>（可选）带有API网关和Lambda函数的OpenID适配器组件，允许OpenID提供商对您网站的用户进行身份验证。CloudFront distribution带有一个Amazon Simple Storage Service（Amazon S3）存储桶，用于该组件的候诊室页面。</p><p>  (Optional) A CloudFront distribution with Amazon S3 origin bucket for the optional sample waiting room web application.</p><p>（可选）带有Amazon S3 origin bucket的CloudFront发行版，用于可选的示例等候室web应用程序。</p><p>    To get started with the AWS Virtual Waiting Room, deploy the Getting Started stack. This deploys the Core APIs stack, the Authorizers stack, and a sample application CloudFormation stack:</p><p>要开始使用AWS虚拟等候室，请部署Getting started stack。这将部署核心API堆栈、授权器堆栈和示例应用程序CloudFormation堆栈：</p><p>  Launch the Getting Started CloudFormation stack. The template launches in the US East (N. Virginia) Region by default. To launch the solution in a different AWS Region, use the Region selector in the console navigation bar.</p><p>启动Getting Started CloudFormation堆栈。默认情况下，该模板将在美国东部（北弗吉尼亚）地区启动。要在不同的AWS区域启动解决方案，请使用控制台导航栏中的区域选择器。</p><p>  On the  Create stack page, verify that the correct template URL is in the  Amazon S3 URL text box and choose  Next.</p><p>在“创建堆栈”页面上，验证Amazon S3 URL文本框中是否有正确的模板URL，然后选择“下一步”。</p><p>  On the  Specify stack details page, assign a name to your solution stack, and accept all default parameter values. For information about naming character limitations, refer to  IAM and STS Limits in the  AWS Identity and Access Management User Guide. Choose  Next.</p><p>在“指定堆栈详细信息”页面上，为解决方案堆栈指定一个名称，并接受所有默认参数值。有关命名字符限制的信息，请参阅《AWS身份和访问管理用户指南》中的IAM和STS限制。选择下一步。</p><p>    On the  Review page, review and confirm the settings. Check the box acknowledging that the template creates AWS Identity and Access Management (IAM) resources.</p><p>在查看页面上，查看并确认设置。选中确认模板创建AWS身份和访问管理（IAM）资源的复选框。</p><p>    You can view the status of the stack in the AWS CloudFormation Console in the  Status column. You should receive a CREATE_COMPLETE status in approximately 30 minutes.</p><p>您可以在AWS CloudFormation控制台的状态列中查看堆栈的状态。大约30分钟后，您将收到“创建完成”状态。</p><p>      Navigate to the IAM console. Create a new IAM user or select an existing IAM user in the same account where you deployed the waiting room stack.</p><p>导航至IAM控制台。在部署候诊室堆栈的同一帐户中创建新IAM用户或选择现有IAM用户。</p><p>  Grant the selected IAM user programmatic access. Download the key file or copy the access key ID and secret access key values to your scratch pad for later use.</p><p>授予所选IAM用户编程访问权限。下载密钥文件，或将访问密钥ID和机密访问密钥值复制到便笺簿以备日后使用。</p><p>  Add the IAM user to the  ProtectedAPIGroup IAM user group created by the getting started template:</p><p>将IAM用户添加到由入门模板创建的ProtectedAppGroup IAM用户组：</p><p>  Open the control panel in a new tab or browser window using the  ControlPanelURL output you saved earlier.</p><p>使用之前保存的ControlPanelURL输出，在新选项卡或浏览器窗口中打开控制面板。</p><p>    Enter the access key ID and secret access key that you retrieved in   Generate AWS keys to call the IAM secured APIs. The endpoints and event ID are filled in from the URL parameters.</p><p>输入在生成AWS密钥中检索的访问密钥ID和秘密访问密钥，以调用IAM安全API。端点和事件ID由URL参数填写。</p><p>    Browse to the sample waiting room in a new browser tab. Use the  WaitingRoomURL you captured previously from the CloudFormation stack output values.</p><p>在新的浏览器选项卡中浏览到样本等候室。使用之前从CloudFormation堆栈输出值捕获的WaitingRoomURL。</p><p>  Select  Reserve to enter the waiting room. If you are unable to proceed with your transaction, your assigned number is not yet reached.</p><p>选择Reserve进入候诊室。如果您无法继续您的交易，您分配的号码尚未到达。</p><p>    Under  Increment Serving Counter, select  Change. This manually increments the serving counter and allows 100 users to move on from the waiting room to the target site.</p><p>在递增服务计数器下，选择更改。这将手动增加服务柜台，并允许100名用户从等候室移动到目标站点。</p><p>  Navigate back to the waiting room and choose  Check out now! You are redirected to the target site since your serving number is eligible to proceed beyond the waiting room.</p><p>导航回候诊室，选择立即退房！由于您的服务号码有资格在等候室之外继续，您将被重定向到目标站点。</p><p>  Select  Purchase now to finish your transaction at the target site. This page represents the protected system beyond the waiting room. Replace this with the actual system users you are protecting.</p><p>选择“立即购买”以在目标站点完成交易。本页代表候诊室以外的受保护系统。将其替换为您要保护的实际系统用户。</p><p>  After the simulated purchase is complete, you can see that the transaction is successful. This transaction is authorized using the time-limited authorization token, which came from the waiting room previously. If a user bypasses the waiting room, they would not be successful in completing a transaction.</p><p>模拟购买完成后，您可以看到交易成功。此交易使用之前来自等候室的限时授权令牌进行授权。如果用户绕过等候室，他们将无法成功完成交易。</p><p>    The sample browser client demonstrates an entire user flow frontend with the AWS Virtual Waiting Room flow for an ecommerce purchase. You can use this code as a starting point for your waiting room or reference the API communication code for integrating the waiting room into your existing website.</p><p>示例浏览器客户端演示了一个完整的用户流前端，以及用于电子商务购买的AWS虚拟等候室流。您可以使用此代码作为候诊室的起点，或参考API通信代码，将候诊室集成到现有网站中。</p><p>  This sample code is built with  Vue.js and  Bootstrap to render the user interface. It uses the  Axios and  Axios-Retry packages to make API calls to the virtual waiting room stack. The sample code uses the Axios-Retry package to show how to handle throttling conditions and exponential backoff in high-traffic situations.</p><p>此示例代码是使用Vue构建的。js和Bootstrap来呈现用户界面。它使用Axios和Axios重试包对虚拟等候室堆栈进行API调用。示例代码使用Axios Retry包演示如何在高流量情况下处理节流条件和指数退避。</p><p>  The control panel client is used to make requests to the private waiting room API that requires IAM-based authorization. The control panel client demonstrates how to construct and sign requests to the private API. It can be used in production or customized further. All of the sample source code room source is available in  GitHub including the  sample user client and  control panel client.</p><p>控制面板客户端用于向需要基于IAM授权的私人候诊室API发出请求。控制面板客户端演示了如何构造和签署对私有API的请求。可用于生产或进一步定制。GitHub中提供了所有示例源代码室源代码，包括示例用户客户端和控制面板客户端。</p><p>    The  AWS Virtual Waiting Room solution is available today at no additional cost, provided as open source under the  Apache 2 license. It supports customized integration with any front-end application via a variety of integration techniques. You can also customize how and when the waiting room allows users to progress into the protected target system using a variety of strategies.</p><p>AWS虚拟候诊室解决方案现在可以免费获得，它是在Apache2许可证下作为开源提供的。它支持通过各种集成技术与任何前端应用程序进行定制集成。您还可以自定义等待室允许用户使用各种策略进入受保护目标系统的方式和时间。</p><p>  To learn more about the AWS Virtual Waiting Room solution, visit the  solution implementation and  implementation guide.</p><p>要了解更多关于AWS虚拟等候室解决方案的信息，请访问解决方案实施和实施指南。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/虚拟/">#虚拟</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/virtual/">#virtual</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>