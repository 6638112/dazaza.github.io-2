<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>将Netlify函数和Twitter API v2用作盖茨比博客的CMS</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">将Netlify函数和Twitter API v2用作盖茨比博客的CMS</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-23 22:37:19</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/3133da60ab2f2daf4605db08ff3da3d2.jpg"><img src="http://img2.diglog.com/img/2020/11/3133da60ab2f2daf4605db08ff3da3d2.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>对于冗长的博客标题，我们会提前道歉，但是正如本文所暗示的，我将解释如何使用Netlify Functions通过Twitter v2 API访问Twitter个人资料并将其显示在Gatsby博客上。</p><p>  这可能对我来说是特定的，但是我想解决我的“数字足迹”所遇到的一个小问题。如您所见，我有这个博客：https://paulie.dev和一个商业作品集：https://www.pauliescanlon.io</p><p> 这两个站点都建立在我的Gatsby主题之上：gatsby-theme-terminal是开源的，可以在我的GitHub上找到</p><p> 使用Gatsby主题解决了我的问题之一，因为我能够拥有两个外观和工作方式几乎相同的网站，并且我对主题所做的任何更改都被两个网站继承。这有点像管理自己的多品牌设计系统，但仅是为了您自己。</p><p>  我希望两个站点都具有相同的“介绍”部分，但是每次我对一个站点进行更改时，都必须对另一个站点进行相同的更改，以确保它们都显示相同的介绍文本。</p><p> 如果我不是开发人员，那可能很好，但是两次执行某件事是太多IMO的一倍。</p><p> 这也让我感到沮丧，因为我还希望我的Twitter个人资料描述与两个站点都保持同步，因此，我还是另一个记得更新我的个人信息的地方。</p><p>我考虑过的一种选择是连接内容管理系统，这很好，它可以使我的两个站点保持同步，但无法更新我的Twitter个人资料。</p><p> 因此，我决定对Twitter API进行反向工程，并将其用作CMS来填充我的两个网站。这个想法很简单。我将使用Twitter个人资料描述，就好像它是CMS中的一个字段一样。当然，我对此所做的任何更改都会显示在我的Twitter个人资料上，下面是我将相同信息提取到两个站点中的方式。</p><p>    ...但是我在博客和网站上使用的实际API在这里：https：//paulie-api.netlify.app</p><p>   Netlify如何描述“功能而不管理服务器的站点”，而功能和意图正是出于这些目的。类似于您创建Express应用并将其部署到某处的方式，但不必麻烦设置服务器端环境，更重要的是，无需进行任何真正的杜比服务器正常运行时间监控。</p><p>  一组端点，可用于从Twitter获取数据。任何Twitter请求都必须在服务器端完成，并使用一组密钥和令牌。不幸的是，您不能从浏览器中访问Twitter API，因此我们需要一个“服务器”或如上所述的Netlify函数</p><p> 使用以上两种方法，我已经创建了自己的API端点，该端点断开并单击Twitter API，并返回我的个人资料信息，然后我可以在博客和网站的简介部分中显示这些信息。我已将此API部署到Netlify，并且已与我的两个站点完全分离，但将返回可从我的站点和博客内部的客户端“获取”请求中获取的数据。该网址再次在这里：https://paulie-api.netlify.app</p><p>  在开始之前，您需要完成几件事。</p><p>申请访问Twitter API。这是一个漫长的过程，因此请收录并在此帖子中添加书签，因为Twitter可能需要几天的时间才能接受您的申请。</p><p> 获得访问权限后，您可以转到开发人员门户并创建一个新项目，并且在该项目中可以创建一个“应用程序”，我称之为“ paulie-api”。</p><p> 在这里，您将找到访问Twitter API所需的所有API密钥和令牌。记下它们的位置，稍后我们将使用它们。</p><p>  要运行Netlify功能，我们将使用netlify开发人员而不是gatsby开发人员或yarn开发人员，因此您需要安装Netlify CLI</p><p>  为了开发自己的API，我发现最简单的方法是同时运行某种“站点”，该站点将访问API端点并在页面上呈现响应。在该示例存储库中，您将看到我建立了一个非常简单的Gatsby站点，该站点的页面使用“获取”来进行获取，渲染和呈现数据。</p><p> 我已经使用主题UI作为样式，但是自然地您可以选择任何您喜欢的样式。</p><p> 无论是从头开始，还是将Netlify Functions添加到现有项目，都需要在项目的根目录中添加functions dir来开始。</p><p>函数是它自己的应用程序，因此需要它自己的package.json并将对twitter-v2具有一个依赖性</p><p>    接下来看看.env.example。您需要创建自己的.env文件并添加环境变量，如.env.example中所示。自然地，您需要将GATSBY_TWITTER_USERNAME更改为您自己的Twitter用户名，而Twitter密钥和令牌将是我之前提到的Twitter开发人员门户网站提供的内容</p><p>    接下来创建一个Twitter客户端，这是我们在发出请求时将密钥和令牌传递到Twitter API的方法</p><p>        现在，我们需要创建前端将要命中的“端点”，该端点将关闭并从Twitter API中获取数据。</p><p> 我创建了一个名为twitter-user的目录，并在其中创建了一个新文件，并将其称为twitter-user.js。</p><p>    在这里，我们可以使用client.js来访问Twitter API端点，并从客户端传递所需的密钥和令牌。</p><p>    在上面的内容中，您可以看到我们使用客户端来访问users / by / username Twitter API端点，您可以在此处了解更多信息，该端点返回一个数据对象，我以{user：data}的形式传递给回调主体</p><p>接下来的内容将很大程度上取决于您如何设置前端，但是在演示中，我有一个名为index.js的页面，该页面使用useEffect从Netlify函数中“获取”数据。</p><p> 该示例文件包含isLoading和hasError的一些额外位，但是下面的内容足以让您点击Netlify Function，后者依次点击Twitter API并返回您的个人资料信息数据。</p><p>    process.env.GATSBY_API_URL是我们之前添加到.env的Netlify函数的路径，并且我已经在组件/页面中对/ twitter-user进行了硬编码，因为您可能想创建在不同页面上返回不同数据的端点。</p><p> 您可能想知道为什么此环境变量以GATSBY_作为前缀。这样Gatsby可以从前端访问它。您可以在此处阅读有关Gatsby环境变量的更多信息</p><p>  为了使Netlify Functions在本地和部署时均能正常工作，我们需要确保已安装netlify-lambda并将“ start”和“ postinstall”脚本都添加到根package.json（不是package.json 。/职能）</p><p>      在我们太过着迷之前，需要注意的是，我们将不再使用gatsby开发或yarn开发来启动Gatsby应用程序，如果您这样做的话，我们的Netlify功能将无法运行，并且会出现错误。</p><p> 相反，运行netlify dev可以使Gatsby站点和Netlify Function同时运行。</p><p>并且要确保何时部署一切正常，您需要修改netlify.toml</p><p> 在大多数情况下，netlify开发人员将尝试通过在项目根目录中查找某些文件来自动确定正在使用的静态站点生成器。如果您在项目的根目录还没有gatsby-config.js，请按照我在这里所做的添加一个...您可能不想使用Theme UI，因此如果您使用的是其他CSS方法，请忽略它。</p><p> 如上所述，Netlify函数是它们自己的应用程序，因此，当您将其部署到Netlify时，我们需要确保已安装依赖项，并告诉Netlify函数在目录结构中的位置</p><p> 您还需要确保已将所有相同的.env变量添加到Netlify环境。查看您的网站设置，然后在“构建和部署”下找到“环境”</p><p> 另外，请确保您已经正确设置了“敏感变量策略”，我将我的设置为“不受限制地部署”，因为我很忙！</p><p>    完成所有这些设置后，您应该能够启动netlify开发人员访问http：// localhost：8888 /并在页面上看到您自己的Twitter数据，并且一旦部署，您“应该”发现一切都将像在本地一样继续工作。</p><p> 我不是100％的人，但是我认为您可能必须至少部署一次，以便netlify开发人员知道功能在哪里...即使您是在本地开发，这还是有点奇怪，但是直到您发现它似乎出错至少部署一次。</p><p>用手指交叉就足以使您开始使用Netlify Functions，但是如果您觉得其中任何一个都有点“画出了其余的猫头鹰”，请随时在Twitter上找到我。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://paulie.dev/posts/2020/11/gatsby-netlify-twitter/">https://paulie.dev/posts/2020/11/gatsby-netlify-twitter/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/函数/">#函数</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/functions/">#functions</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/twitter/">#twitter</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1034704.html"><img src="http://img2.diglog.com/img/2020/11/thumb_a6d5c2227b178abe27d895a449d823f2.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034704.html">MacStadium博客</a></div><span class="my_story_list_date">2020-11-12 10:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1034315.html"><img src="http://img2.diglog.com/img/2020/11/thumb_34a2b3f7638248e0387b1d788e12819a.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034315.html">苹果发布会的直播博客，搭载苹果硅片的Mac很可能会在这里发布</a></div><span class="my_story_list_date">2020-11-11 2:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033856.html"><img src="http://img2.diglog.com/img/2020/11/thumb_a91d0b07ecb5b7de6f8846453eab9f45.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033856.html">直播博客：苹果11月10日“再来一件事”发布会的所有新闻</a></div><span class="my_story_list_date">2020-11-8 23:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031757.html"><img src="http://img2.diglog.com/img/2020/10/thumb_654783c38e3737e1d47c20da8fe0412b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031757.html">黑客新闻如何粉碎大卫·沃尔什的博客</a></div><span class="my_story_list_date">2020-10-28 21:23</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>