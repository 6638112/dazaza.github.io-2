<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>气流2.0 Airflow 2.0</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Airflow 2.0<br/>气流2.0 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-18 15:56:41</div><div class="page_narrow text-break page_content"><p>The full changelog is about 3,000 lines long (already excluding everything backported to 1.10), so for now I’ll simply share some of the major features in 2.0.0 compared to 1.10.14:</p><p>完整的变更日志大约有3,000行（已经排除了向后移植到1.10的所有内容），所以到目前为止，我将简单地分享2.0.0和1.10.14相比的一些主要功能：</p><p>   DAGs are now much much nicer to author especially when using PythonOperator. Dependencies are handled more clearly and XCom is nicer to use</p><p>   DAG现在要好得多，尤其是在使用PythonOperator时。依赖关系处理更加清晰，XCom更易于使用</p><p>    from airflow.decorators import dag, taskfrom airflow.utils.dates import days_ago@dag(default_args={&#39;owner&#39;: &#39;airflow&#39;}, schedule_interval=None, start_date=days_ago(2))def tutorial_taskflow_api_etl(): @task def extract(): return {&#34;1001&#34;: 301.27, &#34;1002&#34;: 433.21, &#34;1003&#34;: 502.22} @task def transform(order_data_dict: dict) -&gt; dict: total_order_value = 0 for value in order_data_dict.values(): total_order_value += value return {&#34;total_order_value&#34;: total_order_value} @task() def load(total_order_value: float): print(&#34;Total order value is: %.2f&#34; % total_order_value) order_data = extract() order_summary = transform(order_data) load(order_summary[&#34;total_order_value&#34;])tutorial_etl_dag = tutorial_taskflow_api_etl()</p><p>    从airflow.decorators导入dag，从airflow.utils.dates导入任务days_ago @ dag（default_args = {＆＃39; owner＆＃39 ;:＆＃39; airflow＆＃39;}，schedule_interval = None，start_date = days_ago（2） ）def tutorial_taskflow_api_etl（）：@task def extract（）：返回{＆＃34; 1001＆＃34 ;: 301.27，＆＃34; 1002＆＃34 ;: 433.21，＆＃34; 1003＆＃34 ;: 502.22} @task def transform（order_data_dict：dict）-> dict：total_order_value = 0 for order_data_dict.values（）：total_order_value + = value return {＆＃34; total_order_value＆＃34 ;: total_order_value} @task（）def load（total_order_value：float）：print（＆＃34; Total订单值是：％.2f＆＃34;％total_order_value）order_data =提取（）order_summary =变换（order_data）负载（order_summary [＆＃34; total_order_value＆＃34;]）tutorial_etl_dag = tutorial_taskflow_api_etl（）</p><p>      As part of AIP-15 (Scheduler HA+performance) and other work Kamil did, we significantly improved the performance of the Airflow Scheduler. It now starts tasks much, MUCH quicker.</p><p>      作为AIP-15（调度程序HA +性能）和Kamil所做的其他工作的一部分，我们大大改善了Airflow Scheduler的性能。现在，它可以更快地启动任务。</p><p> Over at Astronomer.io we’ve  benchmarked the scheduler—it’s fast (we had to triple check the numbers as we don’t quite believe them at first!)</p><p> 在Astronomer.io，我们对调度程序进行了基准测试-速度很快（由于一开始不太相信数字，我们不得不对数字进行三重检查！）</p><p>  It’s now possible and supported to run more than a single scheduler instance. This is super useful for both resiliency (in case a scheduler goes down) and scheduling performance.</p><p>  现在可以并且支持运行多个调度程序实例。这对于弹性（如果调度程序发生故障）和调度性能都非常有用。</p><p> To fully use this feature you need Postgres 9.6+ or MySQL 8+ (MySQL 5, and MariaDB won’t work with more than one scheduler I’m afraid).</p><p> 要充分使用此功能，您需要Postgres 9.6+或MySQL 8+（MySQL 5，MariaDB不能与多个调度程序一起使用）。 </p><p> There’s no config or other set up required to run more than one scheduler—just start up a scheduler somewhere else (ensuring it has access to the DAG files) and it will cooperate with your existing schedulers through the database.</p><p>运行多个调度程序不需要任何配置或其他设置，只需在其他地方启动调度程序（确保它可以访问DAG文件），它将通过数据库与您现有的调度程序配合使用。</p><p>   SubDAGs were commonly used for grouping tasks in the UI, but they had many drawbacks in their execution behaviour (primarily that they only executed a single task in parallel!) To improve this experience, we’ve introduced “Task Groups”: a method for organizing tasks which provides the same grouping behaviour as a subdag without any of the execution-time drawbacks.</p><p>   SubDAG通常用于在UI中对任务进行分组，但是它们的执行行为有很多缺点（主要是它们只能并行执行一个任务！）为了改善这种体验，我们引入了“任务组”：一种用于组织任务，该任务提供与subdag相同的分组行为，而没有执行时的缺点。</p><p> SubDAGs will still work for now, but we think that any previous use of SubDAGs can now be replaced with task groups. If you find an example where this isn’t the case, please let us know by opening an issue on GitHub</p><p> SubDAG仍然可以使用，但我们认为现在可以用任务组代替以前使用的SubDAG。如果您找到的不是这种情况的示例，请通过在GitHub上打开问题来告知我们</p><p>   We’ve given the Airflow UI  a visual refresh and updated some of the styling.</p><p>   我们对Airflow UI进行了视觉刷新，并更新了一些样式。</p><p>  We have also added an option to auto-refresh task states in Graph View so you no longer need to continuously press the refresh button :).</p><p>  我们还添加了一个选项来自动刷新“图形视图”中的任务状态，因此您不再需要连续按下刷新按钮:)。</p><p>   If you make heavy use of sensors in your Airflow cluster, you might find that sensor execution takes up a significant proportion of your cluster even with “reschedule” mode. To improve this, we’ve added a new mode called “Smart Sensors”.</p><p>   如果您在Airflow集群中大量使用传感器，则即使使用“重新安排”模式，您也可能会发现传感器执行会占据集群的很大一部分。为了改善这一点，我们添加了一种称为“智能传感器”的新模式。</p><p> This feature is in “early-access”: it’s been well-tested by AirBnB and is “stable”/usable, but we reserve the right to make backwards incompatible changes to it in a future release (if we have to. We’ll try very hard not to!)</p><p> 此功能处于“早期访问”状态：它已通过AirBnB的严格测试，并且“稳定” /可用，但是我们保留在将来的版本中对其进行向后不兼容更改的权利（如果需要的话）。尽力不要！） </p><p>   For Airflow 2.0, we have re-architected the KubernetesExecutor in a fashion that is simultaneously faster, easier to understand, and more flexible for Airflow users. Users will now be able to access the full Kubernetes API to create a .yaml  pod_template_file instead of specifying parameters in their airflow.cfg.</p><p>对于Airflow 2.0，我们以一种更快，更易于理解且对Airflow用户更加灵活的方式重新构造了KubernetesExecutor。用户现在可以访问完整的Kubernetes API来创建.yaml pod_template_file，而无需在airflow.cfg中指定参数。</p><p> We have also replaced the  executor_config dictionary with the  pod_override parameter, which takes a Kubernetes V1Pod object for a1:1 setting override. These changes have removed over three thousand lines of code from the KubernetesExecutor, which makes it run faster and creates fewer potential errors.</p><p> 我们还用pod_override参数替换了executor_config字典，该参数使用Kubernetes V1Pod对象进行1：1设置覆盖。这些更改已从KubernetesExecutor中删除了三千多行代码，这使其运行速度更快，并减少了潜在的错误。</p><p>    Airflow 2.0 is not a monolithic “one to rule them all” package. We’ve split Airflow into core and 61 (for now) provider packages. Each provider package is for either a particular external service (Google, Amazon, Microsoft, Snowflake), a database (Postgres, MySQL), or a protocol (HTTP/FTP). Now you can create a custom Airflow installation from “building” blocks and choose only what you need, plus add whatever other requirements you might have. Some of the common providers are installed automatically (ftp, http, imap, sqlite) as they are commonly used. Other providers are automatically installed when you choose appropriate extras when installing Airflow.</p><p>    Airflow 2.0并不是一个整体的“一统天下”软件包。我们将Airflow分为核心和61个（目前）提供商软件包。每个提供程序包都用于特定的外部服务（Google，Amazon，Microsoft，Snowflake），数据库（Postgres，MySQL）或协议（HTTP / FTP）。现在，您可以从“构件”中创建自定义的Airflow安装，然后仅选择所需的内容，然后添加您可能具有的其他要求。某些常用的提供程序会按照它们的常用用法自动安装（ftp，http，imap，sqlite）。当您在安装Airflow时选择适当的其他功能时，会自动安装其他提供程序。</p><p> The provider architecture should make it much easier to get a fully customized, yet consistent runtime with the right set of Python dependencies.</p><p> 提供程序体系结构应该使通过一组正确的Python依赖项获得完全自定义但一致的运行时变得容易得多。</p><p> But that’s not all: you can write your own custom providers and add things like custom connection types, customizations of the Connection Forms, and extra links to your operators in a manageable way. You can build your own provider and install it as a Python package and have your customizations visible right in the Airflow UI.</p><p> 但这还不是全部：您可以编写自己的自定义提供程序，并以可管理的方式添加自定义连接类型，自定义连接表单以及与操作员的额外链接等内容。您可以构建自己的提供程序并将其作为Python软件包安装，并在Airflow UI中显示您的自定义设置。</p><p> Our very own Jarek Potiuk has written about  providers in much more detail on the Polidea blog.</p><p> 我们自己的Jarek Potiuk在Polidea博客上详细介绍了有关提供商的信息。</p><p>   As part of Airflow 2.0 effort, there has been a conscious focus on Security and reducing areas of exposure. This is represented across different functional areas in different forms. For example, in the new REST API, all operations now require authorization. Similarly, in the configuration settings, the Fernet key is now required to be specified.</p><p>   作为Airflow 2.0努力的一部分，我们有意识地将重点放在安全性和减少暴露区域上。这在不同的功能区域以不同的形式表示。例如，在新的REST API中，所有操作现在都需要授权。同样，在配置设置中，现在需要指定Fernet密钥。 </p><p>  Configuration in the form of the airflow.cfg file has been rationalized further in distinct sections, specifically around “core”. Additionally, a significant amount of configuration options have been deprecated or moved to individual component-specific configuration files, such as the pod-template-file for Kubernetes execution-related configuration.</p><p>以airflow.cfg文件形式进行的配置已在不同部分中进一步合理化，尤其是在“核心”周围。此外，不建议使用大量配置选项或将其移至特定于组件的单个配置文件，例如Kubernetes执行相关配置的pod模板文件。</p><p>  We’ve tried to make as few breaking changes as possible and to provide deprecation path in the code, especially in the case of anything called in the DAG. That said, please read throughUPDATING.md to check what might affect you. For example: r We re-organized the layout of operators (they now all live under airflow.providers.*) but the old names should continue to work - you’ll just notice a lot of DeprecationWarnings that need to be fixed up.</p><p>  我们尝试了尽可能少地进行重大更改，并在代码中提供了弃用路径，尤其是在DAG中进行任何调用的情况下。也就是说，请通读UPDATING.md来检查可能对您造成影响的内容。例如：r我们重新组织了操作员的布局（他们现在都生活在airflow.providers。*下），但是旧名称应该继续起作用-您会注意到很多DeprecationWarnings需要修复。</p><p> Thank you so much to all the contributors who got us to this point, in no particular order: Kaxil Naik, Daniel Imberman, Jarek Potiuk, Tomek Urbaszek, Kamil Breguła, Gerard Casas Saez, Xiaodong DENG, Kevin Yang, James Timmins, Yingbo Wang, Qian Yu, Ryan Hamilton and the 100s of others who keep making Airflow better for everyone.</p><p> 非常感谢所有促成这一点的贡献者，这些贡献者的顺序不分先后：Kaxil Naik，Daniel Imberman，Jarek Potiuk，Tomek Urbaszek，KamilBreguła，Gerard Casas Saez，邓小东，Kevin Kevin，James Timmins，Yingbo Wang ，钱宇，瑞安·汉密尔顿（Ryan Hamilton）和其他100多个人，他们不断为所有人打造更好的Airflow。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://airflow.apache.org/blog/airflow-two-point-oh-is-here/">http://airflow.apache.org/blog/airflow-two-point-oh-is-here/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/气流/">#气流</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/airflow/">#airflow</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>