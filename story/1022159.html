<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>锈蚀测试或验证：为什么不能两者兼而有之？</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">锈蚀测试或验证：为什么不能两者兼而有之？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-05 05:53:49</div><div class="page_narrow text-break page_content"><p>Dijkstra著名地贬低测试，他说“程序测试可以用来显示错误的存在，但永远不能用来显示它们的存在！”好像您应该选择一个而不是另一个。我不认为它们是对立的，而是作为互补的技术，两者都应该用来提高代码的质量。</p><p>我是正式验证的忠实粉丝。正式验证工具可能是您使用过的最好的错误查找工具。它们可以从您的代码中完全消除整类错误。但是，正式验证不会在您的规范中、在您对依赖项的假设中、或者在您的构建/CI工具等中发现错误。(有关测试在正式验证的系统中发现错误的更多示例，请参见Fonseca。)。</p><p>而且，我们都勉强同意Dijkstra是对的：即使是一个彻底的、执行完美的测试计划也可能遗漏错误。</p><p>所以，在过去的几个月里，我一直在尝试两者兼而有之。我们(我和我在Google的团队)一直在重新实现Jason Lingle的Protest属性测试库，以便与Rust正式验证工具一起使用。最初的Protest允许您编写测试工具来测试您的代码(可能)是否满足属性。今天，我们发布了Protest接口的重新实现，使您能够使用完全相同的测试工具来正式验证属性是否成立。到目前为止，我们只尝试了K.Protest。1个。</p><p>[在我进一步讨论之前，我应该提到，我们本周发布的是一个非常早期的研究原型。它还没有准备好正式使用，而且它绝对不是官方的、受谷歌支持的产品。我们现在正在放松它，目前处于不成熟的状态，因为我们想就程序员希望如何正式验证Rust代码进行对话，我们认为有一些东西可以推动它是有帮助的。我们欢迎增加对其他验证器的支持的拉请求，或者将设计推向更好方向的拉请求。]。</p><p>为了了解属性测试在protest中是什么样子，我们将查看protest书中的一个示例。</p><p>Fn add(a：i32，b：i32)-&gt；I32{a+b}protest！{#[test]fn test_add(a in 0..1000i32，b in 0..1000i32){let sum=add(a，b)；assert！(sum&&gt;；=a)；assert！(sum&&gt;；=b)；}}。</p><p>此示例定义了一个名为test_add的属性，用于测试名为add的函数。特别地，它检查对于非负值a和b，sum(a，b)的结果是否至少与a和b一样大。</p><p>符号0..1000i32表示范围[0..1000)中的所有值的集合，而0..1000i32中的符号a表示应该从该集合中选择一个值a。</p><p>最大的推进器！宏将此属性转换为测试函数，该函数重复生成a和b的随机值并执行属性体。</p><p>(在添加了一些附加的粘合代码之后)我们可以使用以下命令运行此示例。</p><p>正在运行%1 testtest test_add...。OK测试结果：OK。1通过；0失败；0忽略；0测量；0过滤掉。</p><p>而且，如果我们故意编写一个不成立的属性，那么Cargo测试会产生类似以下内容的输出。</p><p>正在运行%1 testtest test_add...。FAILED失败：-test_add标准输出-线程&#39；test_add&#39；断言死机失败：sum&gt；=a+100&#39；，src/main.rs：11：9thread&#39；test_add&#39；死机测试失败：断言失败：sum&&gt;；=a+100；最小失败输入：a=0，b=0成功：0本地。，src/main.rs：7：1故障：test_addtest结果：失败。通过0次；失败1次；忽略0次；测量0次；过滤出0次。</p><p>Proptest通过生成随机值和测试来检查上述属性，但我们也可以将该属性解释为，对于集合中的所有值a和b，属性主体不会出现恐慌，也就是说，我们可以将其解释为一个普遍量化的规范。</p><p>为了验证上述属性，我们使用一个脚本来编译Rustcode，调用Klee符号执行引擎，并过滤Klee的输出，以确定是否存在可能导致属性主体死机的a和b选项。</p><p>而且，如果我们更改示例属性，使该属性不成立，Cargo-Verify将生成此输出。</p><p>线程&#39；test_add&#39；在&#39；断言处死机失败：sum&gt；=a+100&#39；，src/main.rs：11：9正在运行1测试值a=0值b=0test test_add...。FAILED失败：失败：test_addtest结果：失败。通过0次；失败1次；忽略0次；测量0次；过滤出0次。</p><p>在这个例子中，随机测试和正式验证产生了相似的结果。我可以选择一个正式验证发现随机测试遗漏的bug的例子。或者我也可以选择一个随机测试很容易发现bug但正式验证永远旋转的例子。但是，在这篇文章中，我想重点关注这两种方法之间的相似之处，而不是区别。</p><p>在本文中，我们使用了一个易于解释但并未真正展示命题的威力的示例。</p><p>其中我们检查涉及标准Rust集合类型的属性，比如向量和B树。(这应该与protest文档一起阅读。)。</p><p>在Dynamic.rs中，我们通过对特征的可能实例的子集进行量化来检查涉及特征对象的属性。</p><p>你可以把它理解为我们计划做的事情的草图，或者是对我们还没有做的事情的承认。就像弗雷德和金杰说的那样，“西红柿。番茄。“]。</p><p>这部分是因为正式验证还不够流行，不足以让足够多的Debian/Homebrew包存在，部分原因是我们需要一些非常具体的版本。(也可以删除一些依赖项！)</p><p>我们正在将Crux-Mir支持添加到库和工具中。Crux-Mir是Galois软件分析工作台(SAW)的一个新部分，用于验证由Rust编译器生成的MIR代码。</p><p>这比使用KLEE花费的时间要长一些，因为我们的货物的功能-验证与Crux-Mir的功能相似，但它们的方法略有不同-我们仍在研究处理由此产生的冲突的最佳方法。</p><p>一次把注意力集中在一个板条箱上是很有用的，我们有一些关于如何通过模糊和验证来做到这一点的想法，但我们还没有机会尝试它们。</p><p>Proverify库中的集合支持有一些技巧来避免一些明显的伸缩问题，但是我们不知道这些技巧是否适用于所有的验证工具，而且它们可能只触及了需要做的事情的皮毛。</p><p>测试和正式验证通常被描述为致命的敌人，我认为这错过了一个利用您对测试的现有熟悉度和舒适性来让您从正式验证工具中获得价值的巨大机会。</p><p>我鼓励您下载我们的库和工具，试用并给我们反馈。如果您正在开发锈蚀验证工具，我们会很高兴您尝试将我们的库与您的工具一起使用。如果您给我们发送一个拉取请求，我们会更喜欢。</p><p>在这个阶段承诺使用库可能不是一个好主意：目前它不是很健壮，我希望随着我们从将库移植到其他类型的正式验证工具中获得经验，它会有很大的变化。</p><p>Goodman：NDSS：2018将一些非常类似的想法应用于2018年的C++测试，使用GoogleTest DSL作为起点，并为Angr、Manticore和Dr.Fuzz提供支持。</p><p>他们遇到并解决了日志记录(导致路径爆炸)、符号循环界限和符号数组索引(导致路径爆炸)以及如何将群测试与验证相结合的问题。</p><p>好的，我必须承认目前针对Rust的验证工具并不多。到目前为止，我们的大部分时间都花在向Klee提交补丁，以便Klee可以用来验证Rust程序。-↩</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://alastairreid.github.io/why-not-both/">https://alastairreid.github.io/why-not-both/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/rust/">#rust</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/测试/">#测试</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/testing/">#testing</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/属性/">#属性</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1022089.html"><img src="http://img2.diglog.com/img/2020/9/thumb_338b57f1fc212d5d17ea5715a7c1b0b3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022089.html">科学家发现，地球正在使月球生锈</a></div><span class="my_story_list_date">2020-9-4 18:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021886.html"><img src="http://img2.diglog.com/img/2020/9/thumb_fae587c9f43f85204de8b1763d0fd88f.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021886.html">美国国家航空航天局测试产生300万磅推力的助推器</a></div><span class="my_story_list_date">2020-9-3 16:26</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021511.html"><img src="http://img2.diglog.com/img/2020/9/thumb_48db8eb787e01587afbae8abe49292fa.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021511.html">Bevy：锈迹斑斑的游戏引擎</a></div><span class="my_story_list_date">2020-9-1 2:57</span></div><div class="col-sm"><div><a target="_blank" href="/story/1021025.html"><img src="http://img.diglog.com/img/2020/8/thumb_9e49c09f03a5a9e75898902b303332e4.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021025.html">客观-铁锈</a></div><span class="my_story_list_date">2020-8-29 5:41</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>