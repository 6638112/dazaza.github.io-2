<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>PG快捷键：类似YouTube的短ID作为Postgres主键 Pg-shortkey: YouTube-Like Short IDs as Postgres Primary Keys</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Pg-shortkey: YouTube-Like Short IDs as Postgres Primary Keys<br/>PG快捷键：类似YouTube的短ID作为Postgres主键 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-04 21:02:48</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/3367596d9c24109955e7b4deb622e0ed.png"><img src="http://img2.diglog.com/img/2020/12/3367596d9c24109955e7b4deb622e0ed.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This installs a trigger and type which allow you to use YouTube-like short IDs (e.g.  1TNhBqYo-6Q) as Postgres Primary Keys. Just like the YouTube IDs, SHORTKEY IDs are fixed length and URL-safe.</p><p>这会安装一个触发器和类型，使您可以使用类似YouTube的简短ID（例如1TNhBqYo-6Q）作为Postgres主键。与YouTube ID一样，SHORTKEY ID是固定长度的，并且是网址安全的。</p><p>     CREATE  TABLE  test (id SHORTKEY  PRIMARY KEY, name  TEXT); CREATE  TRIGGER  trigger_test_genid BEFORE INSERT  ON test FOR EACH ROW EXECUTE PROCEDURE shortkey_generate();  -- generate INSERT INTO test(name)  VALUES (  &#39;bob &#39;), (  &#39;joe &#39;);  -- user-supplied ID INSERT INTO test(id, name)  VALUES (  &#39;1TNhBqYo-6Q &#39;,   &#39;lisa &#39;); SELECT  *  FROM test;  -- id name  -- 4E_z0mHJvrk bob  -- wiz_j0HIBuQ joe  -- 1TNhBqYo-6Q lisa</p><p>     CREATE TABLE测试（id SHORTKEY PRIMARY KEY，名称TEXT）；在对每个行执行程序进行插入插入测试之前，创建触发器trigger_test_genid shortkey_generate（）; -生成INSERT INTO test（name）VALUES（＆＃39; bob＆＃39;），（＆＃39; joe＆＃39;）; -用户提供的ID INSERT INTO test（id，name）值（＆＃39; 1TNhBqYo-6Q＆＃39 ;,＆＃39; lisa＆＃39;）; SELECT * FROM test; -id名称-4E_z0mHJvrk bob-wiz_j0HIBuQ joe-1TNhBqYo-6Q lisa</p><p> SHORTKEY is compatible with  text and should be handled as such by most sane ORMs. If not, create a type mapping to whatever your string type is in your app/ORM.</p><p> SHORTKEY与文本兼容，大多数理智的ORM应该这样处理。如果没有，请创建一个类型映射到应用程序/ ORM中的任何字符串类型。</p><p>  SHORTKEYs are truly random, so they fragment the index space just like v4 UUIDs, decreasing performance slightly. But unlike UUID (which provides an instance-local pseudo-sequential type via UUID v1 MC), that behavior can&#39;t be changed. This is intentional. SHORTKEYs are supposed to be used for external facing IDs, like in APIs. There, they prevent enumeration and cardinality evaluation (e.g.  how many things are there and  what&#39;s the next/previous thing - just like YouTube). Use where appropriate.</p><p>  SHORTKEY实际上是随机的，因此它们像v4 UUID一样使索引空间碎片化，从而稍微降低了性能。但是与UUID（通过UUID v1 MC提供本地实例的伪顺序类型）不同，该行为无法更改。这是故意的。应该将SHORTKEYs用作面向外部的ID，例如在API中。在那里，它们会阻止枚举和基数评估（例如，那里有多少东西，下一个/上一个东西是什么-就像YouTube一样）。在适当的地方使用。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/youtube/">#youtube</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/postgres/">#postgres</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/shortkey/">#shortkey</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/id/">#id</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>