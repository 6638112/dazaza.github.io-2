<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>静态网站分析没有使用Goaccess的JavaScript Static website analytics with no JavaScript using GoAccess</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Static website analytics with no JavaScript using GoAccess<br/>静态网站分析没有使用Goaccess的JavaScript </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-18 05:48:17</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/6b1eb5c081b5f7a20a722bc3b52226f5.png"><img src="http://img2.diglog.com/img/2021/3/6b1eb5c081b5f7a20a722bc3b52226f5.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>I&#39;ve been using Cloudflare analytics to get an idea if anyone visits this site. Cloudflare tells me the number of requests, unique visitors and used bandwidth. Better than nothing, considering it&#39;s free and works out of the box (if you manage DNS with Cloudflare). But there&#39;s only 30 days of history, I don&#39;t know how many of the visits are crawlers and what pages the visitors request.</p><p>我一直在使用CloudFlare Analytics来获得一个想法，如果有人访问这个网站。 CloudFlare告诉我请求的数量，唯一的访客和使用带宽。考虑到它，＆＃39;自由并从框中摆脱盒子（如果您使用CloudFlare管理DNS），那就好了。但是，在历史上只有30天，我不知道有多少访问是爬虫和访问者请求的内容。</p><p>  I&#39;ve been wanting to give  GoAccess a try for some time. GoAccess provides real-time analytics by parsing access logs of your server. It works entirely server-side and it&#39;s in my opinion the most privacy-conscious analytics solution, because it only collects what the browser explicitly sends to the server. There&#39;s a slight problem though -- I host this site on  Gitlab pages and  there&#39;s no server.</p><p>  我一直想要一段时间给予GoAccess。 Goaccess通过解析服务器的访问日志来提供实时分析。它完全适用于服务器端和IT＆＃39; s在我看来是最隐私的分析解决方案，因为它只收集浏览器明确发送到服务器的内容。虽然有一个轻微的问题 - 我在Gitlab页面和第＃39;没有服务器上托管这个网站。</p><p>  A tracking pixel is a 1x1 transparent pixel made infamous by Facebook, who use it to track people across third party sites. I&#39;ll use the same technique here thanks to excellent writeups by  Ben Hoyt and  Tim Nash.</p><p>  跟踪像素是由Facebook制作臭名昭着的1x1透明像素，他将其使用它来跟踪第三方网站的人。 I＆＃39; LL使用与Ben Hoyt和Tim Nash的优秀撰写相同的技术。</p><p>   To get any useful information out of the pixel request, we&#39;ll need to add the data we want to log to the pixel&#39;s query string. Ben and Tim used a tiny script to add the pixel to their pages, which sends over the current URL and the referrer. Since I&#39;ve  liberated this site from Javascript some time ago, I won&#39;t be using any scripts. Instead I&#39;ll generate the pixel markup at build time, baking the current URL into the pixel request like this:  cat.gif?u=&lt;current-url&gt;. This way I won&#39;t need any runtime JS, but there will be no referrer data. Good enough for me.</p><p>   要从像素请求中获取任何有用的信息，我们＆＃39; ll需要添加我们要记录到像素＆＃39; s查询字符串的数据。 Ben和Tim使用了一个微小的脚本将像素添加到它们的页面，它会通过当前的URL和引用者发送。自从我前段时间从JavaScript解放出这个网站以来，我赢了＆＃39; t使用任何脚本。而不是i＆＃39; ll在构建时生成像素标记，将当前网址烘焙到像素请求中：cat.gif？u =＆lt;＆lt; current-url＆gt ;.这样，我赢了＆＃39; t需要任何运行时js，但不会有推荐人数据。对我来说足够好。</p><p>  We&#39;ll tell Nginx to serve an empty gif at the path  /cat.gif. (Originally I used  t.gif but it got blocked by EasyPrivacy.)</p><p>  我们＆＃39; ll告诉nginx在路径/cat.gif下为空的gif提供服务。 （最初我使用了T.gif，但它被EasyPrivacy阻止了。）</p><p>  If we parsed  pixel.log with GoAccess, we would see a bunch of requests to  /cat.gif. We&#39;ll need to change the log format to use the  u query param as the request URL.</p><p>  如果我们使用goaccess解析pixel.log，我们会看到一堆请求/cat.gif。我们＆＃39; ll需要更改日志格式以使用u查询param作为请求URL。</p><p> events  { } http  {  include mime . types ;  default_type application /octet -stream ;  sendfile on ;  # goaccess-compatible pixel log format  log_format pixel  &#39;$remote_addr - $remote_user [$time_local] &#34;$rurl&#34; $status $body_bytes_sent &#34;&#34; &#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39; ;  server  {  listen  8080 ;  server_name localhost t .bitgate .cz ;  # tracking pixel  location  =  /cat .gif  {  empty_gif ;  set  $rurl  $arg_u ;  access_log  /var /log /nginx /pixel .log pixel ;  }  } }</p><p> 事件{} http {include mime。类型; default_type应用程序/八位字节 - 流; sendfile上; ＃goaccess兼容像素日志格式log_format像素＆＃39; $ remote_addr  -  $ remote_user [$ time_local]＆＃34; $ rurl＆＃34; $ status $ body_bytes_sent＆＃34;＆＃34; ＆＃34; $ http_user_agent＆＃34; ＆＃34; $ http_x_forword_for＆＃34;＆＃39; ;服务器{听8080; server_name localhost t .itgate .cz; ＃跟踪像素位置= / cat .gif {extent_gif;设置$ rurl $ arg_u; Access_log / var / log / nginx / pixel .log像素; }}} </p><p> Let&#39;s save this as  nginx.conf and run Nginx from the same directory as the config:</p><p>让＆＃39; s将此作为nginx.conf保存为nginx.conf并从与配置的相同目录运行nginx：</p><p>  If you open   http://localhost:8080/cat.gif, there should be a record like the following in the pixel&#39;s log:</p><p>  如果您打开http：// localhost：8080 / cat.gif，则在像素＆＃39; s日志中应该有一个如下的记录：</p><p> $  cat log/pixel.log 172.17.0.1 - -  [ 14/Mar/2021:21:13:15 +0000 ]  &#34;&#34;  200  43  &#34;&#34;  &#34;Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0&#34;  &#34;-&#34;</p><p> $ cat log / pixel.log 172.17.0.1  -   -  [14 / Mar / 2021：21：13：15 +0000]＆＃34;＆＃34; 200 43＆＃34;＆＃34; ＆＃34; Mozilla / 5.0（Windows NT 10.0; RV：78.0）Gecko / 20100101 Firefox / 78.0＆＃34; ＆＃34;  - ＆＃34;</p><p> It&#39;s funny and sad that Firefox on OSX with resist fingerprinting on pretends it runs on Windows and is  8 versions old.</p><p> 它＆＃39; syrid and sand，isx上的firefox用抗拒指纹打印假装它在窗户上运行，是8个版本的老。</p><p>     $ docker run -it --rm -p  7890:7890  \ -v  ${ PWD}/goaccess:/goaccess  \ -v  ${ PWD}/log/pixel.log:/goaccess/access.log  \ allinurl/goaccess --config-file =/goaccess/goaccess.conf</p><p>     $ docker运行-it --rm -p 7890：7890 \ -v $ {pwd} / goaccess：/ goaccess \ -v $ {pwd} /log/pixel.log：/goaccess/access.log \ allinurl / goaccess  - -config-file = / goaccess / goaccess.conf</p><p> Open  goaccess/index.html in your browser and there it is! If you make another request for  /cat.gif, the report should update in real time.</p><p> 在浏览器中打开goaccess / index.html，它是！如果您对/cat.gif进行了另一个请求，则报告应实时更新。</p><p>   I want to deploy this to my Raspberry at home, so I&#39;ll need a way to access the report over the network. We already have an Nginx up and running; let&#39;s add a  server section to serve the report on another port so that I can port forward only the pixel:</p><p>   我想将此部署到家里的覆盆子，所以我＆＃39; ll需要一种通过网络访问报告的方法。我们已经拥有了nginx，跑步;让＆＃39; s添加一个服务器部分以在另一个端口上提供报告，以便我只能将转发转发的像素： </p><p>  To have it work with the docker command from earlier, we need to map the report to  /var/www and expose port 8081:</p><p>要与早期的Docker命令合作，我们需要将报告映射到/ var / www和公开端口8081：</p><p>   To make deployment easier, I created a  docker-compose.yml. I mapped the ports differently so that the pixel is available at port 80, 7890 is GoAccess&#39;s default websocket port and 7891 is the report.  --ignore-panels hide sections we don&#39;t have data for.</p><p>   要使部署更容易，我创建了一个docker-compose.yml。我以不同方式映射端口，以便在端口80，7890处获得像素是Goaccess＆＃39; s默认Websocket端口和7891是该报告。 -  -ignore-panels隐藏我们没有数据的部分。</p><p> I added a Let&#39;s Encrypt config to enable HTTPS. Without HTTPS, the numbers would be skewed, because recent versions of Chrome will not load mixed content. See the  readme for the necessary steps to get it all up and running.</p><p> 我添加了Let＆＃39; s加密配置以启用HTTPS。如果没有HTTPS，那么数字将是歪曲的，因为最近版本的Chrome不会加载混合内容。有关必要步骤，请参阅README以使其全部运行。</p><p> version :  &#39;3.8&#39; services :  goaccess :  container_name : goaccess  image : memphisx/rpi -goaccess  command :  - -config -file=/goaccess/goaccess.conf  - -ignore -panel=REQUESTS_STATIC  - -ignore -panel=REFERRERS  - -ignore -panel=REFERRING_SITES  - -ignore -panel=KEYPHRASES  - -ignore -panel=STATUS_CODES  - -ignore -panel=NOT_FOUND  environment :  - TZ=Europe/Prague  volumes :  - $ {PWD }/goaccess :/goaccess  - $ {PWD }/log :/log  ports :  - 7890 : 7890  # goaccess websocket  goaccess-nginx :  container_name : goaccess -nginx  command : &#39;/bin/sh  -c &#39;&#39;while  :; do sleep 6h &amp; wait $$ {  }; nginx  -s reload; done &amp; nginx  -g &#34;daemon off;&#34;&#39;&#39;&#39;  volumes :  - $ {PWD }/nginx.conf :/etc/nginx/nginx.conf :ro  - $ {PWD }/log :/var/log/nginx  - $ {PWD }/goaccess/html :/var/www  - $ {PWD }/certbot/conf :/etc/letsencrypt  - $ {PWD }/certbot/www :/var/www/certbot  image : tobi312/rpi -nginx :alpine  ports :  -    # certbot  - 443 : 443  # tracking pixel  - 7891 : 8081  # goaccess report  goaccess-certbot :  container_name : goaccess -certbot  image : certbot/certbot :arm32v6 -latest  entrypoint :  &#34;/bin/sh -c &#39;trap exit TERM; while :; do certbot renew; sleep 12h &amp; wait $${!}; done;&#39;&#34;  volumes :  - ./certbot/conf :/etc/letsencrypt  - ./certbot/www :/var/www/certbot</p><p> 版本：＆＃39; 3.8＆＃39;服务：GOAccess：GOACCESS：GOACCESS -GOACCESS命令：--config -file = / goaccess / goaccess.conf  -  -ignore -panel = requests_static  -  -ignore -panel =引用者 -  -ignore -panel =引用_site  - -ignore -panel = keyphrases  -  -ignore -panel = status_codes  -  -ignore -panel = not_found环境： -  tz =欧洲/布拉格卷： -  $ {pwd} / goaccess：/ goaccess  -  $ {pwd} / log：/ log端口： -  7890：7890＃goaccess websocket goaccess-nginx：container_name：goaccess -nginx命令：＆＃39; / bin / sh -c＆＃39;＆＃39;＆＃39;而：;睡觉6h＆amp;等待$$ {}; nginx -s重新加载;完成＆amp; nginx -g＆＃34;守护守护进程;＆＃34;＆＃39;＆＃39;卷： -  $ {pwd} /nginx.conf：/etc/nginx/nginx.conf：ro  -  $ {pwd} / log：/ var / log / nginx  -  $ {pwd} / goaccess / html：/ var / www -  $ {pwd} / certbot / conf：/ etc / letsencrypt  -  $ {pwd} / certbot / www：/ var / www / certbot图片：tobi312 / RPI -nginx：Alpine端口： -  #cexot  -  443：443＃跟踪Pixel  -  7891：8081＃goaccess报告goaccess-certbot：container_name：goaccess -certbot图片：certbot / certbot：arm32v6 -latest入口点：＆＃34; / bin / sh -c＆＃39;陷阱退出术语;尽管 ：; CERTBOT续签;睡12H＆amp;等待$$ {！};完成;＆＃39;＆＃34;卷： -  ./certbot/conf：/ etc / letsencrypt  -  ./certbot/www：/ var / www / certbot</p><p>   import  { useRouter  }  from  &#39;next/dist/client/router&#39; import React  from  &#39;react&#39; const  PIXEL_URL  =  &#39;https://t.bitgate.cz/cat.gif?u=&#39; export  const Pixel : React . FC  =  ( )  =&gt;  {  const router  =  useRouter ( )  const currentUrl  =  encodeURIComponent (  `  ${process .env . NEXT_PUBLIC_BASE_URL }  ${router .asPath } ` )  return  (    ) }</p><p>   从＆＃39导入{Userouter};下一个/ dist / client /路由器＆＃39;导入从＆＃39反应;反应＆＃39; const pixel_url =＆＃39; https：//t.bitgate.cz/cat.gif？u =＆＃39;出口const pixel：反应。 fc =（）=＆gt; {const router = userouter（）const clusturl = encodeuricomponent（`$ {process .env. next_public_base_url} $ {路由器.aspath}`）return（）} </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.bitgate.cz/static-site-analytics-with-nginx-goaccess-no-js/">https://blog.bitgate.cz/static-site-analytics-with-nginx-goaccess-no-js/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/website/">#website</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/goaccess/">#goaccess</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>