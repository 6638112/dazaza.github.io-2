<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Specto可视化移动应用性能 Visualizing Mobile App Performance with Specto</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Visualizing Mobile App Performance with Specto<br/>使用Specto可视化移动应用性能 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-10 04:04:54</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/d217b2309da9df12f1719dc08569cf95.gif"><img src="http://img2.diglog.com/img/2020/12/d217b2309da9df12f1719dc08569cf95.gif" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>You’ve received reports of poor performance from users of your mobile app, and you’re not able to reproduce the issue in a development environment. Where do you start debugging a problem on a device that you have no physical access to? Your application, like many others, has hundreds of views and user flows, and any one of them could be responsible for the issue. This is further complicated by the possibility that the issue may only be reproducing under specific conditions — a particular app version, OS version, or device model, just to name a few variables in the large matrix.</p><p>您已经收到来自移动应用程序用户的性能不佳的报告，并且无法在开发环境中重现该问题。在无法物理访问的设备上，从哪里开始调试问题？您的应用程序与许多其他应用程序一样，具有数百个视图和用户流，其中任何一个都可能引起该问题。由于仅在特定条件下（特定的应用程序版本，操作系统版本或设备型号）可能仅在特定条件下重现该问题，这使问题更加复杂化，仅在大型矩阵中列出了一些变量。</p><p> We started out by building support for tracing — instrumenting sections of code by automatically collecting performance statistics on CPU, memory, network requests, and more. We aggregated data from these traces to provide a birds-eye view of how your application was performing, and how performance changed between app versions. However, traces alone were too limited to diagnose  specific performance issues that occur in production, which is why we have added  spans as a new instrumentation primitive on our platform that will help target these use cases.</p><p> 我们从建立对跟踪的支持开始-通过自动收集有关CPU，内存，网络请求等的性能统计信息来检测代码部分。我们从这些跟踪中汇总了数据，以鸟瞰您的应用程序的性能以及应用程序版本之间的性能变化。但是，仅凭跟踪就无法诊断生产中出现的特定性能问题，这就是为什么我们在我们的平台上将跨度作为新的检测原语添加的原因，它将有助于针对这些用例。</p><p>  The case study in this post presents one kind of issue that Specto was intended to solve. If these scenarios sound all too familiar to you, and you are interested in trying a full suite of tools for improving the performance of your iOS or Android app, request access to Specto at  https://specto.dev.</p><p>  这篇文章中的案例研究提出了Specto要解决的一种问题。如果您觉得这些情况听起来太熟悉了，并且您有兴趣尝试使用全套工具来改善iOS或Android应用程序的性能，请通过https://specto.dev请求访问Specto。</p><p>  Spans help break down larger tasks like rendering a scrolling feed of content into smaller sub-components that can be analyzed individually to isolate the root cause of a performance problem. Spans are created by adding start and end markers to sections of code, which are then measured and visualized on our dashboard.</p><p>  跨度有助于分解较大的任务，例如将内容的滚动提要呈现为较小的子组件，可以对这些子组件进行单独分析以找出性能问题的根本原因。通过在代码段中添加开始和结束标记来创建跨度，然后在我们的仪表板上对其进行测量和可视化。</p><p> Unlike traces, spans can be concurrent and nested, and multiple spans of the same name can exist within the same trace. We recommend using spans to mark the more granular, high-level operations within a traced interaction in your app — for example, fetching data from the network, reading data from a cache, or performing resource-intensive tasks like image processing.</p><p> 与跟踪不同，跨度可以并发和嵌套，并且同一跟踪中可以存在多个具有相同名称的跨度。我们建议您使用跨度来标记应用程序中跟踪交互中更细粒度的高级操作，例如，从网络中获取数据，从缓存中读取数据或执行资源密集型任务，例如图像处理。</p><p>   At a glance, the scatter plot can be used to identify clusters of traces that have durations that are unexpectedly short or long. By using the filter bar, the list of traces can be filtered using attributes like their timestamp, duration, device model, and more. These tools will help you narrow down the set of traces that you have to look at to find an occurrence of a performance issue.</p><p>   一目了然，散点图可用于识别持续时间短或长的迹线簇。通过使用过滤器栏，可以使用诸如其时间戳记，持续时间，设备型号等属性来过滤跟踪列表。这些工具将帮助您缩小发现性能问题的踪迹范围。</p><p>  Let’s take a look at a real-world scenario where using span data can help us visualize a performance issue and understand how to fix it. We have an iOS app we use to test the Specto SDK internally — this app renders a feed of upcoming movies, and users can open a movie to see the artwork, a description, the cast, and other information. We’ve captured the following trace while loading the detail screen for a movie:</p><p>  让我们看一下使用跨度数据可以帮助我们可视化性能问题并了解如何解决它的实际情况。我们有一个iOS应用程序，可用于在内部测试Specto SDK-此应用程序将渲染即将上映的电影的提要，用户可以打开电影来查看作品，说明，演员表和其他信息。在加载电影的详细信息屏幕时，我们捕获了以下跟踪： </p><p>  The spans in green represent instrumented network calls that are captured automatically by the Specto SDK, once you opt into network instrumentation and whitelist your requests with a tag. The spans in blue are spans that have been explicitly added to the code using start and end markers — this is as easy as:</p><p>绿色的跨度表示选择加入网络检测并使用标签将请求列入白名单后，Specto SDK会自动捕获检测到的网络呼叫。蓝色的跨度是已经使用开始和结束标记明确添加到代码中的跨度，这很容易：</p><p>  From the timeline, we can see that we have a few operations kicking off in parallel to fetch movie information like artwork, videos, and credits. It looks like most of the operations end around the  130  ms mark in this trace, but there are a few operations, like  load-movie-videos and  load-movie-credits that start later and cause the trace to take  319  ms in total.</p><p>  从时间轴上，我们可以看到并行进行了一些操作，以获取电影信息，例如艺术品，视频和片数。看起来大多数操作在此跟踪中大约在130 ms标记处结束，但是有一些操作（如加载电影视频和加载电影信用）稍后开始，导致跟踪总共花费319 ms。</p><p> From looking at the source code of the app, I can see that we kick off the fetches for  movie-videos and  movie-credits  after the  movie-details request has returned a response, which means the rendering for that data also starts later. This is unnecessary, as the fetches for videos and credits do not depend on the data returned in the response of  movie-details, which just fetches basic movie metadata like the title and description. We can come up with two paths for optimization:</p><p> 通过查看应用程序的源代码，我可以看到在电影细节请求返回响应之后，我们开始了对电影视频和电影信用的获取，这意味着该数据的渲染也将在以后开始。这是没有必要的，因为对视频和字幕的获取不依赖于电影细节响应中返回的数据，而电影细节只是获取诸如标题和描述之类的基本电影元数据。我们可以提出两种优化路径：</p><p> Start the fetches for videos and credits immediately at the start, at the same time we start the  movie-details request.</p><p> 首先，立即开始对视频和字幕的提取，同时我们启动电影详细信息请求。</p><p> The API we are using to fetch movie information supports batch fetches, so we could batch fetch the video and credit information within the same  movie-details request and avoid making multiple requests altogether.</p><p> 我们用于获取电影信息的API支持批量获取，因此我们可以批量获取同一电影详细信息请求中的视频和信用信息，而避免一并提出多个请求。</p><p> We choose to implement #2, as our API client for the movies service already has support for batch fetching. The code diff looks like this:</p><p> 我们选择实施＃2，因为我们的电影服务API客户端已经支持批量提取。代码差异如下所示：</p><p>  After making this change, we release a new version of the app and collect some more traces. Here’s a trace for the same screen, from the new version:</p><p>  进行此更改后，我们发布了该应用程序的新版本并收集了更多跟踪。这是来自新版本的同一屏幕的跟踪： </p><p>  I chose a trace that came from the same device model, and had roughly similar durations for the network requests, as variance in request latencies can skew the overall duration of a trace.</p><p>我选择了一条来自同一设备型号的跟踪，并且对网络请求的持续时间大致相同，因为请求等待时间的差异可能会使跟踪的总体持续时间发生偏差。</p><p> We immediately notice that the separate fetches for videos and credits are gone, since these have been batched into the single  movie-details request. As a result, the duration for this trace is  143 ms, which is a  55% decrease from the original!</p><p> 我们立即注意到，视频和字幕的单独提取已消失，因为它们已被批处理到单个电影详细信息请求中。结果，此跟踪的持续时间为143毫秒，比原始时间减少了55％！</p><p>  In addition to providing higher-level constructs like spans, we also run a sampling profiler to collect function-level performance data. Unlike tools like Instruments and Android Profiler, which require you physically connect a development device and capture a profile on your computer, all of Specto’s profiling data is collected in production on real user devices —  you can focus on shipping your app and not have to worry about trying to simulate the multitude of performance scenarios that may occur in the real world.</p><p>  除了提供跨度之类的更高级别的构造之外，我们还运行一个采样探查器以收集功能级别的性能数据。与要求您物理连接开发设备并在计算机上捕获配置文件的Instruments和Android Profiler之类的工具不同，Specto的所有配置文件数据都是在实际用户设备上的生产环境中收集的-您可以专注于交付应用程序而不必担心关于尝试模拟现实世界中可能出现的多种性能场景。</p><p> In any trace, you can open the  Call Trees menu in the top right of the trace detail page to view a tree representation of samples collected during the execution of a trace. For example, we can see this call tree in a trace captured in the startup path of the same app described in the prior example:</p><p> 在任何跟踪中，都可以打开跟踪详细信息页面右上角的“调用树”菜单，以查看在跟踪执行期间收集的样本的树表示。例如，我们可以在上一个示例中描述的同一应用程序的启动路径中捕获的跟踪中看到此调用树：</p><p>  This runs during the initialization of a widely used 3rd party SDK, which executes somewhat expensive (~170ms) code that writes to a SQLite database on a background queue. This isn’t an immediate cause for concern since this code is  not running on the main thread, but if it was, we would want to move this code out of the startup path to make the application more responsive.</p><p>  它在广泛使用的第三方SDK的初始化期间运行，该SDK执行执行一些昂贵的代码（约170ms），并将这些代码写入后台队列中的SQLite数据库。这不是立即引起关注的原因，因为该代码未在主线程上运行，但是如果确实如此，我们希望将该代码移出启动路径，以使应用程序具有更高的响应速度。</p><p> To see even more detail, click the  View Trace button to open a flame graph, which is constructed using all of the samples collected during the trace, separated by thread. In this other trace, we can see how long our image processing operations on the movie poster image take:</p><p> 要查看更多详细信息，请单击“查看跟踪”按钮以打开一个火焰图，该图是使用跟踪期间收集的所有样本（以线程分隔）构建的。在另一条迹线中，我们可以看到对电影海报图像的图像处理操作需要花费多长时间：</p><p>  Thank you for reading! We’re always trying to improve the Specto platform by adding new features to make it easier to detect and resolve performance problems in your apps. If you’d like to stay up to date,  follow us on Twitter, and  request access on our web site to give it a try.</p><p>  感谢您的阅读！我们一直在尝试通过添加新功能来改进Specto平台，以使其更容易检测和解决应用程序中的性能问题。如果您想了解最新信息，请在Twitter上关注我们，并请求访问我们的网站进行尝试。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/specto/visualizing-mobile-app-performance-with-specto-e95a23965221">https://medium.com/specto/visualizing-mobile-app-performance-with-specto-e95a23965221</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/性能/">#性能</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/可视化/">#可视化</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/specto/">#specto</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/mobile/">#mobile</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/跟踪/">#跟踪</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1038496.html"><img src="http://img2.diglog.com/img/2020/12/thumb_788b460ef2bab67749ff318f312453c3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038496.html">Radeon RX 6900 XT评测：售价999美元，与6800 XT相比，GPU仅提供了次要的性能提升，但与Nvidia更高价的RTX 3090竞争 </a></div><span class="my_story_list_date">2020-12-9 7:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038384.html"><img src="http://img2.diglog.com/img/2020/12/thumb_28257ebc7f8bfe57cd4181898a718482.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038384.html">Apple Silicon Games-Apple Silicon Macs的400多个游戏性能报告 </a></div><span class="my_story_list_date">2020-12-8 14:45</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038129.html"><img src="http://img2.diglog.com/img/2020/12/thumb_fd947fbbf3e284478aae1be18e4ad13e.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038129.html">为什么我们从bcc-tools切换到libbpf-tools进行BPF性能分析 </a></div><span class="my_story_list_date">2020-12-7 4:28</span></div><div class="col-sm"><div><a target="_blank" href="/story/1037782.html"><img src="http://img2.diglog.com/img/2020/12/thumb_95032a560a0255d4163682f305310290.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1037782.html">Chrome浏览器的新“缓存分区”系统会影响Google字体的性能 </a></div><span class="my_story_list_date">2020-12-5 4:12</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>