<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>解密信号应用 Decrypting the Signal App</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Decrypting the Signal App<br/>解密信号应用 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-11 19:06:21</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/0d7d2fc61476e38172a1fc5f44f86e1d.jpg"><img src="http://img2.diglog.com/img/2020/12/0d7d2fc61476e38172a1fc5f44f86e1d.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Gang members and drug dealers have been quick to adopt ways to screen their communications. This is why law enforcement agencies are seeing a rapid rise in the adoption of highly encrypted apps like Signal, which incorporate capabilities like image blurring to stop police from reviewing data.</p><p>帮派成员和毒贩们迅速采取了掩护其通讯的方式。这就是为什么执法机构看到采用诸如Signal之类的高度加密应用程序的迅速增加的原因，该应用程序包含图像模糊等功能以阻止警察查看数据。</p><p>  Decrypting messages and attachments sent with Signal has been all but impossible…until now.</p><p>  几乎无法解密随Signal发送的消息和附件……直到现在。</p><p>    Signal is an encrypted communication application designed to keep sent messages and attachments as safe as possible from 3 rd-party programs. Signal not only uses end-to-end encryption for the data it sends, but the app also employs a proprietary open-source encryption protocol called “Signal Protocol™“. Apps like this make parsing data for forensic analysis extremely difficult.</p><p>    Signal是一种加密的通信应用程序，旨在使来自第三方程序的已发送消息和附件尽可能安全。 Signal不仅对其发送的数据使用端到端加密，而且该应用程序还采用了专有的开源加密协议“ Signal Protocol™”。这样的应用程序使解析数据以进行法医分析变得极为困难。</p><p>  The pandemic and its effects have driven unprecedented sign-ups for Signal, as people started communicating more online. According to analytics firm  App Annie, Signal was downloaded more than one million times worldwide in May 2020.</p><p>  随着人们开始更多地在线交流，这种大流行及其影响推动了Signal的空前注册。根据分析公司App Annie的数据，到2020年5月，Signal在全球的下载量超过了100万次。</p><p>  Criminals are using this application to communicate, send attachments, and making illegal deals that they want to keep discrete and out of sight from law enforcement. Because it encrypts virtually all its metadata to protect its users, efforts have been put forward by legal authorities to require developers of encrypted software to enable a “backdoor” that makes it possible for them to access people’s data.</p><p>  犯罪分子正在使用此应用程序进行通信，发送附件并进行非法交易，以使他们与执法部门保持离散和不可见。由于它实际上对所有元数据都进行了加密以保护用户，因此，法律机构已经提出了要求加密软件开发人员启用“后门”的措施，以使他们能够访问人们的数据。</p><p>  Until such agreements are reached, Cellebrite continues to work diligently with law enforcement to enable agencies to decrypt and decode data from the Signal app using  Cellebrite Physical Analyzer and following extractions performed by  Cellebrite Advanced Services. Let’s take a closer look at how Cellebrite is making this possible.</p><p>  在达成此类协议之前，Cellebrite会继续与执法部门密切合作，以使机构能够使用Cellebrite Physical Analyzer以及Cellebrite Advanced Services执行的提取操作，对Signal应用程序中的数据进行解密和解码。让我们仔细看看Cellebrite如何使之成为可能。</p><p>        Signal keeps its database encrypted using SqlScipher, so reading it requires a key. We found that acquiring the key requires reading a value from the shared preferences file and decrypting it using a key called “AndroidSecretKey”, which is saved by an android feature called “Keystore”.</p><p>        Signal使用SqlScipher对其数据库进行加密，因此读取它需要一个密钥。我们发现获取密钥需要从共享的首选项文件中读取一个值，并使用名为“ AndroidSecretKey”的密钥对其进行解密，该密钥由名为“ Keystore”的android功能保存。 </p><p>  Once the decrypted key is obtained, we needed to know how to decrypt the database. To do it, we used Signal’s open-source code and looked for any call to the database. After reviewing dozens of code classes, we finally found what we were looking for:</p><p>获得解密的密钥后，我们需要知道如何解密数据库。为此，我们使用了Signal的开源代码，并查找了对数据库的任何调用。在回顾了几十个代码类之后，我们终于找到了我们想要的东西：</p><p>    After finding this, we simply ran SqlCipher on the database with the decrypted key and the values 4096 and 1 for page size and kdf iterations. By doing so we managed to decrypt the database.</p><p>    找到这个之后，我们简单地在数据库上运行SqlCipher，解密的密钥以及页面大小和kdf迭代的值4096和1。通过这样做，我们设法解密了数据库。</p><p>  A new sub-node was then shown on PA under “signal.db”, called “signal.db.decrypted”. This is what our new database looks like now.</p><p>  然后在PA的“ signal.db”下显示了一个新的子节点，称为“ signal.db.decrypted”。这就是我们新数据库现在的样子。</p><p>    The messages are stored under the “signal.db.decrypted” file in a table called “sms” and the attachments are stored under the “app_parts” folder.</p><p>    邮件存储在名为“ sms”的表中的“ signal.db.decrypted”文件下，附件存储在“ app_parts”文件夹下。</p><p>  Linking the messages and the attachments requires parsing both the “sms” table and another table called “part.”</p><p>  链接消息和附件需要同时解析“ sms”表和另一个称为“ part”的表。</p><p>    After linking the attachment files and the messages we found that the attachments are also encrypted. This time, the encryption is even harder to crack. We looked again into the shared preferences file and found a value under “pref_attachment_encrypted_secret” that has “data” and “iv” fields under it.</p><p>    链接附件文件和消息后，我们发现附件也已加密。这次，加密更加难以破解。我们再次查看了共享的首选项文件，并在“ pref_attachment_encrypted_secret”下找到了一个值，该值下具有“ data”和“ iv”字段。</p><p>    The “data” field contains an encrypted json file, that once decrypted, contains the decryption keys of the sent attachments.  This json contains three keys: “ClassicCipherKey“, “ClassicMacKey“, and “ModernKey“.</p><p>    “数据”字段包含一个加密的json文件，该文件一旦被解密，便包含已发送附件的解密密钥。该json包含三个键：“ ClassicCipherKey”，“ ClassicMacKey”和“ ModernKey”。 </p><p>  The newer versions of Signal use the “ModernKey“. After getting the “ModernKey“ we went to a field in the “part” table called “data_random” for each row in the table.</p><p>较新版本的Signal使用“ ModernKey”。获取“ ModernKey”后，我们进入了“部件”表中名为“ data_random”的表中每一行的字段。</p><p>  Now we needed to turn the “ModernKey” and “data_random” values into a decryption key and an “IV” for the decryption to work. There are some cases where the “IV” has a value, but in this blog, we will only specify the common case, in which the “IV” is empty. So once again, we took a look into Signal’s open-source code, and found this:</p><p>  现在我们需要将“ ModernKey”和“ data_random”值转换为解密密钥和“ IV”以使解密工作。在某些情况下，“ IV”具有值，但是在此博客中，我们仅指定“ IV”为空的常见情况。因此，我们再次查看了Signal的开源代码，发现了这一点：</p><p>    This little piece of code told us exactly what we were looking for: how the decryption key and “IV” are generated from the “ModernKey” and “data_random”. The key is hashed using a HmacSHA256 algorithm in which a new hash is created with the “ModernKey” as the initialization vector and the hash is then computed on the “data_random”.</p><p>    这小段代码完全告诉我们我们要寻找的是：如何从“ ModernKey”和“ data_random”生成解密密钥和“ IV”。使用HmacSHA256算法对密钥进行哈希处理，其中使用“ ModernKey”作为初始化向量创建新的哈希，然后在“ data_random”上计算哈希。</p><p>  After getting the decryption key, we now needed to know what decryption algorithm to use. We went back to Signal’s open-source code and found this:</p><p>  获取解密密钥后，我们现在需要知道要使用哪种解密算法。我们返回到Signal的开源代码，发现了以下内容：</p><p>    Seeing that told us that Signal uses AES encryption in CTR mode. We used our decryption key with the AES encryption in CTR mode and decrypted the attachment files.</p><p>    看到这告诉我们Signal在CTR模式下使用AES加密。我们在CTR模式下将解密密钥与AES加密一起使用，并对附件文件进行了解密。</p><p>  After decrypting the files, we got a new set of sub-nodes under each node in the “app_parts” folder.</p><p>  解密文件后，我们在“ app_parts”文件夹中的每个节点下获得了一组新的子节点。</p><p>    These files are the attachments that were sent in the Signal messages. Now, using the link between messages and attachments we created when we parsed the messages, we can add the attachments to the conversation and see the chats as they were seen by the chat participants.</p><p>    这些文件是信号消息中发送的附件。现在，使用在解析消息时创建的消息和附件之间的链接，可以将附件添加到对话中，并查看聊天参与者看到的聊天内容。 </p><p>    Decrypting Signal messages and attachments was not an easy task. It required extensive research on many different fronts to create new capabilities from scratch. At Cellebrite, however, finding new ways to help those who make our world a safer place is what we’re dedicated to doing every day.</p><p>解密信号消息和附件不是一件容易的事。 为了从头开始创建新功能，它需要在许多不同方面进行大量研究。 但是，在Cellebrite，寻找新方法来帮助那些使我们的世界更安全的人，这是我们每天致力于的工作。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.cellebrite.com/en/blog/cellebrites-new-solution-for-decrypting-the-signal-app/">https://www.cellebrite.com/en/blog/cellebrites-new-solution-for-decrypting-the-signal-app/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/信号/">#信号</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/signal/">#signal</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>