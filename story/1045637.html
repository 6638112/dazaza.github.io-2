<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>RAM是新磁盘–以及如何衡量其性能（2015） </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">RAM是新磁盘–以及如何衡量其性能（2015） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-22 03:51:05</div><div class="page_narrow text-break page_content"><p>如果您尚未阅读本系列的前几部分，请参见以下链接：[第1部分|第2部分 ]。</p><p>  在本系列的第一部分中，我说过RAM访问是现代内存数据库引擎的慢速组件，为了提高性能，您希望尽可能减少RAM访问。新的列式数据格式减少了内存流量，这是实现出色的内存处理性能的最重要的推动力，而SIMD只是锦上添花。</p><p> 在第二部分中，我还展示了如何使用Linux perf stat命令来测量（Oracle）进程的CPU效率。您的应用程序实际使用CPU执行单元的程度取决于许多因素。最大的因素是您的进程的缓存效率取决于CPU缓存大小和应用程序的内存访问模式。无论top或vmstat之类的OS CPU记帐工具如何显示，您的``100％繁忙''CPU可能实际上会在内部空闲时花费大量时间，并且管道停滞不前，等待某些事件（例如内存行到达）从RAM）发生。</p><p> 幸运的是，由于现代处理器内置了CPU性能计数器（CPC），因此有许多工具可以测量CPU内部实际发生的情况。</p><p> 理解CPU效率的一个重要指标是IPC（每个周期的指令）。几年前，人们实际上在谈论反指标CPI（每条指令的周期），因为完成一条指令的执行平均要花费一个以上的CPU周期（同样由于上述原因，例如内存停顿）。但是，由于当今的超标量处理器在现代CPU的多个执行单元上无序执行-并且具有大的CPU缓存-一个经过优化的应用程序可以在单个CPU周期内执行多个指令，因此使用IPC（每周期指令数）指标。使用IPC，越高越好。</p><p> 这是上一篇文章的摘要，该过程正在对Oracle表进行完全缓存的全表扫描（以普通的面向行格式存储）：</p><p> 进程ID＆＃39; 34783＆＃39;的性能计数器统计信息：27373.819908任务时钟＃0.912 CPU使用了86,428,653,040周期＃3.157 GHz [33.33％] 32,115,412,877指令＃0.37 insns每个周期＃2.39每个insn停止的周期[40.00％] 76,697,049,420失速的循环前端＃88.74％的前端循环空闲[40.00％] 58,627,393,395失速的循环后端＃67.83％的后端循环空闲[40.00％] 256,440,384高速缓存引用＃9.368 M / sec [26.67％] 222,036,981高速缓存丢失＃86.584所有缓存参考的百分比[26.66％] 30.000601214秒已过去的时间 </p><p>上述任务的IPC非常糟糕– CPU每个CPU周期只能完成0.37条指令。平均而言，每条指令执行在执行管道中停顿了2.39个CPU周期。</p><p> 注意：可以使用各种其他指标来深入研究为什么CPU花费这么多时间停滞（例如高速缓存未命中和RAM访问）。我在本系列的第2部分中介绍了典型的性能统计指标，因此这里不再赘述。</p><p>  我实验的目的是在不同的数据存储格式上测量Oracle中不同数据扫描方法的CPU效率数量。我只关注数据扫描和过滤，而不关注联接或聚合。我确保所有测试运行都将所有内容缓存在Oracle的缓冲区缓存或内存中的列存储中-因此磁盘IO并不是此处考虑的因素（同样，请在本系列的第2部分中详细了解我的测试环境设置）。</p><p>   尽管我正在测试全表扫描速度，但我还添加了两个通过索引范围扫描来扫描整个表行的示例。这使我能够显示访问表的大部分行时索引范围扫描的效率如何，即使所有行都缓存在内存中也是如此。即使您在某些测试中看到了不同的WHERE子句，它们的设计也都使其遍历表的所有行（只是使用不同的访问模式和代码路径）。</p><p>              请注意，除了最后一个实验以外，所有实验都是如何在启用了不同选项（例如索引扫描或内存中访问路径）的情况下扫描同一物理表的。上一个实验针对的是同一张表的副本（相同的列，相同的行），但只是以HCC格式进行了物理格式化（并完全缓存在缓冲区缓存中）。</p><p>  仅查看不同实验的CPU性能计数器是不够的，它们太低了。从整体上看，我们还想知道应用程序正在执行多少工作（例如逻辑IO等）以及在每种情况下最终要处理多少行。我还验证了我是否确实获得了所需的确切执行计划，访问路径，并且使用常规Oracle指标没有发生物理IO或其他等待事件（请参见下面的日志）。</p><p> 这是带有SQL监控报告，快照程序和性能统计信息的完整性能编号的实验日志文件： </p><p>我还将所有这些数字（加上一些衍生值）放入电子表格中。 为了方便起见，我粘贴了以下数据的屏幕截图，但是您可以在此处访问带有原始数据和图表的整个电子表格（请注意，电子表格中具有多个选项卡和可配置的数据透视图）：  让我们从简单的事情开始，逐步深入研究。 我将从列出task-clock-ms指标开始，该指标显示每次测试表扫描中Oracle进程的CPU时间使用情况（以毫秒为单位）。 此指标来自操作系统级别，而不来自CPU内部： </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://tanelpoder.com/2015/11/30/ram-is-the-new-disk-and-how-to-measure-its-performance-part-3-cpu-instructions-cycles/">https://tanelpoder.com/2015/11/30/ram-is-the-new-disk-and-how-to-measure-its-performance-part-3-cpu-instructions-cycles/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/性能/">#性能</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/衡量/">#衡量</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/disk/">#disk</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cpu/">#cpu</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1045595.html"><img src="http://img2.diglog.com/img/2021/1/thumb_051cf1d37da77a8c1be571c604e0ca9d.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1045595.html">Dropboxs性能多年来一直在下降，我对此已经足够了 </a></div><span class="my_story_list_date">2021-1-22 0:42</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044738.html"><img src="http://img2.diglog.com/img/2021/1/thumb_3728e5039965d841298ace319f67aab3.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044738.html">GCP在2021年云报告中超越Azure，AWS </a></div><span class="my_story_list_date">2021-1-18 0:23</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044116.html"><img src="http://img2.diglog.com/img/2021/1/thumb_156ccb0a9299c2db9e6ede8102fadb1c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044116.html">2021年云报告 </a></div><span class="my_story_list_date">2021-1-15 20:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044084.html"><img src="http://img2.diglog.com/img/2021/1/thumb_3cb551cd2577aa2ff80b2755c47aca98.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044084.html">在M1 Mac Mini和Nvidia V100上分析Tensorflow训练的性能 </a></div><span class="my_story_list_date">2021-1-15 20:3</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>