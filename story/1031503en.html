<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>忍者：一种简单的构建方式</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">忍者：一种简单的构建方式</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-27 23:06:06</div><div class="page_narrow text-break page_content"><p>Hello! Every so often I find a new piece of software I really like, and todayI want to talk about one of my recent favourites:  ninja!</p><p>你好!。每隔一段时间我就会发现一款我真的很喜欢的新软件，今天我想谈谈我最近最喜欢的一款软件：忍者！</p><p>  I do a lot of small projects where I want to set up incremental builds – forexample, right now I’m writing a zine about bash, and I have one  .svg filefor each page of the zine. I need to convert the SVGs to PDFs, and I’d beendoing it something like this:</p><p>我做了很多想要设置增量构建的小项目-例如，现在我正在写一篇关于bash的杂志，并且我为该杂志的每一页都有一个.svg文件。我需要将SVG转换为PDF，我会将其转换为如下内容：</p><p> for i in *.svgdo svg2pdf $i $i.pdf # or ${i/.svg/.pdf} if you want to get really fancydone</p><p>对于*.svgdo svg2pdf$I$i.pdf#或${i/.svg/.pdf}中的I，如果您想真正完成。</p><p> This works fine, but my  svg2pdf script is a little slow (it uses Inkscape), and it’s annoyingto have to wait 90 seconds or whatever to rebuild all the PDFs when I’ve just updated 1 page.</p><p>这很好用，但是我的svg2pdf脚本有点慢(它使用Inkscape)，当我刚刚更新了1个页面时，不得不等待90秒或其他什么东西才能重新构建所有的PDF，这是很烦人的。</p><p>  In the past I’ve been pretty put off by using a Build System like make or bazelfor my small projects because bazel is this Big Complicated Thing and  makefeels a little arcane to me. I don’t really know how to use either of them.</p><p>过去，在我的小项目中使用Make或Bazel这样的构建系统会让我相当反感，因为Bazel是一个很大、很复杂的东西，Make对我来说有点神秘。我真的不知道怎么用它们中的任何一个。</p><p> So for a long time I’ve just written a bash script or something for my buildsand resigned myself to just waiting for a minute sometimes.</p><p>因此，很长一段时间以来，我只是为我的建筑写了一个狂欢脚本或其他东西，并听天由命，有时只是等待一分钟。</p><p>  But ninja is not complicated! Here is literally everything I know about ninjabuild file syntax: how to create a  rule and a  build:</p><p>但是忍者并不复杂！以下是我所知道的关于忍者构建文件语法的所有内容：如何创建规则和构建：</p><p> a  rule has a command and description (the description is just for humans to read so you can tell what it’s doing when it’s building your code)</p><p>规则有一个命令和描述(描述只是供人类阅读，这样您就可以在构建代码时知道它在做什么)</p><p>  the syntax for  build is  build output_file: rule_name input_files. Here’sone using the  svg2pdf rule. The output goes in  $out in the rule and theinput goes in  $in.</p><p>构建的语法是build output_file：Rule_name input_files。这里有一个使用svg2pdf规则的例子。规则中的输出为in$out，输入为$in。</p><p>  That’s it! If you put those two things in a file called  build.ninja and then run  ninja,ninja will run  inkscape variables.svg --export-text-to-path --export-pdf=pdfs/variables.pdf. And then if you run it again, it won’t runanything (because it can tell that you’ve already built  pdfs/variables.pdf and you’re up to date)</p><p>就这样!。如果您将这两个内容放入名为build.ninja的文件中，然后运行ninja，则ninja将运行Inkscape variables.svg--export-text-to-path--export-pdf=pdfs/variables.pdf。如果您再次运行它，它将不会运行任何内容(因为它可以告诉您已经构建了pdfs/variables.pdf，并且您是最新的)。</p><p> Ninja has a few more features than this (see  the manual), but I haven’t used them yet. It wasoriginally built  for Chromium, so even with a small feature set it can support large builds.</p><p>忍者还有一些比这更多的功能(参见手册)，但我还没有用过它们。它最初是为Chromium构建的，所以即使功能集很小，它也可以支持大型构建。</p><p>  The magic of ninja is that instead of having to use some confusing BuildLanguage that’s hard to remember because you use it so infrequently (likemake), instead the ninja language is SUPER simple, and if you want to dosomething complicated then you just generate the build file you want using anyprogramming language you want.</p><p>忍者的神奇之处在于，不需要使用一些令人困惑的BuildLanguage，因为你很少使用它(就像Make一样)，所以很难记住它，相反，忍者语言超级简单，如果你想做一些复杂的事情，那么你只需使用你想要的任何编程语言生成你想要的构建文件。</p><p> I like to make a  build.py file or that looks something like this, thatcreates the ninja build file and then runs  ninja:</p><p>我喜欢创建一个build.py文件，或者类似这样的文件，它创建忍者构建文件，然后运行忍者：</p><p> with open(&#39;build.ninja&#39;, &#39;w&#39;) as ninja_file: # write some rules ninja_file.write(&#34;&#34;&#34;rule svg2pdf command = inkscape $in --export-text-to-path --export-pdf=$out description = svg2pdf $in $out&#34;&#34;&#34;) # some for loop with every file I need to build for filename in things_to_convert: ninja_file.write(f&#34;&#34;&#34;build {filename.replace(&#39;svg&#39;, &#39;pdf&#39;)}: svg2pdf {filename}&#34;&#34;&#34;)# run ninjaimport subprocesssubprocess.check_call([&#39;ninja&#39;])</p><p>将open(&#39；build.ninja&#39；，&#39；w&#34；)作为ninja_file：#写入一些规则ninsa_file.write(&#34；&#34；&#34；&#34；Rule svg2pdf command=Inkscape$in--export-text-to-path--export-pdf=$out description=svg2pdf$in$out&#34；&#34；&#34；&#34；)#对于我需要为Things_to_Convert中的文件名构建的每个文件，使用一些for循环：ninsa_file.write(f&#34；&#34；&#34；&#34；Build{filename.place(&#39；svg&#39；，&#39；pdf&#39；)}：svg2pdf{filename}&#34；&#34；&#34；)#运行忍者端口subprocesssubprocess.check_call([&#39；ninja&#39；])。</p><p> I’m sure there are a bunch of ninja best practices, but I don’t know them andfor my small projects I find this works well.</p><p>我相信有很多忍者的最佳实践，但是我不知道，对于我的小项目来说，我发现这个方法效果很好。</p><p>  I don’t know too much about  Meson yet,but recently I was building a C program ( plocate, a faster alternative to  locate)and I noticed that instead of the usual  ./configure; make; make install,there were different build instructions:</p><p>我还不太了解介子，但是最近我在构建一个C程序(plocate，一种更快的定位方法)，我注意到与通常的./configure；make；make install不同，有不同的构建说明：</p><p>  It seems like Meson is a build system for C/C++/Java/Rust/Fortran that can useninja as a backend.</p><p>似乎Meson是一个C/C++/Java/Rust/Fortran的构建系统，可以使用JINJA作为后端。</p><p>  I’ve been using ninja for a few months now. I really like it and it’s caused meapproximately 0 build-related headaches which feels pretty magical to me.</p><p>我已经用忍者几个月了。我真的很喜欢它，它给我带来了大约0个与构建相关的头痛，这对我来说感觉相当神奇。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://jvns.ca/blog/2020/10/26/ninja--a-simple-way-to-do-builds/">https://jvns.ca/blog/2020/10/26/ninja--a-simple-way-to-do-builds/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/构建/">#构建</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/simple/">#simple</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>