<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>面对无声数据损坏的Facebook架构师 Facebook Architects Around Silent Data Corruption</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Facebook Architects Around Silent Data Corruption<br/>面对无声数据损坏的Facebook架构师 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-02 14:01:08</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/e0689a138a8181b2e70db68189fcde55.jpg"><img src="http://img2.diglog.com/img/2021/3/e0689a138a8181b2e70db68189fcde55.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Silent but deadly: there is nothing more destructive than data corruptions that cannot be caught by the various error capture tools in hardware and even in software, can be hard to spot before they have infected an entire application.</p><p>无声但致命：没有比数据损坏更具破坏性的数据了，它们无法被硬件甚至软件中的各种错误捕获工具捕获，在感染整个应用程序之前很难发现它们。</p><p> This is especially devastating at Facebook scale but engineering teams at the social giant have discovered strategies to keep a local problem from going global. A single hardware-rooted error can cascade into a massive problem when multiplied at hyperscale and for Facebook, keeping this at bay takes a combination of hardware resiliency, production detection mechanisms, and a broader fault-tolerant software architecture.</p><p> 这在Facebook规模上尤其具有毁灭性，但是这家社交巨头的工程团队已经发现了防止局部问题走向全球的策略。单个硬件根源的错误在以超大规模乘以Facebook的情况下成倍增加时，可能会成为一个大问题，要制止这一问题需要结合硬件弹性，生产检测机制以及更广泛的容错软件体系结构。</p><p> Facebook’s infrastructure team started an effort to understand the roots and fixes for silent data corruption in 2018 to understand how fleet-wide fixes might look—and what those might detection strategies could cost in terms of overhead.</p><p> Facebook的基础架构团队开始努力了解2018年无声数据损坏的根源和修补程序，以了解整个机队范围内的修补程序的外观以及这些检测策略可能在开销方面造成的成本。</p><p> Engineers found that many of the cascading errors are the result of CPUs in production but not always due to the “soft errors” of radiation or synthetic fault injection. Rather, they find these can happen randomly on CPUs in repeatable ways. Although ECC is useful, this is focused on problems in SRAM but other elements are susceptible. The Facebook engineering team that reported on these problems finds that CPU silent data corruptions are actually  orders of magnitude higher than soft-errors due to a lack of error correction in other blocks.</p><p> 工程师发现，许多级联错误是生产中的CPU造成的，但并非总是由于辐射或合成故障注入的“软错误”引起的。相反，他们发现这些可以以可重复的方式在CPU上随机发生。尽管ECC很有用，但它专注于SRAM中的问题，但其他元素也容易受到影响。报道了这些问题的Facebook工程团队发现，由于其他模块中未进行纠错，CPU静默数据损坏实际上比软错误要高几个数量级。</p><p> Increased CPU complexity opens the doors to more errors and when compounded at hyperscale datacenter levels with ever-denser nodes, these at-scale problems will only become more problematic and widespread. At the hardware level, the problems can range from general device errors (placement and routing problems can lead to different arrival times for signals, causing bit-flips, for instance) and more manufacturing-centric problems like etching errors still happen. Further, early life failures of devices and degradation of existing CPUs can also have hard-to-detect impacts.</p><p> CPU复杂性的增加为更多错误打开了大门，而在超大规模数据中心级与日趋密集的节点配合使用时，这些大规模问题只会变得更加棘手且分布广泛。在硬件级别，问题的范围可能是一般的设备错误（布局和布线问题可能导致信号的到达时间不同，例如导致比特翻转），并且仍然出现更多以制造为中心的问题，例如蚀刻错误。此外，设备的早期使用寿命故障和现有CPU的性能下降也可能带来难以检测的影响。</p><p> For example, when you perform 2×3, the CPU may give a result of 5 instead of 6 silently under certain microarchitectural conditions without any indication of the miscomputation in the system event or error logs. As a result, a service utilizing the CPU is potentially unaware of the computational accuracy and keeps consuming the incorrect values in the application.</p><p> 例如，当您执行2×3时，在某些微体系结构条件下，CPU可能会静默给出5而不是6的结果，而不会在系统事件或错误日志中指示任何错误的计算。结果，利用CPU的服务可能不知道计算精度，并不断消耗应用程序中的错误值。</p><p> “Silent data corruptions are real phenomena in datacenter applications running at scale,” members from the Facebook infrastructure team  explain. “Understanding these corruptions helps us gain insights into the silicon device characteristics; through intricate instruction flows and their interactions with compilers and software architectures. Multiple strategies of detection and mitigation exist, with each contributing additional cost and complexity into a large-scale datacenter infrastructure.”</p><p> Facebook基础架构团队的成员解释说：“静音数据损坏是大规模运行的数据中心应用程序中的真实现象。” “了解这些损坏有助于我们深入了解硅器件的特性；通过复杂的指令流及其与编译器和软件体系结构的交互。存在多种检测和缓解策略，每种策略都会为大型数据中心基础架构带来额外的成本和复杂性。” </p><p> Facebook used a few reference application examples to highlight the impact of silent data corruption at scale, including an example with a Spark workflow that runs millions of computations of wordcount computations per day along with FB’s compression application, which similar millions of compression/decompression computations daily. In the compression example, Facebook observed a case where the algorithm returned a “0” size value for a single file (was supposed to be a non-zero number), therefore the file was not written into the decompressed output database. “as a result, the database had missing files. The missing files subsequently propagated to the application.  An application keeping a list of key value store mappings for compressed files immediately observes that files that were compressed are no longer recoverable. The chain of dependencies causes the application to fail.” And pretty soon, the querying infrastructure reports back with critical data loss. The problem is clear from this one example, imagine if it was larger than just compression or wordcount—Facebook can.</p><p>Facebook使用了一些参考应用程序示例来突出显示大规模静默数据损坏的影响，其中包括一个Spark工作流示例以及一个每天运行数百万次压缩/解压缩计算的FB压缩应用程序，该工作流程每天运行数百万个字数计算。 。在压缩示例中，Facebook观察到一种情况，该算法为单个文件返回了“ 0”大小值（假定为非零数字），因此该文件未写入解压缩的输出数据库中。结果，数据库缺少文件。丢失的文件随后传播到应用程序。保留压缩文件的键值存储映射列表的应用程序会立即发现，压缩后的文件不再可恢复。依赖关系链导致应用程序失败。”很快，查询基础结构就会报告严重数据丢失的情况。从这个例子可以清楚地看出问题所在，想象一下它是否大于压缩或字数统计（Facebook可以做到）。</p><p> Data corruptions propagate across the stack and manifest as application level problems. These types of errors can result in data loss and can require months of debug engineering time… With increased silicon density and technology scaling, we believe that academic researchers and industry should invest in methods to counter these issues.</p><p> 数据损坏在整个堆栈中传播，并表现为应用程序级别的问题。这些类型的错误可能导致数据丢失，并且可能需要数月的调试工程时间……随着硅密度和技术规模的提高，我们认为学术研究人员和行业应投资于应对这些问题的方法。</p><p> Debugging is arduous but it is still at the heart of how Facebook handles these silent data corruptions, although not until they’re loud enough to be heard. “To debug a silent error, we cannot proceed forward without understanding which machine level instructions are executed. We either need an ahead-of-time compiler for Java and Scala or we need a probe, which upon execution of the JIT code, provides the list of instructions executed.” Their best practices for silent error debugging include are  detailed in 5.2.</p><p> 调试工作很艰巨，但这仍然是Facebook处理这些无声数据损坏的方式的核心，尽管直到声音足够大才能被听到为止。 “要调试一个无声错误，我们必须先了解执行了哪些机器级指令，然后才能继续前进。我们要么需要针对Java和Scala的提前编译器，要么需要一个探针，该探针在执行JIT代码时提供所执行指令的列表。” 5.2中详细介绍了它们用于静默错误调试的最佳实践。</p><p> An overall suite of fault tolerance mechanisms is also key to Facebook’s strategy. These include redundancy at the software level but of course, this comes with costs. “The cost of redundancy has a direct effect on resources; the more redundant the architecture, the larger the duplicate resource pool requirements” even though this is the most certain path to probabilistic fault tolerance. Less overhead-laden ways of dealing with fault tolerance also include relying on fault tolerant libraries (PyTorch is specifically cited) although this is not “free” either, the impact on application performance is palpable.</p><p> 一套全面的容错机制也是Facebook策略的关键。这些包括软件级别的冗余，但是当然，这会带来成本。 “冗余的成本直接影响资源；体系结构越冗余，重复资源池的需求就越大”，即使这是概率容错的最确定的途径。处理容错的开销较小的方式还包括依赖容错库（特别引用了PyTorch），尽管这也不是“免费的”，但对应用程序性能的影响是显而易见的。</p><p> “This effort would need a close handshake between the hardware silent error research community and the software library community.”</p><p> “这项工作需要在硬件静默错误研究社区和软件库社区之间进行密切的握手。”</p><p> In terms of that handshake, Facebook is openly calling on datacenter device makers to understand that their largest customers are expecting more, especially given the cascading wide-net impacts of hardware-derived errors.</p><p> 就这种握手而言，Facebook公开呼吁数据中心设备制造商了解其最大客户的期望值更高，尤其是考虑到硬件衍生错误的级联广域网影响。</p><p> “Silent data corruptions are not limited to rare one in a million occurrences within a large-scale infrastructure. These errors are systemic and are not as well understood as the other failure modes like Machine Check Exceptions.” The infrastructure team adds that there are several studies evaluating the techniques to reduce soft error rate within processors those lessons can be carried into similar, repeatable SDCs which can occur at a higher rate.</p><p> “在大型基础架构中，无声数据损坏不仅限于百万分之一的事件。这些错误是系统性的，没有像机器检查异常之类的其他故障模式那么容易理解。”基础架构团队补充说，有几项研究评估了降低处理器内软错误率的技术，这些经验教训可以纳入类似的，可重复的SDC中，而SDC的发生率可能更高。 </p><p> A large part of the responsibility should be shared by device makers, Facebook says. These approaches are on the manufacturer’s side and can include beefing up the blocks on a device for better datapath protection using custom ECCs, providing better randomized testing, understanding increased density means higher propagation of errors and most important, understanding “at scale behavior” via “close partnership with customers using devices at scale to understand the impact of silent errors.” This would include occurrence rates, time to failure in production, dependency on frequency, and environmental issues that impact these errors.</p><p>Facebook说，设备制造商应该承担很大一部分责任。这些方法在制造商方面，可以包括增强设备上的模块，以使用自定义ECC提供更好的数据路径保护，提供更好的随机测试，了解增加的密度意味着更高的错误传播，最重要的是，通过“与使用大规模设备的客户紧密合作，以了解静默错误的影响。”这将包括发生率，生产中的故障时间，对频率的依赖性以及影响这些错误的环境问题。</p><p> “Facebook infrastructure has implemented multiple variants of the above hardware detection and software fault tolerant techniques in the past 18 months. Quantification of benefits and costs for each of the methods described above has helped the infrastructure to be reliable for the Facebook family of apps.” The infrastructure team plans to release a follow-on with more detail about the various trade-offs and costs for their current approaches.</p><p> “在过去的18个月中，Facebook基础设施已经实现了上述硬件检测和软件容错技术的多种变体。量化上述每种方法的收益和成本，已使基础架构对于Facebook系列应用程序而言是可靠的。”基础架构团队计划发布一个后续版本，其中详细介绍了当前方法的各种权衡和成本。</p><p> More detail, including Facebook’s best practices for fault tolerance in software and architecting around potential hardware failures can be found  here.</p><p> 您可以在此处找到更多详细信息，包括Facebook的软件容错最佳实践以及围绕潜在硬件故障的架构。</p><p> Featuring highlights, analysis, and stories from the week directly from us to your inbox with nothing in between.</p><p> 直接从我们到您的收件箱，包括本周的重点摘要，分析和故事，之间没有任何内容。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.nextplatform.com/2021/03/01/facebook-architects-around-silent-data-corruption/">https://www.nextplatform.com/2021/03/01/facebook-architects-around-silent-data-corruption/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/facebook/">#facebook</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/损坏/">#损坏</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/错误/">#错误</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>