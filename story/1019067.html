<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用OpenCL实现更快的移动GPU推断-TensorFlow博客</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用OpenCL实现更快的移动GPU推断-TensorFlow博客</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-19 13:18:17</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/28fc6d73424f8a964e290e620b203a2e.gif"><img src="http://img.diglog.com/img/2020/8/28fc6d73424f8a964e290e620b203a2e.gif" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在TensorFlow Lite(TFLite)GPU团队不断改进现有的基于OpenGL的移动GPU推理引擎的同时，我们也在不断研究其他技术。其中一个实验被证明是相当成功的，我们很兴奋地宣布，Android版基于OpenCL的移动GPU推理引擎正式推出，它在具有足够GPU工作负载的合理大小的神经网络上，提供了比我们现有的OpenGL后端高达~2倍的速度。从历史上看，OpenGL是为渲染矢量图形而设计的API。计算着色器是在OpenGL ES 3.1中添加的，但其向后兼容的API设计决策限制了我们充分发挥GPU的潜力。另一方面，OpenCL从一开始就是为使用各种加速器进行计算而设计的，因此与我们的移动GPU推理领域更相关。因此，我们研究了一个基于OpenCL的推理机，它带来了相当多的功能，可以让我们优化我们的移动GPU推理机。性能分析：优化OpenCL后端比优化OpenGL容易得多，因为OpenCL提供了很好的分析特性，而Adreno也很好地支持它们。使用这些性能分析API，我们能够非常精确地测量每个内核分派的性能。优化的工作组大小：我们观察到高通Adreno GPU上的TFLite GPU的性能对工作组大小非常敏感；选择正确的工作组大小可以提高性能，因此选择错误的工作组大小会同样程度地降低性能。不幸的是，对于具有复杂内存访问模式的复杂内核，选择正确的工作组大小并不是一件容易的事。在OpenCL中上述性能分析功能的帮助下，我们能够实现针对工作组规模的优化器，这比平均加速速度高出50%。本机16位精度浮点(FP16)：OpenCL本机支持FP16，并要求加速器指定数据类型的可用性。作为官方规范的一部分，即使是一些较老的GPU，如2012年的Adreno 305，也可以满负荷运行。另一方面，OpenGL依赖于供应商在其实现中可以选择忽略的提示，从而导致没有性能保证。常量内存：OpenCL有一个常量内存的概念。高通增加了一个物理内存，其属性使其非常适合与OpenCL的常量内存配合使用。事实证明，这对于某些特殊情况是非常有效的，例如，在神经网络的开始或结束处有非常薄的层。Adreno上的OpenCL通过与此物理常量内存和前述本地FP16支持的协同作用，能够大大超过OpenGL的性能。下面，我们展示了TFLite在CPU(大核上单线程)、使用现有OpenGL后端的GPU和使用新的OpenCL后端的GPU上的性能。图2和图3分别描述了在MNASNet 1.3和SSD MobileNet v3(Large)这两个知名神经网络上使用OpenCL的精选Android设备上推理机的性能。每组3个条形图将独立观察，显示设备上TFLite后端之间的相对加速比。我们新的OpenCL后端的速度大约是OpenGL后端的两倍，但在Adreno设备(标有SD)上做得特别好，因为我们已经使用前面提到的Adreno的性能分析器调整了工作组大小。此外，图2和图3之间的区别还显示了OpenCL在更大的网络上执行得更好。采用OpenCL推理引擎的一个主要障碍是OpenCL不是标准Android发行版的一部分。虽然主要的Android供应商将OpenCL作为其系统库的一部分，但有些用户可能无法使用OpenCL。对于这些设备，需要后退到每台Android设备上都可以使用的OpenGL后端。为了方便开发人员，我们对TFLite GPU委托做了一些修改。我们首先在运行时检查OpenCL的可用性。如果它可用，我们使用新的OpenCL后端，因为它比OpenGL后端快得多；如果它不可用或无法加载，我们将后退到现有的OpenGL后端。事实上，OpenCL后端自2019年年中以来就一直在TensorFlow存储库中，并通过TFLite GPU委托v2无缝集成，因此您可能已经通过委托的后备机制使用它了。安德烈·库利克、马蒂亚斯·格伦德曼、贾里德·杜克、莎拉·西拉贾丁，特别感谢萨钦·乔格勒卡尔为这篇博客所做的贡献。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.tensorflow.org/2020/08/faster-mobile-gpu-inference-with-opencl.html?m=1&linkId=97371455">https://blog.tensorflow.org/2020/08/faster-mobile-gpu-inference-with-opencl.html?m=1&linkId=97371455</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/opencl/">#opencl</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/mobile/">#mobile</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1018540.html"><img src="http://img.diglog.com/img/2020/8/thumb_c268e6113636a31db70b024e13df502a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1018540.html">一名大学生使用GPT-3，写了虚假的博客帖子，最终登上了HN的榜首</a></div><span class="my_story_list_date">2020-8-17 3:31</span></div><div class="col-sm"><div><a target="_blank" href="/story/1018250.html"><img src="http://img.diglog.com/img/2020/8/thumb_e76f51f459edcc01ef7bf8cf8ba48276.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1018250.html">GPT-3生成的博客帖子在黑客新闻上排名第一</a></div><span class="my_story_list_date">2020-8-15 7:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1016413.html"><img src="http://img.diglog.com/img/2020/8/thumb_706f70ae9841e07dd2384d28866e7531.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016413.html">三星“解包”活动的现场博客，会上发布了新的Note设备、Galaxy Buds、Galaxy Watch、Tab S7和S7 Plus等</a></div><span class="my_story_list_date">2020-8-5 23:39</span></div><div class="col-sm"><div><a target="_blank" href="/story/1016166.html"><img src="http://img.diglog.com/img/2020/8/thumb_76fee038427af967d4a62ff40c6ab0a4.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016166.html">论容忍复杂性(叙事性非虚构类遇见科技博客)</a></div><span class="my_story_list_date">2020-8-4 22:59</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>