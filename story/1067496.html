<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Python的比特币划伤之旅 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在Python的比特币划伤之旅 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-23 01:08:50</div><div class="page_narrow text-break page_content"><p>我发现区块链迷人，因为它将开源软件开发扩展到开源+状态。这似乎是计算范式的真正/令人兴奋的创新;我们不仅仅是分享代码，我们可以分享一个正在运行的计算机，任何人随时随地都可以以打开和权限的方式使用它。这场革命的种子可以使用比特币开始，所以我变得好奇，详细介绍了它，以便直观地了解它的工作原理。本着“我无法创造的东西我不明白的精神”，这比从头开始实现这一点更好的方法？</p><p> 我们将在纯Python中创建，数字签名和广播比特币事务，从头开始，依赖于零依赖性。在此过程中，我们将学习比特币代表价值的一点。我们去取得它。</p><p> （BTW如果此帖子的视觉格式烦恼您，请参阅jupyter笔记本版本，具有相同的内容）。</p><p>  首先，我们希望生成一个全新的加密身份，这只是私人公共键馆。比特币使用椭圆曲线加密而不是更常见的东西，如RSA来保护事务。在这里，我不会完整介绍ECC，因为其他人已经做了明显更好的工作，例如更好的工作。我发现Andrea Corbellini的博客文章系列是一个特殊的资源。在这里，我们只是写代码，但要理解为什么它有效地工作，您需要通过该系列。</p><p> 好吧，所以比特币使用secp256k1曲线。作为一个新手，我发现这部分令人着迷 - 有些不同的曲线图书馆您可以选择提供不同的专业人员和缺点和属性。 NIST发布了有关哪些使用的建议，但人们更喜欢使用不太可能在其内置后门的其他曲线（如SECP256K1）。无论如何，椭圆曲线是一个相当低的数学数学对象，只需3个整数来定义：</p><p> 来自__future__导入注释#pep 563：推迟评估dataclasses导入dataclass＃https://docs.python.org/3/library/dataclasses.html我喜欢这些很多@ dataclass类曲线：＆＃34;＆＃ 34;＆＃34;椭圆曲线在整数模型的整数领域。曲线上的点满足Y ^ 2 = x ^ 3 + a * x + b（mod p）。 ＆＃34;＆＃34;＆＃34; p：int＃的有限字段的主要模量a：int b：int＃secp256k1使用a = 0，b = 7，所以我们＆＃39;重新处理曲线Y ^ 2 = x ^ 3 + 7（mod p （P = 0x = 0x000000600/6000000/7800300c600c600c600c600ca，＃a = 0 b = 0x000000600/380000c0000c0000c0000c0000c0000c0000c0000c0000c000000ca，＃a = 0 b = 0x00000000c0000c0000c0000c0000c0000c0000c000000c600c600ca，＃a = 0 b = 0x0000000000/3000000ca，＃a = 0 b = 0x00000000000000/3000000capp = 7）</p><p> 除了实际曲线之外，我们除了曲线周期上的一个固定的“起点”，它还可以定义一个发电机点，这些曲线上的一些固定的“起始点”用于在曲线周围启动“随机行走”。发电机是公开的，并同意持续： </p><p>@ dataclass类点：＆＃34;＆＃34;＆＃34;曲线上的整数点（x，y）＆＃34;＆＃34;＆＃34;曲线：曲线X：INT Y：INT G =点（bitcoin_curve，X = 0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798，Y = 0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8）＃我们可以验证该发电机点的确是曲线，即，Y 1 2 = X ^ 3 + 7（MOD p）打印（＆＃34;发电机在曲线上：＆＃34;（g。y ** 2  -  g.x ** 3  -  7）％bitcoin_curve。p == 0）＃一些其他完全随机的点当然不会在曲线上，_MOST_可能会随机进口。种子（1337）x =随机。 RandRange（0，比特币_Curve。P）Y =随机。 RandRange（0，比特币_Curve。P）打印（＆＃34;完全随机点不是：＆＃34;（y ** 2  -  x ** 3  -  7）％比特币_curve。p == 0）</p><p>  最后，已知生成点G的顺序，并且有效地是我们在曲线周围的周期上的（x，y）整数元组方面使用的“设置的大小”。我喜欢将此信息组织成一个更多的数据结构，我会调用生成器：</p><p> @ dataclass类生成器：＆＃34;＆＃34;＆＃34;曲线上的发电机：初始点和（预计）秩序＆＃34;＆＃34;＆＃34; g：点＃曲线上的发电点n：int＃发电点的顺序，所以0 * g = n * g = inf bitcoin_gen =生成器（g = g，＃g的顺序是已知的并且可以在数学上派生N = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBAAEDCE6AF48A03BBFD25E8CD0364141</p><p> 请注意，到目前为止，我们还没有完成任何事情，这一切都只是对某些数据结构的定义，并用与比特币中使用的椭圆曲线相关的公知常数填充它们。这即将改变，因为我们已准备好生成我们的私钥。私钥（或“秘密密钥”如我所说的）即将到来）只是满足1＆lt; = key＆lt;的随机整数。 n（召回n是g的顺序）：</p><p> ＃secret_key = random.randrange（1，bitcoin_gen.nn）＃这是_would_ do secret_key = int的方式。 from_bytes（B＆＃39; Andrej很酷：P＆＃39;，＆＃39; Big＆＃39;）＃这是我将如何为再现性assert 1＆lt; secret_key＆lt;比特币_gen。 n打印（secret_key）</p><p>  这是我们的秘密密钥 - 它是一个非常突出的整数，但任何知道它可以控制与它相关的比特币区块链中拥有的所有资金。在最简单的，最常见的vanilla用例的比特币是控制您帐户的单个“密码”。当然，在我上面的一些其他Andrej手动生成了他们的秘密密钥的情况下，与这个秘密密钥相关的钱包很可能是零比特币的平衡:)。如果它没有，我们确实非常幸运。</p><p> 我们现在要生成公钥，这是事情开始变得有趣的地方。公钥是曲线上的点，从添加发电机点到自身的秘密时间。即，我们有：public_key = g + g + g +（秘密键时）+ g = secret_key * G.请注意，这里的'+'（添加）和'*'（次）符号都非常特别，略微混淆。秘密密钥是一个整数，但是发电机点G是一个（x，y）元组，它是曲线上的点，导致（x，y）元组公钥，再次曲线上的一个点。这是我们必须在椭圆曲线上实际定义加法运算符的地方。它具有一个非常具体的定义和几何解释（见上面的Andrea的发布），但实际实现相对简单： </p><p>Warning: Can only detect less than 5000 characters</p><p>Warning: Can only detect less than 5000 characters</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://karpathy.github.io/2021/06/21/blockchain/">https://karpathy.github.io/2021/06/21/blockchain/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/比特币/">#比特币</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/划伤/">#划伤</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/tour/">#tour</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/曲线/">#曲线</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>