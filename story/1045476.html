<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在iOS上运行Racket CS </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在iOS上运行Racket CS </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-21 10:19:57</div><div class="page_narrow text-break page_content"><p>几周前，我开始着手让Racket CS编译并在iOS上运行，在Matthew Flatt的大量指导下，我设法使其工作（有一些警告）。这些变更现已合并，因此我想在信息仍在脑海中的时候，我会写另一本指南。</p><p>  您需要最新版本的Racket及其与ChezScheme关联的分支，该分支是为您的主机构建的，以便进行交叉编译。要构建它们，请克隆Racket存储库并按照构建说明进行操作。如果您使用默认的make目标，那么最终将在存储库中的racket /目录顶部放置一个主机Racket安装，并以Chez Schemeat的build / src / build / cs / c /构建。</p><p> 接下来，您可以通过在racket / src /中创建一个新的build目录并通过指定自定义前缀（以便make install步骤不会覆盖主机的Racket安装）来配置交叉构建，从而对iOS的Racket CS进行交叉编译， iOS SDK的路径（或简称“ iPhoneOS”）以及主机Racket and Chez Scheme的路径。</p><p> mkdir球拍/ src / build-ios \＆amp;＆amp; cd球拍/ src / build-ios \＆amp;＆amp; ../configure \ --prefix =＆＃34; $（pwd）/../../../racket-ios&#34; \ --enable-macprefix \ --host = aarch64-apple-darwin \ --enable-ios = iPhoneOS \ --enable-racket =＆＃34; $（pwd）/../../bin/racket&#34; \ --enable-scheme =＆＃34; $（pwd）/../build/cs/c&#34; \＆amp;＆amp;使\＆amp;＆amp;进行安装</p><p> 运行上述一系列命令后，您应该最终在源存储库内的racket-ios /上进行交叉编译的Racket安装。</p><p>  我在“ Inside Racket”文档中添加了有关如何交叉编译Racketmodules的部分，因此请参考。简而言之，如果将以下模块保存在app.rkt下</p><p>   / path / to / racket / bin / racket \ --compile-any \ --compiled＆＃39; compiled_host：tarm64osx＆＃39; \ --cross \ --cross-compiler tarm64osx / path / to / racket / racket-ios / lib \ --config / path / to / racket / racket-ios / etc \ --collects / path / to / racket /球拍ios /收集\ -l- \ raco ctool --mods app.zo app.rkt </p><p>生成app.zo，这是一个二进制对象，其中包含该模块及其所有依赖项的交叉编译代码。</p><p>  要在XCode项目中链接和使用Racket CS，请从racket-ios / include /复制racketcs.h，racketcsboot.h和chezscheme.h到项目的子目录中，然后将该子目录添加到“ Header Search”中项目的“构建设置”标签下的“路径”部分。</p><p>    接下来，将来自racket-ios / lib的libracketcs.a，petite.boot，scheme.boot和racket.boot复制到项目的子目录vendor /中，并将vendor /目录拖放到XCode项目中。然后，指示XCode在“构建阶段”选项卡中将libracketcs.a和libiconv.tbd与您的代码链接。您必须使用“添加其他...”子菜单将libracketcs.a添加到您的项目中。</p><p>  接下来，添加一个名为vendor.c的新C源文件，如果提示创建Swift的桥接头，则回答“是”。我倾向于将桥接头重命名为纯bridge.h，因为我不喜欢默认情况下XCode生成的名称。如果执行此操作，则必须在“构建设置”标签中更新“ Objective-C桥接标头”设置。在bridge.h中，将vendor.h包含在vendor.h中，然后为racket_init和echo添加定义</p><p> #ifndef vendor_h #define vendor_h #include＆lt; stdlib.h＆gt; int racket_init（const char *，const char *，const char *，const char *）; void echo（const char *）; ＃万一</p><p>  #include＆lt; string.h＆gt; #include＆＃34; chezscheme.h＆＃34; #include＆＃34; racketcs.h＆＃34; #include＆＃34; vendor.h＆＃34; int racket_init（const char * petite_path，const char * scheme_path，const char * racket_path，const char * app_path）{racket_boot_arguments_t ba; memset（＆amp; ba，0，sizeof（ba））; 。 boot1_path = petite_path; 。 boot2_path = scheme_path; 。 boot3_path =球拍路径; 。 exec_file =＆＃34; example＆＃34; ; racket_boot（＆amp; ba）; racket_embedded_load_file（app_path，1）; ptr mod = Scons（Sstring_to_symbol（＆＃34; quote＆＃34;），Scons（Sstring_to_symbol（＆＃34; main＆＃34;），Snil））; racket_dynamic_require（mod，Sfalse）; Sdeactivate_thread（）;返回0; } void echo（const char * message）{Sactivate_thread（）; ptr mod = Scons（Sstring_to_symbol（＆＃34; quote＆＃34;），Scons（Sstring_to_symbol（＆＃34; main＆＃34;），Snil））; ptr echo_fn =疤痕（racket_dynamic_require（mod，Sstring_to_symbol（＆＃34; echo＆＃34;）））; racket_apply（fn，Scons（Sstring（message），Snil））; Sdeactivate_thread（）; }</p><p> 请查看Inside Racket CS文档，以获取有关Racket CS嵌入界面的详细信息。 racket_init的要点在于，它将petite.boot，scheme.boot，racket.boot和app.zo的路径作为参数，以初始化Racket，然后加载app.zo模块，您可以在AppDelegate的应用程序中执行以下操作（ _：didFinishLaunchingWithOptions :)方法： </p><p>让vendorPath = Bundle。 主要。 resourcePath！。 附加（＆＃34; / vendor＆＃34;）让ok = racket_init（vendorPath。附加（＆＃34; /petite.boot&#34;），vendorPath。附加（＆＃34; /scheme.boot&#34;） ，如果ok = 0 {打印（＆＃34;初始化失败），则将vendorPath。追加（＆＃34; /racket.boot&#34;），将vendorPath。追加（＆＃34; /app.zo&#34;）） 球拍＆＃34;）出口（1）}  在设备上编译并运行项目，您应该看到“ Hello fromRacket！”。 在您的调试控制台中打印出来。  如果将vendor /复制到项目中而不是在拖放时创建“ folderreferences”，则代码签名可能会失败并出现一个模棱两可的错误。  避免对您的任何资源使用符号链接（例如，stuffin供应商/）。 这样做会使代码复制到设备失败，并出现“安全”错误，根本没有提到根本问题。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://defn.io/2021/01/19/racket-cs-on-ios/">https://defn.io/2021/01/19/racket-cs-on-ios/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ios/">#ios</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/racket/">#racket</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1044936.html"><img src="http://img2.diglog.com/img/2021/1/thumb_3db4ee926d9a83ec21b5d7258f6f2e20.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044936.html">Apple取消了用户找到的方法的插件，以在Mac上横向加载iOS应用 </a></div><span class="my_story_list_date">2021-1-19 2:38</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044677.html"><img src="http://img2.diglog.com/img/2021/1/thumb_519d72e994d4b99b05904b5b96b38303.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044677.html">Apple禁止用户在M1 Mac上侧面加载iOS应用 </a></div><span class="my_story_list_date">2021-1-17 16:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044452.html"><img src="http://img2.diglog.com/img/2021/1/thumb_46f2778d3f141612367f83200b9ffa8d.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044452.html">在M1 Mac上不再可以侧面加载iOS应用 </a></div><span class="my_story_list_date">2021-1-16 6:34</span></div><div class="col-sm"><div><a target="_blank" href="/story/1044430.html"><img src="http://img2.diglog.com/img/2021/1/thumb_8a6a58ac55c5ee580703fdb016daa1f7.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1044430.html">苹果开始阻止M1 Mac用户从侧面加载iOS应用 </a></div><span class="my_story_list_date">2021-1-16 5:19</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>