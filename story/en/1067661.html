<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>托管监控：评估涌入云和Grafana云 Hosted Monitoring: Evaluating InfluxDB Cloud and Grafana Cloud</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Hosted Monitoring: Evaluating InfluxDB Cloud and Grafana Cloud<br/>托管监控：评估涌入云和Grafana云 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-23 18:10:10</div><div class="page_narrow text-break page_content"><p>We’ve been self-hosting Grafana and an InfluxDB database for a long time, using it for monitoring our custom application metrics. However, we started to push our patience with maintenance and the limits of performance on a $5/mo DigitalOcean droplet.</p><p>我们已经长时间一直自托管Grafana和涌入数据库，使用它来监视我们的自定义应用指标。但是，我们开始通过维护和5美元/莫数号液滴的性能限制推动我们的耐心性。</p><p> In an effort to simplify things we started exploring what hosted solutions are available. Really, we just want something simple and cheap. The two main options we considered were InfluxDB Cloud and Grafana Cloud, both offering fairly generous free-tiers.</p><p> 努力简化我们开始探索托管解决方案的东西。真的，我们只需要简单又便宜。我们考虑的两种主要选择是涌入云和格拉新云，都提供相当宽阔的自由层。</p><p>     We started with InfluxDB Cloud, mainly because we were already using InfluxDB as our data store. Thus, we didn’t have to rewrite any of our code that pushes metrics. Overall our first impressions were good, onboarding was simple and the UI looked nice. We were quickly able to get our data into InfluxDB Cloud as well, and could start setting up our panels and alerts. This is where we started to run into issues.</p><p>     我们从涌入云开始，主要是因为我们已经使用涌入作为我们的数据存储。因此，我们不必重写我们推动指标的任何代码。总的来说，我们的第一次印象是好的，船上很简单，UI看起来很好。我们也很快就可以将数据纳入涌入云，并且可以开始设置我们的面板和警报。这是我们开始遇到问题的地方。</p><p>    Coming from Grafana, we were used to a certain degree of customization. InfluxDB Cloud however offers very limited customization. For example, there are only 3 options available for Y-axis units and legend options are very limited.</p><p>    来自Grafana，我们被习惯了一定程度的定制。然而，涌入云提供了非常有限的定制。例如，Y轴单位只有3个选项，而传奇选项非常有限。</p><p>  Visually one of the most frustrating things was that the graph series colors kept changing  every time you refresh the data, making it very difficult to keep track of what you’re looking at.</p><p>  目测最令人沮丧的事情之一是，每次刷新数据时，图表系列颜色都会保持更改，使得追踪您正在查看的内容非常困难。</p><p>  Another very frustrating feature (or lack thereof) is that the hover tooltip does not give any indication of the specific series your mouse cursor is currently hovering over. A simple solution here would be to make the actively hovered series hold or emphazied.</p><p>  另一个非常令人沮丧的功能（或缺乏）是，悬停工具提示没有给出您鼠标光标目前悬停的特定系列的任何指示。这里的简单解决方案是使积极徘徊的系列保持或不均匀。</p><p>     While we  could live with the visualization and customization issues, alerts was were we completely gave up on InfluxDB Cloud. No matter how much we tried, we just weren’t able to get a simple basic alert to work.</p><p>     虽然我们可以与可视化和定制问题一起生活，但警报是我们完全放弃了涌入的云。无论我们尝试了多少，我们都无法获得一个简单的基本警报来工作。 </p><p> The process of setting up alerts was not very intuitive. For example, the “Checks” UI let’s you setup your desired thresholds. The graph includes options to toggle the threshold markers. Yet these don’t actually do anything at all, and the inputted thresholds aren’t shown in the UI. This is where I got stuck first, thinking my thresholds weren’t set, when in fact they were.</p><p>设置警报的过程不是非常直观的。例如，“检查”UI让您设置所需的阈值。该图包含切换阈值标记的选项。然而，这些实际上并不是做任何事情，并且在UI中没有显示输入的阈值。这是我先卡住的地方，认为我的门槛没有设置，而且事实上它们是。</p><p>  It’s also easy to accidentally introduce “gaps” in your threshold levels. At first you may think to setup an alert like this (OK below 10 and WARN above 10). Well, then you’re missing the value of 10 (which becomes an “unknown” state).</p><p>  在门槛水平中，它也很容易意外地引入“空白”。首先，您可能会想到这样一个警报（如下），低于10并以上警告）。嗯，那么你缺少10的值（它成为一个“未知的”状态）。</p><p>  So in this case you should setup something like this instead (WARN above 9 and OK below 10), which is  correct but just feels wrong. I’m sure they could have come up with a better solution for this.</p><p>  因此，在这种情况下，您应该根据这样设置（Warn以上9且OK低于10），这是正确的，但感觉错误。我相信他们可能会提出更好的解决方案。</p><p>  However, after adding a “Check” and setting up my “Notification Endpoint” I still wasn’t getting any alerts. After some time I realized there was another UI I had missed, namely “Notification Rules”.</p><p>  但是，在添加“检查”并设置“通知端点”后，我仍然没有得到任何警报。经过一段时间，我意识到另一个我错过了ui，即“通知规则”。</p><p>  I got quite excited at this point, since there seemed to be a lot of flexibility. I started by testing setting up an alert that would remind us every 24 hours if an alert was still critical. While this did in fact  work, it also resulted in our Slack getting completely spammed with 100+ notifications. I’m not sure why… but we quickly removed this alert.</p><p>  我此时很兴奋，因为似乎有很多灵活性。我开始通过测试设置警报，如果警报仍然至关重要，每24小时提醒我们。虽然这实际上是工作的，但它也会导致我们的松弛完全用100多个通知垃圾邮件。我不确定为什么......但我们很快就删除了这个警报。</p><p>  After this I tried setting up a simple alert for when the status changes from OK to CRIT. This however, just didn’t work. No alerts were sent. At this point we gave up, after having spent more than 1 week trying to get things to work.</p><p>  在此之后，我尝试为状态从OK到CRIT设置一个简单的警报。然而，这只是不起作用。没有警报被发送。在这一点上，我们放弃了，在花费超过1周后试图让事情上班。</p><p> One thing to keep in mind is that InfluxDB Cloud’s free tier only includes 2 alerts (so we would have definitely needed to upgrade to the paid tier if we had decided to stay with InfluxDB Cloud).</p><p> 要记住的一件事是，涌入云的免费层只包括2个警报（所以我们肯定需要升级到有偿层，如果我们决定留在涌入云端）。 </p><p> Another bug we ran into was that at one point a team member tried resetting their password, which instead created a brand new organization and was no longer able to re-join the original organization without creating a new account using a new email address…</p><p>我们遇到的另一个错误是，在一个点，一个团队成员尝试重置他们的密码，这改为创建了一个全新的组织，并且不再能够使用新的电子邮件地址创建新帐户而无法重新加入原始组织...</p><p>     Even though we were previously using Grafana for visualizations we were a little hesitant to try Grafana Cloud. The main reason was that we would need to switch from InfluxDB for our storage to either Graphite or Prometheus, which are offered on Grafana Cloud.</p><p>     即使我们以前使用的Grafana用于可视化，我们也有点犹豫了尝试Grafana云。主要原因是我们需要从涌入的涌入，为我们的存储器进行存储到Graphite或Prometheus，这些云在Grafana云上提供。</p><p> Since we are primarily monitoring basic application metrics we ideally just wanted a simple endpoint that we could push our data to (no need for fancy buffering, redundancy or error checking). Also, since our application is running in a PaaS we didn’t want to have to install any extra local dependencies in order to push data to Grafana. Initially I thought it was a requirement to have a local agent running, but we did eventually figure out how to push metrics to Grafana using the Graphite HTTP API.</p><p> 由于我们主要监视基本应用指标，我们理想地想要一个简单的端点，我们可以将数据推送到（无需花哨的缓冲，冗余或错误检查）。此外，由于我们的应用程序在PaaS中运行，我们不希望必须安装任何额外的本地依赖项，以便将数据推向Grafana。最初，我认为这是一个需要运行的本地代理，但我们最终弄清楚如何使用石墨HTTP API将指标推向Grafana。</p><p>    It was a little tricky to find, but it is possible to push data directly to Grafana Cloud using the Graphite HTTP API. The documentation can be found  here. If the link doesn’t work, try Googling for it since their docs links seem to change and break quite often.</p><p>    找到有点棘手，但可以使用石墨HTTP API将数据直接推送到Grafana云。可以在此处找到文档。如果链接不起作用，因此尝试谷歌作用，因为他们的文档链接似乎更改和打破了。</p><p> They also provide a small example  GitHub repo, which I used as a starting point.</p><p> 它们还提供了一个小示例GitHub Repo，我用作起点。</p><p>  const  API_KEY  =  &#39; &lt;orgId&gt;:&lt;token&gt; &#39; ; const  ENDPOINT  =  &#39; https://graphite-us-central1.grafana.net/metrics &#39; ; // get current unix timestamp const  time  =  Math . floor ( Date . now ()  /  1000 ); // we&#39;re reporting values every 10 seconds const  interval  =  10 ; const  data  =  {  time :  Math . floor ( time  /  interval )  *  interval ,  // align timestamp to interval  name :  &#39; app.some_metric.some_field &#39; ,  interval :  interval ,  value :  1.234 ,  tags :  [ &#39; type=foo &#39; ,  &#39; kind=bar &#39; ], }; const  headers  =  {  Authorization :  `Bearer  ${ API_KEY } `  }; got . post ( ENDPOINT ,  {  headers ,  responseType :  &#39; json &#39; ,  resolveBodyOnly :  true ,  json :  data , });</p><p>  const api_key =＆＃39; ＆lt; orgid＆gt;：＆lt;令牌＆gt; ＆＃39; ; const端点=＆＃39; https://graphite-us-central1.grafana.net/metrics＆＃39; ; //获取当前UNIX时间戳const time = math。地板（日期。现在（）/ 1000）; //WE＆＃39;每10秒报告值Const间隔= 10; const data = {时间：数学。地板（时间/间隔）*间隔，//将时间戳对齐到间隔名称：＆＃39; app.some_metric.some_field＆＃39; ，间隔：间隔，值：1.234，标签：[＆＃39;类型= foo＆＃39; ，＆＃39;亲切=酒吧＆＃39; ]，}; const标题= {授权：`持票人$ {api_key}`};得到了 。 post（端点，{标题，​​responseType：＆＃39; json＆＃39;，解决obdyonly：true，json：data，}）;</p><p> One important thing to remember with Graphite is that metrics have to be aligned to the given interval. For example, an interval of 10 means that there will be one value for the given series every 10 seconds. It is best to make sure you push your metrics slightly more frequently then the interval to make sure you don’t miss any time slots, which would result in gaps (null values) in your data.</p><p> 用石墨记住的一个重要事情是指标必须与给定的间隔对齐。例如，10的间隔意味着给定系列每10秒将有一个值。最好频繁地确保将度量稍微稍微推动您的度量，然后若要确保不会错过任何时隙，这将导致数据中的空隙（空值）。 </p><p>    Since we’ve only been using InfluxDB as a data source in Grafana previously, there was a bit of a learning curve with Graphite. In particular, I was having a hard time figuring out how to use tags. However, once you understand the syntax it’s fairly easy to use.</p><p>由于我们之前只使用涌入作为Grafana的数据源以前，因此有一点具有石墨的学习曲线。特别是，我很难弄清楚如何使用标签。但是，一旦您了解语法，它就会很容易使用。</p><p>   However, for series with tags, you first to have select  Tag: name in order to choose your metric (I didn’t realize graphite automatically created the “name” tag, so I was confused about this at first).</p><p>   但是，对于与标签的系列，您首先要选择标记：名称才能选择您的度量标准（我没有自动创建石墨，因此我首先对此感到困惑）。</p><p>    After that, you can add additional tags to filter the data by tag value, and you can also add functions such as  aliasByTags to name each series by their tag value (resulting in better looking legends).</p><p>    之后，您可以添加其他标记以通过标记值过滤数据，并且您还可以添加诸如AliasbyTags的函数以通过标签值命名每个系列（导致更好的观看图例）。</p><p>     Another bonus feature we discovered is the Synthethic Monitoring feature, also available in the free tier. It provides some basic application monitoring, with downtime monitoring and global latency checks. Nice to have!</p><p>     我们发现的另一个奖金功能是合成监控功能，也可用在免费层。它提供了一些基本的应用程序监控，具有停机时间监控和全局延迟检查。很高兴有！</p><p>     Overall both options have very generous free tiers, great for anyone looking to get started with basic monitoring. The biggest drawback with InfluxDB Cloud is that they only offer 2 alerts on the free-tier, which feels very low in my opinion.</p><p>     整体两个选项都有非常慷慨的自由层，非常适合任何希望开始基本监控的人。涌入云的最大缺点是他们只在自由层上提供2个警报，这在我看来感觉非常低。</p><p>            The biggest difference between the two is clearly the maturity and rich feature-set offered by Grafana, whereas the solution InfluxDB Cloud offers feels lacking and buggy. We’ll stick with Grafana Cloud for now!</p><p>            两者之间的最大区别显然是格拉纳纳提供的成熟和丰富的功能集，而解决方案涌入云提供缺乏和越野车。我们现在将坚持Gradan云！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://pqvst.com/2021/06/22/hosted-monitoring-evaluating-influx-and-grafana/">https://pqvst.com/2021/06/22/hosted-monitoring-evaluating-influx-and-grafana/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/监控/">#监控</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/涌入/">#涌入</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>