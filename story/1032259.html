<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Awk：`开始{`第一部分</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Awk：`开始{`第一部分</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-30 19:31:28</div><div class="page_narrow text-break page_content"><p>前几天，我正在看Bryan Cantrill的2018年演讲、铁锈和其他有趣的事情，他在讨论不同编程语言和社区的价值时发表了随意的评论。他说，“如果你拿到AWK编程语言手册…。大约两个小时后你会读完，然后你就完成了。就这样。你知道awk的一切。“。</p><p>我之前在各处都使用过awk的片段。其中大多数是在谷歌搜索利基数据文件操作时由Stack Overflow Answers给我的。但是，我没有足够的知识从头开始成功地编写一个awk程序。我绝对没有真正掌握这门语言，也没有真正掌握它的力量。而且，花几个小时来学习布莱恩·坎特里尔(Bryan Cantrill)所说的他一天使用三次的语言，听起来似乎是一个相对较小的时间投资。</p><p>原来，学习awk需要两个多小时，而我绝不是专家…。然而(增长心态！)。但是，我现在知道的足够多了，可以写一些关于要点的东西了。开始了！</p><p>AWK对于数据文件操作非常有用。我只用了几天，我希望我能投入时间早点学习它。遇到数据文件时，我通常的工作流程是将其导入Google Sheet并使用其内置函数。如果这些还不够，我会编写一些代码片断来获得我想要的信息。AWK比我以前做的要强大得多。我们来看一下，</p><p>如果我们要学习awk，我们需要知道如何运行awk程序。在shell中运行awk程序的语法为：</p><p>我们还可以编写更长的awk程序来运行，而不是内联编写awk代码。我们可以使用awk代码编写文件，然后使用-f&lt；awk-program-filename&gt；内联传递给awk。</p><p>嗯，什么是AWK计划？我们知道它最适合用于简单的数据重新格式化或操作。它的方法是对数据文件中的不同模式执行不同的操作。Awk程序的基本语法取决于这些模式和操作。</p><p>我们可以给出任意多个图案{action}对。每一对都将独立于其他对执行。这意味着如果一行匹配多个模式，则它将有多个相应的操作。在上面的示例中，我们使用换行符来分隔不同的对。与bash类似，我们还可以使用；来分隔命令并将所有内容放在一行中：pattern{action}；pattern{action}</p><p>但是，事实证明awk更有用(也更有趣！)。使用数据文件。联合国有一些公开可用的数据集。我选择了这一条有关小学、中学和大专教育的问题，首先进行深入研究。</p><p>让我们从使用awk开始了解数据的外观。NR是一个预定义变量，它记录到目前为止在文件中读取的行数。我们可以使用它来查看程序的前几行。在本例中，我们的模式将是NR&lt；=5，并且通过不包括动作，隐含的动作将被打印：</p><p>$awk&#39；NR&lt；=5&#39；Education ation.csvT07，&34；小学、中学和高等教育水平的入学人数&#34；，地区/国家/地区，年份，系列，价值，脚注，来源1，#34；合计，所有国家或地区，2005，小学注册学生(千人)，&#34；678,991.6070&#34；，&#34；联合国教育、科学及文化组织(教科文组织)，蒙特利尔，教科文组织统计研究所统计数据库，上次访问时间为2019年3月。合计，所有国家或地区，2005年，毛入学率-小学(男)，104.9360，&34；联合国教育、科学及文化组织(教科文组织)，蒙特利尔，教科文组织统计研究所统计数据库，上次访问时间为2019年3月。&#34；1，#34；合计，所有国家或地区&#34；2005年，毛入学率--小学(女)，99.9214，&#34；联合国教育、科学及文化组织(教科文组织)蒙特利尔，教科文组织统计研究所统计数据库，最后一次进入2019年3月。&#34；</p><p>好的，看起来这给了我们一些关于我们档案的信息。值得注意的是：</p><p>有两个标题行：标题行和告诉我们字段是什么的行。</p><p>…。除非有时双引号字符串中有逗号：&#34；合计，所有国家或地区&#34；</p><p>我们可以使用漂亮的向前移动NR忽略前两个标题行。我们可以匹配NR&gt；2的模式。注意：AWK是1索引的。</p><p>AWK的默认字段分隔符是空格。我们实际上可以通过打印第一个字段来看到这一点。要访问字段的值，我们使用$&lt；field_index&gt；。因此，$1是第一个字段，$2是第二个字段，依此类推。$0指的是整行。</p><p>我们可以确认我们是在空位上分开。AWK可以选择使用-F&#39；分隔符标志指定不同的字段分隔符：</p><p>太棒了！但是…。。我们在带有双引号的字符串中嵌入了逗号。果然，如果我们打印第二个字段($2)，我们会看到：</p><p>嗯哼。我们这里想要的是按内容拆分字段。这是awk没有的，但是gawk(GNU Awk)有：FPAT！从Gawk手册中可以看到：“所有正确编写的awk程序都应该与Gawk一起工作。因此，在大多数情况下，我们不会区分Gawk和其他awk实现。</p><p>听起来我们可以在这里用呆瓜代替。让我们试试模式匹配。我不打算在这里介绍正则表达式，但是我们想要的模式(由&#34；[^，]*|\&#34；[^\&#34；]+\&#34；&#34；]+\&#34；&#34；定义)是以非逗号字符开头，或者以双引号开头，只包含非引号字符，以双引号结束的任何模式：</p><p>$gawk&#39；BEGIN{FPAT=&#34；[^，]*|\&#34；[^\&#34；]+\&#34；}NR&lt；=5{print$2}&#39；Education ation.csv&#34；小学、中学和高等教育水平的入学人数总数，所有国家或地区总数#34；&#34；总数，所有国家或地区总数&#34；&#34；总数，所有国家或地区总数&#34；&#34；总计，所有国家或地区总数&#34；&#34；总计，所有国家或地区总数&#34；&#34；总计，所有国家或地区总数&#34；&#34；总计，所有国家或地区总数&#34；&#34；总计，所有国家或地区总数&#34；</p><p>我在没有解释的情况下偷偷地把一个开始放进去。让我们来个简短的切线…。</p><p>除了模式和操作之外，awk还具有BEGIN和END块的概念。在处理任何数据之前执行BEGIN。它对于声明变量或打印要显示在开头的文本非常有用。类似地，在处理数据之后执行END。它对于对数据聚合执行操作非常有用，例如求和的平均值。</p><p>这意味着如果我们想写一些“Hello，awk！”程序，我们甚至不需要数据文件就可以做到这一点。</p><p>…。回到我们的示例。在我们的示例中，我们使用BEGIN块在读取数据文件之前声明FPAT。</p><p>但是，我们只看了前5行。据我们所知，文件的其余部分可能看起来完全不同。让我们再次使用NR查看文件的更多内容。首先，让我们计算出文件有多长。我们可以用这里的最后一块。在解析完整个文件之后，我们可以看到NR的值是什么，这将告诉我们它有多少行：</p><p>好的，也许如果我们每500行打印一次，我们就会对我们正在查看的数据有所了解。我们可以将我们的模式设置为仅当NR为500的倍数时：</p><p>…。我要把这篇博文放在一个真正的悬崖衣架上。主要是因为感觉已经太久了！还有另一篇关于awk的帖子，内容是实际查看数据并对其进行操纵，以找出哪些国家在接受教育的男性和女性数量上存在明显差异。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://jemma.dev/blog/awk-part-1">https://jemma.dev/blog/awk-part-1</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/awk/">#awk</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>