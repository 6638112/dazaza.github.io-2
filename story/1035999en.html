<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>混乱阻塞Swizzle Clogging</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Swizzle Clogging<br/>混乱阻塞</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-23 06:51:04</div><div class="page_narrow text-break page_content"><p>Rigorous testing is central to our engineering process. The   features of our core are challenging, requiring us to meet exacting standards of correctness and performance. Data guarantees and transactional integrity must be maintained not only during normal operations but over a broad range of failure scenarios. At the same time, we aim to achieve performance goals such as low latencies and near-linear scalability. To meet these challenges, we use a combined regime of robust simulation, live performance testing, and hardware-based failure testing.</p><p>严格的测试对于我们的工程流程至关重要。我们核心的功能具有挑战性，要求我们满足严格的正确性和性能标准。不仅在正常操作期间，而且在各种故障场景下，都必须维护数据保证和事务完整性。同时，我们旨在实现诸如低延迟和接近线性的可扩展性等性能目标。为了应对这些挑战，我们使用了强大的仿真，实时性能测试和基于硬件的故障测试的组合方案。</p><p> Simulation is a powerful tool for testing system correctness. Our simulation technology, called Simulation, is enabled by and tightly integrated with   Flow, our programming language for actor-based concurrency. In addition to generating efficient production code, Flow works with Simulation for simulated execution.</p><p> 仿真是测试系统正确性的强大工具。我们的仿真技术称为Simulation，它是由Flow（基于基于角色的并发的编程语言）启用并与之紧密集成的。除了生成有效的生产代码外，Flow还与Simulation一起用于模拟执行。</p><p> The major goal of Simulation is to make sure that we find and diagnose issues in simulation rather than the real world. Simulation runs tens of thousands of simulations every night, each one simulating large numbers of component failures. Based on the volume of tests that we run and the increased intensity of the failures in our scenarios, we estimate that we have run the equivalent of roughly one trillion CPU-hours of simulation on FoundationDB.</p><p> 模拟的主要目的是确保我们在模拟而非现实世界中发现并诊断问题。仿真每天晚上进行数万次仿真，每一次仿真都会模拟大量的组件故障。根据我们运行的测试量以及场景中失败的加剧程度，我们估计在FoundationDB上运行的模拟时间大约相当于一万亿CPU小时。</p><p> Simulation is able to conduct a  deterministic simulation of an entire FoundationDB cluster within a single-threaded process. Determinism is crucial in that it allows perfect repeatability of a simulated run, facilitating controlled experiments to home in on issues. The simulation steps through time, synchronized across the system, representing a larger amount of real time in a smaller amount of simulated time. In practice, our simulations usually have about a 10-1 factor of real-to-simulated time, which is advantageous for the efficiency of testing.</p><p> 仿真能够在单线程进程中对整个FoundationDB集群进行确定性仿真。确定性至关重要，因为它可以使模拟运行具有完美的可重复性，从而有助于受控实验解决问题。模拟逐步穿越时间，在整个系统中同步，以较少的模拟时间表示大量的实时时间。在实践中，我们的仿真通常具有大约10-1的实际仿真时间因子，这对于提高测试效率是有利的。</p><p> We run a broad range of simulations testing various aspects of the system. For example, we run a cycle test that uses key-values pairs arranged in a ring that executes transactions to change the values in a manner designed to maintain the ring’s integrity, allowing a clear test of transactional isolation.</p><p> 我们进行了广泛的模拟测试，测试了系统的各个方面。例如，我们运行一个循环测试，该测试使用排列在环中的键-值对执行事务以更改环的值，以维护环的完整性，从而明确测试事务隔离。</p><p> Simulation simulates all physical components of a FoundationDB system, beginning with the number and type of machines in the cluster. For example, Simulation models drive performance on each machine, including drive space and the possibility of the drive filling up. Simulation also models the network, allowing a small amount of code to specify delivery of packets.</p><p> 仿真从集群中的计算机数量和类型开始，模拟FoundationDB系统的所有物理组件。例如，仿真模型可以驱动每台机器上的性能，包括驱动器空间和驱动器填满的可能性。仿真还对网络进行建模，允许少量代码指定数据包的传递。</p><p> We use Simulation to simulate failures modes at the network, machine, and datacenter levels, including connection failures, degradation of machine performance, machine shutdowns or reboots, machines coming back from the dead, etc. We stress-test all of these failure modes, failing machines at very short intervals, inducing unusually severe loads, and delaying communications channels.</p><p> 我们使用Simulation来模拟网络，计算机和数据中心级别的故障模式，包括连接故障，计算机性能下降，计算机关机或重启，计算机死机等。我们对所有这些故障模式进行压力测试，在非常短的间隔内使机器发生故障，导致异常严重的负载，并延迟了通信通道。</p><p> For a while, there was an informal competition within the engineering team to design failures that found the toughest bugs and issues the most easily. After a period of one-upsmanship, the reigning champion is called “swizzle-clogging”. To swizzle-clog, you first pick a random subset of nodes in the cluster. Then, you “clog” (stop) each of their network connections one by one over a few seconds. Finally, you unclog them in a random order, again one by one, until they are all up. This pattern seems to be particularly good at finding deep issues that only happen in the rarest real-world cases.</p><p>一段时间以来，工程团队内部进行了一场非正式的竞赛，以设计失败，发现最棘手的错误并最轻松地解决问题。经过一段时期的补习，这位在位的冠军被称为“抽izz”。要阻塞，首先要在集群中随机选择节点的子集。然后，您在几秒钟内一次“阻塞”（停止）它们的每个网络连接。最后，您以一个随机的顺序一次又一次地取消堵塞它们，直到它们全部起来。这种模式似乎特别适合发现仅在最罕见的现实情况下才会发生的深层问题。</p><p> Simulation’s success has surpassed our expectation and has been vital to our engineering team. It seems unlikely that we would have been able to build FoundationDB without this technology.</p><p> 模拟的成功超出了我们的预期，对我们的工程团队至关重要。如果没有这项技术，我们似乎不可能建立FoundationDB。</p><p> In addition to simulation, we continually run systematic performance tests on FoundationDB. Every night, we run an automated suite of performance tests using our “Circus” environment.</p><p> 除了模拟之外，我们还继续在FoundationDB上运行系统的性能测试。每天晚上，我们使用“马戏团”环境运行一套自动化的性能测试套件。</p><p> For each Circus test, we specify the characteristics of the database to be used, e.g., 2 billion key-value pairs with 16 byte keys and randomly generated 8-100 byte values. The test selects the workloads to run and the cluster to run them on. Workloads specify the characteristics and proportions of reads and writes to be performed. (See our   Performance page for representative examples.) A test can run workloads either in parallel or sequentially. Workloads are specified using the same code as for simulation, which benefits the productivity of our testing.</p><p> 对于每个马戏团测试，我们指定要使用的数据库的特征，例如20亿个键值对（具有16个字节的键）和随机生成的8-100个字节的值。该测试选择要运行的工作负载以及要在其上运行的集群。工作负载指定要执行的读取和写入的特征和比例。 （有关代表性示例，请参见“性能”页面。）测试可以并行或顺序运行工作负载。使用与仿真相同的代码指定工作负载，这有助于提高测试效率。</p><p> This process give us a daily comparison of the performance of the current code base to previous days. Performance is measured across many dimensions derived from the output of many tests. Our data exploration technology allows this output to be graphically explored, with the ability to isolate and examine key performance indicators.</p><p> 通过此过程，我们可以每天比较当前代码库与前几天的性能。性能是从许多测试的输出得出的多个维度上进行衡量的。我们的数据探究技术允许以图形方式探究此输出，并具有隔离和检查关键绩效指标的能力。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://apple.github.io/foundationdb/testing.html">https://apple.github.io/foundationdb/testing.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/阻塞/">#阻塞</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/swizzle/">#swizzle</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/测试/">#测试</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>