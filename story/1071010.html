<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>头寸、损益</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">头寸、损益</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-08-01 23:16:50</div><div class="page_narrow text-break page_content"><p>以下表达的所有观点都是作者的个人观点，并非财务或投资建议。在上一篇文章中，我们讨论了订单簿的结构和交易机制。今天，我想回顾一下这些交易发生后会发生什么。首先，我们如何不仅跟踪我们交易的内容，还跟踪我们通过交易赚取了多少利润或累积了多少损失。和以前一样，这只是一个介绍性指南，因此经验丰富的专业人士可能希望跳过。无论您选择何种交易平台，基本上它们似乎都在做同样的事情。他们让你交易，他们会管理你的资金、股票、加密货币等。从你的角度来看，这一切似乎都很简单，你点击买入或卖出，证券或加密货币就会出现在你的账户中。然而，现实可能比看起来更复杂，我们将简要介绍这个主题，作为管理头寸的技术方面的背景。交易所是可以买卖证券的场所。交易所将通过列出股票、合约等并托管交易这些所需的订单簿来促进交易。交易所将提供连通性，这是市场参与者能够连接和下订单以及接收对这些订单的响应的能力的通用术语。他们还将提供面向公众的交易数据和价格更新。这通常被称为市场数据。如今，这几乎完全是电子化的，通过网络进行通信。对于大多数交易所来说，这基本上就是他们所做的一切。在传统市场（股票、债券等）中，一般公众很少有机会接触交易所。通常较大的公司和专业机构在它们上面进行交易，并且在其中一个交易所进行交易需要各种法律安排，以及非平凡的技术设置。尽管如此，普通投资者仍然可以通过中介公司进入交易所，我们将在下一节中介绍。经纪人（通常）是一家允许普通投资者进入各种市场以买卖证券的公司。为此，经纪人必须是他们想要交易的每个交易所的参与者。当客户希望购买股票时，经纪人可以代表客户将该订单发送到交易所。除此之外，经纪人还可以为客户提供各种“增值”服务。这些可以包括但不限于： 向客户提供市场数据和订单簿信息，以便他们了解现行价格。为客户提供易于理解的用户友好交易界面，让他们可以访问多个交易所和市场（大多数零售客户既没有胃口也没有资金来建立连接到交易所所需的基础设施）。</p><p>对客户购买的证券进行托管（所有权），管理分红、投票等事项。将其公开给客户，以便他们可以看到他们拥有什么，以及它的价值。提供保证金（贷款），以便客户可以交易比他们现有现金更多的股票。对于大多数人来说，使用这些经纪人将是他们非常熟悉的事情，即使他们的股票的实际交易会发生在后台的某个地方。事实上，经纪人并不总是必须直接去交易所，许多经纪人会将客户订单路由（发送）给各种第三方，例如做市商或其他经纪人。这在 2020 年变得非常明显，当时注意到经纪人 RobinHood 正在向对冲基金 Citadel 出售客户订单流（客户订单）。现在在加密市场中显而易见的是，几乎所有主要的加密平台实际上都将这两个实体合二为一！虽然他们被称为交易所，但他们当然也是经纪人。以币安为例。他们为您提供了一种将您的资金和加密货币输入他们的系统的方法，他们管理和保管您拥有的代币和合约，并将其全部包装在一个网络界面中，可供全球的普通客户使用世界。在交易方面，他们还提供市场！ Binance 有数百个币对，每个币对都有自己的订单簿，为客户匹配交易。因此，它们同时具有经纪人和交易所的功能。时间会告诉我们这一切是如何发生的。在撰写本文时，已经有迹象表明这个相当新颖的模型开始演变成它的前身。加密货币对现在可以在 eToro 和 RobinHood 等几个（较新的）经纪商处获得，甚至芝加哥商业交易所（CME）现在也列出了比特币期货进行交易。当您使用经纪人的应用程序购买一些股票时，您会立即看到您现在是这些股票的所有者。然而，实际上，尽管购买了这些股票，您还不是它们的记录所有者。例如，这意味着您将无法获得该股票支付的股息，也无法与他们一起投票。在美国，股份的所有权在 T+2 或换言之，交易发生后的两个工作日内转移。这里的结算是指用您购买的证券换取支付的现金的行为。在加密中，事情有点不同。许多新手区块链爱好者惊讶地发现，当他们在交易所购买比特币时，他们实际上并没有在“自己的”比特币钱包中保管它。尽管他们在法律意义上拥有它，但它只是交易所数据库中的记录。要将硬币转移到他们拥有的钱包（实际所有权），他们必须首先从交易所提取硬币。然而，实际交易都发生在交易所内部，几乎从不接触区块链（主要是因为这对于正常交易来说太慢了）。</p><p>交易所失去了对物理和“虚拟”比特币数量（数据库中的数字）的跟踪，过去曾给各种客户造成了巨大的损失（我强烈推荐这个视频）。与加密中的任何事物一样，始终值得牢记格言：不是你的钥匙，不是你的硬币。分布式交易所或 DEX 是一种不同类型的交易所，纯粹存在于区块链上，交易确实在链上完成并立即结算。这些有一些有趣的交易机制，但由于区块链交易速度的限制，它们的吞吐量目前非常低。其中一些示例是 Uniswap 和 PancakeSwap。 &amp;mldr某些个人或其他实体拥有（或卖空）的证券、资产或财产的数量。交易者或投资者在通过买单进行购买时建立头寸，表明看涨意图；或者如果他们出于看跌意图出售卖空证券。因此，职位几乎可以是任何事物的所有权。如果你买房子，你就是做多房地产市场，因为你现在在房子里有一个位置。如果您以美元赚取工资并将钱存入银行账户，那么无论您拥有多少美元，您都可以做多。现在这对您来说可能无关紧要，但请考虑一下您是否想住在英国并需要将所有资产转移到那里。突然之间，汇率（以美元计的英镑价格）变得非常重要。正如定义中提到的，头寸可以是多头也可以是空头。这有时被称为位置的方向。这个概念可能非常微妙，但我们将在这里尽量保持简单。多头头寸是您购买并持有的头寸。一般来说，多头头寸在价格上涨时有利可图，而在价格下跌时则无利可图。一个简单的例子是购买一家公司的股票。如果股价上涨，您的股票现在价值更高，因为您可以以更高的价格出售它（以获取利润）。如果股价下跌，您的股票现在将贬值，因为您只能以更低的价格（亏损）出售它。空头头寸是您卖出空头的头寸。这可能意味着多种情况，具体取决于您交易的金融工具类型。卖空通常与股票市场相关，在股票市场中，交易者能够以一种方式建立头寸，如果股票价格下跌而不是上涨，他们将获利。相反，如果空头头寸的价格上涨，则该头寸将无利可图。为了能够卖空股票，需要几个步骤：</p><p>从已经拥有它们的人（例如经纪人）那里借用 100 股。无论您借多久，这样做通常都会花费您一些利息。以现行价格在市场上出售这些股票，比如 50 美元。这给我们留下了 100 * \$50 = \$5,000，并且没有份额。不过，我们仍然需要返还我们借来的那些股票。假设价格降至 45 美元。我们从市场上购买 100 股，支付 100 * \$45 = \$4,500。我们返还 100 股，我们剩下 \$5,000 - \$4,500 = \$500 的利润。即使价格下跌，我们也获利。不过，不仅仅是股票。您可以做空各种不同的工具和证券，具体取决于它们的行为方式。如果您没有头寸，买入或卖出空头的行为称为开仓。如前所述，您将在特定方向（多头或空头）开仓。如果您持有未平仓头寸，则在同一方向上买入或卖出更多（例如，多头头寸买入更多）称为增加您的头寸。相反，如果您有一个未平仓头寸并且您以相反的方向买入或卖出，那么您就被认为是在减仓。如果您减得足够多，您的头寸现在净为零（即您卖出的数量与您的多头头寸相同），这称为平仓。如果您因为关闭了现有头寸而没有头寸，则您的头寸被视为持平。</p><p>每次交易时，您都会改变当前的头寸。买入 10 股同时持有 100 的多头头寸会将您的头寸增加到 110。之后卖出 20 股将您的头寸减少到 90。一般来说，您对证券只有一个“净”头寸，这意味着随着您交易的更多位置会根据您的操作而上下波动。鉴于我们有一个头寸（甚至是平头寸），我们可以将交易“应用”到该头寸，以便获得一个新的更新头寸来说明该交易。对于那些更倾向于数学的人，给定一个位置 $P_{current}$ 和一个交易 $t$ 以及一个应用函数 $f$，我们得到以下表达式：换句话说，将一个交易应用到一个位置给我们另一个（不同的）位置 $P_{new}$。如果我们有很多交易，我们会使用结果头寸作为下一笔交易的输入继续应用这些交易。在所有这一切结束时，我们最终得到一个代表我们所做的所有交易的最终头寸。每个位置都由几个不同的值组成，这些值都告诉我们有关该位置的一些信息。在以下部分中，我们将概述它们各自的含义，以及如何计算它们。如前所述，头寸可以是多头或空头（或持平）。这可以用一个数字来表示，它代表您拥有的证券数量，以及您是做多还是做空。如果头寸为多头，则数量为正。如果它很短，则数量为负。如果仓位是平的（没有仓位），则数量为 0。当涉及到各种计算时，这在数学上非常好，我们将在后面看到。比如你持有100股，你的仓位数量是100。如果你做空100股，你的数量是-100，如果你没有仓位就是0。你会记得，每当你和某人交易时，都会导致在两个行业。交易所的公开交易信息将公布激进一方的交易，但双方都会收到一条消息，说明他们进行了交易。这些私人消息通常称为执行，它们可以被视为交易所参与者的更详细的私人消息。将为您执行一次，另一次为您的交易对手（与您交易的参与者）执行。但是，从现在开始，为了简单起见，我们将这些称为交易，因为它们本质上代表相同的事物。</p><p>从一系列交易中计算您的总数量非常简单。每笔交易都有一面（买入或卖出）以及数量和价格。要从一系列交易中获得最终头寸数量，我们只需将所有数量相加，乘以边的符号。买入的符号通常为 1，卖出交易的符号为 -1。例如，假设我们有一个数量为 -100 的小空头头寸。我们像这样进行三笔交易： 成本基础是一个代表头寸总成本的数字。如果该数字为正数，则表示您花钱购买了该职位（这使您付出了一些代价）。如果数字是负数，则意味着您在头寸上收到了资金（与成本相反）。这最初可能有悖常理，但了解该符号有助于确定您头寸的现金要素。如果您增加头寸，并给出一组交易，您的总成本基础是每笔交易的总成本之和。请记住，成本有一个符号，在这种情况下，我们从交易方获得符号，就像我们对数量所做的一样。买入的成本为正，而卖出的成本为负。例如，考虑持平仓位（0 成本基础），以及以下买入交易： 对于卖出交易，我们净空头（我们的仓位数量为负）600 股。我们的成本基础是 -\$80,000，这意味着我们从拥有这个职位中获得了这笔钱。因此，我们总共有 600 股的空头头寸，以及通过出售我们借来的股票获得的 8 万美元现金（不先借入就出售是非法的，这称为裸卖空）。给定一个具有一定数量和成本基础的职位。平均入场价格代表让您进入头寸的交易价格的加权平均值。这是一个一目了然的值，它告诉您平均以什么价格进入头寸。细心的读者可能会注意到，交易的加权平均价格实际上只是成本基础除以持仓数量：</p><p>使用之前的计算，我们的成本基础是 $51,000，我们的头寸数量是 500 张合约。因此，我们的平均价格是 $\frac{\$51000}{500} = \$102$。对于空头头寸，情况是一样的。假设我们有一个相同的空头头寸，成本基础为 -\$51,000，数量为 -500 股。我们的平均价格是 $\frac{-\$51000}{-500} = \$102$，这是相同的入场价。请注意，成本基础和数量上的负号相抵消，在每种情况下都为我们提供了正价格。在上面的例子中，我们只研究了当我们只增加头寸时我们的成本会发生什么变化。但是，如果我们通过反向交易来减少我们现有的头寸会发生什么？通过减少头寸，我们不仅减少了数量和成本基础，而且还可能实现盈利或亏损。在交易中，术语 PnL 或 P&amp;L 是 Profit and Loss 的常见简写。已实现的损益是您仅从交易中实际以现金获得的损益。典型的例子是“低买高卖”的想法。打破这个短语，它本质上是开一个多头头寸，然后以更高的价格减少（或关闭）它。由此产生的利润是您实现的盈亏，计算它的一般公式如下： 其中 $Price_{entry}$ 是您进入头寸的价格，而 $Price_{exit}$ 是您卖出头寸的价格在。从数学上讲，如果您的 PnL 值为正，则为盈利，如果为负，则为亏损。然而，您如何计算已实现利润实际上比乍看起来更复杂。一个关键原因是您使用哪种库存评估方法。这可以通过以下示例来说明。考虑以下两组交易：对于第一组 (A)，我们创建了 500 张合约的多头头寸，成本基础为 54,000 美元，平均价格为 108 美元。现在我们需要执行第二组交易（B），它们都是卖出。我们知道，一旦这些交易执行，我们将剩下 500 - 300 = 200 股的头寸数量。但是通过出售这些股票我们能赚多少钱？</p><p>有趣的是，这取决于我们计划出售哪些股票。回想一下，我们以两种不同的价格在两笔交易中买入。如果我们将这些交易中的每一个都视为独立的，我们将根据我们出售的交易获得不同的利润。事实上，有多种库存估值方法可用于计算：在这种方法中，我们按照获得股票的顺序出售我们的股票。我们进行每笔卖出交易，并按照买入的相同顺序将其与我们的买入进行匹配。我们计算每一项的利润，并调整成本基础。在这种情况下，我们首先将交易 C 与交易 A 进行匹配。我们获得了 100*(\$100-\$90) = \$1000 的利润，并且我们将我们的成本基础减少了我们以原始价格出售的数量，所以 100* \$90 = \$9,000。第二个卖出交易 (D) 更复杂，因为我们需要匹配 A 剩余 100 股的 200 股和 B 的 100 股。因此总利润为 (100*(\$110-\$90)) + (100*(\$110-\$120)) = \$2000 - \$1000 = \$1000 利润。我们还将成本基础降低了 (100*\$90) + (100*\$120) = \$21,000。我们的最终头寸是 200 股，成本基础为 24,000 美元，已实现盈亏为 2,000 美元。这种方法本质上与先进先出方法相反。在这里，我们以与收购相反的顺序出售我们的股票。我们首先将卖出交易 C 与 B 相匹配，这导致净亏损 2,000 美元，成本基础减少 12,000 美元。交易 D 完全抛售 C 交易，同时净亏损 2,000 美元，成本基础减少 24,000 美元。总的来说，我们最终实现的盈亏为 -\$4,000（净亏损），以及 200 股的头寸，成本基础为 \$18,000。这种方法平均了交易成本，并使用平均价格来计算已实现的盈亏。如前所述，我们 500 股的平均入场价为 108 美元。我们查看我们所做的卖出交易，并将它们汇总在一起以创建相反的空头头寸。在这种情况下，交易 C 和 D 合并创建 300 股的空头头寸，平均价格为 $106.666。注意价格上的循环小数。</p><p>我们将这两个头寸视为一笔交易。我们实现的盈亏是 300*(\$106.666 - \$108) = -\$400，我们剩余 200 个数量仓位的成本基础是 \$54,000 - (300*\$108) = \$21,600。请注意，此方法比其他两种方法简单得多，但由于您必须使用平均价格，因此您会面临浮点不精确性，即计算机在计算小数时缺乏准确性。如果此平均价格计算完成得足够多，则可能会导致错误随着时间的推移而累积。在不暴露于浮点不精确风险的情况下执行此方法留给读者作为练习。我们注意到这三种方法在实现的 pnl 上的差异是相当大的。第一次我们盈利（\$2,000），第二次我们亏损大（-\$4,000），第三次我们亏损较小（-\$400）。虽然这看起来有点疯狂，但实际上是有道理的，因为所有这些不同的方法所做的都是更早或更早地实现 PnL ......</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.machow.ski/posts/2021-07-24-positions-profit-and-loss/">https://www.machow.ski/posts/2021-07-24-positions-profit-and-loss/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/头寸/">#头寸</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/profit/">#profit</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/交易/">#交易</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>