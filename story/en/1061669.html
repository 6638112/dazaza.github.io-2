<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>syslog地狱 The Syslog Hell</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">The Syslog Hell<br/>syslog地狱 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-10 19:10:36</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/5/216b2cda0e44df00311e85dd942d9243.jpg"><img src="http://img2.diglog.com/img/2021/5/216b2cda0e44df00311e85dd942d9243.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Syslog. You’ve probably heard about that, especially if you are into monitoring or security. Syslog is perceived to be the common, unified way that systems can send logs to other systems. Linux supports syslog, many network and security appliances support syslog as a way to share their logs. On the other side, a syslog server is receiving all syslog messages. It sounds great in theory – having a simple, common way to represent logs messages and send them across systems.</p><p>syslog。你可能听说过这一点，特别是如果你进入监控或安全。 Syslog被认为是系统可以将日志发送到其他系统的常见，统一的方式。 Linux支持Syslog，许多网络和安全设备支持Syslog作为共享他们的日志的方式。另一方面，Syslog服务器正在接收所有Syslog消息。理论上听起来很棒 - 具有一种简单，常用的方式来表示日志消息并跨系统发送它们。</p><p> Reality can’t be further from that. Syslog is not one thing – there are multiple “standards”, and each of those is implemented incorrectly more often than not. Many vendors have their own way of representing data, and it’s all a big mess.</p><p> 现实不能从中得到进一步。 Syslog不是一件事 - 有多种“标准”，其中每一个都是不正确的，而不是不是不正确的。许多供应商都有自己的代表数据的方式，这一切都是一个大混乱。</p><p> First, the RFCs. There are two RFCs –  RFC3164 (“old” or “BSD” syslog) and  RFC5254 (the new variant that obsoletes 3164). RFC3164 is not a standard, while RFC5254 is (mostly).</p><p> 首先，RFCS。有两个RFCS  -  RFC3164（“旧”或“BSD”Syslog）和RFC5254（过时的新变种3164）。 RFC3164不是标准，而RFC5254是（主要是）。</p><p> Those RFCs concern the contents of a syslog message. Then there’s  RFC6587 which is about transmitting a syslog message over TCP. It’s also not a standard, but rather “an observation”. Syslog is usually transmitted over UDP, so fitting it into TCP requires some extra considerations. Now add TLS ontop of that as well.</p><p> 这些RFC涉及Syslog消息的内容。然后有RFC6587，它是关于通过TCP传输Syslog消息。这也不是标准，而是“观察”。 Syslog通常通过UDP传输，因此将其拟合到TCP需要一些额外的考虑因素。现在也加入TLS ONTOP。</p><p> Then there are content formats. RFC5254 defines a key-value structure, but RFC 3164 does not – everything after the syslog header is just a non-structured message string. So many custom formats exist. For example firewall vendors tend to define their own message formats. At least they are often documented (e.g.  check WatchGuard and  SonicWall), but parsing them requires a lot of custom knowledge about that vendor’s choices. Sometimes the documentation doesn’t fully reflect the reality, though.</p><p> 然后有内容格式。 RFC5254定义了一个键值结构，但RFC 3164没有 - 在Syslog标题只是非结构化消息字符串之后的所有内容。存在许多自定义格式。例如，防火墙供应商倾向于定义自己的消息格式。至少他们经常被记录（例如，检查WatchGuard和SonicWALL），但解析它们需要大量的关于该供应商的选择的自定义知识。但是，文档没有完全反映现实。</p><p> Instead of vendor-specific formats, there are also de-facto standards like  CEF and the less popular LEEF. They define a structure of the message and are actually syslog-independent (you can write CEF/LEEF to a file). But when syslog is used for transmitting CEF/LEEF, the message should respect RFC3164.</p><p> 而不是特定于供应商的格式，也有像CEF和不太受欢迎的LEEF等事实标准。它们定义了消息的结构，实际上是独立于Syslog的（您可以将CEF / LEEF写入文件）。但是当Syslog用于传输CEF / LEEF时，该消息应尊重RFC3164。</p><p> And now comes the “fun” part – incorrect implementations. Many vendors don’t really respect those documents. They come up with their own variations of even the simplest things like a syslog header. Date formats are all over the place, hosts are sometimes missing, priority is sometimes missing, non-host identifiers are used in place of hosts, colons are placed frivolously.</p><p> 现在是“有趣”部分 - 不正确的实现。许多供应商并不真正尊重这些文件。他们甚至是Syslog标题中最简单的东西的自己的变化。日期格式到处都是，主机有时丢失，优先级有时丢失，非主机标识符用于替代主机，冒号轻浮放置。 </p><p> Parsing all of that mess is extremely “hacky”, with tons of regexes trying to account for all vendor quirks. I’m working on a SIEM, and our collector is open source – you can check our  syslog package. Some vendor-specific parsers are yet missing, but we are adding new ones constantly. The  date formats in the CEF parser tell a good story.</p><p>解析所有这些烂摊子是非常“言辞”，有大量的正方Xes试图考虑所有供应商怪癖。我正在研究一个暹粒，我们的收藏家是开源的 - 您可以查看我们的Syslog包。一些特定于供应商的解析器尚未丢失，但我们正在不断添加新的。 CEF Parser中的日期格式讲述了一个很好的故事。</p><p> If it were just two RFCs with one de-facto message format standard for one of them and a few option for TCP/UDP transmission, that would be fine. But what makes things hell is the fact that too many vendors decided not to care about what is in the RFCs, they decided that “hey, putting a year there is just fine”  even though the RFC says “no”, that they don’t really need to set a host in the header, and that they didn’t really need to implement anything new after their initial legacy stuff was created.</p><p> 如果它只是两个RFC，其中一个具有一个De-Facto消息格式标准，以及TCP / UDP传输的一些选项，那将是正常的。但是，什么让事情变得太多的是太多的供应商决定不关心RFC的东西，他们决定“嘿，把一年带到很好”，即使RFC说“不”，他们不安“ t真的需要在标题中设置一个主机，并且他们在创建初始遗留物品后，他们并不真正需要在其初始遗留内容之后实现任何新的东西。</p><p> Too many vendors (of various security and non-security software) came up with their own way of essentially representing key-value pairs, too many vendors thought their date format is the right one, too many vendors didn’t take the time to upgrade their logging facility in the past 12 years.</p><p> 太多供应商（各种安全和非安全软件）提出了他们自己的方式，他们基本上代表了钥匙值对，太多供应商认为他们的日期格式是正确的，很多供应商都没有花时间升级他们在过去的12年里的伐木工厂。</p><p> Unfortunately that’s representative of our industry ( yes, xkcd). Someone somewhere stitches something together and then decades later we have an incomprehensible patchwork of stringly-typed, randomly formatted stuff flying around whatever socket it finds suitable. And it’s never the right time and the right priority to clean things up, to get up to date, to align with others in the field. We, as an industry (both security and IT in general) are creating a mess out of everything. Yes, the world is complex, and technology is complex as well. Our job is to make it all palpable, abstracted away, simplified and standardized. And we are doing the opposite.</p><p> 不幸的是，这是我们行业的代表（是的，XKCD）。有人在某个地方缝合在一起，然后几十年后我们有一个不可思议的拼凑而成的斑驳，随机格式化的东西，无论它找到合适的套接字。它从来没有适当的时间和正确的优先考虑，以便到达最新的事情，以与现场的其他人对齐。我们作为一个行业（安全性和一般）正在营造出来的一切。是的，世界是复杂的，技术也很复杂。我们的工作是使其全部触及，抽象，简化和标准化。我们正在做相反的。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://techblog.bozho.net/the-syslog-hell/">https://techblog.bozho.net/the-syslog-hell/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/syslog/">#syslog</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>