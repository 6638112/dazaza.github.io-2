<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>持续融合之谜 A Continuous Integration Mystery</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">A Continuous Integration Mystery<br/>持续融合之谜 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-05 06:03:56</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/3d094b9ae0c0e3e6ce3687fec9714f20.png"><img src="http://img2.diglog.com/img/2020/12/3d094b9ae0c0e3e6ce3687fec9714f20.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>It showed me that I may rely a little too much on the green light from CI tools like CircleCI and GitHub Actions when deciding whether it’s safe to merge a branch.</p><p>它告诉我，在确定合并分支是否安全时，我可能会过分依赖CircleCI和GitHub Actions等CI工具的批准。</p><p>  My colleague added new  expect clauses to a test, plus the code to  pass it.</p><p>  我的同事在测试中添加了新的Expect子句，以及通过它的代码。</p><p>      I added  more new clauses to the test my colleague had earlier modified. I worked on it for the rest of the day.</p><p>      我在同事之前修改的测试中添加了更多新条款。在剩下的一天里，我一直在努力。</p><p>    Next, two colleagues reviewed my work and approved it on GitHub. All the pre-merge checks on CircleCI were passing, including tests and style checks. I rebased and decided to save the merge for the morning.</p><p>    接下来，两名同事回顾了我的工作，并在GitHub上批准了我的工作。 CircleCI上的所有合并前检查都通过了，包括测试和样式检查。我调整了业务基础，并决定将合并保存为早晨。</p><p>  Soon after, an error was found related to the code the first colleague had deployed. They  reverted the PR they had merged on Day 1.</p><p>  不久之后，发现与第一个同事部署的代码有关的错误。他们恢复了在第一天合并的PR。</p><p>  Not long after, I checked my PR again - there were no merge conflicts.  I merged my code.</p><p>  不久之后，我再次检查了我的PR-没有合并冲突。我合并了我的代码。</p><p> An hour or so later, another colleague tells me that, according to CircleCI, a test I wrote was failing on the main branch. How could this be, they said? It appears to have been passing on the branch it came from!</p><p> 一个小时左右后，另一个同事告诉我，根据CircleCI的说法，我编写的测试在主分支上失败。他们说，怎么可能？它似乎一直在传递来自它的分支！ </p><p>  I’d recently touched that test, so I looked at the error and quickly worked out what it was: The test I’d added to was failing because one of it’s  expect clauses relied on code which had been been reverted - it was no longer a valid expectation. GitHub didn’t run a new diff on my PR after the removal of the clause in question from the main branch; the reverted test code simply looks ‘unchanged’ in the diff, as if it had been and was still there.</p><p>我最近接触了该测试，所以我查看了该错误并迅速找出其含义：我添加到的测试失败了，因为其中一项期望子句依赖于已还原的代码-不再使用一个有效的期望。从主要分支机构删除相关条款后，GitHub在我的PR上没有运行新的差异；还原后的测试代码在差异中看起来只是“不变”，就好像它曾经并仍在那儿一样。</p><p> I didn’t remove it, I didn’t rebase, and my PR ended up re-adding the recently-removed  expect clause even though it didn’t appear to.</p><p> 我没有删除它，也没有重新设置基准，我的PR最终重新添加了最近删除的Expect子句，即使该子句看起来没有。</p><p>  On one hand, the process is working. There was a merge error caused by the  git equivalent of a race condition, we were told about it, and we were able to resolve it. Why bother running tests on the main branch before you deploy unless you are concerned that there is a chance they’ll fail?</p><p>  一方面，该过程正在运行。有人告诉我们，有一个竞赛条件的git等效项引起合并错误，我们能够解决它。除非您担心测试可能会失败，否则为什么要在部署之前先在主分支上运行测试？</p><p>  On the other hand, the process felt like it was disrupting the order of things. Something like this is often said: “if you have a reliable QA and CI process, then if something is on the main branch it should be deployable.” And yet here was an anomalous case which suggested otherwise.</p><p>  另一方面，该过程感觉像是在扰乱事物的顺序。通常会这样说：“如果您有可靠的QA和CI流程，那么如果主分支上有内容，则应该可以部署。”然而这是一个反常的案例，暗示了另外的情况。</p><p> Perhaps, then, the lesson is that our QA and CI process isn’t robust enough. Should CI create a merged branch behind-the-scenes and run tests on  that before allowing the branch to be merged?</p><p> 那么，也许可以得出的教训是，我们的质量检查和CI流程不够完善。 CI是否应在幕后创建合并分支并在允许分支合并之前对此进行测试？</p><p> I’m not sure. In the meantime, while I try to decide what the lesson is, I think I’ll just rebase my branches more often.</p><p> 我不确定。同时，当我尝试决定要学习的课程时，我认为我会更经常地调整分支机构的基础。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/融合/">#融合</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/测试/">#测试</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>