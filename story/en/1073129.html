<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在bash中保持持久的历史（2013）Keeping persistent history in bash (2013)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Keeping persistent history in bash (2013)<br/>在bash中保持持久的历史（2013）</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-14 19:06:14</div><div class="page_narrow text-break page_content"><p>For someone spending most of his time in front of a Linux terminal, history is very important. But traditional bash history has a number of limitations, especially when multiple terminals are involved (I sometimes have dozens open). Also it&#39;s not very good at preserving just the history you&#39;re interested in across reboots.</p><p>对于在Linux终端前花费大部分时间的人来说，历史是非常重要的。但是传统的bash历史有很多局限性，尤其是当涉及多个终端时（我有时会打开几十个终端）。还有&#39；It’他不太擅长保存你的历史&#39；我们对跨重启感兴趣。</p><p> There are many approaches to improve the situation; here I want to discuss one I&#39;ve been using very successfully in the past few months - a simple &#34;persistent history&#34; that keeps track of history across terminal instances, saving it into a dot-file in my home directory (  ~/.persistent_history). All commands, from all terminal instances, are saved there, forever. I found this tremendously useful in my work - it saves me time almost every day.</p><p>有很多方法可以改善这种情况；这里我想讨论一个我&#39；在过去的几个月里，我已经非常成功地使用了一个简单的&#34；持久的历史&#34；它可以跨终端实例跟踪历史，并将其保存到我的主目录（~/.persistent_history）中的一个点文件中。来自所有终端实例的所有命令都将永远保存在那里。我发现这在我的工作中非常有用——它几乎每天都为我节省时间。</p><p> Why does it go into a  separate history and not the  main one which is accessible by all the existing history manipulation tools? Because IMHO the latter is still worthwhile to be kept separate for the simple need of bringing up recent commands in a single terminal, without mixing up commands from other terminals. While the terminal is open, I want the press &#34;Up&#34; and get the previous command, even if I&#39;ve executed a 1000 other commands in other terminal instances in the meantime.</p><p>为什么它会进入一个单独的历史，而不是所有现有历史操纵工具都可以访问的主要历史？因为IMHO后者仍然值得单独保存，只需在一个终端中调出最新的命令，而不会混淆来自其他终端的命令。终端打开时，我要媒体&#34；上升&#34；并获得之前的命令，即使我&#39；在此期间，我在其他终端实例中执行了1000条其他命令。</p><p> Persistent history is very easy to set up. Here&#39;s the relevant portion of my   ~/.bashrc:</p><p>持久的历史很容易建立。这里&#39；这是我的~/的相关部分。bashrc：</p><p> log_bash_persistent_history(){ [[ $(history 1) =~ ^\ *[0-9]+\ +([^\ ]+\ [^\ ]+)\ +(.*)$ ]] local date_part=&#34;${BASH_REMATCH[1]}&#34; local command_part=&#34;${BASH_REMATCH[2]}&#34; if [ &#34;$command_part&#34; != &#34;$PERSISTENT_HISTORY_LAST&#34; ] then echo $date_part &#34;|&#34; &#34;$command_part&#34; &gt;&gt; ~/.persistent_history export PERSISTENT_HISTORY_LAST=&#34;$command_part&#34; fi}# Stuff to do on PROMPT_COMMANDrun_on_prompt_command(){ log_bash_persistent_history}PROMPT_COMMAND=&#34;run_on_prompt_command&#34;</p><p>log_bash_persistent_history（）{[[$（history 1）=~^\*[0-9]+\+（[^\]+\[^\]+）\+（.*）本地日期部分=&#34；${bash_重新匹配[1]}&#34；本地命令_部分=&#34${BASH_重赛[2]}&#34；如果[&#34；$command#u part&#34；！=&#34；$PERSISTENT#u HISTORY#u LAST&#34；]然后回显$date_部分&#34|&#34; &#34;$指挥部第34部分&gt&gt；~/。持久历史导出持久历史最后一次=&#34$指挥部第34部分；fi}#PROMPT#command上要做的事情run#u on_PROMPT_command（）{log_bash_persistent_history}PROMPT#u command=&#34；运行_on_prompt_命令&#34；</p><p>   Also in my  .bashrc file is: Note that an environment variable is used to avoid useless duplication (i.e. if I run  ls twenty times in a row, it will only be recorded once).</p><p>也在我的生活中。bashrc文件是：请注意，环境变量用于避免无用的重复（即，如果我连续运行ls 20次，它将只记录一次）。</p><p> OK, so we have   ~/.persistent_history, how do we  use it? First, I should say that it&#39;s not used very often, which kind of connects to the point I made earlier about separating it from the much higher-use regular command history. Sometimes I just look into the file with  vi or  tail, but mostly this alias does the trick for me:</p><p>好的，我们有~/。持续的历史，我们如何使用它？首先，我应该说它&#39；它不经常使用，这与我之前提出的将其与更高使用率的常规命令历史分离的观点有某种联系。有时我只是用vi或tail查看文件，但大多数情况下，这个别名对我来说很有用：</p><p>    Another tool for managing persistent history is a trimmer. I said earlier this file keeps the history &#34;forever&#34;, which is a scary word - what if it grows too large? Well, first of all - worry not. At work my history file grew to about 2 MB after 3 months of heavy usage, and 2 MB is pretty small these days. Appending to the end of a file is very, very quick (I&#39;m pretty sure it&#39;s a constant-time operation) so the size doesn&#39;t matter much. But trimming is easy:</p><p>管理持久历史的另一个工具是修剪器。我早些时候说过，这个文件保存着历史&#34；永远&#34；，这是一个可怕的词——如果它长得太大怎么办？首先，别担心。在工作中，经过3个月的大量使用，我的历史文件增长到了2MB左右，现在2MB已经很小了。追加到文件末尾非常非常快（我很确定这是一个固定时间操作），因此大小不会&#39；没什么大不了的。但修剪很容易：</p><p>  Trims to the last 20000 lines. This should be sufficient for at least a couple of months of history, and your workflow should not really rely on more than that :-)</p><p>修剪到最后20000行。至少在几个月的历史中，这应该足够了，并且您的工作流程不应该真正依赖于以上内容：-）</p><p> Finally, what&#39;s the use of having a tool like this without employing it to collect some useless statistics. Here&#39;s a histogram of the 15 most common commands I&#39;ve used on my home machine&#39;s terminal over the past 3 months:</p><p>最后，什么&#39；it’拥有这样一个工具，而不使用它来收集一些无用的统计数据是有好处的。这里&#39；这是15条最常见命令的柱状图I&#39；我在我家的机器上用过#39；过去3个月内，s航站楼：</p><p> ls : 865vi : 863hg : 741cd : 512ll : 289pss : 245hst : 200python : 168make : 167git : 148time : 94python3 : 88./python : 88hpu : 82cat : 80</p><p>ls:865vi:863hg:741cd:512ll:289pss:245hst:200python:168make:167git:148time:94python3:88/python:88hpu:82cat:80</p><p> Some explanation:  hst is an alias for  hg st.  hpu is an alias for  hg pull  -u.  pss is my  awesome pss tool, and is the reason why you don&#39;t see any calls to  grep and  find in the list. The proportion of Mercurial vs. git commands is likely to change in the very near future  due to this.</p><p>一些解释：hst是hg st的别名。hpu是hg pull-u的别名。pss是我最棒的pss工具，这就是为什么你不&#39；我看不到有人打电话给grep和find。因此，Mercurial与git命令的比例在不久的将来可能会发生变化。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/bash/">#bash</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/命令/">#命令</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>