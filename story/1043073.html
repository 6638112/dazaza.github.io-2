<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>恢复旧的X代码 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">恢复旧的X代码 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-04 05:03:28</div><div class="page_narrow text-break page_content"><p>我今年休假了圣诞节和新年之间的一周。 Ididn确实没有任何认真的计划，只是与通常的惯例有所不同。通常，当我收到这个简单的错误报告Debian Bug＃974011时，我就开始做一个项目。</p><p> 我最近一直在研究旧的终端机和X游戏，并意识到来自＆xmille＆＃39;的许多代码源于终端游戏“ mille”，它是bsdgames ...的一部分。[版权和许可信息]已从xmille发行版的所有代码中剔除。此外，所包含的材料均不归功于原始作者Ken Arnold。</p><p> xmille＆＃39;的原因来源缺少来自＆mille＆＃39;的版权和许可信息文件是在将这些信息添加到上游之前复制的。 Xmille在1987年左右的Mille分叉。我为当时运行X10R4的系统编写了UI部分。在某个时候已经完成了X11的非常基本的移植，这就是Debian在今天的档案中所拥有的。</p><p> 在90年代的某个时候，我将Xmille移植到Athena小部件集，包括Xaw扩展库Xkw中的几个自定义小部件。它比Debian中的版本好很多，包括正确显示卡片（Debian版本存在一些非常糟糕的颜色问题）。</p><p>    为了解决缺少的版权和许可信息，我将它们的源代码导入了＆＃34; latest＆＃34;中。基于Xaw的版本。更新的密尔代码具有许多错误修复和改进，以及版权信息。</p><p> 那应该足以解决问题，我本可以从所需的任何位构建一个合适的源包，然后将其上传并替换为“ xmille”。包。</p><p> 但是，在后来的某个时候，我实际上将xmille合并到一个较大的程序包中，即“ kgames”，其中还包括许多其他游戏，包括Reversi，Domino，Cribbage和10个Solitaire / Patiencevariants。 （顺便说一句，最近的十款游戏构成了myPatience Palm Pilot应用程序的基础，该应用程序似乎启发了同名的Android应用程序...） </p><p>好的，所以运行这个旧的源代码应该很容易，对吗？它只是一堆在80年代和90年代设计的C代码，可以在VAXen及其同类上工作。它能有多难？</p><p> 那时的一切都是32位计算机。指针和整数均为32位，因此您可以毫不费力地放弃它们，并且不会造成任何问题。今天，测试发现代码的某些角落存在段错误。</p><p> 它是K＆amp; R C代码。请记住，ANSI-C的第一个版本直到1989年才问世，几年后，我们可以可靠地期望找到带有随机Unix盒的ANSI编译器。</p><p> 它是X11代码。幸运的是，自编写这些应用程序以来，X11尚未更改，因此至少该部分仍然可以正常工作。想象一下，尝试从90年代初期开始在现代OS上构建Windows或Mac OS代码...</p><p> 我决定在各处挖掘并添加原型。发现了很多指针/ int强制转换问题，以及几个潜伏的错误，这些错误只是简单地破坏了代码。</p><p> 大约一天后，我开始构建和运行东西，不再遇到崩溃。</p><p>  完成之后，我决定至少可以将工作位上传到Debian档案库并关闭上面报告的错误。 kgames 1.0-2可能最终会变得不稳定，大概是在DebianFTP小组意识到修复此错误的重要性之后。或者其他的东西。 </p><p>是的，Xaw应用程序具有质朴的外观，可能对某些人有吸引力，但对于具有高分辨率显示器和“季节适当”视力的人来说，斜视微小的图像和文字使今天很难享受这些游戏。</p><p>   我决定深入研究并开始破解代码，首先是向使用cairo进行绘图而不是coreX调用的Xkw库中添加newwidget。幸运的是，游戏的需求非常有限，因此我只需要实现一些小部件即可：</p><p> KLabel。显示文本字符串。它允许字符串左对齐，居中对齐或右对齐。就是这样。</p><p>  K切换。一个推/推按钮，大多数实现使用KCommand。还支持“无线电组”推动oneon使组中的其他人关闭。</p><p> KMenuButton。用于调出菜单小部件的按钮；这是在KCommand之上构建的一些非常简单的行为。</p><p> KSimpleMenu，KSmeBSB，KSmeLine。这三个创建弹出菜单； KSimpleMenu创建一个可以容纳任意数量的KSmeBSB（字符串）和KSmeLine（分隔线）对象的容器。</p><p> 其他Xkw小部件的渲染都改为使用cairo，再加上使用双缓冲使更新看起来更好。 </p><p>在Wikimedia上查看时，我发现了一个页面，该页面引用了大量SVG形式的扑克牌，这使我进入了Adrian Kennard的扑克牌网站，该网站使我可以自定义和下载一副纸牌，并使用CC0 Public Domain许可证进行许可。</p><p> 使用这些卡，我着手重写Xkw纸牌小部件，剥离出三种不同版本的位图纸牌，并仅用这些新的SVG版本替换它们。</p><p>  好的，因此获得常规的扑克牌是很好的，但是最初的目标是更新Xmille，而这是我手工绘制的牌。我可以只使用这些图像，将它们导入开罗，然后将其缩放以适合屏幕显示。我决定尝试使用inkscape的位图跟踪代码来查看它可以对它们进行什么处理。</p><p> 首先，我必须将它们设置为inkscape可以解析的格式。事实证明这有点棘手。原始格式是一组Xbitmap图层；每层都绘制一种颜色。我最终破解了Xmille源代码以使用X生成图像，然后使用XGetImage提取它们并遍历它们以构建XPM格式文件，然后可以将其输入到便携式位图工具中以创建inkscape可以处理的PNG文件。</p><p>   我确实替换了图像中的文本以使其可读，否则这些内容就不会影响到生成的inkscape。</p><p>  请记住，所有这些都是使用venerableX工具包构建的应用程序。由于形状按钮使用X形状扩展名，因此仍然可以看到一些非抗锯齿的图形。但是，现在所有渲染都是使用cairo完成的，因此所有渲染都是抗锯齿的，并且都是可扩展的。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://keithp.com/blogs/kgames/">https://keithp.com/blogs/kgames/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/恢复/">#恢复</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/reviving/">#reviving</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1042940.html"><img src="http://img2.diglog.com/img/2021/1/thumb_0b7140cc4f09aaa2d2d42cd93efae15c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042940.html">C2nim：将ANSI C代码转换为Nim的工具 </a></div><span class="my_story_list_date">2021-1-2 16:18</span></div><div class="col-sm"><div><a target="_blank" href="/story/1042773.html"><img src="http://img2.diglog.com/img/2021/1/thumb_1062cd9ac4b11b5143eca88a5c3fe40e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042773.html">Biontech辉瑞疫苗的逆向工程原始代码：第2部分 </a></div><span class="my_story_list_date">2021-1-1 9:0</span></div><div class="col-sm"><div><a target="_blank" href="/story/1042698.html"><img src="http://img2.diglog.com/img/2021/1/thumb_ac838470c41af8848552aecd2d1ad9a6.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042698.html">微软表示SolarWinds黑客已查看源代码 </a></div><span class="my_story_list_date">2021-1-1 8:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1042593.html"><img src="http://img2.diglog.com/img/2020/12/thumb_3df3474847de939912d1bd066c096481.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042593.html">展开引擎代码概述 </a></div><span class="my_story_list_date">2020-12-31 2:6</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>