<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Charles Proxy for Web Scrating(网络抓取代理)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Charles Proxy for Web Scrating(网络抓取代理)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-13 15:00:52</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/95288d78d3f6a230e169434b6f585165.jpg"><img src="http://img2.diglog.com/img/2020/11/95288d78d3f6a230e169434b6f585165.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>这篇文章将向你展示如何使用Charles Proxy对网站和移动应用程序上隐藏的和私有的API进行反向工程。</p><p>Charles Proxy是一个HTTP调试代理，可以检查网络调用并调试SSL流量。使用Charles，您可以检查请求/响应、标头和cookie。今天我们将看到如何设置Charles，以及如何使用Charles Proxy进行Web抓取。我们将专注于从大量使用Javascript的网页和移动应用程序中提取数据。Charles位于您的应用程序和互联网之间：</p><p>我们将了解如何在MacOS上安装和配置Charles，但也有Windows和Linux版本。</p><p>在安装Charles之后，您需要安装它的根证书。这将允许Charles拦截和解密SSL流量。</p><p>点击Install Root Certificate(安装根证书)后，它将打开您的MacOS Keychain访问权限，您必须打开Trust(信任)菜单，然后单击“Always Trust(始终信任)”。</p><p>现在，您需要转到代理&&gt;SSL代理设置并添加“*”或要检查SSL的域。</p><p>在传统的服务器端呈现的网站中，HTML代码由后端服务构建，整个页面返回给HTTP客户端(通常是您的浏览器)。在过去的10年中，越来越多的网站使用React.js、Vue.js或Angel等单一页面应用程序框架在客户端呈现。</p><p>这些框架向后端API发送了许多请求，直接使用这些API可能是一个很好的想法，而不是抓取站点并使用无头浏览器呈现Javascript来提取所需的数据。它的速度会快得多，你不需要昂贵的硬件(无头浏览器需要大量内存和强大的CPU。)</p><p>我们将介绍不同的单页应用程序，看看Charles Proxy如何帮助您从后端API中发现和提取数据。</p><p>ProductHunt是一个著名的在线产品发布网站。它在科技生态系统中非常受欢迎。每天有几十个项目推出，所以首页只加载当天的产品。有无限的卷轴可以查看前几天的产品。</p><p>我们将使用Charles Proxy来分析后端API调用，并用一些Python代码重现它。</p><p>现在打开Charles Proxy，转到Producthut主页，滚动几次到页面底部。</p><p>默认情况下，Charles将捕获您的系统发出的每个HTTP请求，而不仅仅是您的浏览器。所以你会受到很多“污染”。您可以通过输入您感兴趣的域名进行过滤：</p><p>如果单击发送到/Fronend/GraphQL端点的POST请求之一，则可以检查请求和响应。</p><p>这些请求发生了很多事情，但如果比较发送到GraphQL API的内容，似乎唯一改变的就是游标参数。</p><p>它是Base64编码的，但幸运的是，Charles有一个快速解码Base64内容的功能。您只需选择它并单击鼠标右键：</p><p>Charles提供的杀手级功能之一是能够编辑任何请求和回放。在我们的例子中，它真的很棒，因为在请求中有很多头/cookie值，所以试图用HTTP客户端或在代码中重现请求将是一场噩梦。</p><p>为此，您可以右键单击请求，然后单击Compose。</p><p>然后，您可以使用光标值，并将其替换为以Base64编码的不同页码。然后点击Execute(执行)。</p><p>您也可以尝试删除不同的Cookie(这会起作用)。这是个好消息，因为如果Cookie是强制使用这个端点的，那么用我们的Python代码重现请求会更加复杂。</p><p>然后，您可以使用这样的工具将cURL命令转换为Python代码(使用精彩的请求包)：https://curl.trillworks.com/。</p><p>导入请求标题={&#39；Host&#39；：&#39；www.Producthunt.com；，&#39；Accept&#39；：&#39；*/*&#39；，&#39；x-Requesters-with&#39；：&#39；XMLHttpRequest&#39；，&#39；User-agent&#39；：&#39；Mozilla/5.0(Macintosh；英特尔Mac OS X 10_15_6)AppleWebKit/537.36(khtml，像壁虎一样)Chrome/86.0.4240.111 Safari/537.36&#39；，&#39；内容类型&#39；：&#39；应用程序/json&#39；，&#39；起源&#39；：&#39；https://www.producthunt.com&#39；，&#39；SEC-FETCH-SITE&#39；：&#39；同源&#39；，&#39；SEC-FETCH-MODE&#39；：&#39；CORS&#39；，&#39；SEC-FETCH-DEST&#39；：&#39；Empty&#39；，&#39；Referer&#39；：&#39；https://www.producthunt.com/&#39；，&#39；Accept-Language&#39；：&#39；en-US，en；q=0.9&#39；，}data=&#39；{&#34；operation Name&#34；：&#34；主页&#34；，&#34；变量&#34；：{&#34；Cursor&#34；：&#34；OA==&#34；，&#34；Feature&#34；：True，&#34；IncluddePromotedPost&#34；：False，&#34；VisibleOnHome&#34；：True，&#34；IncluddeLay.。：FALSE}，&#34；查询&#34；：&#34；查询主页($CURSOR：STRING，$PostCursor：STRING，$FECTURED：Boolean！，$IncluddePromotedPost：Boolean！，$visibleOnHompage：Boolean！){\\n部分(第一：1，之后：$CURSOR，特色：$FECTED){\\n边{\\n光标\\n节点{\\n ID\\n日期\\n CUTOFF_INDEX\\n POSTS_COUNT\\n卡片(第一：1，之后：$CURSOR){\\n边{\\n节点{\\n...FeedCards\\n_TypeName\\n}\\n帖子(之后：$postCursor，在主页上可见){\\n边{\\n节点{\\n...PostItemList\\n Feature_Comment{\\n id\\n正文：Body_Text\\n用户{\\n id\\n...UserImageLink\\n__TypeName\\n}\\n pageInfo{\\n。EndCursor\\n hasNextPage\\n__TypeName\\n}\\n pageInfo{\\n endCursor\\n hasNextPage\\n__TypeName\\n}\\n__TypeName\\n}\\n ad(种类：\\&#34；馈送\\&#34；)@Include(if：$cluddePromotedPost){\\n...AdFragment\\n__TypeName\\n}\\n PromotedEmail_Campaign(Promoted_type：主页)@Include(if：$cluddePromotedPost){\\n id\\n abTestName\\n abVariant{\\n id\\n...PromotedEmailAbTestVariantFragment\\n_TypeName\\n。\n id\\n主题\\n__TypeName\\n}\\n查看器{\\n id\\n电子邮件\\n Has_时事通讯_Subscription\\n__TypeName\\n}\\n ph_HOME_OG_IMAGE_url\\n}\\n\\n卡片上的FeedCard碎片{\\n...NewPostsCard\\n...BestProductsFromLastWeekCard\\n...MakersDiscus。N\\n NewPostsCard上的片段NewPostsCard{\\n IS_OFFERED\\n种类\\n帖子{\\n...PostItemList\\n_TypeName\\n}\\n_TypeName\\n}\\n\\n帖子上的片段PostItemList{\\n id\\n...帖子项\\n_TypeName\\n}\\n\\n帖子上的片段PostItem{\\n id\\n。已缩短的url\\n slug\\n标记线\\n更新的_at\\n主题{\\n边{\\n节点{\\n id\\n名称\\n slug\\n_TypeName\\n}\\n...PostThumbail\\n...PostVoteButton\\n_TypeName\\n}\\n\\n帖子上的片断PostThumbail{\\n id。\\n名称\\n缩略图{\\n id\\n media_type\\n...MediaThumbail\\n_TypeName\\n}\\n...PostStatusIcons\\n_TypeName\\n}\\n\\n媒体上的媒体缩略图碎片{\\n id\\n Image_UUID\\n_TypeName\\n}\\n\\n开机自检时分割PostStatusIcons。\\n\\n帖子上的片段PostVoteButton{\\n_id\\n id\\n Feature_at\\n update_at\\n Created_at\\n Disable_When_Scheduled\\n Has_Voted\\n...。在VOTABLE{\\n id\\n Votes_Count\\n__TypeName\\n}\\n__TypeName\\n}\\n\\n BestProductsFromLastWeekCard上的片段BestProductsFromLastWeekCard{\\n Posts{\\n Posts</p><p>几年前，让Charles Proxy在您的移动设备上运行有点复杂，您必须使用桌面Charles作为代理，使用相同的WiFi网络等。自2018年以来，他们推出了一款原生iOS应用程序，您可以在应用程序商店下载该应用程序：https://apps.apple.com/us/app/charles-proxy/id1134218562。</p><p>现在，让Charles拦截你最喜欢的应用程序HTTPS流量更容易了。安装应用程序，然后在主屏幕上激活它：</p><p>激活Charles并设置VPN配置后，您需要转到设置屏幕并启用SSL代理(只需按照说明操作)：</p><p>当您打开SSL代理时，某些应用程序可能会停止工作。当您安装Charles时，您还将安装一个根证书，以便Charles可以检查您的SSL通信。</p><p>这是一种“中间人”攻击(但在这种情况下，你是在攻击自己)。</p><p>一些应用程序正在验证根证书，因此不接受Charles的根证书。这称为SSL钉住。</p><p>现在打开激活了Charles的应用程序，滚动几次以加载更多文章。</p><p>与Charles桌面应用程序一样，您需要过滤dev.to域，以避免看到其他所有应用程序发送的请求。</p><p>然后，您可以点击请求序列，并将其共享到Mac进行进一步分析(无需在移动设备上分析请求)：</p><p>现在，我们将在Charles桌面应用程序上打开请求会话并处理请求。双击下载文件夹中的Charles会话文件(以.chlsj结尾)：</p><p>与前一部分一样，您可以对此请求会话执行完全相同的分析。</p><p>有趣的请求位于/search端点上。这是一个标准的REST API。</p><p>似乎不需要任何身份验证/cookie或特定的头来获得成功的响应。您可以通过以下方式进行验证：</p><p>有趣的参数是页码和per_page count。您可以使用这些值。</p><p>导入请求参数=(&#39；PER_PAGE&#39；，&#39；5&#39；)，(&#39；PAGE&#39；，&#39；1&#39；)，(&#39；SORT_BY&#39；，&#39；Hotness_Score&#39；)，(&#39；SORT_DIRECTION&#39；，&#39；Desc&#39；)，(&#39；已批准&#39；，&#39；&#39；)，(&#39；CLASS_NAME&#39；，&#39；文章&#39；)，)响应=请求.get(&#39；https://dev.to/search/feed_content&#39；，Verify=False，Params=Params)打印(响应.text)。</p><p>这是我最喜欢的从难以抓取的网站中提取数据的技术之一。它比使用无头浏览器快得多，解析JSON响应也比经常更改的乱七八糟的HTML代码容易得多。</p><p>有很多Charles的功能是我们在本教程中没有看到的。例如，断点和响应重写。对于想要测试/调试单页应用程序或移动应用程序的人来说，这可能非常有趣。</p><p>当你想要从网站上提取数据或者对移动应用进行反向工程时，Charles是非常方便的，但在复杂的网站上进行任何类型的浏览器自动化也几乎是强制性的。</p><p>例如，使用常规浏览器开发工具可能很难理解身份验证工作流。一旦您开始拥有JWT令牌、CSRF令牌和OAuth，它就开始变得杂乱无章，能够对一系列请求执行全文搜索并重放/修改请求是必须的。</p><p>不会被屏蔽的网页抓取：这篇文章将向你展示不同的技术，以避免在抓取网页时被屏蔽。</p><p>最好的网页抓取工具：这篇文章是关于目前最好的网页抓取工具。</p><p>我希望你喜欢这篇介绍Charles和逆向工程的文章，并希望你能在你最喜欢的应用程序上进行实验。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.scrapingbee.com/blog/charles-proxy/">https://www.scrapingbee.com/blog/charles-proxy/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/proxy/">#proxy</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/typename/">#typename</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1016698.html"><img src="http://img.diglog.com/img/2020/8/thumb_43c81aa18feff1c2f1fac6df07394444.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016698.html">快速代理，用于将NAT或防火墙后的本地服务器暴露给Internet</a></div><span class="my_story_list_date">2020-8-7 2:19</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007670.html"><img src="http://img.diglog.com/img/2020/6/thumb_4219bbeb991987db8cb75ac770bd0a1c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007670.html">Nginx Proxy Manager-用于管理letsEncrypt保护的反向代理的UI</a></div><span class="my_story_list_date">2020-6-23 1:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1000840.html"><img src="http://img.diglog.com/img/2020/5/thumb_bcc9a9a246372a18cef1bef40bd682f7.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000840.html">CloudFlare的代理违反了HTTP/1.1，他们不在乎</a></div><span class="my_story_list_date">2020-5-6 5:55</span></div><div class="col-sm"><div><a target="_blank" href="/story/technology_web2_424905.html"><img src="http://img.diglog.com/img/2011/5/thumb_2c12812b98e34d459f7ce4352f117019.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/technology_web2_424905.html">Warp Proxy是一款能够穿过防火墙的在线代理</a></div><span class="my_story_list_date">2011-5-5 13:24</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>