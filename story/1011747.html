<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Flowtrackd：单向TCP流量跟踪的DDoS保护</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Flowtrackd：单向TCP流量跟踪的DDoS保护</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-14 21:59:27</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/2457fcd25923d86842e14d6fa3d530d0.png"><img src="http://img.diglog.com/img/2020/7/2457fcd25923d86842e14d6fa3d530d0.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Magic Transition是Cloudflare的L3 DDoS清理服务，用于保护网络基础设施。作为我们对Magic Transportation的持续投资和我们的DDoS保护功能的一部分，我们很高兴能谈论一款帮助保护Magic Transportation客户的新软件：flow trackd。flowrackd是一个软件定义的DDoS保护系统，它显著提高了我们自动检测和缓解即使是最复杂的基于TCP的DDoS攻击的能力。如果您是Magic Transportation客户，此功能将在2020年7月29日免费默认启用。</p><p>在2020年第一季度，每两个缓解Cloudflare的L3/4 DDoS攻击中就有一个是ACK泛洪，所有L3/4攻击中超过66%是基于TCP的。大多数类型的DDoS攻击都可以通过查找所有攻击数据包中存在的独特特征并使用该特征来区分“好”数据包和“坏”数据包来缓解。这称为无状态缓解，因为任何具有这些独特特征的数据包都可以被简单地丢弃，而不会记住有关其之前的其他数据包的任何信息(或状态)。但是，当攻击数据包没有唯一特征时，则需要进行有状态缓解，因为某个数据包的好坏取决于它之前的其他数据包。</p><p>最复杂的TCP泛洪类型需要状态缓解，其中必须跟踪每个TCP连接，以便知道是否有任何特定的TCP数据包是活动连接的一部分。这种缓解称为流跟踪，通常在Linux中由iptables连接跟踪模块实现。但是，使用ConnecTrack的DDoS保护并不像翻转iptable交换机那么简单，尤其是在Cloudflare操作的规模和复杂性方面。如果您有兴趣了解更多信息，在本博客中我们将讨论实现iptables Conntrace的技术挑战。</p><p>复杂的TCP DDoS攻击会带来威胁，因为它们更难检测和缓解。因此，如果缓解规则不准确，它们可能会导致服务降级、停机和误报增加。那么，Cloudflare如何在不影响合法流量的情况下阻止无模式DDoS攻击呢？</p><p>使用Cloudflare的传统产品，可以通过WAF服务保护HTTP应用程序，通过Spectrum保护TCP/UDP应用程序。这些服务是反向代理，这意味着流量双向通过Cloudflare。在此双向拓扑中，我们可以看到整个TCP流(即客户端和服务器发送的数据段)，因此可以跟踪底层TCP连接的状态。这样，我们就可以知道TCP数据包是否属于现有的流，或者它是否是“非状态”的TCP数据包。脱离状态的TCP数据包看起来就像普通的TCP数据包，但它们不属于客户端和服务器之间的任何真正连接。这些数据包很可能是攻击的一部分，因此会被丢弃。</p><p>当我们充当客户端和服务器之间的代理时，可以跟踪TCP流，这使我们能够吸收和缓解状态外的TCP洪流，这一点并不是微不足道的。然而，当我们只看到连接的一半时，这就变得更具挑战性了：入口流。这种对入站流(而不是出站流)的可见性是Cloudflare的Magic Transfer服务的默认部署方法，因此我们在识别状态外数据包方面有很多工作要做。</p><p>借助Magic Transition，Cloudflare可以代表客户接收入站互联网流量，清除DDoS攻击，并通过隧道将干净的流量路由到客户的数据中心。然后，数据中心使用称为直接服务器返回(DSR)的技术直接响应Eyes Ball客户端。</p><p>使用DSR时，当Eyball客户端发起TCP握手时，它会发送一个SYN数据包，该数据包通过Cloudflare路由到源数据中心。然后，源设备绕过Cloudflare，直接向客户端发出SYN-ACK响应。最后，客户端使用ACK进行响应，该ACK再次通过Cloudflare路由到源，然后认为连接已建立。</p><p>在单向流中，我们看不到从源发送到Eyball客户端的SYN+ACK，因此不能利用我们现有的流跟踪功能来识别脱离状态的数据包。</p><p>为了克服单向流的挑战，我们最近完成了代号为flowtrackd(“流跟踪守护程序”)的新系统的开发和推出。flowtrackd是一个挂接到网络接口的状态机。它仅使用通过Cloudflare路由的入口流量跟踪单向TCP流，以确定TCP连接的状态。然后，flowtrackd能够确定数据包是新连接的一部分、打开的连接、正在关闭的连接、关闭的连接，还是处于非状态的数据包。一旦检测到大量非状态数据包，flowtrackd将质询(强制RST)或丢弃这些数据包。</p><p>确定流状态的状态机是内部开发的，是对Gatebot和DOSD的补充。Gatebot、DOSD和Flowtrackd共同提供全面的多层DDoS保护。</p><p>而且它起作用了！在将flowtrackd发布给早期访问客户后不到一天，flowtrackd自动检测并缓解了峰值为每秒600万个数据包的ACK泛滥。未报告停机、服务中断或误报。</p><p>与网络基础设施有限的传统清理中心提供商不同，Cloudflare可从我们在全球200多个地点的每个数据中心提供DDoS保护。我们编写自己的软件定义的DDoS保护系统。请注意，我之所以说System s，是因为与使用专用第三方设备的供应商不同，我们能够编写和启动我们需要的任何软件，将其部署在我们的技术堆栈中的最佳位置，因此不依赖于其他供应商，也不局限于一种设备的功能。</p><p>Flowtrackd加入了Cloudflare DDoS保护大家庭，其中包括我们经验丰富的Gatebot和年轻而精力充沛的DDoS。我们的每个数据中心都将提供flowtrackd，总缓解能力超过37Tbps，保护我们的Magic Transport客户免受最复杂的TCP DDoS攻击。</p><p>刚开始使用魔术交通吗？将您的传统提供商替换为Magic Transportation，在当前合同到期之前无需支付任何费用。优惠将于2020年9月1日到期。有关详细信息，请单击此处。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.cloudflare.com/announcing-flowtrackd/">https://blog.cloudflare.com/announcing-flowtrackd/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/单向/">#单向</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ddos/">#ddos</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数据包/">#数据包</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>