<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>测量内存使用情况：虚拟内存与实内存</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">测量内存使用情况：虚拟内存与实内存</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-08-02 05:59:23</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/8/c72a4bdf84c77ccc3eff0558d5edc17a.jpg"><img src="http://img2.diglog.com/img/2021/8/c72a4bdf84c77ccc3eff0558d5edc17a.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>软件开发人员经常关心他们的应用程序的内存使用情况，这是正确的。使用过多内存的软件可能会失败或运行缓慢。内存分配在所有系统下都不会以相同的方式工作。但是，在较高级别上，大多数现代操作系统都具有虚拟内存和物理内存 (RAM)。当您编写软件时，您在地址处读取和写入内存。在现代系统上，这些地址是 64 位整数。出于所有实际目的，您有无数个这样的地址：每个正在运行的程序可以访问数百 TB。但是，此内存是虚拟的。很容易忘记虚拟的意思。这意味着我们模拟了一些并不存在的东西。因此，如果您使用 C 或 C++ 进行编程并分配了 100 MB，则您可能根本不会使用 100 MB 的实内存。以下代码行可能根本不消耗任何实际内存： 当然，如果您在这些“虚拟”内存地址上写入或读取内存，一些真实内存将发挥作用。您可能认为如果您分配一个跨越 32 个字节的对象，您的应用程序可能会收到 32 个字节的实内存。但是操作系统不能以如此精细的粒度工作。相反，它们以“页面”为单位分配内存。页面有多大取决于您的操作系统和正在运行的进程的配置。在 PC 上，页面通常小至 4 kB，但在 ARM 系统上通常更大。操作系统允许您请求大页面（例如，1 GB）。您的应用程序以页面为单位接收“真实”内存。您永远无法从操作系统中获得“32 字节”的内存。这意味着微优化应用程序的内存使用是没有意义的：您应该从页面的角度考虑。此外，接收内存页面是一个相对昂贵的过程。因此，如果效率对您很重要，您可能不想不断地获取和释放内存。一旦分配了虚拟内存，我们能否预测以下循环中的实际（真实）内存使用情况？结果将取决于您的系统。但是一个简单的模型如下：计算您访问的连续页面的数量，假设您的指针从页面的开头开始。页面使用的内存是进程内存使用的下限，假设系统不使用其他技巧（如内存压缩或其他启发式）。</p><p>我在 Linux 下编写了一个 C++ 小程序，它在循环内定期打印出内存使用情况。我使用了大约 100 个样本。如下图所示，我的模型（由绿线表示）是进程实际内存使用情况的出色预测器。因此，考虑内存使用情况的一种合理方法是计算您访问的页面。页面越大，此模型的成本就越高。因此，如果您想节省内存使用量，似乎可以使用较小的页面。然而，像 Apple 的 iOS 这样的移动操作系统的页面 (16 kb) 比大多数 PC (4 kb) 大。如果有选择，我几乎总是选择更大的页面，因为它们使内存分配和访问成本更低。此外，您可能不必太担心虚拟内存。不要盲目计算您的应用程序请求的地址范围。它可能与您的实际内存使用几乎没有关系。现代系统拥有大量内存和非常聪明的内存分配技术。关注应用程序的整体内存使用情况是明智的，但与通过微观优化问题相比，您更有可能在软件架构级别解决内存问题。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/内存/">#内存</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/memory/">#memory</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>