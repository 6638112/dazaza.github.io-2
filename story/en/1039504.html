<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Zig 0.7.1发布-修复了69个错误 Zig 0.7.1 Released – 69 bugs fixed</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Zig 0.7.1 Released – 69 bugs fixed<br/>Zig 0.7.1发布-修复了69个错误 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-14 22:23:04</div><div class="page_narrow text-break page_content"><p>Zig is a general-purpose programming language and toolchain for maintaining  robust,  optimal, and  reusable software.</p><p>Zig是用于维护健壮，最佳和可重用软件的通用编程语言和工具链。</p><p>          start code: fix TLS symbol collisions causing compile error when linking against libc on Windows.</p><p>          起始代码：修复TLS符号冲突，在Windows上针对libc链接时会导致编译错误。</p><p>  debug: fix compilation error on platforms where debug info is unsupported. Non-tier-1 platforms will now return   error.UnsupportedDebugInfo when attempting to print a stack trace, rather than a compile error.</p><p>  调试：修复不支持调试信息的平台上的编译错误。现在，非第1层平台将返回error.UnsupportedDebugInfo，当尝试打印堆栈跟踪时，而不是编译错误。</p><p>  debug: Avoid deadlock in the signal handler.  stderr_mutex may still be held when we reach the signal handler, grab our own stderr handle to print the error messages and avoid deadlocking. ( #7247)</p><p>  调试：避免信号处理程序中的死锁。当我们到达信号处理程序时，仍可能保留stderr_mutex，抓住我们自己的stderr句柄以打印错误消息并避免死锁。 （＃7247）</p><p>          Make  os.windows.ReadFile allow short reads. This makes it behave like the read() wrapper for unix systems. Reading the whole buffer breaks some use-cases like buffered readers over sockets. ( #7121)</p><p>          使os.windows.ReadFile允许短读。这使得它的行为类似于unix系统的read（）包装器。读取整个缓冲区会破坏一些用例，例如通过套接字缓冲读取器。 （＃7121）</p><p>                Add  readAllArrayListAligned to  Reader which can accept an arbitrary alignment. Fixes a compile error in  fs.File.readToEndAllocOptions when an alignment is specified.</p><p>                将readAllArrayListAligned添加到可以接受任意对齐的Reader。修复了指定对齐方式时fs.File.readToEndAllocOptions中的编译错误。</p><p>    stage1: Fix zero length arrays with type of containing struct/union producing &#34;error: struct/union &#39;TYPE&#39; depends on itself&#34; ( #7058)</p><p>    阶段1：修复包含生成struct / union的类型的零长度数组，错误：struct / union＆＃39; TYPE＆＃39;取决于自己（＃7058） </p><p>            stage1: Disambiguate Wasm imports with same name. Fixes functions with the same name but in different modules being mixed up. ( #7088)</p><p>阶段1：使用相同名称消除歧义Wasm导入。修复具有相同名称但在不同模块中混用的功能。 （＃7088）</p><p>    stage1: Fix asyncCall with non-abi-aligned arguments. Make the code used to calculate the variable slot index into the frame match what&#39;s done during the structure layout calculation. Prevents a few nasty LLVM errors when such types are passed around.</p><p>    阶段1：使用非abi对齐的参数修复asyncCall。使用于将可变槽索引计算到框架中的代码与在结构布局计算过程中所做的匹配。传递此类类型时，可以防止一些讨厌的LLVM错误。</p><p>              stage1: Add missing bitcast when rendering var ptr. Some types require this extra bitcast, eg. structs or unions with extra padding fields inserted by the compiler. ( #7250)</p><p>              阶段1：在渲染var ptr时添加丢失的位广播。某些类型需要这种额外的位广播，例如。带有由编译器插入的额外填充字段的结构或联合。 （＃7250）</p><p>                        CLI: add -h alias for --help, and make -h,--help consistent in usage text and parsing.</p><p>                        CLI：为--help添加-h别名，并使-h，-help在用法文本和解析中保持一致。</p><p>  CLI: infer --name based on first C source file or object. Previously, --name would only be inferred if there was exactly 1 C source file or exactly 1 object. Now it will be inferred if there is at least one of either.</p><p>  CLI：根据第一个C源文件或对象推断--name。以前，仅在存在1个C源文件或1个对象的情况下才能推断出--name。现在将推断出其中至少有一个。</p><p>  CLI: improved local cache directory logic. ( #7342)    Previously, when choosing the local cache directory, if there was no root source file, an explicitly chosen path, or other clues, zig would choose cwd + zig-cache/ as the local cache directory.    This can be problematic if Zig is invoked with the CWD set to a read-only directory, or a directory unrelated to the actual source files being compiled. In the real world, we see this when using `zig cc` with CGo, which for some reason changes the current working directory to the read-only go standard library path before running the C compiler.    This commit conservatively chooses to use the global cache directory as the local cache directory when there is no other reasonable choice, and no longer will rely on the cwd path to choose a local cache directory.    As a reminder, the --cache-dir CLI flag and ZIG_LOCAL_CACHE_DIR environment variable are available for overriding the decision. For the zig build system, it will always choose the directory that build.zig is + zig-cache/.</p><p>  CLI：改进的本地缓存目录逻辑。 （＃7342）以前，在选择本地缓存目录时，如果没有根源文件，明确选择的路径或其他线索，zig会选择cwd + zig-cache /作为本地缓存目录。如果在CWD设置为只读目录或与正在编译的实际源文件无关的目录下调用Zig，则可能会出现问题。在现实世界中，当将`zig cc`与CGo一起使用时，我们会看到这种情况，由于某种原因，在运行C编译器之前，它会由于当前原因将当前工作目录更改为只读的go标准库路径。当没有其他合理选择时，此提交保守地选择使用全局缓存目录作为本地缓存目录，并且不再依赖cwd路径来选择本地缓存目录。提醒一下，-cache-dir CLI标志和ZIG_LOCAL_CACHE_DIR环境变量可用于覆盖该决策。对于zig构建系统，它将始终选择build.zig为+ zig-cache /的目录。</p><p>        build: Update the minimum cmake version we require so that cmake stops complaining about it.</p><p>        build：更新我们要求的最低cmake版本，以便cmake不再抱怨它。 </p><p>      link: Fix static archives cauling compiler related file (llvm-ar.id) in the current working directory. ( #6943)</p><p>链接：修复了在当前工作目录中静态归档文件引起编译器相关文件（llvm-ar.id）的问题。 （＃6943）</p><p>    link: Fix regression when targeting macOS due to LLD Mach-O code not supporting newer macOS systems by target-version-gating  -syslibroot on the linker line.</p><p>    链接：通过链接器行中的target-version-gating -syslibroot修复了由于macOS的LLD Mach-O代码不支持较新的macOS系统而导致的回归问题。</p><p>  link: macho: specify -install_name as full dylib&#39;s name. This then allows for proper resolution of names via runpath search path list, i.e.,  -rpath @loader_path will correctly resolve to  @rpath/libxxx.dylib (...) in the linked binary.</p><p>  链接：男子气概：指定-install_name作为完整dylib的名称。然后，这可以通过运行路径搜索路径列表来正确解析名称，即-rpath @loader_path将在链接的二进制文件中正确解析为@ rpath / libxxx.dylib（...）。</p><p>  link: LLD is invoked as a child process rather than a library. LLD library code improperly calls exit() as well as having global state that it does not reset between invocations. Zig now works around this by invoking itself with special CLI parameters which are then forwarded to LLD library calls. ( #3825)</p><p>  链接：LLD作为子进程而不是库被调用。 LLD库代码不正确地调用exit（），并且具有全局状态，即在两次调用之间不会重置。现在，Zig可以通过使用特殊的CLI参数进行自我调用来解决此问题，然后将其转发给LLD库调用。 （＃3825）</p><p>  Rework the bundle-compiler-rt feature ( #7013) ( #6817):  It is now  -fcompiler-rt and  -fno-compiler-rt to override the (quite reasonable) default of bundling compiler-rt only for executables and dynamic libraries.</p><p>  重做bundle-compiler-rt功能（＃7013）（＃6817）：现在是-fcompiler-rt和-fno-compiler-rt来覆盖（相当合理的）默认情况下，仅对可执行文件和动态库捆绑compile-rt 。</p><p>  The build.zig API is still called  bundle_compiler_rt however it is now an optional bool instead of a bool. leaving it as   null means to use the compiler default.</p><p>  build.zig API仍称为bundle_compiler_rt，但是现在它是可选的bool而不是bool。将其保留为空意味着使用编译器默认值。</p><p>  Additionally support  -fcompiler-rt when doing  build-obj for ELF files since that target already supports linking multiple objects into one.  Includes an error message when attempting this for non-ELF. In the future this could additionally be supported with a more advanced implementation that does not rely on the linker.</p><p>  在为ELF文件建立build-obj时，还支持-fcompiler-rt，因为该目标已经支持将多个对象链接到一个对象中。对于非ELF尝试包括此错误消息。将来，还可以通过不依赖链接程序的更高级的实现来支持它。 </p><p>  Fixed an internal compiler error when an absolute path passed as a system library. Now emits a proper compile error. Absolute paths to shared objects must be passed as positional parameters. ( #7139) ( #6868)</p><p>修复了将绝对路径作为系统库传递时的内部编译器错误。现在发出适当的编译错误。共享对象的绝对路径必须作为位置参数传递。 （＃7139）（＃6868）</p><p>  Fix not detecting all dynamic libraries. Positional shared library arguments were not being detected as causing dynamic linking, resulting in invalid linker lines. LLD did not have an error message for this when targeting x86_64-linux but it did emit an error message when targeting aarch64-linux, which is how I noticed the problem.</p><p>  修复了未检测到所有动态库的问题。未检测到位置共享库参数导致动态链接，从而导致无效的链接器行。 LLD在定位x86_64-linux时没有针对此的错误消息，但是在针对aarch64-linux时却发出了错误消息，这就是我注意到该问题的方式。</p><p>    caching system: include root name in the cache. This fixes a bug where the caching system did not notice when the  --name flag changed.</p><p>    缓存系统：在缓存中包含根名称。这修复了--name标志更改时缓存系统没有注意到的错误。</p><p>  caching system: add package names and paths into the root module cache hash so that Zig notices when the package mappings change.</p><p>  缓存系统：将软件包名称和路径添加到根模块缓存哈希中，以便Zig在软件包映射更改时发出通知。</p><p>      caching system: add   @cImport files to  Compilation cache manifest. Fixes caching system not noticing when C header files changed. ( #7007)</p><p>      缓存系统：将@cImport文件添加到编译缓存清单中。修复了C头文件更改时通知缓存系统的问题。 （＃7007）</p><p>  caching system: detect redundant C/C++ source files and emit an error instead of deadlocking. ( #7308)</p><p>  缓存系统：检测冗余C / C ++源文件并发出错误而不是死锁。 （＃7308）</p><p>    type: Change tag returned by  zigTagType for   c_longdouble to  Float. Function was returning Int before.</p><p>    类型：将zigTagType对于c_longdouble返回的标签更改为Float。函数之前返回Int。 </p><p>  Fix file extension stripping. Previously it looked for the first &#39;.&#39; but now it uses  std.fs.path.extension. ( #7404)</p><p>修复文件扩展名剥离。以前，它会查找第一个＆＃39;。但现在它使用std.fs.path.extension。 （＃7404）</p><p>    Explicitly cast indices to   usize. This is needed for platforms where   usize is the same size as   u16, eg. MSP430.</p><p>    显式转换索引以使用。这对于usize与u16大小相同的平台是必需的。 MSP430。</p><p>    Avoid exposing atomic builtins when not supported. Prevents compilation/LLVM errors for niche targets such as AVR/MSP430 or ARM v6m. By not exporting any atomic builtin anymore the user is free to provide their own implementation (that disable the IRQs) or to provide the  --single-threaded switch and forget about this.</p><p>    避免在不支持时公开原子内建函数。防止针对特定目标（例如AVR / MSP430或ARM v6m）进行编译/ LLVM错误。通过不再导出任何原子内建函数，用户可以自由地提供自己的实现（禁用IRQ）或提供-单线程开关，而不必理会。</p><p>    Fix  bundle_compiler_rt not being respected. It is now an optional bool. Leaving the value as   null means to use the compiler-chosen default.</p><p>    修复bundle_compiler_rt不被尊重的问题。现在是可选布尔。将值保留为空意味着使用编译器选择的默认值。</p><p>      Do not keep the build.zig cache manifest file locked. This allows to have multiple instances of  zig build at the same time. For example when you have a long running  zig build run and then want to run  zig build somethingelse.</p><p>      不要保持build.zig缓存清单文件处于锁定状态。这允许同时具有多个zig生成实例。例如，当您长时间运行zig构建并想要运行zig构建。</p><p>  Added global-cache argument to build system + removed extra args. Fixes crash when trying to override the cache directories in tandem with  zig build.</p><p>  添加了用于构建系统的global-cache参数+删除了额外的参数。修复了尝试与zig build一起覆盖缓存目录时崩溃的问题。</p><p>        Add missing  -m&lt;os&gt;-version-min CLI args to Clang. This fixes some code generation issues when targeting macOS and compiling C/C++ code.</p><p>        将缺少的-m＆lt; os＆gt; -version-min CLI参数添加到Clang。这解决了针对macOS和编译C / C ++代码时的一些代码生成问题。 </p><p>  zig cc no longer forces dynamic libraries to use a soname, matching C compiler behavior. (( #5861)</p><p>zig cc不再强制动态库使​​用匹配C编译器行为的soname。 （（＃＃5861）</p><p>    Always use codeview (pdb) when object_format is PE/COFF. Previously, when mixing Zig and C/C++ code for windows-gnu targets, zig would get codeview format but the C/C++ code would not get any debug info. Now, C/C++ code properly emits debug info in codeview format and everything just works.</p><p>    当object_format为PE / COFF时，始终使用codeview（pdb）。以前，当为Windows-gnu目标混合Zig和C / C ++代码时，zig将获得代码视图格式，但C / C ++代码将不会获得任何调试信息。现在，C / C ++代码可以正确地以代码视图格式发出调试信息，并且一切正常。</p><p>          Zig is immature. Even with Zig 0.7.1, working on a non-trivial project using Zig will likely require participating in the development process.</p><p>          Zig不成熟。即使使用Zig 0.7.1，使用Zig进行非常规项目也可能需要参与开发过程。</p><p>      These release notes have been edited down to avoid excessive detail as to not overwhelm the reader with content. In order to make sure everyone gets credit who contributed, here is a list of everyone who landed commits during this release cycle (produced with  git shortlog -sne 0.7.0..0.7.1):</p><p>      这些发行说明已被编辑，以避免过多的细节，以免使读者不知所措。为了确保每个人都可以贡献自己的功劳，这是此发行周期中所有提交提交的人的列表（由git shortlog -sne 0.7.0..0.7.1生成）：</p><p>      Special thanks to those who  sponsor Zig. Because of you, Zig is driven by the open source community, rather than the goal of making profit. In particular, these fine donors sponsor Zig for $50/month or more:</p><p>      特别感谢赞助Zig的人。有了您，Zig受到开源社区的驱动，而不是获利的目标。特别是，这些优秀的捐助者以每月50美元或更高的价格赞助Zig： </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://ziglang.org/download/0.7.1/release-notes.html">https://ziglang.org/download/0.7.1/release-notes.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/发布/">#发布</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/bugs/">#bugs</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/zig/">#zig</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>