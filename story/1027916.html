<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>内存安全“卷曲”，实现更安全的互联网</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">内存安全“卷曲”，实现更安全的互联网</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-11 15:33:30</div><div class="page_narrow text-break page_content"><p>TLDR：已经开始让Hyper在用于HTTP的cURL中作为后端工作。</p><p>CURL和它的数据传输核心libcurl都是用C语言编写的。C语言以内存不安全而臭名昭著，很容易搞砸，从而意外地导致安全问题。</p><p>同时，C编译器得到了非常广泛的使用和使用，您可以为几乎所有的操作系统和CPU编译C程序。C程序可以比用几乎任何其他编程语言编写的代码更具可移植性。</p><p>Curl是一段“不安全”的C代码，安装在全世界大约100亿台安装中。我用引号说不安全，因为我不认为卷曲是不安全的。当然，我们也有自己的安全漏洞，即使我认为在过去几年中发现这些漏洞的比率已经大幅降低，但我们从来没有遇到过严重的漏洞，在大量工具和人员的帮助下，我们在代码落入用户手中之前发现并修复了大多数问题。(“内存安全”并不是导致安全问题的唯一原因。)。</p><p>我相信在未来很长一段时间内，curl和libcurl将继续广泛使用：curl是任何地方的脚本和设置中的既定组件和伙伴。在进行互联网传输的地方，libcurl几乎是一个事实上的标准。</p><p>不考虑将cURL重写为另一种语言。移植像libcurl这样的旧的、已建立的和使用得很好的代码库是一项巨大而艰巨的任务，它在很大程度上由于稳定的API而广受欢迎和传播，不会破坏ABI，也不会改变现有功能的行为。到目前为止，它还没有被认真尝试过，甚至连考虑过它的大公司都放弃了这样的想法。</p><p>上面的这段序言可能会让人觉得，只要使用curl和libcurl，我们就会被困在我们所拥有的东西上。但不要害怕：事情比乍看起来更复杂，或者可能更光明。</p><p>对于libcurl的用户来说，重要的是要保持完好无损。我们保留API、ABI、行为以及所有记录在案的选项和功能。我们还需要不断增加内容，跟上世界前进的步伐。</p><p>今天，您已经可以构建libcurl来使用TLS、SSH、名称解析、LDAP、IDN、GSSAPI和HTTP/3的不同“后端”。</p><p>在此上下文中的“后端”是cURL中的一段代码，它允许您使用特定的解决方案(通常涉及特定的第三方库)来实现特定的libcurl功能。例如，使用此设置，您可以选择使用13个不同的TLS库中的一个或多个构建libcurl。您只需在构建它时选择您喜欢的一个(或多个)即可。Libcurl API对用户来说保持不变，只是有些特性和功能可能会稍有不同。当然，TLS后端的数量也会随着时间的推移而变化，因为我们将来会增加对更多库的支持，甚至会在旧库逐渐消失时放弃对它们的支持。</p><p>在构建cURL时，您现在可以让它使用多达33个不同的第三方库来实现不同的功能。它们中的许多当然是相互排斥的，所以没有一个单一的构建可以使用所有33个。</p><p>换句话说：您可以在不更改任何代码的情况下改进curl和libcurl二进制文件，只需将其重新构建为使用另一个后端组合即可。</p><p>有了大量使用第三方库的后端，libcurl的工作在很大程度上就变成了提供的稳定外部API和执行繁重任务的特定第三方库之间的切换。</p><p>自由卷曲像岩石一样，有一扇门，进门的规则都是用石头写的。后端可以来来去去，可以更改和改进，但入口外的应用程序不会注意到这一点。他们得到了他们了解和信任的稳定的API和ABI。</p><p>此设置提供了一个基础和基础设施，可以将用其他语言编写的后端作为包的一部分提供。只要这些库有libcurl可以访问的API，后端使用的库就可以用任何语言编写-但由于我们在这篇博客文章中讨论的是内存安全，最明显的选择可能是一种现代且安全的语言。例如，铁锈。</p><p>使用用Rust编写的后端库，libcurl将依靠这样的组件来执行低级协议工作，这样做可能会增加实现安全可靠的机会。</p><p>上面的世界地图图像中已经支持的第三方库中有两个是用Rust编写的：quiche和Mesalink。</p><p>Hyper是用Rust编写的HTTP库。它应该是快速、准确和安全的，它同时支持HTTP/1和HTTP/2。</p><p>随着libcurl后端数量不断增加，我们又迈出了一步，开始确保curl(可选)可以构建为使用Hyper。</p><p>这项工作得到了ISRG的慷慨资助，ISRG可能最为人所知的就是“让我们加密”背后的组织。谢谢!。</p><p>我想强调的是，现在还为时尚早。我们知道我们想要做什么，我们基本上知道如何做，但从那里到真正完成它，并将其以源代码的形式提供给世界，这是一项尚未完成的工作。我已经准备好去做这件事了。</p><p>Hyper没有C API，他们正在努力开发一个，这样基于C的应用程序(如cURL)就可以实际使用它。我尽了最大努力从我的角度提供反馈，但由于我对Rust不是很感兴趣，所以我不能在那里的实现部分提供太多帮助。</p><p>一旦有了API的早期/alpha版本可供试用，我将首先确保curl可以构建为使用Hyper，然后开始查看代码以开始使用它。</p><p>在这项工作中，我希望我必须带着问题、反馈和文档建议回到API。我还预见到将libcurl内部转换为使用它的挑战。大部分是小的，但也可能是大的。</p><p>我已经创建了一个git分支，并在早期将我在这个网站上的工作公之于众，让每个想要的人都能跟上发展的步伐。第一个里程碑将是成功运行单个CURL测试用例(任何测试用例)的能力--不加修改。分支在这里：https://github.com/curl/curl/tree/bagder/hyper-注意它将频繁地改变基数。</p><p>这个项目没有最后期限，我还没有任何猜测，因为什么时候会有什么东西来测试。</p><p>这个项目对于未来的开发人员来说是真正的基础工作，因为这里处理的一些问题应该也会使其他人受益。例如，很明显，Rust通常鼓励在内存不足问题上中止，而当代码在系统库(如cURL)中使用时，这是一个很大的禁忌。</p><p>我在这里的细节有点含糊，因为这不是我的专业知识，但是Rust本身甚至不能正确地清理它的内存，当它遇到这样的条件时，它只是返回错误。显然，在使用hyper进行libcurl之前需要修复的东西可能会声明相同的行为，并且永远不会泄漏内存。</p><p>我们将致力于这个项目，让这种未来成为可能，我们的心态是它可以让用户受益。</p><p>如果真的发生，则涉及许多不同的因素(例如成熟度、功能集、内存占用、性能、可移植性和磁盘占用…)。特别是，它将在很大程度上依赖于构建和发布您使用的curl包的人员-这不是cURL项目本身，因为我们只发布源代码。我在考虑Linux和操作系统发行版等。</p><p>什么时候可能会发生，我们还不能确定，因为我们在这个过程中还为时过早。</p><p>不要上当受骗，以为我们采取这一步就可以摆脱卷曲的C。随着Hyper Powered后端的引入，我们肯定会将在典型HTTP传输中执行的C代码份额减少一个可测量的量(对于那些构建)，但cURL远不止于此。</p><p>在您所关心的平台上，Hyper后端甚至不一定会“赢得”与C实现的用户竞争。未来还没有确定。</p><p>当然，有何不可？正在努力提供更多用Rust编写的后端。渐渐地，我们可能会进入这样一个未来：最终的curl和libcurl可执行代码越来越少地从C编译而来。</p><p>当然，这将如何以及是否会发生，将取决于许多因素-特别是必要工作的资金。</p><p>我们是否可以进一步推动这方面的发展呢？我认为现在推测这一点还为时过早。让我们先来看看未来几十年的前几集结果如何。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://daniel.haxx.se/blog/2020/10/09/rust-in-curl-with-hyper/">https://daniel.haxx.se/blog/2020/10/09/rust-in-curl-with-hyper/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/内存/">#内存</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/安全/">#安全</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/safe/">#safe</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/curl/">#curl</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1027353.html"><img src="http://img2.diglog.com/img/2020/10/thumb_5698ca4339ea6a8467348b431cb8229b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1027353.html">谷歌推出Pixel 4a 5G，6.2英寸显示屏，6 GB内存，128 GB存储空间，高通765G芯片组，18W USB-C快速充电，售价499美元</a></div><span class="my_story_list_date">2020-10-1 3:28</span></div><div class="col-sm"><div><a target="_blank" href="/story/1024784.html"><img src="http://img2.diglog.com/img/2020/9/thumb_41b739e6fcf7ccc7b25fba1d52942df1.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024784.html">Mmap()写入时复制技巧：减少数组副本的内存使用量</a></div><span class="my_story_list_date">2020-9-18 14:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1024441.html"><img src="http://img2.diglog.com/img/2020/9/thumb_e6caa00f94c9f81d1681e5771659369e.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024441.html">比较两个内存分配器不是那么简单的任务</a></div><span class="my_story_list_date">2020-9-17 5:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1023285.html"><img src="http://img2.diglog.com/img/2020/9/thumb_0a7400aa0987e296a504e02317fd7129.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1023285.html">谷歌发布了Android 11 Go Edition，它支持2 GB内存的手机，高于之前的1.5 GB，并表示启动应用程序的速度比Android Go 10快20%</a></div><span class="my_story_list_date">2020-9-11 21:49</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>