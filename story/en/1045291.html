<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GraalVM 21.0：引入了运行Java的新方法 GraalVM 21.0: Introducing a New Way to Run Java</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">GraalVM 21.0: Introducing a New Way to Run Java<br/>GraalVM 21.0：引入了运行Java的新方法 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-20 13:07:39</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/4c367d98d47423af5e558d86111199cd.jpeg"><img src="http://img2.diglog.com/img/2021/1/4c367d98d47423af5e558d86111199cd.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>With the recent winter holidays break this release was in development for a brief time, however it still offers a number of improvements and new exciting features for the whole GraalVM ecosystem.</p><p>在最近的寒假期间，此发行版的开发时间很短，但仍为整个GraalVM生态系统提供了许多改进和令人兴奋的新功能。</p><p> As with every release, we’re greatly thankful to the wonderful GraalVM community for all the feedback, collaboration and the discussions around the issues, sending pull requests, and last but not least spreading the word about the GraalVM project and how it helps your project. Together, we make GraalVM extraordinary!</p><p> 与每个版本一样，我们非常感谢出色的GraalVM社区对问题的所有反馈，协作和讨论，发送拉取请求，最后但并非最不重要的是，宣传了有关GraalVM项目及其对项目的帮助。在一起，我们使GraalVM变得非凡！</p><p>   In this article we want to talk about some of the most notable changes in GraalVM 21.0. There are many components to GraalVM and every release brings improvements and fixes to all of them. So for a more detailed list of changes, please consider the  release notes on the website or the change logs of the individual components.</p><p>   在本文中，我们想谈一谈GraalVM 21.0中一些最值得注意的更改。 GraalVM有很多组件，每个发行版都对其进行了改进和修复。因此，有关更改的详细列表，请考虑网站上的发行说明或各个组件的更改日志。</p><p>  As usual, the release bumps up the version of the JDK used for the GraalVM builds. GraalVM Community Edition in 21.0 is based on OpenJDK version 1.8.0_282 and OpenJDK version 11.0.10, and the GraalVM Enterprise on Oracle JDK version 1.8.0_281 and Oracle JDK version 11.0.10.</p><p>  与往常一样，该发行版增加了用于GraalVM构建的JDK版本。 21.0中的GraalVM社区版基于OpenJDK 1.8.0_282版和OpenJDK 11.0.10版，以及Oracle JDK 1.8.0_281版和Oracle JDK 11.0.10版上的GraalVM Enterprise。</p><p>  The most exciting addition in GraalVM 21.0 is the new component which implements Java on Truffle. Java on Truffle is a JVM, realized with the  Truffle framework.</p><p>  GraalVM 21.0中最令人兴奋的功能是在Truffle上实现Java的新组件。 Truffle上的Java是JVM，由Truffle框架实现。</p><p>  Java on Truffle is currently marked as experimental. However, even in this initial release state it offers very interesting capabilities and makes Java (and other JVM languages) possible to run through the infrastructure that powers all other GraalVM languages.</p><p>  松露上的Java当前被标记为实验性的。但是，即使在此初始发行状态下，它也提供了非常有趣的功能，并使Java（和其他JVM语言）可以在支持所有其他GraalVM语言的基础架构中运行。</p><p> Install it with  gu install espresso, and give it a spin by running your favourite Java app with  java -truffle.</p><p> 使用gu install espresso安装它，并通过使用java -truffle运行您最喜欢的Java应用程序来尝试一下。 </p><p> Read more about Java on Truffle in  this adjacent article providing more details, motivation, and use cases for how you can experiment with using Java on Truffle now.</p><p>在此相邻的文章中阅读有关Truffle的更多信息，提供更多详细信息，动机和用例，以帮助您立即尝试使用Truffle上的Java。</p><p>  One of the things possible now is the use of  Java serialization in the native image binaries. Serialization usage needs to be configured, just like the other dynamic features, and classes which can be serialised/deserialized needs to be known during the build time. The configuration can be generated using the  assisted configuration with  javaagent, so you don’t have to create it from scratch.</p><p>  现在可能发生的事情之一是在本机映像二进制文件中使用Java序列化。就像其他动态功能一样，需要配置序列化用法，并且在构建期间需要知道可以序列化/反序列化的类。可以使用javaagent的辅助配置来生成该配置，因此您不必从头开始创建它。</p><p>   It serializes, deserializes and prints the Fibonacci numbers. You can compile and run it with javaagent:</p><p>   它会序列化，反序列化并打印斐波那契数。您可以使用javaagent编译并运行它：</p><p>  Now in the config directory, we can see the JSON file showing which classes will be included for serialisation:</p><p>  现在在config目录中，我们可以看到JSON文件，其中显示了要进行序列化的类：</p><p>  All that is left to build the native image is just running the command:  native-image -cp .:config Main. And voila, the list of the Fibonacci numbers will be serialized/deserialized when you run the result.</p><p>  剩下的所有用于构建本机映像的操作只是运行以下命令：native-image -cp。：config Main。瞧，运行结果时，斐波那契数字的列表将被序列化/反序列化。</p><p> In addition to this very important change that brings native image capabilities to more Java programs much easier than before, 21.0 has an improved  method handle invocation support. Most of the use cases of method handles should be working now. They do require the configuration, but the tracing agent can also provide it for you.</p><p> 除了这一非常重要的更改之外，此更改比以前更容易为更多Java程序带来本机映像功能，此外21.0还改进了方法句柄调用支持。方法句柄的大多数用例现在应该可以工作。它们确实需要配置，但是跟踪代理也可以为您提供配置。</p><p> Speaking of the configuration agent with the configuration provided by it, you can build  native images of the AWT and Swing applications on Linux (experimental). Other platforms aren’t supported yet, but it’s an excellent first step.</p><p> 说到配置代理所提供的配置，您可以在Linux上构建AWT和Swing应用程序的本机映像（实验性的）。目前尚不支持其他平台，但这是第一步。 </p><p>  Truffle added the  HostCompilerDirectives annotation for directives that guide the optimizations in host compilations of the Truffle interpreters:</p><p>Truffle为指令添加了HostCompilerDirectives注释，这些指令指导Truffle解释器的主机编译中的优化：</p><p> HostCompilerDirectives.BytecodeInterpreterSwitchBoundary to denote methods that do not need to be inlined into the bytecode interpreter switch.</p><p> HostCompilerDirectives.BytecodeInterpreterSwitchBoundary表示不需要内联到字节码解释器开关中的方法。</p><p>   Compatibility is always priority number one, and this release enables the following ECMAScript 2021 mode/features by default:</p><p>   兼容性始终是第一要务，默认情况下，此版本启用以下ECMAScript 2021模式/功能：</p><p>  Even more, if you would run the JavaScript engine in the ECMAScript 2022 mode enabled by the  --js.ecmascript-version=2022 option, you even get the implementation of the  relative indexing method proposal.</p><p>  甚至，如果您要通过--js.ecmascript-version = 2022选项启用的ECMAScript 2022模式下运行JavaScript引擎，您甚至可以实现相关索引方法建议的实现。</p><p>  In GraalVM 21.0, the Ruby implementation now targets compatibility with Ruby 2.7.2. Most Ruby 2.7 features and changes are implemented (see  this GitHub issue for the details).</p><p>  在GraalVM 21.0中，Ruby实现现在的目标是与Ruby 2.7.2兼容。大多数Ruby 2.7功能和更改都已实现（有关详细信息，请参见GitHub问题）。</p><p> In addition to that, in the short time this release was in development, there were some performance improvements, notably methods like  MatchData#length,  Array#sample,  String#inspect, are now more efficient.</p><p> 除此之外，在此发行版的短时间内，它就进行了一些性能改进，特别是MatchData＃length，Array＃sample，String＃inspect等方法现在更加高效。</p><p>  Some interop method under  Truffle::Interop have been renamed to match better the naming of  InteropLibrary (#2139).</p><p>  Truffle :: Interop下的一些interop方法已重命名，以更好地匹配InteropLibrary（＃2139）的命名。 </p><p> Note that the new IRB version is quite slow when copy/pasting code into it. This is due to an inefficient  io/console implementation which will be addressed in the next release. A workaround is to use  irb --readline, which disables some IRB features but is much faster for copy/pasting code.</p><p>请注意，新的IRB版本在将代码复制/粘贴到其中时非常慢。这是由于io / console实施效率低下，将在下一版本中解决。一种解决方法是使用irb --readline，它禁用了一些IRB功能，但是对于复制/粘贴代码要快得多。</p><p>  The team continues to work on the compatibility both with Python native libraries and the Jython implementation.</p><p>  该团队将继续致力于与Python本机库和Jython实现的兼容性。</p><p> For example, 21.0 saw the addition of the   jarray  module for compatibility with Jython. It also sports fixes to avoid possible memory leaks and crashes when running NumPy in certain setups and improved support for Pandas.</p><p> 例如，在21.0中添加了jarray模块以与Jython兼容。它还提供一些修复程序，以避免在某些设置中运行NumPy时可能出现的内存泄漏和崩溃，并改善了对Pandas的支持。</p><p> For more details about the performance updates, and other fixes, check out the  changelog in the repo.</p><p> 有关性能更新和其他修补程序的更多详细信息，请查看存储库中的更改日志。</p><p>  One of the major areas for improvement for the LLVM bitcode runtime implementation is warmup. In 21.0 we improved not only the AST sharing — sharing the internal representation of the program among several contexts in a single engine, but also introduced support for the auxiliary engine caching. On top of what the AST sharing provides, the auxiliary engine caching allows persisting of shared code across process boundaries.</p><p>  预热是LLVM位代码运行时实现的主要改进领域之一。在21.0中，我们不仅改进了AST共享-在单个引擎中的多个上下文之间共享程序的内部表示，还引入了对辅助引擎缓存的支持。除了AST共享提供的功能之外，辅助引擎缓存还允许跨进程边界持久存储共享代码。</p><p>  The Webassembly interpreter sometimes flies under the radar, but there’s always active work happening to make it better, faster, and more secure. In 21.0 we optimized the Graalwasm interpreter making the warmup better and overall peak performance of  interpreting WebAssembly up to 20x faster. We also pass most of the official WebAssembly specification suite now, and we are working on fixing several minor remaining edge-cases.</p><p>  Webassembly解释器有时会躲在雷达下，但是总会进行积极的工作以使其更好，更快和更安全。在21.0中，我们优化了Graalwasm解释器，使预热更好，解释WebAssembly的总体峰值性能提高了20倍。现在，我们还通过了大多数官方的WebAssembly规范套件，并且我们正在修复几个剩余的小案例。</p><p>  Since GraalVM 21.0 the  gu utility becomes more powerful and can be used to update your local  GraalVM installation to a newer version, or upgrade from the Community to Enterprise Edition. Please refer to the documentation for  more details.</p><p>  从GraalVM 21.0开始，gu实用程序变得更加强大，可用于将本地GraalVM安装更新到较新版本，或从社区升级到企业版。请参阅文档以获取更多详细信息。 </p><p> Also, as a part of the GraalVM 21.0 release, we’re happy to announce the  GraalVM Extension Pack for Visual Studio Code. While being a Technology Preview release, it already provides many features to boost your Java 8+, JavaScript, Python, Ruby, R, and Micronaut productivity in the VS Code environment. The Extension Pack is immediately available on the Visual Studio Code Marketplace and ready to be installed right from your VS Code — just type GraalVM in the Extensions: Marketplace view, select the GraalVM Extension Pack and click the Install button. While installing, you can read  more details on the VS Code extensions in a separate article.</p><p>另外，作为GraalVM 21.0版本的一部分，我们很高兴宣布用于Visual Studio Code的GraalVM扩展包。 在技术预览版中，它已经提供了许多功能，可以在VS Code环境中提高Java 8 +，JavaScript，Python，Ruby，R和Micronaut的生产率。 该扩展包可立即在Visual Studio Code Marketplace上使用，并准备从VS Code直接安装-只需在Extensions：Marketplace视图中键入GraalVM，选择GraalVM Extension Pack并单击Install按钮。 安装时，您可以在另一篇文章中阅读有关VS Code扩展的更多详细信息。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/graalvm/graalvm-21-0-introducing-a-new-way-to-run-java-df894256de28">https://medium.com/graalvm/graalvm-21-0-introducing-a-new-way-to-run-java-df894256de28</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/运行/">#运行</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/run/">#run</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/graalvm/">#graalvm</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>