<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Go的标准库中协调公开XML往返漏洞 Coordinated disclosure of XML roundtrip vulnerabilities in Go’s standard library</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Coordinated disclosure of XML roundtrip vulnerabilities in Go’s standard library<br/>在Go的标准库中协调公开XML往返漏洞 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-15 03:07:16</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/d380e7e30106a9e65172ee451c2075b6.png"><img src="http://img2.diglog.com/img/2020/12/d380e7e30106a9e65172ee451c2075b6.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This blog post is a part of Mattermost’s public disclosure of three serious vulnerabilities in Go’s  encoding/xml related to tokenization round-trips. The public disclosure comes as a result of several months of work, including collaborating with the Go security team since August 2020 and with affected downstream project maintainers since earlier this month. There are several potential security problems created by these vulnerabilities, one of which is a complete bypass of SAML authentication.</p><p>这篇博客文章是Mattermost公开披露的Go编码/ xml中与标记化往返相关的三个严重漏洞的一部分。经过几个月的工作，公开披露才得以完成，其中包括自2020年8月以来与Go安全团队合作以及自本月初以来与受影响的下游项目维护者合作。这些漏洞造成了一些潜在的安全问题，其中之一是完全绕过SAML身份验证。</p><p> These issues do not impact Mattermost customers. See  “No impact to Mattermost customers” below for more info.</p><p> 这些问题不会影响Mattermost客户。有关更多信息，请参见下面的“对最重要的客户没有影响”。</p><p> Despite significant efforts by the Go security team, it has not been possible to patch the vulnerabilities discussed in this blog post. Only one of the three is on the roadmap to be patched in the foreseeable future (see  “Update 12/13/2020” below). The mitigation for the remaining issues will be adding a new mode in Go to make explicit that these vulnerabilities exist. Downstream projects that assume certain integrity guarantees from Go’s standard library are vulnerable when those guarantees do not hold. The implications of these vulnerabilities in key use cases we have identified present a material security concern. If you maintain a Go-based project that relies on XML integrity, we urge you to read this post carefully.</p><p> 尽管Go安全团队做出了巨大努力，但仍无法修补此博客文章中讨论的漏洞。在可预见的将来，只有三个补丁中的一个要修补（请参阅下面的“更新12/13/2020”）。其余问题的缓解措施将是在Go中添加新模式，以明确表明存在这些漏洞。如果Go的标准库中的某些完整性保证不成立，则这些下游项目很容易受到攻击。在我们确定的关键用例中，这些漏洞的隐含意义构成了重大的安全隐患。如果您维护一个依赖XML完整性的基于Go的项目，我们敦促您仔细阅读这篇文章。</p><p> We don’t take this type of public disclosure lightly, and it has not been an easy decision to make. There are three reasons why we are doing this now:</p><p> 我们不会掉以轻心，这种公开决定并非易事。我们现在这样做的原因有三个：</p><p> The Go security team has determined that the root causes of the vulnerabilities cannot be reliably addressed.</p><p> Go安全团队已确定无法可靠地解决漏洞的根本原因。</p><p> Go is introducing publicly-visible API changes related to these issues in an upcoming major release, which risks making the vulnerabilities public without explicit public disclosure.  The Go security team has agreed to Mattermost coordinating disclosure prior to making their changes public in order to minimize impact to parts of the ecosystem that can’t benefit from the new API. Refer to the  “Upcoming changes in Go” section for details.</p><p> Go将在即将发布的主要版本中引入与这些问题相关的公开可见的API更改，这有可能在没有明确公开披露的情况下将漏洞公开。 Go安全小组已同意在进行更改之前将Mattermost协调披露，以最大程度地减少无法从新API中受益的对生态系统各部分的影响。有关详细信息，请参阅“即将进行的更改”部分。</p><p> Careful steps have been taken to privately disclose the issues to as many affected parties as possible prior to proceeding with public disclosure. All parties involved in the disclosure have collaborated to ensure mitigations are in place and sufficient.</p><p> 在进行公开披露之前，已经采取了谨慎的步骤将问题私下披露给尽可能多的受影响方。本公开中涉及的所有各方已经合作以确保缓解措施到位且足够。 </p><p>  As part of our security work, we have identified three independently exploitable vulnerabilities in Go’s  encoding/xml. The advisories are linked below:</p><p>作为我们安全工作的一部分，我们在Go的encoding / xml中发现了三个可独立利用的漏洞。咨询链接如下：</p><p>  As evident from the titles, the vulnerabilities are closely related. The core issue is the same in all three: maliciously crafted XML markup mutates during round-trips through Go’s decoder and encoder implementations.</p><p>  从标题可以明显看出，这些漏洞密切相关。这三个核心问题都是相同的：恶意复制的XML标记会在通过Go的解码器和编码器实现的往返过程中发生变异。</p><p> What does that mean in practice? If your application processes XML and, while processing it, parses markup that’s the output of at least one preceding round of parsing and serialization, you can no longer assume the output of that parsing matches the output from the preceding round. In other words, passing XML through Go’s decoder and encoder doesn’t preserve its semantics.</p><p> 实际上这是什么意思？如果您的应用程序处理XML，并且在处理XML时解析了至少是前一轮解析和序列化输出的标记，那么您将无法再假定该解析的输出与前一轮的输出匹配。换句话说，通过Go的解码器和编码器传递XML不会保留其语义。</p><p> This may sound like a non-issue or a source of functional bugs at worst, but the reality of it is much more serious. There are applications that absolutely require semantic integrity in XML in order to be secure — a major example being SAML.</p><p> 在最坏的情况下，这听起来像是一个非问题或功能错误的来源，但事实却更为严重。有些应用程序绝对需要XML中的语义完整性才能确保安全-一个主要的例子是SAML。</p><p> SAML, or the Security Assertion Markup Language, is an XML-based standard approach to single sign-on on the web. It conveys user identity in XML documents whose integrity and authenticity are guaranteed using cryptographic signatures, a scheme called XML-DSig. Because of these vulnerabilities, Go-based SAML implementations are in many cases open to tampering by an attacker: by injecting malicious markup to a correctly signed SAML message, it’s possible to make it still appear correctly signed, but change its semantics to convey a different identity than the original document.</p><p> SAML或安全声明标记语言是一种用于Web上单点登录的基于XML的标准方法。它在XML文档中传达用户身份，该XML文档的完整性和真实性通过使用加密签名（一种称为XML-DSig的方案）来保证。由于这些漏洞，基于Go的SAML实现在许多情况下容易受到攻击者的篡改：通过向正确签名的SAML消息注入恶意标记，有可能使它仍然显示为正确签名，但可以更改其语义以传达不同的含义。身份要比原始文件好。</p><p> The actual impact of these XML round-trip vulnerabilities of course varies by use case, but in SAML SSO it’s easy to understand: if your SAML messages can be altered to say you’re someone you’re not, the result is arbitrary privilege escalation within the scope of the SAML Service Provider, or in some cases even complete authentication bypass.</p><p> 这些XML往返漏洞的实际影响当然会因用例而异，但是在SAML SSO中很容易理解：如果可以将SAML消息更改为说自己不是别人，那么结果就是任意特权升级在SAML服务提供者的范围内，或者在某些情况下甚至可以完成身份验证绕过。</p><p> As mentioned before, despite significant efforts by the Go security team, there is no Go patch that would reasonably address these vulnerabilities. That doesn’t mean all hope is lost: Along with the public disclosure of these vulnerabilities, we’re open-sourcing an XML validation library that can be used as a workaround. The library as well as basic instructions for its use can be found at  github.com/mattermost/xml-roundtrip-validator.</p><p> 如前所述，尽管Go安全团队付出了巨大的努力，但尚无Go补丁可以合理地解决这些漏洞。这并不意味着所有希望都将丢失：随着这些漏洞的公开披露，我们正在公开采购XML验证库，该库可以用作解决方法。该库及其使用的基本说明可以在github.com/mattermost/xml-roundtrip-validator中找到。 </p><p>  At the time this public disclosure is taking place, no supported versions of Mattermost products are affected by any of the vulnerabilities. Any impact to Mattermost software has been addressed independently prior to this disclosure and communicated to customers according to Mattermost’s standard disclosure policy.  No action is required from Mattermost customers at this time.</p><p>在进行公开披露时，任何漏洞都不会影响Mattermost产品的受支持版本。在披露之前，对Mattermost软件的任何影响已独立解决，并已根据Mattermost的标准披露政策告知客户。目前，Mattermost客户无需采取任何措施。</p><p> Mattermost staff originally detected the first one of these vulnerabilities during an internal security review on the 28th of August, 2020. As an immediate response the only affected feature of Mattermost server, a new SAML implementation still in beta at the time, was forcefully disabled. The update was rolled out to customers  in a dot release on the 3rd of September. Mattermost Cloud was not generally available at that time, and so was never affected.</p><p> Mattermost的员工最初在2020年8月28日的内部安全审查中检测到了这些漏洞中的第一个。作为立即响应，Mattermost服务器的唯一受影响的功能（当时仍处于beta测试中的新SAML实施）被立即禁用。该更新于9月3日通过点发布向客户推出。那时Mattermost Cloud尚不可用，因此从未受到影响。</p><p> The affected SAML implementation was available as a non-default configuration in Mattermost server versions from 5.20.0 up to and including 5.26.1. Mattermost deployments were only vulnerable if all of the following were simultaneously true:</p><p> 在Mattermost服务器版本从5.20.0到5.26.1（含）的非默认配置中，可以使用受影响的SAML实现。只有同时满足以下所有条件，最重要的部署才容易受到攻击：</p><p> The server was running a version between 5.20.0 and 5.26.1, released before September 2020. This excludes Extended Support Releases 5.25.5 and above.</p><p> 该服务器运行的版本介于5.20.0和5.26.1之间，于2020年9月之前发布。这不包括5.25.5及更高版本的扩展支持。</p><p>  The setting “Use Improved SAML Library (Beta)” had been explicitly enabled by an administrator.</p><p>  管理员已明确启用设置“使用改进的SAML库（Beta）”。</p><p> Details of the security release addressing these vulnerabilities can be found on the  Mattermost Security Updates page under the identifier MMSA-2020-0030.</p><p> 解决这些漏洞的安全版本的详细信息可以在“最安全更新”页面的标识符MMSA-2020-0030下找到。</p><p> Since the September dot release, Mattermost products have not been vulnerable. We have no evidence of this issue being ever exploited.</p><p> 自从9月发布点以来，Mattermost产品一直没有受到攻击。我们没有证据表明这个问题曾经被利用过。 </p><p>  We have identified three major open source SAML implementations affected by the Go XML round-trip vulnerabilities:  Dex SAML Connector,  github.com/crewjam/saml, and  github.com/russellhaering/gosaml2. The maintainers of all three projects were included in private embargoed disclosure prior to publishing any details. Maintainers were also given advance access to the github.com/mattermost/xml-roundtrip-validator repository.</p><p>我们确定了受Go XML双向漏洞影响的三个主要的开源SAML实现：Dex SAML连接器，github.com/crewjam/saml和github.com/russellhaering/gosaml2。在发布任何详细信息之前，所有三个项目的维护者都被包括在私人禁运披露中。维护人员还可以提前访问github.com/mattermost/xml-roundtrip-validator存储库。</p><p>   We have also privately reached out to maintainers of significant applications and products that depend on these SAML implementations and given them an advance warning of today’s disclosure without revealing technical details.</p><p>   我们还私下与依赖于这些SAML实现的重要应用程序和产品的维护者联系，并向他们提前警告了今天的公开内容，而没有透露技术细节。</p><p> Having an idea of the scale and range of affected products may help in understanding why we’ve gone to such lengths in coordinating this. We reached out to a total of 20 companies and projects in addition to the maintainers of the SAML implementations named above. The affected products include:</p><p> 了解受影响产品的规模和范围可能有助于理解我们为什么要花这么长的时间来协调这一点。除上述SAML实施的维护者外，我们还与20个公司和项目进行了接触。受影响的产品包括：</p><p>  If you find yourself among the organizations we contacted, we urge you to start patching immediately.</p><p>  如果您发现自己属于我们联系的组织中，我们敦促您立即开始修补。</p><p> It’s unlikely that we found all affected use cases, libraries, and products, and we may have missed even major ones. Even if you didn’t hear from us but suspect your particular use case of encoding/xml may be affected, please consider reviewing your codebase for vulnerable patterns.</p><p> 我们不太可能找到所有受影响的用例，库和产品，甚至可能错过了主要用例。即使您没有收到我们的来信，但怀疑您可能会影响您的encoding / xml的特定用例，请考虑查看您的代码库以了解易受攻击的模式。</p><p>  The Go security team is planning changes to  encoding/xml that address round-trip vulnerabilities by deprecating existing behaviors from a security perspective. A new API is expected to land in Go 1.16 that will allow disabling namespace prefix parsing entirely. The current functionality will remain available, but it will no longer be considered secure for use cases that require round-trip stability; Go will stop accepting vulnerability submissions related to its behavior.</p><p>  Go安全团队正在计划对编码/ xml进行更改，以通过从安全角度弃用现有行为来解决往返漏洞。有望在Go 1.16中使用新的API，该API将允许完全禁用名称空间前缀解析。当前的功能将保持可用，但对于需要往返稳定性的用例，它将不再被视为安全； Go将停止接受与其行为相关的漏洞提交。</p><p> The Go security team has chosen this path after determining that the  encoding/xml package and its data structures were not designed to make safe round-trips possible. The new API allows them to lower developers’ expectations to a more manageable level, as the support for round-trips in the most problematic cases can be explicitly dropped.</p><p> Go安全团队在确定encoding / xml包及其数据结构的设计不旨在实现安全往返之后，选择了此路径。新的API使他们可以将开发人员的期望降低到更易于管理的水平，因为可以将最有问题的情况下对往返的支持明确删除。 </p><p> By Mattermost’s estimates this new API will not be a reasonable solution for most use cases currently affected by the vulnerabilities. Parsing and resolving namespaces is an essential requirement for correctly implementing SAML, and even considering only a limited set of real-world SAML messages without strict namespacing requirements would be unlikely to allow for a secure implementation.</p><p>据Mattermost估计，对于当前受漏洞影响的大多数用例，该新API都不是合理的解决方案。解析和解析名称空间是正确实现SAML的基本要求，即使仅考虑一组有限的实际SAML消息而没有严格的命名空间要求，也不太可能实现安全的实现。</p><p> Because of this reason, we recommend that affected developers continue using the github.com/mattermost/xml-roundtrip-validator module even after Go 1.16 becomes available. As a long-term solution, it may make sense to refactor code in a way that avoids encoding round-trips altogether, but it’s unclear if such refactoring is possible in all cases.</p><p> 因此，即使Go 1.16可用，我们仍建议受影响的开发人员继续使用github.com/mattermost/xml-roundtrip-validator模块。作为一种长期解决方案，重构代码可能会完全避免对往返编码，但尚不清楚是否在所有情况下都可以进行重构。</p><p>  We just heard from the Go team that there are possibly additional changes coming in a future version.  It’s not clear to us whether these changes fully fix the XML validation issues in Go, but we’re hopeful that these issues will get fully patched in Go in the near future. We have been informed that a public discussion with the Go team will be opened in this issue at  https://golang.org/issue/43168.</p><p>  我们刚刚从Go团队那里听说，将来的版本中可能还会有其他更改。目前尚不清楚这些更改是否能完全解决Go中的XML验证问题，但我们希望这些问题将在不久的将来在Go中得到全面修补。我们已经获悉，本期将与Go团队进行公开讨论，网址为https://golang.org/issue/43168。</p><p>  The first of the XML round-trip vulnerabilities was originally discovered on the 28th of August, 2020, and by the 31st of August Mattermost had traced the root cause to encoding/xml and reached out to the Go security team. The graphic below shows the full timeline from initial discovery to public disclosure. Blue circles represent actions taken by Mattermost, red circles are responses from the Go security team.</p><p>  XML双向漏洞的第一个漏洞最初是在2020年8月28日发现的，到8月31日，Mattermost已将根本原因追溯到encoding / xml并联系了Go安全团队。下图显示了从最初发现到公开披露的完整时间表。蓝色圆圈代表Mattermost采取的行动，红色圆圈代表Go安全团队的回应。</p><p>  Mattermost would like to thank the Go security team and downstream library maintainers for their many efforts and their collaboration in responding to these important issues.</p><p>  Mattermost谨感谢Go安全团队和下游图书馆维护者在响应这些重要问题方面所做的努力和合作。</p><p>  If you suspect you’ve found a vulnerability in a Mattermost product or open source project such as the  github.com/mattermost/xml-roundtrip-validator module, please report your findings to  responsibledisclosure@mattermost.com. We ask you not to use public GitHub issues for reporting security issues.</p><p>  如果您怀疑在Mattermost产品或开源项目（例如github.com/mattermost/xml-roundtrip-validator模块）中发现了漏洞，请将发现的结果报告给负责人disclosure@mattermost.com。我们要求您不要使用公共GitHub问题来报告安全问题。</p><p> If you have general questions about application security at Mattermost or the vulnerabilities included in this disclosure, don’t hesitate to reach out to us at  security@mattermost.com.</p><p> 如果您对Mattermost的应用程序安全性或本披露中包含的漏洞有一般性疑问，请随时通过security@mattermost.com与我们联系。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://mattermost.com/blog/coordinated-disclosure-go-xml-vulnerabilities/">https://mattermost.com/blog/coordinated-disclosure-go-xml-vulnerabilities/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/漏洞/">#漏洞</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/库中/">#库中</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/xml/">#xml</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>