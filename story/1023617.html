<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>C语言最大的错误</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">C语言最大的错误</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-13 04:40:31</div><div class="page_narrow text-break page_content"><p>可以说，C语言是世界上最成功的编程语言。当然，它的成功无休止地诱惑人们改进它。因此，C很可能是最长的语言列表。其中值得注意的是C++，D编程语言，最近，去吧。关于如何修复C语言的讨论帖子层出不穷，回到80年代。</p><p>所以这是一片平坦的土地。这汤里还能加点什么呢？我假设大多数这样的讨论都是围绕细节展开的。更有趣的是最大的根本性错误。我们应该考虑到时代的脉络。这就产生了C语言，以及它试图解决的问题和环境它原本打算在其中使用的地方。请记住，它是为16架飞机开发的比特机，可用资源极其有限。我想把它并不是这样的事情放在一边执行垃圾收集、函数式编程、动态类型或OOP。这些不是问题C试图解决，所以缺少它们并不是错误。</p><p>什么错误导致了更多的悲伤，更多的错误，更多的变通方法，更多无穷无尽的时间消耗，等等，比其他任何东西都要多吗？很多人会说空指针。我不这样认为。</p><p>我的意思不是使用相同的语法，也不是隐式转换指向指针的数组。我的意思是无法将数组传递给函数作为数组，即使声明为数组也是如此。C将静默转换为将数组转换为指针，并将重写函数声明因此，它在语义上是一个指针：</p><p>这种看似无伤大雅的便利功能，其实是无穷无尽之恶的根源。这意味着一旦数组离开定义它们的作用域，它们变成指针，并丢失给出范围的信息数组的-数组维度。输掉比赛的后果是什么？这个信息？</p><p>必须使用替代方案。对于字符串，这是0终止符的全部原因。为其他数组，则从上下文以编程方式推断。当然，每种情况都是不同的，因此无穷无尽的阵列(！)。大量的虫子接踵而至。</p><p>C字符串函数的星系，从不安全的strcpy()到sprintf()，是一个直接的结果。有各种尝试来修复此问题，例如安全C库。然后就是所有的缓冲区溢出，因为函数传递的指针没有知道限制是什么，并且不可能进行数组边界检查。</p><p>这个问题被C++完全继承了下来，从而催生了10多年的时间尝试创建可用的字符串类。即使最终的std：：string结果也是如此由于需要与以C0结尾的字符串兼容而受到损害。C++通过发明std：：Vector和许多编程准则避免使用T[]样式的数组。但它留下的遗产C数组在C++中继续使用不安全的迭代器设计。</p><p>C99试图解决此问题，但它所犯的致命错误仍然存在未将数组维度和数组指针组合为一种类型。</p><p>但并不是一切都失去了。C仍然可以修复。它所需要的只是一个小小的新语法：</p><p>这意味着数组作为所谓的“胖指针”传递，即由指向数组开头的指针，以及数组维度的size_t。当然，这不会修复任何现有代码，但可以编写新代码正确而有力地。随着时间的推移，语法：</p><p>根据约定和编译器可以弃用。更好的是，过渡到可以通过使声明与旧代码兼容二进制来实现新的方法：</p><p>#如果是NEWC外部void foo(char a[..])；#Elif C99外部void foo(size_t dim，char a[dim])；#其他外部void foo(size_t dim，char*a)；#endif。</p><p>这一改变不会把C语言转变成一种现代语言，因为它具有所有闪亮的钟声和口哨声。无论是在精神上还是在实践中，它仍然是C级的。会的只需将C程序员从处理一个特定的、有害的常量源中解脱出来虫子。</p><p>K+R的The C Programming Language 5.3中的相关文本是“将数组名称传递给函数时，传递的是数组开头的位置。在被调用的函数内，此参数是一个变量，就像任何其他变量一样，因此数组名称参数实际上是一个指针，即包含一个地址。“。</p><p>C99标准6.7.5.3.7的相关文本为“将参数声明为‘类型数组’应调整为“指向类型的限定指针”“</p><p>摘自Stroupstrup的C++编程语言第一版7.1像往常一样，数组名称将转换为指针。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://digitalmars.com/articles/C-biggest-mistake.html">https://digitalmars.com/articles/C-biggest-mistake.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/语言/">#语言</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/biggest/">#biggest</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数组/">#数组</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1023530.html"><img src="http://img2.diglog.com/img/2020/9/thumb_b5d0f1167a86fdbbb8945644fc4c54f6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1023530.html">是什么杀死了哈斯克尔，也可能杀死了拉斯特</a></div><span class="my_story_list_date">2020-9-12 14:46</span></div><div class="col-sm"><div><a target="_blank" href="/story/1023409.html"><img src="http://img2.diglog.com/img/2020/9/thumb_f054050a82a5fb70d4a42bf9e60ce89a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1023409.html">APRLE，一个通用Lisp的APL编译器[视频]</a></div><span class="my_story_list_date">2020-9-12 2:57</span></div><div class="col-sm"><div><a target="_blank" href="/story/1022621.html"><img src="http://img2.diglog.com/img/2020/9/thumb_b5d0f1167a86fdbbb8945644fc4c54f6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022621.html">是什么杀死了哈斯克尔，也可能杀死了拉斯特</a></div><span class="my_story_list_date">2020-9-8 7:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1022176.html"><img src="http://img2.diglog.com/img/2020/9/thumb_da40bbd249238856fdab09234046efaa.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022176.html">COBOL，一种有60年历史的计算机语言，正处于新冠肺炎的聚光灯下-随着州政府寻求修复不堪重负的失业救济金系统，他们需要熟练掌握一种在20世纪80年代初已经过时的语言的程序员。</a></div><span class="my_story_list_date">2020-9-5 7:23</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>