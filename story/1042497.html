<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>杰森·迪夫 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">杰森·迪夫 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-30 08:02:53</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/db121d97838dc10dea9ff9a3cf7c6acc.png"><img src="http://img2.diglog.com/img/2020/12/db121d97838dc10dea9ff9a3cf7c6acc.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>diff json有很多工具，但是只有json-diff使得编写程序来处理diff输出变得容易。在本文中，我们将探讨json-diff，如何使用它以及如何编写使用其输出的程序。</p><p>  json-diff是一个易于使用的CLI工具。它仅需要两个参数：FILE1和FILE2，它们只需要是json文件。</p><p>         json-diff没有内置漂亮的打印选项，因为jq为我们做到了。</p><p>  json-diff输出是“差异对象”的数组。每个差异对象都有：</p><p> path（必需）-j path是由字符串和数字组成的数组，用于描述差异在json中的位置。字符串用于访问对象值，数字用于访问数组值。</p><p> leftValue（可选）-leftValue表示路径中FILE1的值。如果缺少leftValue，则表示该路径的left json中没有值。</p><p> rightValue（可选）-rightValue表示路径中FILE2的值。如果rightValue丢失，则表示该路径的right json中没有值。 </p><p>json-diff对于人类看到差异很有用，但其真正的强大功能是用于计算机。 json-diff之所以大放异彩，是因为它很容易编写处理其输出的程序。这是因为输出：</p><p> 具有简单，透明的架构-这意味着它易于思考，并且很容易从中提取数据</p><p>  由于输出是json，因此我们经常可以使用jq处理json-diff的输出。在筛选出预期的故障时，Wicked快速测试中会涉及很多方面。例如，在Wicked快速测试中，因异常而失败的测试将异常存储在具有字符串键＆＃34; e＆＃34;的对象中。这样，如果我们想过滤出涉及错误的差异，可以编写一个快速的jq脚本：</p><p>  更强大的是，此输出是json-diff，因此您可以将许多过滤器组合在一起。假设我们知道第一次测试的更改，并且我们已经手动验证了这些更改是否良好，然后可以添加一行jq来隐藏第一次测试中的所有更改。</p><p>  尽管我们可以将它们组合成一个jq语句，但是两个jq命令更易读且可复制粘贴。这是我最近使用的一个真实示例：</p><p> ＃！/ usr / bin / env bashjq＆＃39; map（select（.path | contains（[＆＃34; result＆＃34 ;,＆＃34; backtest_d＆＃34;]）| not））＆＃39; | \ jq＆＃39; map（select（.path | contains（[＆＃34; result＆＃34 ;,＆＃34; parameters＆＃34;]）| not））＆＃39; | \ jq＆＃39; map（select（.path [0]！= 33））＆＃39; | \ jq＆＃39; map（select（.path [0]！= 51））＆＃39; | \ jq</p><p> 我在最后一行使用了NOOP jq，因此我可以轻松地复制粘贴任何实际的jq行来创建新的过滤器。这些程序不一定是完美的，它们是快速又肮脏的一次性程序。 </p><p>由于这些只是json过滤器，因此我们也可以用python或其他任何语言编写它们。这相当于过滤掉错误，并且是用python编写的第一个测试</p><p> ＃！/ usr / bin / env python3import jsonimport sysdef t（data）：如果d [＆＃34; path＆＃34;] [0]！= 0和d [＆＃34; path＆＃ 34;] [-1]！=＆＃34; e＆＃34;] print（json.dumps（t（json.load（sys.stdin）））））</p><p> 这大部分是锅炉板，重点放在粗线。它完成了繁重的工作。它看起来与jq非常相似，因为核心逻辑完全相同。</p><p>    当前，用于比较json或任何结构化数据文件的最新技术是使用文本diff（通常是git diff）。文本差异完全有效的事实证明了纯文本的强大功能，但仍然有限。文字差异有两个限制。</p><p> 文字差异不包含完整的json路径。在文本差异中，您可能需要几行上下文来理解更改。这对于代码来说效果很好，但对于JSON而言，值的路径需要理解更多行，因此不起作用。</p><p> 文字差异对人类来说很容易阅读，但对计算机来说却很难。某些语言具有diff解析器，例如python，但它们处于测试版。</p><p>  每个差异都包含一个“路径”字段，该字段包含两个文件之间不同的值的标准路径。 </p><p>json diff的输出本身就是json。这使得编写处理差异的程序变得轻而易举。稍后我们将了解为什么此功能非常有用。</p><p>    json-diff（尽管有名称）尤其不在于区分“ json”。关于差异化结构化数据，可以是任何格式。 CSV。 XML。 TOML。 YAML。诀窍是使用csv-to-json之类的工具将文件转换为json。只要您具有将它们转换为json的程序，甚至二进制文件都可以与json-diff比较。</p><p> 这听起来很难，但确实很容易。例如，要比较yaml文件，只需执行以下操作：</p><p> 猫old.yaml | yaml-to-json＆gt; old.jsoncat new.yaml | yaml-to-json＆gt; new.jsonjson-diff old.json new.json＃或作为一行json-diff＆lt;（yaml-to-json＆lt; old.yml）＆lt;（yaml-to-json＆lt; new.yml）</p><p>  许多代码库都有配置文件，这些配置文件是结构化数据。也许是yaml或json，都没关系。如果是Yaml，请将其转换为json，然后使用json-diff。</p><p>  出于代码合理的原因，配置代码正在席卷Devops。它本身就是一个很棒的概念，因此它应有自己的职位，但就我们的目的而言，重要的部分是config-as-code表示系统配置通常存储为结构化数据。结构化数据可以呈现为json，我们可以进行区分。</p><p>  邪恶的快速测试围绕测试作为碰巧是json的数据。特别是，可以通过将预期的测试结果（expected.json）与实际的测试结果（actual.json）进行比较来查看测试失败。 </p><p>如果您在安装或使用json-diff时遇到任何问题，只需在Twitter（@canardivore）上发消息给我，我们将竭诚为您服务。  我们已经了解了如何使用json-diff。 我们已经展示了处理输出以适应我们自己的需求是多么容易，无论是jq，python还是我们喜欢的语言。 我们已经了解了为什么可以使用它以及如何轻松安装它。  下周，我们将继续使用我最喜欢的工具之一json-sql进行有关json-toolkit的系列文章。 想象一下，能够通过一个命令将整个数据库转储到json中。 很简约。 如果您不想错过，请点击下面的立即订阅 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://codefaster.substack.com/p/json-toolkit-json-diff">https://codefaster.substack.com/p/json-toolkit-json-diff</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/杰森/">#杰森</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/json/">#json</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>