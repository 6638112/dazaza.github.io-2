<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CILIUM 1.10版本增加了WIGUARD透明加密的支持 Cilium 1.10 release adds support for WireGuard Transparent Encryption</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Cilium 1.10 release adds support for WireGuard Transparent Encryption<br/>CILIUM 1.10版本增加了WIGUARD透明加密的支持 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-23 06:01:07</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/d799dbaf1f8884276cf6117820893d90.png"><img src="http://img2.diglog.com/img/2021/6/d799dbaf1f8884276cf6117820893d90.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>The Cilium core team are excited to announce the Cilium 1.10 release. A totalof 2042 new commits have been contributed by a growing community of 280developers. Contributions have come from a wide list of different companiesincluding Alibaba, Datadog, Google, Isovalent, SuSE, Palantir among manyothers. We heard from users who are increasingly interested in betterintegration with the broader network, whether you&#39;re running Cilium in your owndatacenter environments or in the cloud. Thus, a major focus of this releasewas ensuring a seamless integration between the Kubernetes network andenterprise on-prem infrastructure.</p><p>Cilium Core团队很高兴地宣布Cilium 1.10释放。为280名越来越多的社区贡献了2042名新犯罪。贡献来自不同的公司列表，包括阿里巴巴，DataDog，谷歌，Isovalent，Suse，Wallantir之间的许多人。我们听说过与更广泛的网络越来越感兴趣的用户，无论您是＆＃39;在您的overdater环境中或云中运行纤毛。因此，该发行版的主要焦点确保了Kubernetes网络和预售的基础设施之间的无缝集成。</p><p> Egress IP Gateway: When integrating cloud-native applications with legacycounterparts operating outside the Kubernetes cluster, IP Address Managementcan be a pain point as Pod IPs are more dynamic than traditional networkendpoints. Through a new Kubernetes CRD, static IPs can now be associatedwith traffic as the packets egress the Kubernetes cluster. This allowsexternal firewalls to see consistent IPs and filter traffic for specific podspurely using the assigned static IP address.( More details)</p><p> EIGRES IP网关：在将云本机应用程序与在Kubernetes集群外部操作的LefacyCounterpart集成时，IP地址管理程序是止点，因为POD IP比传统的网络命令更加动态。通过一个新的Kubernetes CRD，静态IPS现在可以随着Kubernetes集群的数据包出口而与流量相关联。此允许使用指定的静态IP地址，查看一致的IPS和过滤流量的一致性IPS和过滤流量。（更多细节）</p><p> Integrated BGP Support: We’ve simplified the ability to advertiseKubernetes service IPs via BGP to allow workloads outside the Kubernetesenvironment to easily communicate with Cloud Native applications. With 1.10we&#39;ve incorporated BGP service announcement support directly into Ciliumso that these services can be exposed without the need for any additionalexternal components.( More details)</p><p> 集成的BGP支持：我们简化了通过BGP告知Kubernetes Service IPS的能力，以允许KubernetEnvironment外部的工作负载，以便与云本机应用程序轻松通信。与1.10we＆＃39; ve将BGP服务公告直接纳入CILIUMSO，即无需任何额外的额外组件就可以曝光这些服务。（更多细节）</p><p> Standalone Load Balancer: Cilium&#39;s high performance, robustload balancing implementation is tuned for the scale and churn ofcloud native environments. Now you can replace expensive legacy boxes inyour network with Cilium as a standalone load balancer. This unlocks thepotential of DSR and Maglev for handling north/south traffic inon-premises environments without requiring Kubernetes to manage the networkborder.( More details)</p><p> 独立负载平衡器：纤西＆＃39; S高性能，RobustLoad平衡实现被调整为庞大的本机环境的规模和流失。现在，您可以用纤西作为独立负载平衡器来更换昂贵的网络中的昂贵盒子。这解锁了DSR和Maglev的支持，用于处理北/南交通inon楼宇环境，而无需kubernetes管理网络订单。（更多细节）</p><p> PCAP Recorder provides network observability into theStandalone Load Balancer by enabling full or partial packet capture fortraffic matching specific n-tuple filters. ( More details)</p><p> 通过启用完整或部分数据包捕获Fortraffic匹配特定的N组滤波器，PCAP Recorder将网络可观察性提供给TheStandalone负载平衡器。 （ 更多细节）</p><p> Beyond the focus on integrating better with the broader network, we’ve investedin making it  easier to install and run Cilium regardless of environment,further  improved performance, and added a whole set of highly requestedfeatures:</p><p> 除了通过更广泛的网络集成更好的关注，我们投入了不管环境，进一步提高性能，并增加了一整套高度要求的纤西，更容易安装和运行纤西：</p><p> WireGuard® Support: One of the most hotly requested features, Cilium nowsupports encrypting traffic between pods in the cluster using the modernWireGuard protocol as an alternative to the existing IPsec implementation.( More details)</p><p> Wireguard®支持：最常见的功能之一，icilium现在使用现代行行协议作为现有IPSec实现的替代方案来加密群集中的POD之间的流量。（更多细节） </p><p> New Cluster Administration CLI: An experimental new Cilium command-lineinterface simplifies installation, troubleshooting and feature enablementby automatically detecting your environment constraints and configuringCilium with the best set of options.( More details)</p><p>新的群集管理CLI：一个实验新的纤毛命令-Line接口简化了安装，故障排除和功能启用，可以自动检测您的环境约束和配置最佳选项的配置。（更多细节）</p><p> Better performance than ever: Cilium now has the ability to skipNetfilter connection tracking where it is not needed, has improvedNorth/South service handling, and we&#39;ve doubled throughput performancethrough improved Linux tunneling. Check all this out together with the new tuning guide to help you get the most from your network!( More details)</p><p> 比以往更好的表现：CILIUM现在有能力SKIPNETFILTER连接跟踪，在不需要的地方，具有改善/南方服务处理，我们＆＃39; VE加倍的吞吐量性能改进了Linux隧道。将所有这些与新的调整指南一起检查，以帮助您从网络中获得最大限度！（更多细节）</p><p> Lots of other improvements: This release brings support for  KubernetesDual-Stack Services,  Native IPAM for Alibaba Cloud,and is the first release to distribute  official images for ARM64.New guides for Rancher and Rancher Kubernetes Engine make it easierto deploy Cilium in on-prem Kubernetes environments.</p><p> 许多其他改进：此版本为kubernetesdual-stack服务，阿里巴巴云的本机Ipam带来了支持，并且是第一个为Arm64分发官方图像的版本。用于牧场主和牧场主Kubernetes Engine的新导游使其成为在预境中部署的纤毛Kubernetes环境。</p><p>  Cilium is open source software for transparently providing and securing thenetwork and API connectivity between application services deployed using Linuxcontainer management platforms such as Kubernetes.</p><p>  CILIUM是开放的源软件，用于透明提供和确保使用LinuxContainer管理平台（如Kubernetes）部署的应用程序服务之间的API连接。</p><p> At the foundation of Cilium is a new Linux kernel technology called eBPF, whichenables the dynamic insertion of powerful security, visibility, and networkingcontrol logic within Linux itself. eBPF is utilized to provide functionalitysuch as multi-cluster routing, load balancing to replace kube-proxy,transparent encryption as well as network and service security. Besidesproviding traditional network-level security, the flexibility of eBPF enablessecurity with the context of application protocols and DNS requests/responses.Cilium is tightly integrated with Envoy and provides an extension frameworkbased on Go. Because eBPF runs inside the Linux kernel, all Ciliumfunctionality can be applied without any changes to the application code orcontainer configuration.</p><p> 在Cilium的基础上是一个名为EBPF的新的Linux内核技术，依赖于Linux本身内的强大安全性，可见性和NetworkingControl逻辑的动态插入。 EBPF用于提供函数为多簇路由，负载平衡以替换Kube-Proxy，透明加密以及网络和服务安全性。除了提供传统的网络级安全性，EBPF EnableSecurity的灵活性与应用程序协议和DNS请求/响应的内容都与Envoy紧密集成，并提供了Go的扩展框架。由于EBPF在Linux内核内运行，因此可以应用所有Cileium功能，而无需对应用程序代码或通道配置的任何更改。</p><p>     As Kubernetes became the de facto standard platform to containerize andmodernize application workloads, a significant pain point became connectingthese new services to components in the legacy environments. Traditionalworkloads have a fixed and unique IP that can be recognized by a firewall.Traffic coming from a containerized application will come from many differentIPs as containers spin up and down as needed and will most often present as theIP of the node on which each container sits. This makes it hard to set upsecurity boundaries for applications and to audit their behavior.</p><p>     随着Kubernetes成为Containize AndModernize应用程序工作负载的事实上标准平台，它的显着痛点成为遗留环境中的组件的新服务。传统的Workenloads具有固定和唯一的IP，可以由防火墙识别。来自集装箱化应用的运输工具将来自许多overs，因为容器根据需要向上和向下旋转，并且最常用为每个容器坐在的节点上的掌点。这使得难以为应用程序设定upsecurity边界并审核其行为。</p><p> The 1.10 release brings the egress gateway capability to Cilium. Cilium nowallows users to specify an egress NAT policy, such that egress traffic for theselected pods will be masqueraded with a consistent, user-defined IP address.As the following diagram shows, instead of directly egressing via eth0, trafficfrom pods running in the worker node egress the cluster via the gateway node.At this node, SNAT is applied to provide the consistent external IP foroutbound traffic. From there, networking components can be configured to treattraffic differently depending on the source IP address. For instance, a legacyfirewall is able to filter traffic that originates from pods with particularlabels, by matching purely on the source IP address of the inbound traffic.</p><p> 1.10释放将出口网关能力带给纤毛。 Cilium Nowallows用户指定出EORTERNAT NAT策略，使得TheSelected Pods的出口流量将用一致的用户定义的IP地址伪装成一致的用户定义的IP地址。如下图所示，而不是通过eth0直接出口，而不是在工作节点中运行的POD通过Gateway节点出口群集。此节点，SNAT应用于提供一致的外部IP出发流量。从那里，网络组件可以配置为根据源IP地址的不同方式进行处理。例如，LegacyFireWALL能够通过纯粹在入站流量的源IP地址匹配，过滤源自具有特定标签的流量。 </p><p>  As an example, the following policy instructs Cilium to use egress IP 192.168.33.100 for traffic from all pods in  default namespace and destinedto the external CIDR  192.168.33.13/32. That egress traffic will be redirectedto the (gateway) node to which  192.168.33.100 was assigned. More informationabout the egress gateway can be found in the getting started guide.</p><p>作为示例，以下策略指示纤细用于使用默认命名空间中所有POD的流量EIL IP 192.168.33.100，并发出外部CIDR 192.168.33.13/32。将重定向到出口流量将被重定向到（网关）节点，为分配192.168.33.100的节点。更多信息可以在入门指南中找到出口网关。</p><p> apiVersion : cilium.io/v2alpha1 kind : CiliumEgressNATPolicy metadata :  name : egress -sample spec :  egress :  -  podSelector :  matchLabels :  # The following label selects default namespace  io.kubernetes.pod.namespace : default  destinationCIDRs :  - 192.168.33.13/32  egressSourceIP :  &#34;192.168.33.100&#34;</p><p> apierion：cilium.io/v2alpha1种类：ciliumegressnatpolicy元数据：名称：Egress -sample spec：出口： -  podselector：matchlabels：＃下面的标签选择默认命名空间io.kubernetes.pod.namespace：默认目的地cidrs： -  192.168.33.13/32 EIGRESSOURCEIP：＆＃34; 192.168.33.100＆＃34;</p><p>    As Kubernetes becomes more pervasive in on-premise environments, usersincreasingly have both traditional applications and Cloud Native applicationsin their environments. In order to connect them together and allow outsideaccess, a mechanism to integrate Kubernetes and the existing networkinfrastructure running BGP is needed.</p><p>    由于Kubernetes在内部内部环境中变得更加普遍，因此用户可以使用传统的应用程序和云本机应用程序。为了将它们连接在一起并允许OutsideAccess，需要一种集成Kubernetes和运行BGP的现有网络帧的机制。</p><p> The 1.10 release of Cilium brings integrated support for BGP, exposingKubernetes to the outside and all the while simplifying users&#39; deployments.The integration is done via  MetalLB, leveragingthe effective implementation of the service IP allocator and the L3 protocolsupport for BGP. With this, Cilium is now able to allocate service IPs forservices of type  LoadBalancer and announce them via BGP to their BGProuters. Now, services are able to be reached externally from traffic outsideof the cluster, without any additional components.</p><p> 1.10纤毛释放为BGP带来了一体化支持，将kubernetes曝光到外部，同时简化用户＆＃39;部署。集成通过MetallB完成，利用“服务IP分配器的有效实现”和“BGP的L3 ProtocalSupport”。有了这个，Cilium现在能够分配LoadBalancer类型的服务IPS服务，并通过BGP向其BGProuters宣布它们。现在，能够从集群外部的流量外部达到服务，而无需任何其他组件。</p><p>  In the future, we plan to support announcing Pod CIDRs and the  EgressIP Gateway via BGP as well. This will further improve thebridging between Cloud Native and traditional environments.</p><p>  未来，我们也计划通过BGP支持宣布POD CIDR和EIGRINGEIP网关。这将进一步改善云本机和传统环境之间的织布。</p><p> The following is an example  ConfigMap that&#39;s used to configure Cilium&#39;s BGPfeature. The two main aspects of the configuration are  peers and address-pools. The former is for connecting with the existing BGP routersin the network, so an IP address and an ASN are required. The latter is thepool from which Cilium will allocate an IP to a  LoadBalancer service. For abit of background, services of type  LoadBalancer in Kubernetes rely onanother component to fill the gap of allocating external IPs, which is whyCilium needs to be configured with that information.</p><p> 以下是＆＃39; s用于配置纤毛的示例configmap和＃39; s bgpfeature。配置的两个主要方面是对等体和地址池。前者用于与现有的BGP路由器连接网络，因此需要IP地址和ASN。后者是Cilium将IP分配给LoadBalancer服务的池。对于Bubber of Background，Kubernetes中的LoadBalancer类型的服务依靠OnAlother组件来填充分配外部IP的间隙，这是需要配置该信息的WhiConium。</p><p> apiVersion : v1 kind : ConfigMap metadata :  name : bgp -config  namespace : kube -system data :  config.yaml :  |  peers: - peer-address: 10.0.0.1 peer-asn: 64512 my-asn: 64512 address-pools: - name: default protocol: bgp addresses: - 192.0.2.0/24</p><p> apiersion：v1种：configmap元数据：名称：bgp -config命名空间：kube -system data：config.yaml：|同行： -  PEER-Address：10.0.0.1 PEER-ASN：64512 MY-ASN：64512地址池： - 名称：默认协议：BGP地址： -  192.0.2.0/24 </p><p>     Cilium has been progressively adding support for allocating IP addressesdirectly from cloud APIs, notably from  AWS ENI (v1.6) and  Azure (v1.8).This release adds an IPAM mode for Alibaba Cloud, allowing Cilium to utilizeAlibaba Cloud ENI (Elastic Network Interface) for Pod IPs.The architectureensures that only a single operator communicates with the Alibaba Cloud APIsto avoid rate-limiting issues in large clusters.</p><p>Cilium一直在逐步增加用于从云API分配IP地址的支持，特别是从AWS ENI（v1.6）和Azure（v1.8）。这一版本为阿里巴巴云添加了IPAM模式，允许纤毛到UtilizeAlibaba云ENI（弹性网络POD IPS的接口）。只有单个操作员与阿里巴巴云APISTO通信的架构，避免了大集群中的速率限制问题。</p><p>  In this mode, pods are assigned with ENI IPs, which are directly routable in theAlibabaCloud VPC. This simplifies communication of pod traffic within VPCs andavoids the need for SNAT. With the cloud-native network solution, user caneasily use cloud resource like Cloud Enterprise Network (CEN) or VPN gateway toconnect to your on-premises data centers.</p><p>  在此模式下，PODS与ENI IPS分配，可在Thealababacloud VPC中直接路由。这简化了VPCS中POD流量的通信anavoids对SNAT的需求。使用云本机网络解决方案，用户可以轻松地使用云企业网络（CEN）或VPN网关的云资源，或者将VPN网关连接到您的本地数据中心。</p><p>      With the 1.10 release, we are adding support for transparent encryption viathe  WireGuard protocol. Transparent encryptionis a feature which ensures that traffic between Cilium-managed pods is alwayssent through a secure tunnel, thereby allowing users to run Kubernetes inuntrusted networks.</p><p>      通过1.10版本，我们正在通过Wiguard协议增加对透明加密的支持。透明加密可以通过安全的隧道始终透明地，确保纤毛管理的POD之间的流量，从而允许用户运行Kubernetes inntrusted网络。</p><p> Cilium had support for transparent encryption via IPSec already since version1.4, but we were motivated to add WireGuard as an alternative option formultiple reasons. Firstly, WireGuard is a very opinionated protocol and doesnot allow the tuning of parameters such as the key size and cipher suite,which makes it very easy to use and simplifies deployment and operations.The encryption key pair for each node is automatically generated by Cilium andkey rotation is performed transparently by the WireGuard kernel module.</p><p> Cilium已支持自版本1.4以来，通过IPsec提供了透明加密，但我们被激励添加Wieguard作为替代选项的成分原因。首先，Wioguard是一个非常自以为派的协议，并且不允许调整键大小和密码套件的参数，这使得可以易于使用和简化部署和操作。每个节点的加密密钥对自动生成icilium andkey生成。旋转由Wioguard内核模块透明地执行。</p><p>  WireGuard also has performance advantages over IPSec for certain workloads. Inour recent  CNI performance analysis blog post,we evaluated both protocols and found that WireGuard can achieve very highthroughput for streaming workloads, but IPSec still can achieve better latency,and the encryption algorithm can be offloaded to the CPU in certain cases.The graph above shows a short excerpt from our experiments, make sureto read the full blog post for more details and explanations.</p><p>  WIREGUARD还具有在IPSec上具有特定工作负载的性能优势。 Inour最近的CNI性能分析博客文章，我们评估了两个协议，发现Wioguard可以实现流动工作负载的非常稳久化，但IPSec仍然可以实现更好的延迟，并且在某些情况下可以将加密算法卸载到CPU。上面的图表我们的实验中的简短摘录，让SureTo阅读完整博客帖子以获取更多细节和解释。</p><p> Another technical advantage of WireGuard is that it integrates well into thearchitecture of the Cilium datapath. Because the secure tunnel is exposed asa Linux network interface, WireGuard makes it very easy to mark packetsoriginating from containers for encryption and subsequently forward them tothe secure tunnel device. The animation below shows the life of a WireGuardencrypted packet in Cilium:</p><p> Wioguard的另一个技术优势在于它集成了纤毛数据库的划线部件。由于安全隧道暴露ASA Linux网络接口，因此WIREGUARD使得从容器中粗略地标记为加密，然后转发它们的安全隧道设备。下面的动画显示了Cilium中的Wireguardencrypted Packet的生活：</p><p>  WireGuard encryption in Cilium 1.10 is supported both in direct routing andtunneling mode, and may also be enabled in managed Kubernetes environments ifthe underlying Linux kernel supports it. Support for host-level encryptionand Cilium&#39;s L7 policy enforcement and visibility features is currently lackingand will be added in an upcoming Cilium releases.</p><p>  在直接路由和特隧道模式下，Cilium 1.10中的Wioguard加密支持，如果底层Linux内核支持它，也可以在托管的Kubernetes环境中启用。在即将举行的纤细发布中，目前缺少对主机级加密和纤细的纤细＆＃39; S L7策略执行和可见性功能。 </p><p> If you want to know more about the WireGuard integration in Cilium, make sureto watch to the recording of the   eCHO episode 3 livestreamand read our   getting started guidein the Cilium documentation.</p><p>如果您想了解更多关于Cilium中的Wioguard集成，请将SureTo Watch录制到回声集第3集Livestream和读取我们入门指南的录音。</p><p>    Cilium has IPv4/v6 dual-stack support since it was created. In fact, in Cilium&#39;s very early prototype, we started out with an IPv6-only implementation. GivenKubernetes was lacking official dual-stack integration for some time now, theCilium IPv6 support for Pods and Services was a bit cumbersome to operate.With the last Kubernetes stable version that was released this has changed now:Kubernetes 1.21 introduced  beta support for dual-stack enabled by default.With Cilium 1.10, we integrated the Kubernetes dual-stack support, so thatPods are now properly integrated to allow for dual-stack IP address allocationand, similarly, Service IPv4/v6 addressing propagates down into the CiliumeBPF kube-proxy-replacement.</p><p>    Cilium具有IPv4 / V6双堆栈支持，因为它创建。事实上，在纤毛中，在非常早期的原型中，我们开始使用IPv6实现。鉴于kubernetes一段时间缺乏官方双堆栈集成，IPv6对豆荚和服务的支持有点繁琐。随着释放的最后一个Kubernetes稳定的版本，现在已经改变了：Kubernetes 1.21引入了双堆栈的测试版支持默认情况下启用.WithCilium 1.10，我们集成了Kubernetes双堆栈支持，因此现在可以正确地集成PiliumeBPF Kube-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy-Proxy替换时集成了kubernetes双堆栈支持，以便允许对双堆栈IP地址allocationand进行了正确集成。 。</p><p>  $  helm  install cilium cilium/cilium --version  1.10.0  \ --namespace kube-system \ --set ipv4.enabled=true \ --set ipv6.enabled=true  $  kubectl get cep -n kube-system NAME ENDPOINT ID IDENTITY ID ENDPOINT STATE IPV4 IPV6coredns-755cd654d4-msqgm 2205 11023 ready 10.16.115.242 fd02::71cf</p><p>  $ Helm Install Cilium cilium / cilium -version 1.10.0 \  -  innespace kube-system \ --set ipv4.enabled = true \ --set ipv6.enabled = true $ kubectl get cep-n kube-system name端点ID身份ID端点状态IPv4 IPv6coreDNS-755CD654D4-MSQGM 2205 11023 Ready 10.16.115.242 FD02 :: 71CF</p><p>    In previous releases, the Cilium core team have made snapshots available onARM64 platform for initial testing. However, until now the official images forCilium have not yet been prepared for this platform. During this developmentcycle, we worked on several improvements to the image build infrastructure forthe project to allow automatic build of multi-arch docker images for bothlinux/amd64 and linux/arm64 platforms. Beginning with Cilium 1.10, the officialCilium repositories on Docker Hub and Quay.io will host these multi-archimages.</p><p>    在以前的版本中，Cilium Core团队已经为初始测试提供了Snapshots Onarm64平台。但是，直到现在现在尚未为这个平台做好准备官方形象。在此开发循环期间，我们在若干工程中对图像构建基础设施进行了几种改进，允许自动构建用于双林/ amd64和Linux / ARM64平台的多拱形Docker图像。从Cilium 1.10开始，Docker Hub和Quay.IO上的Nexterncilium存储库将托管这些多拱像阀。</p><p> Installing Cilium on ARM64 works similarly to the setup on other platforms,using the same image tags and digests as the AMD64 docker images. This unlocks theability to run Cilium on a range of new hardware including AWS Gravitoninstances and Azure Linux/ARM64 pipelines. Cilium has even been spotted in thewild, running on a smartphone!</p><p> 在ARM64上安装CILIUM与其他平台上的设置类似，使用相同的图像标签和摘要作为AMD64 Docker图像。这使得在包括AWS Gravitonistances和Azure Linux / ARM64管道的一系列新硬件上运行纤毛的戏剧性。纤毛甚至在威尔赛中发现了智能手机！</p><p> Armbian trunk on a Snapdragon 835 (OnePlus 5) running k8s and Cilium eBPF  @armbian  @ciliumproject  @kubernetesio 🎉  pic.twitter.com/QXMCiox12X</p><p> 在Snapdragon 835（oneplus 5）上运行K8s和Cilium EBPF @Ambian @ciliumproject @kubernetesio🎉pic.twitter.com/qxmciox12x</p><p>— Ricardo Pardini (@SilvioSantoZ)  May 12, 2021</p><p> -  Ricardo Pardini（@Silviosantoz）2021年5月12日 </p><p>     A new  CLI is available that can be usedto install and manage Cilium clusters. The CLI talks directly to the KubernetesAPI and offers a variety of functionality to manage different aspects ofCilium. The CLI is backward compatible to older versions of Cilium.</p><p>可以使用新的CLI，可用于安装和管理纤细集群。 CLI直接与Kubernetesapi进行谈话，提供各种功能来管理yscilium的不同方面。 CLI向后兼容旧版本的纤毛。</p><p>   The  cilium status command allows to quickly determine the status of anyCilium installation. It will indicate the number of unhealthy Cilium componentsand quickly expose failure states in any of the nodes:</p><p>   Cilium Status命令允许快速确定AnyCillium安装的状态。它将指示不健康的纤毛组件数量，并在任何节点中快速公开失败状态：</p><p> $ cilium status /¯¯\ /¯¯\__/¯¯\ Cilium: OK \__/¯¯\__/ Operator: OK /¯¯\__/¯¯\ Hubble: disabled \__/¯¯\__/ ClusterMesh: disabled \__/Deployment cilium-operator Desired: 2, Ready: 2/2, Available: 2/2DaemonSet cilium Desired: 2, Ready: 2/2, Available: 2/2Containers: cilium Running: 2 cilium-operator Running: 2Image versions cilium quay.io/cilium/cilium:v1.10.0: 2 cilium-operator quay.io/cilium/operator-generic:v1.10.0: 2</p><p> $ cilium status / milium：__ \ cilium：好的\ __ /¯\ __ /运算符：OK / \ \ __ /¯¯\：禁用\ __ /¯\ __ / ClusterMesh：禁用\ __ /部署纤西运算符所需：2，准备：2/2，可用：2 / 2daemonset Cilium所需：2，准备：2/2，可用：2/2 Containers：Cilium运行：2厘米运行：2Image版本番荔枝Quay.io/cilium/cilium :v1.10.0：2 icilium-operator quay.io/cilium/operator-generic :v1.10.0：2</p><p>  A new connectivity test can be run with a single command ( cilium connectivitytest). It ensures correctness in networking, Kubernetes services andNetworkPolicy enforcement and is ideal to validate whether Cilium has beencorrectly installed.</p><p>  可以使用单个命令（Cilium ConnectiveTtest）运行新的连接测试。它确保网络中的正确性，Kubernetes Services和Networkpolicy强制，非常适于验证CILIUM是否已安装。</p><p> $ cilium connectivity test✨ [gke_cilium-dev_us-west2-a_test-21504] Creating namespace for connectivity check...✨ [gke_cilium-dev_us-west2-a_test-21504] Deploying echo-same-node service...[...]---------------------------------------------------------------------------------------------------------------------🔌 [pod-to-pod] Testing cilium-test/client-68c6675687-tcw9f -&gt; cilium-test/echo-other-node-588bf78fbb-84fvc...---------------------------------------------------------------------------------------------------------------------✅ [pod-to-pod] cilium-test/client-68c6675687-tcw9f (10.96.6.173) -&gt; cilium-test/echo-other-node-588bf78fbb-84fvc (10.96.5.226)[...]---------------------------------------------------------------------------------------------------------------------📋 Test Report---------------------------------------------------------------------------------------------------------------------✅ 9/9 tests successful (0 warnings)</p><p> $ cilium连接测试¶[gke_cilium-dev_us-west2-a_test-21504]创建连接的命名空间，用于连接检查......✨[gke_cilium-dev_us-west2-a_test-21504]部署回声相同节点服务... [... ... ] --------------------------------------------- ---------------------------------------------------------------- ----------------🔌[Pod-to-pod]测试纤毛测试/ client-68c6675687-tcw9f  - ＆gt;纤毛 - 测试/回声 - 其他 - 节点-588bf78fbb-84fvc ... ---------------------------------------------------------------- ---------------------------------------------------------------- ------------------------------ [Pod-to-pod]纤毛 - 测试/客户端-68C6675687-TCW9F （10.96.6.173） - ＆gt;纤毛 - 测试/回声 - 其他 - 节点-588bf78fbb-84fvc（10.96.5.226）[...] ------------------------- ---------------------------------------------------------------- ---------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------✅9/9测试成功（0警告）</p><p>    Following up work from previous releases,we continued to rigorously evaluate Cilium&#39;s networking performance. Our latestfindings were recently summarized in a blog post as well as integratedinto Cilium&#39;s  documentation,where we provided numbers for different types of direct routing workloads, showedhow eBPF enables for low-latency as well as high CNI throughput performance, andcompared WireGuard to IPsec.</p><p>    从以前的版本开始工作，我们继续严格评估纤钙＆＃39; S网络性能。我们的最新功能最近被概述在一个博客帖子以及indodationInto cilium＆＃39; s文档中，我们为不同类型的直接路由工作负载提供了数字，显示了eBPF，用于低延迟以及高CNI吞吐量性能，并与之计算的Wineoguard IPsec。</p><p> Guided by our in-depth performance evaluation, Cilium 1.10 includes a number ofdatapath improvements, this time mainly focussed on the VXLAN/Geneve tunnelingperformance as well as reduction of Netfilter overhead. Most notably:</p><p> 通过我们深入的绩效评估，Cilium 1.10包括一个数量的atdatapath改进，这次主要集中在Vxlan / Geneve TunneDingperforcance以及NetFilter开销的减少。最为显着地： </p><p> BPF host routingwas extended to support encapsulation. This means that maximizing performanceusing eBPF can now be achieved in both direct routing and tunneling modes. Inparticular, this improves the north-south service handling to be on par withthe direct routing mode since network traffic does not need to be processed bythe upper host stack anymore.</p><p>BPF主机Routingwas扩展到支持封装。这意味着现在可以在直接路由和隧道模式中实现最大化性能EBPF。不纯，这改善了南北服务处理与直接路由模式相接的北方服务处理，因为网络流量不需要通过上主堆不再处理。</p><p> We identified and fixeda performance issue in the Linux kernel, where the GRO aggregation of encapsulatedUDP packets for VXLAN and Geneve was delayed, leading to suboptimal performancewhen using encapsulation with Cilium. The fix has been backported to all stablekernels (e.g., 4.9)as well as integrated into downstream distributions such as Ubuntu LTS variants.In our test environment, this more than doubled the Gbit/s TCP single-streamthroughput rate for traffic subject to VXLAN and Geneve encapsulation.</p><p> 我们在Linux内核中识别和固定的性能问题，其中vxlan和geneve的CencapsulateDP数据包的Gro聚合被延迟，导致使用纤毛封装的封装性能。该修复程序已被返回到所有稳定性库（例如，4.9）以及集成到下游分布中，如Ubuntu LTS变体。在我们的测试环境中，这增加了Gbit / S TCP单流程率，对VXLAN的流量增加了一倍以上的流量Geneve封装。</p><p> Finally, Cilium can now be configured to skip Netfilter conntrack: we introduced a newagent option,  --install-no-conntrack-iptables-rules, which allows to skipNetfilter connection tracking whenever possible. You can read more in the tuning guide.</p><p> 最后，Cilium现在可以配置为跳过NetFilter Conntrack：我们推出了一种新的选项 - “禁止Conntrack-Iptables-Truel”，它允许在尽可能跳过XTIPNETFilter连接跟踪。您可以在调优指南中阅读更多。</p><p> We will follow-up and publish in-depth results of our performance evaluation for thetunneling setups in an upcoming blog post. Preliminary results from our  test environment yield significant improvements as shown below for the threementioned areas.</p><p> 我们将在即将介绍的博客文章中进行跟进并发布我们的绩效评估的绩效评估结果。我们的测试环境的初步结果产生了显着的改进，如下所示的延迟区域。</p><p>  For the regular Pod to Pod case where traffic needs to traverse through theVXLAN/Geneve tunnel we were able to significantly improve the bulk performancefor large data transfers, typically benchmarked through netperf TCP_STREAM tests.We added a small improvement to the Linux kernel&#39;s GRO engine which is responsibleto optimize the Linux&#39; stack traversal by aggregating MTU-sized packets up to64k super-packets in order to reduce the per-packet processing cost for thestack. We found that the aggregation would happen only inside the VXLAN/Genevedriver&#39;s GRO cell instead of the physical device right upon receive, meaning,packets had to traverse individually through the UDP stack to only be aggregatedthere. Moving the aggregation to the physical device significantly boosted the performance.</p><p>  对于常规POD到Pod的情况，其中流量需要通过VXLAN / Geneve隧道遍历，我们能够显着提高大量数据传输的批量性能，通常通过Netperf TCP_Stream Tests进行基准测试。我们为Linux内核添加了一个小的改进。 GRO Engine，它是Orkingibleto优化Linux＆＃39;通过聚合MTU大小的数据包来跨越高达64K超级数据包的堆栈遍历，以减少历史的每包处理成本。我们发现聚合将仅发生在VXLAN / Genevedriver＆＃39; S Gro小区而不是接收时的物理设备，意思，必须通过UDP堆栈单独遍历以汇总。将聚合移动到物理设备显着提高了性能。</p><p>    For the case where an external client is connecting to a Pod on a Cilium-managednode, for example, through a NodePort service, then the same improvements can beapplied  as done earlierfor the direct routing case. Meaning, forwarding can be performed right in thetc eBPF layer instead of having to push packets up the host stack. This resultsin significant gains in single stream throughput (TCP_STREAM) as well as significantreductions in latency for request/response-type workloads (TCP_RR and TCP_CRR).The gains in such scenarios are less visible when packets have to traverse thetunnel (e.g. for plain Pod to Pod case) since this mandates going through the upperUDP stack, but this is not the case for services where, for example, the backendsare local on the node. A typical use case is NodePort under  externalTrafficPolicy=Local.</p><p>    对于外部客户端在纤毛管理编码上连接到POD的情况下，例如，通过NodePort服务，那么与直接路由案之前的那样可以使用相同的改进。含义，转发可以在Thetc EBPF层中执行，而不是必须将数据包推送到主堆栈。该结果在单流吞吐量（TCP_STREAM）中的显着提升以及请求/响应类型工作负载（TCP_RR和TCP_CRR）的延迟中的显着延迟。当数据包必须遍历THETUNNEL时，这种情况的增益不太可见（例如，用于普通豆荚POD CASE）由于此任务通过uppeudp堆栈，但是，对于节点上的后退本地的服务，这不是服务。典型用例是NoderTrafficpolicy = Local下的NodePort。</p><p>    For the last case we investigated the direct routing performance when users dohave the constraint of having to pass through the Netfilter subsystem in the hoststack, be it due to running an older kernel or simply due to having Cilium deployedwith custom Netfilter rules. In particular the Netfilter connection tracker canadd a significant cost to the fast-path and might not be needed in all deploymentsituations, especially since we added eBPF-based masquerading that can be used asan alternative already. This traversal cost can then be minimized by disabling theconnection tracking requirement for all Pod traffic, thus bypassing the Net</p><p>    对于最后一个情况，我们调查了直接路由性能，当用户有必要通过Hoststack中的NetFilter子系统时，它是由于运行旧的内核，或者只是由于具有自定义NetFilter规则的Cilium。特别是NetFilter连接跟踪器CANADD在所有部署中可能不需要在快速路径中，特别是因为我们添加了基于EBPF的伪装，因此可以使用ASAN替代品。然后可以通过禁用所有POD流量的连接跟踪要求来最小化这种遍历成本，从而绕过网络 </p><p>......</p><p>...... </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://cilium.io/blog/2021/05/20/cilium-110">https://cilium.io/blog/2021/05/20/cilium-110</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/增加/">#增加</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/adds/">#adds</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/cilium/">#cilium</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>