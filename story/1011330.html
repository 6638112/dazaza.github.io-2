<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>关于一种新型Perl/CORE系统的思考</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">关于一种新型Perl/CORE系统的思考</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-12 19:29:19</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/6d89de2aa490a09245f81fb213c28a89.jpeg"><img src="http://img.diglog.com/img/2020/7/6d89de2aa490a09245f81fb213c28a89.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>COR需要一个类型系统。但是，这可能会出现在v2中，因为事实证明a)很难，b)我们需要类型用于：</p><p>变量声明没有太多的讨论，而Dave Mitchell在签名类型方面的工作早于Cor在声明类型方面的尝试，所以它是不兼容的。我已经在Perl git repo上打开了一张关于类型的门票。我们绝对不能有一个COR的类型系统，因为它没有集成到语言的其余部分中。</p><p>不幸的是，因为数据是类型化的，所以我们倾向于将类型系统和数据类型混为一谈。人们通常认为声明Int或Str就是类型系统。这不是真的。出于本次讨论的目的，我将借用本杰明·C·皮尔斯的定义，他的优秀著作《类型和编程语言》(Types and Programming Languages：</p><p>类型系统是一种易于处理的语法方法，通过根据短语计算的值的种类对短语进行分类，来证明某些程序行为是不存在的。</p><p>类型系统的设计目标应该是确保软件不会表现出某些不需要的行为。</p><p>因此，如果我们声明一个变量必须包含DateTime对象的一个实例，那么将字符串&#34；foo&#34；赋给它应该会抛出异常。它应该在编译时还是在运行时这样做是一个有很大争议的主题，我将在很大程度上跳过这一点，除了提到-对于Perl-编译时检查应该是首选的，因为这样做不会让我们的编程工作变得更加困难。我也喜欢渐进式打字，所以我们可以通过快速编码来解决眼前的问题，但我们也可以根据需要对大型系统采取更严格的限制。</p><p>这就是说，让我们考虑一下污点检查。污点检查的作用比大多数开发人员意识到的要多，但最常见的行为是不使用程序外部的数据来影响程序内部的东西，除非您清除了外部数据(显然，这是一种粗略的过度简化)。否则，你会失败的。这在运行时发生：</p><p>$1Perl-te&#39；My$arg=Shift；说&#34；1.$arg&#34；system($arg)；说&#34；2；$arg&#34；&#39；foo1。foo在-e行1上使用-T开关运行时，$ENV{PATH}不安全。</p><p>因此，污点检查是一种类型系统，因为可以避免某些不需要的行为。</p><p>启用限制(使用严格)就是启用另一个类型系统，其中包括以某种方式强制预声明非包变量。此故障在编译时发生：</p><p>$1Perl-Mstrict-E&39；my@foo=(1，2)；say&#34；Hello&#34；；say%foo&#39；全局符号&#34；%foo&#34；需要明确的包名称(您是否忘记声明&#34；my%foo&#34；？)。at-e行1.由于编译错误，-e的执行被中止。</p><p>因此，Perl开发人员对编译类型失败相当满意，即使他们并不总是认识到&#34；类型的含义比通常认为的更重要。</p><p>因此，对于Cor(以及一般的Perl)来说，值得问问自己，我们未来需要什么样的类型系统。</p><p>这些内容摘自前面提到的“类型和编程语言”一书的介绍。我将使用COR类型语法作为示例。</p><p>类点：def__init__(self，x，y)：self。x=x自身。y=y定义反转(自)：返回点(自。Y，赛尔夫。x)点=点(7，3.2)。Inverse()打印(点。x)点。x=#34；foo&34；打印(点。x)。</p><p>这将打印3.2&34；和#34；Foo&34；。在Python中，考虑使用非Python语言来验证数据。当面对一百万行的代码库时，你应该只知道你所有的类。这真是不太好。</p><p>包点{sub new{my($class，$x，$y)=@_；Return blefits{x=&&gt;；$x，y=&gt；$class；}sub x{my$self=Shift；if(@_){$self-&&&gt;；{x}=Shift；}return$self-&&gt;；{x}；}sub y{my$self=Shift；if(@_){$self-&&gt；{x}；}sub y{my$self=Shift；if(@_){$self-&&gt；if(@_){$self-&&&gt;t；{y}=Shift；}返回$Self-&gt;；{y}；}小逆{My$Self=Shift；Return Point-&&gt;；new($Self-&gt;y，$Self-&&gt;x)；}}。</p><p>幸运的是，开发人员已经厌倦了相关的错误，因为代码应该尽可能地保护程序员。在COR，情况大概是这样的：</p><p>类点{Has($x，$y)：Reader：Writer：New：ISA(Num)；方法invert(){return Point-&gt；new(x=&gt；$y，y=&gt；$x)；}}。</p><p>如果您试图将字符串&#34；foo&#34；赋给x或y，您会得到一个异常。</p><p>这里的安全设施应该是什么？你应该得到-3.5吗？这就是标准Perl会做的事情，因为它尽量不丢弃信息。对于某些语言，这将返回-3或-4，两者都是错误的。对于Perl中的类型系统，我建议我们在那里得到一个异常(或至少一个警告)。我不希望浮点数自动转换为整数，也不希望更改类型。</p><p>我们要强迫它变成一个整数吗？不幸的是，是的，因为上下文的原因。但是，如果我们谈论的是函数的返回值，那就更复杂了：</p><p>子列表{return(2，4，6)；}子数组{my@array=(2，4，6)；return@array；}my$list=list()；my$array=array()；说$list；说$array；</p><p>Say$List打印6，Say$array打印3，这是由于上下文与列表和数组(它们是列表的容器，尽管这个容器有一个糟糕的习惯，即递给您一个裸列表然后逃跑)的奇怪组合造成的。</p><p>如何在不破坏上下文的情况下设计类型安全系统呢？</p><p>在一种没有明确为人设计的语言上改造类型系统充满了陷阱。</p><p>在上面，我们可以阅读我们的代码，并对我们需要的数据类型有一个合理的想法。与POD或其他形式的文档不同，此文档不能与程序不同步，因为它是程序。此外，像javadoc这样的工具仅通过阅读这些信息就可以生成大量各种格式的真正有用的文档。如果Perldoc的未来版本可以利用这一点，那就太好了。</p><p>类型系统通常可以保证编程中的各种安全性。Perl&39；s&34；污点模式就是这样一种类型的系统。但是，数组边界检查是另一种方法。例如，C语言要求您自己检查数组边界。其他语言可以在编译时(比听起来更难)或运行时抛出越界异常，而Perl只是动态调整数组大小以避免溢出错误。</p><p>不过，还有其他类型的安全可以实现。设想一个Secret[]修饰符(此示例不是认真建议的)：</p><p>现在，在打印$PASSWORD的任何地方，结果字符串都将是hunter2。堆栈追踪？他们会看到猎人2。是否在命令行打印？猎人2？在字符串中插入？猎人2.。</p><p>在COR中，如果将类声明为Secret，则可能会有效地添加如下所示的方法：</p><p>任何在子类或角色中覆盖它的尝试都将是致命的。</p><p>也许我们可以更进一步，防止该数据被写入交换？是否在变量超出作用域时自动清除该内存？使用一个像样的类型系统，您可以做各种安全的事情。</p><p>但是如何以安全的方式获取原始信息呢？假设您需要加盐，在上面运行河豚，然后将结果保存到数据库中。如果您将Secret[]设置得太安全，它将无法使用。但是如果你把它弄得太好用，它就不安全了。了解了我可以在Perl中使用名称空间的有趣把戏，我怀疑大多数保护数据的天真方案都会失败。尽管如此，这正是一个像样的类型系统可以改进的那种安全性(尽管不能保证)。</p><p>这可能需要更多时间，但这是一个明确的奋斗目标。如果我将一个类型声明为整数，那么Perl将不再需要将大量内部内容存储在标量中。或者至少，它将始终从IV插槽返回有效值，并且永远不会检查标量中的另一个插槽。然而，我预计第一个实现实际上会减慢Perl的速度，因为嘿，您必须检查类型！提供一些在详尽测试后关闭类型检查然后交付生产的方法将不是一个好主意，但是有人会提议这样做。</p><p>在最初的C版本中(甚至在它发布之前)，唯一的类型是整数、字符、整数数组、字符以及指向它们的指针。类型并不是为了帮助人类，而是为了帮助计算机。然而，随着面向对象系统的出现，您可以将某些东西声明为类的实例。因此，类型系统变得更人性化了，因为类型符合程序员的需求，而不仅仅是计算机的需求，尽管我们有这样的东西：</p><p>COR也应该是对人类友好的，尽管对我来说，实现这一点的最佳方式还不清楚。我们可以实现某种形式的泛型：</p><p>这将把它得到的类型赋给$your_Bike，但是我不清楚去掉类型注释会给我们带来什么好处。</p><p>但我预计很多Perl开发人员会对此感到不满，我就是其中之一。我已经非常努力地限制在语言中添加新的语法。欢迎就如何在不创建过于冗长的语言的情况下改进打字提出建议。</p><p>然而，我们有很多案例是我们的类型几乎足够好，但不完全是。如果我想要一个整数，但它必须大于给定的数字，该怎么办？那就是我们从Raku偷东西的地方：</p><p>再一次，我们得到了一个更具表现力的字体系统，它适合人类的需要，而不是计算机的需要。当然，我们可以实现一个MinimumAge类，但在许多情况下这都是矫枉过正的。</p><p>我们想在COR上使用泛型吗？乍一看，我们可以简单地省略类型。我已经看过各种示例，只要我们传递给某个对象的数据是类型化的，省略类型注释就足够了。然而，我希望看到反例。</p><p>是的，我们需要考虑类型层次结构。我认为慕斯的那个是合理的，但这不是我的专业领域。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/Ovid/Cor/wiki/Type-System">https://github.com/Ovid/Cor/wiki/Type-System</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/core/">#core</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/type/">#type</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/类型/">#类型</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1010914.html"><img src="http://img.diglog.com/img/2020/7/thumb_6eb200bd42572434340e0de79af46352.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010914.html">.NET核心：仍然是微软平台的问题</a></div><span class="my_story_list_date">2020-7-10 8:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007740.html"><img src="http://img.diglog.com/img/2020/6/thumb_16ddecdc7af2335a4b58e79b0e180301.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007740.html">虚幻引擎4.NET核心集成</a></div><span class="my_story_list_date">2020-6-23 8:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003053.html"><img src="http://img.diglog.com/img/2020/5/thumb_bb62733f0b13755e234ca179d75a96af.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003053.html">英特尔第10代酷睿Comet Lake-S处理器首次亮相：14纳米的最后一次呼拉</a></div><span class="my_story_list_date">2020-5-21 8:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/technology_internet_104506.html"><img src="http://img.diglog.com/img/2008/11/thumb_285ac50021bd41949132d206232eddd7.gif" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/technology_internet_104506.html">[图]Falcon Northwest公司展示史上最强PC</a></div><span class="my_story_list_date">2008-11-18 22:57</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>