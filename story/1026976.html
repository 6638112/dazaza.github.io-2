<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>桌面上的OpenBSD(第一部分)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">桌面上的OpenBSD(第一部分)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-29 14:50:00</div><div class="page_narrow text-break page_content"><p>让我们在联想ThinkPad X270上安装OpenBSD。我用这台电脑学习计算机科学。它同时安装了Arch Linux和Windows10作为双引导。现在我不再需要运行Windows，我可以抛弃DualBoot，安装我选择的操作系统。</p><p>首先，我拿起运行Arch Linux的Thinkpad和一些足以支持AMD64迷你内存(大约5兆字节)的USB加密狗。此小映像不包括文件集，这些文件集将在安装过程中下载。我还从瑞士镜像下载了SHA256校验和，并验证了下载的映像，然后将其复制到我的加密狗上：</p><p>Thinkpad X270通过以太网连接到我的网络。WiFi固件通常需要单独安装，因此只有以太网可以开箱即用。BIOS已激活UEFI。OpenBSD和UEFI在较旧的硬件上有问题(至少在我2014年的戴尔笔记本电脑上是这样)，但不管怎样，还是让我们在这款笔记本电脑上试试吧。</p><p>我插上之前准备好的加密狗，然后启动电脑。我用Enter键中断了常规引导，并按F12键选择了另一种引导方法。现在，我选择了我的USB加密狗。大约一分钟后，安装程序已经启动。现在我遵循以下步骤：</p><p>作为主机名，我简单地选择了x270，因为它是Thinkpad X270，而我在命名东西时并不是很有创意。</p><p>从可用的网络选项(iwm0：WiFi、em0：以太网和vlan0：虚拟LAN)中，我选择em0。</p><p>我尝试通过DHCP获取IPv4地址，这似乎非常快。</p><p>默认情况下，我不启动SSHD，因为我不需要通过SSH连接到此计算机。它应该是工作站，而不是服务器。</p><p>X Window系统不应该由xnode m(1)启动，所以我将其设为no。</p><p>我用我的正名Patrick Bucher设置了我的用户Patrick，并设置了一个像样的密码。</p><p>时区已经被正确检测为欧洲/苏黎世，我只是让它保持原样。</p><p>安装程序检测到两个磁盘：sd0和sd1。由于sd0是在我的笔记本电脑中检测到的固态硬盘，因此我的戴尔笔记本电脑的UEFI问题在此计算机上不存在。我选择sd0作为根磁盘，因为sd1是我的USB加密狗。</p><p>我选择将整个磁盘与GPT分区模式一起使用，因为它是2020年。</p><p>提出了一种自动分配的SD0布局。它在我看来很不错，所以我就用那个自动布局。</p><p>由于Miniroot映像没有附带文件集，因此我选择http作为文件集的位置。</p><p>我不使用代理，而是按照建议使用镜像mirro.ungleich.ch和服务器目录pub/openbsd/6.7/amd64。</p><p>接下来，我通过输入-Game*取消选择游戏集。(我听说他们玩起来不太好玩。)。我让所有其他集合处于激活状态，包括稍后GUI所需的x集合。</p><p>安装完这些设置后，我按Enter键(完成)。现在安装程序执行各种任务，之后我选择暂停计算机。这让我有时间卸下USB加密狗。</p><p>我现在重新启动我的笔记本电脑，并启动OpenBSD。这比引导Arch Linux需要更多时间，后者使用systemd，而OpenBSD使用rc，后者按顺序执行启动任务。</p><p>有一条消息显示各种固件(英特尔固件、IWM固件、inteldrm固件、uvideo固件和VMM固件)已自动安装。确实很不错。</p><p>现在已经安装了IWM-Firmware，我可以立即连接到myWiFi网络frzbxpdb5。我创建了一个名为/etc/hostname.iwm0的文件，其中hostname是一个文字字符串，iwm0是WiFi网卡。与我的WiFi网络的连接只有一条线路：</p><p>而frzbxpdb5是我的WiFi网络的essid，[my-wpakey]需要用实际的WPA密钥替换。</p><p>此脚本非常友好，将/etc/hostname.iwm0的文件权限设置为640，然后连接到我的WiFi网络。</p><p>我在类Unix系统上的GUI基于动态窗口管理器(DWM)和许多其他工具，如dmenu、st、slstatus、slock，所有这些工具都是由Suckless社区创建和维护的。</p><p>此软件不附带配置工具，但需要在相应的C头文件config.h中进行配置，然后重新编译。尽管OpenBSD将DWM作为软件包提供，但自定义和配置窗口管理器需要从源代码构建它。</p><p>此操作失败，并显示错误消息(&#39；ft2build.h&#39；file not find)，提醒我大约一个月前在FreeBSD上构建DWM。因为我可以在另一个位置找到头文件：</p><p>Suckless的人们显然对OpenBSD很友好，这在其他地方也是可以理解的(更多证据将在下面进一步展示)。</p><p>默认情况下，如config.h所示，键盘组合[Alt]+[Shift]+[Enter](深深地刻在许多dwm用户的肌肉记忆中)启动st终端。这将在一段时间内建成。然而，我更喜欢使用Super或Windows键而不是Alt，因为前者在OpenBSD中没有用处，而后者在使用emacs readline模式时仍然很有用。因此，我将MODKEY从。</p><p>在这里，我们得到一个警告，函数保证(OpenBSD缓解，它内置于主分支中，但被ifdef预处理器语句包围，因此它将只为OpenBSD编译)被隐式导入。让我们暂时忽略这一警告。(##39；#*$$=。</p><p>如果您想编译用于OpenBSD的st，您必须从config.mk中删除-lrt，...。</p><p>在config.mk中完成此操作后，st编译时没有任何其他问题，因此可以重新构建和安装：</p><p>即使是使用Suckless工具的OpenBSD用户也必须偶尔打开另一个GUI应用程序，而不是终端仿真器。为此，Suckless提供了dmens。让我们切换到它并编译它：</p><p>同样，ft2build.h也有问题，可以像上面使用DWM一样解决这个问题：在config.mk中使用FREETYPEINC的正确路径。之后，构建成功，可以安装dMenu：</p><p>DWM的右上角有一个状态栏，可用于显示各种信息。我过去常常在.xinitrc中编写一些shell命令来组成这样的astatus行，然后通过xset-b每隔大约5秒设置一次。这种方法每隔几秒钟就会生成大量进程。</p><p>Slstatus是一个C程序，能够显示各种或多或少有用的信息。让我们切换到slstatus，看看config.def.h中有什么可用：</p><p>备注部分列出了不同的函数(batteryperc表示电池百分比，date time表示日期和时间信息，temp表示热错误信息，等等)。我通常会显示CPU负载、电池百分比、内存使用率、当前键盘布局以及当前日期和时间。</p><p>静态常量struct arg args[]={/*函数格式参数*/{datetime，&#34；%s&#34；，&#34；%F%T&#34；}，}；</p><p>我还希望包括工作日，但不包括秒，因此我定义了一个不同的参数字符串：</p><p>这样更好，所以让我们在config.h中使用它(在格式字符串中用一些空格括起来)：</p><p>静态常量struct arg args[]={/*函数格式参数*/{datetime，&#34；%s&#34；，&#34；%a%Y-%m-%d%H：%M&#34；}，}；</p><p>我喜欢的其他设置不需要任何参数，至少在OpenBSD上不需要，因此我只需要为这些设置定义一个合适的格式字符串(使用|作为换算符)：</p><p>静态常量struct arg args[]={/*函数格式参数*/{cpu_perc，&#34；CPU：%s%%|&#34；，null}，{cell_perc，&#34；，null}，{ram_use，&#34；；mem：%s|&#34；，null}，{keymap，&#34；%s|&#34；null}，{datetime，&#34；%s&#34；，&#34；%a%Y-%m-%d%H：%M&#34；}，}；</p><p>现在所有软件都已编译和安装，让运行X。为此，需要用户目录中的文件.xinitrc(/home/patrick/.xinitrc)：</p><p>这会将X的键盘映射设置为瑞士德语，在后台启动slstatus，然后执行dwm。</p><p>现在可以通过键入StartX来启动X。每次打字都有点麻烦，所以让我们定义一个指向它的符号链接：</p><p>如果一切配置正确，就会显示DWM，并且状态行显示整个系统仅使用大约60兆字节的RAM。那是微不足道的。用于打开st和d菜单的键盘组合也可以使用。</p><p>在OpenBSD上安装带有Suckless软件的基本GUI是相当流畅的体验。(对于FreeBSD，我特意选择了一种相当细粒度的方法来安装X包，这会带来一些额外的工作。)。但是，各种设置需要额外的调整。我还没有使用音频，这需要在DWM中相应地配置音量按钮。</p><p>我还需要设置sudo或DOA。当然，作为Linux的普通用户，我习惯于sudo，但DOA的简单性是尝试它作为替代方案的一个很好的理由。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://paedubucher.ch/articles/2020-09-05-openbsd-on-the-desktop-part-i.html">https://paedubucher.ch/articles/2020-09-05-openbsd-on-the-desktop-part-i.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/桌面上/">#桌面上</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/desktop/">#desktop</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>