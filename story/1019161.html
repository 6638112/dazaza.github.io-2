<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用JMAP实现Fastmail的“焦点和回复”</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">用JMAP实现Fastmail的“焦点和回复”</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-20 00:30:24</div><div class="page_narrow text-break page_content"><p>上个月我把我的电子邮件换成了Fastmail。Fastmail的一个有趣之处在于，他们构建了一种名为JMAP的新协议，使用起来比IMAP方便得多。因此，在过去的几天里，我为自己构建了一个有趣的迷你电子邮件功能，以便与JMAP一起使用。</p><p>这篇文章的重点主要是给出一个简单的端到端示例，说明如何使用JMAP API，因为我在弄清楚它的时候找不到很多示例。下面是GitHub存储库和一个要点，其中显示了如何进行身份验证&发出您的第一个请求。</p><p>当https://hey.com电子邮件服务问世时，我试了一下。这不是给我的，但我喜欢他们的“聚焦和回复”功能。以下是该功能的屏幕截图(来自该功能的营销网站页面上的一段视频)。</p><p>基本上，它使一批回复大量电子邮件变得稍微简单一些。所以我想-我可以使用JMAP来实现来自嘿的焦点和回复功能吗？</p><p>我有点太害怕了，不敢真正发送电子邮件开始(只读是安全的！)，所以我决定从做一个UI开始，它会显示我需要回复的所有电子邮件，并给我一个文本框来填写回复。然后我可以复制并粘贴回复到我的网络邮件客户端来发送它们。这有点不靠谱，但我现在不介意。</p><p>我在Fastmail中已经有一个名为“稍后回复”的文件夹，我在那里手动归档了我需要回复但还没有回复的电子邮件。所以我有了一个可以使用的数据源！万岁。开始编码的时间到了。</p><p>我找不到在Fastmail中使用JMAP的快速入门指南，我对如何使用感到困惑了很长一段时间，所以我在这篇博客中的目标是给出一个如何入门的例子。我将发出第一个API请求所需的所有代码放在一个要点中：fast mail-jmap-ickstart.js。</p><p>您可以使用您的用户名和Fastmail应用程序密码，使用HTTP基本身份验证来验证您的所有请求。</p><p>向https://jmap.fastmail.com/.well-known/jmap.发出GET请求。这会给你一个“会话”作为响应，给你你的帐户ID。其他所有API调用都需要这个帐户ID。我发现这有点令人惊讶，因为我通常认为.熟知的文件中的内容是静态文件，但这是一个使用HTTP基本身份验证进行身份验证的动态端点。(使用您的电子邮件/应用程序密码)。</p><p>一开始让我对JMAP产生反感的一件事是，您必须用。</p><p>例如，这是一个获取所有邮箱(文件夹)列表的请求。我认为&#34；0&#34；是请求的ID：</p><p>{&#34；使用&#34；：[&#34；urn：ietf：params：jmap：core&#34；，&#34；urn：ietf：params：jmap：mail&#34；]，&#34；method Calls&#34；：[[&#34；Mailbox/Get&#34；，{&#34；accountId&#34；：account&#34；IDS&#34；：null}，&#。</p><p>起初，API并不是那么直观，但通过阅读https://jmap.io.上的规范，我能够理解如何做我想做的事情。</p><p>下面是我用来从JMAP获取电子邮件的查询。我基本上只是从JMAP文档中的示例中复制了这个查询，但我认为很有趣的是，它不只是一个查询，它实际上是5个不同的链接查询，它们构建在彼此之上。例如，您拥有：</p><p>[&#34；email/query&#34；，{&#34；accountId&#34；：account tId，//todo：实际进行稍后回复&#34；filter&#34；：{&#34；inMailbox_id}，&#34；排序&#34；：[{&#34；property&#34；：&#34；ReceivedAt&#34；，&#34；isAscending&#34；：：true，&#34；position&#34；：0，&#34；Limit&#34；：20，&#34；culateTotal&#34；：true}，&#34；t0&#34；]，[&#34；email/get&#34；，{&#34；accountId&#34；：account tId，&#34；#id&#34；：{&#34；result of&#34；：&#34；t0&#34；，：&#34；Email/Query&#34；，&#34；路径&#34；：&#34；/IDS&#34；}，&#34；properties&#34；：[&#34；threadId&#34；]}，&#34；t1&#34；]，...。</p><p>它查询特定邮箱(我的“replylater”邮箱)中所有电子邮件ID的列表，将其命名为t0，然后使用t0的结果请求所有这些电子邮件。</p><p>JMAP中的一个重要想法似乎就是这种链接--如果您可以在单个请求中完成所有工作，那么它确实可以减少延迟。</p><p>一旦我有了所有的电子邮件，呈现它们就相当简单-我只需要使用vue.js+Tailwind。整件事总共有170行组织不是特别好的Javascript。</p><p>它起作用了!。它已经帮我回复了一些电子邮件。GitHub回购是https://github.com/jvns/focus-reply-fastmail.。</p><p>代码的主要问题是现在它将密码存储在本地存储中，我认为这不是一个好的安全实践。</p><p>我很好奇，所以我使用了Network选项卡来查看Fastmail的Web界面是如何使用jmap的。</p><p>FastMail的WebMail界面似乎没有使用https://jmap.fastmail.com/，而是使用了https://www.fastmail.com/jmap/api.。也许这只是他们使用的代理，这样请求就会发送到同一来源？不清楚。</p><p>它还以一种不同的方式进行身份验证，使用Authorization：Beager。这似乎是一种更好的身份验证方式，但我还没有找到任何有关如何使用这样的持有者身份验证而不是使用应用程序密码的信息。</p><p>由于某些原因，它发送的请求有时会被DEFLATE压缩(而不是gzip)，我想这是可以的，但这意味着不可能在dev工具中查看它们，因为Firefox不理解DEFLATE。怪怪的！</p><p>最初，我将纯文本电子邮件包含为HTML。这是一个XSS漏洞(有人可能在其纯文本邮件中包含恶意CSS)，有人非常有帮助地建议只将纯文本电子邮件包装在&lt；pre&gt；标记中以防止XSS。</p><p>我对&lt；pre&gt；标签设置了类似这样的样式，这样文本将自动换行，并且不使用等宽字体。</p><p>JMAP速成课程(我是在完成这项工作后才发现的，但看起来非常有用！)。</p><p>官方的Javascript库https://github.com/jmapio/jmap-js，，我没有使用它，但可能会让很多事情变得更容易。</p><p>我认为任何人都可以只用JMAP来做有趣的电子邮件UI实验，而不需要处理电子邮件的困难部分，这个想法真的很有趣！</p><p>而且这真的很酷，我可以让它100%作为一个前端应用程序工作，根本不需要任何服务器代码！所有的电子邮件数据都可以通过JMAP访问，因此似乎极有可能只使用客户端的JMAP请求来做所有事情。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://jvns.ca/blog/2020/08/18/implementing--focus-and-reply--for-fastmail/">https://jvns.ca/blog/2020/08/18/implementing--focus-and-reply--for-fastmail/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/实现/">#实现</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/focus/">#focus</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1016624.html"><img src="http://img.diglog.com/img/2020/8/thumb_a0048e3b612c078d653fcca2d9e0e5d8.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016624.html">OpenCore Bootloader-开源Apple UEFI驱动程序，支持hackintosh</a></div><span class="my_story_list_date">2020-8-6 20:11</span></div><div class="col-sm"><div><a target="_blank" href="/story/1016360.html"><img src="http://img.diglog.com/img/2020/8/thumb_94933eb99dd7288b948a53b234f49450.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016360.html">
总部位于雅加达的Wahyoo获得500万美元的首轮融资，帮助小餐馆实现运营数字化</a></div><span class="my_story_list_date">2020-8-5 16:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1011002.html"><img src="http://img.diglog.com/img/2020/7/thumb_143eec3cb544f984221045e2edf5792e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1011002.html">Cutlet：一个用Python实现的日语到罗马字的转换器</a></div><span class="my_story_list_date">2020-7-10 22:31</span></div><div class="col-sm"><div><a target="_blank" href="/story/1010498.html"><img src="http://img.diglog.com/img/2020/7/thumb_2ecda090a03d88776222de103106e59b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010498.html">在.NET Core 3.1中实现HTTPS</a></div><span class="my_story_list_date">2020-7-8 16:32</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>