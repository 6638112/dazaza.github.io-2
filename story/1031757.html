<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>黑客新闻如何粉碎大卫·沃尔什的博客</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">黑客新闻如何粉碎大卫·沃尔什的博客</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-28 21:23:10</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/654783c38e3737e1d47c20da8fe0412b.png"><img src="http://img2.diglog.com/img/2020/10/654783c38e3737e1d47c20da8fe0412b.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>本月早些时候，大卫关于离开Mozilla的发自内心的帖子登上了Hacker News的头版。他原本就很繁忙的网站流量增加了800%，网站在压力下放慢了速度，最终出现故障。Request Metrics为David的博客监控性能和正常运行时间，我们的指标讲述了一个有趣的故事。这里是发生了什么，为什么，以及你可以做些什么来准备你的网站，以应对流量激增。</p><p>大卫的网站使用WordPress。它提供来自MySQL数据库的大部分内容，这是众所周知的性能限制。为了缓解这一问题，David使用Cloudflare缓存站点内容并减少服务器的负载。</p><p>CloudFlare通过控制DNS并在调用您的服务器之前通过其边缘网络路由请求来实现这一点。如果可能，Cloudflare将返回缓存的内容，而不需要调用您的服务器，这在请求量大幅增加时特别有用。它甚至对大多数网站都是免费的，这是相当棒的。</p><p>上午7点40分左右(当地时间)，页面流量开始激增，系统从容不迫地进行了处理。页面加载的中位数在4-6秒是可以接受的。</p><p>到了早上7点50分，流量达到了技术的极限，每分钟大约有100次页面浏览量，用户体验很快就下降了。页面加载时间中值增长到30秒以上。由于无法满足这些请求，该网站在8点10分左右关闭，并保持了大约40分钟的离线状态。</p><p>如果你在这段时间内试图阅读他的帖子，你会有一次令人沮丧的经历。页面需要很长时间才能响应，如果您通过了，它会随着异步内容的加载和呈现而发生变化。我们可以将这些行为作为最大的内容油漆和累积布局偏移来衡量，它们都随着流量的增长而迅速下降。</p><p>很明显，这是很慢的。但是为什么呢？为什么它每分钟的浏览量不能超过100次呢？为什么云焰没有吸收流量？让我们更深入地挖掘这一页，看看发生了什么。</p><p>大卫的Mozilla帖子下面的性能报告显示了他登上HackerNews头版前后的48小时窗口。该页面不仅仅是HTML文档请求；它包括组成该页面的所有静态资产、JavaScript执行和动态请求。</p><p>在流量激增之前，页面的加载时间中值为4-6秒。这没问题，但是对于一个由Cloudflare提供的基本上是静态的站点，我会期望它快得多。</p><p>在中打开站点并在网络DevTools中检查文档请求为我们提供了线索。</p><p>服务器返回一个缓存控制标头，指出此内容不可缓存！CloudFlare遵守该指令，并将每个请求传递给服务器，如cf-cache-status：dynamic所示。</p><p>这样做的最终结果是，Cloudflare在其基础设施中引入了额外的跃点，但没有缓存任何内容，从而降低了站点的运行速度。</p><p>上面的页面性能报告还显示，每次加载页面时都会调用API端点/sidebar.php。此API的性能随流量峰值的下降情况类似，但在最好的情况下需要500ms才能做出响应。</p><p>在DevTools中检查此端点，它将返回我们所期望的HTML片段，即David博客的静态侧栏内容。并且它具有与主文档完全相同的缓存控制头问题。</p><p>通过将侧边栏呈现为异步不可缓存的请求，服务器被迫为每个阅读帖子的人提供至少2个涉及数据库的请求。这极大地限制了博客能够处理的请求数量。</p><p>您的网站与这个不同，但我们可以从这次绩效审计中吸取一些共同的想法。</p><p>该站点正在动态生成侧栏内容。它可能不需要是这样的。每个人的帖子都是相同的广告、流行标签和相关内容。</p><p>动态内容很慢。它很难缓存，而且通常必须异步获取。服务器只需做更多的工作来生成动态内容，而更多的工作总是较慢。</p><p>寻找动态内容，并确保与可以从缓存静态交付的内容相比，它的性能损失真的是值得的。</p><p>该站点设置为一度由Cloudflare缓存，但随着时间的推移，情况发生了变化。在WordPress插件或主机升级过程中的某个地方，缓存控制标头被更改，缓存被破坏。</p><p>软件系统是复杂和不断变化的。一定要时不时地测试一下，并确认每件事都在按其应有的方式工作。</p><p>简单地将Cloudflare添加到站点并不能解决性能问题，也不应该这样做。缓存和边缘网络令人惊叹，但您的站点需要进行配置才能正确使用它们。</p><p>性能不是你以后买的东西，也不是用来固定的。这是您在构建和运行系统时坚持的原则。像Request Metrics这样的性能监控工具可以帮助您集中精力并随着时间的推移提高性能。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://davidwalsh.name/request-metrics-performance">https://davidwalsh.name/request-metrics-performance</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/黑客/">#黑客</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/新闻/">#新闻</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/news/">#news</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/缓存/">#缓存</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1031744.html"><img src="http://img2.diglog.com/img/2020/10/thumb_4225bd753e3242a196b05da90d7ca447.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031744.html">
微软表示，伊朗黑客的目标是“高调”的会议与会者</a></div><span class="my_story_list_date">2020-10-28 20:0</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031688.html"><img src="http://img2.diglog.com/img/2020/10/thumb_995e6fa85a4267ea77fb3293d41aa953.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031688.html">特朗普竞选网站遭到加密货币诈骗者黑客攻击</a></div><span class="my_story_list_date">2020-10-28 10:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031683.html"><img src="http://img2.diglog.com/img/2020/10/thumb_d6fdb28d4933505f72e14032fc01a9ef.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031683.html">特朗普总统的竞选网站似乎成为黑客的受害者</a></div><span class="my_story_list_date">2020-10-28 10:5</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031664.html"><img src="http://img2.diglog.com/img/2020/10/thumb_995e6fa85a4267ea77fb3293d41aa953.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031664.html">
特朗普竞选网站被加密货币诈骗者黑客入侵</a></div><span class="my_story_list_date">2020-10-28 8:9</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>