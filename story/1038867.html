<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>IMAP API –自托管后台驻留程序，可通过HTTP API访问IMAP和SMTP帐户 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">IMAP API –自托管后台驻留程序，可通过HTTP API访问IMAP和SMTP帐户 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-10 21:24:35</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/2a8137eb3f00a19a1e4cc295c5baf08b.jpeg"><img src="http://img2.diglog.com/img/2020/12/2a8137eb3f00a19a1e4cc295c5baf08b.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>自托管应用程序，可通过REST访问IMAP和SMTP帐户。轻松将电子邮件帐户与您的服务集成！</p><p>  公开IMAP API已根据AGPL许可。邮政系统订户可以使用MIT许可的IMAP API的替代版本。您可以从邮政系统专用注册表中将其安装为@ postalsys / imapapi。</p><p>   同步用户将电子邮件发送到您的服务中，并代表您的用户发送电子邮件（帮助台软件等）</p><p> 电子邮件应用程序（不想处理IMAP和MIME的轻量级Webmail和移动应用程序等）</p><p>  确保您已安装最新的（至少v12.16.0）Node.js。直接从NPM运行IMAP API，而无需手动下载或安装任何东西：</p><p>      IMAP API允许通过基于REST的API轻松访问IMAP帐户。无需了解IMAP或MIME内部结构，您将获得＆＃34; normal＆＃34;具有分页消息列表的API。所有文本（即主题，电子邮件地址，文本和html内容等）均为utf-8。附件会自动解码为二进制表示形式。</p><p> 部分文字下载。您显然可以下载整个rfc822格式的原始消息，但是使用提供的分页和消息详细信息可能会更容易。这还允许为下载的文本内容指定最大大小。有时，自动化的Cron脚本等会发送包含10 + MB文本的电子邮件，以免下载IMAP API允许设置文本最大字体大小的东西。 </p><p>每当跟踪帐户发生任何事情时，IMAP API都会通过Webhook发布通知。这包括新消息，已删除消息和消息标志更改。</p><p>  轻松发送电子邮件。如果您指定要响应或转发的邮件，则IMAP API会设置所有必需的标头，更新IMAP中的引用邮件标志，并在发送后将邮件上传到“已发送邮件”文件夹中。</p><p> IMAP API是IMAP的较薄包装。这意味着它没有自己的存储。这也意味着，如果当前未打开IMAP连接，则由于API请求而导致网关错误。</p><p> IMAP API会针对每个注册的用户帐户保持一个持久的IMAP连接打开。要停止同步，您必须从IMAP API中删除该帐户。这与某些Webmail实现不同，在这些实现中，连接仅在用户会话期间保持打开状态。</p><p>                             如果可用，则IMAP API使用项目根目录中的dotenv文件填充环境变量。</p><p>   打开“设置”标签，并设置Webhooks的URL。每当任何跟踪的电子邮件帐户发生故障时，您都会收到此URL的通知。</p><p> 例如，如果标记已更新，则您将收到如下所示的通知： </p><p>{＆＃34; account＆＃34 ;:＆＃34; example＆＃34 ;,＆＃34; path＆＃34 ;:＆＃34; [Google Mail] / All Mail＆＃34 ;,＆＃34 ; event＆＃34 ;:＆＃34; messageUpdated＆＃34 ;、＆＃34; data＆＃34 ;: {＆＃34; id＆＃34 ;:＆＃34; AAAAAQAAAeE＆＃34 ;,＆＃ 34; uid＆＃34 ;: 350861，＆＃34; changes＆＃34 ;: {＆＃34; flags＆＃34 ;: {＆＃34; added＆＃34 ;: [＆＃34; \\ Seen＆＃34;]}}}}</p><p>  您需要IMAP和SMTP设置，还需要为此帐户提供某种类型的标识字符串值。您可以使用与主系统相同的ID，也可以生成一些唯一的ID。以后需要此值来标识此帐户并对其执行操作。</p><p> 注意！尝试创建具有相同ID的新帐户会更新现有帐户。</p><p> $ curl -XPOST＆＃34; localhost：3000 / v1 / account＆＃34; -H＆＃34;内容类型：application / json＆＃34; -d＆＃39; {account＆＃34 ;:＆＃34; example＆＃34 ;,＆＃34; name＆＃34 ;:＆＃34;我的示例帐户＆＃34 ;,＆＃34; imap＆ ＃34 ;： {＆＃34; host＆＃34 ;：＆＃34; imap.gmail.com＆＃34 ;、＆＃34; port＆＃34 ;： 993，＆＃34; secure＆＃34 ;：是，＆ ＃34; auth＆＃34 ;： {＆＃34; user＆＃34 ;：＆＃34; myuser@gmail.com&#34 ;、＆＃34; pass＆＃34 ;：＆＃34; verysecret＆＃34; }}，＆＃34; smtp＆＃34 ;: {＆＃34; host＆＃34 ;:＆＃34; smtp.gmail.com＆＃34 ;,＆＃34; port＆＃34 ;: 465，＆＃34;安全＆＃34 ;： true，＆＃34; auth＆＃34 ;： {＆＃34; user＆＃34 ;：＆＃34; myuser@gmail.com&#34 ;，＆＃34; pass＆＃34 ;：＆＃ 34; verysecret＆＃34; }}}＆＃39;</p><p>  现在，无论何时发生任何事情，您都会收到通知。如果这还不够，那么您也可以使用IMAP帐户执行正常操作。</p><p>  IMAP API返回分页结果，首先返回新消息。因此，要获取第一页或换句话说，获取邮箱文件夹中的最新消息，您可以像这样进行操作（请注意，我们在请求URL中先前设置的＆＃34; example＆＃34; id字符串）：</p><p>   {＆＃34; page＆＃34 ;: 0，＆＃34; pages ## 34 :: 10，＆＃34; messages＆＃34 ;: [{＆＃34; id＆＃34 ;:＆＃34 ; AAAAAQAAAeE＆＃34 ;,＆＃34; uid＆＃34 ;: 481，＆＃34; date＆＃34 ;:＆＃34; 2019-10-07T06：05：23.000Z＆＃34 ;,＆＃ 34; size＆＃34 ;: 4334，＆＃34; subject＆＃34 ;:＆＃34; Test message＆＃34 ;,＆＃34; from＆＃34 ;: {＆＃34; name＆＃34 ;：＆＃34; PeterPõder＆＃34 ;，＆＃34;地址＆＃34 ;：＆＃34; Peter.Poder@example.com＆＃34; }，＆＃34; to＆＃34 ;: [{＆＃34; name＆＃34 ;:＆＃34; ＆＃34 ;、地址＆＃34 ;：＆＃34; andris@imapapi.com＆＃34; }]，＆＃34; messageId＆＃34 ;:＆＃34;＆lt; 0ebdd7b084794911b03986c827128f1b@example.com&gt; ＆＃34 ;,＆＃34 ;: {＆＃34; id＆＃34 ;:＆＃34; AAAAAQAAAeGTkaExkaEykA＆＃34 ;,＆＃34; encodedSize＆＃34 ;: {＆＃34 ; plain＆＃34 ;: 17，＆＃34; html＆＃34 ;: 2135}}}]} </p><p>提取下一页时，将页面查询参数添加到URL。页面是零索引，因此如果服务器显示总共有10个页面，则意味着您可以从page = 0到page = 9进行查询。如果需要更长的页面，请使用pageSize查询参数。</p><p>   以下是如何发送回复的示例。在这种情况下，您应该指定要回复的参考消息（注意！此消息必须存在）。使用＆＃34; id＆＃34;从邮件列表中作为＆＃34; reference.message＆＃34;值。</p><p> 如果未从IMAP帐户中找到引用的消息，则API会以404错误进行响应，并且不会发出答复。</p><p> curl -XPOST＆＃34; localhost：3000 / v1 / account / example / submit＆＃34; -H＆＃34;内容类型：application / json＆＃34; -d＆＃39; {＆＃34 ;： {＆＃34; message＆＃34 ;:＆＃34; AAAAAQAAAeE＆＃34 ;，＆＃34; action＆＃34 ;:＆＃34; reply＆＃ 34; }，＆＃34; from＆＃34 ;: {＆＃34; name＆＃34 ;:＆＃34; Example Sender＆＃34 ;,＆＃34; address＆＃34 ;:＆＃34; sender@example.com&# 34; }，＆＃34; to＆＃34 ;: [{＆＃34; name＆＃34 ;:＆＃34; Andris Reinman＆＃34 ;,＆＃34; address＆＃34 ;:＆＃34; andris@imapapi.com& ＃34; }]，＆＃34;文本＆＃34 ;：我对您的回复＆＃34;，＆＃34; html＆＃34;：＆＃34;＆lt; p＆gt;我对您的回复＆lt; / p＆gt;＆ ＃34;，＆＃34;附件＆＃34;：[{＆＃34; filename＆＃34 ;:＆＃34; checkmark.png＆＃34;，＆＃34; content＆＃34;：＆＃34; iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQAQMAAAAlPW0iAAAABlBMVEUAAAD / // + l2Z / dAAAAM0lEQVR4nGP4 / 5 / h / 1 + G / 58ZDrAz3D / McH8yw83NDDeNGe4Ug9C9zwz3gVLMDA / A6P9 / AFGGFyjOXZtQAAAAAElFTkSuQmCC＆＃34; }]}＆＃39;</p><p> 注意！如果您要发送独立电子邮件，那么您很可能也希望设置主题值。对于答复和转发，IMAP API根据引用的消息设置主题本身。</p><p>  如果未设置主题，则IMAP API将从引用的消息中派生该主题，并向其添加Re：或Fwd：前缀</p><p>  IMAP API将已发送的邮件上载到“已发送邮件”文件夹（如果可以自动检测到该文件夹​​） </p><p>当帐户为Gmail / GSuite时，IMAP API不会上传到“已发送邮件”文件夹，因为Gmail会自动执行此操作</p><p>  IMAP API不管理OAuth2访问令牌，您必须自己提供这些令牌。这意味着，每次IMAP API需要对OAuth2帐户进行身份验证时，都会向身份验证服务器发出HTTP请求。该服务器负责使用有效的访问令牌重新分配。</p><p>   在“设置”页面中设置身份验证服务器URL，方法与设置Webhook URL相同</p><p> IMAP API使用另外两个GET参数针对身份验证服务器URL发出HTTP请求：帐户和协议，例如url？account = example＆amp; proto = imap</p><p>  curl -XPOST＆＃34; localhost：3000 / v1 / account＆＃34; -H＆＃34;内容类型：application / json＆＃34; -d＆＃39; {account＆＃34 ;:＆＃34; ouath-user＆＃34 ;,＆＃34; name＆＃34 ;:＆＃34; Example＆＃34 ;,＆＃34; imap＆ ＃34 ;： {＆＃34; host＆＃34 ;：＆＃34; imap.gmail.com＆＃34 ;、＆＃34; port＆＃34 ;： 993，＆＃34; secure＆＃34 ;：是，＆ ＃34; useAuthServer＆＃34 ;: true}，＆＃34; smtp＆＃34 ;: {＆＃34; host＆＃34 ;:＆＃34; smtp.gmail.com＆＃34 ;,＆＃34; port＆＃34 ;：465，＆＃34; secure＆＃34 ;: true，＆＃34; useAuthServer＆＃34 ;: true}}＆＃39;</p><p>           没错。应用程序本身（Web UI和API端点）均未实现任何类型的身份验证或ACL。想法是IMAP API仅处理IMAP访问，而其他所有东西则留给用户，因为每个系统都不相同。</p><p> 默认情况下，IMAP API仅允许来自本地主机的连接。要更改此设置，请编辑配置文件或使用--api.host =＆＃34; 0.0.0.0＆＃34; cli选项。这将启用外部访问，因此您应该使用防火墙仅允许您自己的应用程序访问它。对于Web UI，建议将Nginx或Apache代理与HTTP基本身份验证一起使用，可能仅用于VPN地址。 </p><p>请参阅示例性的系统单元文件，将IMAP API作为服务运行，以及示例性的Nginx配置文件，以在Nginx反向代理之后为IMAP API请求提供服务。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/andris9/imapapi">https://github.com/andris9/imapapi</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/api/">#api</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/imap/">#imap</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1038848.html"><img src="http://img2.diglog.com/img/2020/12/thumb_d353486dd9b0685aad0f531929a60b79.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038848.html">Ava将AI字幕扩展到桌面和Web应用程序，并筹集450万美元用于扩展 </a></div><span class="my_story_list_date">2020-12-10 19:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038767.html"><img src="http://img2.diglog.com/img/2020/12/thumb_f9511362cb46960a6797ba0dda4b429c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038767.html">Google推出了健康研究应用程序 </a></div><span class="my_story_list_date">2020-12-10 6:42</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038754.html"><img src="http://img2.diglog.com/img/2020/12/thumb_5a58f8bcd7585eb5b822efd9fac7e9ad.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038754.html">Adtech公司PubMatic开发了程序化广告的基础架构，在其IPO中筹集了1.18亿美元，在将其股票定价为20美元之后，达到了33.16美元的高位 </a></div><span class="my_story_list_date">2020-12-10 5:29</span></div><div class="col-sm"><div><a target="_blank" href="/story/1038704.html"><img src="http://img2.diglog.com/img/2020/12/thumb_d56ec09b92e05f134e14a56e2b7b43d5.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1038704.html">Extra Crunch Partner Perk：借助“ Spotify for Mindfulness＆Sleep”应用程序Aura找到内心的平静 </a></div><span class="my_story_list_date">2020-12-10 2:55</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>