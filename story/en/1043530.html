<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rails，React，微服务和微前端 Rails, React, Microservices and Micro-FrontEnds</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Rails, React, Microservices and Micro-FrontEnds<br/>Rails，React，微服务和微前端 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-08 22:15:26</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/c7c7a5aa7e079f35777127d71379c01f.png"><img src="http://img2.diglog.com/img/2021/1/c7c7a5aa7e079f35777127d71379c01f.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>A common refrain among us developers is that we spend a fantastic amount of our day sitting in front of the computer screen quietly, with our heads full of internal state. Here on the Styling team at Stitch Fix, we are lessening the amount of state a developer needs to have in their head at any given time by moving towards an application architecture that makes use of microservices and micro front ends, connected by a central API.</p><p>开发人员之间的共同点是，我们花大量的时间安静地坐在电脑屏幕前，而脑袋里充满了内部状态。在Stitch Fix的样式小组中，我们正在朝着通过中央API连接使用微服务和微前端的应用程序体系结构的方向，减少开发人员在任何给定时间需要掌握的状态。</p><p> As our applications grow and become more complex, it gets harder and harder to keep track of all of the mental threads required to solve the problems at hand. Just as our mental load grows, so does the heaviness of our development environment. Writing our tests becomes harder, and running them is potentially slower, too. CI and deploy times creep up. If multiple teams are involved in building a single application, our monolith runs the risk of becoming even more intimidating to new contributors, and we have to lean heavily on human communication to fill in the gaps.</p><p> 随着我们的应用程序的增长和变得越来越复杂，跟踪解决当前问题所需的所有思维线程变得越来越困难。正如我们的精神负担增加一样，我们的开发环境也变得越来越沉重。编写测试变得越来越困难，运行它们的速度也可能会变慢。 CI和部署时间逐渐增加。如果有多个团队参与构建一个应用程序，那么我们的整体将冒着对新的贡献者变得更加威吓的风险，并且我们必须严重依靠人际交流来填补空白。</p><p> We recognize that microservices are not a panacea. This is not a blog post about how everyone should move to microservices. Our motivations are as much organizational as they are technical. We hope that by illustrating our past and future architecture, you will be able to use the pieces of our approach that are relevant to your own systems.</p><p> 我们认识到微服务不是万能药。这不是关于每个人都应如何转向微服务的博客文章。我们的动机既有组织性又有技术性。我们希望通过说明我们过去和将来的体系结构，您将能够使用我们的方法中与您自己的系统相关的部分。</p><p>   Our specific setup consists of front end web applications with corresponding Rails back ends. This affords us many benefits! But it also poses some unique challenges. It can be particularly tempting to diverge from React’s single page application paradigm when we are working with a back end framework that defaults to serving up disparate views.</p><p>   我们的特定设置包括前端Web应用程序和相应的Rails后端。这给我们带来了很多好处！但这也带来了一些独特的挑战。当我们使用默认用于提供不同视图的后端框架时，与React的单页应用程序范型背道而驰可能特别诱人。</p><p> Our previous architecture consisted of a mix of Rails views, and large, full-page React components. We had some residual Rails views that served up HTML and vanilla JavaScript. These views were a holdover from before we adopted React (the Cretaceous era, if you’re a React developer). As soon as the React components were served up, they functioned as their own discrete applications, making basic API calls to their connecting Rails layer.</p><p> 我们以前的体系结构由Rails视图和大型的整页React组件组成。我们有一些残留的Rails视图，这些视图提供HTML和原始JavaScript。这些观点是我们采用React之前的遗留物（白垩纪时代，如果您是React开发人员）。一旦React组件用完，它们便充当了自己的独立应用程序，对其连接的Rails层进行了基本的API调用。</p><p> Diverging from an accepted pattern means… you guessed it! More domain knowledge that needs to be passed around, and more to keep in mind as you program.</p><p> 与公认的模式不同意味着……您猜对了！需要传递更多的领域知识，并且在编程时要牢记更多。</p><p> Of course, we ran into the issues mentioned in the previous section. We recently onboarded a new developer onto our team. As we got her development environment up and running, we confronted some of the challenges of getting set up with a monolith head-on. Errant dependencies required domain knowledge to track down. In order to get one thing working, everything had to work. And there was a lot of everything! Our new architecture aims to help some of these roadblocks fade into the past.</p><p> 当然，我们遇到了上一节中提到的问题。我们最近将新开发人员加入了我们的团队。随着她的开发环境的启动和运行，我们面对了一些挑战，如何直接进行整体设置。错误的依赖关系需要领域知识来进行追踪。为了使一件事情起作用，一切都必须起作用。那里有很多东西！我们的新体系结构旨在帮助其中一些障碍逐渐消逝。 </p><p> We did have a stepping-stone to our new architecture, though: a handful of microservices that allowed us to talk to other services within the organization. We are building upon this as we transition to our new approach.</p><p>但是，我们确实为我们的新架构奠定了基础：少数微服务使我们能够与组织内的其他服务进行对话。当我们过渡到新方法时，我们正在此基础上。</p><p>    On the back end side of things, we are starting to make broader use of microservices. We now use them for both application- and organization-level needs. For example, we are moving towards having company-wide merchandising and warehouse services. Our team doesn’t own these, which gives us more room to be the experts in our domain. We have plans to begin to transition towards a large, federated graph that many teams across the engineering organization will also use.</p><p>    在事情的后端，我们开始广泛使用微服务。现在，我们将它们用于应用程序级和组织级需求。例如，我们正朝着提供全公司的商品销售和仓库服务的方向发展。我们的团队并不拥有这些，这给了我们更多的空间来成为我们领域的专家。我们计划开始向大型联合图过渡，工程组织中的许多团队也将使用此图。</p><p> As far as our React/Rails integration layer goes, Rails continues to be our centralized API, through which our front ends can access the aforementioned application data.  We now use a pact to verify the contract between the front and back ends. This allows us to make sure that we are testing the seams of our newly decomposed applications. (And it means we rely less on our fallible human selves to be the keepers of our contracts!)</p><p> 就我们的React / Rails集成层而言，Rails仍然是我们的集中式API，前端可以通过它访问上述应用程序数据。现在，我们使用协定来验证前端和后端之间的契约。这样可以确保我们正在测试新分解的应用程序的接缝。 （这意味着我们更少依赖我们容易犯错的人作为我们合同的守望者！）</p><p>  Now that our React user interfaces are decoupled from the more traditional Rails Model/View/Controller pattern, we have more freedom to give them the room to breathe as full-fledged applications.</p><p>  现在，我们的React用户界面已经与传统的Rails模型/视图/控制器模式脱钩了，我们有了更大的自由度，可以为他们提供成熟的应用程序。</p><p> We have made spinning up a micro front end easy, to facilitate better developer velocity. We have an agreed-upon starter app, built with Create-React-App. We are also in the process of developing a distinct, contained component library, tailored to our team’s specific expert use needs. Our new front end library utilizes automatic deployments with semantic releases— we get the benefits of the contained CI without the drawbacks of a monolith. If we find that it collectively improves our experience as developers, we hope to roll it out to some of our other existing repositories.</p><p> 我们简化了微前端的纺纱，以提高显影速度。我们有一个通过Create-React-App构建的议定入门应用程序。我们还在开发一个独特的，包含在内的组件库，以适合我们团队的特定专家使用需求。我们新的前端库利用带有语义版本的自动部署-我们获得了包含CI的好处，而没有整体的弊端。如果我们发现它可以共同改善我们作为开发人员的经验，则希望将其推广到我们其他一些现有的存​​储库中。</p><p> Another benefit we get from extracting our functional, presentation-level React components into a separate library, is that we can isolate them from our API. We now have an abstracted front end level API layer. Its sole purpose is to manage data coming in from the back end (where our pacts come into play!). This is a way to provide systematic scaffolding around domain knowledge.</p><p> 将功能性的，表示层的React组件提取到一个单独的库中，我们获得的另一个好处是，我们可以将它们与API隔离。现在，我们有了一个抽象的前端级别API层。它的唯一目的是管理从后端（在我们的契约发挥作用的地方）传入的数据。这是围绕领域知识提供系统支架的一种方法。</p><p>  By modularizing our front and back ends in such a way, no one person is responsible for keeping an entire app in their head all the time. As developers, it’s important to have a strong sense of our broader architectural ecosystems. When we remove that feeling of “I need to know how allllll of this works, but just enough so that I can rescue it when it breaks”, we facilitate the mental room to iterate on our team’s systems with greater depth.</p><p>  通过以这种方式对我们的前端和后端进行模块化，没有人会一直负责将整个应用程序保持在头脑中。作为开发人员，对我们更广泛的建筑生态系统有深刻的了解非常重要。当我们消除了“我需要知道它会如何运作，但足以让我在出现问题时将其挽救”的感觉时，我们便会为头脑空间提供便利，以便更深入地迭代团队的系统。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://multithreaded.stitchfix.com/blog/2021/01/06/a-better-react-rails-architecture/?hn=2">https://multithreaded.stitchfix.com/blog/2021/01/06/a-better-react-rails-architecture/?hn=2</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/react/">#react</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/应用程序/">#应用程序</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>