<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我们如何同时为数百万观众扩展直播</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">我们如何同时为数百万观众扩展直播</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-24 07:08:50</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/01a59d3bfab7fe028a0e96814066a63e.jpg"><img src="http://img2.diglog.com/img/2020/10/01a59d3bfab7fe028a0e96814066a63e.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>As Facebook Live and   Facebook Watch  have grown, the content shared there has expanded to include professionally produced, broadcast-quality content, like shows and live event coverage. This type of professional broadcasting from providers like La Liga, CONMEBOL, and UEFA is a very different challenge from user generated content (UGC) and viewers’ expectations are much higher. Viewers who are used to the reliability and quality of traditional TV broadcasts expect a near-flawless viewing experience for these Live streams.</p><p>随着Facebook Live和Facebook Watch的增长，在那里共享的内容已经扩大到包括专业制作的广播质量的内容，比如节目和现场活动报道。来自西甲、CONMEBOL和欧足联等提供商的这类专业转播与用户生成内容(UGC)是一个非常不同的挑战，观众的期望要高得多。习惯于传统电视广播的可靠性和质量的观众期望这些Live Streams获得近乎完美的观看体验。</p><p> While many companies do one or the other well, we need to support both UGC and broadcast-quality Live streams at a very large scale. These videos have to work every time — for everyone. To accomplish this, we built a system capable of managing both UGC (captured on all kinds of devices at differing quality levels) and broadcast-quality high-res streaming — and working reliably for billions of people around the world.</p><p>虽然许多公司都做得很好，但我们需要在非常大的范围内同时支持UGC和广播质量的Live Streams。这些视频每次都必须有效-对每个人都有效。为了实现这一目标，我们建立了一个系统，能够管理UGC(在各种设备上以不同的质量级别捕获)和广播质量的高分辨率流媒体，并为世界各地的数十亿人可靠地工作。</p><p> To deliver a seamless streaming experience at this scale, the entire system, from ingest to delivery, needs to be reliable — but the overall system is only as reliable as its weakest component. Most UGC content uses public internet, which comes with some risk of variable network conditions: A capacity limit somewhere in the network may degrade quality, or a failure might cause a video stall or buffer for viewers. We never want viewers to experience interruptions like these on either social streaming or professional broadcasts, but for big events like the UEFA Champions League Final, the impact of losing audio or video for even a few seconds is high.</p><p>要提供如此规模的无缝流媒体体验，整个系统(从接收到交付)都需要可靠-但整个系统的可靠性取决于其最薄弱的组件。大多数UGC内容使用公共互联网，这带来了一些网络条件变化的风险：网络中某处的容量限制可能会降低质量，或者故障可能会导致观众的视频停顿或缓冲。我们从来不希望观众在社交流媒体或专业转播上经历这样的中断，但对于像欧冠决赛这样的大型活动来说，即使是几秒钟丢失音频或视频的影响都是很高的。</p><p> We built new ingestion capabilities to bridge the gap between traditional TV production and the internet-based ingestion designed for our UGC audience. We built in redundancy at every point — transport, ingestion, processing, delivery, and playback — to make sure the system could withstand most types of failure. And we scaled our delivery infrastructure to support streams with unprecedented viewership. Along the way, we discovered new failure modes — as well as ways to mitigate them in time for the next broadcast.</p><p>我们建立了新的摄取能力，以弥合传统电视制作和为我们的UGC观众设计的基于互联网的摄取之间的差距。我们在每个点(运输、摄取、处理、交付和回放)都构建了冗余，以确保系统能够承受大多数类型的故障。我们扩展了我们的交付基础设施，以支持拥有前所未有的收视率的流。在此过程中，我们发现了新的故障模式-以及在下一次广播时及时缓解它们的方法。</p><p> That video system is now in production, supporting millions of Live streams every day across both UGC and professional broadcast. In August, the system proved itself when we reached a huge number of concurrent viewers on the Facebook Live broadcast of the UEFA Champions League final. Viewership peaked at 7.2 million concurrents across both the Brazil and Spanish-speaking Latin America streams. Ensuring this level of seamless reliability required work on both ingestion and delivery.</p><p>该视频系统现在正在生产中，每天支持UGC和专业广播的数百万直播流。8月份，当我们在Facebook上直播欧洲冠军联赛决赛时，我们达到了大量并发观众，这证明了这个系统本身。巴西和讲西班牙语的拉丁美洲地区的收视率都达到了720万的峰值。要确保这种无缝的可靠性水平，需要在摄取和交付两个方面进行工作。</p><p>  Because the stakes are high, TV broadcasters keep everything on private, dedicated paths with guaranteed bandwidth. These paths are always geographically diverse: either two independent fiber-optic paths or a fiber-optic path with a satellite backup. To reliably support similar high-viewership broadcasts, we leverage a broadcast facility with our own managed encoders so we could easily access broadcast networks, usually private fiber and satellite links, to keep the video/audio quality and reliability as high as possible. That facility is connected to our data centers using dedicated and diverse connections.</p><p>由于赌注很高，电视广播公司将所有内容都保存在专用的专用路径上，并保证带宽。这些路径在地理上总是不同的：或者是两个独立的光纤路径，或者是带有卫星备份的光纤路径。为了可靠地支持类似的高收视率广播，我们利用具有我们自己的受管编码器的广播设施，以便我们可以轻松访问广播网络，通常是专用光纤和卫星链路，以保持尽可能高的视频/音频质量和可靠性。该设施使用专用且多样化的连接连接到我们的数据中心。</p><p> We also built mechanisms that allow ingestion of main and backup streams into our infrastructure as well as the ability to manually or automatically failover from main to backup in case of issues, all while ensuring that the viewing experience remains flawless.</p><p>我们还构建了一种机制，允许将主流和备份流接收到我们的基础架构中，并能够在出现问题时手动或自动从主流故障切换到备份流，同时确保查看体验保持完美无缺。</p><p>  This shift from supporting broadcasts in aggregate to supporting a single broadcast means things we traditionally accepted (machine restarts, network failures, congestion, etc.) now require careful mitigations. These mitigations (coordinated failover, dedicated link capacity, multiple geo-distributed paths, etc.) need to happen over the entire duration of games, which can easily run longer than four hours with pre- and post-shows.</p><p>从支持整体广播到支持单个广播的转变意味着我们传统上可以接受的事情(机器重启、网络故障、拥塞等)。现在需要谨慎的减刑。这些缓解措施(协调故障转移、专用链路容量、多条地理分布路径等)。需要在比赛的整个持续时间内进行，这很容易在演出前和演出后运行超过4个小时。</p><p>  In addition to ingesting content seamlessly and at scale, we also need to manage massive scale delivery of video content to viewers. These big events and broadcasters are followed by millions of people who get notifications when the Live stream starts. This creates a spike of simultaneous viewers trying to watch the Live stream. When edge cache servers (located proximate to users) don’t have the requested content, they forward the request to underlying services. This causes what we call the  thundering herd problem — too many requests can stampede the system, causing lag, dropout, and disconnection from the stream.</p><p>除了无缝和规模化地摄取内容外，我们还需要管理向观众大规模交付视频内容。这些大型活动和广播员会受到数百万人的关注，他们会在Live流开始时收到通知。这会导致试图观看Live流的同时观看人数激增。当边缘缓存服务器(位于用户附近)没有请求的内容时，它们会将请求转发给底层服务。这会导致我们所说的雷鸣般的羊群问题-太多的请求可能会使系统崩溃，导致延迟、中断和与流的连接中断。</p><p> We have built robust infrastructure to protect our back-end services from such thundering herd issues by developing novel forms of request coalescing and cache sharding that allow us to reliably deliver video content while ensuring realtime playback.</p><p>我们已经建立了强大的基础设施，通过开发新形式的请求合并和缓存分片来保护我们的后端服务不受这种雷鸣般的羊群问题的影响，这些形式使我们能够可靠地交付视频内容，同时确保实时回放。</p><p>  When serving video data, we work with ISPs when possible to prevent network overload because of these high-concurrency events. For example, when we found that viewer experience in Rio de Janeiro was degraded by congestion between Facebook and a particular ISP, we increased our local interconnection capacity from 20 Gbps to 120 Gbps.</p><p>在提供视频数据时，我们会尽可能与ISP合作，以防止因这些高并发事件而导致的网络过载。例如，当我们发现里约热内卢的观众体验因Facebook和特定ISP之间的拥塞而降级时，我们将本地互联容量从20Gbps提高到120Gbps。</p><p> As a result, we were able to keep almost all our Live video traffic within the viewer’s ISP’s network. This kept our traffic in-country and off congested international links, which benefits both the ISP (reducing its cost) and the viewers (improving their experience). With our Live video caches and dense connectivity to ISPs, we are closer to our viewers than ever before, so we can deliver higher-resolution video with fewer stalls. These investments ensured that millions of Facebook viewers had a seamless experience for the UEFA Champions League Final.</p><p>因此，我们能够将几乎所有的实时视频流量保留在观众的ISP网络内。这使我们的流量保持在国内，远离拥堵的国际链路，这对ISP(降低了成本)和观众(改善了他们的体验)都有好处。有了我们的实时视频缓存和与ISP的密集连接，我们比以往任何时候都更接近我们的观众，因此我们可以以更少的停顿提供更高分辨率的视频。这些投资确保了数百万Facebook观众在欧冠决赛中获得无缝体验。</p><p>  The streaming of the UEFA Champions League Final to 7.2 million concurrent viewers was a success and gave us more insight into last-mile connectivity challenges. We were able to seamlessly ingest the video, process it, and deliver it to the edge (where we interconnect with ISPs), but last-mile radio delivery was a big challenge for popular games because of limitations of current cellular technology. To solve this for the future, we are exploring using LTE-Broadcast to share a single copy of the stream for everyone on the same cell tower to overcome this last-mile challenge.</p><p>向720万并发观众播放欧冠决赛取得了成功，让我们更深入地了解了最后一英里的连接挑战。我们能够无缝地摄取视频，对其进行处理，并将其传送到EDGE(我们在那里与ISP互联)，但由于当前蜂窝技术的限制，最后一英里的无线电传送对流行游戏来说是一个巨大的挑战。为了在未来解决这一问题，我们正在探索使用LTE-Broadcast为同一蜂窝发射塔上的每个人共享一份流拷贝，以克服这最后一英里的挑战。</p><p> Investing in connectivity and internet infrastructure is important to help   bring reliable, affordable internet to more people . We are nearing completion of a   new submarine cable , which will improve connectivity and improve redundancy and resilience in Latin America. And we will continue to evaluate deployment of new edge locations in order to help create healthy ecosystems for interconnectivity between networks and keep traffic in-country, not only for Facebook but also between ISPs within the same country.</p><p>投资于连接和互联网基础设施对于帮助更多人带来可靠、负担得起的互联网非常重要。我们即将完成一条新的海底电缆，这将改善拉丁美洲的连通性，提高冗余性和弹性。我们将继续评估新边缘位置的部署，以帮助为网络之间的互联互通创建健康的生态系统，并将流量保持在国内，不仅是Facebook，还包括同一国家内的ISP之间的流量。</p><p> While this was a big milestone (and a learning experience) for us, it’s not the end of the road. Our next big challenge will be New Year’s Eve, which is the inverse of the challenges we faced with the UEFA Champions League Final. We traditionally see a spike of Live streams from individual devices as millions of people stream fireworks and celebrations at the same time when the clock strikes midnight around the world! For New Year’s Eve, instead of optimizing caches for a small number of very popular broadcasts, we need to optimize our processing, I/O, and storage for a huge number of simultaneous smaller-reach streams.</p><p>虽然这对我们来说是一个重要的里程碑(也是一次学习经历)，但这并不是道路的尽头。我们的下一个重大挑战将是新年前夕，这与我们在欧冠决赛中面临的挑战相反。传统上，我们看到来自单个设备的直播流激增，因为世界各地的时钟在午夜敲响的同时，数百万人在播放烟花和庆祝活动！对于除夕夜，我们不是为少量非常流行的广播优化缓存，而是为大量并发的小范围流优化我们的处理、I/O和存储。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://engineering.fb.com/video-engineering/live-streaming/">https://engineering.fb.com/video-engineering/live-streaming/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/扩展/">#扩展</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/live/">#live</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/观众/">#观众</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1030130.html"><img src="http://img2.diglog.com/img/2020/10/thumb_99645582f7b9378abfbc70b633d16287.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030130.html">安装300,000次的广告拦截程序是恶意的，应该立即删除</a></div><span class="my_story_list_date">2020-10-21 2:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029970.html"><img src="http://img2.diglog.com/img/2020/10/thumb_2f3abca534349fd898a34b4db2c89f52.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029970.html">广受欢迎的反广告屏蔽扩展被出售，用户详细信息受损</a></div><span class="my_story_list_date">2020-10-20 15:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028879.html"><img src="http://img2.diglog.com/img/2020/10/thumb_4c4934bf9940bd4f6c0caf10cc597589.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028879.html">现在可以在Microsoft Edge中测试清单V3更改</a></div><span class="my_story_list_date">2020-10-15 3:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1028839.html"><img src="http://img2.diglog.com/img/2020/10/thumb_9df79c5a555b03aa2e4acc6161ccf78c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1028839.html">缩放扩展端到端加密产品</a></div><span class="my_story_list_date">2020-10-15 1:8</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>