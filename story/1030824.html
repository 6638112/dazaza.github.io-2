<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>证明新的Unix shell是合理的四个特性</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">证明新的Unix shell是合理的四个特性</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-24 07:30:25</div><div class="page_narrow text-break page_content"><p>在一篇关于茴香语言基本原理的lobste.rs帖子中，我发布了关于石油为什么存在的摘要：</p><p>但是Oil有更多的东西，包括统一单独的广告表达语言……。</p><p>这篇文章详细阐述了这些观点。我已经将其基本原理浓缩为职业安全卫生语言的四个关键特征。</p><p>我给出了每个功能的示例，链接到文档(正在进行中)，并对项目的未来进行了评论。</p><p>回想一下，OSH是为运行现有的shell脚本而设计的，并且从2018年初开始就这样做了。</p><p>它还用Opt-in特性修复了shell语言中的缺点。这是四个最重要的问题。</p><p>我刚刚完成了对壳牌公司易碎的Set-e/Errexit机制的大修。我对此很兴奋，因为我去年就开始了，但在被难住之后，我把它放在了次要位置！</p><p>我相信我现在已经解决了所有问题，并希望得到您的反馈。简单不变的是，OSH从不丢失退出代码，而POSIX shell或bash并非如此。以下是增强功能的摘要：</p><p>Strict_errexit-一个shell选项，用于检测在shell中丢失错误的情况，如如果myfunc。这改进了您的shell脚本，即使您在另一个shell下运行它们！换句话说，OSH可以用作开发工具。</p><p>Inherit_errexit-OSH实现此bash4.4选项，这是对&#34；命令suberrexit&#34；问题的部分修复。</p><p>COMMAND_SUB_ERREXIT-在每个命令SUB的末尾检查故障的shell选项，这样您就不会丢失错误。这解决了朱莉娅·埃文斯(Julia Evans)最近一部漫画的最后一个面板中显示的问题：猛烈抨击有时是奇怪的&#34；</p><p>PROCESS_SUB_FAIL-类管道失败，但用于进程替换。意大利将errexit设置为&#34；参见&#34；进程SUB导致的故障，如cat foo.txt&lt；中的sortinvocation(SORT/OOOPS/ERROR)，@_PROCESS_SUB_STATUS：类似于${PIPESTATUS[@]}的变量。您可能需要检查所有进程的退出状态。</p><p>Run内置打开errexit，所以如果运行myfunc是安全的。它还提供对退出代码的细粒度控制。</p><p>是的，有很多解决方案，因为shell有很多问题！但是你不必记住所有这些名字。将SHOT--设置油：BASIC添加到您的程序的顶部，以打开所有选项。Strict_errexit失败将提醒您使用运行包装器。</p><p>(旁白：我能够在解释器中干净利落地解决所有这些问题。4年前，我花了很多时间在石油公司的架构上，这样我就可以解决这些微妙的问题。当代码具有良好的结构时，修复的正确位置就会自动展现给您。(油价仍在改善！)。</p><p>QSN是实现石油领域结构化数据的基础。每当您需要在shell中处理用户提供的数据时，它就不再需要发明特殊的(通常是不完整的)格式。换句话说，除了混乱的解析和拆分之外，Oil脚本还有另一种选择。</p><p>这里有一些简短的例子。写内建函数将其参数输出到stdout，并接受--qsn标志：</p><p>#打印文件名为每行一个。如果名称包含#换行符或其他特殊字符，则它的QSN编码类似于\n带有NUL\0字节的多行名称--qsn--*.txt。</p><p>Cat list.txt|While read--line--qsn{#_line由&#39；read&#39；rm--$_line}隐式设置。</p><p>我还实现了read-0作为bash-r-d；&#39；模糊的read-r-d；&#39；的同义词，这允许您像xargs-0一样在shell中使用find-Print0输出。此格式与QSN不同，但现在很容易在它们之间来回转换。</p><p>这是第一次削减QSN支持。我希望它会根据您的反馈而发展！</p><p>这是在2019年夏天完成的。我在今年早些时候的“简单单词评估”中对此进行了描述，您可以在Oil语言习语中看到示例。</p><p>这篇博客始于2016年，对静态解析进行了解释。我在介绍中引用的评论中没有提到这一点，但它仍然是该项目的关键部分。</p><p>当我注意到二三十年前Perl5和RCshell的作者都抱怨shell的动态解析时，我意识到这是多么重要！</p><p>这个基金会仍在支付红利。我最近使用静态解析器为命令subs创建了详细的错误消息：</p><p>$SHORT--set errexit command_sub_errexit$d=$(日期%x)日期：无效日期‘%x’d=$(日期%x)^~[交互]：13：FATAL：命令SUB已退出，状态为1...。</p><p>$SHORT--set PROCESS_SUB_FAIL$cat/dev/null&lt；(排序oops)排序：无法读取：oops：没有这样的文件或目录cat/dev/null&lt；(排序oops)^~[交互]：27：FATAL：正在退出，状态为2...。</p><p>此外，Travis Everett还开发了一个依赖于静态解析的shell依赖捆绑器。</p><p>明确地写出这种语言的基本原理确实很有用。我用#为什么是新贝壳#的帖子多次重复这一点，但即使在4年后再次解释也是有帮助的。这个项目正在发展，并且变得越来越清晰。</p><p>随着Errexit和QSN解码器的大修，我相信我们现在已经具备了OSH语言的所有基础！这些功能将在下一版本中删除。</p><p>有人声称，仅这四个特性就证明了一个新的Unix shell是合理的。如果我们完成C++翻译，并在这里结束项目，这将是值得的。</p><p>消除引述地狱的话。让我们一劳永逸地解决它，而不是在接下来的30年里告诫每一个新的shell程序员，因为过去的30年里已经这样做了！</p><p>如果你不同意，请告诉我！我想知道shell语言中还有哪些地方需要修复或以其他方式解决。</p><p>(我在这里省略了交互式shell，因为我认为当务之急是开发一个更好的编程和自动化shell。A&#34；Cloud Shell&#34；如果你愿意，也可以这么说。)。</p><p>早在一月份，我就已经担心这个项目的范围了。我写道，该项目最大的削减将是Oil将基于字符串，而不是类似Python的数据类型。</p><p>OSH语言是基于字符串(和字符串数组)的兼容shell。赋值看起来像是本地x=mystr。</p><p>Oil语言有类似Python的类型和表达式，赋值看起来像var x=42+a[i]+f(x，y)。它具有容量收集的递归数据结构堆。</p><p>因此，我现在要说的是，今后的首要任务是完善职业安全与健康语言，而把石油语言推迟到朦胧的未来。</p><p>这意味着完成到C++的转换，连接垃圾收集器，并编写文档。这可能意味着准备将代码嵌入到另一个应用程序中，比如鱼壳。(我已经和维护员讨论过这个问题，大家都很感兴趣。但这是一项繁重的工作，不应该想当然地认为这是理所当然的，而且还有很多问题没有解决。)。</p><p>实现这一OSH语言里程碑感觉非常可行，因为一切都已经在Python中运行，C++的1685个规范测试空间中有915个(产生30倍-50倍的加速比)。</p><p>但是我不会放弃石油语言！我只是需要帮助。它以原型的形式存在，您的反馈将激励我继续工作。</p><p>油画语言的四大特点。这个帖子将职业安全与健康缩小到四个主要功能，而Oil也有四个：</p><p>序列化格式，如JSON和QTSV(建议)。后者是一种用于类型化表格的格式，建立在QSN之上。</p><p>石油语言的巨大变化。列出了我最近所做的更改，这些更改应该会让潜在的贡献者对这门语言有一个感觉。</p><p>Python、JS和Ruby与Perl和PHP的不同之处。前面的语言有一个干净的数据模型/内存模型：带有引用语义的垃圾收集堆。</p><p>漫画评论。我可以用这些最近的漫画作为解释职业安全卫生语言的一种方式。(参见其他标记为#COMIC的帖子。)。</p><p>我描述了改进的shell语言的4个基本特性。让我知道你认为遗漏了什么。</p><p>如果您还没有读过，请参阅为什么创建UnixShell？它是这个网站上最受欢迎的页面，不过我仍然需要在2021年更新它。</p><p>然后我提议把重点放在让职业安全卫生语言准备好生产上。我还在学习石油语言，但我需要帮助完成它。</p><p>谈到这一点，有几个人指出，石油的开发过程是困难的。我最近已经解决了这个问题，从构建日志中删除了spew，并使用/usr/bin/env为更便携的Shebangs添加了一个线条检查(这刚刚触发并防止了回归！)。</p><p>我仍然想制作一个截屏视频来展示Oil是多么容易工作。在克隆之后，10或20秒的构建过程应该会为您提供一个可工作的bin/Osh：</p><p>因此，我正在努力让“石油”变得更好用。(工业和信息化部电子科学技术情报研究所陈皓)。如果你想帮忙，如果你遇到问题，请伸出援助之手。</p><p>感谢Till Schröder对石油语言的巨大反馈。例如，他注意到我给catchbuiltin(现在是Run)起了个笨拙的名字。</p><p>感谢迭戈·卡莱贾多次更新石油文档。这本身就是一个巨大的努力！</p><p>这4个功能并不是OSH中唯一的功能，但我认为它们已经足够了！</p><p>我用shell修复了其他问题，并用标签为#Real-Problems的帖子来描述它们。我把这个标签贴到了这篇帖子上，因为COMMAND_SUB_ERREXIT解决了朱莉娅·埃文斯(Julia Evans)困惑的问题。</p><p>我相信Oil会在3个维度上比bash更快：解析速度、运行时计算速度和运行时I/O速度。然而，这可能需要在完成垃圾收集器后进行优化，而我们缺少人手来做到这一点。</p><p>我希望Oil有更好的开发工具：跟踪、调试和崩溃转储。几年前我制作了一个崩溃转储的原型，但没有收到太多反馈。我认为，职业安全与健康必须更加成熟，才能令人信服。</p><p>分口译员(问题704)有多个用例。在CPython中添加这个特性的尝试已经失败了很多次，而像Tcl和Lua这样的嵌入式语言很好地利用了它们。</p><p>我甚至认为在Oil中嵌入WebAssembly有很好的用例，比如7月份关于常规语言的文章中提到的，另一个用例是打包和分发可移植的开发依赖项，比如CommonMark渲染器。这个问题导致了上面提到的开发过程摩擦。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://www.oilshell.org/blog/2020/10/osh-features.html">http://www.oilshell.org/blog/2020/10/osh-features.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/shell/">#shell</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/justify/">#justify</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1030648.html"><img src="http://img2.diglog.com/img/2020/10/thumb_48734b1162d4f8899b3eceba01c1b36a.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030648.html">ISH壳牌在App Store上推出</a></div><span class="my_story_list_date">2020-10-23 3:23</span></div><div class="col-sm"><div><a target="_blank" href="/story/1026687.html"><img src="http://img2.diglog.com/img/2020/9/thumb_33654e5699dd39c5363435efdbc94d2a.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1026687.html">FISH VS ZSH VS BASH以及为什么您应该改用FISH</a></div><span class="my_story_list_date">2020-9-27 14:19</span></div><div class="col-sm"><div><a target="_blank" href="/story/1024193.html"><img src="http://img2.diglog.com/img/2020/9/thumb_32202fb9fc2059d851df177ca07a6185.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024193.html">Material Shell-GNOME的现代桌面界面</a></div><span class="my_story_list_date">2020-9-16 22:48</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003076.html"><img src="http://img.diglog.com/img/2020/5/thumb_b12d070aa38c1f3a76aaaf868ec9f9c7.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003076.html">与shell无关的跨平台自动完成规范-OpenAutoComplete</a></div><span class="my_story_list_date">2020-5-21 12:14</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>