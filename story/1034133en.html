<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>BBC改用AWS，采用无服务器的新网站架构</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">BBC改用AWS，采用无服务器的新网站架构</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-10 04:44:03</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/e56f7162849b0e77f00626a520666d45.png"><img src="http://img2.diglog.com/img/2020/11/e56f7162849b0e77f00626a520666d45.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Updated The BBC website, the  sixth most popular in the UK, has mostly migrated from the broadcaster&#39;s bit barns to Amazon Web Services (AWS) with around half the site now rendered using AWS Lambda, a serverless platform.</p><p>英国人气排名第六的BBC网站大部分已经从广播公司的BIT谷仓迁移到亚马逊网络服务(AWS)，现在大约一半的网站使用AWS Lambda，这是一个无服务器平台。</p><p>  &#34;Until recently much of the BBC website was written in PHP and hosted on two data centres near London,&#34; Matthew Clark, head of architecture, said  lately. &#34;Almost every part has been rebuilt on the cloud.&#34;</p><p>英国广播公司(BBC)建筑主管马修·克拉克(Matthew Clark)最近表示，直到最近，BBC的大部分网站都是用PHP编写的，托管在伦敦附近的两个数据中心。几乎所有部件都已在云上重建。</p><p>  PHP runs fine in the cloud, but this is not a matter of lift and shift. Instead, the BBC team devised a new architecture based on serverless computing. It also endeavoured to combine what used to be several sites – such as News, Sport, and so on – into one, though Clark said the World Service, iPlayer video, and the radio site BBC Sounds remain separate.</p><p>PHP在云中运行良好，但这不是升迁的问题。相反，BBC团队设计了一种基于无服务器计算的新架构。它还努力将过去的几个网站--如新闻、体育等--合并为一个网站，尽管克拉克说，世界服务、iPlayer视频和广播网站BBC Sound仍然是分开的。</p><p>  The rest have been combined into a new thing called WebCore. &#34;By focussing on creating one site, rather than several, we&#39;re seeing significant improvements in performance, reliability, and SEO,&#34; said Clark.</p><p>其余的都被合并成了一种名为WebCore的新东西。克拉克说，通过专注于创建一个网站，而不是创建几个网站，我们正在看到性能、可靠性和搜索引擎优化方面的显著改善。</p><p>  Web traffic initially hits a Global Traffic Manager (GTM), an in-house solution based on the Nginx web server and running partly on-premises (showing that the BBC has not entirely ditched its data centres) and partly on AWS. GTM handles &#34;tens of thousands of requests a second,&#34; said Clark. A second layer on AWS handles caching and routing, before hitting functions running on AWS Lambda, which perform server-side rendering (SSR) of dynamic content using React, a JavaScript framework.</p><p>网络流量最初使用的是Global Traffic Manager(GTM)，这是一个基于Nginx网络服务器的内部解决方案，部分在内部运行(表明BBC并未完全放弃其数据中心)，部分在AWS上运行。克拉克说，GTM每秒处理数万个请求。AWS上的第二层负责缓存和路由，然后访问在AWS Lambda上运行的功能，这些功能使用JavaScript框架Reaction执行动态内容的服务器端呈现(SSR)。</p><p>  Server-side rendering means the browser gets a page ready to view without having to do a lot of work, and thus it should appear instantly, though it increases the burden on the server – caching mitigates this, we note. Walmart engineer Alex Grigoryan, who also oversaw a migration to SSR,  tested SSR vs client-side rendering (CSR) and said: &#34;When we did A/B tests on SSR vs CSR... our numbers showed better engagement from the customer with rendering early,&#34; though he noted increased server load as a major disadvantage.</p><p>服务器端呈现意味着浏览器无需做很多工作就可以查看页面，因此它应该会立即出现，尽管它增加了服务器的负担-我们注意到缓存减轻了这一点。沃尔玛工程师亚历克斯·格里戈里安(Alex Grigoryan)也监督了向SSR的迁移，他测试了SSR与客户端渲染(CSR)，并表示：当我们在SSR与CSR上进行A/B测试时……。我们的数据显示，客户对提前渲染的参与度更高，不过他指出，服务器负载增加是一个主要缺点。</p><p>  In the BBC&#39;s case, Lambda is used, which is able to auto-scale on demand. &#34;About 2,000 lambdas run every second to create the BBC website; a number that we expect to grow,&#34; said Clark. He added that Lambda scales better than VMs on the AWS Elastic Compute Cloud (EC2), saying that &#34;our traffic levels can rocket in an instant; Lambda can handle this in a way that EC2 auto-scaling cannot.&#34;</p><p>在BBC的例子中，使用了Lambda，它能够根据需要自动缩放。克拉克说，为了创建BBC网站，每秒大约有2000个Lambdas在运行；我们预计这个数字还会增加。他补充说，Lambda的可扩展性比AWS弹性计算云(EC2)上的虚拟机更好，他说，我们的流量水平可以在瞬间飙升；Lambda能够以EC2自动伸缩无法做到的方式处理这一问题。</p><p>  Another aspect of the BBC site is the logic that goes into requesting content, which Clark calls the &#34;business layer&#34;. Content is provided to the web rendering layer via a REST API, and a solution called Fast Agnostic Business Layer &#34;allows different teams to create their own business logic,&#34; he said, so that different requirements are met while still sharing the same system for things like access control and caching. Clark didn&#39;t say much about how the content itself is stored, though he promised to return to this topic in future posts.</p><p>BBC网站的另一个方面是请求内容的逻辑，克拉克称之为业务层。他说，内容通过REST API提供给Web渲染层，而一种名为Fast Agnostic Business Layer的解决方案允许不同的团队创建自己的业务逻辑，从而在满足不同需求的同时，仍然共享访问控制和缓存等方面的相同系统。克拉克没有太多地谈论内容本身是如何存储的，尽管他承诺在未来的帖子中会回到这个话题。</p><p>  The WebCore platform uses CI/CD to enable rapid iteration, and Clark showed an example monthly report showing 110 releases or around three per day. Builds take around 3.5 minutes, and the average time from a pull request (when new code is merged) to running it in production was one day and 23 minutes, in this particular month. On average 67 per cent of pull requests were actually merged into the code.</p><p>WebCore平台使用CI/CD来实现快速迭代，Clark展示了一个示例月度报告，其中显示了110个版本，或者说每天大约发布3个版本。构建大约需要3.5分钟，在这个特定的月份，从请求拉入(合并新代码)到在生产中运行它的平均时间是1天23分钟。平均而言，67%的拉取请求实际上合并到了代码中。</p><p>    Great work? Comments on Hacker News show that opinions vary. &#34;Running a site the size of the BBC on Lambda is nothing short of an exuberant waste of a government-subsidized budget, it&#39;s absolutely crazy. Lambda VM time has a massive markup compared to regular compute... IMHO this is the epitome of serverless gone wrong,&#34;  said one.</p><p>干得好吗？黑客新闻上的评论显示，人们的看法各不相同。在Lambda上运营一个英国广播公司(BBC)规模的网站简直就是对政府补贴预算的巨大浪费，这绝对是疯了。与常规计算相比，Lambda虚拟机时间有很大的提升……。一位网友说：我看，这就是无服务器出错的缩影。</p><p>  Another  comment from John Leach, who runs a headline aggregation site called News Sniffer, said that the generated HTML is not easy to analyze. &#34;I run the News Sniffer project which has to parse BBC News pages and I knew about this rollout a few weeks ago when the HTML all changed format completely and my parsers broke. As a side note, the new HTML is way more complicated and much harder to parse than before – I know the aim isn&#39;t to help parsing for content, but I was still saddened to see how it&#39;s ended up.&#34;</p><p>约翰·利奇(John Lach)经营着一家名为News Sniffer的头条聚合网站，他的另一条评论说，生成的HTML很难分析。我运行的是News Sniffer项目，它必须解析BBC新闻页面。几周前，当HTML完全改变了格式，我的解析器崩溃时，我就知道了这个功能的推出。顺便说一句，新的HTML比以前复杂得多，也更难解析--我知道它的目的不是帮助解析内容，但看到它的结局，我仍然感到难过。</p><p>  There is also curiosity about unanswered questions. What is the cost impact of moving from on-premises to AWS? What is the cost impact of Lambda versus using EC2? Why, if the caching and content delivery network is working as expected, are 2,000 lamdbas a second required?</p><p>还有人对悬而未决的问题感到好奇。从内部部署迁移到AWS会带来什么成本影响？与使用EC2相比，Lambda对成本有何影响？如果缓存和内容交付网络像预期的那样工作，为什么还需要2,000个lambas呢？</p><p>      The BBC&#39;s Matthew Clark got in touch to say: &#34;Although EC2 Lambda compute cost is higher, the amount you need is less, offsetting this.&#34; He added, somewhat mysteriously since EC2 can  autoscale, that: &#34;With EC2, we provision web servers with plenty of capacity to handle sudden traffic changes (e.g. due to breaking news). Whereas with Lambda, we only pay for what we actually use.&#34;</p><p>BBC的马修·克拉克(Matthew Clark)联系到：尽管EC2的Lambda计算成本更高，但你需要的量更少，这抵消了这一点。他补充道，由于EC2可以自动缩放，所以有点神秘地补充道，有了EC2，我们为网络服务器提供了足够的容量来处理突然的流量变化(例如，由于突发新闻)。而在Lambda，我们只为我们实际使用的东西付费。</p><p>  To the question of why the org didn&#39;t use the opportunity of server-side rendering to deliver more human-readable HTML that would be better for parsing and accessibility tools, he responded: &#34;The web page HTML looks different as it&#39;s largely generated by the framework used (React). The BBC has a very high bar for accessibility and performance, and we continue to test the site to ensure that it works well across browsers and screen readers.&#34; Lastly, we asked why, if the caching and content delivery network was working as expected, 2,000 Lamdbas a second were required.</p><p>对于为什么该组织没有利用服务器端渲染的机会来提供更多可读的HTML，以便更好地用于解析和可访问性工具，他回答说：网页HTML看起来不同，因为它主要是由使用的框架(REACT)生成的。BBC在可访问性和性能方面有很高的门槛，我们继续测试该网站，以确保它在浏览器和屏幕阅读器之间运行良好。最后，我们问道，如果缓存和内容交付网络像预期的那样工作，为什么每秒需要2000个Lamdbas。</p><p>  Clark claimed: &#34;The Lambdas are essential at handling updates so that the site remains up to date. Each BBC page typically involves multiple simple Lambda executions - the majority of which complete in under 150ms.&#34;</p><p>克拉克声称：Lambdas在处理更新方面至关重要，这样网站才能保持最新状态。每个BBC页面通常包含多个简单的Lambda执行--其中大部分在150ms内完成。</p><p>         The Register - Independent news and views for the tech community. Part of Situation Publishing</p><p>The Register-独立于科技界的新闻和观点。情况发布的一部分</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.theregister.com/2020/11/04/bbc_embraces_aws_serverless/">https://www.theregister.com/2020/11/04/bbc_embraces_aws_serverless/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/改用/">#改用</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/switch/">#switch</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/bbc/">#bbc</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>