<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>与四元数的旋转 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">与四元数的旋转 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-03 23:00:17</div><div class="page_narrow text-break page_content"><p>四元数是4维复杂的数字，它有四个组件，其中三个是＆＃34;想象中的＆＃34; 部分。 $$ q = a + b \ textrm {i} + c \ textrm {j} + d \ textrm {k} $$ $$ q =（b，c，d，a）$$ $$ $$ \ textrm {i} ^ {2} = \ textrm {j} ^ {2} = \ textrm {k} ^ {2} = \ textrm {i} \ textrm {} \ textrm {j} \ textrm {k} =  -  1 $$  typedef联合{float q [4]; struct {float x; 浮子y; 浮子Z; 浮动w; };}四元数;  四个组件通常是有序的\（w，x，y，z \），但我喜欢在最后放置\（w \）。  四元数基本上是4维向量，因此它具有幅度（或规范或长度）：  $$ || q || = \ Sqrt {x ^ {2} + y ^ {2} + z ^ {2} + w ^ {2} + w ^ {2}} $$$$$$$$$$$一种单位四分之一（凌乱的四元数）（1 \） ）表示在3D空间中的旋转。  几何上，我们还可以考虑\（（0，0，0，-1）\），因为它对应于没有旋转。  缩放四元数正在将每个组件乘以实数（标量）： </p><p>四元数乘法ISN＆＃39; t换向（\（q_ {1} .q_ {2} \ ne q_ {2} .q_ {1} \））。如果我们想应用旋转\（q_ {1} \）那么旋转\（q_ {2} \），所得到的旋转\（q_ {3}）是：</p><p>$$ Q_ {3} = q_ {2} .q_ {1} $$ $$ q_ {1} = a + b \ textrm {i} + c \ textrm {j} + d \ textrm {k} $$$ $ q_ {2} = e + f \ textrm {i} + g \ textrm {j} + h \ textrm {k} $$$$$ \ begin {sealth *} q_ {1} .q_ {2} =（ae -bf-cg-dh）+（af + be + ch-dg）\ textrm {i} + \\（ag-bh + ce + df）\ textrm {j} +（ah + bg-cf + de）\ textrm {k} \ neg {align *} $$四半管quat_mul（四元数a，四元数b）{return（四元数）{aw * bx + ax * bw + ay * bz  -  az * by，aw * by  -  ax * bz + ay * bw + az * bx，aw * bz + ax * by  -  ay * bx + az * bw，aw * bw  -  ax * bx  -  ay * by  -  az * bz};}</p><p>  我们使用四元数而不是欧拉角度表示旋转几个原因：</p><p>  我们仅使用四元数表示对象的方向，然后我们将其乘以另一个四元数来旋转它。</p><p> 然而，直接以四元轴形式写入旋转.T真的直观，我们所做的是将欧拉角转换为四元数，然后使用它来旋转。</p><p> 如果我们在Zyx（偏航 - ＆gt; roll; roll; roll，我们可以选择任何顺序，但必须保持一致），我们可以将它转换为如下四元数：</p><p>$$ q = \ begin {bmatrix} \ sin（x / 2）\ cos（y / 2）\ cos（z / 2） -  \ cos（x / 2）\ sin（y / 2）\ sin（z / 2）\\\ cos（x / 2）\ sin（y / 2）\ cos（z / 2）+ \ sin（x / 2）\ cos（y / 2）\ sin（z / 2）\\\ cos（x / 2）\ cos（y / 2）\ sin（z / 2） -  \ sin（x / 2）\ sin（y / 2）\ cos（z / 2）\\ cos（x / 2 ）\ cos（y / 2）\ cos（z / 2）+ \ sin（x / 2）\ sin（y / 2）\ sin（z / 2）\ end {bmatrix} $$ typedef联盟{float v [ 3]; struct {float x;浮子y;浮子Z; Vector3;四元数euler_to_quat（Vector3 E）{float cx = cos（e.x / 2）; float sx = sin（e.x / 2）; Float Cy = COS（例如/ 2）;浮子sy = sin（例如/ 2）; Float CZ = COS（E.Z / 2）; float sz = sin（e.z / 2）;返回（季芯）{SX * CY * CZ  -  CX * SY * SZ，CX * SZ，CX * CY * SZ  -  SX * SY * CZ，CX * CY * CZ + SX * SY * sz};} </p><p>转换obj; obj.position =（vector3）{0，0，0}; obj.scale =（丝锥）{1,1,1,1}; obj.rotation = quat_id（）; //最初是我们的对象ISN＆＃39; t旋转//通过y anderobj.rotation = quat_mul（euler_to_quat（euler_to_quat（euler_to_quat（（vector3）{0，pi / 4,0}），obj.rootation）旋转对象。 //通过PI / 4再次旋转，使其围绕Yobj.rotation = Quat_mul（euler_to_quat（euler_to_quat（（vector3）{0，pi / 4,0}），obj.rotation）;</p><p>   在进行3D渲染时，我们通常将MVP（模型视图投影）矩阵传递给着色器，以便在场景中查看我们的对象：</p><p>$$ \ textit {mvp} = m _ {\ textit {projection}}。m _ {\ textit {view}}。m _ {\ textit {model}} $$ $$ m _ {\ textit {model}} = m _ {\ Textit {scale}}。m _ {\ textit {rotate}}。m _ {\ textit {translate}} $$ $$ q =（x，y，z，w）$$$$ m_ {\ textit {rotate}} = \ begin {bmatrix} 1-2yy-2zz＆amp;＆amp; 2xy-2zw＆amp;＆amp; 2xz + 2yw＆amp;＆amp; 0 \\ 2xy + 2zw＆amp;＆amp; 1-2xx-2zz＆amp;＆amp; 2YZ-2XW＆amp;＆amp; 0 \\ 2xz-2yw＆amp;＆amp; 2YZ + 2XW＆amp;＆amp; 1-2xx-2yy＆amp;＆amp; 0 \\ 0＆amp;＆amp; 0＆amp;＆amp; 0＆amp;＆amp; 1 \ END {BMATRIX} $$图形API（如OPENGL）通常表示列在列 - 主要表示法中的内存中的矩阵，因此我们必须在代码中转换矩阵：</p><p>  typedef联合{float m [16]; struct {float m00;浮子M10;浮动M20;浮子M30; float m01;浮子M11; float m21; float m31;浮动M02;浮动m12; float m22;浮动M32;浮动M03;浮子M13;浮子M23;浮子M33; mat4; mat4 rotate_3d_matrix（四元管q）{float xx = q.x * q.x; float yy = q.y * q.y; float zz = q.z * q.z;返回（MAT4）{1-2 * YY-2 * ZZ，2 * QX * Q.Y + 2 * QZ * QW，2 * QX * QZ-2 * QY * QW，0,2 * QX * QY-2 * qz * qw，1-2 * xx-2 * zz，2 * qy * q.z + 2 * qx * qw，0,2 * qx * q.z + 2 * qy * qw，2 * qy * qz -2 * qx * qw，1-2 * xx-2 * yy，0,0,0,0,1};}</p><p>  $$ Q ^ {*} = ab \ textrm {i} -c \ textrm {j} -d \ textrm {k} $$$ =（q \）的倒数，表示\（q ^ { -  1} \），缀合物除以幅度平方：</p><p>$$ Q ^ { -  1} = \ frac {q ^ {*}} {|| q || ^ {2}} $$四半管quat_inverse（quaternion q）{float m = quat_magnitude（q）;如果（m == 0）返回（四元管）{0,0,0,0}; //避免分割0 m * = m;返回（四元数）{ -  q.x / m，-q.y / m，-q.z / m，q.w / m};}</p><p> 对于单位四元数，缀合物等于逆。通过其逆率在身份十二段中将四元度乘以： </p><p>$$ QQ ^ { -  1} =（0,0,0,1）$$$$ \（q_ {1} \）和\（q_ {2} \）的差异是另一个四元数\（q_ {3 } \）从\（q_ {1} \）旋转到\（q_ {2} \）：</p><p>$$ Q_ {3} = q_ {1} ^ { -  1} .q_ {2} $$ exthernention and quaternion won＆＃39; t非常有用，但我们将使用它们来计算其他稍后函数。</p><p> 给定四元管\（q =（x，y，z，w）\）及其矢量部分\（v =（x，y，z）\），那个四元数的指数也是四元数，它＆＃39 ;由这个公式给出：</p><p>$$ \ exp（q）= \ exp（w）\ begin {pmatrix} \ frac {v_ {x}} {|| v ||} \ sin（|| v ||）\\\ frac {v_ {y }} {|| v ||} \ sin（|| v ||）\\\ frac {v_ {z}} {|| v ||} \ sin（|| v ||）\\\ cos（| | v ||）\ end {pmatrix} $$四半管quat_exp（四元数q）{vector3 v =（vector3）{qx，qy，qz}; float v_m = vector3_magnitude（v）; Vector3 v_n = Vector3_normalize（v）; float sin_v = sin（v_m）; float exp_w = exp（q.w）;返回（四元数）{v_n.x * sin_v * exp_w，v_n.y * sin_v * exp_w，v_n.z * sin_v * exp_w，cos（v_m）* exp_w};}</p><p> 四元数的对数也是四元数，由此公式给出：</p><p>$$$ \ log（q）= \ begin {pmatrix} \ frac {v_ {x}} {|| v ||} \ arccos（\ frac {w} {|| q ||}）\\\ frac {v_ {y}} {|| v ||} \ arccos（\ frac {w} {|| q ||}）\\\ frac {v_ {z}} {|| v ||} \ arccos（\ frac { w}} {|| q ||}）\\\ log（|| Vector3 v_n = Vector3_normalize（v）; float m = quat_magnitude（q）; float a = acos（q.w / m）;返回（四元数）{v_n.x * a，v_n.y * a，v_n.z * a，log（m）};}</p><p>  向权力提高四元素导致该四季度的分数或倍数。 \（Q ^ {2} \）表示\（q \）的旋转的两倍，\（q ^ {\ frac {1} {2}}表示旋转的一半。 </p><p>$$ q ^ {n} = \ exp（n \ log（q））$$可以说是四元数最重要的优势之一，＆＃34; slerp＆＃34;代表球形线性插值。它＆＃39; sa函数，即占用三个参数：四元数\（q_ {1} \），四元数\（q_ {2} \）和从\（0 \）的插值参数\（t \） \（1 \）。它根据\（t \）的值给出了中间旋转。</p><p>$$ \ textrm {slerp}（q_ {1}，q_ {2}，t）= q_ {1}（q_ {1} ^ { -  1} q_ {2}）^ {t} $$四半管quat_slerp（四元数Q1，四元数Q2，浮点T）{T = T＆lt; 0？ 0：T; t = t＆gt; 1？ 1：T;返回quat_mul（q1，quat_pow（quat_mul（quat_inverse（q1），q2），t））;}</p><p> 这是一个动画，显示从欧拉角度划分的立方体（（0，\ frac {5 \ pi} {4}，\ frac {\ pi} {4}）到\（（0,0,0）\ ）：</p><p>   转换obj; quaternion start_rotation = euler_to_quat（（Vector3）{0,5 * pi / 4，pi / 4}）; quaternion target_rotation = euler_to_quat（（Vector3）{0，0，0}）obj.rotation = start_rotation; float t = 0; //主循环时（1）{... obj.rotation = quat_slerp（start_rotation，target_rootation，t）; t + = delta_time; ...} </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://imadr.github.io/rotations-with-quaternions/">https://imadr.github.io/rotations-with-quaternions/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/旋转/">#旋转</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/rotations/">#rotations</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/float/">#float</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1061327.html"><img src="http://img2.diglog.com/img/2021/5/thumb_424b1a71f05fe061c511a46f3c5ea1ee.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1061327.html">购买失败的创业时间，重新创建工程过程 </a></div><span class="my_story_list_date">2021-5-8 0:24</span></div><div class="col-sm"><div><a target="_blank" href="/story/1059084.html"><img src="http://img2.diglog.com/img/2021/4/thumb_e5b859ec61acc6a5951a22571ad7d898.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1059084.html">基本音乐理论在〜200行Python中 </a></div><span class="my_story_list_date">2021-4-19 22:11</span></div><div class="col-sm"><div><a target="_blank" href="/story/1058560.html"><img src="http://img2.diglog.com/img/2021/4/thumb_eab0b38a3973ca3056ae568c78a997cd.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1058560.html">大脑'旋转'记忆，以拯救他们从新的感觉中 </a></div><span class="my_story_list_date">2021-4-16 2:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1052924.html"><img src="http://img2.diglog.com/img/2021/3/thumb_8ad6606156d9edbd375d428d82bad131.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1052924.html">新的SWAT无人机粉碎了Windows，打开了门，与嫌疑人谈判 </a></div><span class="my_story_list_date">2021-3-17 12:7</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>