<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>PostgreSQL中的分层结构 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">PostgreSQL中的分层结构 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-26 00:27:51</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/c0b54528ff75c73bb10729e0f7e49f9e.jpg"><img src="http://img2.diglog.com/img/2021/6/c0b54528ff75c73bb10729e0f7e49f9e.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>它＆＃39; s常见模式：启动时的数据库开发人员可能位于其公司工程团队的产品小组。在一家百货商店，鞋是一个衣服的子类别，而你最喜欢的热水瓶可能在旅游部门。</p><p> 在任何GitHub组织中，团队中的团队中有团队。在任何大型百货商店，有些类别嵌套。在任何食谱书中，有很多方法可以对食物进行分类。</p><p>   杰克（我的男朋友）和我一直在探索兴趣和纯粹的怪物的关系数据库概念。这是一个有趣的问题，我给了他，我们必须一起工作。我们想要分享很有趣！我们赢得了与PostgreSQL安装，安全，设置，Blah Blah在这时击败了灌木丛，让＆＃39;刚刚有一些纯粹的数据库乐趣几分钟！</p><p>  处理大量读取和少量写入小到中等量的键（在这种情况下，文本字段），每个键可能具有对父密钥的引用。</p><p> 在这个具体的例子中，我们将复制团队结构。从一些小型组织内存的团队开始，每个团队都有一个名称，可能是父母：</p><p>    对于此练习，路径的确切格式并不重要。 HTML字符串，逗号分隔的列表或任何有序集合是可接受的。</p><p>   对于第一个解决方案，请确保＆＃39;熟悉空，主键和外键的想法。我们＆＃39; LL需要这些来建立队伍和父母之间的安全，有效的联系。 </p><p>我们＆＃39; ll然后使用物化视图来创建一种时间点小组结构的缓存。我们＆＃39; ll使用在写入原始表时触发的函数刷新此功能。</p><p> 对于下一个解决方案，我们＆＃39; LL探索了可以解决我们的需要的量身定制的Ltree类型，而无需第一解决方案的复杂机制。此外，该解决方案提供了一些有用的功能，如子路径。</p><p>  请确保您的数据库位于UTF-8中！我们今天将探索国际文本。如果您＆＃39;重新确定，让＆＃39; s创建一个新的空数据库，然后继续并连接到它。</p><p>   创建表团队（名称文本唯一不是null主键，父文本引用团队（名称））;创建物化视图team_structure与递归teams_cte（姓名，父，路径）一样（选择团队。名称，团队。父，父母，父母[团队） 。名称]来自团队的团队。父级是空联合所有选择团队。名称，团队。父，array_append（teams_cte。姓名）来自Teams_cte，团队团队的团队。父= teams_cte。名称）选择*来自teams_cte;创建函数refresh_team_structure（）返回触发语言PLPGSQL AS $$开始刷新刷新物流化View Team_structure;回归新;结束; $$;在更新或插入或删除或截断或截断Coundsexecute过程refresh_team_structure（）后创建触发器trigger_update_team_structure;</p><p>  加载示例数据，包括几个复杂的案例，如空格，重音器和中文脚本：</p><p> 插入团队（名称，父母）值（＆＃39;工程＆＃39;，null），（＆＃39;geschäftstätigkeit＆＃39;＆＃39;工程＆＃39;），（＆＃39;产品＆＃39 ;，＆＃39;工程＆＃39;），（＆＃39;实习生＆＃39;＆＃39;产品＆＃39;），（＆＃39;管理＆＃39;，null），（＆＃39;人力资源＆＃39;，＆＃39;管理＆＃39;），（＆＃39;金融＆＃39;＆＃39;行政＆＃39;），（＆＃39;营销＆＃39;，null），（ ＆＃39;物流＆＃39;，null），（＆＃39;国际化＆＃39;，null）;</p><p>           ＆gt;解释分析Select * from Team_structure在哪里＆＃39;产品＆＃39; =任何（路径）; SEQ扫描Team_structure（成本= 0. 00 .. 24. 63行= 3宽度= 96）（实际时间= 0。015 .. 0。016 Rows = 2 LOOPS = 1）过滤器：（ ＆＃39;产品＆＃39; :: text =任何（路径））筛选删除的行：8规划时间：0。 047 MSExecution时间：0。 026女士 </p><p>如果您的PostgreSQL是正式分布式包，LTREE是一个扩展，您可能已经拥有了。 Ltree类型上的PostgreSQL文档非常汇总，所以Let＆＃39;不只是重复它们，让＆＃39;解决我们的问题！</p><p>  标签是一系列字母数字字符和下划线（例如，在C语言环境中允许字符A-ZA-Z0-9_）。标签必须少于256个字节。</p><p> 虽然长度限制并不可怕，但缺乏对完整的UTF-8谱的支持，例如空间甚至是工程或Geschäftstätigkeit等空间甚至单词真的是限制性的！</p><p> 所以，当我们创建我们的表时，让＆＃39; s给它一个名称列，我们可以存储任何我们想要的e̘̫̩̼͝x̢o̵̞͙̰͕t͈̼̺͍̥i̻͉̺͚͕c̶̥̘͖̪̤̜文本。我们＆＃39; LL还需要一个包含在路径中的预期片段的块柱。</p><p> 创建扩展如果不存在Ltree;创建表团队（名称文本不是null，slug text not null检查（slug〜*＆＃39; ^ [a-za-z0-9 _] {1,255} $＆＃39;），path ltree唯一不是null主键） ;</p><p>   插入团队（名称，SLUG，PATH）值（＆＃39;工程＆＃39;＆＃39;工程＆＃39;，＆＃39;工程＆＃39;），（＆＃39;geschäftstätigkeit＆＃39;， ＆＃39;运营＆＃39;，＆＃39;工程。工程和＃39;），（＆＃39;产品＆＃39;，＆＃39;产品＆＃39;＆＃39;工程和＃39; ），（＆＃39;实习生＆＃39;＆＃39;实习生＆＃39;，＆＃39;工程。工程。interngrount.interns＆＃39;），（＆＃39;行政＆＃39;，＆＃39;行政＆ ＃39;，＆＃39;行政＆＃39;），（＆＃39;人力资源＆＃39;＆＃39; human_resources＆＃39;，＆＃39;行政管理.human_resources＆＃39;），（＆＃39 ;金融＆＃39;，＆＃39;金融＆＃39;，＆＃39;行政管理。金融和＃39;），（＆＃39;营销＆＃39;＆＃39;营销＆＃39;营销＆＃39;），（＆＃39;物流＆＃39;＆＃39;物流＆＃39;，＆＃39;物流＆＃39;），（＆＃39;国际化＆＃39;，＆＃39 ;国际化＆＃39;，＆＃39;国际化＆＃39;）;</p><p>          ＆gt;解释分析从路径@＆＃39的团队中选择*;产品＆＃39; ; SEQ扫描团队（成本= 0. 00 .. 18. 13行= 1宽= 96）（实际时间= 0。013 .. 0。014 Rows = 2 LOOPS = 1）过滤器:(路径@＆＃39 ;产品＆＃39; :: ltxquery）筛选的行：8规划时间：0。 055 MSExecution时间：0。 029女士 </p><p>如您所见，此问题可以以几种不同的方式解决此问题，其中一些基本的SQL概念一起使用，或者已经存在于现有类型！ 不要让限制让你失望，你可以克服它们！  我希望这已经给了你一些关于你可以用数据库做的新事物的想法！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://hoverbear.org/blog/postgresql-hierarchical-structures/">https://hoverbear.org/blog/postgresql-hierarchical-structures/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/分层/">#分层</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/团队/">#团队</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>