<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>DKIM：展示你的隐私</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">DKIM：展示你的隐私</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-03 09:08:41</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/978a28b16398bee026569b26fee6df78.png"><img src="http://img2.diglog.com/img/2020/11/978a28b16398bee026569b26fee6df78.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>If you’re like most people, there’s a good chance that it’s been years since you’ve sent an email that wasn’t cryptographically signed. You don’t use PGP, you say? Well, even if  you are not signing your email, your provider is almost certainly doing it for you. Plausible deniability has been tossed aside in the name of stopping spam, but it doesn’t have to be.</p><p>如果你和大多数人一样，很有可能你已经多年没有发送过没有加密签名的电子邮件了。你说你不用PGP吗？嗯，即使你没有在你的电子邮件上签名，你的提供商几乎可以肯定会为你签名。以阻止垃圾邮件的名义，似是而非的否认已经被抛在一边，但它并不是必须的。</p><p>  DKIM, originally standardized in 2007 by  RFC 4871, now has near universal [1] adoption. To quote the RFC, the goal behind the protocol is to “permit a signing domain to assert responsibility for a message, thus protecting message signer identity and the integrity of the messages they convey”. It’s one of several technologies used prevent the sender identity information in email from being spoofed [2]. Anti-spam systems use it to help determine whether to consider the reputation of a domain name when making a processing decision.</p><p>DKIM最初由RFC4871于2007年标准化，现在几乎得到了普遍采用。引用RFC的话说，协议背后的目标是“允许签名域断言对消息的责任，从而保护消息签名者的身份和他们所传达的消息的完整性”。它是用来防止电子邮件中的发件人身份信息被欺骗的几种技术之一[2]。反垃圾邮件系统使用它来帮助确定在做出处理决策时是否考虑域名的声誉。</p><p>  While  DKIM was designed to be useful for spam prevention, the cryptographic signatures it uses have quietly made a property called “ non-repudiation” the new normal for email. The term is used in in contract law — for example if someone claims “that’s not my signature”, they could be said to be “repudiating” the authenticity of the document. In the case of email, the impact is that if you have a copy of an email in its original format including full headers (for example, an email spool dump) you can check the signature. The extent to which this is a reliable means of verification varies depending on the circumstances — keys short enough to be cracked used to be common, and in some cases straight-up theft of the private keys is plausible.</p><p>虽然DKIM被设计成对防止垃圾邮件有用，但它使用的加密签名已经悄悄地使一种名为“不可否认”的属性成为电子邮件的新常态。这一术语在合同法中使用-例如，如果有人声称“那不是我的签名”，他们可以说是在“否认”文件的真实性。对于电子邮件，其影响是如果您拥有包含完整标题的原始格式的电子邮件副本(例如，电子邮件假脱机转储)，则可以检查签名。这是一种可靠的验证手段的程度因情况而异-短到可以被破解的密钥过去很常见，在某些情况下直接窃取私钥是可能的。</p><p>  Meanwhile, secure messaging tools like  OTR and its successors have taken the approach of explicitly providing “deniable encryption”. The  state of the art allows a sender, given a recipient’s public key, to craft a fake transcript apparently between the two of them that will pass cryptographic checks. This is generally fine for users of these apps because they know what they said. To the best of my knowledge, there is nowhere this creates a legal “get out of jail free” card. All it really does is ensure the users of these tools aren’t  reducing their deniability by using the tool. This is an issue where  DKIM really fails its users, and I’m apparently not the only one that feels this way.</p><p>与此同时，像OTR及其后继者这样的安全消息传递工具已经采取了明确提供“可否认加密”的方法。最先进的技术允许发送者在给出接收者的公钥的情况下，伪造一份显然是在他们两人之间通过密码检查的抄本。对于这些应用程序的用户来说，这通常是不错的，因为他们知道自己说了什么。据我所知，这并不能创造一张合法的“出狱”卡。它真正做的就是确保这些工具的用户不会因为使用该工具而降低他们的否认性。这是一个问题，DKIM确实让它的用户失望了，显然我不是唯一一个有这种感觉的人。</p><p>  Apropos of nothing, I really wish Gmail would start publishing its expired DKIM secret keys.</p><p>无关紧要，我真的希望Gmail能开始发布过期的DKIM密钥。</p><p>  A little over three years ago, I started doing exactly that for my domain. Since then, I’ve had a  key rotation script running every day, generating a new key and adding the appropriate record (called a “selector”).</p><p>三年多前，我开始为我的域名这么做。从那时起，我每天都运行一个密钥轮换脚本，生成一个新密钥并添加适当的记录(称为“选择器”)。</p><p>    Each selector remains live for seven days, then is “revoked” by publishing an update blanking the public key portion of the record.</p><p>每个选择器保持存活7天，然后通过发布空出记录的公钥部分的更新来“撤销”。</p><p>    Once another three days pass, the minimal set of  RSA parameters needed to recreate the public and private keys are published in the selector’s “notes” field.</p><p>再过三天，重新创建公钥和私钥所需的最小RSA参数集就会在选择器的“NOTES”字段中发布。</p><p>    The format here is non-standard, as a full RSA private key with all of the redundant data it includes would exceed the 255 character limit for strings stored in DNS [3]. A small Python script is enough to reconstitute everything, though.</p><p>这里的格式是非标准的，因为包含所有冗余数据的完整RSA私钥将超过DNS[3]中存储的字符串的255个字符限制。不过，一个小的Python脚本就足以重新构建一切。</p><p>       When I originally set this up, I was a bit concerned that I’d run into issues with filtering systems trying to validate my sent emails significantly after delivery. Per the RFC:</p><p>当我最初设置这个功能时，我有点担心过滤系统会遇到问题，因为过滤系统试图在投递后显著验证我发送的电子邮件。根据RFC：</p><p>  A signer should not sign with a private key when the selector containing the corresponding public key is expected to be revoked or removed before the verifier has an opportunity to validate the signature. The signer should anticipate that verifiers may choose to defer validation, perhaps until the message is actually read by the final recipient. In particular, when rotating to a new key pair, signing should immediately commence with the new private key and the old public key should be retained for a reasonable validation interval before being removed from the key server.</p><p>当包含相应公钥的选择器预期在验证者有机会验证签名之前被撤销或移除时，签名者不应该使用私钥签名。签名者应该预料到，验证者可能会选择推迟验证，也许直到最终接收者实际阅读了邮件。特别地，当轮换到新的密钥对时，签名应该立即从新的私钥开始，并且旧的公钥应该在从密钥服务器移除之前被保留一段合理的验证间隔。</p><p>  In the process of writing this up, I went through the 24 months of query logs I have. With very few exceptions (most of which were probably my own testing) there were no lookups against selectors other than on the day they were being used, so this doesn’t seem to be a problem in practice.</p><p>在写这篇文章的过程中，我检查了我拥有的24个月的查询日志。除了极少数例外(大多数可能是我自己的测试)，除了使用选择器的那一天之外，没有任何针对选择器的查找，所以这在实践中似乎不是问题。</p><p>  I alluded to it earlier, but I want to be clear — publishing  DKIM private keys like this mainly addresses leaks as a threat model. In a legal dispute, mail server logs and/or stored mail can be subpoenaed if the authenticity of messages is in question. Even in my case, where I have my own mail server on dedicated hardware with full disk encryption at an undisclosed location, most mail I send will be delivered to a server operated by a third party with no incentive to alter logs at the behest of the recipient.</p><p>我之前提到过，但我想说清楚--像这样发布DKIM私钥主要是将泄漏作为一种威胁模型来解决。在法律纠纷中，如果邮件的真实性有问题，可以传唤邮件服务器日志和/或存储的邮件。即使在我的情况下，我在专用硬件上也有自己的邮件服务器，并在一个未公开的位置使用全磁盘加密，我发送的大多数邮件都会被送到由第三方操作的服务器，而不会在收件人的要求下更改日志。</p><p>  It would make for a fascinating experiment for one of the privacy focused email providers to try deploying a key management strategy similar to the one I’ve described in this post.</p><p>对于关注隐私的电子邮件提供商之一来说，尝试部署类似于我在本文中描述的密钥管理策略将是一次有趣的实验。</p><p>  I can’t find any recent public data on this, but Google reported that 87.6% of non-spam emails received by Gmail users had valid DKIM signatures as of Febuary 2016.  https://security.googleblog.com/2013/12/internet-wide-efforts-to-fight-email.html</p><p>我找不到任何关于这方面的最新公开数据，但谷歌报告称，截至2016年2月，Gmail用户收到的非垃圾邮件中有87.6%拥有有效的DKIM签名。Https://security.googleblog.com/2013/12/internet-wide-efforts-to-fight-email.html。</p><p>  The core protocol behind email,   SMTP was designed in the early eighties, and one of the terms it uses is “envelope sender”. This is apt because it originally was not much harder to fake than the return address on a physical envelope.</p><p>电子邮件背后的核心协议SMTP是在80年代初设计的，它使用的术语之一是“信封发件人”。这是恰当的，因为它最初并不比物理信封上的回邮地址更难伪造。</p><p>  The DNS standards provide for storing values longer than 255 characters in a TXT record by simply storing multiple strings in the record, but such records can be annoying to work with in some software.</p><p>DNS标准提供了通过在记录中简单地存储多个字符串来在TXT记录中存储超过255个字符的值，但是在某些软件中使用这样的记录可能会很烦人。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://rya.nc/dkim-privates.html">https://rya.nc/dkim-privates.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/dkim/">#dkim</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/show/">#show</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>