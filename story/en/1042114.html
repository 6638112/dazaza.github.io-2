<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>微小的碎皮转运器 A Tiny Lispy Transpiler</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">A Tiny Lispy Transpiler<br/>微小的碎皮转运器 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-28 07:27:03</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/c100e0a953d2d590ffba262bceea918a.jpeg"><img src="http://img2.diglog.com/img/2020/12/c100e0a953d2d590ffba262bceea918a.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>wax is a tiny language designed to transpile to other languages easily. Currently supported backends:  C,  C++,  Java,  TypeScript,  Python,  C#,  Swift,  Lua, as well as directly to  WebAssembly.</p><p>蜡是一种极小的语言，旨在轻松转换为其他语言。当前支持的后端：C，C ++，Java，TypeScript，Python，C＃，Swift，Lua以及直接到WebAssembly的后端。</p><p>  The goal of wax is to be a &#34;common subset&#34; of most major imperative programming languages. By lacking the unique fancy features in each of these languages and being as boring as possible, wax transpiles to all of them seamlessly, producing outputs that are:</p><p>  蜡的目标是成为＆＃34;常见子集＆＃34;大多数主要的命令式编程语言。由于每种语言都缺乏独特的花哨功能，并且尽可能无聊，因此将所有代码无缝转换成蜡，从而产生以下输出：</p><p> Editable: A human programmer should be able to work from the output even if the original wax source is unavailable.</p><p> 可编辑：即使原始蜡源不可用，程序员也应该能够从输出进行工作。</p><p> Integrable: The output code can be imported as libraries to use with the rest of the target language (in addition to just being runnable alone).</p><p> 可集成：输出代码可以作为库导入，以与其他目标语言一起使用（除了可以单独运行之外）。</p><p> These of course, from the programmers&#39; perspective, come at the cost of losing some of the interesting features offered by other languages. Nevertheless, wax retains the crucial bits for a programming language to be productive.</p><p> 这些当然是来自程序员的因此，以牺牲其他语言提供的一些有趣功能为代价。但是，蜡保留了使编程语言具有生产力的关键要素。</p><p> The syntax of wax is inspired by WebAssembly Text Format (wat), hence the name. Though it uses S-expressions reminiscent of the Lisp family, it is actually quite  imperative and most resemblant of C in its design. The idea of transpiling to many languages is inspired by Haxe.</p><p> Wax的语法受WebAssembly文本格式（wat）的启发，因此得名。尽管它使用的S表达式让人联想到Lisp家族，但实际上它在设计中非常必要，并且与C非常相似。转译为多种语言的想法是受Haxe启发的。</p><p> wax is currently experimental, so there might be bugs as well as aspects to be improved, in which case PR and Issues are very much appreciated.</p><p> 目前，蜡是试验性的，因此可能存在错误以及需要改进的方面，在这种情况下，非常感谢PR和问题。 </p><p>   Newlines and indentations are entirely cosmetic. You can use any type of brackets anywhere ( ()  []  {}). You can mix different types of brackets if you somehow prefer that.</p><p>换行符和缩进完全是修饰。您可以在（（）[] {}）的任何位置使用任何类型的括号。如果您愿意，可以混合使用不同类型的括号。</p><p> [func main [result int] [print   &#34;hello world! &#34;] [return 0]]{func main {result int} {print   &#34;hello world! &#34;} {return 0}}{func main [result int] 	(print   &#34;hello world! &#34;) 	( return  0)}</p><p> [func main [result int] [打印世界您好！ ＆＃34;] [返回0]] {func main {result int} {打印世界！ ＆＃34;} {返回0}} {func main [结果int]（打印＆＃34; hello world！＆＃34;）（返回0）}</p><p>  ;; sort array in-place for index range [lo,hi] inclusive(func qksort_inplace (param A (arr float)) (param lo int) (param hi int)	( if ( &gt;= lo hi) (then		(return)	))	( let pivot float (get A lo))	( let left int lo)	( let right int hi)	(while ( &lt;= left right) ( do		(while ( &lt; (get A left) pivot) ( do			(set left ( + left  1))		))		(while ( &gt; (get A right) pivot) ( do			(set right ( - right  1))		))		( if ( &lt;= left right) (then			( let tmp float (get A left))			(set A left (get A right))			(set A right tmp)			(set left ( + left  1))			(set right ( - right  1))		))	))	(call qksort_inplace A lo right)	(call qksort_inplace A left hi))(func qksort (param A (arr float))	( if (! (# A)) (then		(return)	))	(call qksort_inplace A  0 ( - (# A)  1)))</p><p>  ;;索引范围为[lo，hi]包含在内的就地排序数组（func qksort_inplace（param A（arr float））（param lo int）（param hi int）（if（＆gt; = lo hi）（then（return）） ）（让Pivot浮动（get A lo））（让left int lo）（让right int hi）（while（＆lt; =左右）（do（while（＆lt;（Get A left）枢轴））（do（set左（+左1）））））（同时（＆gt;（获取A右）枢轴）（做（设置右（-右1）））））（如果（＆lt; =左右）（然后（让tmp浮动（左移A））（左移A（右移））（右A集Tmp）（左移（+左1））（右移（-右1））））））））（调用qksort_inplace A右移） （调用qksort_inplace A左hi））（func qksort（参数A（arr float））（if（！（＃A））（then（return）））（调用qksort_inplace A 0（-（＃A）1）））</p><p> As you might have noticed, writing in wax is pretty much like writing an abstract syntax tree directly!</p><p> 您可能已经注意到，用蜡写非常类似于直接编写抽象语法树！</p><p>   wax supports C-like macros, allowing specifying different behavior/branches for each compile target, as well as embedding target code directly.</p><p>   Wax支持类似于C的宏，允许为每个编译目标指定不同的行为/分支，以及直接嵌入目标代码。</p><p> syntax is simple: an expression is always a list of tokens enclosed in parenthesis  (), and the first token is always a keyword/operator. There&#39;re 50 keywords in total.</p><p> 语法很简单：表达式始终是用括号（）括起来的标记的列表，第一个标记始终是关键字/运算符。总共有50个关键字。</p><p> wax does not support OOP (meaning that you get  structs to pack data together, but you cannot blend methods into structs), nor does it support functional programming.</p><p> Wax不支持OOP（意味着您可以将数据打包在一起的结构，但是不能将方法混合到结构中），也不支持函数式编程。 </p><p>  wax is not garbage-collected. However, it does have constructs to facilitate memory management and make leaky bugs less likely. On compile targets that do support garbage collection (e.g. Java, JS), explicit freeing of resources is not required, and theoretically you can ignore memory management altogether if you intend to compile to these targets only. Check out the  Array/Vector/Struct sections in Quickstart for details.</p><p>蜡没有被垃圾收集。但是，它确实具有促进内存管理的结构，并减少了发生漏洞的可能性。在确实支持垃圾回收的编译目标上（例如Java，JS），不需要显式释放资源，并且从理论上讲，如果仅打算编译到这些目标，则可以完全忽略内存管理。请查看快速入门中的“数组/向量/结构”部分以获取详细信息。</p><p>  This repo contains a reference implementation of wax called  waxc, written from scratch in C99.</p><p>  此存储库包含一个称为蜡的参考实现，该蜡由C99从头开始编写。</p><p> It seems pretty fast. Compiling a 700 lines file takes 0.015 seconds on Macbook Pro 2015. Comparison: the output TypeScript, which is also 700 lines long, took  tsc 1.5 seconds to compile.</p><p> 看来挺快的。在Macbook Pro 2015上，编译700行文件需要花费0.015秒。比较：输出的TypeScript也是700行，花费了tsc 1.5秒来编译。</p><p> Additionally, it can emit a very detailed and low-level syntax tree in JSON format. (If your favourite language is not a supported wax target yet, it&#39;s not too hard to go from this file and write a code generator :)</p><p> 此外，它可以以JSON格式发出非常详细的低级语法树。 （如果您尚不支持您喜欢的语言，那么从该文件中编写代码生成器就不太困难了：）</p><p> _____ |||&#39; | |&#39;&#39; | |_WAX_| Compiler built Oct 27 2020 USAGE: waxc [options] code.wax OPTIONS: --c path/out.c transpile to c --java path/out.java transpile to java --ts path/out.ts transpile to typescript --py path/out.py transpile to python --cs path/out.cs transpile to c# --cpp path/out.cpp transpile to c++ --swift path/out.swift transpile to swift --lua path/out.lua transpile to lua --wat path/out.wat transpile to webassembly --json path/out.json syntax tree to JSON file --tokens print tokenization --ast print abstract syntax tree--silent don&#39;t print info --help print this message</p><p> _____ |||＆＃39; | |＆＃39;＆＃39; | | _WAX_ |编译器于2020年10月27日建成用法：waxc [options] code.wax选项：--c path / out.c转换为c --java path / out.java转换为java --ts path / out.ts转换为打字稿- -py path / out.py转换为python --cs path / out.cs转换为c＃--cpp路径/out.cpp转换为c ++ --swift路径/out.swift转换为swift --lua路径/ out。 lua转换为lua --wat path / out.wat转换为webassembly --json path / out.json语法树到JSON文件-令牌打印标记化--ast打印抽象语法树-静默不打印信息--help打印此消息</p><p>  To compile the  fib.wax example included in the example folder to C, and print the abstract syntax tree to terminal:</p><p>  要将示例文件夹中包含的fib.wax示例编译为C，并将抽象语法树打印到终端：</p><p>    Compile to all targets and compile all outputs with target languages&#39; compilers and run all outputs of target languages&#39; compilers:</p><p>    编译为所有目标并使用目标语言编译所有输出。编译器并运行目标语言的所有输出。编译器： </p><p> ./waxc examples/fib.wax \--c fib.c --java fib.java --ts fib.ts --py fib.py --cs fib.cs --swift fib.swift --lua fib.lua ;gcc fib.c ; javac fib.java ; tsc fib.ts ; csc fib.cs ; swiftc fib.swift ;./a.out ; java fib ; node fib.js ; python fib.py ; mono fib.exe ; ./fib ; lua fib.lua ;</p><p>./waxc示例/fib.wax \-c fib.c --java fib.java --ts fib.ts --py fib.py --cs fib.cs --swift fib.swift --lua fib lua; gcc fib.c; javac fib.java; tsc fib.ts; csc fib.cs; swiftc fib.swift; ./ a.out; java fib;节点fib.js; python fib.py;单fib.exe; ./fib; lua fib.lua;</p><p>    waxc also supports compiling to WebAssembly Text Format ( .wat). As the output needs to be further transformed to binary ( .wasm) and wrapped with JS for calling, there&#39;s a couple more steps:</p><p>    waxc还支持编译为WebAssembly文本格式（.wat）。由于需要将输出进一步转换为二进制（.wasm）并用JS包装以便进行调用，因此需要执行以下两个步骤：</p><p>     3.  Optional: Optimize with  wasm-opt from  binaryen for massive speedups, since (currently)  waxc is not an optimizing compiler.</p><p>     3.可选：由于（当前）waxc并不是一个优化的编译器，因此使用来自binaryen的wasm-opt进行优化以实现大幅度的加速。</p><p>  4. Now that the  wasm is ready, you probably need some JS to call it, which basically involves  WebAssembly.instantiate(bytes,imports) with  console.log (and  Math if you used  (@include math)) as  imports. Luckily you can find a readymade wrapper in  tools/waxwasmwrap.js. To use:</p><p>  4.现在wasm已经准备好了，您可能需要一些JS来调用它，这基本上涉及WebAssembly.instantiate（bytes，imports）与console.log（如果使用了@，则使用Math）作为导入。幸运的是，您可以在tools / waxwasmwrap.js中找到现成的包装器。使用方法：</p><p>               make em. Compile it with emscripten as a node.js app. (You might need to edit the rule based on how/when/where you installed emscripten.)</p><p>               使他们。使用emscripten作为node.js应用程序进行编译。 （您可能需要根据安装脚本的方式/时间/位置来编辑规则。）</p><p> make emlib. Compile it as a javascript library with emscripten, without filesystem dependencies. This is what powers the  online playground.</p><p> 使emlib。将其编译为带有emscripten的javascript库，而无需依赖文件系统。这就是在线游乐场的动力。</p><p>     Now that the compiler is compiled, head over to  QUICKSTART.md for a tour of language features!</p><p>     既然编译器已经编译好了，请前往QUICKSTART.md来浏览语言功能！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/LingDong-/wax">https://github.com/LingDong-/wax</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/转运/">#转运</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/lispy/">#lispy</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fib/">#fib</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>