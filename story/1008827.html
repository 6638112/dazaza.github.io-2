<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Unix管道改进Chromecast播放</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用Unix管道改进Chromecast播放</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-06-29 12:39:59</div><div class="page_narrow text-break page_content"><p>从YouTube投射到Chromecast时，音频播放有时会跳过并断断续续。此问题与视频质量、FPS或互联网连接无关。尝试观看某些视频肯定会导致Chromecast出现播放问题。</p><p>根据这条帖子，播放问题只出现在Chromecast的最新也是最后一次固件更新中。在过去，成功播放视频是可能的，而播放下载的YouTube视频则完全消除了这个问题。这个问题只存在于使用YouTube应用程序播放某些视频时。</p><p>考虑到这个问题只出现在YouTube应用程序上，你可以下载一段视频并通过Castnow或Catt播放，完全跳过YouTube应用程序。</p><p>#！/usr/bin/env bash export url=&#34；https://youtu.be/Kas0tIxDvrg&#34；函数CAST(){url=&#34；$1&#34；filename=$(youtube-dl--get-filename&#34；$url&#34；)youtube-dl&#34；$url&#34；#等待下载文件Castnow&#34；$filename&#34；</p><p>但不得不跳过使用YouTube应用程序进行选角已经是一个笨拙的解决方案，在播放之前下载每段视频的用户体验更差。即时播放和短暂流是2020年令人愉快的视频流体验的要素，而本解决方案既不实现这两种功能，也不实现这两种功能。</p><p>因为youtube-dl允许我们输出到stdout，所以如果我们可以将它的stdout连接到一个转换应用程序上，我们就可以模拟我们期望的即时播放和短暂视频，因为我们不必等待下载整个文件。</p><p>不幸的是，Castnow和Catt不会从stdin进行强制转换。您需要向它传递要从中进行转换的文件位置。</p><p>通过进程替换，Bash为我们提供了一种创建临时匿名管道的便捷方法。此方法既高效又并发，使此原语成为构建手头问题解决方案的合适选择。读取管道的进程会阻塞，直到另一个进程打开管道进行写入。写入管道的进程将挂起，直到另一个进程读取管道的缓冲区。匿名管道将自动删除，当手动删除时，其从属进程将终止。</p><p>在使用进程替换时，进程的stdout连接到匿名管道。可以从文件描述符中访问该管道，并将管道的位置提供给调用进程。</p><p>$ECHO&lt；(ECHO&34；内容发送到PIPE&34；)/dev/fd/63$CAT&lt；(ECHO&34；内容发送到PIPE&#34；)发送到PIPE的内容。</p><p>在上面的示例中，&lt；(命令)语法是我们在Bash中调用流程替换的方式。命令的输出被写入匿名管道，并为调用进程提供访问该管道的文件描述符的位置。</p><p>上面的命令将使用VLC在本地播放YouTube视频，并说明进程替换可以用于我们的用例。</p><p>但是，当我们尝试使用Castnow时，我们不能从管道进行强制转换：</p><p>我们知道我们可以在本地使用VLC，并且VLC还允许您使用Chromecast的IP地址强制转换为Chromecast。</p><p>函数cast_vlc(){path=&#34；$1&#34；#获取chromecast.lan主机IP=$(dig+short chromecast.lan|ail-n 1)vlc-i ncurses\--sout&#39；#chromecast&#39；\--sout-chromecast-ip=&#34；$ip&#34；\--demux-filter=demux_Chromecast\&#34；(youtube-dl-q-o-&#34；$url&#34；)。</p><p>另外，我们将VLC的stdin挂接到/dev/tty，这样即使从脚本调用函数，我们也可以使用ncurses接口。</p><p>它只显示文件描述符，几乎不显示视频本身。我不是那个的粉丝。</p><p>我们可以使用命名管道，而不是使用匿名管道。命名管道类似于匿名管道，不同之处在于它们既不是匿名的(它们有名字)，也不是短暂的。命名管道仍然给我们带来匿名管道给我们带来的效率和并发优势，但是Bash在涉及到命名管道时缺乏进程替换所具有的语法优势。</p><p>这就是我们创建命名管道、写入它们、读取它们和删除它们的方式。</p><p>$mkfio OUR PIPE$ECHO&34；&gt；OUR PIPE&amp；$CAT OUR PIPE管道中的内容$rm OURPIPE中的内容。</p><p>我们可以为命名管道提供与YouTube视频相同的名称，这样，VLC界面将显示我们正在观看的内容的名称。</p><p>函数cast_ytdl(){url=&#34；$1&#34；#创建临时命名管道#为什么？因为如果我们只使用进程替代filename=$(youtube-dl--get-filename&#34；$url&#34；)path=&#34；/tmp/$filename&#34；mkfio&#34；$path&#34；#在后台下载，所以VLC会显示文件描述符路径，所以推送到命名管道youtube-dl-q-o-&#34；$url&#34；&gt；&#34；$path&。从命名管道CAST_VLC&#34；$PATH&#34；#CLEANUP进程和命名管道KILL-9&#34；$PID&#34；&amp；&&gt;/dev/null}cast_ytdl&#34；$url&#34；</p><p>我们需要使用mkfio手动创建命名管道，在后台运行进程时将youtube-dl的stdout重定向到命名管道，然后在通过VLC从其强制转换后清理该进程，否则它可能会在后台徘徊。这些任务中的每一项都将使用进程替换自动为我们处理。</p><p>管道、匿名管道和命名管道也因为它们的行为方式而被称为另一个名称：先进先出(FIFO)或先进先出(First In First Out)。写入管道的内容按照先进先出的顺序从管道读取。此行为很好地映射到视频流。</p><p>虽然您可以像处理文件一样与匿名和命名管道交互，但接口与标准文件不是1：1的。您不能在管道中向前或向后查找()，只能读取下一个向前的值。对于我们的用例，这意味着我们不能在流视频中向前或向后跳转。我们只能播放、暂停或停止视频。</p><p>这对我来说不是问题，但是如果对你有问题的话，这是可以减轻的。我能想到的第一个解决方案是通过youtube-dl写入临时文件并从中读取。或者，临时假脱机文件可以充当管道的缓冲区，这样您就可以通过缓冲区查找()，但是缓冲区本身与普通文件不同，它是短暂的。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://alexdelorenzo.dev/linux/2020/03/14/pipes">https://alexdelorenzo.dev/linux/2020/03/14/pipes</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/chrome/">#chrome</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/unix/">#unix</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/pipes/">#pipes</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/管道/">#管道</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1008220.html"><img src="http://img.diglog.com/img/2020/6/thumb_79b51790302e5f3acb9759218a39d110.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008220.html">
苹果将允许你将Google Chrome扩展移植到Safari上</a></div><span class="my_story_list_date">2020-6-26 0:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1008138.html"><img src="http://img.diglog.com/img/2020/6/thumb_24a8ed8045ab7f9671d2be8e240ece3a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008138.html">宏基新旗舰Chromebook为全铝Spin 713</a></div><span class="my_story_list_date">2020-6-25 18:52</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007300.html"><img src="http://img.diglog.com/img/2020/6/thumb_b4c6be93bf2ce123c3a55b02a7b91879.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007300.html">采用此Windows功能后，Chrome可能不会占用您的所有内存</a></div><span class="my_story_list_date">2020-6-20 2:21</span></div><div class="col-sm"><div><a target="_blank" href="/story/1007210.html"><img src="http://img.diglog.com/img/2020/6/thumb_80eec40ca253500b55cbb99202674be7.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1007210.html">Windows 10功能将解决Google Chrome的最大问题</a></div><span class="my_story_list_date">2020-6-19 10:10</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>