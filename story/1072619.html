<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>LatencyFlex：减少游戏延迟的新方法</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">LatencyFlex：减少游戏延迟的新方法</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-01-10 22:39:05</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2022/1/64a5f78ebf9c6cf5cfbb4f1429c60163.png"><img src="http://img2.diglog.com/img/2022/1/64a5f78ebf9c6cf5cfbb4f1429c60163.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>这篇文章描述了LatencyFlex的内部工作，这是一组图书馆，实现了视频游戏的延迟减少，作为NVIDIA反射的供应商替代替代品。</p><p>一段时间后，我遇到了谷歌的精彩拥堵控制算法，BBR。 BBR旨在解决网络中的长期问题：BufferBloat。 BufferBloop的原因是之前，拥塞控制依赖于数据包丢失，这是缓冲区已满的信号。因此，这些算法最终可能会在最坏情况下运行。但事实证明，拥有挤塞的另一个信号，可以在达到满带宽时立即使用，并且它被称为延迟。 BBR利用此度量来实现最佳操作点的拥塞控制。</p><p>在这篇文章中，我将通过将BBR的行为分解为两部分，然后描述如何在LatencyFlex中使用这些想法。</p><p>为了测量MAX带宽，BBR周期性地进入“探测带宽”模式：它暂时增加了分组发送速率，从而创建队列并允许我们看出更多带宽是否可用。然后，它将发送速率降低相同的量，以保持平均发送速率相同，并删除在临时发送速率凹凸期间可能创建的任何排队。该行为是由BBR纸中的下图描述的：</p><p>在LatencyFlex中，我们基本上使用了同样的想法，但在更高的频率下：我们在“探测帧速率”模式下运行一帧，然后使用下一个帧漏任何队列，然后重复。至关重要的差异是我们使用不同的估计器进行吞吐量和延迟。在BBR中，通过$$ \ widehat {\ text {btlbw}} = \ max（\ text {deliveryrate}）测量带宽。$$这适用于bbr，因为$ \ text {forluserrate} $在长窗口中平滑方差足够低。但是，在LatencyFlex中，我们需要从最新的帧时间值派生实时帧速率，这是非常嘈杂的。使用最大值会使估算器强烈偏见。相反，我们使用指数加权的移动平均值，这给出了一个无偏估计：</p><p>我们还将负增益应用于BBR中。在LatencyFlex中，我们使用-1.5％，被确定为良好的测试平衡。</p><p>我们在上一节中讨论的步行者有一个问题：适应带宽减少需要很长时间。这是因为有两个原因：</p><p>overpacing创建队列（以比例比例在极限上的比例），并且步行者只能以等于我们指定的余量的速率排出队列（BBR的1％，LFX为1.5％）。前者可以比后者快得多，这意味着它会恢复到最佳操作会过度长时间。</p><p>这给出了一个“BrickWall”，它可以防止延迟无限期地增加，如下面的BBR纸上所示：</p><p>对于每个帧，我们预测它将完成的时间。这是通过将估计的延迟添加到开始时间来派生这一点。</p><p>预测和实际完成之间的差异等于延迟估计和真实地之间的差异。该算法所做的是保持延迟常数：如果延迟由于排队而增加，则尝试将队列减少相同的数量。延迟将暂时飙升，直到我们可以做出反应，但很快就会恢复到所需的低值。</p><p>本说明省略了许多我在实际实现中做出的复杂决策以实现稳定性，以避免将帖子变得太长。我在代码中记录了它们，尽管一些稳定性属性仍然不太了解。</p><p>LatencyFlex的有意识的设计决策是它将整个管道视为黑匣子，只假设瓶颈的排队将反映在延迟中。这是一个非常强大的模型，适应各种瓶颈，不限于GPU。</p><p>另一方面，NVIDIA反射依赖于游戏引擎代码的显式仪器。它具有用于仿真，渲染和呈现线程的执行标记，用于识别线程之间的通信，以及启用此类优化的选项BusemAstoOptimize。看起来它有一个没有这些标记的模式，但据我所知，所有公布的游戏似乎都使用显式标记。</p><p>LatencyFlex可用于Linux用户，可以注入支持NVIDIA反射的游戏，也可以与某些不支持反射的游戏一起使用，但满足某些游戏发动机条件。如果您有兴趣，请尝试一下。未来，我期待开发游戏开发人员的一体化，一旦我有信心，LFX就足够稳定为最终产品。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://ishitatsuyuki.github.io/post/latencyflex/">https://ishitatsuyuki.github.io/post/latencyflex/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/减少/">#减少</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/approach/">#approach</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/延迟/">#延迟</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1072580.html"><img src="http://img2.diglog.com/img/2022/1/thumb_393380c31d4b4acd43128612b654f279.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072580.html">NFT Fantasy：为什么 -  AS-AS-NFT不会在游戏之间转移资产</a></div><span class="my_story_list_date">2022-1-10 9:40</span></div><div class="col-sm"><div><a target="_blank" href="/story/1072559.html"><img src="http://img2.diglog.com/img/2022/1/thumb_0c392ee064aadc07432aaace074c45ff.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072559.html">一个连帽衫，带着猫的猫，在他们的人工工作时依偎在里面</a></div><span class="my_story_list_date">2022-1-10 5:37</span></div><div class="col-sm"><div><a target="_blank" href="/story/1072556.html"><img src="http://img2.diglog.com/img/2022/1/thumb_956f7aedd5d05cc39ddff423d2817ecd.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072556.html">古尔曼：Apple即将到来的混合现实耳机不会是一家全天设备，将用于游戏，通信和内容消费爆发</a></div><span class="my_story_list_date">2022-1-10 4:38</span></div><div class="col-sm"><div><a target="_blank" href="/story/1072394.html"><img src="http://img2.diglog.com/img/2021/8/thumb_547e57946cc99b85016e24e2961936f8.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1072394.html">Twilio 如何超越多元化数字游戏，成为一家反种族主义公司</a></div><span class="my_story_list_date">2021-8-10 3:47</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>