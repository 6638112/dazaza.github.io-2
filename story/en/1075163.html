<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用GDB调试Debugging with GDB</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Debugging with GDB<br/>用GDB调试</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-03-02 22:08:49</div><div class="page_narrow text-break page_content"><p>My first programming language was C++ and for a long time, I was using VisualStudio Express in Windows. When I had to debug something, I would click on theline number to set a breakpoint and press F5. Maybe I’d add some variables tothe watch window, and press some F-keys a couple of times. Recently, I switchedjobs and I’m now mostly developing firmware in C. Since I switched to usingLinux and Vim ~7 years ago, I needed to update my debugging workflow. Iactually didn’t find a neat tutorial that covers the whole picture, so Ifigured I could write one myself.</p><p>我的第一个编程语言是C++，很长一段时间，我都在Windows中使用VisualStudio Express。当我不得不调试某个东西时，我会点击行号设置断点，然后按F5。也许我会给手表窗口添加一些变量，然后按几次F键。最近，我换了工作，现在主要是用C语言开发固件。自从7年前我改用Linux和Vim以来，我需要更新我的调试工作流程。事实上，我没有找到一个完整的教程，所以我想我可以自己写一个。</p><p> During the last 5 years, I mostly worked with Python, and I really likedebugging in Python. You’d just put a  breakpoint() function call into yourcode somewhere and repl into the program. I wanted to see how close I get tothat in C. As C is not an interpreted language, my hopes weren’t that high, butit turns out debugging in C is quite comfortable. As a bonus, you can use GDBnot only to debug C and C++, but also Rust, Nim, and probably any language thatrespects the C-ABI (althoug I don’t know this for a fact).</p><p>在过去的5年里，我主要使用Python，我真的很喜欢Python中的bug。您只需在代码中的某个地方放入一个breakpoint（）函数调用，并将其复制到程序中。我想看看我在C语言中离这有多近。由于C语言不是一种解释语言，我的希望并没有那么高，但事实证明，在C语言中调试是相当舒服的。作为奖励，您可以使用GDBNOW只调试C和C++，但也可以使用RIST、Nim，以及可能尊重C-ABI的任何语言（我不知道这是事实）。</p><p>   // program.c #include  &lt;stdio.h&gt; #include  &lt;stdlib.h&gt; #include  &lt;time.h&gt;  void  print_product ( int  a ,  int  b )  {  int  product  =  a  *  b ;  printf ( &#34;Product: %d \n &#34; ,  product ); } void  print_arguments ( int  argc ,  char  ** argv )  {  for  ( int  i  =  1 ;  i  &lt;  argc ;  i ++ )  {  printf ( &#34;%s &#34; ,  argv [ i ]);  }  printf ( &#34; \n &#34; ); } int  main ( int  argc ,  char  ** argv )  {  print_arguments ( argc ,  argv );  srand ( time ( NULL ));  for  ( int  i  =  0 ;  i  &lt;  10 ;  i ++ )  {  print_product ( rand (),  rand ());  }  return  0 ; }</p><p>//节目。c#包括&lt；斯特迪奥。h&gt#包括&lt；stdlib。h&gt#包括&lt；时间h&gt；无效打印产品（int a，int b）{int product=a*b；printf（&#34；产品：%d\n&#34；产品）；}无效的print_参数（intargc，char**argv）{for（inti=1；i&lt；argc；i++）{printf（&#34；%s&#34；，argv[i]）}printf（&#34；\n&#34；）}int main（int argc，char**argv）{print_参数（argc，argv）；srand（time（NULL））；for（int i=0；i&lt；10；i++）{print_乘积（rand（），rand（））；}返回0；}</p><p> To debug the program, it’s important that it contains debugging symbols. Toadd debugging symbols when compiling with gcc add the  -g flag. So let’scompile this program:</p><p>要调试程序，必须包含调试符号。使用gcc编译时添加调试符号添加-g标志。让我们来编译这个程序：</p><p>    this will launch us into a repl. Torun the program until it hits the main function, type  start. Now you have thetypical debugger actions that you can execute by typing them into the repl. Youcan go to the next line by entering  n (of course you have to press returntoo),  s to step into the current function call,  r to run until you hit abreakpoint, and  some more. Toset a breakpoint, type  b &lt;line&gt; where  &lt;line&gt; is the line number you wantit in. If your project consists of multiple files, you’ll have to type  b &lt;filename&gt;:&lt;line&gt; however,  &lt;filename&gt; does not need to be a complete path,just the name is enough. Btw, gdb allows for tab completion. Alternatively you canset a breakpoint to a function like this  b &lt;functionname&gt;.</p><p>这将使我们进入一个repl。要运行程序，直到它达到主功能，请键入start。现在有了典型的调试器操作，可以通过在repl中键入它们来执行。你可以通过输入n（当然你也必须按Returns）进入下一行，s进入当前函数调用，r运行直到到达一个断点，等等。设置断点，键入b&lt；生产线&gt；何处&lt；生产线&gt；是你要的电话号码。如果项目包含多个文件，则必须键入b&lt；文件名&gt；：&书信电报；生产线&gt；然而，&lt；文件名&gt；不需要是一个完整的路径，只需要名称就足够了。顺便说一句，gdb允许制表符完成。或者，您可以为这样的函数设置断点&lt；functionname&gt；。</p><p> To see the context of a variable, we can use  p like  p product if we breakat line 6. But we can also evaluate nearly arbitrary c expressions e.g.  pproduct * 5.</p><p>要查看变量的上下文，如果在第6行断开，我们可以使用类似于p的p乘积。但我们也可以计算几乎任意的c表达式，例如pproduct*5。</p><p>  This is still not nice though, now we’d have to enter all breakpoints over andover again, when we restart the debugging session. But there is away out of this: gdb scripts. If you invoke gdb with the -x option, you canpass it a file containing gdb commands, that it should execute.</p><p>但这仍然不好，现在我们必须在重新启动调试会话时反复输入所有断点。但还有一个问题：gdb脚本。如果使用-x选项调用gdb，可以向它传递一个包含gdb命令的文件，该命令应该执行。</p><p>    And now our breakpoints are stored. But there is more to it. Typically I wantto check some variables, and I’m not very interested in running the programfurther than that. Let’s say, we wanted to see the value of the productvariable, for all loops, and dont care about the rest:</p><p>现在我们的断点被存储了。但还有更多。通常我想检查一些变量，我对运行程序不太感兴趣。比如说，我们希望看到productvariable的值，对于所有循环，而不关心其余的：</p><p>    Now gdb will quickly print out the value of  product for all iterations, andexit again. A  commands statement after a breakpoint will execute allcontained commands once a breakpoint is hit. The last command, the  c means continue and will resume the program flow until the next breakpoint is hit,once the breakpoint was hit the last time, gdb will end execution thanks to the --batch parameter.</p><p>现在，gdb将快速打印出所有迭代的产品价值，然后再次退出。断点后的commands语句将在命中断点后执行所有包含的命令。最后一个命令，c表示继续，并将继续程序流，直到下一个断点被击中。一旦上次击中断点，gdb将通过--batch参数结束执行。</p><p> Another cool example: let’s say, for whatever reason, we are interested in thevalue of  product only during the third call of  print_product(). (Which isof course silly, since the program prints it anyway, but in real worlddebugging, a situation like this might arise)</p><p>另一个很酷的例子：不管出于什么原因，我们只在第三次调用print_product（）时才对产品的价值感兴趣。（这当然很愚蠢，因为程序无论如何都会打印出来，但在现实调试中，可能会出现这样的情况）</p><p> set $n = 0b 6commands set $n = $n + 1 if $n == 3 printf &#34;Product is: %d\n&#34;, product else c endendrun</p><p>set$n=0b 6如果$n==3 printf&#34，则命令set$n=$n+1；产品是：%d\n&#34；，产品名称：c endendrun</p><p> As you can see we define a variable  $n and use it to count up, and print ourrequired information in the third round. After the third round, gdb quitsautomatically thanks to  --batch. For a more complete tour through gdb’sscripting capabilities, I recommend the tutorial on adacore.com:  part 1 and part 2.</p><p>正如您所见，我们定义了一个变量$n，并使用它进行计数，并在第三轮打印出我们所需的信息。第三轮结束后，多亏了--batch，gdb自动退出。要更全面地了解gdb的脚本功能，我推荐adacore教程。com：第一部分和第二部分。</p><p>  There is a script, that gdb will always implicitly load if it exists: ~/.gdbinitYou can put functions you use often in there, or configuration. Mine looks likethis:</p><p>有一个脚本，如果存在，gdb将始终隐式加载：~/。GDBInit您可以将经常使用的函数或配置放在其中。我的看起来像这样：</p><p>  Setting width and height to 0, will prevent gdb from paging long outputs, thethird line makes gdb prettify the output, and the last line prevents it fromasking if we really want to quit.</p><p>将宽度和高度设置为0，将防止gdb分页长输出，第三行使gdb美化输出，最后一行防止它询问我们是否真的想退出。</p><p>  This is largely what I have. In general, I’m quite happy with the power andflexibility. It might be a little more work than placing a breakpoint in anIDE, but you get so much more out of it. Also, in IDEs I always found itannoying to call the debugger with arguments, because you’d have to find theright options dialog. Here you can simply append them to the debuggerinvocation:</p><p>这就是我所拥有的。总的来说，我对它的力量和灵活性很满意。这可能比在anIDE中放置一个断点要多一些工作，但你可以从中得到更多。此外，在IDE中，我总是发现用参数调用调试器是不合适的，因为您必须找到正确的选项对话框。在这里，您可以简单地将它们附加到debuggerinvocation：</p><p>  Also, if you require a more complex setup for debugging, e.g. because you haveto start other programs too, you can put all of that together in a bash script.</p><p>此外，如果你需要一个更复杂的调试设置，例如，因为你必须启动其他程序，你可以把所有这些放在一个bash脚本中。</p><p> Of course, there is much more to know about gdb, and this is barely anintroduction.</p><p>当然，关于gdb还有很多需要了解的，而这只是一个介绍。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/gdb/">#gdb</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/debugging/">#debugging</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>