<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>安装了多少物理内存？</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">安装了多少物理内存？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-29 22:35:46</div><div class="page_narrow text-break page_content"><p>我经常想计算安装在运行Linux的系统中的物理内存的确切数量，今天我终于偶然发现了令人满意的解决方案：在/ sys / devices / system / memory下查看。我知道我已经在该系统中安装了16GB（或者如果您愿意，可以选择GiB）的内存。我一直觉得令free -greport之类的命令只有15GB作为“安装的总内存”感到沮丧。我知道为什么会这样-某些总内存由系统保留，有些由内核占用，而只有其余部分可供应用程序使用。那是/ proc / meminfo中报告为“ MemTotal”的数字，这是其他所有东西使用的数字。对于大多数实际目的，这是重要的数字。 $ grep MemTotal：/ proc / meminfo MemTotal：16283212 kB $ echo $（（$（getconf PAGE_SIZE）* $（getconf _PHYS_PAGES）/ 1024））16283212</p><p> 我知道获得答案的另一种方法：dmidecode将报告每个“内存设备”的确切大小。例如，mysystem安装了2×8GB DIMM：不幸的是，您必须具有root用户访问权限才能运行dmidecode，输出相当冗长（尝试仅运行“ dmidecode”），尽管在我尝试过的所有地方都可以使用，从来没有完全确定过它对不同的体系结构和系统配置的适应性。这不是一个真正令人满意的解决方案。但是看看我今天遇到的困难：$ cd / sys / devices / system && echo $（（$（grep -x在线内存/内存[0-9] * / state | wc -l）* 0x $（cat内存/ block_size_bytes ）/ 1024 ** 3））16</p><p> 完善！ / sys / devices / system / memory下的每个memoryN子目录都代表一个block_size_bytes物理内存块，如果将所有内容相加，则得出正确的总数。在我的系统上，块大小为0x8000000字节，即128MB，并且有128个子目录，总计16GB。在具有可热插拔RAM的系统上，内存N /状态可能为“离线”，因此我将grep设置为“在线”以确保不在将子目录计入总数之前。 （似乎可以“回传离线”状态文件以更改状态，但我不敢尝试。）有趣的是，子目录不是memory0到memory127，而是memory0到memory20和memory32到memory138。数字中的11块孔必须有一些解释，但我不知道它是什么。如果最近一次重新启动不是不久之前，您可能会在dmesg中找到以下消息：内存：可用16265512K / 16659852K（10252K内核代码，1222K rwdata，3252K rodata，1552K init，656K bss，394340Kreserved，0K cma保留）</p><p> 这并不能告诉您确切的物理内存多少，但是这些数字很有趣。 16265512K对应于MemTotal，如果添加了394340K的保留内存，则将达到16659852K。整洁，但是smidgen少于预期的16777216K不到500MB。那是我碰巧保存的一些旧的dmesg输出。但是，在撰写本文时，我对系统会说些什么感到好奇，然后重新启动进行检查。令我惊讶的是，我无法理解结果：＃uname -r5.8.0-0.bpo.2-amd64＃dmesg -T | grep内存：[Fri Nov 27 12:37:05 2020]内存：2627884K / 16659852K可用（12291K内核代码，1292K rwdata，4060K rodata，1632K init，1864K bss，442442K保留，0K cma保留）</p><p> 16659852K相同，括号中的其他数字看起来合理（对于不同的内核），但是2627884K只有2.5GB！尽管有这个奇怪的结果，/ proc / meminfo中的值看起来还是不错的：＃cat / proc / meminfo MemTotal：16283212 kBMemFree：8985772 kBMemAvailable：11920424 kB…DirectMap4k：306976 kBDirectMap2M：9013248 kBDirectMap1G：8388608 kB</p><p> 有问题的消息来自mm / page_alloc.c中的mem_init_print_info（）函数（为清晰起见进行了编辑）：pages_to_kb = PAGE_SHIFT-10; / * == 2 for 4KB x86 pages * / reserved_pa​​ges = get_num_physpages（）-totalram_pages（）…; pr_info（“内存：％luK /％luK可用（％luK内核代码，...，”“％luK保留，...）\ n“，nr_free_pages（）> 10，…reserved_pa​​ges << pages_to_kb，…）;</p><p> 我不知道为什么这个内核突然认为我的nr_free_pages（）比以前小得多，但是我期待发现。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://toroid.org/linux-physical-memory">https://toroid.org/linux-physical-memory</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/内存/">#内存</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/物理/">#物理</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/memory/">#memory</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1036250.html"><img src="http://img2.diglog.com/img/2020/11/thumb_4b7d9ecba1881eda1176c27aaa7da297.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1036250.html">VSCode内存泄漏问题标记为“超出范围”</a></div><span class="my_story_list_date">2020-11-24 13:6</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035987.html"><img src="http://img2.diglog.com/img/2020/11/thumb_cb2239f4a014a5d570989bf344b77983.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035987.html">内存，磁盘，CPU：35年如何改变了权衡</a></div><span class="my_story_list_date">2020-11-23 4:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035817.html"><img src="http://img2.diglog.com/img/2020/11/thumb_9b245f67c3b3cbeea18876c89a1c8070.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035817.html">使用jemalloc在Go中手动进行内存管理</a></div><span class="my_story_list_date">2020-11-22 6:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1034410.html"><img src="http://img2.diglog.com/img/2020/11/thumb_c3c9efae39d7ebcf5fe1d3f84f835c39.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034410.html">ARM内存模型工具：Morello(和一些内存标记)</a></div><span class="my_story_list_date">2020-11-11 5:50</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>