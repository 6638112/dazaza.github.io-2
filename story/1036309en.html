<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>从HTML表单发布JSONPosting JSON from a HTML Form</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Posting JSON from a HTML Form<br/>从HTML表单发布JSON</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-24 22:15:19</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/c9cdbcc7e1e7e561bd94deab5c60e5e3.png"><img src="http://img2.diglog.com/img/2020/11/c9cdbcc7e1e7e561bd94deab5c60e5e3.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>A coworker and I were looking at an application today that, like so many othermodern web applications, offers a RESTful API with JSON being used forserialization of requests/responses. She noted that the application didn’tinclude any sort of CSRF token and didn’t seem to use any of the headers(X-Requested-With, Referer, Origin, etc.) as a “poor man’s CSRF token”, butsince it was posting JSON, was it really vulnerable to CSRF?  Yes, yes,definitely yes!</p><p>今天，我和一位同事正在研究一个应用程序，该应用程序与许多其他现代Web应用程序一样，提供了RESTful API，其中JSON被用于对请求/响应进行序列化。她指出，该应用程序未包含任何CSRF令牌，并且似乎未将任何标头（X-Requested-With，Referer，Origin等）用作“穷人的CSRF令牌”，但因为发布JSON，它真的容易受到CSRF的攻击吗？是的，是的，肯定是的！</p><p> Interestingly, this is reminiscent of many of the confusions between server andbrowser that are described in Michal Zalewski’s  The TangledWeb.</p><p> 有趣的是，这让人联想到Michal Zalewski的The TangledWeb中描述的服务器和浏览器之间的许多混淆。</p><p> The idea that the use of a particular encoding is a security boundary is, atworst, a completely wrong notion of security, and at best, a stopgap until W3C,browser vendors, or a clever attacker gets hold of your API. Let’s examine JSONencoding as a protection against CSRF and demonstrate a mini-PoC.</p><p> 使用特定编码是安全边界的想法，至少是完全错误的安全概念，充其量只是在W3C，浏览器供应商或聪明的攻击者掌握您的API之前的权宜之计。让我们研究一下JSONencoding作为一种针对CSRF的保护措施，并演示一个迷你PoC。</p><p>  We have a basic application written in Go. Authentication checking is elidedfor post size, but this is  not just an unauthenticated endpoint.</p><p>  我们有一个用Go编写的基本应用程序。无需进行验证检查，以确保帖子大小，但这不仅仅是未经身份验证的端点。</p><p> package  main import  (	 &#34;encoding/json&#34;	 &#34;fmt&#34;	 &#34;net/http&#34; ) type  Secrets  struct  {	 Secret  int } var  storage  Secrets func  handler ( w  http . ResponseWriter ,  r  * http . Request )  {	 if  r . Method  ==  &#34;POST&#34;  {		 json . NewDecoder ( r . Body ) . Decode ( &amp; storage )	 }	 fmt . Fprintf ( w ,  &#34;The secret is %d&#34; ,  storage . Secret ) } func  main ()  {	 http . HandleFunc ( &#34;/&#34; ,  handler )	 http . ListenAndServe ( &#34;:8080&#34; ,  nil ) }</p><p> 包主要导入（“ encoding / json”“ fmt”“ net / http”）类型Secrets struct {Secret int} var storage Secrets func handler（w http。ResponseWriter，r * http。Request）{if r。方法==“ POST” {json。 NewDecoder（r.Body）。解码（和存储）} fmt。 Fprintf（w，“秘密是％d”，存储。秘密）} func main（）{http。 HandleFunc（“ /”，handler）http。 ListenAndServe（“：8080”，nil）}</p><p> As you can see, it basically serves a secret number that can be updated viaHTTP POST of a JSON object. If we attempt a URL-encoded or multipart POST, theJSON decoding fails miserably and the secret remains unchanged. We must POSTJSON in order to get the secret value changed.</p><p> 如您所见，它基本上是一个秘密号码，可以通过JSON对象的HTTP POST进行更新。如果我们尝试使用URL编码或多部分POST，则JSON解码会失败，并且机密保持不变。我们必须POSTJSON才能更改秘密值。</p><p>  So let’s explore our options here. The site can locally use AJAX via theXMLHTTPRequest API, but due to the  Same-OriginPolicy,an attacker’s site cannot use this. For most CSRF, the way to get around thisis plain HTML forms, since form submission is not subject to the Same-OriginPolicy. The W3C had a  draft specification for JSONforms, but that has been abandonedsince late 2015, and isn’t supported in any browsers. There are probably sometechniques that can make use of Flash or other browser plugins (aren’t therealways?) but it can even be done with basic forms, it just takes a little work.</p><p>  因此，让我们在这里探讨我们的选择。该站点可以通过XMLHTTPRequest API在本地使用AJAX，但是由于Same-OriginPolicy，攻击者的站点无法使用它。对于大多数CSRF，解决此问题的方法是普通的HTML表单，因为表单提交不受Same-OriginPolicy的约束。 W3C拥有针对JSONforms的规范草案，但自2015年末以来已被放弃，并且不受任何浏览器的支持。可能有一些技术可以利用Flash或其他浏览器插件（不是吗？），但是甚至可以使用基本形式来完成，只需要一点工作。</p><p>  Normally, if we try to POST JSON as, say, a form value, it ends up being URL encoded,not to mention including the field name.</p><p>通常，如果我们尝试将JSON作为表单值发布，则最终以URL编码，更不用说包含字段名了。</p><p>       It turns out you can set the enctype of your form to  text/plain and avoid theURL encoding on the form data. At this point, you’ll get something like:</p><p>       事实证明，您可以将表单的enctype设置为text / plain，并避免对表单数据进行URL编码。此时，您将获得类似以下内容的信息：</p><p>  Unfortunately, we still have to contend with the form field name and theseparator ( =). This is a simple matter of splitting our payload across boththe field name and value, and sticking the equals sign in an unused field. (Oryou can use it as part of your payload if you need one.)</p><p>  不幸的是，我们仍然必须与表单字段名称和theseparator（=）竞争。这很简单，只需将我们的有效负载分配到字段名称和值之间，然后将等号放在未使用的字段中。 （或者，如果需要，可以将其用作有效负载的一部分。）</p><p>  This post contains affiliate links. If you click ona link, I may earn a small commission at no cost to you.</p><p>  这篇文章包含会员链接。如果您单击链接，我可能会为您免费赚取少量佣金。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://systemoverlord.com/2016/08/24/posting-json-with-an-html-form.html">https://systemoverlord.com/2016/08/24/posting-json-with-an-html-form.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/发布/">#发布</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/表单/">#表单</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/json/">#json</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>