<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>双重读取、调度算法和洋葱圈</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">双重读取、调度算法和洋葱圈</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-14 09:01:47</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/b6db7cd197a2535fb1b664ee120c99a4.png"><img src="http://img2.diglog.com/img/2020/11/b6db7cd197a2535fb1b664ee120c99a4.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Most people thought I was crazy for doing this, but I spent the last few months of my gap year working as a short order cook at a family-owned fast-food restaurant. (More on this  here.) I’m a programmer by trade, so I enjoyed thinking about the restaurant’s systems from a programmer’s point of view. Here’s some thoughts about two such systems.</p><p>大多数人认为我做这件事是疯了，但我在空档年的最后几个月里在一家家族快餐店做快餐厨师。(有关这方面的更多信息，请点击此处。)。我的职业是程序员，所以我喜欢从程序员的角度来思考餐厅的系统。下面是关于两个这样的系统的一些想法。</p><p>   Human systems, at first glance, can appear broken, but due to subtle human factors, they might actually work just fine.</p><p>乍一看，人类系统可能看起来是坏的，但由于微妙的人为因素，它们实际上可能工作得很好。</p><p> My best example is the system for taking and fulfilling orders. We never wrote anything down, and would re-ask orders multiples times, including when ringing customers up. (In computer security, this is known as a  double fetch.) Not great service and can theoretically let customers lie and pay less.</p><p>我最好的例子是接受和履行订单的系统。我们从来没有写下任何东西，而且会多次重新要求订单，包括给客户打电话的时候。(在计算机安全中，这被称为双重读取。)。不是很好的服务，理论上可以让客户撒谎，支付更少的钱。</p><p> In practice most customers didn’t mind  too much, liars are rare, and we can loosely detect when something seems off with an order.</p><p>实际上，大多数顾客并不太介意，说谎的人很少，我们可以轻松地察觉到订单似乎有什么不对劲的地方。</p><p> Writing orders down and asking strictly once seems optimal but has subtle flaws. For one thing, there’s not enough space behind the counter for everyone to walk to the written order, so it requires more internal communication. This will fail during a rush when you’re blocked on order details and coworkers are too busy for questions.  Customers are always idle; coworkers aren’t.</p><p>写下订单并严格要求一次似乎是最好的，但也有微妙的缺陷。首先，柜台后面没有足够的空间让每个人都走到书面点餐的地方，因此需要更多的内部沟通。当你在订单详细信息上受阻，同事忙得没有时间提问时，这种方法会在紧急情况下失败。顾客总是无所事事；同事则不是。</p><p> It can increase confusion if order slips aren’t thrown out when orders are finished and is also logistically (and literally) messy if you have greasy gloves and want to avoid touching a pen, then food. Lastly, many of my coworkers were older and very used to the existing system.  A major transition to a new system would have generated more confusion than it’s worth.</p><p>如果订货单在订单完成后没有扔掉，而且如果你戴着油腻的手套，不想碰钢笔，不想碰食物，那么在后勤上(从字面上看)也很混乱，这可能会增加混乱。最后，我的许多同事年纪较大，非常习惯现有的制度。向新系统的重大过渡将产生比其价值更多的混乱。</p><p>  While I covered a range of duties including the cash register, milkshake machine, and grill, I spent the most time on the deep fryer. I’m delighted to present this overanalysis of life as a fry cook, from a programmer’s point of view.</p><p>虽然我的职责范围很广，包括收银机、奶昔售货机和烤架，但我花在油炸机上的时间最多。我很高兴能从程序员的角度来介绍这种对油炸厨师生活的过度分析。</p><p>   This picture has 2 fryers, each with 2 baskets that can be submerged to sit in the vats of hot oil below. At work, only 1 fryer would be active on any given day which effectively allows 2 items to be fried at the same time.</p><p>这张照片有两个油锅，每个油锅都有两个篮子，可以浸入水中，放在下面的热油桶里。在工作中，任何一天只有一个油炸机处于活动状态，这实际上可以让两个项目同时被油炸。</p><p> Fry cooks have a lot in common with operating systems in that they are both responsible for scheduling. Operating systems schedule threads to run on a limited number of cores; fry cooks schedule food to be fried in a limited number of fryers. Different food items have different priorities, and different lengths of time to cook.</p><p>油炸厨师和操作系统有很多共同之处，因为他们都负责日程安排。操作系统将线程安排在有限数量的内核上运行；油炸厨师将食物安排在有限数量的油炸机中进行油炸。不同的食物有不同的优先顺序，烹饪的时间长短也不同。</p><p> French fries, curly fries, and onion rings (collectively, “fries”) are the main menu items from the deep fryer. Each fry order could be large or small (except for rings which were only large) and eat-in or to-go. The job of the fry cook is to:</p><p>炸薯条、卷曲薯条和洋葱圈(统称为“薯条”)是油炸机上的主菜。每一份薯条都可以是大的或小的(除了只是大的圈子)和外卖或带走。油炸厨师的工作是：</p><p> Serve them onto the customer’s tray on the counter, or their to-go bag</p><p>把它们放到顾客柜台上的托盘上，或者放在他们的行李袋里。</p><p> The goal is to do this with maximum speed and accuracy and without dropping orders. You’ll ideally minimize the number of times you ask customers and coworkers for order details. In addition, there are a few sources of complexity to handle:</p><p>我们的目标是以最快的速度和最高的准确度完成这项工作，而不会丢掉订单。理想情况下，最大限度地减少向客户和同事询问订单详细信息的次数。此外，还有几个需要处理的复杂性来源：</p><p> Incomplete information: Depending on the greeter, they may forget to specify if it’s eat-in or to-go. You can always ask the customer, but the grill chef will likely ask the same question in a little bit. You might be able to save a customer ask if you can eavesdrop on that interaction.</p><p>不完全信息：根据迎宾的不同，他们可能会忘记说明是外卖还是外带。你可以随时问顾客，但烧烤大厨过一会儿可能会问同样的问题。您或许可以避免客户询问您是否可以窃听该交互。</p><p> Timing requirements: You need to finish orders by the time the grill chef finishes the burgers/hot dogs, but you shouldn’t finish too early. If you put the fries on the counter way before the burgers are ready, they’ll get cold. This matters less for to-go orders, which you can serve into the bag immediately.</p><p>时间要求：你需要在烧烤厨师吃完汉堡/热狗之前完成订单，但你不能太早完成。如果你在汉堡还没做好之前就把薯条放在柜台上，它们就会凉了。对于外卖订单来说，这就不那么重要了，你可以立即把它们装进袋子里。</p><p> Scale: During a rush, you might receive many orders per minute, while only being able to process 1-2 per minute. Once the greeter relays the order, they forget it, so it’s up to you to remember. And remember: no writing things down.</p><p>规模：在高峰期间，你每分钟可能会收到很多订单，但每分钟只能处理1-2个订单。一旦迎宾传达了口令，他们就会忘记，所以要记住的就是你了。记住：不要把东西写下来。</p><p> Waste avoidance: Sometimes you or another cook will make too many fries. To avoid wasting them, you can use the excess towards a future order by refreshing them with a splash later and adding them to a fresh batch.</p><p>避免浪费：有时你或其他厨师会做太多薯条。为了避免浪费，你可以将多余的部分用于未来的订单，方法是稍后用溅起的水花刷新它们，并将它们添加到新的批次中。</p><p> Changing orders: Customers sometimes change their order after you’ve started cooking (e.g. regular fry to curly fry). Now you have to figure out what to do with the partially cooked portion currently in the fryer.</p><p>改变顺序：顾客有时会在你开始烹饪后改变他们的顺序(例如，从普通油炸到卷曲油炸)。现在你必须弄清楚如何处理目前在油炸锅里的未煮熟的部分。</p><p> Miscellaneous items: In addition to fries, there other items that need to be scheduled for time in the fryer, including chicken patties, bacon, clam strips, and fish fillets.</p><p>杂物：除了薯条，还有其他需要放在油炸锅里的食物，包括鸡肉饼、培根、蛤肉条和鱼片。</p><p>  Batching orders together. If a large and small fry order are in the queue, you can cook them in the same basket at the same time. Some customers request their fries “well done”, meaning cooked extra long. This makes batching more complicated.</p><p>把订单放在一起批处理。如果有大份和小份的薯条在排队，你可以把它们放在同一个篮子里同时烹调。有些顾客点的薯条是“熟透的”，意思是煮得更久。这使得批量处理变得更加复杂。</p><p> “Wait n Splash”: If a fry order is done cooking far before the rest of the grill items and you don’t have pressing items that need fryer time, you can raise the basket from the oil, but leave the food in it. When the grill items finish, you can quickly splash the food back in the oil to refresh it, then serve it. This will prevent it from getting cold on the counter.</p><p>“等待n水花”：如果一份油炸食品的烹调时间远远早于其他烧烤食品，而且你没有需要油炸时间的压榨食品，你可以把篮子从油中提起来，但把食物留在里面。当烧烤结束后，你可以快速地把食物泼回油中来刷新它，然后就可以上桌了。这将防止它在柜台上变冷。</p><p> Inactive fryer baskets: It can be handy to have extra storage space for cooked food. If you have a “wait n splash” order waiting, but you have more orders to fry, you can use the 2 spare baskets from the inactive fryer to store the waiting order and free up the fryer slot. This is also useful when customers change their order and you need to quickly stash the half cooked portion somewhere and start the adjusted order.</p><p>不活动的油炸篮子：为熟食留出额外的储存空间是很方便的。如果你有一个“等待n水花”订单等待，但你有更多的订单要炸，你可以使用两个备用篮子从非活动的油炸锅存储等待的订单，并腾出油炸锅槽。当顾客改变他们的订单时，这也是很有用的，你需要快速地把半生不熟的部分藏在某个地方，然后开始调整后的订单。</p><p> “The tong dip”: If both fryers are in use and the grill chef hands you bacon to be urgently cooked, you can hold the bacon in tongs and dip it into one of the submerged baskets. This lets you effectively cook more than 2 things at the same time.</p><p>“汤汁”：如果两个煎锅都在使用，而烧烤厨师递给你要紧急烹调的培根，你可以用钳子夹住培根，然后把它蘸进一个浸入水中的篮子里。这可以让你有效地同时烹调两道以上的食物。</p><p> Here’s the system I ended up using. When a new order came in, I’d stop whatever I was doing and grab the appropriate container and place it in the corresponding fry bucket. This captures all 3 pieces of information about the order (fry type, size, to-go?) letting me forget it. If I strictly follow this, I can just process the containers in the buckets like a queue. However, I still need to keep a sense of order memorized because the system doesn’t capture global ordering – if I have containers in the fry, curly fry, and onion ring buckets, I can’t tell which order came in first.</p><p>这是我最终使用的系统。当有新的订单到来时，我会停下来，抓起合适的容器，把它放进相应的油炸桶里。这将捕获有关订单的全部3条信息(油炸类型、大小、外卖？)。让我忘了这件事。如果我严格遵循这一点，我就可以像处理队列一样处理存储桶中的容器。然而，我仍然需要记住一种秩序感，因为系统不能捕获全局排序-如果我在油炸、卷曲和洋葱圈桶中有容器，我不知道哪个顺序排在第一位。</p><p> I don’t have a solution for this. On a super busy day, this system falls apart and I drop orders. Extreme load like that has only happened a few times and in that case, I just make large batches, forget about syncing up with the grill items, and hope I don’t have too much excess at the end. Generally, the system worked nicely.</p><p>我没有解决这个问题的办法。在一个超级繁忙的日子里，这个系统崩溃了，我放弃了订单。像这样的极端负荷只发生过几次，在这种情况下，我只是大批量生产，忘记了与烤架同步，希望最后不会有太多过剩。总体而言，该系统运行良好。</p><p>  It’s fun to think about human systems, like those in a restaurant, from a programmer’s point of view. A fry cook’s job closely resembles that of an operating system scheduler, complete with optimization points and edge cases. One can try to optimize human systems as if they were computer systems, but it’s critical to understand the subtle human aspects of the system when evaluating improvements.</p><p>从程序员的角度来思考人类系统(比如餐厅中的系统)是一件很有趣的事情。油炸厨师的工作非常类似于操作系统调度员的工作，有优化点和边缘案例。人们可以试着优化人类系统，就像它们是计算机系统一样，但在评估改进时，理解系统中微妙的人类方面是至关重要的。</p><p> Did you learn something from this post? I’d love to hear what it was — tweet me  @offlinemark!</p><p>你从这篇文章中学到了什么吗？我很想知道这是什么--发推特给我@offline emark！</p><p> I also have a mailing list if you want to know when I write new posts:</p><p>如果你想知道我什么时候写新帖子，我还有一个邮件列表：</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://offlinemark.com/2020/11/12/double-fetches-scheduling-algorithms-onion-rings/">https://offlinemark.com/2020/11/12/double-fetches-scheduling-algorithms-onion-rings/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/算法/">#算法</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/读取/">#读取</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fetches/">#fetches</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/订单/">#订单</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1034656.html"><img src="http://img2.diglog.com/img/2020/11/thumb_e4f9124f2ea9fec53ac26d7acba0b222.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034656.html">MinisSelect：实用和通用的选择算法</a></div><span class="my_story_list_date">2020-11-12 4:59</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033773.html"><img src="http://img2.diglog.com/img/2020/11/thumb_c080a81f8785ce41c9fcfedc4efe020b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033773.html">Synerise推出AI Cleora算法作为开源</a></div><span class="my_story_list_date">2020-11-8 9:40</span></div><div class="col-sm"><div><a target="_blank" href="/story/1033755.html"><img src="http://img2.diglog.com/img/2020/11/thumb_68eaef96ef90392715a86ab4529d5a51.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1033755.html">费曼、算法编排和基于节点的编程</a></div><span class="my_story_list_date">2020-11-8 9:34</span></div><div class="col-sm"><div><a target="_blank" href="/story/1032980.html"><img src="http://img2.diglog.com/img/2020/11/thumb_5ea50c11e87601962553e2d5ad6a8d28.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1032980.html">应该允许受人工智能决策影响最大的人在塑造关于算法治理和监管的对话中发挥核心作用</a></div><span class="my_story_list_date">2020-11-3 22:56</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>