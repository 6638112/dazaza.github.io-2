<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为什么CloudFlare的CAPTCHA用Fido2 / WebAuth替换是一个坏主意 Why Cloudflare’s CAPTCHA replacement with FIDO2/WebAuthn is a bad idea</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Why Cloudflare’s CAPTCHA replacement with FIDO2/WebAuthn is a bad idea<br/>为什么CloudFlare的CAPTCHA用Fido2 / WebAuth替换是一个坏主意 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-14 20:56:29</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/5/149ada1ea1f3d72168222b344cafb89c.png"><img src="http://img2.diglog.com/img/2021/5/149ada1ea1f3d72168222b344cafb89c.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Recently Cloudflare released their FIDO based CAPTCHA replacement. You can read more about it  https://blog.cloudflare.com/introducing-cryptographic-attestation-of-personhood/, and try it here  https://cloudflarechallenge.com/. In the nutshell the way it works:</p><p>最近CloudFlare发布了基于Fido的CAPTCHA更换。您可以了解更多有关IT HTTPS://blog.CloudFlare.com/Introdute-cryptographic-attestation-of-personhood/，并在此处尝试https://cloudflarechalrenge.com/。在坚果壳中的工作方式：</p><p>       5. Cloudflare receives device attestation, and using metadata from the device, that contains root certificate for the batch certificate located in the attestation, it is able to validate device attestation.</p><p>       5. CloudFlare接收设备认证，并使用设备中的元数据，其中包含位于证明中的批处理证书的根证书，它能够验证设备证明。</p><p>    Attestation is a FIDO protocol builtin mechanism that allows relying parties(websites) to obtain information about authenticator model and manufacturer.</p><p>    证明是一个fido协议内置机制，允许依赖派对（网站）获取有关认证器模型和制造商的信息。</p><p> The way this is done, is that device has baked into it Batch Certificate and Batch Private key. During the registration authenticator response is signed with the Batch Private key, and websites can validate it with Public Key located in the Batch Certificate.</p><p> 这是完成的方式，是设备已烘焙到IT批处理证书和批处理私钥。在注册期间，验证者响应与批处理私钥签名，并且网站可以使用位于批处理证书中的公钥验证。</p><p> The response would contain some sort of model identifier, like GUID/UUID for FIDO2 and Subject Key Identifier for U2F. The website, Cloudflare, then has a Trust Root Certificate that is identified by the ModelID(GUID or SKID), and by having that Root Certificate it is able to validate response Batch Certificate, and using the Batch Certificate, validate signature over attestation response. Just a normal PKI, no magic.</p><p> 响应将包含某种模型标识符，如fido2的GUID / UUID和U2F的主题密钥标识符。然后，该网站CloudFlare，然后具有由ModelID（GUID或SKID）标识的信任根证书，并且通过使该根证书能够验证响应批处理证书，并使用批处理证书验证签名响应签名。只是一个正常的pki，没有魔法。</p><p>  A CAPTCHA test is designed to determine if an online user is really a human and not a  bot. CAPTCHA is an acronym that stands for “Completely Automated Public  Turing test to tell Computers and Humans Apart.”  The idea is that a computer program such as a bot will be unable to interpret the distorted letters, while a human being, who is used to seeing and interpreting letters in all kinds of contexts — different fonts, different handwritings, etc. — will usually be able to identify them.</p><p>  CAPTCHA测试旨在确定在线用户是否真的是人类而不是机器人。 CAPTCHA是一种代表“完全自动化的公共图灵测试，以告诉计算机和人类分开”的首字母缩写。这个想法是，诸如机器人的计算机程序将无法解释扭曲的字母，而人类则用于在各种上下文中看到和解释字母 - 不同的字体，不同的手写等 - 通常能够识别它们。</p><p> So the idea is: There are tasks that hard for computers, like image recognition, logical tasks, etc, but easy for humans(mostly).</p><p> 所以这个想法是：计算机有很难的任务，如图像识别，逻辑任务等，但对于人类而言，（大多数）。 </p><p>   The idea of CAPTCHA is that you can not easily automate task. Well meet 5$ Arduino and, oh God, WIRES!</p><p>CAPTCHA的想法是您无法轻易自动化任务。好好迎接5美元，哦，上帝，电线！</p><p>  And I am not gonna tell how easy it would be to implement automated ClientPIN injection.</p><p>  而且我不会告诉实施自动诊所注入的容易是多么容易。</p><p>  If you think it will be hard because user need to approve Popup, a bit of JS to modify browser request to be “none”, and a small browser modification to disable  EraseAttestationStatement  https://source.chromium.org/chromium/chromium/src/+/main:device/fido/attestation_object.cc;bpv=1;bpt=1?q=NoneAttestation&amp;ss=chromium%2Fchromium%2Fsrc and you get popup bypass.</p><p>  如果您认为这将是艰难的，因为用户需要批准弹出窗口，请将浏览器请求修改为“none”，以及一个小型浏览器修改，以禁用eraseattationstatement https://source.chromium.org/chromium/chromium.org/chromium/chromium.ing/chromium/chromium. SRC / + / MAIN：设备/ FIDO / ATTESTATION_OBJECT.CC; BPV = 1; BPT = 1？Q = NONEATTONATION＆amp; SS = CHOMIUM％2FCHROMIUM％2FSRC，你得到弹出旁路。</p><p> UPD: As Eric Lawrence pointed, you can setup enterprise policies which will disable webauthn popups  https://chromeenterprise.google/policies/#SecurityKeyPermitAttestation</p><p> UPD：作为Eric Lawrence指出的是，您可以设置企业策略，该策略将禁用WebAuthn弹出窗口https://chromeenterprise.google/policies/#security permitattation</p><p>  Security keys, on low level take about 700ms to 1700ms to do all exchanges from my experience. That’s approximately 30 potential requests a minute. And you make it super effectively with HID Click Farm!</p><p>  低级安全钥匙需要大约700毫秒到1700ms，从我的经验中进行所有交换。这是一分钟大约30个潜在的要求。你用HID点击农场有效地使它超级！</p><p> The idea is that you have VMs with Virtual HID device. VHID pretends to be security key, but what it actually does is proxies requests over the network, to the farm controller that has hundreds of keys plugged in to it. Couple of good quality USB controllers, and twelve core Ryzen with enough PCI lanes will easily handle few hundred HID devices at a time.</p><p> 这个想法是您对具有虚拟HID设备的VM。 VHID假装是安全密钥，但它实际上它的代理在网络上请求，到有数百个密钥插入它的农用控制器。几个优质的USB控制器，以及具有足够PCI车道的十二核心ryzen将一次轻松处理几百个HID设备。</p><p> Regarding devices you can get Feitian U2F devices for 18$ or Yubikey Security Keys for 20$ each.</p><p> 关于设备，您可以获得超过18美元或yubikey安全密钥的Feian U2F设备，每个设备为20美元。 </p><p>  The browser will send request to the VHID device, that will proxy it to the farm controller. The farm will select any random free security key, and call Arduino to perform physical click. The device will return response and send it back to the VM’s Virtual HID, that will return to the browser.</p><p>浏览器将向VHID设备发送请求，将其代理到农用控制器。该农场将选择任何随机的免费安全密钥，并调用Arduino进行物理点击。设备将返回响应并将其发送回VM的Virtual Hid，这将返回浏览器。</p><p> 25k$ will get you about 1000 security keys, and couple of good machines to manage them. The software development for that is trivial and can be done in Python in a very short period, which would generate 20,000–40,000 attestations per minute.</p><p> 25k $将为您提供大约1000个安全钥匙，以及几个好机器来管理它们。软件开发是微不足道的，可以在很短的时间内在Python中完成，这将产生每分钟20,000-40,000的证明。</p><p>  Lastly you can simply buy a lot of NFC readers, like ACS122U, and using PCSC, you don’t even need an Arduino, you can just tell the reader magic SCARD_UNPOWER_CARD command to power cycle the device.</p><p>  最后，你可以简单地购买很多NFC读者，如ACS122U，并使用PCSC，你甚至不需要一个Arduino，你可以告诉读者魔术scard_unpower_card命令电源循环设备。</p><p>  Attestation is not a perfect mechanism, and I would deeply discourage people from using it. The reasons for it are such:</p><p>  证明不是一个完美的机制，我会深深阻止人们使用它。它的原因是这样的：</p><p> Attestation does not prove anything but the device model — There is no magic in attestation. It does not proves user liveliness, because Cloudflare is simply does attestation check. That’s it. FIDO is really good against phishing and bots, because we know that user owns the device, and that it using FIDO moves attack from being remote bruteforce, to direct, personal attack on real human. Cloudflare CAPTCHA does not achieves that, because it does not authenticate user. It is simple verifies device model. That’s it.</p><p> 证明并不证明任何东西，除了设备模型 - 没有魔法证明。它不能证明用户的活力，因为CloudFlare只是证明检查。就是这样。 Fido真的很好地反对网络钓鱼和机器人，因为我们知道用户拥有该设备，并且它使用Fido将攻击移动到远程BruteForce，直接，个人攻击真正的人类攻击。 CloudFlare CAPTCHA不会实现这一目标，因为它没有验证用户。简单验证设备模型。就是这样。</p><p> Privacy — FIDO mandates that attestation Batch Certificate usage is at least ONE batch certificate per 100,000 devices. So if you know that Alice has Security Key with this certificate, and you see this certificate on another site, there is 1/100,000 chance that this is Alice. This does not sound like a lot, but when you combine together with all other tracking info that sites may keep on you, this becomes another piece of info that can be used against you, and as we all know, everything is run by Cloudflare today. Now this does not mean that attestation is completely useless. It is a very important mechanism in high compliancy environments. Banks, governments do need it, and recently Czech government announced that FIDO certified FIDO2 authenticators can be used for their national ID with eIDAS, and L2 certified devices can be used as high assurance proof. This is what you need attestation for. The 1% of situations when you need attestation.</p><p> Privacy  -  FIDO规定，证明批处理证书用法至少为每100,000个设备至少一个批处理证书。因此，如果您知道Alice与此证书有安全密钥，并且您在另一个站点上看到此证书，则会有1/100,000的机会，这是Alice。这听起来不像很多，但是当你与所有其他跟踪信息组合起来的网站可能会保持你的话，这成为另一个可以用于你的另一个信息，并且随着我们都知道，今天一切都是由CloudFlare经营的。现在这并不意味着证明是完全没用的。这是高度合规环境中的一个非常重要的机制。银行，政府确实需要它，最近捷克政府宣布，FIDO认证的FIDO2身份员可以使用EIDAS的国家ID，L2认证设备可作为高保证证明。这就是你需要证明的。当您需要认证时的1％的情况。</p><p> User experience — Popups are pain, and a lot of people just disable them in them because there are just simple too many popups. Attestation is bad for UX, you should avoid it.</p><p> 用户体验 - 弹出窗口是痛苦的，很多人只是在他们身上禁用它们，因为只有太多的弹出窗口。证明对UX不好，你应该避免它。 </p><p> Attestation is very hard to manage — You need to collect metadata for the devices(Somewhat solved by MDS). You need to know what fields do you need. You need to trust metadata. It’s a very hard problem, that requires good understanding of what you are doing.</p><p>证明很难管理 - 您需要收集设备的元数据（MDS的某种解决）。您需要知道您需要哪些字段。您需要信任元数据。这是一个非常艰难的问题，需要对你在做什么的良好理解。</p><p>  I personally think that in a, very short term Cloudflare’s solution will help with some bot. But understanding FIDO market, and knowing that security keys are first and foremost enterprise and backup authentication solution, and that the future of FIDO lying in wide deployment of the platform authenticators, leads me to believe that current solution will be widely abused with wider deployment, as it is explicitly targeted those who need and can afford security keys, enterprise.</p><p>  我个人认为，在一个非常短的术语中，CloudFlare的解决方案将有助于一些机器人。但了解Fido Market，并了解安全键是首先是企业和备份认证解决方案，而且FIDO的未来符合平台验证者的广泛部署，导致我相信当前解决方案将广泛滥用更广泛的部署，由于它明确地定位了那些需要的人，并且能够负担安全钥匙的企业。</p><p> I am not here to just crap on someones solution. I objectively believe that Cloudflare team, who do really cool things, have really cool and useful projects, did try to do something good. But in this specific case they are creating potentially even bigger problem while not solving what CAPTCHA was solving, making bad AI better day by day, until Skynet kills us all.</p><p> 我不是在这里只是对某人解决方案。我客观地相信CloudFlare团队，真正酷的事情，有真正酷炫的项目，确实尝试做一些好事。但在这个具体情况下，他们正在创造潜在的甚至更大的问题，同时没有解决验证码正在解决的问题，一天中的更好的一天，直到Skynet杀死我们所有人。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://herrjemand.medium.com/why-cloudflares-captcha-replacement-with-fido2-webauthn-is-a-really-bad-idea-d5487f6c7566">https://herrjemand.medium.com/why-cloudflares-captcha-replacement-with-fido2-webauthn-is-a-really-bad-idea-d5487f6c7566</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/captcha/">#captcha</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/设备/">#设备</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>