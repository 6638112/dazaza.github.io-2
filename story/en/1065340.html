<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我的第一个z80汇编语言计划 My first Z80 assembly language program</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">My first Z80 assembly language program<br/>我的第一个z80汇编语言计划 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-13 00:36:48</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/5bf9d5590e58042858b0440428d728ba.jpg"><img src="http://img2.diglog.com/img/2021/6/5bf9d5590e58042858b0440428d728ba.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>I was cleaning an old work area when I saw my old blue notebook that I used from 1986 to 1989. It had suffered the pass of time and dust.</p><p>当我看到我从1986年到1989年使用的旧版笔记本时，我正在清洁一个旧的工作区域。它遭受了时间和灰尘的传递。</p><p>  I thought it was the same notebook I had seen before, because I had two blue notebooks of the same model, but I lost one. And then to my surprise, I discovered it was the  lost second notebook, where I put my first Z80 assembly language program!</p><p>  我以为它是我以前见过的同样的笔记本，因为我有两个相同模型的蓝色笔记本，但我丢了一个。然后令我惊讶的是，我发现它是丢失的第二款笔记本，我把我的第一个Z80汇编语言程序划分了！</p><p> Pretty happy, I took pictures immediately of the important pages, just in case I lose again the notebook.</p><p> 很开心，我立即拍了重要页面，以防万一我再次丢失笔记本。</p><p>    I was 9 years old and I wanted to write amazing games. Of course, I was too young to create something in the league of the games that I was watching in magazines at the time like Compute! and Input MSX.</p><p>    我9岁了，我想写神奇的比赛。当然，我太年轻，无法在比赛中创造一些东西，我在筹备时在杂志看着杂志！并输入MSX。</p><p> After four years of writing games in BASIC language, I felt like I was stopped by the slowness inherent to an interpreted language.</p><p> 经过四年的基本语言写作游戏，我觉得我被脓肿所固有的解释语言所固有的。</p><p> This game was written around June 1988, my father was giving a lecture on programming the VDP processor TMS9128. The video processor was pretty available at the time (via Digikey) because the demise of all computers using it.</p><p> 这款游戏于1988年6月左右编写，我的父亲正在讲课编程VDP处理器TMS9128。视频处理器当时（通过Digikey）非常可用，因为使用它的所有计算机的消亡。</p><p>  The students had been soldering their computers based on Z80 over a copper board perforated with holes spaced by 0.1&#34;</p><p>  学生一直在Z80上焊接到铜板上的Z80，其悬挂在孔中，孔间隔0.1＆＃34; </p><p> Unfortunately my hands weren&#39;t able at the time to handle precisely a soldering iron, so I had been watching awkwardly how the students enjoyed building their computers, how they managed to get them running, and how they troubleshooted their bugs.</p><p>不幸的是，我的双手Weren＆＃39;当时恰当地处理烙铁，所以我一直在看着学生喜欢建立他们的电脑的学生，他们如何让他们跑步，以及他们如何排除他们的错误。</p><p>  This gave me plenty of time to think about the Z80 assembler programming concept, I had been unable to grasp the concept of how to put together the instructions. The previous weeks before that Sunday (I can remember it was Sunday), while watching my father putting together the monitor/VDP/Keyboard EPROM code for the students computer, finally I had the imaginary light bulb over my head. Of course! Several instructions compose a BASIC language statement, so it was a matter of doing the same but in assembler.</p><p>  这给了我有足够的时间来考虑Z80汇编程序编程概念，我一直无法掌握如何放在一起说明的概念。前几周在那个星期天（我能记得是星期天），同时看着我的父亲把监视器/ VDP /键盘EPROM代码放在一起，最后我在我的头上有了想象的灯泡。当然！有几个指令撰写了基本语言语句，因此这是一个做同样但在汇编程序中的问题。</p><p> The Sunday morning before class, I started writing furiously over my notebook a game about a karateka fighting a woman launching knifes. I had the whole idea on my head, now I realize for the first time I had the BASIC algorithm clearly in my mind. It was only a matter of translating it to assembler. I had realized that the line separation of BASIC was invisible on assembler, but each address could be related to that imaginary line number in BASIC language.</p><p> 上课前的星期天早上，我开始疯狂地写在我的笔记本上一场关于一个关于一个karateka战斗女人发射刀的游戏。我对我的头脑有全面的想法，现在我第一次意识到我在我的脑海中首次实现了基本算法。这只是将它转化为汇编程序的问题。我已经意识到基本的线路分离在汇编程序上是看不见的，但每个地址可能与基本语言中的虚线编号相关。</p><p> You can imagine the surprise of the whole class when I showed my game proudly. I remember three students copying manually the code from the RAM dump and then making Xerox copies for the other students.</p><p> 当我自豪地向我的游戏展示时，你可以想象整个班级的惊喜。我记得三个学生手动复制来自RAM转储的代码，然后为其他学生制作Xerox副本。</p><p>  Here are the pictures of my notebook. You&#39;ll need to forgive my terrible kid letters. Barely any comments but anything you see will be in Spanish, because that is my first language.</p><p>  这是我的笔记本的照片。你＆＃39; ll需要原谅我可怕的孩子的信。几乎没有任何评论，但你所看到的任何东西都将是西班牙语，因为这是我的第一语言。</p><p> While commenting each page (and analyzing my novice 9 years old myself!), I&#39;ll translate this game to tniASM v0.44 for both MSX and Colecovision (just because). We need the following translation and support layer because we don&#39;t have at hand the original ROM from the students computer:</p><p> 在评论每个页面时（并分析我的新手9岁！），i＆＃39; ll为msx和colecovision（仅仅因为）将此游戏转换为tniasm v0.44。我们需要以下翻译和支持层，因为我们没有从学生计算机手中掌握原来的ROM：</p><p>    So here is the page 1 of my Z80 game. The source code at right was written thinking in putting it inside an assembler program that I was going to develop (imagine that, a 9 years old ambitiously thinking in writing an assembler!).</p><p>    所以这是我Z80游戏的第1页。右边的源代码是写作在将它放入我将要开发的汇编程序内（想象一下，常见地思考汇编的汇编程序！）。 </p><p> To enter this game into the students&#39; computer, one needs to enter only the microcode at the left. If you found an error on the right side source code is because it is mean to be as reference only.</p><p>将此游戏输入学生＆＃39;计算机，人们只需要仅在左侧输入微代码。如果您在右侧源代码上发现错误是因为它意味着仅作为参考。</p><p> The code basically setups the game and creates a game loop. I misspelled NAVAJA (knife) as NEVAJA. Notice how I replaced PONEHL for a similar MSX routine WRTVDP. The INMEDIATO routine copies the following bytes directly to VDP until finding a zero byte.</p><p> 代码基本上设置了游戏并创建了一个游戏循环。我拼错了Navaja（刀）作为涅瓦宫。请注意，我如何替换类似MSX例程WRTVDP的POEHL。 InMediato例程将以下字节直接复制到VDP，直到找到零字节。</p><p>   Of course, I didn&#39;t had any idea of using directives except to put a byte at once. This is the title screen. &#34;PULSE ESPACIO&#34; means to press the keyboard space bar. I changed it to any trigger on MSX or Colecovision.</p><p>   当然，我没有任何想法使用指令，除了立即放一个字节。这是标题屏幕。 ＆＃34; pulse espacio＆＃34;手段按键盘空间栏。我将其更改为MSX或ColeCovision上的任何触发器。</p><p>   It uses an internal BIOS routine $04f5 to read the keyboard matrix, and it has been replaced with a MSX GTTRIG call (or Colecovision read of buttons).Then it setups the graphics for the karateka, the knife, and the judoka.</p><p>   它使用内部BIOS例程$ 04F5来读取键盘矩阵，它已被MSX GTTRIG呼叫（或读取按钮的COLecovision）替换。然后它设置了karateka，刀和judoka的图形。</p><p>   It now setups some variables for the position of the karateka, and the knifes shoot by the enemy. Also resets the kicks_given variable. It starts filling the color for the sky and grass.</p><p>   它现在为karateka的位置设置了一些变量，刀射在敌人。还会重置kicks_given变量。它开始填充天空和草的颜色。</p><p>   Then it cleans the screen and starts putting the characters on the screen to create visually the sky and grass. And yes, embarrassingly the 9 years old is repeating code like crazy!</p><p>   然后它清理屏幕并开始将屏幕上的字符放在视觉上的天空和草地上创建。是的，令人尴尬地，9岁是疯狂的重复代码！</p><p>   It sets the color for the enemy and then puts it on the screen by using defined characters. Then setups 3 variables, one of them is unused.</p><p>   它设置敌人的颜色，然后使用定义的字符将其放在屏幕上。然后设置3个变量，其中一个未使用。 </p><p>   For some unclear reason I set again the Register 1 of VDP, then it setups the start position for the player. Notice the microcode says 3E 68 corrected while the source code at right reads LD A,70 putting the player under the floor.</p><p>对于一些不明确的原因，我再次设置VDP的寄存器1，然后它设置了播放器的起始位置。注意微码表示3E 68纠正，而右侧源代码读取LD A，70将播放器放在地板下方。</p><p> The movement is left and right, up for punchs, and down for kicks. Again the keyboard reading has been replaced for MSX GTSTCK (translated for Colecovision).</p><p> 该运动是左右的，为拳击，然后踢球。再次键盘读数已被替换为MSX GTSTCK（为ColeCovision翻译）。</p><p>   I think I was going through a mental compilation of BASIC to assembler, only that could explain why the code is pretty unoptimized. Optimizing it a little would have saved me lots of time re-entering the game into the computer.</p><p>   我想我正在经历一个基本的汇编程序的心理汇编，只能解释为什么代码非常不优化。优化它一点就会让我很多时间重新进入计算机。</p><p> Moving the karateka to left was accomplished simply by subtracting 8 to the X coordinate, and updating it also on the sprite attributes table. Also it animates the player between two frames.</p><p> 通过减去8到x坐标，通过减去x坐标，并在Sprite属性表上更新它来实现移动karateka。它还为两个帧之间的播放器设置动画。</p><p>   The movement to right replicates essentially the same code for left movement. It could have used the same subroutine by passing parameters on DE or BC registers.</p><p>   右侧的运动基本上是与左移动的相同代码。它可以通过在DE或BC寄存器上传递参数来使用相同的子程序。</p><p> Given it has no idea of the player direction, it checks the sprite frame to see in which direction he/she is facing. Another variable would have made it so much easier.</p><p> 鉴于播放器方向不知道，它检查精灵框架，看看他/她面临的方向。另一个变量会让它更容易。</p><p>   The code to punch enemy to left (GAI) and right (GAD), it simply updates the sprite to the punch frame, and calls NADEO (where it checks if enemy is hit), then it does a wait (stopping the whole game!) and restores the original sprite. I still needed to grasp the concept of independent objects.</p><p>   把敌人击到左（gai）和右（gad）的代码，它只是将Sprite更新到打孔框架，并调用Nadeo（它检查敌人是否被击中），然后它等一下（停止整个游戏！ ）并恢复原始精灵。我仍然需要掌握独立对象的概念。 </p><p>   The code to handle kicks is essentially a copy of the previous code. BOLAS is essentially saying Ay Caramba!</p><p>处理踢的代码基本上是先前代码的副本。博拉斯基本上都说艾萨比卡！</p><p>   After watching there was no way of avoiding the knifes, I implemented the jump for the karateka.</p><p>   观看后，没有办法避免刀，我为karateka实施了跳跃。</p><p> This is showing more thinking, like calling NEVAJA to keep the knifes moving. But still two separate routines, one to move player up, and one to move player down. Each with their own delay.</p><p> 这呈现出更多的思维，如叫Nevaja以保持刀具移动。但仍然是两个单独的例程，一个移动玩家，一个人搬下球员。每个人都有自己的延迟。</p><p>   Moving the knifes is simply a running counter from left to right, updating the screen.</p><p>   移动刀具只是从左到右的运行计数器，更新屏幕。</p><p> The kid couldn&#39;t solve how to make knifes closer to the enemy launching them, because the knifes cleared behind with spaces so these would have erased the right half of the enemy.</p><p> 孩子们可以解决如何让刀片更接近发射它们的敌人，因为刀子用空间落后，所以这些都会抹去敌人的右半部分。</p><p>   An amazing waste of bytes by repeating the same code to move a parallel knife on the  same column by using a different variable.</p><p>   通过使用不同的变量重复相同的代码，通过重复相同的代码将平行刀在同一列上移动平行刀，这是惊人的浪费。</p><p>   Again a waste of bytes to delete each knife separately, when both come together. Probably I was thinking on having them appear on different times, but couldn&#39;t figure how to do it. The MALORA function (baddy) checks if the knifes hit the player, again checking each knife separately.</p><p>   当两者一起融合时，再次浪费字节以单独删除每刀。可能我在考虑让他们出现在不同的时期，但是＆＃39; t图案如何做到这一点。 Malora功能（Baddy）检查刀具是否击中了玩家，再次单独检查每刀。 </p><p>   The MUERTO (dead) function simply fills the whole color table with a random colors (Hey! That&#39;s a special visual effect!) And stops before resetting to the internal monitor. Couldn&#39;t insert a jump to the main game because the RST 00 instruction only uses one byte, and a jump uses 3 bytes (remember I wasn&#39;t using an assembler) so for this time I changed it to jump to the game.</p><p>Muerto（死亡）功能只需用随机颜色填充整个颜色的表（嘿！那个特殊的视觉效果！）并在重置到内部监视器之前停止。 CONN＆＃39; t插入主游戏，因为RST 00指令仅使用一个字节，跳转使用3个字节（请记住我使用汇编程序而不是使用汇编程序）所以我改变了它跳转到游戏。</p><p>   Finally my first working subroutine NADEO, called 4 times to check for enemy being hit. I cannot figure what I was trying to abbreviate there. The hit check is simple, if the player is standing exactly where the knifes appear, it will hit the enemy, of course I was trying to make him/her to be hit by the knifes. Unfortunately this exact position is hitting on the air, and there is no visual indication of hit...</p><p>   最后我的第一个工作子程序Nadeo，叫4次来检查敌人被击中。我无法弄清楚我试图缩写的东西。当播放器完全站在刀片出现的位置时，命中检查很简单，它会击中敌人，当然我试图让他/她被刀命击中。不幸的是，这种确切的位置在空中击中，并且没有击中的视觉迹象......</p><p>      Obviously I wrote the whole game from my brain to paper, and didn&#39;t planned for a delay to make the game playable. This code handles it and also the jumping.</p><p>      显然，我从我的大脑中写下​​了整个游戏，并计划了延迟使游戏可玩的延迟。此代码处理它以及跳跃。</p><p> Notice how I didn&#39;t use interrupts, I didn&#39;t knew about interrupts at the time, but the simple idea of having a constant time reference in terms of video frames would have blown my mind!</p><p> 注意我如何使用中断，我没有知道当时的中断，但在视频帧方面具有恒定时间参考的简单思想将吹嘘我的想法！</p><p>   This page doesn&#39;t need to be ported as VPOKE is replaced by the WRTVRM routine. And VPEEK isn&#39;t used. By the way, this shows the influence of my Input MSX magazine readings.</p><p>   此页面不需要移植为VPoke被WRTVRM例程所取代。和vpeek isn＆＃39;使用。顺便说一下，这表明我的输入MSX杂志读数的影响。</p><p>   These pages comprise the graphics for the game. There should be squared paper somewhere containing my original drawings but I don&#39;t have found them.</p><p>   这些页面包括游戏的图形。应该有一个包含我的原始图纸的方形纸，但我没有找到它们。</p><p>   The last page contains documentation of the variables used and half of it is desynchronized, and the knife 3 wasn&#39;t implemented. It&#39;s a practical example of real documentation :P</p><p>   最后一页包含使用的变量的文档，其中一半是去同步的，并且刀3 WASN＆＃39; t实施。它＆＃39;是真实文件的实际例子：p </p><p>    Karate2.zip ROM files for Colecovision and MSX (17 kb), programmed in one day with all my tools. It is the game as it looked on my 9 years old mind.</p><p>Karate2.zip ROM文件for ColeCovision和MSX（17 KB），在一天内编程到所有工具。 这是游戏，因为它看着我9岁的心灵。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://nanochess.org/notebook.html">https://nanochess.org/notebook.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/汇编/">#汇编</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/汇编语言/">#汇编语言</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/assembly/">#assembly</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/游戏/">#游戏</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>