<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>修复快速查找和修复回归 Fix Fast for finding and fixing regressions</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Fix Fast for finding and fixing regressions<br/>修复快速查找和修复回归 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-02-25 05:30:37</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/2/43c3d47f916c90faf24a9c7d645807b8.jpg"><img src="http://img2.diglog.com/img/2021/2/43c3d47f916c90faf24a9c7d645807b8.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Every workday, Facebook engineers commit thousands of diffs (which is a change consisting of one or more files) into production. This code velocity allows us to rapidly ship new features, deliver bug fixes and optimizations, and run experiments. However, a natural downside to moving quickly in any industry is the risk of inadvertently causing regressions in performance, reliability, or functional correctness.</p><p>每个工作日，Facebook工程师都会将数千个差异（由一个或多个文件组成的更改）投入生产。这种代码速度使我们能够快速发布新功能，提供错误修复和优化以及运行实验。但是，在任何行业中迅速采取行动的自然弊端是无意间导致性能，可靠性或功能正确性下降的风险。</p><p> To enable us to scale our developer infrastructure to this volume — while also mitigating and minimizing regressions — we build tools and mechanisms to help engineers understand whether a diff has introduced (or will introduce) a regression. We consider the feedback we get from these tools as signals. Signals  can be generated by automated tests, static analysis frameworks, performance logs, crash dumps, bug reports, production monitoring alarms, and dozens of other sources. These signals can be surfaced at any stage of the development life cycle. A given diff can generate hundreds of signals — including errors, successes, and warnings — that can help an engineer assess whether that diff is ready to be landed into a stable branch and begin making its way into production. After a diff has landed, signals are usually delivered to engineers via our task management system. An individual engineer can easily have hundreds of tasks in their backlog.</p><p> 为了使我们能够将开发人员基础结构扩展到此数量（同时还减少和最小化回归），我们构建了工具和机制来帮助工程师了解差异是否引入了（或将引入）回归。我们将从这些工具获得的反馈视为信号。信号可以通过自动测试，静态分析框架，性能日志，崩溃转储，错误报告，生产监控警报以及许多其他来源生成。这些信号可以在开发生命周期的任何阶段浮出水面。给定的差异可以生成数百个信号-包括错误，成功和警告-可以帮助工程师评估该差异是否已准备好进入稳定的分支并开始进入生产。差异到达后，通常会通过我们的任务管理系统将信号发送给工程师。单个工程师可以轻松地在其积压中处理数百个任务。</p><p> With so many signals being generated, it can quickly become overwhelming for engineers to know where to focus their time. A very important signal could get overlooked because it was drowned out by noisy, lower-priority signals — making it harder for engineers to quickly or easily assess the relative priority for each signal. They might spend hours debugging an issue that turned out to be noise, or lack the necessary information to help them diagnose and fix it.</p><p> 由于产生了如此多的信号，工程师很快就不知道该把时间集中在什么地方了。一个非常重要的信号可能会被忽略，因为它被嘈杂的低优先级信号淹没了，这使工程师更难于快速或轻松地评估每个信号的相对优先级。他们可能花费数小时来调试一个原来是噪音的问题，或者缺少必要的信息来帮助他们进行诊断和修复。</p><p> Over time, as we built more tools and monitoring systems, the signal volume increased until it became a persistent distraction. Eventually, we realized we needed a more effective way to help engineers easily see what to work on first, and spend less time debugging and fixing issues.</p><p> 随着时间的流逝，随着我们建立更多的工具和监视系统，信号量不断增加，直到持续分散注意力。最终，我们意识到我们需要一种更有效的方法来帮助工程师轻松地了解要做什么，并花费更少的时间调试和解决问题。</p><p>  We’ve seen that defects become exponentially more time consuming to fix as they progress further along the development process. This is true for most manufacturing industries, whether you are producing automobiles, building skyscrapers, or shipping software. We clearly see this in our own data:</p><p>  我们已经看到，随着缺陷在开发过程中的不断发展，修复这些缺陷的时间成倍增加。对于大多数制造业来说，都是如此，无论您是生产汽车，建造摩天大楼还是运输软件。我们在自己的数据中清楚地看到了这一点：</p><p> A defect detected in the integrated development environment (IDE) while an engineer is coding, can be fixed in minutes.</p><p> 工程师在编码时在集成开发环境（IDE）中检测到的缺陷可以在几分钟之内修复。</p><p>  If that same defect is allowed to land and make its way into production, it can take days to deliver a fix.</p><p>  如果允许同一缺陷着陆并投入生产，则修复可能需要几天的时间。 </p><p>  Any solution designed to decrease fix times would need to ensure that regressions were being detected and fixed  as early as possible in the process.</p><p>任何旨在减少修复时间的解决方案都需要确保在此过程中尽早检测到并修复了回归问题。</p><p>  To address these challenges, we launched our cross-functional effort, dubbed Fix Fast, in 2019. Fix Fast brings together the engineering teams responsible for generating the lion’s share of signals representing regressions in performance, reliability, and functional correctness. The mission of this effort was to reduce the effort required to fix regressions at scale by improving the engineering experience and by moving actionable detection further upstream.</p><p>  为了应对这些挑战，我们于2019年启动了跨功能工作，称为FixFast。FixFast召集了工程团队，负责生成代表性能，可靠性和功能正确性回归的大部分信号。这项工作的任务是通过改善工程经验和将可行的检测移到更上游来减少大规模修复回归所需的工作。</p><p> While the high-level strategy was clear, we still had some big questions to answer: Which problems should we start with? How should we measure progress? We knew we’d need a data-driven approach to execute against this goal at Facebook scale, so we started by finding a way to measure the level of effort and set benchmarks.</p><p> 尽管高层战略很明确，但我们仍然要回答一些大问题：我们应该从哪些问题入手？我们应该如何衡量进度？我们知道我们需要一种数据驱动的方法来在Facebook规模上实现此目标，因此我们首先找到一种方法来衡量工作量并设定基准。</p><p>  In pursuit of a metric, we considered many options. Ultimately, we landed on a metric that would incentivize engineers to “shift left,” a common industry practice of detecting (and fixing) regressions as early in the development life cycle as possible. As mentioned above, helping engineers detect and fix an issue in the IDE while they are still focused on that block of code is significantly less time-consuming doing so once the code is live in production.</p><p>  为了追求指标，我们考虑了许多选择。最终，我们采用了一种激励工程师“向左移动”的度量标准，这是一种行业惯例，即在开发生命周期的早期尽可能早地检测（并修复）回归。如上所述，帮助工程师在仍专注于该代码块的同时在IDE中检测和修复问题的过程大大减少了耗时，因为一旦将代码投入生产后就可以这样做。</p><p> We developed a uniform top-level metric, called cost per developer (CPD), such that earlier stages of a fix were given a lower weighted cost than later stages. (Note that the term   cost  is used to represent the amount of time an engineer spends fixing an issue, as opposed to a direct dollar amount.) Weights for each stage were established by analyzing internal data and applying rigorous backtesting to determine the relative amount of time engineers were already spending fixing regressions in each stage. This approach encouraged detection and prevention of issues in the earlier stages of the life cycle. It also incentivized engineers to focus on noise reduction, signal actionability, and other intra-stage improvements. This helps ensure not only that signals are detected, but also that the relevant engineers are able to quickly fix the issues before the code moves to the next stage of the development life cycle.</p><p> 我们开发了一个统一的顶级度量标准，称为“每位开发人员成本”（CPD），从而使修复的较早阶段获得的加权成本低于后来的加权成本。 （请注意，术语“成本”用于表示工程师花费在解决问题上的时间，而不是直接的美元金额。）每个阶段的权重是通过分析内部数据并进行严格的回测以确定相对数量来确定的。时间工程师已经在每个阶段花费固定的回归。这种方法鼓励在生命周期的早期阶段发现和预防问题。它还激励工程师专注于降低噪声，信号可操作性以及其他阶段内改进。这不仅有助于确保检测到信号，而且可以确保相关工程师能够在代码移至开发生命周期的下一个阶段之前快速解决问题。</p><p> By evaluating progress against CPD, the team was able to take a quantitative approach to tracking projects within each stage to help reduce the engineering time spent fixing regressions.</p><p> 通过根据CPD评估进度，团队能够采用定量方法来跟踪每个阶段中的项目，以帮助减少花费在修复回归上的工程时间。</p><p>   Once CPD was in place, the Fix Fast team developed a playbook of approaches that had made proven improvements in shifting left, noise reduction, actionability, and more.</p><p>   一旦CPD到位，Fix Fast团队就会开发出一系列方法，这些方法已证明在左移，降噪，可操作性等方面得到了改善。 </p><p>  Earlier detection is by far the number one way to reduce fix times. Automated tests are important to ensure that regressions are not promoted into production. However, running tests in continuous integration and production require a significant amount of data center capacity and time. Given the sheer number of diffs that need to be tested each day, and the number of tests to choose from, we’ve employed   complex heuristics and machine learning algorithms  to help choose the best tests to run at each stage, taking into account the amount of time and capacity available. On a typical day, Facebook runs millions of tests on diffs alone.</p><p>到目前为止，早期检测是减少修复时间的第一方法。自动化测试对于确保不将回归推广到生产中非常重要。但是，在持续集成和生产中运行测试需要大量的数据中心容量和时间。考虑到每天需要测试的差异数量非常之多，以及可供选择的测试数量，我们采用了复杂的试探法和机器学习算法，以帮助您在每个阶段选择最佳测试，并考虑了数量可用的时间和容量。通常，Facebook仅在diff上运行数百万次测试。</p><p> We are also developing automated tests within the IDE to allow engineers to run a subset of tests while they are coding, before they even submit their code for review. IDE test results are returned in minutes. By taking this approach, engineers can now get test signals 90 percent sooner, and we have decreased the number of post-commit failures by more than 10 percent.</p><p> 我们还在IDE中开发自动化测试，以使工程师在编写代码时就可以运行测试的子集，甚至无需提交代码进行审查。 IDE测试结果将在几分钟内返回。通过采用这种方法，工程师现在可以更快地获得90％的测试信号，并且我们将提交后失败的次数减少了10％以上。</p><p>  Reducing noisy, duplicated, or unactionable signals is important for ensuring that engineers know which signals are important and can quickly fix any underlying regressions.</p><p>  减少嘈杂的，重复的或不可操作的信号对于确保工程师知道哪些信号很重要并可以快速修复任何潜在的回归非常重要。</p><p> To address this, we first had to understand which signals were resulting in useful outcomes. After manually analyzing hundreds of such signals, we developed a heuristic, called meaningful action, to represent tasks that were useful and resulted in some action by an engineer. The meaningful action heuristic considers human comments, diffs attached to a task, or other nontrivial actions. By systematically removing the unhealthy bots (those more likely to produce noisy or otherwise inactionable signals), we were able to dedupe signals and map them to the right regression metrics with a reasonable threshold for triggering. Accurate and actionable information was added to the tasks to give users clear direction on issue fixing.</p><p> 为了解决这个问题，我们首先必须了解哪些信号正在产生有用的结果。在手动分析了数百种此类信号之后，我们开发了一种启发式的方法，称为有意义的动作，以表示有用的任务，并导致工程师采取某些行动。有意义的启发式行动考虑了人类的评论，与任务相关的差异或其他非平凡的行动。通过系统地删除不健康的漫游器（更可能产生嘈杂或无法使用的信号），我们能够对信号进行重复数据删除并将其映射到具有合理触发阈值的正确回归指标。准确且可操作的信息已添加到任务中，为用户提供了解决问题的明确指导。</p><p> One example of this is   Health Compass , where we successfully improved the meaningful action ratio by 20 percent last year by reducing noise and tuning the regression detection logic.</p><p> 健康指南针就是一个例子，去年，我们通过减少噪音和调整回归检测逻辑，成功地将有意义的行动比率提高了20％。</p><p>   Getting the signal in front of the right person the first time can shave days off of fix time. But this is often easier said than done. When a task is assigned to the wrong owner, it can ping-pong around the company before finally landing with someone who can fix it. In internal testing, we found that for tasks that had three or more owners before being resolved, close to 50 percent of the task’s cycle time was spent on ping-pong reassignments before reaching the correct owner.</p><p>   第一次在正确的人面前发出信号可以使修复时间减少几天。但这通常说起来容易做起来难。将任务分配给错误的所有者后，它可以在公司周围进行乒乓球运动，然后最终与可以修复该问题的人员一起着陆。在内部测试中，我们发现，对于在解决之前拥有三个或三个以上所有者的任务，在达到正确所有者之前，将近50％的任务周期时间用于乒乓球重新分配。</p><p> One win was achieved by simply adding an “I’m not the right owner” button to the task. Previously, engineers had to track down the next best owner themselves, which could create a significant delay and prevent them from moving on to a new task. Now, when an engineer indicates that they are not the right person to fix an issue, the ownership selection algorithm engages the next best prediction on whom to assign the task. This data is also being used to help improve our ownership selection algorithm over time.</p><p> 只需在任务中添加“我不是正确的所有者”按钮，即可获得胜利。以前，工程师必须自己寻找下一个最好的所有者，这可能会造成很大的延迟，并阻止他们继续执行新任务。现在，当工程师表明他们不是解决问题的合适人选时，所有权选择算法将根据下一个最佳预测来分配任务。随着时间的推移，该数据还被用于帮助改进我们的所有权选择算法。 </p><p> Better regression triage and root cause analysis are important to solving this. One of the biggest success stories in this area is our multisect service. Multisect analyzes a branch to trace the root cause back to the specific diff where a regression was introduced. This year, we worked on speeding up this process. As a result, we can now find the right diff three times faster than before.</p><p>更好的回归分类和根本原因分析对于解决此问题很重要。该领域最大的成功案例之一就是我们的多部门服务。 Multisect分析分支以将根本原因追溯到引入回归的特定差异。今年，我们致力于加快这一过程。结果，我们现在可以找到比以前快三倍的正确差异。</p><p>  Implement a land-blocking signal to help prevent regressions from being promoted. Null pointer exceptions (NPE) are a common crash type that affect hundreds of millions of Android users of Facebook’s family of apps. Making Java classes NullSafe is an important step toward reducing and eliminating these crashes.</p><p>  实施障碍信号，以防止阻止回归。空指针异常（NPE）是一种常见的崩溃类型，会影响Facebook应用程序家族的数亿Android用户。使Java类成为NullSafe是减少和消除这些崩溃的重要一步。</p><p> Our data has shown that non-NullSafe Java files are three times more likely to result in NPE crashes than Java files that are NullSafe. The more NullSafe issues a file has, the more likely it is to be associated with NPE crashes. In 2020, we applied static analysis to help us detect code that’s not yet NullSafe and to provide engineers with tools to rapidly fix these issues. But perhaps more important, once a class has no more NullSafe issues, it is marked with an @NullSafe annotation. This blocks the code from being promoted again if any new NullSafe issues are introduced.</p><p> 我们的数据表明，非NullSafe Java文件导致NPE崩溃的可能性是NullSafe Java文件的三倍。 NullSafe问题越多，文件与NPE崩溃相关的可能性就越大。 2020年，我们进行了静态分析，以帮助我们检测尚未使用NullSafe的代码，并为工程师提供快速解决这些问题的工具。但是，也许更重要的是，一旦类不再有NullSafe问题，它就会被@NullSafe注释标记。如果引入了任何新的NullSafe问题，这将阻止代码再次被提升。</p><p>   By implementing all of these procedures, we are able to detect a greater percentage of regressions earlier in the engineering life cycle, thereby reducing the overall effort required to fix these regressions. Additional work in machine learning and other techniques is ongoing, to monitor and refine the best mixture of early detection techniques at scale.</p><p>   通过实施所有这些过程，我们能够在工程生命周期的早期阶段检测出较大百分比的回归，从而减少了修复这些回归所需的总体工作。机器学习和其他技术的其他工作正在进行中，以大规模监控和完善早期检测技术的最佳组合。</p><p> We have also established a robust set of metrics, which help ensure that the quality of regression signals being delivered to engineers is sufficient for them to quickly triage, diagnose, and repair underlying regressions without overwhelming them with potentially noisy or duplicative signals. In the near future, we will be investing in systems that can automatically tune the sensitivity of regression detectors without requiring an engineer to proactively monitor these metrics. For example, a detector that is producing potentially noisy or inactionable signals can be temporarily disabled until an engineer can diagnose the problem, thus preventing unnecessary noise from being generated.</p><p> 我们还建立了一套可靠的指标，有助于确保传递给工程师的回归信号的质量足以使他们快速分类，诊断和修复潜在的回归，而不会因潜在的嘈杂或重复信号而使他们不知所措。在不久的将来，我们将投资能够自动调整回归检测器灵敏度的系统，而无需工程师主动监控这些指标。例如，可以暂时禁用正在产生潜在噪声或无效信号的检测器，直到工程师可以诊断问题为止，从而防止产生不必要的噪声。</p><p> Ultimately, these techniques have proved beneficial not only for engineers, who reduce the amount of time they spend fixing regressions, but also for customers, who benefit from fewer regressions and faster fixes.</p><p> 最终，事实证明，这些技术不仅有益于工程师，他们减少了花费在修复回归上的时间，而且还受益于客户，他们从更少的回归和更快的修复中受益。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://engineering.fb.com/2021/02/17/developer-tools/fix-fast/">https://engineering.fb.com/2021/02/17/developer-tools/fix-fast/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/修复/">#修复</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/fast/">#fast</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/工程师/">#工程师</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>