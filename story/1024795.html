<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Python 3.8中的类型注记</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Python 3.8中的类型注记</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-18 16:12:45</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/2671e44894df6b9621d0f6ed353eaf42.png"><img src="http://img2.diglog.com/img/2020/9/2671e44894df6b9621d0f6ed353eaf42.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Python如此容易入门的原因之一是它具有动态类型。您不必指定变量的类型，只需将变量用作数据容器的标签。但在较大的项目中，拥有类型是有帮助的。如果您有一个没有记录的没有类型的函数，可能还有糟糕的变量命名，新的开发人员将会遇到困难。幸运的是，在带有PEP526🎉的Python3.6中添加了变量注释。</p><p>这篇文章的写作方式是，您可以很容易地在“mypy”部分之后停下来，然后只看一下各个部分。</p><p>有类型注释很好，但是您需要检查它们！不管您是否使用CPython、PyPy或其他更奇特的工具，Python运行时都不会这样做。</p><p>必须使用--IGNORE-MISSING-IMPORTS标志，否则您将收到许多这样的消息：</p><p>错误：跳过分析“setuptools”：找到模块，但没有类型提示或库存根。</p><p>为方便起见，我通常添加一个setup.cfg文件，在该文件中指定我始终希望应用此标志：</p><p>然后，您可以通过将以下部分添加到setup.cfg来pip install pytest-mypy，并确保在运行pytest时始终执行mypy：</p><p>需要注意的是，Python社区和mypy都假设您来自非类型注释代码库。他们想让您轻松切换到带注释的代码，从而支持渐进式键入。然而，这意味着如果您不注释代码，您可能会错过错误！Mypy有很多旗帜可以帮助你行动。您不需要注释所有内容。</p><p>键入模块添加了对类型提示的支持。它包含一些最常用的类型：List、Dict和Tuple。</p><p>类似地，您可以通过dict[str，int]注释字典将字符串映射到整数。所以list、dict和tuple都是泛型。Any只是指定可以在这些容器中包含任意数据的一种方式。当您开始向更大的代码库添加类型批注时，在开始时使用Any是合理的。</p><p>如前所述，mypy和Python支持渐进式输入。有时，您需要让类型检查器静音才能继续(希望稍后能修复它，🤞)。有几种方法可以通过键入来完成此操作：</p><p>Cast(SomeClass，变量)：有时mypy不够智能，所以您可以告诉它您使用的是哪种类型。在我知道打字之前我做过几次。超载。或者，您也可以添加assert isinstance(Variable，Someclass)。</p><p>因为你经常需要接受一些类型，而不接受任何类型，所以也有打字的问题，这是可选的。可选的[SomeType]与UNION[SomeType，None]相同。</p><p>键入.List类型表示列表。正如Jochen Ritzel所说的那样，Sequence是“一个随机访问的可迭代的”。例如，字符串是序列[any]，而不是列表[any]。</p><p>与示例LIST和SEQUENCE类似，tying.Dict主要用于表示字典，而typeing.Mapping更为通用。StacksonStacks给出了一个很好的答案。</p><p>TypedDict是在PEP-589中引入的，它提供了指示字典应该具有哪些键以及这些键的值具有哪些类型的可能性。PEP中的示例很好地说明了这一点：</p><p>通过键入import TypedDict class Movie(TypedDict)：Name：Str Year：INT Movie：Movie={&#39；Name&#39；：&#39；Blade Runner&#39；，&#39；Year&#39；：1982}。</p><p>默认情况下，它必须拥有所有密钥。您可以通过设置TOTALITY：Class Movie(TypedDict，Total=false)使关键点成为可选的。</p><p>键入模块知道更多类型，它们有时难以区分。例如，List、Sequence和Iterable之间有什么不同？请看一下收藏文档。</p><p>并非所有字符串都包含相同类型的内容。它们可以表示USER_ID、USER_NAME、PASSWORD_HASH、…。</p><p>特别是对于身份证，我已经看到这变得一团糟。我认为为那些不同的字符串类型创建自己的类是非常荒谬的，因为创建类通常是开发和维护开销。那么，你是做什么的？</p><p>T=TypeVar(&#39；T&#39；)#可以是任何A=TypeVar(&#39；A&#39；，字符串，字节)#必须是字符串或字节。</p><p>它看起来和新型的很相似，但是很不一样。NewType用于为给定类型创建有意义的别名。TypeVar用于指定泛型，例如，在下面的示例中，保证两个变量x和y属于同一类型，但它可以是任何类型：</p><p>Tying.Union有时是一种反模式，因为您还可以重载函数，如Josh Reed所示：</p><p>最近，我发现自己在模块级上进行了相当大的导入，这仅仅是因为类型检查。这感觉不对劲，所以我请求帮助。解决方案很简单：键入.TYPE_CHECKING。这在运行类型检查器时为真，但在正常运行❤️期间为假。</p><p>PEP544引入了结构子类型，并在Python3.8中引入。它给人的感觉就像Java中的Interfaces，其工作方式如下所示：</p><p>请注意，没有函数体。在该定义之后，您就可以像使用任何类型一样使用SupportsClose。</p><p>最酷的是，类foo与SupportsClose没有显式关系！它只是通过它的结构联系在一起的！</p><p>存根文件以.pyi结尾。如果mypy找到一个.py文件和一个.pyi文件，它只加载.pyi文件。它们类似于C++中的头文件，但对于Python而言。不使用函数体，而使用省略号...：</p><p>Pyright是微软编写的Python静态类型检查器，pyre是Facebook编写的，pytype是Google编写的。他们都自称比Mypy快，被采用率都比Mypy低。到目前为止我还没有用过它们。</p><p>$pip install pyre-check pytype#是，pyright是用打字稿写的...。$npm安装-g pyright。</p><p>变量注释还可以用来删除大量样板代码。例如，pydtic可以帮助您进行序列化/反序列化：</p><p>Andreas Dewes：在Python3中输入注释：Whats，Whys&amp；Wows！在2017年的EuroPython大会上。在YouTube上。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/analytics-vidhya/type-annotations-in-python-3-8-3b401384403d">https://medium.com/analytics-vidhya/type-annotations-in-python-3-8-3b401384403d</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/类型/">#类型</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1024541.html"><img src="http://img2.diglog.com/img/2020/9/thumb_89054ae6644bc7e64b3907e38aa46d90.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024541.html">一个100行Python的手写数学解析器</a></div><span class="my_story_list_date">2020-9-17 19:41</span></div><div class="col-sm"><div><a target="_blank" href="/story/1024447.html"><img src="http://img2.diglog.com/img/2020/9/thumb_79ec5933d4d3d05cfb68058c9db73502.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1024447.html">Python的内部：简介</a></div><span class="my_story_list_date">2020-9-17 5:56</span></div><div class="col-sm"><div><a target="_blank" href="/story/1023152.html"><img src="http://img2.diglog.com/img/2020/9/thumb_f92286ba30fe367758b6264f34bece2e.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1023152.html">同步与异步Python：有什么不同？</a></div><span class="my_story_list_date">2020-9-10 11:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1022939.html"><img src="http://img2.diglog.com/img/2020/9/thumb_d8f3984070b57ff59bf45eb18d74e00a.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1022939.html">使用gglot的API的交互式Python绘图库</a></div><span class="my_story_list_date">2020-9-9 20:23</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>