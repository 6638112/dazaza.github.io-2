<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>深入研究Python的官方Docker图像</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">深入研究Python的官方Docker图像</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-20 21:45:20</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/23b15fc551a88bd6c3b96cf317281423.png"><img src="http://img.diglog.com/img/2020/8/23b15fc551a88bd6c3b96cf317281423.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Docker的官方Python映像相当流行，事实上我推荐它的一个变体作为基础映像，但很多人不太了解它的作用，这可能会导致混乱和崩溃。</p><p>因此，在这篇文章中，我将详细介绍它是如何构建的，为什么有用，如何正确使用它，以及它的局限性。特别是，我将通读Python：3.8-Lem-Buster变体，截止到2020年8月19日，并在进行过程中对其进行解释。</p><p>也就是说，基本映像是Debian GNU/Linux 10，这是Debian发行版的当前稳定发行版，也称为Buster，因为Debian以“玩具总动员”中的角色命名它们的所有发行版。如果您想知道，Buster是Andy的宠物狗。</p><p>因此，首先，这是一个Linux发行版，它保证了随着时间的推移的稳定性，同时提供了错误修复。超薄的变体安装的软件包较少，因此没有编译器。</p><p>基本上，Python映像的工作方式是将Python安装到/usr/local，因此这确保了它安装的可执行文件是默认使用的可执行文件。</p><p>目前，在http://bugs.python.org/issue19846系统上设置##34；lang=C&34；从根本上破坏了Python3*，这是不对的。环境语言C.UTF-8。</p><p>据我所知，即使没有UTF-8，现代Python3也会默认使用UTF-8，所以我不确定现在有没有必要这么做。</p><p>以及一个带有GPG密钥的环境变量，用于在下载Python源代码时对其进行验证。</p><p>运行apt-get update&amp；&amp；apt-get install-y--no-install-Recommendations\ca-Certificate\netbase\&amp；&amp；rm-rf/var/lib/apt/list/*。</p><p>第一个是ca-Certificate，它是标准证书颁发机构的证书列表，与浏览器用来验证https：//URL的证书相当。这允许Python、wget和其他工具验证服务器提供的证书。</p><p>第二个是NetBase，它在/etc中安装一些文件，将某些名称映射到相应的端口或协议。例如，/etc/services将服务名称(如https)映射到相应的端口号，在本例中为443/tcp。</p><p>接下来，安装编译器工具链，下载Python源代码，编译Python，然后卸载不需要的Debian包：</p><p>运行set-ex\\&amp；&amp；avedAptMark=&#34；$(apt-mark showManual)&#34；\&amp；&amp；apt-get update&amp；&amp；Apt-get install-y--no-install-推荐\dpkg-dev\GCC\libBluetooth-dev\libbz2-dev\libc6-dev\libexpat1-dev\libffi-dev\libgdbm-dev\liblzma-dev\libncursesw5-dev\libreadline-dev\libsqlite3-dev\libssl-dev\&#34；GPG&#34；默认情况下不再包含$(COMMAND-V gpg&&gt;；/dev/null||ECHO&#39；GnuPG dirmngr&#39；)\\&amp；&amp；wget-O python.tar.xz&#34；https://www.python.org/ftp/python/${PYTHON_VERSION%%[a-z]*}/Python-$PYTHON_VERSION.tar.xz&#34；\&amp；&amp；wget-O python.tar.xz.asc&#34；Https://www.python.org/ftp/python/${PYTHON_VERSION%%[a-z]*}/Python-$PYTHON_VERSION.tar.xz.asc&#34；\&amp；&amp；导出GNUPGHOME=&#34；$(mktemp-d)&#34；\&amp；&amp；--Batch--keyserver ha.pool.sks-keyservers.net--recv-key&#34；$gpg_key&#34；\&amp；&amp；Gpg--Batch--验证python.tar.xz.asc python.tar.xz\&amp；&amp；{command-v gpgconf&gt；/dev/null&amp；&amp；gpgconf--全部删除||：；}\&amp；rm-rf&#34；$GNUPGHOME&#34；python.tar.xz.asc\&amp；&amp；mkdir-p。Tar-xjc/usr/src/python--strie-component=1-f python.tar.xz\&amp；&amp；&amp；rm python.tar.xz\\&amp；&amp；cd/usr/src/python\&amp；&amp；gnuArch=&#34；$(dpkg-Architecture--query DEB_BUILD_GNU_TYPE)&#34；\&amp；&amp；/configure\--。\--enable-loadable-sqlite-tensions\--enable-Optimations\--enable-option-checking=FATAL\--enable-Shared\-with-system-expat\-with-system-ffi\--less-ensurepip\&amp；&amp；make-j&#34；$(Nproc)&#34；\LDFLAGS=&#34；-wl，--strie-all&#34；\&amp；&amp；make install\。Rm-rf/usr/src/python\\&amp；&amp；find/usr/local-Deep\\(\\(-type d-a\(-name test-o-name test-o-name空闲_test\)\)\-o\(-type f-a\(-name&#39；*.pyc&#39；-o-name&#39；*.pyo&#39；-o-name&#39；*.a&#39；\)\-o\(-type f-a-name&#39；wininst-*.exe&*39；\)\\)-exec rm-rf&#39；{}&#39；+\\&amp；&amp；ldconfig\\&amp；&amp；apt-mark auto&39；.*&#39；&gt；/dev/null\&amp；&amp；apt-mark手册$avedAptMark\&amp；查找/usr/local-type f可执行文件-非\(-name&#39；*tkinter*&#39；\)-exec ldd&#39；{}&39；&#39；&#39；\|awk&#39；/=&gt；/{print$(NF-1)}&#39；\|排序-u\|xargs-r dpkg-query--搜索\|剪切-d：-f1\|排序-u\|xargs-r apt-mark手册\&amp；&amp；Apt-get purge-y--auto-remove-o apt：：AutoRemove：：RecommendsImportant=false\&amp；&amp；rm-rf/var/lib/apt/list/*\\&amp；&amp；python3--版本。</p><p>编译Python所需的包-GCC等-一旦不再需要就会被删除。</p><p>因为所有这些都发生在单个运行命令中，所以映像最终不会将编译器存储在其任何层中，从而使其保持较小。</p><p>您可能会注意到一件事，Python需要libBluetooth-dev来编译，我发现这很令人惊讶，所以我问，显然Python可以创建蓝牙套接字，但只有在安装了这个包的情况下才能编译。</p><p>#创建一些预期存在的有用符号链接，运行cd/usr/local/bin\&amp；&amp；ln-s idle3空闲\&amp；&amp；ln-s pydoc3 pydoc\&amp；&amp；ln-s python3 python\&amp；&amp；ln-s python3-config python-config。</p><p>PIP包下载工具有自己的发布时间表，这与Python的不同。例如，此Dockerfile安装的是2020年7月发布的Python 3.8.5。PIP 20.2.2是在8月份发布的，但Dockerfile确保包含较新的PIP：</p><p>#如果这被调用&#34；pip_version&#34；，pip将使用&#34；ValueError：无效的真值&#39；&lt；版本&gt；&#39；&#34；ENV Python_PIP_Version 20.2.2#https://github.com/pypa/get-pip ENV Python_GET_PIP_URLENV Python_GET_PIP_SHA256 d4d62a0850fe0c2e6325b2cc20d818c580563de5a2038f917e3cb0e25280b4d1 Run Set-ex；\\SavedAptMark=&#34；$(apt-mark showManual)&#34；；\apt-get update；\apt-get install-y--no-install-推荐wget；\\wget-O get-Pip.py&#34；$Python_GET_PIP_URL&#34；；\ECHO&#34；$Python_GET_PIP_SHA256*get-py.py&#34；|sha256sum-check-strict-；\\apt-mark auto&#39。&gt；/dev/null；\[-z&#34；$avedAptMark&#34；]||apt-mark手动$avedAptMark；\apt-get purge-y--auto-remove-o apt：：AutoRemove：：RecommendsImportant=false；\rm-rf/var/lib/apt/list/*；\\python get-Pip.py\-Disable-pip-version-check\-。Pip==$Python_pip_version&#34；\；\pip--version；\\find/usr/local-Deep\\(\\(-type d-a\(-name test-o-name test-o-name IDLE_test\)\)\-o\\(-type f-a\(-name&#39；*.pyc&#39；-o-name&#39；-o-name&#39；*.pyo&#39；\)\)\\)-exec rm-rf&#39；{}&#39；+；\rm-f get-pin.py。</p><p>通过使用带有空入口点的CMD，当您运行镜像时，默认情况下会得到python：</p><p>$docker run-it python：3.8th-buster Python 3.8.5(默认，2020年8月4日，16：24：08)[GCC 8.3.0]linuxType&#34；help&#34；，&#34；版权&#34；，&#34；信用&34；或&#34；许可证&#34；了解更多信息。&gt；&gt；&gt；</p><p>虽然这一点似乎显而易见，但值得注意的是它是如何包含的：它是/usr/local中的自定义安装。</p><p>对于使用此基本映像的人来说，一个常见的错误是使用Debian版本的Python重新安装Python：</p><p>这会在/usr而不是/usr/local中安装额外的Python，并且通常是不同版本的Python。您可能不希望在同一映像中安装两个不同版本的Python；大多数情况下，这只会导致混淆。</p><p>如果您真的想使用Debian版本的Python，那么可以使用debian：buster-slm作为基本映像。</p><p>例如，上一次发布Python3.5是在2019年11月，但是用于python：3.5-slm-buster的Docker映像包含来自2020年8月的pip。这(通常)是一件好事，它意味着您可以获得最新的错误修复、性能改进以及对更新的轮子变体的支持。</p><p>如果您希望略微加快启动速度，那么您可能希望将标准库源代码编译为您自己的映像中的.pyc文件，该文件包含Compileall模块。</p><p>虽然基本debian：buster-slm和python映像确实经常重新生成，但有些窗口已经发布了新的Debian安全修复程序，但是映像尚未重新生成。您应该安装基本Linux分发版的安全更新。</p><p>了解如何构建快速、可投入生产的Docker映像-阅读针对Python的Docker打包指南的其余部分。</p><p>从为您节省时间的快速构建到保证您安全的安全最佳实践，您如何快速获得打包Python应用程序用于生产所需的专业知识？</p><p>通过使用Docker Production QuickStart上的Python，快速了解最佳实践。</p><p>你需要在就业市场上保持竞争力--但是要学的东西太多了，你不知道从哪里开始。</p><p>加入2100多名Python开发人员和数据科学家的行列，学习实用工具和技术，从Docker打包到Python最佳实践，每周在您的收件箱中都会有一篇免费的新文章。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://pythonspeed.com/articles/official-python-docker-image/">https://pythonspeed.com/articles/official-python-docker-image/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/docker/">#docker</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dive/">#dive</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1017952.html"><img src="http://img.diglog.com/img/2020/8/thumb_de71493281044d99204e6c61e2742e2a.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1017952.html">Docker更新ToS：对免费帐户施加映像保留限制</a></div><span class="my_story_list_date">2020-8-13 23:19</span></div><div class="col-sm"><div><a target="_blank" href="/story/1017719.html"><img src="http://img.diglog.com/img/2020/8/thumb_b3ba3be9446e83deec9e1ee7ef72322c.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1017719.html">集装箱搭便车指南：万无一失的码头操作教程</a></div><span class="my_story_list_date">2020-8-12 22:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1017477.html"><img src="http://img.diglog.com/img/2020/8/thumb_fbf5bd74d86e8be9ffabf63e5a9c0132.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1017477.html">打包Python代码的选项：轮子、Conda、Docker等</a></div><span class="my_story_list_date">2020-8-11 14:12</span></div><div class="col-sm"><div><a target="_blank" href="/story/1016866.html"><img src="http://img.diglog.com/img/2020/8/thumb_30990b6cc2a5f781791e2cd6d0e02d6c.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016866.html">Docker安装和升级指南-CentOS和Ubuntu</a></div><span class="my_story_list_date">2020-8-7 22:13</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>