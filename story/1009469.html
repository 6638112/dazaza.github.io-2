<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Telia路由器上的RCE</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Telia路由器上的RCE</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-02 20:19:05</div><div class="page_narrow text-break page_content"><p>多个漏洞可能允许在Intranet服务器上运行任意代码，并在所有客户路由器上获得root访问权限。</p><p>Telia是一家瑞典跨国电信公司。它还在立陶宛运营，提供移动服务、FTTH互联网、DSL互联网和IPTV。Telia将定制路由器和机顶盒出租并出售给那些管理权限有限或几乎没有权限的客户。</p><p>每个Telia路由器或电视盒都有一个后门或管理接口。它是在VLAN 5和/或WAN上运行的SSH服务器。通常，它在端口8022上运行。较旧的型号，如ADB，启用了密码登录。最近的新型号，如Technicolor，禁用了密码登录，只使用带有公钥身份验证的ssh(剧透：它仍然容易受到攻击)。</p><p>Savitarna(立陶宛语)-是一种网络服务https://www.telia.lt/mano/sso，允许Telia客户订购和管理服务、获取发票、支付账单等。它使用密码验证或外部权威登录，如facebook、谷歌、银行、数字签名等。其中一个新功能：更改路由器的wifi密码。听起来很有趣，对吧？一种互联网Web服务，可以更改本地路由器的WiFi密码。</p><p>这是怎么运作的。当用户想要更改密码时，Web服务调用后端来启动到用户的关联路由器的SSH连接。根据路由器的不同，它可以是密码身份验证，也可以是RSA公钥。成功登录后，后端的PHP脚本将在路由器的shell中发出一些命令，解析结果，并在Web UI中将某些数据(如无线网络名称)输出给用户。Telia知道您的纯文本WiFi密码，请记住这一点，不要在任何地方重复使用此密码。总体方案：</p><p>让我们来看看SSH连接是如何建立的。网络捕获显示SSH客户端标语和发起连接的远程IP：</p><p>而且，是的，事实证明Telia的客户端不会尝试验证远程服务器的公钥。我们能够在同一端口8022上启动自定义SSH服务器，Savitarna甚至无需尝试验证中间人即可成功建立连接。这意味着我们可以看到使用的密码，并可以尝试创建利用Telia端公开漏洞的恶意SSH服务器。</p><p>这是一项简单的任务。一旦Telia的客户端连接到我们的恶意SSH服务器，我们就获得了通用路由器凭据：</p><p>您还拥有ADB路由器吗？只需使用此用户通过Web界面登录即可。您现在是管理员。你现在可以做一些受限制的事情了，太棒了！但是根壳呢？我们能够在本地连接到这些凭据，并获得了一个有限的外壳。那也不错。这给了我们很多隐藏在路由器内部的额外信息，更多的漏洞。使用其中一个，我们能够升级到root，并获得对该设备的完全访问权限。像Technicolor这样的较新型号需要一些额外的连锁攻击才能获得完全的root访问权限，但所有这些都是公开可用的，而且非常容易做到。</p><p>为了利用RCE，我们需要构建一个完全复制Telia的PHP客户端的虚拟测试环境。我们已经一步一步地检查了通过SSH发送的Telia命令序列。最后，我们得到了在我们的测试实验室中运行的恶意SSH服务器和测试libssh2客户端。有了这台服务器，我们可以完全控制协议并开始模糊化。</p><p>在模糊的最初几天，我们遇到了一些崩溃，并部分确认了RCE可能会被利用。下面是一个示例GIF视频，它演示了Fuzzer为我们发现的两种问题。同一个php文件执行了两次，但恶意SSH服务器发送了不同的负载，导致：</p><p>然而，在报告发布时，我们找不到一种简单的方法来利用堆栈损坏。这可能需要更多时间、更长时间和更复杂的模糊处理，以及更多关于服务器的知识。由于立陶宛法律禁止在真实服务器上进行漏洞攻击测试，我们只能对Windows操作系统进行指纹识别，但仅此而已。</p><p>后端似乎只运行5个php进程，因此通过保持停滞的ssh连接来执行DoS是相当容易的。当SSH连接长时间保持活动状态，填充所有5个php进程时(读取远程shell似乎没有超时)，Savitarna将显示一条奇怪的消息&#34；Maintenance&34；：</p><p>更新正在进行中您中的许多人正在尝试访问新的Telia网页。我们正在扩展资源，并将很快接受所有人。对于给您带来的不便，我们深表歉意。</p><p>如果我们现在聚集在一起，攻击者就可以利用Intranet服务器上的RCE，并使用该服务器横向移动(因为10.0.98.251到处都被列入白名单)，跨越所有具有相同凭据的客户路由器，从而创建立陶宛最强大、最持久、最不可检测的僵尸网络。谁知道呢，也许有人已经利用了这一点？(剧透：参见奖金部分)。</p><p>这份报告被负责任地披露给了Telia，并将一份副本发送给了CERT LT(NKSC)。接下来发生的事情对球队来说有点出乎意料。之前有传言说Telia的技术水平很差，但我们在一个真实的案例中经历过这一点。</p><p>首先，Telia没有PGP密钥，也不知道如何使用它，所以他们要求我们用密码压缩报告，并通过单独的电子邮件(私人Gmail)发送密码。我希望Telia的工程师会阅读这篇文章，所以我想解释一下为什么这份报告应该加密。这是为了保护您作为受影响的供应商。如果中间有一个人可以拦截所有研究人员的流量，那么就很容易在第一封电子邮件中获得ZIP文件，然后在第二封电子邮件中获得密码。相反，与PGP一样，PKI只允许对私钥所有者的报告进行解密，从而确保在您将其全部修复之前，没有其他人能够拦截该报告并利用这些漏洞。</p><p>谢谢您提供的信息。您确定您没有违反电子数据保护法吗？</p><p>dėkojame užinformacją.Ar tikrai tyrimą象ir neviešus elektroninius duomenis rinktenepažeidžant galiojančIųįstatymų？</p><p>然后他们再次提到，他们将检查这份报告是否不是一次黑客企图，他们将迫害任何披露任何关于Telia漏洞的信息的记者：</p><p>谢谢你提供这信息。我们将继续检查您的报告是否合法，没有违反任何法律。我们将确保不会发布任何可能损害公司声誉和立陶宛网络基础设施关键部分的虚假信息。</p><p>dėkojame jams užpasidalintąinformacją，kurios surinkimo teisėtuo vertinimątoliauatliekame ir tikimės，kadįviešumąnebus paskleista tikrovės neatitinkanti ar neteisėtaigauta information acija，kuri darytųžaląbendrovė‘s声誉tacijai ir tuo pačIU sėtų。</p><p>我们不会对此发表评论，让IT界来评判。同时，我们将不再以任何形式向Telia公司提供任何报告。</p><p>*注意：对KEX的部分修复意味着新的KEX不会被认为是弱的，但是现在可以通过此特定的KEX利用1.8.0之后的libssh2漏洞以及对KexAlgorithms diffie-hellman-group-exchange-sha256的公开利用</p><p>在获得超级用户访问权限并分析了Telia的路由器固件后，我们又找到了几个用户，比如ladmin和Technist。我们(目前)不会透露这些密码，因为目前还不清楚这两个密码是如何使用的。但令我们惊讶的是，Telia的密码似乎在很多年前就被泄露了。你可以尝试在网上搜索tadmin密码的哈希，你会感到惊讶的--早在2014年就有人试图破解哈希！</p><p>最后，我们发现散列已被破解，并且在旧的弱密码数据库中可用。您可以搜索&#34；旧&34；弱密码数据库(有时被命名为弱密码的第一个版本)，并且grep it-password就在那里。这意味着我们很可能不是第一个能够穿透Telia的人。</p><p>2019-10-22-尝试与Telia联系并要求提供PGP密钥2019-10-23-密码保护的ZIP按照他们的要求发送给Telia 2019-10-24-Telia确认已收到报告2019-11-21-发送给Telia的披露提醒2019-11-23-Telia试图威胁记者2019-11-27-Telia确认一切安全，漏洞已修复&#34；始终修复&#34；2020-06-29</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://full-disclosure.eu/reports/2019/FDEU-CVE-2019-10222-telia-savitarna-backdoor.html">https://full-disclosure.eu/reports/2019/FDEU-CVE-2019-10222-telia-savitarna-backdoor.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/telia/">#telia</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>