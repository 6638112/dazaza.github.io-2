<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reparse –用于OCaml的综合解析器组合器 Reparse – A comprehensive parser combinator for OCaml</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Reparse – A comprehensive parser combinator for OCaml<br/>Reparse –用于OCaml的综合解析器组合器 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-04 20:52:47</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/4da5a5d162514076d0be0c57ae70b6a6.png"><img src="http://img2.diglog.com/img/2020/12/4da5a5d162514076d0be0c57ae70b6a6.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>A  calculator is the  hello world of parsers. Here is an implementation in  Reparse which supports  +,-,* and  / operations.</p><p>计算器是解析器的世界。这是Reparse中的一种实现，支持+，-，*和/。</p><p> module  P  =  Reparse. Parser open  P.Infix type  expr = |  Int  of  int |  Add  of  expr  *  expr |  Sub  of  expr  *  expr |  Mult  of  expr  *  expr |  Div  of  expr  *  expr let skip_spaces  =  P.skip  P.space let  binop  exp1  op  exp2  f  =  P.map3 ( fun  e1  _  e2 -&gt; f e1 e2) exp1 (skip_spaces  *&gt;  P. char op  &lt; * skip_spaces) exp2 let integer  =  let + d  =  P.digits  in  Int (int_of_string d) let  factor  expr  =  P.any [  P. char  &#39;(&#39;  *&gt; skip_spaces  *&gt; expr  &lt; * skip_spaces  &lt; *  P. char  &#39;)&#39; ; skip_spaces  *&gt; integer  &lt; * skip_spaces ] let  term  factor  =  P.recur ( fun  term -&gt;  let mult  = binop factor  &#39;*&#39; term ( fun  e1  e2 -&gt;  Mult (e1, e2))  in  let div  = binop factor  &#39;/&#39; term ( fun  e1  e2 -&gt;  Div (e1, e2))  in mult  &lt; |&gt; div  &lt; |&gt; factor ) let expr  =  P.recur ( fun  expr -&gt;  let factor  = factor expr  in  let term  = term factor  in  let add  = binop term  &#39;+&#39; expr ( fun  e1  e2 -&gt;  Add (e1, e2))  in  let sub  = binop term  &#39;-&#39; expr ( fun  e1  e2 -&gt;  Sub (e1, e2))  in  P.any [add; sub; term] ) let  rec  eval  =  function   |  Int  i -&gt; i  |  Add ( e1,  e2) -&gt; eval e1  + eval e2  |  Sub ( e1,  e2) -&gt; eval e1  - eval e2  |  Mult ( e1,  e2) -&gt; eval e1  * eval e2  |  Div ( e1,  e2) -&gt; eval e1  / eval e2  (* Test AST  *) let r  =  let actual  =  P.parse_string expr   &#34;1*2-4+3 &#34;  in  let expected  =  Sub ( Mult ( Int  1,  Int  2),  Add ( Int  4,  Int  3))  in  Bool.equal (expected  = actual)  true  (* Run and test the evaluator.  *) let exp_result  =  let v  = eval ( P.parse_string expr   &#34;12+1*10 &#34;)  in  Int.equal  22 v</p><p> 模块P =重新解析。解析器打开P.Infix类型expr = | int int | expr * expr的加|子expr * expr |多个expr * expr | expr的Div * expr let skip_spaces = P.skip P.space let binop exp1 op exp2 f = P.map3（fun e1 _ e2-> f e1 e2）exp1（skip_spaces *＆gt; P. char op＆lt; * skip_spaces ）exp2 let integer = let + d = Int中的P位（int_of_string d）let factor expr = P.any [P. char＆＃39;（＆＃39; *＆gt; skip_spaces *＆gt; expr＆lt; * * skip_spaces ＆lt; * P. char＆＃39;）＆＃39; ; skip_spaces *＆gt;整数＆lt; * skip_spaces]在let div = binop中让条件项= P.recur（有趣的条件-＆gt; let mult = binop系数＆* 39; *＆＃39;项（fun e1 e2-＆gt; Mult（e1，e2））系数（＆lt; |＆gt; div＆lt; |＆gt;中的系数（fun e1 e2-> Div（e1，e2））项）expr = P.recur（fun expr- ＆gt; let因子= let项中的factor expr，let let =项中的术语factor＆＃39; +＆＃39; expr（fun e1 e2-＆gt; let sub = binop项中的Add（e1，e2））＆ P.any [add; sub; term]中的＃39;-＆＃39 expr（fun e1 e2-> Sub（e1，e2）））let rec eval = function |诠释-＆gt;我加（e1，e2）->评估e1 +评估e2 |子（e1，e2）->评估e1-评估e2 |多（e1，e2）->评估e1 *评估e2 | Div（e1，e2）->评估e1 /评估e2（*测试AST *）令r =令实际= P.parse_string expr＆＃34; 1 * 2-4 + 3＆＃34; in let expect = Bool中的Sub（Mult（Int 1，Int 2），Add（Int 4，Int 3））。equal（expected = Actual）true（*运行并测试评估器。*）let exp_result = let v =等于22 v的eval（P.parse_string expr＆＃34; 12 + 1 * 10＆＃34;）</p><p>  &lt;expr&gt;  ::= &lt; term&gt;   &#34;+ &#34; &lt; expr&gt;  | &lt; term&gt; &lt;term&gt;  ::= &lt; factor&gt;   &#34;* &#34; &lt; term&gt;  | &lt; factor&gt; &lt;factor&gt;  ::=   &#34;( &#34; &lt; expr&gt;   &#34;) &#34;  |  integer</p><p>  ＆lt; expr＆gt; :: =＆lt;条款＆gt; ＆＃34; +＆＃34; ＆lt; expr＆gt; | ＆lt;条款＆gt; ＆lt; term＆gt; :: =＆lt;要素＆gt; ＆＃34; *＆＃34; ＆lt;条款＆gt; | ＆lt;要素＆gt; ＆lt; factor＆gt; :: =＆＃34;（＆＃34;＆lt; expr＆gt;＆＃34;）＆＃34; |整数 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/lemaetech/reparse">https://github.com/lemaetech/reparse</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/用于/">#用于</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/expr/">#expr</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>