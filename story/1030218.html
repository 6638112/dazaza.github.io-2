<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用Pandas读取结构不良的Excel文件-实用业务Python</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用Pandas读取结构不良的Excel文件-实用业务Python</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-21 09:01:49</div><div class="page_narrow text-break page_content"><p>使用PANDA很容易读取Excel文件并将数据转换为DataFrame。不幸的是，现实世界中的Excel文件结构通常很差。在数据分散在工作表中的情况下，您可能需要自定义读取数据的方式。本文将讨论如何使用Pandas和openpyxl读取这些类型的Excel文件，并干净利落地将数据转换成适合进一步分析的DataFrame。</p><p>PANDA READ_EXCEL函数在读取Excel工作表方面做得非常好。但是，如果数据不是从单元格A1开始的连续表格，结果可能与您预期的不同。</p><p>这些结果包括许多未命名的列、一行中的标题标签以及几个我们不需要的额外列。</p><p>此数据集的最简单解决方案是使用头和使用参数read_excel()。尤其是usecols参数，对于控制您想要包含的列可能非常有用。</p><p>如果您想跟随这些示例操作，可以在GitHub上找到该文件。</p><p>从pathlib导入路径src_file=path将熊猫作为pd导入。CWD()/&#39；Shipping_tables.xlsx&#39；df=pd。READ_EXCEL(src_file，Header=1，usecols=&#39；B：F&#39；)。</p><p>逻辑相对简单明了。Usecol可以接受Excel范围(如B：F)，并且只读入这些列。Header参数需要定义标题列的单个整数。该值是0索引的，因此我们传入1，即使这是Excel中的第2行。</p><p>在某些情况下，我们可能希望将列定义为数字列表。在此示例中，我们可以定义四个整数的列表：</p><p>如果您希望对大型数据集遵循某种数字模式(即每3列或仅偶数编号的2列)，则此方法可能很有用。</p><p>熊猫usecol还可以使用列名列表。此代码将创建一个等效的DataFrame：</p><p>如果列顺序改变了，但是您知道名称不会改变，那么使用命名列的列表会很有帮助。</p><p>最后，usecols可以接受可调用的函数。下面是一个简单的长格式示例，它不包括未命名列和优先级列。</p><p>#定义一个更复杂的函数：def column_check(X)：if&#39；unname&#39；in x。LOWER()：如果x中的优先级为False，则返回False。LOWER()：如果x中的订单为&#39；，则返回FALSE。LOWER()：返回True返回True DF=PD。READ_EXCEL(src_file，Header=1，usecols=column_check)。</p><p>要记住的关键概念是，该函数将按名称解析每列，并为每列指定一个True或False。那些评估为True的列将不包括在内。</p><p>使用Callable的另一种方法是包含一个lambda表达式。下面是一个示例，其中我们只想包含已定义的列列表。我们通过将名称转换为小写来标准化名称，以便进行比较。</p><p>COLS_TO_USE=[&#39；ITEM_TYPE&#39；，&#39；订单ID&#39；，&#39；订单日期&#39；，&#39；状态&#39；，&#39；优先级&#39；]DF=PD。Read_excel(src_file，Header=1，usecols=lambda x：x.。COLS_TO_USE中的LOWER()</p><p>可调用的函数给了我们很大的灵活性来处理Excel文件的现实世界中的杂乱无章。</p><p>在某些情况下，数据在Excel中可能会更加模糊。在本例中，我们有一个要读取的名为SHIP_COST的表。如果您必须使用这样的文件，阅读我们到目前为止已经讨论过的熊猫选项可能会很有挑战性。</p><p>在这种情况下，我们可以直接使用openpyxl解析文件并将数据转换为熊猫DataFrame。数据在Excel表格中这一事实可以使这一过程变得更容易一些。</p><p>下面介绍如何使用openpyxl(一旦安装)读取Excel文件：</p><p>从openpyxl导入load_workbook将熊猫作为pd从pathlib导入路径src_file=src_file=path导入。Cwd()/&#39；Shipping_tables.xlsx&#39；wb=load_workbook(filename=src_file)。</p><p>此键与我们在Excel中分配给表的名称相对应。现在，我们访问该表以获取等效的Excel范围：</p><p>这招奏效了。我们现在知道了要加载的数据范围。最后一步是将该范围转换为熊猫数据帧。下面是一个简短的代码片段，用于循环每行并将其转换为一个完整的DataFrame：</p><p>#访问表范围DATA=SHEET[LOOKUP_TABLE]中的数据。Ref]ROWS_LIST=[]#循环每行并获取数据中行的单元格中的值：#获取每行中所有列的列表COLLES=[]FOR COLOR in ROW：COLS。追加(Col.。值)ROWS_LIST。APPEND(COLS)#从ROWS_LIST创建一个PANDA数据帧。#第一行是列名df=pd。DataFrame(DATA=ROWS_LIST[1：]，INDEX=NONE，COLUMNS=ROWS_LIST[0])</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://pbpython.com/pandas-excel-range.html">https://pbpython.com/pandas-excel-range.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/读取/">#读取</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/poorly/">#poorly</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/excel/">#excel</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1030098.html"><img src="http://img2.diglog.com/img/2020/10/thumb_98dc7dcc7c64dcbb78b63fb6fc5684d1.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030098.html">Pylo：几个Prolog引擎的Python前端</a></div><span class="my_story_list_date">2020-10-21 0:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030068.html"><img src="http://img2.diglog.com/img/2020/10/thumb_f8f5d529d35334f2fb264d19f656224e.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030068.html">Python 3.9</a></div><span class="my_story_list_date">2020-10-20 22:48</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030063.html"><img src="http://img2.diglog.com/img/2020/10/thumb_ebba69f4297e762af60b8f98f2e4d95d.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030063.html">PyInstrument-关注慢速部分的统计Python配置文件</a></div><span class="my_story_list_date">2020-10-20 22:46</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030062.html"><img src="http://img2.diglog.com/img/2020/10/thumb_febd33768c5e817e34a81b0bd750e291.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030062.html">CPython提速实施方案</a></div><span class="my_story_list_date">2020-10-20 22:46</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>