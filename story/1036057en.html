<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>物联网揭晓，第1部分：一团糟，然后有家庭助理IoT Unravelled Part 1: It's a Mess but Then There's Home Assistant</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">IoT Unravelled Part 1: It's a Mess but Then There's Home Assistant<br/>物联网揭晓，第1部分：一团糟，然后有家庭助理</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-23 17:19:05</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/1ae15f057cca2b2757ed66a4c2d34d1a.jpg"><img src="http://img2.diglog.com/img/2020/11/1ae15f057cca2b2757ed66a4c2d34d1a.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Alright clever IoT folks, I&#39;ve got two of these garage door openers, what do you reckon the best way of connecting them with Apple HomeKit is?  https://t.co/i0RmjSMkkD</p><p>聪明的IoT专家们，我有两个这样的车库门开启器，您认为将它们与Apple HomeKit连接的最佳方式是什么？ https://t.co/i0RmjSMkkD</p><p>— Troy Hunt (@troyhunt)  April 25, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年4月25日</p><p>  In my mind, the answer would be simple: &#34;Just buy X, plug it in and you&#39;re good to go&#34;. Instead, I found myself heading down the rabbit hole into a world of soldering, custom firmware and community-driven home automation kits. Finally, a full 123 days later, I managed to open my garage door with an app:</p><p>  在我看来，答案很简单：“只需购买X，将其插入电源就可以了”。相反，我发现自己进入了焊接，定制固件和社区驱动的家庭自动化套件领域的困境。终于，整整123天后，我设法使用一个应用程序打开了车库门：</p><p> Smashing it today! So impressed with the Shelly 1, it made this so simple 😊  pic.twitter.com/miD8WdfUvM</p><p> 今天粉碎！让Shelly 1留下深刻的印象，让它变得如此简单simple pic.twitter.com/miD8WdfUvM</p><p>— Troy Hunt (@troyhunt)  August 26, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年8月26日</p><p>  What follows is my journey down that very deep, very dark rabbit hole from which I thought I&#39;d never emerge. Every time I thought I had an answer, it raised 2 more questions. I had to buy new gear, learn new acronyms and work with things I&#39;d never heard of before. I waded through endless online discussions with strong opinions expressed in frequently conflicting directions about things I thought would be simple. Never before have I headed down a technology path that, frankly, is such a fragmented mess.</p><p>  接下来的事情是我沿着那个非常深，非常黑暗的兔子洞走下去的旅程，我以为我永远都不会出现。每当我以为自己有答案时，就会提出另外两个问题。我必须购买新设备，学习新的缩写词并使用以前从未听说过的东西。在无休止的在线讨论中，我以强烈的观点参于无休止的讨论中，而这些观点在我认为很简单的事情上经常相互矛盾。坦率地说，我从未走过如此零碎的技术道路。</p><p> I added to this blog post as I progressed with a view to ultimately having a &#34;happy path&#34; for others to follow in the future. Instead of a single post, I ended up with a 5-part epic which I&#39;ll post piece by piece over the course of this week with the hope that others can follow along and eventually, with enough time and patience, be able to open their garage doors too.</p><p> 在我前进的过程中，我添加到了此博客文章中，以期最终为将来的他人提供一条“幸福的道路”。我没有发表任何一篇文章，而是撰写了一个由5部分组成的史诗，我将在本周的过程中逐篇发布，希望其他人可以跟进，并最终在足够的时间和耐心下能够打开他们的车库门也一样。</p><p>  This is where the whole mess starts: what is the hub of your IoT world? In my original tweet above, I thought it would be Apple&#39;s HomeKit which seemed like a reasonable assumption given my family&#39;s dependencies on iPhones, iPads, Apple Watches and with an Apple TV in the house. Those in an Android world might reasonably assume that Google Home would be their hub. Others might assume it&#39;d be something Alexa related. But no, every one of those answers is wrong because every single one is a proprietary ecosystem with fragmented support by different devices and a kludge of vendor lock-in. Take this as an example:</p><p>这就是整个混乱的开始：您的物联网世界的中心是什么？在上面的原始推文中，我认为这将是Apple的HomeKit，考虑到我家人对iPhone，iPad，Apple Watch以及家里装有Apple TV的依赖，这似乎是一个合理的假设。那些使用Android的人可能会合理地假设Google Home将成为他们的中心。其他人可能会认为这与Alexa有关。但是不，这些答案中的每一个都是错误的，因为每个人都是一个专有的生态系统，不同设备的支离破碎的支持，以及厂商锁定的麻烦。以此为例：</p><p> Stuck inside and not allowed out? Nerf gun wall!  LED strip lights are Arlec from Bunnings at A$60 for 5m. Controller app plus Alexa integration so next step is full voice control 😎  pic.twitter.com/8mP2G3CM3t</p><p> 卡在里面，不允许出去吗？神经壁枪！ LED条形灯是来自Bunnings的Arlec，价格为60澳元/ 500万美元。 Controller应用程序加上Alexa集成，因此下一步就是完整的语音控制😎pic.twitter.com/8mP2G3CM3t</p><p>— Troy Hunt (@troyhunt)  April 9, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年4月9日</p><p>  Now firstly, the Nerf gun wall is freakin&#39; epic! But secondly, that Arlec LED strip Ari is attaching to the back of the wall runs on  the Grid Connect ecosystem which includes support for:</p><p>  现在首先，Nerf的枪壁是史诗般的史诗！但是第二，Arlec LED灯条Ari固定在墙的背面是在Grid Connect生态系统上运行的，该系统包括对以下内容的支持：</p><p>  Google and Amazon. That is all. No HomeKit. In fact, HomeKit was often the odd one out when I looked at IoT products and I can imagine someone explaining it away as Apple demanding things be done the Apple way or the highway hence the lack of compatible devices. And this wasn&#39;t a typo on the Grid Connect website:</p><p>  谷歌和亚马逊。就这些。没有HomeKit。实际上，当我查看物联网产品时，HomeKit常常是一个奇怪的例子，我可以想象有人在解释它，因为Apple要求以Apple方式或高速公路来完成事情，因此缺乏兼容的设备。这并不是Grid Connect网站上的错字：</p><p>  It&#39;s not just the big players either; you&#39;ll find all sorts of lesser-known brands wanting to be the hub of your IoT world. During this whole exercise, I decided I needed to replace the receiver in my home entertainment setup as it wasn&#39;t powerful enough to drive the speakers I have. So, I&#39;m in at the home theatre shop and I see this beautifully made universal remote control:</p><p>  也不只是大公司；您会发现各种不太知名的品牌想要成为您的物联网世界的枢纽。在整个练习过程中，我决定需要在家庭娱乐设备中更换接收器，因为它的功能不足以驱动我拥有的扬声器。因此，我在家庭影院商店里，看到了制作精美的通用遥控器：</p><p>  This lovely, brushed aluminium unit is made by  Control4 and guess what? They can be the hub of your smart home! Oh - but it&#39;s not self-configurable and you need a licensed installer to set it all up for you 🤦‍♂️</p><p>  这个可爱的铝制拉丝单元由Control4制成，您猜怎么着？它们可以成为您的智能家居的枢纽！哦-但是它不是可自行配置的，您需要获得许可的安装程序才能为您进行全部设置🤦‍♂️</p><p>     But it&#39;s also slightly disingenuous because whilst on the surface it may look like yet another solution to the same problem, it&#39;s philosophically different in several key ways:</p><p>但这也有点不屑一顾，因为虽然从表面上看，它看起来像是对同一问题的另一种解决方案，但是在几个关键方面，它在哲学上是不同的：</p><p> Open source home automation that puts local control and privacy first. Powered by a worldwide community of tinkerers and DIY enthusiasts. Perfect to run on a Raspberry Pi or a local server.</p><p> 开源家庭自动化，将本地控制和隐私放在首位。由世界各地的修补匠和DIY爱好者提供支持。非常适合在Raspberry Pi或本地服务器上运行。</p><p> The Apple / Google / Amazon solutions are all proprietary and tied very closely to the respective tech behemoths&#39; commercial offerings. They want people on their platforms, using their clouds and buying their products. HA, on the other hand, doesn&#39;t care who made what or which devices you have or whose clouds you&#39;re on, it just wants to tie it all together in a meaningful way. It&#39;s an extremely active open source project typically (but not exclusively) run on a Raspberry Pi with a goal of integrating all of your things and keeping them self-contained within your own home rather than being dependent on public cloud services. It has amazing community support and a  very devoted fan base which has helped catapult it into  one of the top open source projects on GitHub. However...</p><p> Apple / Google / Amazon解决方案均为专有解决方案，并且与各自的科技巨头的商业产品紧密相关。他们希望人们在平台上使用云计算并购买产品。另一方面，HA不在乎谁制造了什么设备，拥有哪些设备或所处的云，它只是想以一种有意义的方式将它们捆绑在一起。这是一个非常活跃的开源项目，通常（但不是排他性地）在Raspberry Pi上运行，目的是集成您的所有内容并将其保持在自己家里，而不依赖于公共云服务。它具有出色的社区支持和忠实的支持者群体，这有助于将其推向GitHub上的顶级开源项目之一。然而...</p><p> The learning curve is steep, it has a bunch of rough edges (it&#39;s still not reached a v1 as of the time of writing), you end up living in  YAML and by any reasonable measure, it&#39;s only usable by geeks who are happy living in a world unfamiliar to most mere mortals. Fortunately, that includes me and despite the &#34;maker&#34; nature of the whole thing, I&#39;m  massively impressed with HA and nothing else I&#39;ve seen along my IoT journey comes even close to comparing. If you&#39;re going to do IoT in any meaningful way, you start with HA.</p><p> 学习曲线陡峭，边缘粗糙（截至撰写本文时尚未达到v1），您最终生活在YAML中，并且以任何合理的方式衡量，仅对那些乐于学习的极客有用大多数凡人都不熟悉的世界。幸运的是，这包括我在内，尽管整件事具有“制造者”的性质，但是HA给我留下了深刻的印象，而我在物联网之旅中所见到的其他东西甚至都无法与之相比。如果您打算以任何有意义的方式进行物联网，那么您将从HA开始。</p><p> The thing is though, you need to be ready to get your hands  really dirty:</p><p> 事实是，您需要准备好使自己的手真正变脏：</p><p> Is phoscon running in a docker container? If so you&#39;ll likely need to use vnc to connect to the container to get to the phoscon UI to remove the device from there. Then remove the integration from HA, then readd it. It might need a tidy up in HA config files if it gets orphaned.</p><p> phoscon是否在docker容器中运行？如果是这样，您可能需要使用vnc连接到容器，才能进入phoscon UI从那里删除设备。然后从HA中删除集成，然后阅读。如果它成为孤立对象，则可能需要整理HA配置文件。</p><p>— Phil Ermiya (@PhilErmiya)  June 18, 2020</p><p>-菲尔·埃尔米亚（@PhilErmiya）2020年6月18日</p><p>  I captured this tweet and dropped it into the draft blog post as I was lamenting just how damn hard it was to make simple things work the way I wanted them to. But I don&#39;t want to get anywhere near that level of detail in this blog series as it&#39;ll just scare people off, let me instead focus on the basics and provide enough background to get people heading in the right direction, starting with the fundamental principles of what makes HA great.</p><p>我捕捉到了这条推文，并把它放到了草稿博客中，当时我在哀叹让简单的事情以我希望的方式工作是多么的辛苦。但我不想在本博客系列中获得如此详细的信息，因为这只会吓people人，而让我专注于基础知识，并提供足够的背景，使人们从正确的方向前进。医管局出色的基本原则。</p><p>   HA integrates with other devices and services which it can both use as triggers and perform actions on.</p><p>   HA与其他设备和服务集成，可以用作触发器并对其执行操作。</p><p> For example, just to jump straight to the conclusion for a moment, I now have a bunch of little motion sensors around the house that can turn lights on:</p><p> 例如，只是想马上得出结论，我现在房子周围有一堆小运动传感器，它们可以打开灯：</p><p> Now entering the next phase of my IoT buildout with Xiaomi Aqara motion sensors spread around the house to trigger lights on or off based on movement. These are Zigbee based with a 2 year battery life and include light sensors as well. Cool 😎  pic.twitter.com/XLIPyNz5Ej</p><p> 现在使用小米Aqara运动传感器进入我的物联网扩展的下一阶段，运动传感器遍布房屋，根据移动情况触发开灯或关灯。这些都是基于Zigbee的，具有2年的电池寿命，并且还包括光传感器。酷😎pic.twitter.com/XLIPyNz5Ej</p><p>— Troy Hunt (@troyhunt)  October 6, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年10月6日</p><p>  This is achieved firstly, by using an integration that can communicate with the sensors and in this case, it&#39;s  deCONZ which is made by Phoscon:</p><p>  首先，这是通过使用可以与传感器通信的集成实现的，在这种情况下，这是由Phoscon制造的deCONZ：</p><p>  I&#39;ve left other integrations in the screen cap above to give you a sense of some of the other things HA can communicate with: Alexa, WeMo switches, Elgato key lights and many other connected devices in my house. At the time of writing, there are 1,713 different integrations including...  a Have I Been Pwned Integration!</p><p>  我在上面的屏幕截图中保留了其他集成，以使您了解HA可以与之通信的其他一些功能：Alexa，WeMo开关，Elgato按键灯和我家中的许多其他连接的设备。在撰写本文时，有1,713种不同的集成，包括... a我是否拥有集成！</p><p>  The deCONZ integration enables communication with Zigbee devices (more on that in part 2) and per the screen cap above, I presently have 35 of those in my house. One of them is the first motion sensor in the earlier tweet which, in HA, looks like this:</p><p>deCONZ集成允许与Zigbee设备进行通信（第2部分中的更多内容），并且按照上面的屏幕截图，我家目前有35个。其中一个是早期推文中的第一个运动传感器，在HA中，它看起来像这样：</p><p>  The motion sensor is a device I placed at the bottom of the stairs in my house which spans 3 floors. I have another motion sensor halfway along near the kids&#39; room and another again at the top near our master bedroom. These motion sensor devices each have 3 different entities:</p><p>  运动传感器是我放置在我房子楼梯底部的设备，该设备跨越3层楼。我在孩子房间附近有一个运动传感器，在我们主卧室附近的顶部有另一个运动传感器。这些运动传感器设备各自具有3个不同的实体：</p><p>  This nomenclature threw me a bit at first but it makes sense: one physical device you can hold in your hand may measure many different things and each one of those things is considered to be an entity (entities aren&#39;t just about measurement but let&#39;s use that as a simplistic example for the moment). I have little temperature sensors in each room and each one of those devices can measure humidity, pressure, temperature and has a battery state:</p><p>  这种命名法起初给我带来了一点麻烦，但它是有道理的：您可以拿在手中的一个物理设备可能会测量许多不同的事物，并且这些事物中的每一个都被视为一个实体（实体不仅仅是测量，而是让我们使用作为目前的简化示例）。我在每个房间中都没有温度传感器，并且这些设备中的每一个都可以测量湿度，压力，温度并具有电池状态：</p><p>  Yet another device I now have all over the house is an IoT relay called a Shelly, two of which you can see in the tweet below (they&#39;re the little blue units amongst all the wires):</p><p>  我现在到处都是的另一种设备是称为Shelly的IoT中继，您可以在下面的推文中看到其中的两个（它们是所有电线中的蓝色小单元）：</p><p>   Yes, this is pretty normal Aussie wall socket wiring. No, we don&#39;t use gang boxes. Yes, I&#39;m conscious you do things differently in other parts of the world. Moving on, each Shelly has a single entity which is simply a power switch:</p><p>   是的，这是澳大利亚墙上插座的正常接线。不，我们不使用帮派盒。是的，我知道您在世界其他地方的做法有所不同。接下来，每个Shelly都有一个实体，这只是一个电源开关：</p><p>  So, now we have all the mechanics required to tie together automations and as you can see in the screen cap above (and in the earlier one that shows the stairs motion sensor), I have 2 automations using these devices. I&#39;m not going to go anywhere near the YAML involved in this blog series, let&#39;s instead focus on the logic:</p><p>  因此，现在我们具备了将自动化结合在一起的所有机制，正如您在上面的屏幕截图中（以及在较早的显示楼梯运动传感器的屏幕截图中可以看到的）所看到的那样，我有两种使用这些设备的自动化。在本系列博客所涉及的YAML方面，我将不做任何介绍，而是将重点放在逻辑上：</p><p> If motion is detected at the bottom, middle or top of the stairs and the light level down the bottom is beneath 200 lumens, turn the Shelly on the light switch on</p><p> 如果在楼梯的底部，中间或顶部检测到运动，并且底部的光线水平低于200流明，请打开灯光开关上的Shelly</p><p> If all 3 motion sensors haven&#39;t detected any motion for the last 5 minutes, turn the Shelly on the light switch off</p><p>如果在过去的5分钟内所有3个运动传感器均未检测到任何运动，请关闭电灯上的雪莉</p><p>  But that automation just turns on a single light, what if I wanted to turn on more lights? Or play music? Or set other device statuses, all at the same time? This is where we get to &#34;scenes&#34; which allow you to define multiple pre-set states that can all be switched on in one go. For example, Ari wanted a fast way to get all his lights back to the same state he referred to as &#34;cool&#34;, so we made a scene that turned on a bunch of lights and set the nerf gun wall to red:</p><p>  但是那种自动化只是打开一个灯，如果我想打开更多的灯怎么办？还是播放音乐？还是同时设置其他设备状态？这是我们进入“场景”的地方，它允许您定义多个预设状态，可以一次打开所有状态。例如，Ari想要一种快速的方法来将他的所有灯光恢复到他所谓的“酷”状态，因此我们制作了一个场景，该场景打开了一堆灯光并将nerf枪壁设置为红色：</p><p>  That scene can be trigged by various events, including automations. We&#39;ll come back and look at that again shortly but for now, let&#39;s talk about how all those lights work in the first place.</p><p>  可以通过各种事件（包括自动化）来触发该场景。我们将很快再来看看，但是现在，让我们先谈谈所有这些灯是如何工作的。</p><p>  Ever get an odd sense of déjà vu when you see a product under a certain brand and you could  swear you&#39;d seen it somewhere before, but just different? I had that recently when I drove a friend&#39;s Tesla Model X and the indicator stalk felt just like the one in my Mercedes. Turns out that because  it  is just like the one in my Mercedes with the US brand using a bunch of parts from the Germans.</p><p>  当您看到某个品牌下的产品时，曾经发誓会在以前的某个地方看到它时，会感到奇怪吗？最近，当我开车驾驶朋友的特斯拉Model X时，我有那种感觉，指示器杆的感觉就像我的梅赛德斯车上的一样。事实证明，因为它就像我的梅赛德斯轿车中的美国品牌一样，使用了许多德国人的零件。</p><p>  Anyone know what&#39;s involved in making Grid Connect lights play nice with  @home_assistant? These are the units, got a heap of them in the kids&#39; rooms and they already integrate with Alexa and Google Assistant:  https://t.co/xJKdtzJKED</p><p>  任何人都知道在使Grid Connect灯光与@home_assistant配合使用时会涉及什么？这些是单元，在孩子们的房间里堆了很多，它们已经与Alexa和Google助手集成了：https://t.co/xJKdtzJKED</p><p>— Troy Hunt (@troyhunt)  July 19, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年7月19日</p><p>  Earlier on I mentioned I&#39;d bought the  Grid Connect lights (which are manufactured by  Arlec) to put behind Ari&#39;s Nerf Gun wall. They were cheap (at least compared to something like Philips Hue), RGB (not just different shades of white) and could talk over Wi-Fi (not just controllable via a remote). The Grid Connect app worked fine but as I also mentioned earlier, there&#39;s no way it&#39;d work with Apple&#39;s HomeKit and based on feedback to the tweet above, nor were there any integrations with HA. But there was another option:</p><p>  早些时候，我提到我购买了Grid Connect灯（由Arlec制造）放在Ari的Nerf Gun墙后面。它们很便宜（至少与飞利浦Hue之类的东西相比），RGB（不仅有不同的白色阴影）而且可以通过Wi-Fi通话（不仅可以通过遥控器控制）。 Grid Connect应用程序运行良好，但是正如我之前提到的那样，它无法与Apple的HomeKit一起使用，并且基于对上述推文的反馈，也没有与HA集成。但是还有另一种选择：</p><p> These are based on an off the shelf Tuya ESP8266 module. Either use the Smart Life or Tuya apps instead of the Grid Connect one - HA has an integration to their cloud based web service. Or flash them with different firmware - Tasmota and ESPHome are the main options</p><p>这些基于现成的Tuya ESP8266模块。使用Smart Life或Tuya应用程序而不是Grid Connect one-HA已将其基于云的Web服务集成在一起。或使用其他固件刷新它们-Tasmota和ESPHome是主要选项</p><p>— Chris Ford (@chrisfordoz)  July 19, 2020</p><p>-克里斯·福特（@chrisfordoz）2020年7月19日</p><p>  Ok, that&#39;s actually several different options but let&#39;s just focus on Tuya first because that&#39;s the easiest path.  Tuya is &#34;the World&#39;s Leading IoT platform&#34; (yay, another platform 🤦‍♂️) and per the above tweet, they ship products that run  a ESP8266 chip which is a pretty common piece of kit. Consequently, I could pair that Grid Connect light strip with the Tuya app which... then says Arlec!</p><p>  好的，实际上这是几种不同的选择，但是让我们首先关注Tuya，因为这是最简单的方法。 Tuya是“世界领先的IoT平台”（是的，另一个平台🤦‍♂️），根据上述推文，他们发货的产品均运行ESP8266芯片，这是一套非常常见的套件。因此，我可以将Grid Connect灯带与Tuya应用程序配对，然后说Arlec！</p><p>     Turns out these are also Tuya compatible so now, without directly buying a single Tuya product, I have a lot of products running in the Tuya app:</p><p>     事实证明，这些产品也与Tuya兼容，因此，现在，无需直接购买单个Tuya产品，我就可以在Tuya应用中运行很多产品：</p><p>  What that means is that it&#39;s dead easy to control things such as the colour and the brightness:</p><p>  这意味着很难控制诸如颜色和​​亮度之类的东西：</p><p>  Now, let&#39;s bring it back to HA for a moment and the value proposition here is that per Chris&#39; earlier tweet, there&#39;s an integration that can bring these devices right into the same environment all my other IoT things are now in:</p><p>  现在，让我们暂时回到HA，这里的价值主张是根据Chris的较早推文，有一个集成可以将这些设备带入相同的环境中，而我现在所有的其他IoT都在其中：</p><p>  Ok, so far so good, now let&#39;s get to the twists in all this starting with how the same device looks in HA:</p><p>  好的，到目前为止，到目前为止，让我们开始探讨所有相同的事物，从同一个设备在HA中的外观开始：</p><p>  That looks fine now, but when I first added the downlights, I had no colour control. Power and brightness, yes, but no colour. It took some researching to realise that  Tuya had killed colour control for a whole bunch of other people too and that the answer was to edit the customize.yaml file and for each Tuya entity, change the supported features to indicate colour control. I&#39;m not even going to get into the mechanics of that here because that&#39;s not really the point of this series, rather I want to highlight how I kept running into &#34;compatible but not completely compatible&#34; scenarios like this.</p><p>现在看起来还不错，但是当我第一次添加筒灯时，我没有进行颜色控制。功率和亮度，是的，但没有颜色。经过一些研究后才意识到，Tuya也杀死了许多其他人的色彩控制，答案是编辑edit.yaml文件，并为每个Tuya实体更改支持的功能以指示色彩控制。我什至不打算在这里讨论其机制，因为这并不是本系列的重点，而是我想强调一下我如何一直遇到这样的“兼容但不完全兼容”的场景。</p><p> So, now should I change the colour via the Tuya app or the HA website or app? In one way, it doesn&#39;t matter because the state is reflected the same in both (i.e. make it red in HA and the Tuya app shows it as red). In another way, I&#39;m now in this vicious cycle of having more and more apps for specific IoT devices that whilst integrated with HA, still require the OEM app to do a heap of stuff. For example, the  Nanoleaf app has a very specific set of controls:</p><p> 因此，现在应该通过Tuya应用程序或HA网站或应用程序更改颜色吗？从某种意义上说，这没关系，因为状态在两个状态中都得到了相同的反映（即在HA中将其设为红色，而Tuya应用将该状态显示为红色）。换句话说，我现在正处于这种恶性循环中，越来越多的特定物联网设备的应用程序虽然与HA集成在一起，但仍然需要OEM应用程序做大量的工作。例如，Nanoleaf应用程序具有一组非常具体的控件：</p><p>  These allow predefined scenes to be played on the light panels (something that can also be triggered by HA), but also very specific configuration such as what colour to make individual panels. AFAIK, that capability isn&#39;t built into the HA integration and even if it was, it&#39;s unlikely the experience in setting it up would rival that of the dedicated app.</p><p>  这些允许在灯光面板上播放预定义的场景（也可以由HA触发），但也可以进行非常特殊的配置，例如制作单个面板的颜色。 AFAIK，该功能不是内置于HA集成中的，即使它是内置的，安装它的经验也不太可能与专用应用程序相媲美。</p><p> The bottom line is that you inevitably end up with multiple different interfaces into the same device be they native interfaces provided by the device manufacturer or those exposed via the HA integration. But it doesn&#39;t end there either, because you still need to get those devices back into the other IoT hubs. Here&#39;s why:</p><p> 最重要的是，您不可避免地要在同一设备中使用多个不同的接口，无论它们是设备制造商提供的本机接口还是通过HA集成公开的接口。但这还不止于此，因为您仍然需要将这些设备放回其他IoT中心。原因如下：</p><p>  Earlier on, I lamented that everyone wants to be the hub of your IoT world and that fortunately, HA can play that role in the place of one of the large incumbent tech companies. Mostly. The gap comes when you start using products from one of those companies that expect to communicate with IoT devices via their own proprietary product. For example, both my kids have an Amazon Echo Dot in their room. I put these in there in part because they&#39;re fun learning devices they can easily ask questions of (they can also ask &#34;Alexa, who&#39;s Troy Hunt&#34; and get an answer or, as I learned last night with my daughter, they can ask &#34;Alexa, is Troy Hunt handsome&#34; and get a resounding &#34;He is handsome&#34; 🤣), and in part to control their IoT-enabled devices. The latter can be done without even needing HA as Tuya natively integrates with Alexa and exposes all the devices:</p><p>  早些时候，我感叹每个人都希望成为您的物联网世界的枢纽，而且幸运的是，HA可以代替现有的大型科技公司之一发挥这一作用。大多。当您开始使用那些希望通过自己的专有产品与IoT设备进行通信的公司之一的产品时，就会出现差距。例如，我两个孩子的房间里都有一个Amazon Echo Dot。我之所以把它们放在这里，部分是因为它们是有趣的学习工具，它们可以轻松地提出以下问题（他们也可以问“ Alexa，谁是Troy Hunt”并获得答案，或者，正如我昨晚与女儿学到的那样，他们可以问“ Alexa，特洛伊·亨特（Troy Hunt）很帅”，响亮的“他很帅”（🤣），部分是控制他们的IoT设备。后者甚至不需要HA即可完成，因为Tuya与Alexa本机集成并公开了所有设备：</p><p>  But there are other things in HA which we might still want to access via Alexa, for example the &#34;cool&#34; scene I set up for Ari earlier on. To do that we need to surface data from HA into Alexa which can be done with  the Amazon Alexa integration. Once configured, the scene appears and he can talk to the Echo Dot and ask Alexa to &#34;turn on cool in Ari&#39;s room&#34;:</p><p>  但是在HA中，我们可能仍想通过Alexa访问其他内容，例如我之前为Ari设置的“酷”场景。为此，我们需要将数据从HA浮到Alexa中，这可以通过Amazon Alexa集成来完成。配置完成后，将出现场景，他可以与Echo Dot对话并要求Alexa“在Ari的房间里变凉”：</p><p>  Just as there are reasons to surface HA into Alexa, there are also reasons to surface HA into Apple&#39;s HomeKit, a feat that can be achieved with  the HomeKit Bridge integration. (Note: there is also  Homebridge which is  a different beast altogether.) We can now surface all the same devices into Apple&#39;s ecosystem:</p><p>  就像有理由将HA引入Alexa一样，也有理由将HA引入苹果的HomeKit中，这一壮举可以通过HomeKit Bridge集成来实现。 （注意：还有Homebridge，它是完全不同的野兽。）现在，我们可以将所有相同的设备引入Apple的生态系统：</p><p>  Remember, that Nerf gun wall is running the Arlec LED strips that use Grid Connect surfaced through the Tuya app which all has no support for HomeKit yet here we are with control in HomeKit 😎</p><p>请记住，Nerf的枪管正在运行Arlec LED灯带，该LED灯带使用通过Tuya应用程序浮出水面的Grid Connect，而该应用程序都不支持HomeKit，但是我们可以通过HomeKit进行控制😎</p><p>   One of the primary reasons for doing this is that once you&#39;re in the Apple ecosystem you have Siri so now I can just raise my wrist and say &#34;Hey Siri, open the garage door&#34;. Or if I&#39;m in my car with Apple CarPlay I can issue the same command without even taking my hands off the wheel.</p><p>   这样做的主要原因之一是，一旦您进入了Apple生态系统，便有了Siri，因此现在我可以举起手腕说“嘿Siri，打开车库门”。或者，如果我使用Apple CarPlay开车时，也可以发出相同的命令，而无需把手放开。</p><p> This does, however, create other problems especially when it comes to troubleshooting. Take a look at  the hero image at the top of this blog post. Nice Nerf gun wall representing Ari&#39;s room as HomeKit sees it on my iPad, except... his desk power is showing &#34;No Response&#34;. Huh, wonder if he accidentally unplugged it this morning? So I go into his room and no, he hasn&#39;t unplugged it because his neon-backlit keyboard is glowing and it&#39;s plugged into the USB hub connected to the TP-Link HS100 smart plug that&#39;s presently unresponsive. It&#39;s surfaced in HomeKit via the HomeKit Bridge integration in HA so I go into that device and the entity is disabled. If HA can&#39;t see it then HomeKit won&#39;t be able to see it. Ok, let&#39;s go further up the stack and now I&#39;m in the native iOS Kasa app where the plug is both present and responsive to power on / power off commands which means it&#39;s on the network just fine. I stopped there because frankly, I got a bit pissed with the whole thing and just want to finish this blog post right now, but I&#39;ve included this here to demonstrate just how many moving parts are required to make all this work. Just one of those moving parts stops and not only does it kill a part of your internet of things, but there&#39;s a good chance you&#39;ll be in for a lengthy troubleshooting session.</p><p> 但是，这确实会引起其他问题，尤其是在进行故障排除时。看看此博客文章顶部的英雄形象。就像HomeKit在我的iPad上看到的那样，漂亮的Nerf枪壁代表了Ari的房间，除了...他的桌面电源显示“无响应”。呵呵，想知道他今天早上是否不小心将其拔掉了吗？所以我进了他的房间，不，他没有拔出电源，因为他的霓虹灯背光键盘发光，并且已插入连接到目前无响应的TP-Link HS100智能插头的USB集线器中。它通过HA中的HomeKit Bridge集成在HomeKit中浮出水面，因此我进入该设备，该实体被禁用。如果HA无法看到它，则HomeKit将无法看到它。好的，让我们更进一步，现在我在本地iOS Kasa应用程序中，该应用程序既存在插头，又响应开机/关机命令，这意味着它在网络上正常。我停在那里是因为坦率地说，我对整个事情有点生气，只是想立即完成本篇博客文章，但是我在此处包括了这个内容，以演示完成所有这些工作需要多少个运动部件。这些移动部件中的只有一个停止了，不仅杀死了一部分物联网，而且很有可能会进行冗长的故障排除会话。</p><p> This all took me a while to wrap my head around, namely the fact that you can&#39;t escape the necessity to have multiple &#34;hubs of all your things&#34; and that they can all work together harmoniously... most of the time. It&#39;s not difficult, but it  is fiddly especially when you end up with the same devices in HA as Alexa can natively talk to then you see dupes or you get to HomeKit and there&#39;s a zillion devices in there when you really only want a couple of lights. There are solutions to these problems, however, it just requires a little patience and a lot of tweaking.</p><p> 这一切花了我一段时间来回避，这是事实，即您无法逃避拥有多个“所有事物集线器”的必要性，而且它们可以在大多数时间和谐地协同工作。这并不困难，但是很奇怪，特别是当您最终在HA中使用相同的设备时，Alexa可以与他们进行本地交谈，然后您看到重复对象，或者您进入了HomeKit，当您真的只想要几盏灯时，那里有不计其数的设备。 。有解决这些问题的方法，但是，这需要一点耐心和大量调整。</p><p>  I want to wrap up part 1 here because it&#39;s a nice  finish before peeling back more layers of complexity. Get yourself a Raspberry Pi, install HA and add integrations for your existing devices, surface through your platforms of choice and you&#39;re off and running. But that&#39;s only the first step, in part 2 I want to start delving into the implications of all those IP addresses, the role of Zigbee, custom firmware and soldering and ultimately, finding my own happy path to how complex I wanted to make the whole thing.</p><p>  我想在这里总结第1部分，因为在剥离更多层次的复杂性之前这是一个很好的完成。为自己配备Raspberry Pi，安装HA并为现有设备添加集成，通过选择的平台浮出水面，然后开始运行。但这只是第一步，在第2部分中，我想开始研究所有这些IP地址的含义，Zigbee的作用，定制固件和焊接，并最终找到一条自己的快乐之路，了解我想要使整体变得多么复杂事情。</p><p> Lastly, I&#39;m going to devote my regular weekly update live stream to this blog series and do it in conjunction with my good mate Scott Helme whose been going through his own IoT journey. It&#39;ll be broadcast at 17:00 Gold Coast time for me this Friday which is 08:00 the same day in London and 23:00 Thursday evening on the US west coast. If you can&#39;t make the live stream, it&#39;ll still be available here afterwards:</p><p> 最后，我将每周定期更新实时流到此博客系列中，并与我的好伴侣Scott Helme一起进行，他正在经历自己的物联网之旅。它将在本星期五在黄金海岸时间17:00广播给我，这是伦敦的当天08:00和美国西海岸的星期四晚上23:00。如果您无法制作实时流，则此后仍将可用：</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.troyhunt.com/iot-unravelled-part-1-its-a-mess-but-then-theres-home-assistant/">https://www.troyhunt.com/iot-unravelled-part-1-its-a-mess-but-then-theres-home-assistant/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/物联网/">#物联网</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/一团糟/">#一团糟</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/设备/">#设备</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>