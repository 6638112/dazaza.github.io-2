<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ML数据和普罗米修斯和Grafana的模型漂移 ML data and model drift in Prometheus and Grafana</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">ML data and model drift in Prometheus and Grafana<br/>ML数据和普罗米修斯和Grafana的模型漂移 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-11 02:41:36</div><div class="page_narrow text-break page_content"><p>Boxkite is an easy, open source way to track model and data drift for Machine Learning models.</p><p>Boxkite是一种简单，开源的方式，可跟踪机器学习模型的模型和数据漂移。</p><p> Data drift: how did the input data vary from when I trained my model to what it&#39;s getting in production?</p><p> 数据漂移：输入数据如何从我培训我的模型到它的内容时所怎样的＆＃39;</p><p> Model drift: how are the predictions/classifications that my model is making vary from when it was trained to what it&#39;s predicting in production?</p><p> 模型漂移：我的模型的预测/分类如何从培训到它的预测到它的培训时因培训而变化？</p><p>   Just  import boxkite and then add a call to the  ModelMonitoringService.export_text method. This tells boxkite to export a text file containing the histogram of your model’s statistical distributions of features (the data the model was trained on) and inferences (results of running your model against the training data).</p><p>   只是导入boxkite，然后添加到modelMonitorsService.export_text方法的调用。这告诉boxkite导出包含模型的统计分布的直方图的文本文件（模型培训的数据）和推广（将模型运行训练数据的结果）。</p><p> bunch  =  load_diabetes () X_train ,  X_test ,  Y_train ,  Y_test  =  train_test_split (  bunch . data ,  bunch . target ) model  =  LinearRegression () model . fit ( X_train ,  Y_train ) print ( &#34;Score:  %.2f &#34;  %  model . score ( X_test ,  Y_test )) with  open ( &#34;./model.pkl&#34; ,  &#34;wb&#34; )  as  f :  pickle . dump ( model ,  f ) # features = [(&#34;age&#34;, [33, 23, 54, ...]), (&#34;sex&#34;, [0, 1, 0]), ...] features  =  zip ( * [ bunch . feature_names ,  X_train . T ]) Y_pred  =  model . predict ( X_test ) inference  =  list ( Y_pred ) ModelMonitoringService . export_text (  features = features ,  inference = inference ,  path = &#34;./histogram.txt&#34; ,  # &lt;-- HERE ) mlflow . log_artifact ( &#34;./histogram.txt&#34; )</p><p> bunch = load_diabetes（）x_train，x_test，y_train，y_test = train_test_split（bunch。数据，束。目标）model = linearregression（）模型。 Fit（X_Train，Y_Train）打印（＆＃34;得分：％.2f＆＃34;％模型。分数（x_test，y_test））与打开（＆＃34; ./ model.pkl＆＃34;，＆＃34 ; WB＆＃34;）作为f：泡菜。转储（模型，f）＃特征= [（＆＃34;年龄＆＃34; [33,23,54，...]），（＆＃34;性别＆＃34; [0,1,0] ），......]功能= zip（* [束。feature_names，x_train。t]）y_pred = model。预测（x_test）推理=列表（y_pred）modelMonitoringService。 export_text（功能=特征，推理=推断，路径=＆＃34; ./ timogram.txt＆＃34;，＃＆lt;这里）mlflow。 log_artifact（＆＃34; ./ timogram.txt＆＃34;）</p><p> This way, boxkite takes a snapshot of the shape of the input and output of the model at training time, as well as the model itself. In this example, we’re logging the histogram to mlflow along with the model file itself, so that they can be tracked and versioned there together.</p><p> 这样，Boxkite在训练时间内采用模型的输入和输出的形状的快照，以及模型本身。在此示例中，我们正在将直方图与模型文件本身一起记录到MLFlow，以便可以在那里跟踪并将其传递在那里。</p><p>  In your model serving code (assuming your model is running in, say, a flask server), we initialize the  ModelMonitoringService class with the  histogram_file we collected at training time:</p><p>  在您的模型服务代码中（假设您的型号在，例如，烧瓶服务器），我们将ModelMonitorsService类初始化，并在培训时间收集的TIMITIM_FILE： </p><p>  Then when we’re doing inference, we call the  monitor.log_prediction method and boxkite will automatically compare our production time distributions to the training time distributions:</p><p>然后，当我们正在推理时，我们调用Monitor.Log_Prediction方法和Boxkite将自动将我们的生产时间分布进行比较到训练时间分布：</p><p> @app . route ( &#34;/&#34; ,  methods = [ &#34;POST&#34; ]) def  predict ():  features  =  request . json  score  =  model . predict ([ features ])[ 0 ]  pid  =  monitor . log_prediction (  # &lt;-- HERE  request_body = request . data ,  features = features ,  output = score ,  )  return  { &#34;result&#34; :  score ,  &#34;prediction_id&#34; :  pid }</p><p> @应用程序 。路线（＆＃34; /＆＃34;方法= [＆＃34; post＆＃34;]）def predict（）：特征=请求。 JSON得分=模型。预测（[特征]）[0] PID =监视器。 log_prediction（＃＆lt;  -  here请求_body =请求。数据，特征=特征，输出= score，）返回{＆＃34;结果＆＃34; ：得分，＆＃34; prediction_id＆＃34; ：PID}</p><p>  Then we expose a Prometheus format  /metrics endpoint which just calls into the  ModelMonitoringService&#39;s  export_http method:</p><p>  然后我们公开了一个普通的格式/度量标准端点，它只需调用ModelMonitoringService＆＃39; s organd_http方法：</p><p>  Then configure your Prometheus instance to scrape your model server. How you do this depends on your setup, you might need to add  prometheus.io/scrape: &#34;true&#34; to your pod annotations, or Prometheus might be set up to scrape your model server already.</p><p>  然后配置您的propetheus实例来刮窗格服务器。你如何这样做取决于你的设置，你可能需要添加proMetheus.io/scrape：＆＃34;真实＆＃34;到您的POD注释或可能会设置ProMetheus以刮掉模型服务器。</p><p>    The KL divergence and K-S Tests for how the variance of these distributions is varying over time!</p><p>    KL发散和K-S测试对这些分布的方差随着时间的变化而变化！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://boxkite.ml/en/latest/using/">https://boxkite.ml/en/latest/using/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/数据/">#数据</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/data/">#data</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/模型/">#模型</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>