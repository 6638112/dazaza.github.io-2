<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>加密的客户端您好：Firefox中ESNI的未来 Encrypted Client Hello: The Future of ESNI in Firefox</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Encrypted Client Hello: The Future of ESNI in Firefox<br/>加密的客户端您好：Firefox中ESNI的未来 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-09 18:13:51</div><div class="page_narrow text-break page_content"><p>Two years ago, we  announced experimental support for the privacy-protecting Encrypted Server Name Indication (ESNI) extension in Firefox Nightly. The Server Name Indication (SNI) TLS extension enables server and certificate selection by transmitting a cleartext copy of the server hostname in the TLS Client Hello message. This represents a privacy leak similar to that of DNS, and just as DNS-over-HTTPS prevents DNS queries from exposing the hostname to on-path observers, ESNI attempts to prevent hostname leaks from the TLS handshake itself.</p><p>两年前，我们宣布了对Firefox Nightly中保护隐私的加密服务器名称指示（ESNI）扩展的实验性支持。服务器名称指示（SNI）TLS扩展通过在TLS客户端问候消息中传输服务器主机名的明文副本来启用服务器和证书选择。这表示类似于DNS的隐私泄漏，就像HTTP-over-HTTPS阻止DNS查询将主机名公开给路径上的观察者一样，ESNI尝试阻止TLS握手本身导致的主机名泄漏。</p><p> Since publication of the ESNI draft specification at the IETF, analysis has shown that encrypting only the SNI extension provides incomplete protection. As just one example: during session resumption, the Pre-Shared Key extension could, legally, contain a cleartext copy of exactly the same server name that is encrypted by ESNI. The ESNI approach would require an encrypted variant of every extension with potential privacy implications, and even that exposes the set of extensions advertised. Lastly, real-world use of ESNI has exposed interoperability and deployment challenges that prevented it from being enabled at a wider scale.</p><p> 自从IETF发布ESNI规范草案以来，分析表明仅加密SNI扩展会提供不完整的保护。仅举一个例子：在会话恢复期间，预共享密钥扩展可以合法地包含与ESNI加密的服务器名称完全相同的明文副本。 ESNI方法将需要每个扩展的加密变体，这可能会隐含隐私，甚至会暴露所宣传的扩展集。最后，现实世界中对ESNI的使用暴露了互操作性和部署方面的挑战，这阻碍了它在更大范围内的启用。</p><p>  To address the shortcomings of ESNI, recent versions of the  specification no longer encrypt only the SNI extension and instead encrypt an entire Client Hello message (thus the name change from “ESNI” to “ECH”). Any extensions with privacy implications can now be relegated to an encrypted “ClientHelloInner”, which is itself advertised as an extension to an unencrypted “ClientHelloOuter”. Should a server support ECH and successfully decrypt, the “Inner” Client Hello is then used as the basis for the TLS connection. This is explained in more detail in Cloudflare’s excellent  blog post on ECH.</p><p>  为了解决ESNI的缺点，该规范的最新版本不再仅加密SNI扩展，而是加密整个Client Hello消息（因此名称从“ ESNI”更改为“ ECH”）。现在，任何涉及隐私的扩展都可以降级为加密的“ ClientHelloInner”，其本身被广告为未加密的“ ClientHelloOuter”的扩展。如果服务器支持ECH并成功解密，则将使用“内部”客户端Hello作为TLS连接的基础。 Cloudflare在ECH上的精彩博客文章中对此进行了详细说明。</p><p> ECH also changes the key distribution and encryption stories: A TLS server supporting ECH now advertises its public key via an  HTTPSSVC DNS record, whereas ESNI used TXT records for this purpose. Key derivation and encryption are made more robust, as ECH employs the  Hybrid Public Key Encryption specification rather than defining its own scheme. Importantly, ECH also adds a retry mechanism to increase reliability with respect to server key rotation and DNS caching. Where ESNI may currently fail after receiving stale keys from DNS, ECH can securely recover, as the client receives updated keys directly from the server.</p><p> ECH还更改了密钥分发和加密过程：支持ECH的TLS服务器现在通过HTTPSSVC DNS记录发布其公钥，而ESNI为此使用TXT记录。由于ECH采用混合公钥加密规范而不是定义自己的方案，因此密钥派生和加密变得更加健壮。重要的是，ECH还添加了重试机制以提高服务器密钥轮换和DNS缓存的可靠性。在从DNS接收过时的密钥之后，ESNI当前可能会失败的情况下，由于客户端直接从服务器接收更新的密钥，因此ECH可以安全地恢复。</p><p>  In keeping with our mission of protecting your privacy online, Mozilla is actively working with Cloudflare and others on standardizing the Encrypted Client Hello specification at the IETF. Firefox 85 replaces ESNI with ECH  draft-08, and another update to draft-09 (which is targeted for wider interoperability testing and deployment) is forthcoming.</p><p>  为了履行保护在线隐私的使命，Mozilla与Cloudflare以及其他组织积极合作，在IETF上标准化了加密客户端Hello规范。 Firefox 85用ECH草稿08取代了ESNI，并且即将发布对草稿09的另一个更新（旨在进行更广泛的互操作性测试和部署）。</p><p> Users that have previously enabled ESNI in Firefox may notice that the about:config option for ESNI is no longer present. Though we recommend that users wait for ECH to be enabled by default, some may want to enable this functionality earlier. This can be done in about:config by setting  network.dns.echconfig.enabled and  network.dns.use_https_rr_as_altsvc to true, which will allow Firefox to use ECH with servers that support it. While ECH is under active development, its availability may be intermittent as it requires both the client and server to support the same version. As always, settings exposed only under about:config are considered experimental and subject to change. For now,  Firefox ESR will continue to support the previous ESNI functionality.</p><p> 先前在Firefox中启用ESNI的用户可能会注意到，不再存在ESNI的about：config选项。尽管我们建议用户等待默认情况下启用ECH，但有些用户可能希望更早启用此功能。可以通过将network.dns.echconfig.enabled和network.dns.use_https_rr_as_altsvc设置为true来在about：config中完成，这将允许Firefox在支持ECH的服务器上使用ECH。在积极开发ECH时，其可用性可能是间歇性的，因为它需要客户端和服务器都支持相同的版本。与往常一样，仅在about：config下公开的设置被认为是实验性的，并且可能会更改。目前，Firefox ESR将继续支持以前的ESNI功能。</p><p> In conclusion, ECH is an exciting and robust evolution of ESNI, and support for the protocol is coming to Firefox. We’re working hard to make sure that it is interoperable and deployable at scale, and we’re eager for users to realize the privacy benefits of this feature.</p><p> 总而言之，ECH是ESNI令人兴奋且强大的演进，并且Firefox即将支持该协议。我们正在努力确保其可互操作性和可大规模部署，并且我们渴望用户实现此功能的隐私优势。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.mozilla.org/security/2021/01/07/encrypted-client-hello-the-future-of-esni-in-firefox/">https://blog.mozilla.org/security/2021/01/07/encrypted-client-hello-the-future-of-esni-in-firefox/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/客户端/">#客户端</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/client/">#client</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/esni/">#esni</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>