<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Postgres性能的费米估计</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Postgres性能的费米估计</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-17 08:58:20</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/f0eebb3ced7500affda07e2f6564b1fb.jpg"><img src="http://img.diglog.com/img/2020/8/f0eebb3ced7500affda07e2f6564b1fb.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>如果你想了解更多关于Microsoft Azure上的CATUS，请阅读这篇关于Azure Database for PostgreSQL上的Hyperscale(CATUS)的文章。</p><p>跳过导航许多人期待CITUTS提供一种解决方案，将他们的Postgres数据库横向扩展，无论是本地的、开源的还是云中的，都可以将其作为完全托管的数据库作为服务。然而，甚至在研究西图斯之前，一个常见的问题就是：“我能在波斯格雷斯身上获得什么样的表现？”答案是：这要视情况而定。单节点Postgres的性能归根结底取决于您的工作负载，包括插入和查询方面的工作负载，以及该单节点的大小。不幸的是，“视情况而定”往往会让人有点不满。</p><p>幸运的是，对于单节点Postgres可以提供什么样的性能，有一些费米估计，或者用外行术语大致估计。这些粗略估计都适用于单节点Postgres，但从那里您可以开始估计在使用CATUS向外扩展时还能走多远。让我们演练一个简化的指南，了解Postgres中查询的读取性能和摄取性能方面的预期。</p><p>首先要注意的是，当从内存而不是从磁盘提供数据时，查询速度将提高几个数量级。幸运的是，Postgres将非常高效地将频繁访问的数据保存在内存中。更好的是，您可以轻松地跟踪从缓存(而不是从磁盘)提供查询的频率。</p><p>选。</p><p>SUM(HEAP_BLKS_READ)AS HEAP_READ，</p><p>SUM(HEAP_BLKS_HIT)AS HEAP_HIT，</p><p>SUM(HEAP_BLKS_HIT)/(SUM(HEAP_BLKS_HIT)+SUM(HEAP_BLKS_READ))的比率</p><p>从…。</p><p>PG_STATIO_USER_TABLES；</p><p>通常，您的目标应该是缓存命中率达到99%或更高，除非您正在处理数据仓库/BI类型的工作负载，然后情况发生了一些变化。相反，一旦您必须转到磁盘，情况就会变得慢得多，尽管这都会因磁盘性能的不同而有所不同。举一个I/O带宽为100MB/s的示例(不是很惊人，但足够合理)，假设行大小为100字节，您将能够每秒扫描大约1,000,000行。</p><p>仅仅因为您有很高的缓存命中率，并不意味着您不会编写不好的查询，这些查询确实会不断命中内存，但性能很差。但是高速缓存命中率是一个很好的起点，糟糕的高速缓存命中率几乎可以立即为您指明正确的方向。</p><p>因此，在上面的示例硬件上，您可以说在1秒内扫描一百万条记录。Postgres的美妙之处在于，当您查询数据时，它并不总是扫描数据库中的所有数据，它更多地取决于您正在执行的操作类型。</p><p>在Postgres中，您能够通过的行数取决于您正在执行的操作。如果您有一个目标索引，并且正在检索单个记录或几组记录，那么期望它在毫秒内返回是合理的。当聚合数据时，或者如果您要从一些较大的数据集中进行筛选并返回几条记录，事情就会变得有点复杂。</p><p>如果您只是简单地过滤数据，并且数据可以放在内存中，Postgres每秒能够解析大约500-1000万行(假设某个合理的行大小为100字节)。如果您在聚合，那么您的速度大约是每秒100-200万行。所有这一切并不是说您不能在比方说10秒内聚合1亿行，但是为了做到这一点，您需要一定程度的并行性，因为这些数字是以每个内核为基础的。</p><p>正确的索引和调优都可以帮助您在读取端做些什么，但上面的内容应该会给您提供一个预期的起点。现在让我们转到数据摄取。</p><p>有几个因素会影响Postgres中的写入性能。决定您可以达到的吞吐量的一个重要因素是您是在查看单行插入还是使用Copy进行批量加载。</p><p>对于单行插入，如果您的应用程序使用单线程，瓶颈主要是网络延迟。对于您发送到数据库的每一次写入，写入都必须从您的应用程序转到数据库，并且数据库的写入确认必须返回到您的应用程序。因此，如果您的应用程序和数据库位于不同的区域，例如延迟为5ms，那么您预计每秒将看到大约100个插入(1000毫秒/(5ms+5ms))。在AWS上的同一区域，假设延迟为1ms，这个数字可能会上升到每秒约500次插入。</p><p>提示：对于大多数应用程序，通常建议使用能够同时服务多个请求的生产Web服务器。</p><p>一旦您有多个线程/进程为请求提供服务，那么您可以预期写入吞吐量会随着您所在的硬件的扩展而增加。在较小的AWS实例(例如r4.xLarge/r4.2xLarge)上，这个数字可能以个位数千为单位，而对于较大的实例，这个数字可能会增加到几十几千。确切的数字取决于每行的大小、数据类型以及是否有索引。</p><p>拥有更多索引可以让您拥有更好的读取性能，但会给写入端带来负担。例如，如果在没有索引的情况下，单个INSERT语句在数据库端的执行时间为0.1ms，则添加索引可能会使该时间增加一个数量级。此外，随着表和索引大小的增加，对写入性能的影响也会增加。因此，请注意故意创建索引，以保持最佳写入性能。</p><p>数据库中有索引，但不确定它们是否正在使用？此查询将报告前几位未使用的索引：</p><p>选。</p><p>Schemaname||&#39；.&#39；||重命名为表，</p><p>Indexrelname作为索引，</p><p>PG_SIZE_Pretty(PG_Relationship_Size(i.。INDEX_RELID))作为INDEX_SIZE，</p><p>IDX_SCAN作为INDEX_SCANES。</p><p>从PG_STAT_USER_INDEX UI。</p><p>在UI上加入PG_INDEX I。Indexrelid=i。索引对象。</p><p>WHERE NOT INDIQUIZE AND IDX_SCAN&lt；50和PG_Relationship_Size(REID)&gt；5*8192。</p><p>按PG关系大小排序(i.。IndexRelid)/NULLIF(IDX_SCAN，0)DESC NULL First，</p><p>PG关系大小(i.。Indexrelid)DESC；</p><p>在更新和删除方面，如果您有正确的索引，您可以预期更新和删除吞吐量与插入吞吐量大致相同(尽管略低)。定向更新和删除的一个重要因素是在具有UPDATE条件的列上具有索引。如果没有这样的索引，那么每次更新都必须扫描整个表，这会大大降低速度：(。</p><p>许多应用程序通常需要超过每秒10,000次写入。我们发现这在实时分析领域尤其常见。这里的实时可能落后几秒或几分钟，但本质上是人类的实时。但是，数据摄取可能有更高的要求。在使用Postgres时，如果您确实需要每秒超过10,000秒的插入写入，我们会求助于Postgres复制实用程序进行批量加载。</p><p>Copy能够处理每秒100,000秒的写入。即使没有持续的高写入吞吐量，拷贝也可以方便地快速摄取非常大的数据集。要每秒接收100,000个写入，您不必创建这种大小的批，而实际上可以通过微批处理(比方说每几千个组)加载小得多的批。</p><p>提示：索引对接收性能有相当高的影响。在使用COPY加载大量数据时，通常首先加载数据，然后从接收性能的角度创建索引。</p><p>因为西图斯是Postgres的延伸，我们站在Postgres的肩膀上，利用那里存在的所有令人敬畏的基础。这意味着Postgres在一秒钟内聚合每个核心200万条记录的能力适用于CITUS，但是由于我们的水平规模，您可以预期集群中的每个核心会有200万条记录。</p><p>类似地，对于写入，一次写入可能需要1ms，但是由于CUTUS允许您在幕后拥有多个Postgres实例来执行写入，所以您可以开始以同样的方式向外扩展写入。在没有使用拷贝的情况下，我们看到CUTUS MX扩展到每秒超过500,000个插入，而当利用拷贝时，这个数字可能会超过每秒500万次写入。</p><p>想了解更多关于我们可以促进的规模的信息吗？请查看Heap的CTO Dan Robinson关于他们如何利用CUTUS对超过50 TB的数据执行实时分析的演讲：</p><p>Postgres不仅是先进的，而且也可以表现得相当好。因此，不要认为一个已经存在了20年的陈旧数据库不能处理您的工作负载。是的，Postgres的性能确实取决于底层的硬件，但Postgres的整体性能在以下方面表现出色：</p><p>单行插入主要与往返网络延迟相关，当与并发Web服务器一起运行时，在单节点数据库上最多可插入10,000个单行或更多单行。</p><p>当然，如果您需要将Postgres性能的界限扩展到单个节点之外，那么您可以指望CUTUS来扩展您的Postgres数据库。如果您确实发现自己担心扩展或在单节点Postgres上遇到限制，无论是从读取还是从吞吐量的角度来看，请让我们知道，我们很乐意帮助您确定CUTUS是否适合您和您的SaaS应用程序。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.citusdata.com/blog/2017/09/29/what-performance-can-you-expect-from-postgres/">https://www.citusdata.com/blog/2017/09/29/what-performance-can-you-expect-from-postgres/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/性能/">#性能</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/postgres/">#postgres</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/estimates/">#estimates</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1018375.html"><img src="http://img.diglog.com/img/2020/8/thumb_1a1b5e25e97691c1ac9b383639705864.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1018375.html">7/5/3 nm的功率和性能优化</a></div><span class="my_story_list_date">2020-8-16 3:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1018124.html"><img src="http://img.diglog.com/img/2020/8/thumb_09bcb891050fdb320acaad6cb47025fa.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1018124.html">
北极星2在驾驶性能和享受方面胜过特斯拉Model 3</a></div><span class="my_story_list_date">2020-8-15 0:52</span></div><div class="col-sm"><div><a target="_blank" href="/story/1018114.html"><img src="http://img.diglog.com/img/2020/8/thumb_1a1e1696fc8c88a2df0bfa13ba41cc91.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1018114.html">英特尔称新晶体管技术可将芯片性能提高20%</a></div><span class="my_story_list_date">2020-8-15 0:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1017937.html"><img src="http://img.diglog.com/img/2020/8/thumb_73b77a3d6ff3de6cd43988e108809b62.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1017937.html">英特尔首次展示了其下一代Tiger Lake处理器和Xe显卡，这两款处理器都承诺提供更高的性能和更低的功耗</a></div><span class="my_story_list_date">2020-8-13 21:39</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>