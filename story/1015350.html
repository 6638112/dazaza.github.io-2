<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>对Commodore 128中的PLA芯片进行逆向工程</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">对Commodore 128中的PLA芯片进行逆向工程</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-31 10:08:39</div><div class="page_narrow text-break page_content"><p>正如我在上一篇文章中提到的，我一直在对C128中的PLA芯片进行逆向工程，现在我已经基本完成了这个过程，所以我认为是时候分享一些发现了。</p><p>这是一个非常有趣的项目，因为我对半导体设计和制造了解不多。我现有的知识延伸到看过一些死亡镜头，欣赏过那些漂亮的照片。</p><p>这一切都是从我买了一台便宜的显微镜来帮助焊接表面贴装元件开始的。</p><p>一段时间后，我最终在YouTube上观看了一段视频，视频显示了一种从包装中取出硅片的更简单的方法。</p><p>这看起来很简单，可以在家里试一试，因为我已经有了所有需要的设备。拆解集成电路通常涉及加热的硫酸或其他类似的令人讨厌的化学物质，我真的不想在家里玩这些东西。因此，我挖出了几个散落在各处的MOS芯片(不要扔掉东西，可能会派上用场)。在摆弄了一会儿之后，我最终得到了两个8521R0骰子和一个8721PLA。第一张真正的照片是上一篇帖子中显示的那张。</p><p>虽然这是成功的，但我很快意识到，这台显微镜没有足够的分辨率让我能够捕捉到足够高质量的图像。使用2倍Barlow镜头时，最大放大倍数为90倍。此外，它没有舞台，所以我不得不把碟子放在桌子上，然后移动整个显微镜，这非常不稳定，很难捕捉到你想要看到的部分。</p><p>事实证明，这款相机在拍摄质量不错的照片方面要好得多，但我对用它买的相机并不满意。这是一款便宜的相机，除了使用AmScope应用程序外，我无法远程管理它。大约在这个时候，Raspberry Pi基金会发布了用于Raspberry Pi的新款高品质相机。这台相机上有一个与显微镜相配的C型支架，所以我很快就把它放到了显微镜上。这款相机非常适合这项工作，可以在舒适的Linux上完全控制整个过程。</p><p>总而言之，这是对以前设置的巨大改进。有了更高的分辨率，我开始需要把照片缝合在一起来制作更大的照片。这在开始时听起来很简单，但最终(正如您可能猜到的那样)并不是很容易。我还在努力缝合，但慢慢好起来了。一个成功的全景拼接的关键之一是在平移、对焦、白平衡等方面拥有一致的照片。照片越均匀，拼接就越容易、越好。</p><p>这使我开始致力于电动化这张桌子。不得不手动移动桌子真的很烦人，照片最终要在多个轴上移动，等等。</p><p>大量的设计工作，3D打印和对CNC固件的研究之后，我最终完成了以下设置：</p><p>从顶部开始，我们有一个7英寸的Raspberry显示屏，背面安装了一个Raspberry pi4。没有看到的还有安装在显微镜上的RPI HiQ相机。RPI拍摄照片，在显示器上显示预览，还运行控制CNC板的python代码。</p><p>工作台和调平工作台由28BYJ-48步进电机驱动，使用一个运行Grbl_Esp32的ESP32和四个AD4498步进电机控制器的小电路板进行控制。</p><p>整个设置在软件和硬件上都有一些问题，但现在它工作得足够好，可以让我做一些工作。</p><p>物流现在已经理顺了，我又回到了芯片本身的逆向工程工作上。我最初的关注点是PLA Chipas，这应该是最简单的解决方案之一。PLA代表可编程逻辑阵列，是这个时代设计中非常常见的结构。</p><p>看一下维基百科的示意图，我们应该会看到两个主要的数组，AND和OR。输入连接到OR阵列的AND AND输出。</p><p>返回到上一次的冲模，可以通过对管脚和芯片的一般区域进行一些注释来改进它。一旦我们建立了引脚，我们就可以看到所有的输入都连接到一个阵列，所有的输出都连接到另一个阵列，正如预期的那样。这也有助于我们确定哪个阵列是哪个阵列。</p><p>在这里，我们看到I/O引脚标有它们如何连接到引线框架和DIP本身上的引脚。我们还可以看到组成PLA结构的两个主要区域，AND数组和OR数组。此外，底部还有一些用问号标记的额外逻辑。我不知道它的功能，但由于所有的输出引脚都通过它，我猜测这是某种类型的输出阶段。</p><p>因此，如果我们仔细研究一下和矩阵，我们将看到以下内容。颜色有点不对劲，因为这仍然是用AmScope相机完成的，我不知道如何在上面设置白平衡。</p><p>这对理解发生了什么没有太大帮助，因为所有有趣的部分都被最上面的金属层掩盖了。这是在我还在学习很多东西的早期，所以为了移除金属，我采取了一种非常暴力的方法。我使用重型机械擦洗来去除金属，我也了解到，一旦我把它放回显微镜里，它已经除去了除了衬底本身之外的所有东西。哎呀。</p><p>仔细观察这张图像，我们可以看到晶体管所在的小弯曲线，以在矩阵中创建连接。</p><p>继续看OR数组，我们会看到完全相同的模式。金属层就位很难辨别，尽管与AND矩阵相比更容易。只剩下衬底和扩散就容易多了。</p><p>有了这些知识，我们现在可以继续从图像中提取完整的PLA逻辑矩阵。</p><p>我用一个点标记了每个矩阵中的所有晶体管，得到了下面的图片：</p><p>所有输入在AND矩阵中都是水平的，每行都有一个正常信号和一个反相信号被馈入。所有输出在OR矩阵中都是水平的，它们由称为乘积项的垂直线连接。</p><p>例如，通过查看点，我们可以通过对AND矩阵中的所有垂直线执行逻辑AND来解码乘积项。</p><p>P0=Charen&amp；Hiram&amp；BA&amp；！MS3&amp；游戏&amp；RW&amp；AEC&amp；A12&amp；！A13&amp；A14&amp；A15。</p><p>例如，对于输出，我们改为水平查看每个输出，并与或组合。</p><p>回过头来看完整的芯片图片，现在除了输出路径中标有问号的盒子之外，我们已经拥有了所有东西。</p><p>看一看这个的高分辨率照片，我们可以看到每个输出都有相似的结构。除两种情况外，所有情况下都绕过结构，OR矩阵的输出直接进入输出引脚。但是，两个端号DWE和CASENB并非如此。</p><p>DWE是去往主系统DRAM芯片的写使能信号，CASENB将CAS信号选通到RAM。这两个信号是使用这些输出门结构以某种形式进行处理的，所以我必须对这个模块进行反向工程。</p><p>在阅读了相当长一段时间的硅芯片设计和制造以及多次尝试之后，我终于想出了一个有意义的原理图。我不打算在这里讨论整个过程，但我会在稍后记录并发布它。在这里，我也要感谢弗兰克·沃尔夫的帮助，如果可以的话，请支持他的项目！</p><p>更进一步说，它在DWE和CASENB输出中的使用方式使其成为普通的D锁存器。对于OR矩阵中的一对行中的PLA矩阵，也会出现对此的锁存启用。</p><p>因此，作为最终结果，我们现在可以写下C128PLA芯片的完整HDL代码。为此，我使用verilog。请注意，这是我写过的第一个verilog，所以它可能是次优的。在verilog中使用D锁存器输出通常被认为是一件坏事，但在这种情况下，我这样做是为了复制现有芯片的逻辑和功能。</p><p>据我所知，我已经证实了这一点，但如果我遗漏了什么，请让我知道！</p><p>与C64PLA不同的是，由于输出锁存器的存在，C128PLA不能仅用EPROM或类似的器件代替。</p><p>模块pla_8721(输入rom_256，输入va14，输入charen，输入hiram，输入loam，输入ba，输入vma5，输入vma4，输入ms0，输入ms1，输入ms2，输入ms3，输入z80io，输入z80en，输入exrom，输入游戏，输入rw，输入aec，输入dmaack，输入vicfix，输入a10，输入a11，输入a12，输入a13，输入a14，输入a15，输入。OUTPUT FROM、OUTPUT ROM4、OUTPUT ROM3、OUTPUT ROM2、OUTPUT ROM1、OUTPUT IOCS、OUTPUT DIR、OUTPUT REG DWE、OUTPUT REG CASENB、OUTPUT VIC、OUTPUT IOACC、OU。导线p0；导线p1；导线p2；导线p3；导线p4；导线p5；导线p6；导线p7；导线p8；导线p9；导线p10；导线p11；导线p12；导线p13；导线p14；导线p15；导线p16；导线p17；导线p18；导线p19；导线p20；导线p21；导线p22；导线p23；导线p24；导线p25；导线p26；导线p27；导线p28；导线p29；线p44；线p45；线p46；线p47；线p48；线p49；线p50；线p51；线p52；线p53；线p54；线p55；线p56；线p57；线p58；线p59；线p60；线p61；线p62；线p63；线p64；线p65；线p66；线p67；线p68；线p69；线p70；线p71；线p72；线p73；线。Wire p88；wire p89；wire casenb_int；/*产品条款*/Assign P0=Charen&amp；Hiram&amp；ba&amp；！MS3&amp；Game&amp；RW&amp；A12&amp；！A13&amp；A14&amp；a15；Assign p1=Charen&amp；Hiram&amp；！MS3&amp；Game&amp；！RW&amp；AEC&amp；！A14&amp；a15；分配p2=Charen&amp；Loram&amp；ba&amp；！MS3&amp；游戏&amp；rw&amp；AEC&amp；a12&amp；！a13&amp；a14&amp；a15；分配p3=Charen&amp；Loram&amp；！MS3&amp；游戏&amp；！RW&amp；AEC&amp；A12&amp；！A13&amp；A14&amp；a15。Hiram&amp；ba&amp；！MS3&amp；！exrom&amp；！Game&amp；rw&amp；AEC&amp；A12&amp；！A13&amp；A14&amp；a15；分配P5=Charen&amp；Hiram&amp；！MS3&amp；！exrom&amp；！Game&amp；！RW&amp；AEC&amp；A12&amp；！A13&amp；A14&amp；a15；Assign p6=Charen&amp；Loram&amp；ba&amp；！MS3&amp；！exrom&amp；！Game&amp；RW&amp；AEC&amp；A12&amp；！A13&amp；a14&amp；a15；Assign p7=Charen&amp；Loram&amp；！MS3&amp；！exrom&amp；！Game&amp；！RW&amp；AEC&amp；！A13&amp；！A15；分配p8=ba&amp；！ms3&amp；exrom&amp；！Game&amp；rw&amp；AEC&amp；a13&amp；！A13&amp；a14&amp；a15；分配p9=！MS3&amp；exrom&amp；！Game&amp；rw&amp；AEC&amp；a12&amp；！a13&amp；a14&amp；a15；分配p10=ba&amp；！MS2&amp；RW&amp；AEC&amp；a12&amp；！A13&amp；A14&amp；a15；Assign p11=！MS2&amp；MS3&amp；！RW&amp；AEC&amp；A12&amp；！a13&amp；a14&amp；a15；Assign p12=Charen&amp；Hiram&amp；ba&amp；！MS3&amp；游戏&amp；RW&amp；AEC&amp；！A10&amp；！A10&amp；A12&amp；！A13&amp；A14&amp；a15；Assign p13=Charen&amp；Hiram&amp；！MS3&amp；Game&amp；！RW&amp；AEC&amp；！A10&amp；！A11&amp；a12&amp；！A13&amp；A14&amp；a15；Assign p14=Charen&amp；Loram&amp；ba&amp；！MS3&amp；Game&amp；RW&amp；Aa。！A10&amp；！A11&amp；a12&amp；！A13&amp；A14&amp；a15；Assign p15=Charen&amp；Loram&amp；！MS3&amp；Game&amp；！RW&amp；AEC&amp；！A10&amp；！A11&amp；a12&amp；！A13&amp；a14&amp；a15；Assign p16=Charen&amp；Hiram&amp；BA&amp；！MS3&amp；！exrom&amp；！Game&amp；rw&amp；AEC&amp；！A10&amp；！A11&amp；A12&amp；！A13&amp；A14&amp；a15；Assign p17=Charen&amp；Hiram&amp；！MS3&amp；！exrom&amp；！Game&amp；！RW&amp；AEC&amp；！A10&amp；！A11&amp；A12&amp；！A13&amp；A14&amp；a15；Assign p18=Charen&amp；Loram&amp；BA&amp；！MS3&amp；！Exrom&amp；！Game&amp；RW&amp；AEC&amp；！A10&amp；！A11&amp；a12&amp；！A13&amp；A14&amp；a15；Assign p19=Charen&amp；Loram&amp；！MS3&amp；！exrom&amp；！Game&amp；！</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://c128.se/posts/silicon-adventures/">https://c128.se/posts/silicon-adventures/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/芯片/">#芯片</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/逆向工程/">#逆向工程</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/输入/">#输入</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1015106.html"><img src="http://img.diglog.com/img/2020/7/thumb_3dce57d23e54b592a606ff0db71bac1f.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1015106.html">
三星第二季获利同比增长23%得益于芯片需求强劲</a></div><span class="my_story_list_date">2020-7-30 13:58</span></div><div class="col-sm"><div><a target="_blank" href="/story/1015092.html"><img src="http://img.diglog.com/img/2020/7/thumb_8032faff566c06033707ae6a643402a8.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1015092.html">三星公布第二季度销售额约445亿美元，同比下降5.6%，但营业利润约68亿美元，同比增长23.5%，原因是对内存芯片的需求增加</a></div><span class="my_story_list_date">2020-7-30 10:16</span></div><div class="col-sm"><div><a target="_blank" href="/story/1014386.html"><img src="http://img.diglog.com/img/2020/7/thumb_d1980b254e7094912c43dddbbfa1dde8.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1014386.html">ADLPlug：调频芯片合成器</a></div><span class="my_story_list_date">2020-7-27 19:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1013966.html"><img src="http://img.diglog.com/img/2020/7/thumb_9e2fc08b9c00bc244a767ea551bf4f68.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1013966.html">英特尔称其7纳米芯片延迟至少一年</a></div><span class="my_story_list_date">2020-7-24 22:24</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>