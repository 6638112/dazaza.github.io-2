<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>ViewFlow，一个用于在没有气流的情况下写入数据模型的开源框架 Viewflow, an open source framework for writing data models without Airflow</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Viewflow, an open source framework for writing data models without Airflow<br/>ViewFlow，一个用于在没有气流的情况下写入数据模型的开源框架 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-30 03:03:24</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/55a0826796b229ffc07a7c96ad0007ad.png"><img src="http://img2.diglog.com/img/2021/3/55a0826796b229ffc07a7c96ad0007ad.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In this post, we introduce  Viewflow, a newly released open-source framework that allows data scientists to create data models without writing Airflow code.</p><p>在这篇文章中，我们介绍了ViewFlow，一个新发布的开源框架，允许数据科学家在不编写Airflow代码的情况下创建数据模型。</p><p> To provide DataCamp with business insights, our data scientists build their data models by creating materialized views — the results of complex data manipulations. These materialized views are created based on raw data and are often dependent on other materialized views. We use  Apache Airflow, a framework that allows users to create and schedule data workflows programmatically. Programming Apache Airflow, however, can be complex and time-consuming. The more views we have in a data workflow, the more Airflow code we must write and maintain.</p><p> 为了提供具有商业洞察的DataCamp，我们的数据科学家通过创建物化视图来构建其数据模型 - 复杂数据操作的结果。这些物化视图是基于原始数据创建的，并且通常依赖于其他物化视图。我们使用Apache Airflow，这是一个框架，允许用户以编程方式创建和安排数据工作流程。然而，编程apache气流可能是复杂且耗时的。我们在数据工作流程中的视图越多，我们必须编写和维护的空气流代码就越多。</p><p> At DataCamp, we strongly believe that our data scientists should focus on writing views (i.e., writing SQL, R, or Python code that provides actionable insights), and not writing Airflow code.</p><p> 在DataCamp，我们强烈认为，我们的数据科学家应该专注于写作观点（即写入SQL，R或Python代码，提供可操作的见解），而不是编写Airflow代码。</p><p> To enable our data scientists to avoid writing Airflow code, we built Viewflow. Viewflow is a framework that automatically transforms a series of SQL, R markdown, and Python files into an Apache Airflow workflow, i.e., a directed acyclic graph (DAG) made up of tasks. A DAG is the Airflow implementation of a logical data model, and a task is the Airflow implementation of a view.</p><p> 为了使我们的数据科学家能够避免编写Airflow代码，我们构建了ViewFlow。 ViewFlow是一个框架，它会自动将一系列SQL，R Markdown和Python文件转换为Apache Airflow Workflow，即由任务组成的定向非循环图（DAG）。 DAG是逻辑数据模型的气流实现，并且任务是视图的气流实现。</p><p> Today, we are excited to announce our contribution to the open-source community by  releasing the source code of Viewflow! With Viewflow, not only will your data scientists be able to focus on what they do the best — providing business insights — but they will do so at a much faster pace because they won’t need to worry about data engineering tasks.</p><p> 今天，我们很高兴通过释放ViewFlow源代码来宣布对开源社区的贡献！使用ViewFlow，不仅您的数据科学家们能够专注于他们所做的最佳信息 - 但他们将以更快的速度执行此操作，因为他们不需要担心数据工程任务。</p><p>  At DataCamp, not only do we  teach data science, but we also  do data science. We have a great team of data scientists that conduct financial analyses (ARR, revenue share, subscriptions, churn, …), content analyses (course rating, projects completions, users time spent), marketing analyses (acquisitions, conversions, ad spend), and also implement advanced analytics such as course recommendations or  skill assessments.</p><p>  在DataCamp，不仅我们教导数据科学，而且我们也做数据科学。我们有一个伟大的数据科学家团队，进行财务分析（ARR，收入份额，订阅，流失，......），内容分析（课程评级，项目完成，用户花费），营销分析（收购，转换，广告），并实施高级分析，例如课程建议或技能评估。</p><p> To perform these analyses, our data scientists create  materialized  views. A materialized view results from (potentially complex) data transformations, such as aggregations, joins, or the implementation of business rules.</p><p> 为了进行这些分析，我们的数据科学家会创建物化视图。物化视图来自（潜在复杂的）数据转换，例如聚合，加入或业务规则的实施。 </p><p> Depending on the views&#39; complexity, our data scientists create them in SQL, R, or Python. They are free to use the language they believe is the best to make their views.</p><p>取决于观点＆＃39;复杂性，我们的数据科学家在SQL，R或Python中创建它们。他们可以自由地使用他们认为是最好的观点的语言。</p><p> Once the views are created or updated, they are used to develop our dashboards, and they are accessible to every DataCamp employee. DataCamp employees can query these views in SQL (for instance, via  Metabase), in R or Python. Once again, we provide users with the language that suits best their use cases.</p><p> 创建或更新视图后，它们用于开发我们的仪表板，并且每个DataCamp员工都可以访问它们。 DataCamp Employees可以在SQL（例如，通过元数据库），R或Python中查询这些视图。我们再一次为用户提供适合最佳用例的语言。</p><p> Curious to find out how we allow our users to easily connect to our data warehouse in R or Python? We created two internal packages — datacampr and datacampy that both handle authentication to our data warehouse and that provide our data scientists with utility methods to query and manupilate the data. These packages will be the topic of a future blog post!</p><p> 很想了解我们如何允许用户轻松连接到R或Python的数据仓库？我们创建了两个内部软件包 -  DataCampr和DataCampy，它们对我们的数据仓库处理身份验证，并为我们的数据科学家提供了有用方法来查询和修改数据。这些包将是未来博客文章的主题！</p><p> These views are considered the source of truth for every business decision we make in the company, be it for a product manager for implementing new product features or for our VP of Finance for critical financial decisions.</p><p> 这些观点被认为是我们在公司中所做的每种商业决策的真理来源，是为实现新产品特征或为批判性财务决策的财务副总裁的产品经理。</p><p>  We use Apache Airflow to schedule the SQL queries’ execution and the R and Python scripts that create our views. In Airflow, a view is created by a task, and we organize these tasks in different DAGs — one (or multiple) DAGs per business unit (e.g., marketing, finance, content). This organization allows us to have clear and readable DAGs, where it is easy to find a task we are looking for (for debugging purposes, for instance, or to manually trigger it after code changes).</p><p>  我们使用Apache Airflow来安排创建视图的SQL查询的执行和R和Python脚本。在Airflow中，一个任务创建了一个视图，我们在不同的DAG中组织了这些任务 - 每位业务部门的一个（或多个）DAG（例如，营销，金融，内容）。该组织允许我们具有清晰可读的DAG，在那里很容易找到我们正在寻找的任务（例如，用于调试目的，或者在代码更改后手动触发它）。</p><p> We have a total of 19 DAGs that create 500+ views in our Redshift data warehouse. Here is our finance DAG:</p><p> 我们共有19个DAG，在我们的Redshift数据仓库中创建了500多种景观。这是我们的财务表现：</p><p>  As you can see in the Finance DAG, many views have dependencies, that is, they use data from previously created views. These dependencies can be either internal or external. An internal dependency is an upstream view in the same DAG (i.e., the views are connected within the DAG). An external dependency is a view that belongs to a different DAG. In the image above, internal dependencies are depicted by two tasks being connected. External dependencies are depicted by a task with a dark background (i.e., an external task sensor in Airflow).</p><p>  正如您在财务DAG中看到的那样，许多视图都有依赖关系，即它们使用先前创建的视图中的数据。这些依赖关系可以是内部或外部。内部依赖项是同一DAG中的上游视图（即，视图在DAG内连接）。外部依赖性是属于不同DAG的视图。在上面的图像中，内部依赖项被连接的两个任务描述。外部依赖性由具有深色背景（即气流中的外部任务传感器）的任务描述的外部依赖性。 </p><p> As depicted in the image above, our DAGs can be pretty complicated, with many internal and external dependencies. To write a new view  without Viewflow, our data scientists would need to:</p><p>如上所述所示，我们的DAG可能是非常复杂的，具有许多内部和外部依赖性。要在没有ViewFlow编写新视图，我们的数据科学家需要：</p><p> Update the Python DAG script for the new task using the Airflow API and correct Airflow operators.</p><p> 使用AirFlow API和正确的气流运算符更新新任务的Python DAG脚本。</p><p> Write Python code to define the task’s internal and external dependencies using the Airflow API.</p><p> 编写Python代码以使用AirFlow API定义任务的内部和外部依赖项。</p><p> Only the first step creates data science value. The last two steps do not add to the scientific value but are required to materialize the new view.</p><p> 只有第一步创建数据科学价值。最后两个步骤不增加科学价值，但需要实现新视图。</p><p> Moreover, the last two steps can be problematic for several reasons. First, they require specific knowledge of Airflow. Second, they are prone to programming bugs due to requiring context switching between data science and data engineering and manually writing logic in code. Third, logical errors may not produce programming errors or exceptions and could pass all tests but produce bad end-user data that is difficult to identify and debug.</p><p> 此外，由于几个原因，最后两个步骤可能是有问题的。首先，它们需要具体的气流知识。其次，由于需要在数据科学和数据工程之间的上下文切换以及代码中手动编写逻辑之间的上下文切换，它们易于编程错误。第三，逻辑错误可能不会产生编程错误或异常，并且可以通过所有测试，但会产生难以识别和调试的不良最终用户数据。</p><p> For example, if view C depends on data of views A and B (see the left-most side of the Figure below), but A was not manually set as a dependency of C (see the right-most side of the Figure below), then C might run before A was updated (depending on how the scheduler picks-up the tasks). In this case, view C will be updated but not up to date. It will contain stale data due to the error in setting logical dependencies. If that view is used for high-stakes business decisions, the consequences of that logical error can be large.</p><p> 例如，如果View C取决于视图A和B的数据（请参阅下图的左侧），但是一个没有手动设置为C的依赖性（参见下图的最右侧） ，然后C可能在更新A之前运行（取决于调度程序如何拾取任务）。在这种情况下，View C将更新，但不是最新的。由于设置逻辑依赖项中的错误，它将包含陈旧的数据。如果该视图用于高赌注业务决策，则该逻辑错误的后果可能很大。</p><p>   Viewflow is a framework built on the top of Airflow that handles the creation of Airflow DAGs and tasks and automatically manages the task dependencies (be it internal or external). Viewflow enables data scientists to focus on the view creation logic in their preferred tool (SQL query or R script, or Python). This significantly reduces the data engineering burden on data scientists.</p><p>   ViewFlow是一个内置在气流顶部的框架，处理Airflow DAG和任务的创建，并自动管理任务依赖项（是内部或外部）。 ViewFlow使数据科学家能够专注于他们首选工具（SQL查询或R脚本或Python）中的视图创建逻辑。这显着降低了数据科学家的数据工程负担。 </p><p>  Write the SQL query or the Rmd or Python script to create the view and provide additional metadata (e.g., view’s description, columns’ description, see code snippets below).</p><p>编写SQL查询或RMD或Python脚本以创建视图并提供其他元数据（例如，查看的描述，列'描述，请参阅下面的代码片段）。</p><p>  By taking care of creating the task and setting the task’s dependencies, Viewflow provides:</p><p>  通过照顾创建任务并设置任务的依赖项，ViewFlow提供：</p><p> Quality of life improvements for data scientists. Data scientists choose their preferred language to solve the problem and focus their contribution on writing data science code.</p><p> 数据科学家的生活质量改进。数据科学家选择他们的首选语言来解决问题，并将其对写数据科学代码的贡献。</p><p> Reduced context switching. Since data scientists do not need to write Airflow code and manually set logical dependencies, data science and data engineering concerns are separated. Adding a view does not require both contexts.</p><p> 减少上下文切换。由于数据科学家不需要编写气流代码并手动设置逻辑依赖性，因此数据科学和数据工程问题是分开的。添加视图不需要两个上下文。</p><p> Increased velocity. By simplifying data scientists&#39; contribution flow, new views can be added faster, and the team can be more responsive to requests.</p><p> 增加速度。通过简化数据科学家＆＃39;贡献流程，可以更快地添加新视图，并且该团队可能更响应请求。</p><p> DataCamp’s mission is to  democratize data science. This is true for our users, but this is also true for ourselves. We want to allow every DataCamp er (and everyone, really) to become data-driven.</p><p> Datacamp的使命是民主化数据科学。这对我们的用户来说是正确的，但这对我们来说也是如此。我们希望允许每个DataCamp ER（以及每个人，真的）成为数据驱动的。</p><p> Viewflow is a step towards our goal. Viewflow effectively reduces the barrier to entry. We have seen DataCamp employees without data science backgrounds (for example, engineers with SQL knowledge or Product Managers familiar with R) are able to create new views with Viewflow without writing a single line of Airflow code.</p><p> ViewFlow是我们目标的一步。 viewflow有效地减少了进入的障碍。我们已经看到没有数据科学背景的DataCamp员工（例如，具有熟悉的SQL知识或产品经理的工程师）能够使用ViewFlow创建新视图，而无需编写单行的Airflow代码。 </p><p> With Viewflow, whether you are a data scientist or not, all you need to do is write SQL, Python, or R code to produce new insights.</p><p>使用ViewFlow，无论您是数据科学家，您需要做的就是编写SQL，Python或R代码以产生新的见解。</p><p>  Viewflow has been extremely useful for us and kept its promise: data scientists should write views, not Airflow code. Because of the benefits of Viewflow at DataCamp, we believe it could help other data organizations become more efficient. We are proud to contribute Viewflow to the open-source community.</p><p>  ViewFlow对我们非常有用，并保持其承诺：数据科学家应该写视图，而不是气流代码。由于ViewFlow在DataCamp的好处，我们认为它可以帮助其他数据组织变得更加高效。我们很自豪地为开源社区贡献viewflow。</p><p> Want to see Viewflow in action?  Run our demo on your local machine! The demo creates an Airflow docker container shipped with Viewflow and a Postgres Docker container used as a data warehouse in which the views are created. Make sure to follow the  README instructions and judge by yourself if Viewflow is made for you!</p><p> 想要看到viewflow在动作中？在当地机器上运行我们的演示！演示创建一个带有ViewFlow的Airflow Docker集装箱以及用作数据仓库的Postgres Docker容器，其中创建了视图。如果为您提供ViewFlow，请务必遵循自述指示并根据您自己判断！</p><p> We decided to release a subset of the current features that Viewflow supports at the moment (i.e., SQL and Python views). Some components of the Viewflow version we use internally were written for DataCamp’s specific use cases. For instance, Rmd views are executed on Amazon Fargate. In its current state, it would be complicated for a user to use all of the Viewflow features we have at the moment. However, we strongly believe that the SQL and Python views can be extremely useful. We will continue to add new view types (e.g., Rmd, Jupyter notebook) in the coming months. Of course, if you see value in Viewflow and would like to contribute, don’t hesitate to create a pull request or a new feature request!</p><p> 我们决定释放目前特征的子集目前的viewFlow支持（即，SQL和Python视图）。我们在内部使用的ViewFlow版本的某些组件是为Datacamp的特定用例编写的。例如，RMD视图在Amazon Fargate上执行。在其当前状态下，用户可以使用我们目前的所有视图流特征是复杂的。但是，我们强烈认为SQL和Python视图可能非常有用。我们将在未来几个月继续添加新的视图类型（例如，RMD，Jupyter Notebook）。当然，如果您看到ViewFlow中的值并希望贡献，请不要犹豫，创建拉出请求或新功能请求！</p><p>  If you would like to be a part of a talented team working to democratize data science, check out our  open positions!</p><p>  如果您想成为致力于民主化数据科学的才华横溢的团队的一部分，请查看我们的开放职位！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/datacamp-engineering/viewflow-fe07353fa068">https://medium.com/datacamp-engineering/viewflow-fe07353fa068</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开源/">#开源</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/open/">#open</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/数据/">#数据</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>