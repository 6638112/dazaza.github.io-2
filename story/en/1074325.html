<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>NTP（网络时间协议）是如何工作的？How Does NTP (Network Time Protocol) Work?</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">How Does NTP (Network Time Protocol) Work?<br/>NTP（网络时间协议）是如何工作的？</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-20 23:52:30</div><div class="page_narrow text-break page_content"><p>The Network Time Protocol (NTP) is a system for synchronizing the clocksof hosts and clients across the Internet. NTP is a protocol intended tosynchronize all computers participating in the network to within a fewmilliseconds of Coordinated Universal Time (UTC). The core of the protocolis NTP’s clock discipline algorithm that adjusts the local computer’sclock time and tick frequency in response to an external source — such asanother trusted NTP server, a radio or satellite receiver, or a telephonemodem. A core problem in NTP is establishing the trust and accuracy ofnodes in the NTP network. This is done through a combination of selectionand filtering algorithms to choose from the most reliable and accuratepeer in the synchronization network.</p><p>网络时间协议（NTP）是一个用于在互联网上同步主机和客户端时钟的系统。NTP是一种协议，旨在将参与网络的所有计算机同步到协调世界时（UTC）的毫秒内。protocolis NTP时钟规则算法的核心，该算法调整本地计算机的时钟时间和滴答频率，以响应外部源，如另一个受信任的NTP服务器、无线电或卫星接收器或电话调制解调器。NTP中的一个核心问题是建立NTP网络中节点的信任和准确性。这是通过选择和过滤算法的组合来实现的，可以从同步网络中最可靠、最准确的对等节点中进行选择。</p><p> An argument can be made that the Network Time Protocol (NTP) is thelongest running, continuously operating, distributed application on theInternet, with roots that can be traced back to 1979. The firstdocumentation of the protocol was made available in 1981 as InternetEngineering Note series 173 IEN-173. Since then, it hasevolved into Network Time Protocol Version 4, documented in  RFC5905 and ported to almostevery client and server platform available today. NTP is running onmillions of servers and clients across the world to keep accurate time ondevices throughout the Internet.</p><p>可以说，网络时间协议（NTP）是互联网上运行时间最长、连续运行的分布式应用程序，其根源可以追溯到1979年。该协议的第一份文件于1981年作为InternetEngineering Note series 173 IEN-173提供。从那时起，它已经演变成网络时间协议版本4，记录在RFC5905中，并移植到今天可用的Almostery客户端和服务器平台。NTP在世界各地运行着数以百万计的服务器和客户端，以在整个互联网上保持设备的准确时间。</p><p>  NTP uses a hierarchical network architecture that forms a tree structure.Each level of this hierarchy is called a  stratum and is assigneda number starting with zero representing reference hardware clocks.A level one server is synchronized with a level zero server, and thisrelationship continues so that a server synchronized to a stratum \(n \) server runs at stratum \(n + 1\). The stratum number thereforerepresents the distance from an accurate reference clock. In general, thestratum of a node in the server is an indication of quality andreliability but this is not always the case; it is common to find stratumthree time sources that are higher quality than other stratum two timesources.</p><p>NTP使用分层网络架构，形成树状结构。这个层次结构的每一层都被称为一个层，并被分配一个从零开始的数字，代表参考硬件时钟。一级服务器与零级服务器同步，并且这种关系将继续，以便同步到地层\（n\）服务器的服务器在地层\（n+1\）上运行。因此，地层编号表示与精确参考时钟的距离。一般来说，服务器中节点的状态是质量和可靠性的标志，但情况并非总是如此；通常会发现三层时间源的质量高于其他两层时间源。</p><p> Wikipedia hasa good set of definitions for the different stratum that I’ve providedhere with slight modification:</p><p>维基百科对不同阶层有一套很好的定义，我在这里提供了一个稍加修改的定义：</p><p> These are high-precision timekeeping devices such as atomicclocks, GPS or other radio clocks. They generate a very accurate timesignal that is directly connected to a connected computer. Stratum0 devices are also known as reference clocks. NTP servers cannot advertisethemselves as stratum 0.</p><p>这些是高精度的计时设备，如原子钟、GPS或其他无线电时钟。它们产生一个非常精确的时间信号，直接连接到连接的计算机。Stratum0设备也称为参考时钟。NTP服务器不能将自己作为层0进行广告。</p><p>  These are computers that are directly attached to stratum0 devices. Their system time is synchronized to within a few microsecondsof their attached devices. Stratum 1 servers may peer with other stratum1 servers for sanity check and backup. They are also referred to asprimary time servers.</p><p>这些是直接连接到stratum0设备的计算机。他们的系统时间被同步到连接设备的几微秒之内。stratum1服务器可以与其他stratum1服务器对等，以进行健全性检查和备份。它们也被称为主要的时间服务器。</p><p>  These are computers that are synchronized over a network tostratum 1 servers. Often a stratum 2 computer queries several stratum1 servers and selects the most accurate time representation from them.Stratum 2 computers may also peer with other stratum 2 computers toprovide more stable and robust time for all devices in the peer group.</p><p>这些是通过网络与Stratum 1服务器同步的计算机。通常情况下，第二层计算机查询多个stratum1服务器，并从中选择最准确的时间表示。第二层计算机还可以与其他第二层计算机进行对等，以便为对等组中的所有设备提供更稳定、更健壮的时间。</p><p>  These are computers that are synchronized to stratum 2 servers. Theyemploy the same algorithms for peering and data sampling as stratum 2, andcan themselves act as servers for stratum 4 computers, and so on.</p><p>这些是与第2层服务器同步的计算机。他们使用与第二层相同的对等和数据采样算法，并且可以自己充当第四层计算机的服务器，等等。</p><p> And this hierarchy continues up to stratum 15. The following figuredepicts the hierarchical nature of the NTP system. Reference clocks at thetop of the hierarchy are accurate time pieces and stratum 1 are computersdirectly attached to those time pieces. From there, increasing stratanumbers indicate where each computer synchronizes time data from.</p><p>这种等级制度一直延续到第15层。下图显示了NTP系统的等级性质。层次结构顶端的参考时钟是精确的时间段，第1层是直接连接到这些时间段的计算机。从那里开始，不断增加的层数表明每台计算机从哪里同步时间数据。</p><p>   Within the NTP network, clients poll one or more servers at an interval toretrieve updated timestamp information.</p><p>在NTP网络中，客户端每隔一段时间轮询一个或多个服务器，以检索更新的时间戳信息。</p><p>  To make the NTP system as accurate and reliable as possible requires firstan accurate and reliable local clock on host systems. For most purposes,the local clock is assumed to be a quartz crystal clock, which isa typical digital timepiece used in watches and computers. When a voltageis applied to the crystal it causes it to change shape; when the voltageis removed the crystal returns to its original shape (generating a smallamount of voltage in the process). This change and return of shape happensat a stable frequency that can be adjusted during the manufacturingprocess. Once set, the crystal can maintain the frequency over longperiods of time.</p><p>要使NTP系统尽可能准确可靠，首先需要主机系统上有一个准确可靠的本地时钟。在大多数情况下，本地时钟被假定为石英晶体时钟，这是手表和计算机中使用的典型数字时钟。当向晶体施加电压时，会使其改变形状；当电压被移除时，晶体会恢复到原来的形状（在这个过程中产生少量的电压）。这种形状的变化和恢复以稳定的频率发生，可在制造过程中进行调整。一旦凝固，晶体可以长时间保持频率。</p><p> The local computer system uses the frequency that crystal oscillates at toincrement the logical clock of the computer. Since the crystal oscillatesat a pre-defined rate, the computer system can use this rate as a model oftime. Quartz is accurate enough that it can maintain time within a fewmilliseconds per day. Over time however, these imperfections of a fewmilliseconds per day can accumulate, making the clock inaccurate. EnterNTP. NTP adjusts these inaccuracies at periodic intervals usingcorrections that are received by more accurate time servers. For hostsrequiring the highest reliability, the computer is attached to a localhardware clock such as an atomic clock and receives time informationdirectly from that attached clock.</p><p>本地计算机系统使用晶体的振荡频率来增加计算机的逻辑时钟。由于晶体以预先定义的速率振荡，计算机系统可以使用这个速率作为时间模型。石英足够精确，每天可以将时间保持在几毫秒以内。然而，随着时间的推移，这些每天只有几百万秒的缺陷可能会累积，使时钟不准确。输入NTP。NTP使用更精确的时间服务器接收到的更正，定期调整这些不准确度。对于要求最高可靠性的主机，计算机连接到本地硬件时钟，如原子钟，并直接从该连接的时钟接收时间信息。</p><p>  A  phase-locked loop or  PLL is any control system that generates anoutput signal whose phase is related to the phase of an input signal. Thesimplest version of a PLL is an electronic circuit consisting ofa variable frequency oscillator and a phase detector that operate ina continuous feedback loop. The oscillator generates a periodic signal,and the phase detector compares the phase of that signal with the phase ofthe input periodic signal, adjusting the oscillator to keep the phasesmatched.</p><p>锁相环或PLL是任何产生输出信号的控制系统，其相位与输入信号的相位有关。PLL最简单的版本是一个电子电路，由一个变频振荡器和一个在连续反馈回路中工作的相位检测器组成。振荡器产生周期信号，相位检测器将该信号的相位与输入周期信号的相位进行比较，调整振荡器以保持相位匹配。</p><p>    In the figure, \(x_i\) represents the reference timestamp froma reliable source and \(c_i\) the local timestamp. Both timestamps areat the \(i\)th update. The difference between these timestamps \(x_i - c_i\)is the input offset, which is processed by the clock filter. Thefilter recorded the most recent offsets and selects one from the set asthe output offset to change the local clock with. The loop fliter is thenused to produce the correction required for the local clock oscillator. Ifa correction is required, the local clock is gradually skewed to thecorrect value so that the clock shows smooth time indications and so thattime values are monotonically increasing.</p><p>在图中，\（x_i\）表示来自可靠来源的参考时间戳，\（c_i\）表示本地时间戳。两个时间戳都在第\（i \）次更新中。这些时间戳\（x_i-c_i\）之间的差异是输入偏移量，它由时钟滤波器处理。过滤器记录最近的偏移量，并从设置中选择一个作为输出偏移量，以更改本地时钟。然后使用环路滤波器产生本地时钟振荡器所需的校正。如果需要校正，本地时钟将逐渐倾斜到正确的值，以便时钟显示平滑的时间指示，并使时间值单调增加。</p><p> An alternative to a PLL is an FLL, which operates on the same principlesbut adjusts frequency rather than phase. Evidence shows that PLL usuallyworks better when network jitter is the dominant factor for clock drift,and FLL works better when the natural wander of an oscillator is thedominant factor for clock drift. NTP v4 uses a combination of both a PLLand an FLL and combines those factors into a clock local adjustment.</p><p>PLL的另一种选择是FLL，它的工作原理相同，但调整频率而不是相位。有证据表明，当网络抖动是时钟漂移的主要因素时，PLL通常工作得更好，而当振荡器的自然漂移是时钟漂移的主要因素时，FLL工作得更好。NTP v4使用PLL和FLL的组合，并将这些因素组合成时钟本地调整。</p><p> A completely exhaustive explanation of the PLL/FLL algorithm in NTP requires 90 pages ofdocumentation,but the overall ideas can be summarized fairly succinctly.</p><p>NTP中PLL/FLL算法的完整详尽解释需要90页的文档，但总体思路可以相当简洁地总结。</p><p> An NTP client receives time data from one or more connected servers anduses that time data to compute a phase or frequency correction to apply tothe local clock. If the time correction is only a slight change, thecorrection is applied gradually (called  slewing) in order to avoid clockjumps. If the local clock is off by a large amount, the adjustment may beapplied all at once.</p><p>NTP客户端从一个或多个连接的服务器接收时间数据，并使用该时间数据计算相位或频率校正，以应用于本地时钟。如果时间修正只是一个微小的变化，则逐渐进行修正（称为回转），以避免时钟跳变。如果本地时钟大量关闭，则可同时进行调整。</p><p> The adjustment to the local clock is called the clock discipline algorithmand it is implemented similar to the simple PLL feedback control system.The following diagram, from the presentation  Network Time Protocol (NTP)GeneralOverview,shows the basic overview of the process:</p><p>对本地时钟的调整称为时钟规程算法，其实现方式类似于简单的PLL反馈控制系统。下图来自presentation Network Time Protocol（NTP）General overview，显示了该过程的基本概述：</p><p>  Here, an NTP client is connected to three NTP servers and receivestimestamp data from all of them. Having multiple servers act as NTP peersprovides some redundancy and diversity to the system. The clock filtersselect the statistically best time offset from the previous eight timesamples received by the client, and the selection and clusteringalgorithms further narrow the dataset by pruning outliers from the resultset. The combining algorithm then computes a weighted average of the timeassets.</p><p>在这里，一个NTP客户端连接到三个NTP服务器，并从所有这些服务器接收Stimestamp数据。让多台服务器充当NTP对等机为系统提供了一些冗余和多样性。时钟过滤器从客户端接收的前八个时间样本中选择统计上最佳的时间偏移，选择和聚类算法通过从结果集中删除异常值来进一步缩小数据集。然后，合并算法计算时间资产的加权平均值。</p><p> The output of this first process serves as the input to the PLL/FLL loop.The loop itself continuously adjusts the local clock phase and frequencyin response to the input given from the filtered and averaged set of NTPservers.</p><p>第一个过程的输出作为PLL/FLL环路的输入。环路本身根据经过过滤和平均的NTP服务器集提供的输入，不断调整本地时钟相位和频率。</p><p>  During typical operation, an NTP client regularly polls one or more NTPservers to receive updated time data. Upon receipt of new data, the clientcomputes the time offset and round-trip delay from the server as in thefollowing figure.</p><p>在典型操作期间，NTP客户端定期轮询一个或多个NTP服务器以接收更新的时间数据。在收到新数据后，客户机计算来自服务器的时间偏移和往返延迟，如下图所示。</p><p>  The time offset \( \theta \), thedifference in absolute time between the two clocks, is definedmathematically by</p><p>时间偏移量\（\θ\），即两个时钟之间的绝对时间差，在数学上定义为</p><p>  More intuitively, the offset calculation is the absolute time differencebetween the two clocks time it takes for packets to transmit between theclient and the server.</p><p>更直观地说，偏移量计算是两个时钟之间的绝对时间差，即数据包在客户端和服务器之间传输所需的时间。</p><p>     At the very heart of NTP are the algorithms used to improve the accuracyof the values for \( \theta \) and \( \delta \) using filtering andselection algorithms. The complexity of these algorithms varies dependingon the statistical properties of the path between peers and the accuraciesrequired. For example, if two nodes are on the same gigabit LAN, the pathdelays between messages sent between peers are usually within or below anyrequired clock accuracies. In a case like this, the raw offsets deliveredby the receive procedure can be used to directly adjust the local clock.In other cases, two nodes may be distributed widely over the Internet andthe delay might be much larger than acceptable.</p><p>NTP的核心是使用过滤和选择算法来提高\（\theta\）和\（\delta\）值的准确性的算法。这些算法的复杂性取决于对等点之间路径的统计特性和所需的精度。例如，如果两个节点位于同一个千兆局域网上，对等节点之间发送的消息之间的路径延迟通常在所需的时钟精度之内或之下。在这样的情况下，接收过程传递的原始偏移量可用于直接调整本地时钟。在其他情况下，两个节点可能广泛分布在互联网上，延迟可能远远大于可接受的范围。</p><p>  There are a number of algorithms for filtering time-offset data to removeglitches that fall into roughly two broad categories:  majority-subsetalgorithms and  clustering algorithms. Majority-subset algorithmsattempt to separate good subsets of data from bad subsets of data bycomparing statistics like mean and variance to select the best clock froma population of different clocks. Clustering algorithms work, on the otherhand, by removing outliers to improve the overall offset estimate fora clock given a series of observations.</p><p>有许多算法可以过滤时间偏移数据，以去除大致分为两大类：大多数子类算法和聚类算法。多数子集算法试图通过比较均值和方差等统计数据，从不同时钟的总体中选择最佳时钟，从而将好的数据子集与坏的数据子集分开。另一方面，聚类算法的工作原理是，在给定一系列观测值的情况下，通过去除异常值来改进对时钟的总体偏移估计。</p><p> The full implementation of NTP’s clock filtering algorithm is describedfairly succinctly in the presentation  NTP Architecture, Protocol andAlgorithms.</p><p>NTP时钟滤波算法的完整实现在NTP体系结构、协议和算法的描述中相当简洁。</p><p>  Likely the single most important factor in maintaining high reliabilitywithin NTP is choosing a peer. Whenever an event comes in and new offsetestimates are calculated for a peer, the peer selection algorithm is usedto determine which peer should be selected as the clock source.</p><p>在NTP中保持高可靠性的一个最重要因素可能是选择一个对等方。每当一个事件发生并计算出一个对等点的新偏移估计值时，就会使用对等点选择算法来确定应该选择哪个对等点作为时钟源。</p><p> Within the NTP network, a key design assumption that helps with theselection algorithm is that accurate clocks are relatively numerous andcan be represented by random variables narrowly distributed close to UTC,while erroneous clocks are relatively rare and can be represented byrandom variables widely distributed throughout the measurement space.</p><p>在NTP网络中，有助于选择算法的一个关键设计假设是，准确的时钟相对较多，可以由靠近UTC的窄分布随机变量表示，而错误的时钟相对较少，可以由广泛分布在整个测量空间的随机变量表示。</p><p> The peer selection procedure thus begins by constructing a list ofcandidate peers by stratum. To be included on the candidate list the peermust pass certain sanity checks. For example, one check requires that the peer must notbe the host itself. Another check requires the peers must havereachability registers that are at least half full,which avoids using data from low quality associations or obviously brokenimplementations. If no candidates pass the sanity checks, the existingclock selection, if any, is cancelled and the local clock free-runs at itsintrinsic frequency.</p><p>因此，对等点选择过程从按阶层构建候选对等点列表开始。要被列入候选人名单，贵族必须通过某些健康检查。例如，一项检查要求对等方不能是主机本身。另一项检查要求对等方必须拥有至少半满的可达性寄存器，这避免了使用来自低质量关联或明显中断的实现的数据。如果没有候选人通过健全性检查，现有的时钟选择（如果有的话）将被取消，本地空闲时钟将以其固有频率运行。</p><p> The list is then pruned from the end to be no longer than a maximum size,currently set to five. Starting from the beginning, the list is truncatedat the first entry where the number of different strata in the listexceeds a maximum, currently set to two. This procedure is designed tofavor those peers near the head of the candidate list, which are at thelowest stratum and lowest delay and presumably can provide the mostaccurate time.</p><p>然后，列表从末尾开始修剪，使其长度不超过当前设置为5的最大值。从一开始，列表在第一个条目处被截断，列表中不同地层的数量超过最大值，当前设置为两个。这一过程的目的是为那些接近候选名单头部的同龄人而设计，这些同龄人处于最底层，延迟最低，大概可以提供最准确的时间。</p><p> The full implementation of NTP’s selection algorithm is also given in thepresentation  NTP Architecture, Protocol andAlgorithms.</p><p>文中给出了NTP选择算法在NTP体系结构、协议和算法中的完整实现。</p><p>  The combine algorithm is the simplest of the bunch: it computes the finalclock offset by averaging the surviving clocks that havebeen filtered and selected to produce a final offset used for adjustingthe clock using the PLL/FLL clock control system.</p><p>联合算法是其中最简单的一种：它通过对经过过滤和选择的剩余时钟进行平均来计算最终时钟偏移量，从而产生最终偏移量，用于使用PLL/FLL时钟控制系统调整时钟。</p><p>  An NTP timestamp records the number of standard seconds relative to UTC.UTC started measuring time on 1 January 1972. The conceptual NTP clock wasset to 2,272,060,800.0 at this same point in time, which represents thenumber of standard seconds since 1 January 1972 (the start of UTC) and1 January 1900 (the conceptual start of NTP time).</p><p>NTP时间戳记录相对于UTC的标准秒数。UTC于1972年1月1日开始测量时间。概念上的NTP时钟在同一时间点设置为2272060800.0，表示自1972年1月1日（UTC开始）和1900年1月1日（NTP时间概念开始）以来的标准秒数。</p><p> An NTP timestamp is encoded as a 64-bit unsigned number, where the first32 bits encode the integer portion of the timestamp and the last 32 bitsencode the fractional portion. This format allows for convenientmultiple-precision arithmetic and easy conversion to other time formats asrequired. The 32 bits of precision of a timestamp provide about 232picoseconds of accuracy, which is likely more than enough precision forpractical applications over networked systems.</p><p>NTP时间戳编码为64位无符号数，其中前32位编码时间戳的整数部分，后32位编码小数部分。这种格式可以方便地进行多精度运算，并可根据需要轻松转换为其他时间格式。时间戳的32位精度提供了约232皮秒的精度，对于网络系统上的实际应用来说，这可能已经足够精度了。</p><p> NTP hosts and clients exchange timestamp records by copying the currentvalue of the local clock to a timestamp variable in response to anincoming NTP message. An NTP host parses the incoming message, sets thetimestamp on the message, and returns it to the client.</p><p>NTP主机和客户端通过将本地时钟的当前值复制到时间戳变量来交换时间戳记录，以响应即将到来的NTP消息。NTP主机解析传入消息，设置消息的时间戳，并将其返回给客户端。</p><p> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |LI | VN |Mode | Stratum | Poll | Precision | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Root Delay | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Root Dispersion | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Reference ID | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | + Reference Timestamp (64) + | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | + Origin Timestamp (64) + | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | + Receive Timestamp (64) + | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | + Transmit Timestamp (64) + | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | . . . Extension Field 1 (variable) . . . | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | . . . Extension Field 2 (variable) . . . | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Key Identifier | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | | | dgst (128) | | | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</p><p>1 0 0 1 3 3 3 3 4 4 4 4 5 5 6 6 6 7 9 9 0 0 1 1 1 3 3 3 4 5 6 6 7 7 7 7 7 7 9 9 9 9 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 5 5 5 5 5 5 5 5 7 7 7 7 7 7 9 9 9 9 9 9 9 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1根延迟|+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|根色散|+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|引用ID |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+| |+接收时间戳（64）+|+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+。扩展字段1（变量）.||+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|。扩展字段2（变量）.| |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+密钥标识符|+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-| dgst（128）|+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</p><p>  LI (Leap Indicator): Warns of an impending leap second to be inserted ordeleted at the end of the current day.</p><p>LI（闰指示器）：警告在当天结束时插入或删除即将到来的闰秒。</p><p>   Poll: Controls the interval between NTP messages sent by the host toa peer. The sending host always uses the minimum of its own pollinterval and the peer poll interval.</p><p>轮询：控制主机发送给对等方的NTP消息之间的间隔。发送主机始终使用其自己的轮询间隔和对等轮询间隔中的最小值。</p><p> Root Delay/Dispersion: Indicate the estimated roundtrip delay andestimated dispersion, respective to the primary reference source.</p><p>根延迟/色散：分别表示主要参考源的估计往返延迟和估计色散。</p><p> Reference ID, Reference Timestamp: Identify the reference clock and thetime of its last update, intended primarily for management functions.</p><p>参考ID、参考时间戳：识别参考时钟及其上次更新的时间，主要用于管理功能。</p><p> Origin Timestamp: The time when the last received NTP message wasoriginated, copied from its transmit timestamp field upon arrival.</p><p>起源时间戳：上次收到的NTP消息的起源时间，在到达时从其传输时间戳字段复制。</p><p> The NTP state machine running on each host machine maintains statevariables for each of the above quantities as well as recording the IPaddress and ports of the host and its peers, a timer recording theinterval between transmitting NTP messages, a register recording if thepeer is reachable or not, as well as data measuring the current andestimated measured delay and offset associated with each single observation.</p><p>在每台主机上运行的NTP状态机为上述每一个量维护状态变量，并记录主机及其对等机的IP地址和端口、记录传输NTP消息之间的间隔的计时器、记录是否可访问PEER的寄存器，以及测量电流的数据，以及与每次观测相关的估计测量延迟和偏移。</p><p> NTP also tracks the current clock source which identifies the clock thatis currently being used to track time and the local clock time derivedfrom the logical clock on the host machine.</p><p>NTP还跟踪当前时钟源，该时钟源标识当前用于跟踪时间的时钟以及从主机上的逻辑时钟派生的本地时钟时间。</p><p> In normal client-server operation, a server receives a message with thisformat from a peer, and the server populates the message with updatedtimestamp data before sending it back to the peer.</p><p>在正常的客户机-服务器操作中，服务器从对等方接收到此格式的消息，并且服务器在将消息发送回对等方之前使用更新的时间戳数据填充该消息。</p><p> Each NTP host also sets a reachability shift register for each peer theycommunicate with. Each time a message is received the lowest order bit inthe register is set to one, and the remaining positions are shifted to theleft. The peer is considered reachable if the register is not zero, thatis, if the peer has sent at least one message in the last eight updateintervals. Peers who are unreachable may have their state informationcleared.</p><p>每个NTP主机还为与之通信的每个对等机设置一个可达性移位寄存器。每次收到信息时，寄存器中的最低顺序位被设置为1，其余位置被移到左侧。如果寄存器不为零，也就是说，如果对等方在最近八次更新间隔中至少发送了一条消息，则认为该对等方是可访问的。无法联系到的同龄人可能会清除他们的状态信息。</p><p>  NTP is a system of clients and peers that communicate timestampinformation in a hierarchical format where nodes closer to the root of thehierarchy are, in general, considered more accurate keepers of time thannodes lower down in the hierarchy. Each NTP host responds to incomingmessages requesting time information and keeps an active peer associationfor each of the clients to track key information.</p><p>NTP是一个由客户端和对等方组成的系统，它们以分层格式传递时间信息，其中，通常认为靠近层次结构根的节点比层次结构中较低的节点更准确地记录时间。每个NTP主机响应请求时间信息的输入消息，并为每个客户端保持活动的对等关联以跟踪关键信息。</p><p> In response to receiving time information, an NTP peer runs a process thatincludes the selection, cluster, and combine algorithms that mitigateamong the various servers and reference clocks to determine the mostaccurate and reliable candidates to synchronize the with clock. Theselection algorithm uses Byzantine fault detection principles to discardthe presumably incorrect candidates called “falsetickers” from theincident population, leaving only good candidates called “truechimers”.A truechimer is a clock that maintains timekeeping accuracy toa previously published and trusted standard, while a falseticker isa clock that shows misleading or inconsistent time. The cluster algorithmuses statistical principles to find the most accurate set of truechimers.The combine algorithm computes the final clock offset by statisticallyaveraging the surviving truechimers.</p><p>为了响应接收到的时间信息，NTP对等方运行一个过程，该过程包括选择、集群和组合算法，这些算法将不同的服务器和参考时钟进行组合，以确定与时钟同步的最准确、最可靠的候选者。选择算法使用拜占庭式的故障检测原理，从事故人群中丢弃可能不正确的候选者“Falstickers”，只留下被称为“truechimers”的好候选者。truechimer是一种时钟，它可以将计时精度保持在以前发布的可信标准，而Falsticker是一种时钟，它显示的时间具有误导性或不一致性。聚类算法使用统计原理来寻找最准确的真嵌合体集。combine算法通过统计平均幸存的TrueChemer来计算最终时钟偏移。</p><p> Once an appropriate clock adjustment, the adjustment itself is processedby a phase-locked and frequency-locked loop.</p><p>一旦进行了适当的时钟调整，调整本身就由锁相和频率锁定回路进行处理。</p><p>  This article provides an introduction to NTP, and should provideda good overview for someone wanting to learn more about the protocol. Ifyou want to learn more, there are several great resources to choose from:</p><p>这篇文章介绍了NTP，应该为想了解更多协议的人提供一个很好的概述。如果您想了解更多信息，可以从以下几大资源中进行选择：</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/网络/">#网络</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/network/">#network</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/时钟/">#时钟</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>