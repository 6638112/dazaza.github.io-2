<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>永远不要使用NixOS </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">永远不要使用NixOS </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-23 21:17:26</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/1/031fe842d6df96a94f2e8bd966d80091.png"><img src="http://img2.diglog.com/img/2021/1/031fe842d6df96a94f2e8bd966d80091.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>我将从关于NixOS的最大神话开始。很快您就会知道为什么。</p><p> 对DevOps友好。声明性的规范和安全的升级使NixOS成为DevOps使用的出色系统。 NixOS云部署工具NixOps允许您在Amazon EC2和VirtualBox等环境中配置和管理NixOS计算机网络。 （c）NixOS.org</p><p> 每当我遇到一项新的怪异而富挑战性的任务时，我都会不断更新本文，如果您使用的是NixOS而不是传统的Linux发行版，则会使您的生活变得更加艰难。</p><p> 好吧，我是个幸运的人……我现在别无选择，必须将大部分工作时间都花在NixOS自动化上。到目前为止，我已有10多年使用不同Linux发行版的经验，以及超过6个月的NixOS经验。而且我在NixOS上的大部分经历都是糟糕的经历。</p><p>  我会在这里尝试写些东西。希望，我能够...</p><p>  系统设计声明并提供给您，您将从该衍生版本中获得任何软件包的相同版本。谎言！</p><p> 它所具有的确定性就是确定性地给您带来许多问题，您需要在没有任何支持的情况下手动解决这些问题。 </p><p>例如，您可以在Linux和OS X上安装Nix工具。但是，它并不总是在Linux和NixOS本身上构建相同的推导结果。因此，它与操作系统无关。此类行为的例子很多，例如fetchgit和fetchFromGitHub函数：</p><p>  同时，在当前最新版本的官方手册-18-09-1373-50fb6820759中，他们仍在使用fetchgit。</p><p>  在这里，我将把我所有的日常痛苦集中在一个地方，希望这可以帮助人们不要犯别人的错误。这是我对问题空间的个人看法，不能与我现在正在工作的公司或项目有任何关系。</p><p>  当然，有很多发烧友通过在虚拟机的工作站上安装NixOS来玩，但是与Ubuntu，CentOS，Debian或RedHat相比：</p><p>    官方文档太糟糕了。或者只是不存在。 NixOS比Docker更旧。他们正在解决相同的任务，但是NixOS不太受欢迎。试着想为什么。</p><p> NIX配置语言它是功能语言，名称也叫Nix，它是此系统配置的核心。如果您来自OOP世界，那么很难理解这种“语言”。您必须吞咽Nix药丸，甚至试图了解它。</p><p> 软件管理“派生”是描述NixOS中软件分发的一种方式。每个派生表示软件，插件或库。描述它的通用语法如下所示（nginx派生示例）： </p><p>{stdenv，fetchurl，openssl，zlib，pcre，libxml2，libxslt，gd，geoip和withDebug？假，withStream？是的，withMail？错误，模块？ []，版本，sha256，...}：带有stdenv .lib; stdenv .mkDerivation {name =＆＃34; nginx- $ {version}＆＃34 ;; src = fetchurl {url =＆＃34; https：//nginx.org/download/nginx- $ {version} .tar.gz＆＃34 ;;继承sha256; }; buildInputs = [openssl zlib pcre libxml2 libxslt gd geoip] ++ concatMap（mod：mod .inputs或[]）模块； configureFlags = [＆＃34;-with-http_ssl_module＆＃34; ＆＃34;-with-http_v2_module＆＃34; ＆＃34;-with-http_realip_module＆＃34; ＆＃34;-with-http_addition_module＆＃34; ＆＃34;-with-http_xslt_module＆＃34; ＆＃34;-with-http_geoip_module＆＃34; ＆＃34;-with-http_sub_module＆＃34; ＆＃34;-with-http_dav_module＆＃34; ＆＃34;-with-http_flv_module＆＃34; ＆＃34;-with-http_mp4_module＆＃34; ＆＃34;-with-http_gunzip_module＆＃34; ＆＃34;-with-http_gzip_static_module＆＃34; ＆＃34;-with-http_auth_request_module＆＃34; ＆＃34;-with-http_random_index_module＆＃34; ＆＃34;-with-http_secure_link_module＆＃34; ＆＃34;-with-http_degradation_module＆＃34; ＆＃34;-with-http_stub_status_module＆＃34; ＆＃34;-带线程＆＃34; ＆＃34;-with-pcre-jit＆＃34; ＃安装目标问题＃＆＃34;-with-http_perl_module＆＃34; ] ++可选withDebug [＆＃34;-with-debug＆＃34; ] ++可选withStream [＆＃34;-with-stream＆＃34; ＆＃34;-with-stream_geoip_module＆＃34; ＆＃34;-with-stream_realip_module＆＃34; ＆＃34;-with-stream_ssl_module＆＃34; ＆＃34;-with-stream_ssl_preread_module＆＃34; ] ++可选withMail [＆＃34;-with-mail＆＃34; ＆＃34;-with-mail_ssl_module＆＃34; ] ++可选（gd！= null）＆＃34;-with-http_image_filter_module＆＃34; ++可选（带有stdenv .hostPlatform; isLinux || isFreeBSD）＆＃34;-with-file-aio＆＃34; ++ map（mod：＆＃34;-add-module = $ {mod .src}＆＃34;）模块; NIX_CFLAGS_COMPILE = [＆＃34; -I $ {libxml2 .dev} / include / libxml2＆＃34; ] ++可选stdenv .isDarwin＆＃34; -Wno-error = deprecated-declarations＆＃34 ;; preConfigure =（concatMapStringsSep＆＃34; \ n＆＃34;（mod：mod .preConfigure或＆＃34;＆＃34;）模块）; hardeningEnable =可选（！stdenv .isDarwin）＆＃34; pie＆＃34 ;; enableParallelBuilding = true; postInstall =＆＃39;＆＃39; mv $ out / sbin $ out / bin＆＃39;＆＃39 ;; meta = {description =＆＃34;反向代理和轻量级Web服务器＆＃34 ;;主页= http://nginx.org;许可证=许可证.bsd2;平台=平台.all;维护者=与维护者一起； [thinkpolice raskin fpletz]; };}</p><p>  如果是，请做好准备，否则您将无法在系统中生存，而无需编写类似的代码。 Nix Packages GitHub存储库将是您的第二个家，您将在其中查找Nix表达式，配置方法和其他示例。</p><p>  系统状态和配置在特殊文件configuration.nix中描述。这就像是您的操作系统无穷无尽的功能和依赖关系的切入点。</p><p> 要自定义操作系统中的某些内容，请准备好，您需要编写自定义的systemd服务来完成此操作。 Aaand，是的，还需要使用Nix表达式语言声明服务配置文件。</p><p> 例如，所有标准系统配置文件（例如/ etc / fstab）都是由奇怪的代码生成的，并且是只读的。</p><p>   不能仅将内核从“ ver1”升级到“ ver2”。新内核将带来整套系统软件包及其依赖性。不知道它是否安全。即将测试。</p><p>  Nix还没有准备好云。完全没有在NixOS 18.03上，我总是遇到以下情况： </p><p>NixOS 18.03在启动时并不总是能够调整硬盘的大小。</p><p> 甚至不要尝试在Auto Scaling组中使用它，并通过用户数据传递configuration.nix内容。您可能会很容易陷入循环，当实例在启动过程中开始从派生版本构建新内容时，100％的CPU利用率将要求AutoScaling Group启动也会创建内容的其他实例，所有实例都不正常，而Auto Scaling组将开始在循环中终止第一个实例。您的服务将永远不会开始。</p><p>  为了加快NixOS中的软件安装速度，社区为您提供了Nix Binary Cache，他们将成功构建的所有内容放入其中。每个派生的每个版本。</p><p> 当您增加个人缓存时，就会开始出现问题，例如，用于存储专有构建工件的个人缓存。您始终需要密切注意用作构建基础的社区频道版本。是的，您自己的缓存大小也会非常快！</p><p> 一些非常有才华的开发人员开始使用Nix二进制缓存来缓存所有可能的内容。例如NPM或Yarn包。祝好运！</p><p>  人们认为，NixOS确定性的软件处理方法非常安全。也许是的，一旦派生bin生成，就不可能劫持生成结果。但是...您总是需要为此付出代价...</p><p> 在从18.03升级到18.09的过程中，Nix社区决定更改已用于处理Docker映像的派生校验和的Docker工具。 </p><p>结果，我们重写了所有基于Docker的派生声明，并重新构建了所有声明。 这确实是痛苦且不受管理的迁移。  它需要大量的CPU能力来构建它的内容，并且确实需要大量空间来存储其多个版本。 远远超出了传统Linux发行版中所需要的。  而且，天哪，请勿尝试在Docker中运行Nix！ 真的，不是，真的是个坏主意！  当您尝试总结您想在帖子中涉及的主题的所有想法时，您将从简单的Google搜索开始。 我的“ nixos优缺点”查询的结果之一：NixOS替代品。 有点开玩笑，但实际上，当您决定投资时间或金钱时，请三思。 我还要三思而后行为什么向我建议。  链接在上一段中。 您的选择是传统的Linux和Docker！ 是的，您将获得相同的确定性和安全性结果，而痛苦和乐趣却多得多。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://hands-on.cloud/why-you-should-never-ever-use-nixos/">https://hands-on.cloud/why-you-should-never-ever-use-nixos/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/nixos/">#nixos</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>