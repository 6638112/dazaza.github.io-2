<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>返回值和错误Returning Values and Errors</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Returning Values and Errors<br/>返回值和错误</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-21 08:43:17</div><div class="page_narrow text-break page_content"><p>If you agree with the notion that you need to be able to tell the difference between the absence of a value and a value itself, then this has some impacts on the code you write. If you want to keep &#39;em separated (so they can come out and play), then it gets you looking at your API designs in certain ways.</p><p>如果您同意这样一种观点，即您需要能够区分没有值和值本身之间的区别，那么这会对您编写的代码产生一些影响。如果你想保持&#39；em分离（这样他们就可以出来玩了），然后它让你以特定的方式审视你的API设计。</p><p> These are my reactions to some of the ways a value can be returned (or not).</p><p>以下是我对返回（或不返回）值的一些方式的反应。</p><p> Imagine we&#39;re talking about a helper function that is intended to be run inside a program that&#39;s handling the access to a web page. It&#39;s probably a CGI program, but it could also be buried inside some much bigger thing, too. This is all about C++ styles, but you can probably see slices of other languages in here, too.</p><p>想象一下我们&#39；我们说的是一个助手函数，它要在一个程序中运行，这个程序&#39；它处理对网页的访问。它&#39；它可能是一个CGI程序，但也可能被隐藏在更大的东西里。这都是关于C++风格的，但是你也可以在这里看到其他语言的片段。</p><p> string* UserIP() -- Oh great. It&#39;s a pointer to a string, so that means it got allocated somewhere in there, and we have to worry about the lifetime of that buffer. Guess it&#39;s being created from scratch,and then we have to free (delete) it? But wait, what if the allocation fails? I guess it can return a NULL or nullptr or something. Also, what happens if it can&#39;t find the IP address? I guess it could return a NULL/nullptr/whatever for that, too. I sure hope everyone who uses this checks for it...</p><p>string*UserIP（）--太好了。它&#39；它是一个指向字符串的指针，这意味着它被分配到了其中的某个地方，我们不得不担心缓冲区的生存期。猜猜看&#39；它是从头创建的，然后我们必须释放（删除）它？但是等等，如果分配失败怎么办？我猜它可能会返回NULL或NULL ptr之类的。此外，如果它能&#39；找不到IP地址？我猜它也可以返回NULL/nullptr/任何值。我当然希望每个使用这个的人都能检查一下。。。</p><p> string UserIP() -- No more lifetime worries here, but oops, uh, well, what if we don&#39;t know what it is and need to provide an error? If it&#39;s a CGI situation, maybe REMOTE_ADDRESS or whatever wasn&#39;t defined for some reason. What then? Do we throw? Yuck! Do we return some magic value? Double yuck! Don&#39;t say return the string &#34;unknown&#34;, since what if there&#39;s a host on the network named that, and you end up using that as a real value somehow? You just know someone would do it. Just ask the guy who has &#34;NULL&#34; as his license plate.</p><p>string UserIP（）--这里没有更多关于一生的担忧，但是，哦，好吧，如果我们不&#39；我不知道它是什么，需要提供一个错误？如果是&#39；这是一种CGI情况，可能是远程地址或其他不存在的地址&#39；因为某种原因，我没有定义。然后呢？我们扔吗？讨厌！我们会返回一些魔法值吗？真恶心！唐&#39；不要说返回字符串&#34；未知&#34；，既然有&#39；网络上有一个主机叫它，你最终以某种方式把它作为一个真正的价值？你只知道有人会这么做。问问有&#34；空&#34；作为他的车牌。</p><p> string UserIP(string* errmsg) -- Oh geez, I&#39;m going to be sick. Sure, now they can &#34;set an error message&#34;, but now how do you know when to look at errmsg vs. the return value?</p><p>string UserIP（string*errmsg）——哦，天哪，我&#39；我要生病了。当然，现在他们可以&#34；设置错误消息&#34；，但是现在你怎么知道什么时候应该看errmsg和返回值呢？</p><p> bool GetUserIP(string* ip) -- Well, this is a little better, right? It&#39;s kind of wonky because now you&#39;re wrangling outvars and the user could do something stupid like handing you a bad pointer, plus that means THEY are having to think in terms of addresses and pointers and that&#39;s probably not great, either. But hey, at least you can point out that something failed. Too bad you can&#39;t say what.</p><p>bool GetUserIP（string*ip）——这个更好一点，对吧？它&#39；这有点不稳定，因为现在你&#39；如果你和外行争吵，用户可能会做一些愚蠢的事情，比如给你一个糟糕的指针，而且这意味着他们必须从地址和指针的角度来思考；这可能也不太好。但是，嘿，至少你可以指出有些事情失败了。可惜你能&#39；不要说什么。</p><p> bool GetUserIP(string* ip, string* errmsg) -- Okay, so now we can include a message if we want to provide some color commentary on what happened, but geez, now it&#39;s TWO outvars. Imagine what the call sites are going to look like.</p><p>bool GetUserIP（string*ip，string*errmsg）——好的，现在如果我们想对发生的事情提供一些彩色评论，我们可以包含一条消息，但是天啊，现在它&#39；有两个外号。想象一下，呼叫站点将是什么样子。</p><p> Result&lt;string&gt; UserIP() -- Now this is getting interesting. You can do some fun stuff, like having a flag that only gets set once the Result is checked for correctness. Only then is .value() allowed to be used. If you call .value() first, YOU DIE. This should catch you much earlier in development, since even &#34;happy path&#34; cases will blow up if it&#39;s not being used correctly. You also have an .error() to return some nice message in the other case. It&#39;s a pity about the whole &lt;&gt; thing though. Kind of nasty-looking... and annoying to keep typing over and over and over.</p><p>结果&lt；字符串&gt；UserIP（）--现在这变得很有趣。你可以做一些有趣的事情，比如有一个只在结果正确性检查后设置的标志。只有那时才是。允许使用value（）。如果你打电话。首先，你会死。这应该会在开发的更早阶段吸引你，因为即使是&#34；快乐之路&#34；如果它&#39；It’没有被正确使用。你也有一个。error（）在另一种情况下返回一些好消息。它&#39；It’对整体来说很遗憾&lt&gt；尽管如此。有点难看。。。一次又一次地打字很烦人。</p><p> ResultString UserIP() -- Same idea as before with fewer brackets, but oh dear, did someone code this up as a one-off? Now what happens when we want to do this with other types? Do we copy and paste the magic &#34;you must check for correctness before calling value()&#34; gunk into ResultInt, ResultFloat, ResultDouble, and so on? How do we keep them from diverging in the event of a bug fix that only touches one? Don&#39;t we really need the ability to do generic programming and templates?</p><p>ResultString UserIP（）--与之前的想法相同，括号更少，但天哪，有人把它编码为一次性的吗？现在，当我们想对其他类型进行此操作时，会发生什么？我们是否复制并粘贴魔法&#34；在调用value（）&#34；沉迷于ResultInt、ResultFloat、ResultDouble等等？如果一个bug修复只涉及一个问题，我们如何防止它们发生分歧？唐&#39；我们真的需要做泛型编程和模板的能力吗？</p><p> string UserIP() -- Wait, didn&#39;t we do this already? Not quite. This time, we&#39;re in a slightly different language with different assumptions. The native &#34;string&#34; type now includes all of the correctness checking of ResultString (aka Result&lt;string&gt;), so now you have to check ALL OF THEM. Now it looks simple enough here, but you have to check everywhere. EVERYWHERE. Only then can you use .value() from it. How much extra CPU and memory goes into this for the cases where it&#39;ll never be &#34;missing&#34; and will always have some usable value? In fact, how often do we have the one case instead of the other, anyway? What percentage of our strings are &#34;yep, always gonna be something&#34; versus &#34;might have failed completely&#34;?</p><p>字符串UserIP（）--等等，没有&#39；我们不是已经这么做了吗？不完全是。这一次，我们&#39；我们的语言略有不同，假设也有所不同。本地人&#34；字符串&#34；类型现在包括ResultString（又名Result&lt；string&gt；）的所有正确性检查，所以现在你必须检查所有这些。现在这里看起来很简单，但你必须到处检查。处处只有这样你才能使用。从中获取值（）。在它&#39；我永远不会成为&#34；失踪&#34人；而且总是有一些有用的价值？事实上，我们多久会有一个病例而不是另一个？我们的琴弦中有多少是&#34；是的，永远都会是&#34；与&#34；可能完全失败了&#34；？</p><p> It&#39;s complicated, right? To win a little in one place, you have to spend a little more in another place.</p><p>它&#39；这很复杂，对吧？要在一个地方赢一点，你必须在另一个地方多花一点钱。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/返回值/">#返回值</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/values/">#values</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/可能/">#可能</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>