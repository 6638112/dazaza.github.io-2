<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>物联网分解第二部分：IP地址，网络，Zigbee，自定义固件，焊接IoT Unravelled Part 2: IP Addresses, Network, Zigbee, Custom Firmware, Soldering</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">IoT Unravelled Part 2: IP Addresses, Network, Zigbee, Custom Firmware, Soldering<br/>物联网分解第二部分：IP地址，网络，Zigbee，自定义固件，焊接</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-24 16:46:40</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/8db2e366564e2c12ed24a02c34dad838.png"><img src="http://img2.diglog.com/img/2020/11/8db2e366564e2c12ed24a02c34dad838.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>In  part 1, I deliberately kept everything really high level because frankly, I didn&#39;t want to scare people off. I&#39;m not ashamed to say that the process of getting even the basics working absolutely did my head in as I waded through a sea of unfamiliar technologies, protocols and acronyms. I wish I&#39;d had just the fundamentals down pat before going deeper and that was my intention with the first part of the series.</p><p>在第1部分中，我故意将所有内容都保持在较高水平，因为坦率地说，我不想吓to人。我不感到羞耻地说，当我在不熟悉的技术，协议和首字母缩略词的海洋中苦苦挣扎时，甚至使基础知识完全正常工作的过程也引起了我的注意。我希望我在深入之前只是对基本面有所了解，这是我对本系列第一部分的初衷。</p><p> So, peeling back that next layer, the whole IoT space isn&#39;t just about devices that get their own IP address on your network and talk over TCP (or UDP). Many of them do (such as the Shelly switch in part 1), but then there&#39;s the whole Zigbee space as well. Let&#39;s drill into all that and then go deeper into custom firmware and soldering too.</p><p> 因此，剥离下一层，整个IoT空间不仅涉及在网络上拥有自己的IP地址并通过TCP（或UDP）进行通信的设备。他们中的许多人都做过（例如第1部分中的Shelly开关），但同时也有整个Zigbee空间。让我们深入研究所有内容，然后再深入研究自定义固件和焊接。</p><p>  So, what happens when you start filling your home with IoT things? You end up assigning a lot of IP addresses; here&#39;s what it looks like in  Ubiquiti&#39;s UniFi dashboard:</p><p>  那么，当您开始用IoT物资填充房屋时会发生什么？您最终分配了很多IP地址；这是Ubiquiti的UniFi仪表板中的外观：</p><p>  Clearly, I have a long way to go before exhausting available IPV4 addresses on this subnet so that&#39;s not something that worries me right now. Plus, all my IoT devices are on their own Wi-Fi network and it&#39;d be dead simple just to start assigning those devices IPs from a different subnet (more on that in part 3 about security). IPV6? It&#39;s rare to see in IoT devices today, but  there are many compelling reasons that make a lot of sense to see broader support in the future.</p><p>  显然，在用尽此子网上的可用IPV4地址之前，我还有很长的路要走，所以现在这并不是让我担心的事情。另外，我所有的物联网设备都位于自己的Wi-Fi网络上，只是开始从不同的子网分配这些设备的IP非常简单（第3部分中有关安全性的更多信息）。 IPV6？在当今的物联网设备中很少见到，但是有很多令人信服的原因在将来获得更广泛的支持很有道理。</p><p> For the most part, the IoT devices in my home simply take their IP address from the DHCP server and I never think about it again. There are, however, occasions where you end up getting tied to specific IP addresses. For example, here&#39;s how the downlights in my office are configured in HA courtesy of  the Wiz integration:</p><p> 在大多数情况下，我家中的IoT设备仅从DHCP服务器获取其IP地址，而我再也没有考虑它。但是，在某些情况下，您最终会绑定到特定的IP地址。例如，以下是通过Wiz集成在HA中配置办公室的筒灯的方法：</p><p>  Then, one day, the lights stopped working. Why? They worked fine in the native Wiz app, why were they dead in HA? Back into the UniFi dashboard, down to the Wiz lights and... ah:</p><p>  然后，一天，灯光停止工作。为什么？他们在本地的Wiz应用程序中运行良好，为什么在HA中死了？回到UniFi仪表板，向下到Wiz灯，然后...啊：</p><p>  Because they&#39;re dynamically assigned an IP address, at some stage the lights had restarted and got themselves new ones. The fix, however, was easy:</p><p>  因为它们是动态分配的IP地址，所以在某些时候，指示灯已重新启动，并重新安装了新的指示灯。但是，此修复很容易：</p><p>  I got to thinking more about IP address reservation (which is what you see above where the same IP is always assigned by the DHCP server) versus static IP address (where the IP is set in the client itself), after having to totally rebuild my network. (If you&#39;re interested in what happened, I covered it in detail in  weekly update video 216.) There&#39;s a good overview of the two approaches  here but in a nutshell, central management is always preferable. It means it&#39;s very easy to jump into the UniFi dashboard and get a quick list of all the fixed IP addresses in the network (it&#39;s under &#34;Insights&#34;):</p><p>在必须完全重建我的IP地址后，我不得不更多地考虑IP地址保留（这是您在上面看到的，始终由DHCP服务器分配相同的IP）与静态IP地址（其中IP是在客户端本身中设置的）。网络。 （如果您对发生的事情感兴趣，我会在每周的更新视频216中对其进行详细介绍。）这里对这两种方法有一个很好的概述，但总的来说，中央管理始终是可取的。这意味着跳转到UniFi仪表板并获得网络中所有固定IP地址的快速列表非常容易（位于“ Insights”下）：</p><p>  The kids&#39; Nanoleaves also use reserved IPs because like the Wiz lights, the HA integration needs a hard-coded IP address for the device. Having easy access to configurability such as this at the network layer is really essential, so let&#39;s delve into that network layer and talk about good gear.</p><p>  孩子们的Nanoleaves也使用保留的IP，因为像Wiz灯一样，HA集成也需要设备的硬编码IP地址。在网络层上轻松访问诸如此类的可配置性确实至关重要，因此让我们深入研究该网络层并讨论良好的装备。</p><p>  As you&#39;re probably starting to gather from this series (and you&#39;ll see more of this as it progresses), you find yourself spending a lot of time troubleshooting problems. Why can&#39;t I see a device? Why can only some clients see a device? Why is the device slow to respond? Why have I started drinking so much since beginning my IoT journey? Having good visibility into my network configuration has been absolutely essential in helping answer those questions.</p><p>  当您可能开始从本系列文章中收集信息时（随着它的进展，您会看到更多），您会发现自己花费大量时间来解决问题。为什么看不到设备？为什么只有某些客户端可以看到设备？为什么设备响应速度慢？自从开始物联网之旅以来，为什么为什么要喝这么多酒？拥有对我的网络配置的良好可见性对于帮助回答这些问题绝对至关重要。</p><p> I&#39;ve been a vocal proponent of Ubiquiti&#39;s gear for many years now and it&#39;s an absolutely essential part of my IoT world. (Disclosure: I bought every piece of equipment in that original blog post. Since then, they&#39;ve sent me a bunch of gear.) For example, when I look at my network topology today, I can easily see everything that&#39;s connected to everything else:</p><p> 多年来，我一直是Ubiquiti装备的声音拥护者，这是我的物联网世界中必不可少的一部分。 （披露：我在原始博客文章中购买了每台设备。从那以后，它们给了我很多装备。）例如，当我今天查看我的网络拓扑时，我可以轻松地看到连接到所有组件的所有组件其他：</p><p>  I&#39;ve named each and every device I&#39;ve added to the network and given it a descriptive icon so that at a glance, I can get a really good idea of how everything is tied together. I can easily block a device from talking to the internet, throttle its connection, see which online services it&#39;s communicating with and access a whole host of other information about it. For example, just today I was trying to identify one pesky device I hadn&#39;t named earlier on and now had no idea what it was:</p><p>  我已经命名了我添加到网络中的每台设备，并给了它一个描述性的图标，以便一眼就能知道如何将所有东西捆绑在一起。我可以轻松地阻止设备与Internet通讯，限制其连接，查看正在与哪些在线服务进行通信以及访问有关该设备的大量其他信息。例如，就在今天，我试图识别一个我之前没有命名的讨厌的设备，现在却不知道它是什么：</p><p> Trying to figure out what a client I&#39;d previously connected to my network is. I put it on my IoT network, it&#39;s connected to my Office AP and it&#39;s running Linux and downloading data from Amazon and Spotify, ideas?  pic.twitter.com/PE3eVLseFY</p><p> 试图弄清楚我以前连接到网络的客户端是什么。我将其放在IoT网络上，将其连接到Office AP，并且正在运行Linux，并从Amazon和Spotify下载数据，想法？ pic.twitter.com/PE3eVLseFY</p><p>— Troy Hunt (@troyhunt)  November 24, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年11月24日</p><p>   The Wi-Fi network is the foundation on which the IoT network is built. Investing in that was the best thing I could have done in advance of joining all the things to my network. But not all IoT is IP-based, far from it. Let&#39;s jump into Zigbee.</p><p>Wi-Fi网络是构建物联网网络的基础。在将所有内容加入到我的网络之前，投资该类内容是我本可以做的最好的事情。但是，并非所有的物联网都基于IP，距离它还很远。让我们跳入Zigbee。</p><p>  Alrighty, first things first:  It&#39;s Zigbee, not ZigBee. I&#39;m a stickler for details like this and it was driving me nuts seeing both stylisations all over the place but as of 2017, the &#34;b&#34; is lowercase (because I&#39;m a stickler I kept scrolling back through zigbee.com on archive.org until I worked out when it changed). The Zigbee standard is maintained by  the Zigbee Alliance, a group of companies responsible for shepherding it in the right direction. Zigbee uses  the IEEE 802.15.4 standard and it&#39;s worthwhile understanding why, especially as compared to having devices just communicating directly over Wi-Fi:</p><p>  好的，首先要考虑的是：Zigbee，而不是ZigBee。我是一个喜欢这样的细节的人，这让我发疯了，到处都看到两种风格，但是截至2017年，“ b”是小写字母（因为我是一个我一直在存档中浏览zigbee.com的贴纸， .org，直到我知道它何时更改为止）。 Zigbee标准由Zigbee联盟维护，Zigbee联盟是负责按正确方向进行推广的一组公司。 Zigbee使用IEEE 802.15.4标准，值得理解为什么，尤其是与仅通过Wi-Fi直接通信的设备相比：</p><p> IEEE standard 802.15.4 intends to offer the fundamental lower network layers of a type of wireless personal area network (WPAN) which focuses on low-cost, low-speed ubiquitous communication between devices. It can be contrasted with other approaches, such as Wi-Fi, which offer more bandwidth and require more power. The emphasis is on very low cost communication of nearby devices with little to no underlying infrastructure, intending to exploit this to lower power consumption even more.IEEE 802.15. 4 is a low-data rate wireless personal area network and is the PHY and MAC layer used by many IoT protocols, such as ZigBee, and WirelessHART.</p><p> IEEE标准802.15.4旨在提供一种无线个人局域网（WPAN）的基本底层网络层，该网络侧重于设备之间的低成本，低速普适通信。可以将它与其他方法（例如Wi-Fi）形成对比，后者可提供更多带宽并需要更多功率。重点在于几乎没有底层基础设施的附近设备的非常低成本的通信，旨在利用它来进一步降低功耗。IEEE 802.15。 4是低数据速率无线个人局域网，是许多物联网协议（例如ZigBee和WirelessHART）使用的PHY和MAC层。</p><p> In other words, the value proposition is low power consumption and low cost at the expense of bandwidth. But that&#39;s just fine for devices like this:</p><p> 换句话说，价值主张是低功耗和低成本，以带宽为代价。但这对于像这样的设备来说很好：</p><p> Just had a Mi temp and humidity sensor arrive for the IoT stuff I’m doing. Really neat size, it’d be easy to place a bunch of these around the house, yet to see it actually work though...  pic.twitter.com/yjgtR87DUo</p><p> 刚刚有Mi温度和湿度传感器到达了我正在做的物联网工作。尺寸确实很整齐，很容易在屋子里放上一堆，但是看它确实可以工作... pic.twitter.com/yjgtR87DUo</p><p>— Troy Hunt (@troyhunt)  June 7, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年6月7日</p><p>  In fact, it&#39;s  perfect for devices like this because they can be battery powered (they run on a standard  CR2032) and get a couple of years of life and they only need to transmit a few simple values at a relatively low frequency.</p><p>  实际上，它非常适合此类设备，因为它们可以由电池供电（它们在标准CR2032上运行），使用寿命长达两年，并且仅需要以相对较低的频率发送一些简单值即可。</p><p> Let me divert on a quick tangent for a moment: Zigbee isn&#39;t the only low-power, low-bandwidth standard out there and as I went through my travels, many people also suggested various  Z-wave devices. I went all in on Zigbee primarily because the Aqara devices are great (more on them soon) and I already had Philips Hue units I could use as range extenders (more on that soon too). I may well end up with Z-wave devices in the future as well and I&#39;d be remiss not to mention them here, but at present I haven&#39;t needed to diversify beyond Zigbee.</p><p>让我转瞬即逝：Zigbee不是那里唯一的低功耗，低带宽标准，而且在我旅行时，很多人还建议使用各种Z波长设备。我之所以全神贯注于Zigbee，主要是因为Aqara装置非常出色（即将推出更多功能），而且我已经拥有可以用作范围扩展器的Philips Hue装置（即将推出更多功能）。将来我可能还会使用Z-wave设备，我会在这里不提它们，我会很不高兴，但是目前我并不需要在Zigbee之外进行多元化发展。</p><p> But Zigbee ain&#39;t Wi-Fi so you can&#39;t just buy a little device like the one above and connect it to an existing network, it needs a hub that can talk 802.15.4 to do that and suddenly, we&#39;re back into proprietary land again. For example, both the little temp sensor above and the motion sensors I discussed in part 1 are made by Xiaomi and I could always buy the  Aqara Hub and connect them up:</p><p> 但是Zigbee不是Wi-Fi，因此您不能只购买上述设备之类的小设备并将其连接到现有网络，它需要一个能够与802.15.4通讯的集线器，然后突然，我们回来了再次进入专有土地。例如，上面的小温度传感器和我在第1部分中讨论的运动传感器都是小米制造的，我总是可以购买Aqara Hub并将其连接起来：</p><p>  But then what about other Zigbee devices from other manufacturers? For example, I&#39;ve got a bunch of Philips Hue lights in the house and they run over Zigbee, do I really want to end up with a Philips Hue hub (which I actually already had and  has an HA integration) plus an Aqara hub ( which also has an HA integration) plus whatever other devices I end up with and their own hubs as well? Not really, which brings me to the ConBee II Zigbee sniffer.</p><p>  但是，其他制造商的其他Zigbee设备又如何呢？例如，我屋子里有一堆飞利浦Hue灯，它们在Zigbee上方运行，我真的想最终得到一个飞利浦Hue集线器（我实际上已经拥有并集成了HA）和Aqara集线器（也具有HA集成）以及我最终使用的其他任何设备以及它们自己的集线器？不完全是，这使我想到了ConBee II Zigbee嗅探器。</p><p>  HA alone can&#39;t read from Zigbee devices and as already discussed, they also can&#39;t drop directly onto your Wi-Fi hence the need for a hub. What folks tend to do is go for a &#34;CC2531 stick&#34; which can &#34;sniff&#34; Zigbee traffic.  CC2531 is a chipset made by Texas Instruments (check the date on that resources, this goes back over a decade) that appears in a whole heap of cheap units sold as &#34;Zigbee sniffers&#34;. But there was one particular model that came up time and time again after I posted that earlier tweet with the temp sensor; without prompting, many people directed me to the  ConBee II, a little USB stick with a CC2531 chip that can talk IEEE 802.15.4 and implements the Zigbee protocol. See how that ties all these new things together? 😊</p><p>  仅HA不能从Zigbee设备读取，并且正如已经讨论的那样，它们也不能直接掉到Wi-Fi上，因此需要集线器。人们倾向于做的是“ CC2531棍子”，它可以“嗅” Zigbee流量。 CC2531是德州仪器（Texas Instruments）生产的芯片组（检查该资源的日期，可以追溯到十年前），出现在大量廉价单位中，称为“ Zigbee嗅探器”。但是，在我发布了有关温度传感器的较早的推文之后，有一次又一次出现一种特殊的模型。在没有提示的情况下，许多人将我引导到了ConBee II，这是一个带有CC2531芯片的小型USB记忆棒，可以与IEEE 802.15.4通讯并实现Zigbee协议。看看这些新事物如何联系在一起？ 😊</p><p>   The ConBee II is produced under the Phoscon brand, a name I mentioned back in part 1 in relation to the deCONZ integration. I picked one up off Amazon for A$78, plugged it into the USB port of the Raspberry Pi running HA then configured it all by following  this great guide which takes you through the entire journey. When I went through that process only 6 months after that post was written, there were quite a few bits that were out of date (namely where things are located within the UI), but it was still easy to follow. Once done, all the mechanics are now there to join up all the respective bits of the Zigbee network:</p><p>   ConBee II以Phoscon品牌生产，这是我在第1部分提到的与deCONZ集成相关的名称。我以78澳元的价格从亚马逊买了一个，将其插入运行HA的Raspberry Pi的USB端口，然后按照此出色的指南进行配置，以带您完成整个旅程。当我写完这篇文章后仅六个月就进行了该过程时，有很多地方已经过时（即，UI中的位置），但是仍然很容易理解。完成后，所有机制现在都可以连接到Zigbee网络的所有各个部分：</p><p>  The next problem is that in my case, I ended up with a single USB sniffer stuck into a Raspberry Pi inside a server rack inside a large walk-in cupboard inside a garage at the bottom of a large 3-story solid brick construction house. You can guess what comes next...</p><p>  下一个问题是，以我为例，我最终将一个USB嗅探器插入了Raspberry Pi的服务器机架内的树莓派中，该服务器机架位于大型三层实心砖结构房屋底部车库中的大型步入式橱柜中。您可以猜测接下来会发生什么...</p><p>  In fairness to the ConBee II, it did an admirable job under the circumstances and indeed  its range is a big selling point:</p><p>  公平地说，在ConBee II中，它在这种情况下做得很好，其范围确实是一个很大的卖点：</p><p> Thanks to its power-amplifier, the ConBee II has an outstanding range. This lets the signal pass through 2–3 rooms or floors, depending on the construction type.</p><p>得益于其功率放大器，ConBee II具有出色的范围。这使信号可以通过2-3个房间或楼层，具体取决于建筑类型。</p><p> But it wasn&#39;t enough. I continually found temp sensors (which I now had in every single room) not being available so clearly something had to give. Fortunately, one of the joys of Zigbee is that - and I&#39;m going to quote here - &#34;all mains powered Zigbee devices, such as lights and sockets, act as repeaters and can route the signal&#34;. This is again from  the Phoscon page on the ConBee II which they illustrate as follows:</p><p> 但这还不够。我不断发现温度传感器（现在我在每个房间都有）无法使用，因此必须提供一些明确的信息。幸运的是，Zigbee的乐趣之一是-我在这里引用-“所有由市电供电的Zigbee设备，例如电灯和插座，都可以用作中继器并可以路由信号”。再次来自ConBee II的Phoscon页面，其说明如下：</p><p>  This creates a mesh network enabling you to expand the Zigbee range as more (mains powered) devices are added. That&#39;s all good in theory but in practice, well, let me just drop a discussion I had with my good mate Scott Helme in right here as he was going through his own HA build:</p><p>  这将创建一个网状网络，使您可以在添加更多（市电）设备时扩展Zigbee范围。从理论上讲，这一切都很好，但实际上，让我在我正在与我的好伴侣斯科特·赫尔姆（Scott Helme）进行他自己的HA构建时，进行一下讨论：</p><p>  I wanted to include this discussion in its original candid state because it perfectly illustrates the frustrations I raised in part 1: this is still a &#34;maker&#34; world where even people who live and breathe tech day in and day out continue to hit hurdles. I found multiple references around the web about the IKEA repeaters not playing nice with Xiaomi devices, yet when I looked at my own Zigbee network, I saw this:</p><p>  我想以原始的坦率状态进行讨论，因为它完美地说明了我在第1部分中提出的挫败感：这仍然是一个“制造者”世界，即使每天生活和呼吸技术的人们也继续遇到障碍。我在网上发现了许多关于IKEA中继器不能与小米设备配合使用的参考，但是当我查看自己的Zigbee网络时，却发现：</p><p>  I can see plenty of devices connected to &#34;Range Extender 1&#34; in the garage! But no devices connected to &#34;Range Extender 2&#34; in the master bedroom. There are too many devices spread out over too large an area for this to be a mere coincidence, is it simply that one range extender doesn&#39;t want to connect and one does? I&#39;ve ordered another couple just to see what happens, but I continually get the feeling that this whole effort raises more questions than it answers...</p><p>  我可以在车库中看到很多连接到“ Range Extender 1”的设备！但没有设备连接到主卧室中的“ Range Extender 2”。太多的设备散布在太大的区域上，这仅仅是一个巧合，难道仅仅是一个范围扩展器不想连接而一个范围扩展器想要连接吗？我命令另一对夫妇只是为了看看会发生什么，但是我不断感觉到，这整个工作提出了更多的问题而不是答案。</p><p> A quick sidenote on those Philips Hue devices in the Zigbee map above: per mny discussion with Scott, I had to unpair them from the Hue Bridge and then pair them in deCONZ just like all the other Zigbee devices. Consequently, I can no longer use the Philips Hue app to manage, say, the two Hue Go units on my desk. As I said in part 1, the native apps are often richer in functionality than what HA provides and that&#39;s the case here too. I have several Hue light strips around my fireplace, one behind my TV and one behind the perimeter of a massive mirror in my entertainment room. I want the family to be able to manage these directly via an easy to use app hence I haven&#39;t moved them over to deCONZ. That means they don&#39;t form part of the Zigbee mesh network in the image above, but they&#39;re also in locations where there&#39;s plenty of coverage already. My office really needed more coverage (it&#39;s several floors above where the ConBee II is located) and it&#39;s only me who manages them hence their presence on the deCONZ network.</p><p> 在上面的Zigbee地图中，这些飞利浦Hue设备的简短说明：在与Scott进行的多次讨论中，我不得不将它们与Hue Bridge取消配对，然后像在所有其他Zigbee设备中一样，将它们与deCONZ配对。因此，我再也无法使用Philips Hue应用程序来管理我桌上的两个Hue Go设备。正如我在第1部分中所述，本机应用程序通常比HA提供的功能更丰富，这里也是如此。我的壁炉周围有几个顺化灯带，一个在电视后面，一个在娱乐室的大镜子后面。我希望家人能够通过一个易于使用的应用程序直接管理这些内容，因此我没有将它们移到deCONZ。这意味着它们不属于上图中的Zigbee网格网络的一部分，但是它们也位于已经有大量覆盖范围的位置。我的办公室确实需要更多的覆盖范围（位于ConBee II所在楼层的几层楼），只有我来管理它们，因此它们要出现在deCONZ网络中。</p><p> One final thing on the whole Zigbee piece: I&#39;m seeing a lot of feedback about people having problems with deCONZ and switching over to ZHA instead:</p><p> Zigbee整体上的最后一件事：我看到很多关于人们在使用deCONZ并转而使用ZHA上遇到问题的反馈：</p><p> Hi Troy just read your post. Really cool stuff. You should know that you can switch from deCONZ to native ZHA integration imo it works much better and makes the integration much better. I did the switch a few months ago and it&#39;s been great only downside is you need to pair again.</p><p>嗨，特洛伊（Troy）刚读了您的帖子。真的很酷的东西。您应该知道，您可以从deCONZ切换到本机ZHA集成imo，它可以更好地工作并使集成更好。几个月前我进行了切换，这很棒，唯一的缺点是您需要再次配对。</p><p>— Dementor 🇮🇱 (@the_mentor)  November 23, 2020</p><p>— Dementor🇮🇱（@the_mentor）2020年11月23日</p><p>  The  Zigbee Home Automation (&#34;ZHA&#34;) integration seems to be quite highly regarded and if I&#39;m honest, I&#39;ve had a lot of problems with deCONZ. When I look at it within HA now, there&#39;s a bunch of devices that have lost the carefully crafted names I provided them with when originally pairing them:</p><p>  Zigbee家庭自动化（“ ZHA”）集成似乎受到了高度重视，老实说，我在deCONZ方面遇到了很多问题。当我现在在HA中查看它时，有很多设备丢失了最初配对它们时为它们提供的精心设计的名称：</p><p>  This happens over and over again and to be honest, I just need to bite the bullet, kill deCONZ, set up ZHA and manually re-pair every single Zigbee device in the house 😭 To be clear, this isn&#39;t breaking the HA references to the devices in any way, it just screws up their representation within deCONZ and subsequently, the earlier network map as well.</p><p>  这会一遍又一遍地发生，说实话，我只需要硬着头皮，杀死deCONZ，设置ZHA并手动重新配对房屋中的每个Zigbee设备😭要清楚，这并没有破坏HA参考以任何方式连接到设备，只需将它们在deCONZ中的表示以及随后的早期网络图中的表示搞乱即可。</p><p> But for the most part the Zigbee stuff has been great, especially those Xiaomi Aqara devices. Let&#39;s drill into them now.</p><p> 但是在大多数情况下，Zigbee的东西很棒，尤其是那些小米Aqara设备。现在让我们深入研究它们。</p><p>  I want to devote a section of this post specifically to  Xiaomi Aqara as these are great little devices that I now have all over the house. Before I get to the devices themselves, a bit of disambiguation around the names you&#39;ll see used here:</p><p>  我想专门针对小米Aqara撰写这篇文章的一部分，因为这些是我现在整个房子都拥有的很棒的小设备。在介绍设备本身之前，您会在此处使用的名称有一些歧义：</p><p> Mijia is a brand name owned by Xiaomi (you would have seen it on the Aqara hub image earlier on)</p><p> Mijia是小米拥有的品牌名称（您早先会在Aqara集线器图像上看到它）</p><p> Bottom line: Aqara is the name you&#39;ll see me using here as that&#39;s what&#39;s on the devices I&#39;ve been buying (plus I can spell it more reliably than Xiaomi!) They&#39;re cheap, reliable and in my view, pretty slick looking little units. Earlier in this post I showed one of the temp sensors (pro tip: the round ones are an earlier generation, the square ones are newer and also do air pressure as well as temp and humidity), and in part 1 I showed the motion sensors which trigger lights when it&#39;s dark. Beyond those, I&#39;ve used a number of proximity sensors so I know when doors are open or shut:</p><p>底线：Aqara是您会在这里使用的名称，因为这就是我一直在购买的设备上的名称（此外，我可以比小米更可靠地拼写它！）它们便宜，可靠，并且在我看来，很漂亮看起来很小的单位。在本文的较早部分，我展示了一个温度传感器（提示：圆形传感器是较早的一代，方形传感器是较新的，并且还可以处理气压以及温度和湿度），在第1部分中，我展示了运动传感器天黑时会触发灯。除此之外，我还使用了许多接近传感器，所以我知道门何时打开或关闭：</p><p>   In part 1 when I showed my Apple Watch opening the garage door, this is achieved by defining a  cover in HA. A cover, uh, &#34;covers&#34; stuff so blinds, shutters and garage doors, for example. When you think about a cover like a garage door, there&#39;s really 2 things you want visibility or control over:</p><p>   在第1部分中，当我展示我的Apple Watch打开车库门时，这是通过在HA中定义一个盖来实现的。封面，“覆盖”东西，例如百叶窗，百叶窗和车库门。当您想到车库门之类的盖子时，实际上有两件事需要查看或控制：</p><p>  The proximity sensor answers the first point and the Shelly from part 1 answers the second point. Combined, they enable me to glance at my watch, see the state of the garage door and then change that state.</p><p>  接近传感器回答第一点，第一部分的雪莉回答第二点。结合起来，它们使我可以看一眼手表，查看车库门的状态，然后更改该状态。</p><p>    These are simple triggers that can be used in automations. For example, I have one at the bottom of my stairs that can turn off a bunch of lights with just a single click. Those lights normally come on just before sunset but if I want to  manually turn them on, that&#39;s just a double-click on the same button. Neat!</p><p>    这些是可以在自动化中使用的简单触发器。例如，我在楼梯的底部有一个，只需单击一下就可以关闭一堆灯。这些灯通常在日落之前点亮，但是如果我要手动将其打开，则只需双击同一按钮即可。整齐！</p><p>  Get mailbox notifications in 4 easy steps: 1) Get a  @AQaraSmarthouse vibration/movement sensor 2) add it to your local  #ZigBee network 3) attach it to the mailbox 4) add some automation to  @home_assistant so you get a notification every time there&#39;s movement!  #homeautomation  pic.twitter.com/tP9pg7lzu1</p><p>  通过4个简单的步骤获取邮箱通知：1）获取@AQaraSmarthouse振动/运动传感器2）将其添加到本地#ZigBee网络3）将其附加到邮箱4）向@home_assistant添加一些自动化功能，以便每次收到通知有运动！ #homeautomation pic.twitter.com/tP9pg7lzu1</p><p>— Pedro Lamas (@pedrolamas)  July 7, 2019</p><p>— Pedro Lamas（@pedrolamas）2019年7月7日</p><p>  There are plenty of Zigbee devices out there, but I wanted to call out Aqara in particular as they&#39;ve just been so damn reliable. Only once have I had an issue with any of the couple of dozen devices I have in the house, and that was just the letterbox vibration sensor shipping with a near-flat battery.</p><p>  那里有很多Zigbee设备，但是我想特别提及Aqara，因为它们真是太可靠了。我家里的几十个设备中的任何一个都只有一个问题，那就是带有近用完电池的信箱振动传感器。</p><p> I put a temp sensor in each room right at the beginning of my HA journey. It was simple, cheap and immediately gave me useful data I could start doing stuff with:</p><p>我开始HA之旅时，便在每个房间里都安装了温度传感器。它简单，便宜，并且立即为我提供了有用的数据，我可以用以下方法开始做事：</p><p>  So pro tip: if you want to get into HA and IoT in a meaningful way, start here and work up. Those temp sensors are cheap, useful and give you a means of dipping your toe into the IoT water in a pretty low-friction way. Chuck in some motion and proximity sensors and there&#39;s a bunch of stuff you can do right away without spending much.</p><p>  提示：如果您想以有意义的方式进入HA和IoT，请从这里开始并进行工作。这些温度传感器既便宜又实用，可让您以一种低摩擦的方式将脚趾浸入IoT水中。插入一些运动和接近传感器，无需花费太多，您就可以立即完成很多工作。</p><p> Let&#39;s now move onto something completely the opposite of low-friction and get our hands much, much dirtier.</p><p> 现在，让我们进入与低摩擦完全相反的事物，让我们的双手更加肮脏。</p><p>  I propose that we all need to find our own paths in terms of just how dirty we want to get our hands when playing with IoT. For many, the whole idea of running a Raspberry Pi with community driven software you configure with YAML is a step too far. For others, it&#39;s just the beginning with many people going down the path of, per the heading above, flashing custom firmware onto devices and soldering wires. In fact, this is the path I was originally going to head down for my garage door by following this video:</p><p>  我建议，我们所有人都需要找到自己的道路，即我们在玩物联网时想要得到多少脏手。对于许多人来说，使用您使用YAML配置的社区驱动软件来运行Raspberry Pi的整个想法实在是太过分了。对于其他人来说，这仅仅是开始，许多人按照上面的标题，将自定义固件刷新到设备和焊接线上。实际上，这是我最初通过跟踪此视频前往车库门的路径：</p><p> I bought all the bits, downloaded the firmware flasher, wired it all up per the instructions yet still, found myself lost:</p><p> 我购买了所有组件，下载了固件更新程序，并按照说明将其全部连接好，发现自己迷路了：</p><p> Need some debug help with Sonoff SV and Tasmotizer: boards seem to be wired up properly, serial converter LED comes on, Sonoff is powered on with reflash button held, COM port is correct yet Tasmotizer can&#39;t see the Sonoff. Anything obvious wrong?  pic.twitter.com/DByJqCEKDQ</p><p> 需要Sonoff SV和Tasmotizer的一些调试帮助：电路板似乎已正确连接，串行转换器LED亮起，Sonoff的电源打开并按住了刷新按钮，COM端口正确，但Tasmotizer看不到Sonoff。有什么明显的错误吗？ pic.twitter.com/DByJqCEKDQ</p><p>— Troy Hunt (@troyhunt)  August 24, 2020</p><p>-特洛伊·亨特（@troyhunt）2020年8月24日</p><p>  I then discovered that contrary to the instructions, RX shouldn&#39;t go to TX,  it should go to RX and right there at that moment, I&#39;ll be honest: I lost my shit. Why is this so hard?! Why do I need to modify the firmware of such a simple little device?! And why do I then find myself holding a burning soldering iron just to open my freakin&#39; garage door?!</p><p>然后，我发现与指令相反，RX不应转到TX，而应转到RX，然后就在那一刻，老实说：我丢了屎。为什么这么难？！为什么需要修改这种简单的小型设备的固件？为什么我然后发现自己拿着燃烧的烙铁只是为了打开我的车库门？</p><p> To be fair to the folks that enjoy living in this world, I can see the attraction and I have great respect for those with the skill and patience to take this path.  Tasmota is enormously popular open source firmware designed for  ESP8266 devices which is the chipset many IoT products run (including a bunch of the lights in my house). But for me, it&#39;s a step too far and an unnecessary one at that given how easy it eventually was to achieve the same result with a Shelly that requires no custom firmware, no soldering and has no exposed circuitry:</p><p> 为了公平地对待生活在这个世界上的人们，我可以看到这个景点，并且我对那些有技巧和耐心走这条路的人表示敬意。 Tasmota是为ESP8266设备设计的非常流行的开源固件，它是许多IoT产品运行的芯片组（包括我家中的一堆灯）。但是对我来说，这是一个太过分而又不必要的步骤，因为使用不需要自定义固件，无需焊接且没有裸露电路的Shelly最终达到相同结果的难易程度是：</p><p>   The most complex part of this entire approach was reading  the garage door opener manual and referring to the terminal block on the back of the unit:</p><p>   整个方法中最复杂的部分是阅读车库门开启器手册，并参考设备背面的接线盒：</p><p>   O/S/C INPUT is used for the connection of a wired switch (momentary contact). This switch can then be used to open, stop or close the door.</p><p>   O / S / C INPUT用于连接有线开关（瞬时触点）。然后可以使用此开关打开，停止或关闭门。</p><p> All the garage door automation needed to do was close the circuit between the COM and OSC terminals via the Shelly which is then powered via the 24V terminal. The point I&#39;m trying to make is that there&#39;s a heap that can be done without going down to the custom firmware and soldering layers and I wish I&#39;d known that before I got started. This, to my mind, is the &#34;happy path&#34; I referred to in part 1.</p><p> 车库门自动化所需要做的就是通过Shelly闭合COM和OSC端子之间的电路，然后通过24V端子供电。我要说明的一点是，可以完成很多工作而无需使用自定义固件和焊接层，我希望在开始之前就知道这一点。在我看来，这就是我在第1部分中提到的“快乐之路”。</p><p>  This post mostly boils d</p><p>  这个帖子主要是沸腾了</p><p>......</p><p>......</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.troyhunt.com/iot-unravelled-part-2-ip-addresses-network-zigbee-custom-firmware-and-soldering/">https://www.troyhunt.com/iot-unravelled-part-2-ip-addresses-network-zigbee-custom-firmware-and-soldering/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/物联网/">#物联网</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ip/">#ip</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/设备/">#设备</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>