<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>传送6.0：数据库访问简单 Teleport 6.0: Database Access Made Easy</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Teleport 6.0: Database Access Made Easy<br/>传送6.0：数据库访问简单 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-30 07:59:07</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/196e028a44975a51d816988253681cd6.jpeg"><img src="http://img2.diglog.com/img/2021/3/196e028a44975a51d816988253681cd6.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Teleport is an  open source, identity-aware, access proxy with an integrated certificate authority. People have been using teleport for ssh-access, Kubernetes clusters and with Teleport 6.0 you get Database access as well (Postgress and MySQL).</p><p>传送是一个开源，身份感知，具有集成证书颁发机构的访问代理。人们一直在使用传送用于SSH访问，Kubernetes集群以及传送6.0您获得数据库访问（后期和MySQL）。</p><p> In this tutorial, I will show you how you can do it all from scratch for a self-hosted MySQL Database(I will show the database install as well).</p><p> 在本教程中，我将向您展示如何从托管MySQL数据库的划痕（我也显示数据库安装）。</p><p>        export IP={ip for the instance} #in my case  export IP=212.2.240.196 teleport configure --acme --acme-email=saiyam911@gmail.com --cluster-name=magic-$IP.nip.io --output=&#34;/etc/teleport.yaml&#34; Wrote config to file &#34;/etc/teleport.yaml&#34;. Now you can start the server. Happy Teleporting!</p><p>        导出IP = {Ip for instans} #in我的案例导出IP = 212.2.240.196传送配置--acme --acme-email=saiyam911@gmail.com  -  cluster-name = magic-$ ip.nip.io  - -output =＆＃34; /etc/teleport.yaml&#34;写入配置文件＆＃34; /etc/teleport.yaml&#34;现在您可以启动服务器。快乐传送！</p><p>  systemctl start teleport systemctl enable teleport systemctl status teleport tctl users add teleport-admin --roles=admin --logins=root User &#34;teleport-admin&#34; has been created but requires a password. Share this URL with the user to complete user setup, link is valid for 1h: https://magic-212.2.240.196.nip.io:443/web/invite/b39e7b128d3243c6c10407b06d27be26 NOTE: Make sure magic-212.2.240.196.nip.io:443 points at a Teleport proxy which users can access.</p><p>  systemctl start teleport systemctl启用teleport systemctl status传送tctl用户添加传送admin  -  rools = admin --logins = root用户＆＃34; teleport-admin＆＃34;已创建但需要密码。与用户共享此URL以完成用户设置，链接有效为1H：https://magic-212.2.240.196.nip.io:443/web/invite/b39e7b128d3243c6c10407b06d27be26注意：确保Magic-212.2.20.196.nip。 IO：用户可以访问的Teleport代理443分。</p><p>  vi /etc/teleport.yaml #Add below in bold proxy_service:  enabled: &#34;yes&#34;  listen_addr: 0.0.0.0:3023  web_listen_addr: :443  public_addr: magic-212.2.240.196.nip.io:443   mysql_listen_addr: 0.0.0.0:3036</p><p>  vi /etc/teleport.yaml #add下面是粗体proxy_service：启用：＆＃34;是＆＃34; listence_addr：0.0.0.0:3023 web_listen_addr ::443 public_addr：magic-212.2.240.196.nip.io:443 mysql_listen_addr：0.0.0.0:3036</p><p>   # Export Teleport&#39;s certificate authority and generate certificate/key pair # for host db.example.com with a one year validity period.  tctl auth sign --format=db --host=localhost --out=server --ttl=8760h The credentials have been written to server.key, server.crt, server.cas</p><p>   ＃导出传送和＃39; s证书颁发机构，并为主机db.example.com生成证书/密钥对＃，具有一年的有效期。 tctl auth sign --format = db  -  host = localhost --out = server --ttl = 8760h已写入server.key，server.crt，server.cas</p><p>          mysql&gt; CREATE USER &#39;alice&#39;@&#39;%&#39; REQUIRE X509; Query OK, 0 rows affected (0.00 sec) mysql&gt; ALTER USER &#39;alice&#39;@&#39;%&#39; REQUIRE X509; Query OK, 0 rows affected (0.00 sec) mysql&gt; GRANT ALL ON `%`.* TO &#39;alice&#39;@&#39;%&#39;; Query OK, 0 rows affected (0.00 sec)</p><p>          mysql＆gt;创建用户＆＃39;爱丽丝＆＃39; @＆＃39;％＆＃39;要求X509;查询OK，影响0行（0.00秒）MySQL＆GT;改变用户＆＃39;爱丽丝＆＃39; @＆＃39;％＆＃39;要求X509;查询OK，影响0行（0.00秒）MySQL＆GT;授予所有人`。*＆＃39; alice＆＃39; @＆＃39;％＆＃39 ;;查询OK，影响0行（0.00秒） </p><p> Step8: Create the token for database service to join (below command should run on teleport instance)</p><p>step8：为要加入的数据库服务创建令牌（下面的命令应该在传送实例上运行）</p><p> tctl tokens add \ --type=db \ --db-name=mysql \  --db-protocol=mysql \  --db-uri=localhost:3306 The invite token: 30b936383ccd1d117d9315770c08a63c. This token will expire in 60 minutes. Fill out and run this command on a node to start proxying the database: &gt; teleport start \  --roles=db \  --token=30b936383ccd1d117d9315770c08a63c \  --ca-pin=sha256:0cff619a5e66cb079cbb6110ec884424e5a5d47f16e13b8855344889568b5770 \  --auth-server=magic-212.2.240.196.nip.io:443 \  --db-name=mysql \  --db-protocol=mysql \  --db-uri=localhost:3306</p><p> tctl令牌add \  -  type = db \ --db-name = mysql \ --db-protocol = mysql \ --db-uri = localhost：3306邀请令牌：30b936383ccd1d117d9315770c08a63c。这个令牌将在60分钟内到期。在节点上填写并运行此命令以开始代理数据库：＆gt;瞬移启动\ --roles = DB \ --token = 30b936383ccd1d117d9315770c08a63c \ --ca针= SHA256：0cff619a5e66cb079cbb6110ec884424e5a5d47f16e13b8855344889568b5770 \ --auth服务器= magic-212.2.240.196.nip.io：443 \ --db名= mysql的\  - 协议= mysql \ --db-uri = localhost：3306</p><p> You can either use the above token and create a config file on the database instance for the database service using just the token ( https://goteleport.com/docs/ver/6.1/database-access/guides/mysql-self-hosted/#start-database-service-with-config-file)</p><p> 您可以使用上面的令牌并使用仅使用令牌（https://goteleport.com/docs/ver/6.1/database/guides/mysqloSted /＃start-database-service-with-config-file）</p><p> OR you can just use the output of the above command and run it on the database instance.</p><p> 或者，您可以使用上述命令的输出并在数据库实例上运行它。</p><p> Step9: Install teleport on Database instance and then run the output from the above command</p><p> step9：在数据库实例上安装传送，然后从上面的命令运行输出</p><p>   teleport start \ &gt; --roles=db \ &gt; --token=30b936383ccd1d117d9315770c08a63c \ &gt; --ca-pin=sha256:0cff619a5e66cb079cbb6110ec884424e5a5d47f16e13b8855344889568b5770 \ &gt; --auth-server=magic-212.2.240.196.nip.io:443 \ &gt; --db-name=mysql \ &gt; --db-protocol=mysql \ &gt; --db-uri=localhost:3306 INFO [PROC:1] Connecting to the cluster magic-212.2.240.196.nip.io with TLS client certificate. service/connect.go:128 INFO [AUDIT:1] Creating directory /var/lib/teleport/log. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log/upload. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log/upload/sessions. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log/upload/sessions/default. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log/upload. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log/upload/streaming. service/service.go:1895 INFO [AUDIT:1] Creating directory /var/lib/teleport/log/upload/streaming/default. service/service.go:1895 INFO [DB:SERVIC] Database service has successfully started: [DatabaseServer(Name=mysql, Version=6.0.2, Labels=map[])]. service/db.go:205</p><p>   传送启动\＆gt; -  rools = db \＆gt; --Token = 30b936383ccd1d117d9315770c08a63c \＆gt; -  CO-PIN = SHA256：0CFF619A5E66CB079CBB6110EC884424CA5A5D47F16E13B88555344889568B5770 \＆GT; --auth-server = magic-212.2.240.196.nip.io：443 \＆gt; --db-name = mysql \＆gt; --db-protocol = mysql \＆gt; --db-uri = localhost：3306信息[proc：1]连接到群集Magic-2.2.240.196.nip.io与TLS客户端证书。服务/ Connect.Go：128 Info [审核：1]创建目录/ var / lib / teleport / log。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log /上传。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log /上传/会话。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log /上传/会话/默认值。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log /上传。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log /上载/流。服务/服务。：1895信息[审计：1]创建目录/ var / lib / teleport / log /上载/流/默认。服务/服务。服务/ DB.GO：205</p><p>  Start the terminal session after login into the teleport server from the UI. You can also use tsh login on the teleport instance to login as a particular user.</p><p>  从UI登录到Teleport服务器后启动终端会话。您还可以在Teleport实例上使用TSH登录以作为特定用户登录。 </p><p>  Now let’s try to access the MySQL database running on the database instance :</p><p>现在让我们尝试访问在数据库实例上运行的MySQL数据库：</p><p> root@teleport-9cd889ac:~#  tsh db ls Name Description Labels Connect ---------- ----------- ------ ------------------------------------------------------------------------------------------------------ mysql root@teleport-9cd889ac:~#  tsh db login mysql Connection information for MySQL database &#34;magic-212.2.240.196.nip.io-mysql&#34; has been saved. You can now connect to the database using the following command: $ mysql --defaults-group-suffix=_magic-212.2.240.196.nip.io-mysql Or configure environment variables and use regular CLI flags: $ eval $(tsh db env)  $ mysql root@teleport-9cd889ac:~#  tsh db ls Name Description Labels Connect ---------- ----------- ------ ------------------------------------------------------------------------------------------------------ &gt; mysql mysql --defaults-group-suffix=_magic-212.2.240.196.nip.io-mysql --user=&lt;user&gt; --database=&lt;database&gt; root@teleport-9cd889ac:~#  mysql --defaults-group-suffix=_magic-212.2.240.196.nip.io-mysql --user=alice --database=mysql Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Welcome to the MySQL monitor. Commands end with ; or \g. Your MySQL connection id is 10027 Server version: 8.0.0-Teleport (Ubuntu) Copyright (c) 2000, 2021, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.  mysql&gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | sys | +--------------------+ 4 rows in set (0.00 sec)</p><p> root @ teleport-9cd889ac：〜＃tsh db ls名称描述标签连接---------- ----------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------------- root@ teleport-9cd889ac ：〜＃tsh db登录mysql数据库的MySQL连接信息＆＃34; Magic-212.2.20.196.nip.io-mysql＆＃34;已被保存。您现在可以使用以下命令连接到数据库：$ mysql --defaults-group-suffix = _magic-212.2.240.196.nip.io-mysql或配置环境变量和使用常规CLI标志：$ eval $（TSH DB ENV ）$ mysql root@ teleport-9cd889ac：〜＃tsh db ls名称描述标签连接---------- ----------------- ---------------------------------------------------------------- --------------------------------------- mysql mysql --defaults-group-suffix = _magic-212.2.240.196.nip.io-mysql -User =＆lt; User＆gt; --database =＆lt;数据库＆gt; root @ teleport-9cd889ac：〜＃mysql --defaults-group-suffix = _magic-212.2.240.196.nip.io-mysql -User = Alice --Database = MySQL阅读表信息，您可以完成表和列名称的表格和列名称关闭此功能以获得更快的启动-a欢迎光临MySQL Monitor。命令结束;或\ g。您的MySQL连接ID是10027服务器版本：8.0.0-Teleport（Ubuntu）版权所有（c）2000,2021，甲骨文和/或其附属公司。 Oracle是Oracle Corporation和/或其关联公司的注册商标。其他名称可能是其各自所有者的商标。类型＆＃39;帮助;＆＃39;或＃39; \ h＆＃39;求助。类型＆＃39; \ c＆＃39;清除当前输入语句。 mysql＆gt;显示数据库; + ------------------- + |数据库| + ------------------- + | Information_Schema | | mysql | | performance_schema | | sys | + ------------------ + 4行集合（0.00秒）</p><p> As you can see a user can establish a Mysql server connection from teleport. how cool is that !!!!</p><p> 如您所见，用户可以从传送器建立MySQL服务器连接。多么酷啊 ！！！！</p><p>  In simple 10 steps, I was able to set up teleport, create users, create a database and connect to the database from the teleport UI. Optionally you can also create RBAC as teleport supports RBAC so you can create a db role for the database and create users with that role accordingly.  docs to create RBAC:  https://goteleport.com/docs/ver/6.1/database-access/guides/mysql-self-hosted/#create-role-and-user</p><p>  在简单的10个步骤中，我能够设置传送，创建用户，创建数据库并从Teleport UI连接到数据库。可选地，您还可以创建RBAC作为传送支持RBAC，因此您可以为数据库创建DB角色，并相应地创建具有该角色的用户。文档要创建RBAC：https://goteleport.com/docs/ver/6.1/database-access/guides/mysql-self-hosted/#create- role-and-user </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://saiyampathak.medium.com/teleport-6-0-database-access-made-easy-ec7f8a8cc40f">https://saiyampathak.medium.com/teleport-6-0-database-access-made-easy-ec7f8a8cc40f</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/数据库/">#数据库</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/database/">#database</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/access/">#access</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/mysql/">#mysql</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>