<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>关于化石DVC设计的思考 Thoughts on the Design of the Fossil DVCS</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Thoughts on the Design of the Fossil DVCS<br/>关于化石DVC设计的思考 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-14 05:47:58</div><div class="page_narrow text-break page_content"><p>Two questions (or criticisms) that arise frequently regarding Fossilcan be summarized as follows:   Neither question can be answered directly because they are bothbased on false assumptions. We claim that Fossil is not based on SQLiteat all and that Fossil is not based on a distributed NoSQL databasebecause Fossil is a distributed NoSQL database. And, Fossil does usea modern high-level language for its implementation, namely SQL.  We begin with the first question: Fossil is not based on a distributedNoSQL database because Fossil   is a distributed NoSQL database.Fossil is  not based on SQLite.The current implementation of Fossil usesSQLite as a local store for the content of the distributed database and asa cache for meta-information about the distributed database that is precomputedfor quick and easy presentation. But the use of SQLite in this role is animplementation detail and is not fundamental to the design. Some futureversion of Fossil might do away with SQLite and substitute a pile-of-files ora key/value database in place of SQLite.(Actually, that is very unlikelyto happen since SQLite works amazingly well in its current role, but the pointis that omitting SQLite from Fossil is a theoretical possibility.) The underlying database that Fossil implements has nothing to do withSQLite, or SQL, or even relational database theory. The underlyingdatabase is very simple: it is an unordered collection of &#34;artifacts&#34;.An artifact is a list of bytes - a &#34;file&#34; in the usual manner of thinking.Many artifacts are simply the content of source files that havebeen checked into the Fossil repository. Call these &#34;content artifacts&#34;.Other artifacts, known as&#34;control artifacts&#34;, contain ASCII text in a particular format thatdefines relationships between other artifacts, such as whichcontent artifacts that go together to form a particular version of theproject. Each artifact is named by its SHA1 or SHA3-256 hash and isthus immutable.Artifacts can be added to the database but not removed (if we ignorethe exceptional case of  shunning.) Repositoriessynchronize by computing the union of their artifact sets. SQL andrelation theory play no role in any of this. SQL enters the picture only in the implementation details. The currentimplementation of Fossil stores each artifact as a BLOB in an SQLitedatabase.The current implementation also parses up each control artifact as itarrives and stores the information discovered from that parse in variousother SQLite tables to facilitate rapid generation of reports such astimelines, file histories, file lists, branch lists, and so forth. Notethat all of this additional information is derived from the artifacts.The artifacts are canonical. The relational tables serve only as a cache.Everything in the relational tables can be recomputedfrom the artifacts, and in fact that is exactly what happens when one runsthe &#34;fossil rebuild&#34; command on a repository. So really, Fossil works with two separate databases. There is thebag-of-artifacts database which is non-relational and distributed (likea NoSQL database) and there is the local relational database. Thebag-of-artifacts database has a fixed format and is what defines a Fossilrepository. Fossil will never modify the file format of the bag-of-artifactsdatabase in an incompatible way because to do so would be to make somethingthat is no longer &#34;Fossil&#34;. The local relational database, on the other hand,is a cache that contains information derived from the bag-of-artifacts.The schema of the local relational database changes from time to time asthe Fossil implementation is enhanced, and the content is recomputed fromthe unchanging bag of artifacts. The local relational database is animplementation detail which currently happens to use SQLite. Another way to think of the relational tables in a Fossil repository isas an index for the artifacts. Without the relational tables,to generate a report like a timeline would require scanning every artifact -the equivalent of a full table scan. The relational tables hold pointersthe relevant artifacts in presorted order so that generating a timelineis much more efficient. So like an index in a relational database, therelational tables in an Fossil repository do not add any new information,they merely make the information in the artifacts faster and easier tolook up. Fossil is not &#34;based&#34; on SQLite. Fossil simply exploits SQLite asa powerful tool to make the implementation easier.And Fossil doesn&#39;t use a distributedNoSQL database because Fossil is a distributed NoSQL database. That answersthe first question.  The second concern states that Fossil does not use a high-level scriptinglanguage. But that is not true. Fossil uses SQL (as implemented by SQLite)as its scripting language. This misunderstanding likely arises because people failto appreciate that SQL is a programming language. People are taught that SQLis a &#34;query language&#34; as if that were somehow different from a&#34;programming language&#34;. But they really are two different flavors of thesame thing. I find that people do better with SQL if they think ofSQL as a programming language and each statementof SQL is a separate program. SQL is a peculiar programming languagein that one uses SQL to specify  what to compute whereas inmost other programming languages one specifies  howto carry out the computation.This difference means that SQLis an extraordinary high-level programming language, but it is stilljust a programming language. For certain types of problems, SQL has a huge advantage over otherprogramming languages because it is so high level and because it allowsprogrammers to focus more on the  what and less on the  howof a computation. In other words,programmers tend to think about problems at a much higher level whenusing SQL; this can result in better applications.SQL is also very dense.In practice, this often means that a fewlines of SQL can often replace hundreds or thousands of lines ofprocedural code, with a corresponding decrease in programming effortand opportunities to introduce bugs.Fossil happens to be one of those problems for which SQL is well suited. Much of the &#34;heavy lifting&#34; within the Fossil implementation is carriedout using SQL statements. It is true that these SQL statements are gluedtogether with C code, but it turns out that C works surprisingly well inthat role. Several early prototypes of Fossil were written in a scriptinglanguage (TCL). We normally find that TCL programs are shorter than theequivalent C code by a factor of 10 or more. But in the case of Fossil,the use of TCL was actually making the code longer and more difficult tounderstand.And so in the final design, we switched from TCL to C in order to makethe code easier to implement and debug. Without the advantages of having SQLite built in, the design might wellhave followed a different path. Most reports generated by Fossil involvea complex set of queries against the relational tables of the repositorydatabase. These queries are normally implemented in only a few dozenlines of SQL code. But if those queries had been implemented procedurallyusing a key/value or pile-of-files database, itmay have well been the case that a high-level scripting language such asTcl, Python, or Ruby may have worked out better than C.</p><p>Warning: Can only detect less than 5000 characters</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.fossil-scm.org/home/doc/trunk/www/theory1.wiki">https://www.fossil-scm.org/home/doc/trunk/www/theory1.wiki</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/dvc/">#dvc</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/design/">#design</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/warning/">#warning</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012 - 2021 diglog.com </div></div></body></html>