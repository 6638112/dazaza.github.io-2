<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>了解PgBouler中的用户管理</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">了解PgBouler中的用户管理</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-08 02:03:50</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/4f05540e92ed55ff455eef6d67b780ca.jpg"><img src="http://img.diglog.com/img/2020/7/4f05540e92ed55ff455eef6d67b780ca.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>PgBouner是一种流行的PostgreSQL连接代理和池。当PgBouner向客户端应用程序提供PostgreSQL协议接口时，它还处理客户端身份验证。为此，它维护自己的用户和密码目录。这有时会引起混淆，所以在这篇博客文章中，我想试着描述一下它是如何工作的。</p><p>在PgBouner中可以通过多种方式定义用户和密码。让我们从最简单的开始。您可以在文本文件中定义用户和密码。此文件的位置由配置参数auth_file设置。它通常被命名为userlist.txt，但是您当然可以使用任何名称。此文件的格式如下：</p><p>该文件基本上实现了与PostgreSQL后端中的系统目录pg_authid(以前的pg_dow(以前的pg_user))相同的用途。事实上，PostgreSQL过去常常将自己的用户数据库保存在数据目录中的一个类似文件中，此选项的初衷是您可以将PgBouner直接指向该文件，以便在PostgreSQL和PgBouner之间直接共享用户。但这不再起作用，因为PostgreSQL不再以这种方式工作，所以无论出于何种目的，这现在都是一个文本配置文件。保持此文件与PostgreSQL中定义的用户同步的一种方法是查询pg_authid并以适当的格式将结果转储到此文件中。PgBouler附带的脚本mkauth.py可以用于此目的。</p><p>此文件中的密码可能是纯文本密码，也可能是使用MD5或SCRAM加密的密码，具体取决于要使用的身份验证方法。此处不介绍这些身份验证方法的详细信息。也就是说，如果您想要存储加密的密码，那么决定一种以自动或脚本方式维护此信息而不是手动编辑它的方法可能会很有用。</p><p>请注意，应限制此文件的访问权限，通常为0600模式。</p><p>另一种定义用户的方式是在需要时让PgBouner直接查询PostgreSQL后端。这是由配置参数auth_user设置的，该参数可以全局设置，也可以按数据库设置。设置后，PgBouner使用该用户连接到PostgreSQL后端，并运行由设置auth_query定义的查询来查找用户和密码。如果auth_user本身需要该连接的密码，则需要在userlist.txt中设置密码。但是您也可以设置auth_user不需要密码，也许可以使用TLS证书。(有关使用PgBouler设置TLS的更多信息，请参阅此网络研讨会。)。</p><p>这意味着auth_user需要是PostgreSQL端的超级用户。例如，您可以这样做。</p><p>但是，最好在后端编写安全定义器函数，该函数可以查找用户，并且只能由特定用户调用。这篇博客文章对如何正确设置这一点进行了广泛的讨论。</p><p>还要注意，使用auth_user/auth_query可以为每个数据库提供不同的用户和密码，而auth_file则为整个PgBouner实例定义用户。</p><p>最后，如果通过设置auth_type=pam来使用PAM，则系统的工作方式会有所不同。AUTH_FILE和AUTH_USER被忽略。所有用户和密码信息都来自PAM系统。</p><p>请注意，在每种情况下，PgBouner维护的用户和密码信息都用于验证从客户端传入的连接以及为传出到服务器的连接提供身份验证信息。这是一个基本的设计决策：就身份验证而言，PgBouner希望成为或多或少透明的连接代理。如果您希望使用不同于PostgreSQL后端的用户名或密码登录到PgBouner，则设置和维护会更加复杂。</p><p>这在内部称为“强制用户”。此用户仅存在于到后端服务器的传出连接，否则在PgBouner用户数据库中并不真正存在。</p><p>您使用其中哪一个取决于关于整个设置的各种考虑因素。如果您的PostgreSQL服务器本身使用PAM或LDAP进行身份验证，那么在PgBouner中使用PAM也是有意义的。(PgBouner不支持本机LDAP身份验证方法，但可以通过PAM使用LDAP。)。另外，auth_user/auth_query更优雅，从长远来看需要的维护更少，但它最初需要更仔细的设置。AUTH_FILE是一种更传统的设置，如果用户和密码更改很多，则需要更多维护，但它更简单，可能更健壮，也更不令人惊讶。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.2ndquadrant.com/en/blog/understanding-user-management-in-pgbouncer/">https://www.2ndquadrant.com/en/blog/understanding-user-management-in-pgbouncer/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/了解/">#了解</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/user/">#user</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1010353.html"><img src="http://img.diglog.com/img/2020/7/thumb_76e7c35c060b4a6659f001fbd9f05539.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1010353.html">
您需要了解的有关虚拟TC会议的一切信息：移动性2020</a></div><span class="my_story_list_date">2020-7-8 0:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1009690.html"><img src="http://img.diglog.com/img/2020/7/thumb_bb0aaa1ccebe7f46095c62359006fe92.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1009690.html">了解围棋中的本地界面设计</a></div><span class="my_story_list_date">2020-7-4 0:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1009373.html"><img src="http://img.diglog.com/img/2020/7/thumb_59bea63e5d22a6fbd57aea5f9105a577.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1009373.html">5分钟了解VueJS</a></div><span class="my_story_list_date">2020-7-2 5:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1009313.html"><img src="http://img.diglog.com/img/2020/7/thumb_2e521703dbf499c6b68c278ecb26f4a8.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1009313.html">深入了解V8</a></div><span class="my_story_list_date">2020-7-2 0:37</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>