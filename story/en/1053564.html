<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Python包缓存 The Python Package Cache</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">The Python Package Cache<br/>Python包缓存 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-20 09:21:17</div><div class="page_narrow text-break page_content"><p>Figuring out how to install third-party libraries can derail people from learning to code or starting a new side project. We built the  Universal Package Manager (UPM for short) to save people from having to think about package installation at all. Just import the library, press run, and UPM will install it into your repl!</p><p>弄清楚如何安装第三方库可以通过学习代码或启动新的侧面项目来脱轨。我们构建了通用包管理器（FOWM for Short），以拯救人们根本不必考虑包装安装。刚刚导入库，按Run，UPM将安装到您的REPT中！</p><p> Every time you run a repl or a repl wakes up, UPM checks to see if it needs to download and install any dependencies. This is handy (no matter what&#39;s gone inside your repl, it will always have the dependencies it needs) but slow: UPM needs to download typically tens of megabytes worth of packages, extract them on the local filesystem, and sometimes also pre-compile them for better runtime performance.</p><p> 每次运行REPT或REPT唤醒时，UPM都会检查它是否需要下载并安装任何依赖项。这是方便的（无论什么＆＃39;在你的repl内，它始终需要它需要的依赖关系）但慢速：upm需要下载一个值为数十兆字节的包，提取它们在本地文件系统上，有时也会预先编译它们以获得更好的运行时性能。</p><p> Or at least it used to be slow until yesterday when we enabled the Python package cache, so now the most popular Python packages are pre-populated in pip&#39;s cache ( /home/runner/.cache/pip), so the download step is going to be mostly gone for the  vast majority of Python repls! It also uses pre-built wheels as much as possible to avoid even having to pre-compile code.</p><p> 或者至少在昨天启用Python软件包缓存之前，至少在昨天速度慢，所以现在最受欢迎的Python软件包在PIP＆＃39; s缓存（/home/runner/.cache/pip）中预先填充下载步骤将主要消失，绝大多数Python Repls！它还使用预制的轮子尽可能避免使用预编码代码。</p><p>   it should be as transparent as possible, which meant that users would still be able to add packages to the local cache while avoiding copying files around (which would have defeated the purpose of using a cache in the first place), and</p><p>   它应该尽可能透明，这意味着用户仍然能够将包添加到本地缓存，同时避免复制文件（这将击败首先使用缓存的目的），以及</p><p> each repl&#39;s cache should be independent of each other, to prevent cross-repl cache attacks (pollution, poisoning, etc.).</p><p> 每个曲柄和＃39; S缓存应该彼此独立，以防止交叉缓存攻击（污染，中毒等）。</p><p> To achieve both goals, we are using the same technique that Docker uses to be able to share files between images: the  Overlay Filesystem. On each machine that  runs repls, we have a read-only snapshot of the contents of the cache after installing the most popular packages. The snapshot is read-only bind-mounted into each repl into  /mnt/cacache. We then perform an Overlay-mount into the directory where the cache expects it to be ( /home/runner/.cache/pip), using  /mnt/cacache/pip as the &#34;lower&#34; directory and  /mnt/scratch/cacache_pip/upper (a user-writable directory) as the &#34;upper&#34; directory. This means that the shared files cannot be modified, and each repl has a  copy-on-write view of the cache.</p><p> 为了实现两个目标，我们使用的技术使用该技术，即Docker用于在图像之间共享文件：覆盖文件系统。在运行repls的每台计算机上，我们在安装最流行的包后，我们有一个只读的缓存内容的快照。快照是只读绑定到每个RECK中的绑定到/ mnt / cacache。然后，我们将覆盖安装到高速缓存期望它（/home/runner/.cache/pip），使用/ mnt / cacache / pip作为＆＃34;下部＆＃34;目录和/ mnt / scratch / cacache_pip / proper（用户可写目录）作为＆＃34;上部＆＃34;目录。这意味着无法修改共享文件，每个REPL都有一个复制的缓存的写字视图。</p><p> In order to keep the cache contents fresh, we gather stats about packages being downloaded from  PyPI, and every week we&#39;ll rebuild the cache with the list of most popular pip packages.</p><p> 为了保持高速缓存内容新鲜，我们收集关于从PYPI下载的包裹的统计数据，每周都会使用大多数流行的PIP包的列表重建缓存。 </p><p> Thanks to this, the average time to install packages has gone down ~40% across all  Always On repls.</p><p>由于此，在Repls上，安装包的平均时间下降〜40％。</p><p>   The name is derived from   Content- Addressable storage (plus &#34;cache&#34;). One of the properties that is needed for all this to work is that when a package is installed into the system, it is placed in a stable location in the filesystem that depends on the  contents of the package (typically the hash of the contents). Every time a package is going to be installed, the package installer ( pip in the case of Python) asks the package server for the metadata about the package, which includes the hash of the package. This hash is used to find whether the file is already in the cache, and the local copy is used instead of downloading a new one. Furthermore, since the hash of the contents of the package is already available, the contents can be checked for integrity by comparing the hash of the local copy with the expected one!</p><p>   该名称来自内容可寻址存储（加上＆＃34;缓存＆＃34;）。所有这一切都需要的属性之一是，当包装到系统中时，它被放置在文件系统中的稳定位置，这取决于包的内容（通常是内容的散列）。每次将安装包时，包安装程序（PIP在Python的情况下）询问包服务器有关包的元数据，包括包的散列。此哈希用于查找文件是否已在缓存中，并使用本地副本而不是下载新的副本。此外，由于包装内容的散列已经可用，因此可以通过将本地副本的散列与预期的副本进行比较来检查内容。</p><p>   We&#39;ll going to give the same treatment to Java (Maven packages) and JavaScript (npm packages) repls in the next couple of weeks to complete the three most popular languages. Plus a mysterious &#34;language&#34; that will be unveiled soon.</p><p>   我们将在接下来的几周内为Java（Maven Packages）和JavaScript（NPM软件包）进行相同的待遇，以便在接下来的几周内进行同样的处理，以完成三种最流行的语言。加上一个神秘的＆＃34;语言＆＃34;这将很快推出。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.replit.com/python-package-cache">https://blog.replit.com/python-package-cache</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/缓存/">#缓存</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/package/">#package</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>