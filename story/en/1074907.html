<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在远程桌面上使用浏览器进行网络钓鱼Phishing with an in-browser remote desktop</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Phishing with an in-browser remote desktop<br/>在远程桌面上使用浏览器进行网络钓鱼</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-25 15:37:00</div><div class="page_narrow text-break page_content"><p>Steal credentials and bypass 2FA by giving users remote access to your server via an HTML5 VNC client that has a browser running in kiosk mode.</p><p>窃取凭据并绕过2FA，方法是让用户通过HTML5 VNC客户端远程访问您的服务器，该客户端的浏览器在kiosk模式下运行。</p><p>  Recently I was on an engagement where all the users had 2FA enabled on their email. I quickly setup the great  Evilginx2 as I usually would. I couldn’t help but look at some of the outstanding issues on the Github project and realizing that some websites were implementing methods to prevent Evilginx2 and other MITM phishing tools from working. For example, if you tried using a Gmail phishlet, you probably ran into an error similar to the one shown below.</p><p>最近我参加了一个活动，所有用户的电子邮件都启用了2FA。我像往常一样迅速地设置了大恶魔2。我情不自禁地查看了Github项目中一些悬而未决的问题，并意识到一些网站正在实施一些方法，以防止Evilginx2和其他MITM网络钓鱼工具发挥作用。例如，如果您尝试使用Gmail phishlet，您可能会遇到与下面所示类似的错误。</p><p>  And so I made it my mission to find a new way of bypassing 2FA which eventually lead to this interesting &amp; unorthodox technique.</p><p>因此，我的使命是找到一种绕过2FA的新方法，最终实现这个有趣的&amp；非正统技术。</p><p>  noVNC is both a VNC client JavaScript library as well as an application built on top of that library. noVNC runs well in any modern browser including mobile browsers (iOS and Android). Essentially, noVNC allows the web browser to act as a VNC client to remotely access a machine.</p><p>noVNC既是一个VNC客户端JavaScript库，也是一个构建在该库之上的应用程序。noVNC在包括移动浏览器（iOS和Android）在内的任何现代浏览器中都运行良好。本质上，noVNC允许web浏览器充当VNC客户端，远程访问机器。</p><p> So how do we use noVNC to steal credentials &amp; bypass 2FA? Setup a server with noVNC, run Firefox (or any other browser) in kiosk mode and head to the website you’d like the user to authenticate to (e.g. accounts.google.com). Send the link to the target user and when the user clicks the URL they’ll be accessing the VNC session without realizing. And because you’ve already setup Firefox in kiosk mode all the user will see is a web page, as expected.</p><p>那么，我们如何使用noVNC窃取凭证&amp；绕过2FA？使用noVNC设置服务器，在kiosk模式下运行Firefox（或任何其他浏览器），然后前往您希望用户进行身份验证的网站（例如accounts.google.com）。将链接发送给目标用户，当用户单击URL时，他们将访问VNC会话，而没有意识到这一点。而且因为你已经将Firefox设置为kiosk模式，所以用户将看到的只是一个网页，正如预期的那样。</p><p>   Grab the session token from the browser (Right Click &gt; Inspect &gt; Application &gt; Cookies) after the user disconnects</p><p>用户断开连接后，从浏览器中获取会话令牌（右键单击&gt；检查&gt；应用程序&gt；cookie）</p><p>  Or be creative and come up with another way (remember it’s your server).</p><p>或者发挥创意，想出另一种方法（记住这是你的服务器）。</p><p>   Use any cloud service provider to deploy a Linux machine. I’ll be using Ubuntu 20.04 for this demo but of course it can be any other Linux flavour you’re comfortable with.</p><p>使用任何云服务提供商部署Linux机器。我将使用Ubuntu20.04进行这个演示，但当然，它可以是任何你喜欢的其他Linux风格。</p><p>  First we need to install a VNC software. I tested two VNC software: TightVNC &amp; TigerVNC. After various tests I’ve opted to use TigerVNC and you should too as it’ll save you a headache later on. I used  this guide to setup TigerVNC. But if you’re too lazy to read it here’s a TLDR of the commands you need to run:</p><p>首先，我们需要安装一个VNC软件。我测试了两个VNC软件：TightVNC&amp；TigerVNC。经过各种测试后，我选择了使用TigerVNC，你也应该这样做，因为这样以后你就不会头疼了。我用这个指南来设置TigerVNC。但如果你懒得阅读，下面是你需要运行的命令的TLDR：</p><p> sudo apt updatesudo apt install tigervnc-standalone-server tigervnc-xorg-extension tigervnc-viewersudo apt install ubuntu-gnome-desktopsudo systemctl enable gdmsudo systemctl start gdm</p><p>sudo apt updatesudo apt install tigervnc standard server tigervnc xorg extension tigervnc viewersudo apt install ubuntu gnome desktopsudo systemctl enable gdmsudo systemctl start gdm</p><p>      #!/bin/sh# Start Gnome 3 Desktop [ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresourcesvncconfig -iconic &amp;dbus-launch --exit-with-session gnome-session &amp;</p><p>#!/bin/sh#启动Gnome 3桌面[-x/etc/vnc/xstartup]&amp&amp；exec/etc/vnc/xstartup[-r$HOME/.Xresources]&amp&amp；xrdb$HOME/。Xresourcesvncconfig-标志性&amp；dbus启动——退出会话gnome会话&amp；</p><p>   And finally, restart the VNC server. Note that the VNC session will use a fixed screen resolution of 2000x1000. Don’t worry too much about this, noVNC auto scaling will be demonstrated later on in the article.</p><p>最后，重新启动VNC服务器。请注意，VNC会话将使用2000x1000的固定屏幕分辨率。不要太担心这一点，本文稍后将演示noVNC自动缩放。</p><p>     Running noVNC is even easier. There are two options: either run it locally (for testing purposes) or publicly. Both ways are demonstrated below.</p><p>运行noVNC更容易。有两种选择：本地运行（用于测试目的）或公开运行。下面展示了这两种方法。</p><p> # Running it locally# Assumes VNC is running on port 5901# Check port by running vncserver -list./noVNC/utils/novnc_proxy --vnc localhost:5901# To access it locally use a SSH tunnel:ssh -L 6080:127.0.0.1:6080 root@server# Running it publicly on port 80ufw allow http./noVNC/utils/novnc_proxy --vnc 0.0.0.0:5901 --listen 80</p><p>#在本地运行它#假设VNC正在端口5901上运行#通过运行vncserver-list检查端口/noVNC/utils/noVNC_proxy——vnc localhost:5901#要在本地访问它，请使用SSH隧道：SSH-L 6080:127.0.0.1:6080root@server#在端口80ufw上公开运行它允许http/noVNC/utils/noVNC_proxy--vnc 0.0.0.0:5901--listen 80</p><p>  This command will need to be run from within the VNC session or else you’ll get an error stating that the DISPLAY environment variable is not set.</p><p>此命令需要在VNC会话中运行，否则会出现一个错误，表明未设置DISPLAY环境变量。</p><p>    The  autoconnect=true&amp;password=VNCPASSWORD will make the user auto authenticate. noVNC is very flexible. If you’d like to rename the query parameter it’s possible by modifying the  vnc.html file.</p><p>自动连接=真&amp；password=VNCPASSWORD将使用户自动进行身份验证。noVNC非常灵活。如果想重命名查询参数，可以修改vnc。html文件。</p><p>   noVNC displays a custom loading page, a VNC control bar and some additional unnecessary visual items which should be removed. Open  vnc.html then find the divs below and add the shown CSS styling.</p><p>noVNC显示一个自定义加载页面、一个VNC控制栏和一些额外的不必要的视觉项目，这些项目应该被删除。打开vnc。html然后找到下面的div并添加显示的CSS样式。</p><p> &lt;!-- Hide unnecessary items --&gt;&lt;div id=&#34;noVNC_control_bar_anchor&#34; class=&#34;noVNC_vcenter&#34; style=&#34;display:none;&#34;&gt;&lt;div id=&#34;noVNC_status&#34; style=&#34;display:none&#34;&gt;&lt;/div&gt;&lt;!-- Makes the loading page white --&gt;&lt;div id=&#34;noVNC_transition&#34; style=&#34;background-color:white;color:white&#34;&gt;</p><p>&lt；！——隐藏不必要的项目--&gt&书信电报；部门id=&#34；noVNC_控制_杆_锚#34；等级=&#34；noVNC#U vcenter&#34；风格=&#34；显示：无&#34;&gt&书信电报；部门id=&#34；noVNC#U状态&#34；风格=&#34；显示：无&#34&gt&lt/部门&gt&lt；！——使加载页面变为白色--&gt&书信电报；部门id=&#34；noVNC#u过渡&#34；风格=&#34；背景色：白色；颜色：白色和#34&gt；</p><p>   So far what I’ve shown you will get you a single phishing page running which is good enough if you’re planning on spear phishing. But what if you’d like to run a large phishing campaign and require several VNC instances? Remember, you cannot send the same link to different users since they’d be sharing the same VNC session. The solution is quite simple and can be easily automated.</p><p>到目前为止，我向你们展示的内容将使你们运行一个单一的网络钓鱼页面，如果你们计划使用矛式网络钓鱼，这已经足够好了。但是，如果您想运行大型网络钓鱼活动，并需要几个VNC实例，该怎么办？请记住，您不能向不同的用户发送相同的链接，因为他们将共享同一个VNC会话。这个解决方案非常简单，而且可以很容易地实现自动化。</p><p> First, launch X number of instances of TigerVNC. I’ll be keeping it simple and launching 2 instances.</p><p>首先，启动X个TigerVNC实例。我将保持简单，并启动两个实例。</p><p>    The first TigerVNC session (port 5901) will be publicly accessible on port 80. The second TigerVNC session (port 5902) will be publicly accessible on port 81.</p><p>第一个TigerVNC会话（端口5901）将在端口80上公开访问。第二个TigerVNC会话（端口5902）将在端口81上公开访问。</p><p>   Now you can easily access the different sessions by appending the query parameter  &amp;port=80 or  &amp;port=81. A demo is shown below where port 80 has the Gmail login page and port 81 has the Facebook login page.</p><p>现在，通过添加查询参数&amp；端口=80或&amp；端口=81。下面显示了一个演示，其中端口80有Gmail登录页面，端口81有Facebook登录页面。</p><p>   To use noVNC’s auto scale feature simply tag on another query parameter  &amp;resize=remote. The URL would look like this:</p><p>要使用noVNC的自动缩放功能，只需标记另一个查询参数&amp；调整大小=远程。URL如下所示：</p><p>   Don’t forget to disable auto screen lock otherwise a user will click your phishing link and hit a locked screen.</p><p>别忘了禁用自动屏幕锁定，否则用户会点击你的钓鱼链接并点击锁定的屏幕。</p><p>   This technique is not limited to using noVNC as many other solutions offer remote access via the browser such as:</p><p>这种技术不仅限于使用noVNC，因为许多其他解决方案通过浏览器提供远程访问，例如：</p><p>   You are giving remote access to your machine! It should not have anything of value stored on it. Any logged data should proably be sent to a remote machine.</p><p>您正在远程访问您的机器！它不应该存储任何有价值的东西。任何记录的数据都应该被发送到远程机器。</p><p> Don’t use the root account. You should setup a restricted user account that uses the VNC service.</p><p>不要使用root帐户。您应该设置一个使用VNC服务的受限用户帐户。</p><p>  I couldn’t manage to make noVNC work with phones in a pratical way.</p><p>我无法让noVNC以实用的方式使用手机。</p><p>  Browsers are more powerful than ever and the usage of browsers as clients for remote access provides new ways for attackers to steal credentials, bypass 2FA and more. I strongly believe that what I’ve demonstrated in this article is only a small portion of what this technique can be used for. As usual, feel free to build off this technique or provide comments and suggestions on Twitter.</p><p>浏览器比以往任何时候都更强大，浏览器作为远程访问客户端的使用为攻击者窃取凭据、绕过2FA等提供了新的途径。我坚信，我在本文中所展示的只是这项技术的一小部分。和往常一样，你可以随意利用这项技术，或者在Twitter上发表评论和建议。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/浏览器/">#浏览器</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/browser/">#browser</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/vnc/">#vnc</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>