<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>一个新的CloudFlare Web应用程序防火墙 A new Cloudflare Web Application Firewall</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">A new Cloudflare Web Application Firewall<br/>一个新的CloudFlare Web应用程序防火墙 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-30 00:34:07</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/62d96d7c6d2d21fb402163ce44f03d97.png"><img src="http://img2.diglog.com/img/2021/3/62d96d7c6d2d21fb402163ce44f03d97.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>The Cloudflare  Web Application Firewall (WAF) blocks more than 57 billion cyber threats per day. That is 650k blocked HTTP requests per second. The original code that filters this traffic was written by Cloudflare’s now CTO and the WAF has since received many accolades including the  highest score for ability to execute in the 2020 Gartner Magic Quadrant for WAF.</p><p>CloudFlare Web应用防火墙（WAF）每天阻止超过570亿个网络威胁。这是每秒650k阻止HTTP请求。过滤此流量的原始代码由CloudFlare现在编写了CTO，WAF已收到许多招待，包括在2020 Gartner魔法象限中执行的最高分数，以便在WAF的2020 Gartner魔法象限中执行。</p><p> Because we value replacing code when it is no longer as maintainable, performant, or scalable as it once was, we regularly rewrite key parts of the Cloudflare stack. That’s necessary as our enormous growth makes yesterday’s solutions unworkable. For some time, we have been working on replacing that original  LuaJIT code John wrote with new code, written in Rust, along with an improved UI.</p><p> 由于我们重视代码代码，当它不再是可维护，执行或可扩展，我们经常重写CloudFlare堆栈的关键部分。这是必要的，因为我们的巨大增长使昨天的解决方案是不可行的。一段时间，我们一直在替换原始的洛杉矶守则约翰写作新的代码，以锈迹编写，以及改进的UI。</p><p>  Starting today, 10% of newly created accounts on Cloudflare will be given access to the new WAF whenever a Pro plan zone or above is added. This percentage will increase to 100% of new accounts over the month of April, after which migration efforts will commence for existing customers. Enterprise customers may migrate early by contacting their account team.</p><p>  从今天开始，每当添加Pro计划区域或更高时，将在CloudFlare上获得10％的CloudFlare帐户访问新WAF。这一百分比将在4月份的新账户中增加到100％，之后将开始迁移工作，以便为现有客户开始。企业客户可以通过联系他们的帐户团队提前迁移。</p><p>  The Web Application Firewall (WAF) is a core component of the Cloudflare platform. As one of the most used products in the portfolio, we have gained a lot of feedback and experience from running it at scale, that helped guide us in this major iteration. The new WAF brings:</p><p>  Web应用程序防火墙（WAF）是CloudFlare平台的核心组件。作为投资组合中最常用的产品之一，我们已经获得了许多反馈和经验，从规模运行，这有助于指导我们在这一重播中。新的WAF带来：</p><p> Better rule browsing and configuration   - easy one click deploy without losing the power tools: advanced filtering, bulk editing, rule tags and more. Turning on all WordPress rules, setting all Cloudflare Managed Rules to LOG or figuring out which rules are not running is now easy.</p><p> 更好的规则浏览和配置 - 轻松一单击部署而不丢失电动工具：高级过滤，批量编辑，规则标记等。打开所有WordPress规则，将所有CloudFlare托管规则设置为日志或弄清楚哪些规则现在不容易。</p><p> A new matching engine - written in Rust and supporting the  wirefilter syntax - the same syntax used by custom Firewall Rules. This engine will allow us to have faster managed rule deployments and the ability to scale to the next level by allowing the WAF to be deployed on even more traffic. All while improving performance and security.</p><p> 一种新的匹配引擎 - 用Rust编写并支持Wirefilter语法 - 自定义防火墙规则使用的相同语法。此引擎将允许我们具有更快的托管规则部署以及通过允许WAF部署在更多流量上通过允许部署WAF来扩展到下一个级别的能力。所有的同时提高性能和安全性。</p><p> Updated Rulesets        - the new WAF ships with updated rulesets that provide better control separating rule status from action. The Cloudflare OWASP Core Ruleset has also been improved based on the latest version of the OWASP Core Ruleset (v3.3 at time of writing), which adds paranoia levels and improves false positives rates compared to the current version available.</p><p> 更新的规则集 - 具有更新规则集的新WAF船舶，可从操作提供更好的控制分离规则状态。 CloudFlare Owasp核心规则规则还基于最新版本的OWASP核心规则集（写作时的V3.3），这增加了偏执纳级水平并与当前版本的可用版本提高了误报率。 </p><p> Global configuration         - deploy the same configuration across your entire account. Group rules as rulesets and make use of native versioning and rollback capabilities.</p><p>全局配置 - 在整个帐户中部署相同的配置。将组规则作为规则集并使用本机版本控制和回滚功能。</p><p> The list above is only a small subset of the things we are excited about and each point deserves its own post, but here are the highlights.</p><p> 上面的列表只是我们兴奋的东西的一个小的子集，每个点都值得自己的帖子，但这是亮点。</p><p>  The Cloudflare Managed Ruleset, which includes the Cloudflare Specials 1 group, is one of the main components of the WAF. It has several hundred rules that are provided and maintained by Cloudflare. In its default configuration we aim to achieve a very low false positive rate, while providing a very good security baseline for any web application. For the best possible security stance though, you should enable as many rules as possible. This means that, sometimes it’s necessary to deep dive and customise the ruleset behaviour based on the underlying application.</p><p>  CloudFlare管理规则集包括CloudFlare特价1组，是WAF的主要组件之一。它有几百条规则，由CloudFlare提供和维护。在其默认配置中，我们的目标是实现非常低的误率，同时为任何Web应用程序提供非常好的安全基准。虽然，您应该尽可能多的规则。这意味着，有时是基于基础应用程序深度潜入并自定义规则集行为。</p><p> With the new WAF, we wanted to make sure enabling the Managed Ruleset was a one click effort with the default configuration, while allowing a much better configuration experience for those interested.</p><p> 使用新WAF，我们希望确保启用托管规则集是一个单击默认配置的单击努力，同时为那些感兴趣的人提供更好的配置体验。</p><p>  Today, to turn on our Cloudflare Managed Ruleset, you need to enable a global WAF switch and configure any rule groups of interest. The ten rule groups, which include WordPress, Joomla, PHP, and similar, are displayed directly on the page with on/off toggles. This UI does not allow to easily filter or configure rules within those groups without checking each rule individually.</p><p>  今天，要打开我们的CloudFlare托管规则集，您需要启用全局WAF交换机并配置任何统治的兴趣组。包含WordPress，Joomla，PHP和类似的十个规则组将直接显示在页面上，开/关切换。此UI不允许在不单独检查每个规则的情况下轻松过滤或配置规则。</p><p>  Although the UI was simple, it did not allow common tasks to be executed quickly. For example:  show me all rules that are off or  show me all rules mitigating XSS attacks. Now, all rules are displayed in a single table - but filtering by rule status, action and tag is one click away. Rule tags are also replacing groups, and a rule may have one or more tags, making the system a lot more flexible. Tags will be used for:</p><p>  虽然UI很简单，但它不允许快速执行常见任务。例如：向我展示已关注或显示所有规则的所有规则，这些规则都缓解了XSS攻击。现在，所有规则都显示在单个表中 - 但通过规则状态，操作和标记过滤是单击一下。规则标记也替换组，规则可能有一个或多个标签，使系统更灵活。标签将用于：</p><p>  Finally, we are allowing for bulk editing controls in addition to inline single rule controls to allow for faster configuration changes based on specific use cases.</p><p>  最后，除了内联单规则控件之外，我们还允许批量编辑控件，以允许基于特定用例的更快的配置更改。 </p><p>  As we expect the number of rules available to increase, and for more users to adopt custom configurations, we have added a review screen when deploying configuration changes. From here you can easily see any changes from the defaults, and optionally revert them.</p><p>正如我们预期可用于增加的规则数量，并且对于更多用户采用自定义配置，我们在部署配置更改时添加了一个评论屏幕。从这里可以轻松查看默认值的任何更改，并选择恢复它们。</p><p>   The current Cloudflare WAF, responsible for managed ruleset execution, is written in LuaJIT and is implemented as an NGINX module. The rule syntax followed a superset of the syntax implemented by  ModSecurity with added features specific to the Cloudflare implementation.</p><p>   当前CloudFlare WAF负责托管规则集执行，在Luajit中写入，并以NGINX模块实现。规则语法遵循ModSecurity实现的语法的超集，其中包含特定于CloudFlare实现的功能。</p><p>  Exposure of much better filtering and matching capabilities to allow for flexibility of deployment and easier exception handling</p><p>  曝光更好的过滤和匹配能力，以允许部署的灵活性和更容易的异常处理</p><p> Unified product feature set by adopting the wirefilter syntax as the basis for managed rulesets</p><p> 通过采用Wirefilter语法作为托管规则集的基础，设置统一的产品功能</p><p> The last point was especially important not only for us but also for our users because this syntax is already in use for our custom  Firewall Rules, which even uses the same underlying Rust library to execute the filters!</p><p> 最后一点不仅对我们来说尤为重要，而且对我们的用户来说尤其重要，因为这个语法已经用于我们的自定义防火墙规则，这甚至使用相同的底层生锈库来执行过滤器！</p><p> The new engine is implemented in  Rust, which we have talked about how much we love quite a few times before  on this blog. We&#39;re also working on making sure that this new implementation not only comes with safety improvements, but speed improvements as well, the specifics of which we&#39;ll go into in future blog posts.</p><p> 新引擎在锈病中实施，我们谈到了在这篇博客上我们在这件博客之前多次热爱了多少。我们还努力确保这一新的实施不仅具有安全改进，而且速度改进，我们＆＃39的细节也是如此; LL进入未来的博客文章。</p><p>  The Cloudflare rulesets have been updated and ported over to the new WAF. Notably the rulesets now use wirefilter syntax and rule status is separated from rule action, allowing you to configure both independently.</p><p>  CloudFlare规则集已更新并移植到新WAF。值得注意的是，数据集现在使用Wirefilter语法和规则状态与规则操作分离，允许您独立配置。 </p><p> The Cloudflare OWASP Core Ruleset has also received a major update independently from the engine. The current Cloudflare WAF implements a 2.x version of the official  OWASP ModSecurity Core Ruleset. In the new WAF the Cloudflare OWASP Core Ruleset is based directly on the latest 3.3 version available from the  GitHub repository.</p><p>CloudFlare OWASP核心规则集还从发动机独立接收到一个重大更新。当前CloudFlare WAF实现了官方OWASP ModSecurity Core规则集的2.x版本。在新的WAF中，CloudFlare OWASP核心规则集是直接基于GitHub存储库可用的最新3.3版本。</p><p> The new Cloudflare OWASP Core Ruleset, along with added engine features, brings several improvements over the existing one:</p><p> 新的CloudFlare OWASP核心规则集以及增加的引擎功能，带来了几个对现有的改进：</p><p> More control over the sensitivity score, with clear indication of how much each rule contributes to the score and what the total score was on triggered requests</p><p> 更多对灵敏度得分的控制，并清楚地指示每个规则有助于分数的贡献以及总分对触发的请求</p><p> The addition of a  paranoia level - to provide easy inclusion or exclusion or rule groups based on false positive risk</p><p> 添加偏执狂水平 - 根据虚假阳性风险提供易于包含或排除或规则组</p><p>   As part of the efforts to convert the latest version of the OWASP ModSecurity Core Ruleset to its Cloudflare implementation, the team has also built a ModSecurity to wirefilter syntax converter. This will enable us to easily deploy and update the ruleset shortly after any upstream improvements to ensure customers have access to the latest version at all times. We also plan to open source and expose the converter in the UI in the future to make customer migrations from ModSecurity-based WAFs to Cloudflare easier.</p><p>   作为将最新版本的OWASP ModSecurity CoreSet转换为其CloudFlare实现的努力的一部分，该团队还建立了ModSecurity至Wirefilter语法转换器。这将使我们能够在任何上游改进后轻量地部署和更新规则集，以确保客户始终可以访问最新版本。我们还计划在未来开源并在UI中公开转换器，使客户迁移从基于ModSecurity的WAF到CloudFlare更轻松。</p><p>  Cloudflare has operated on a zone-based model for the Cloudflare WAF since the beginning. This serves well for simple use cases where customers are protecting a small number of applications, or a very diverse set of applications on a per-zone basis.</p><p>  由于开始以来，CloudFlare在基于区域的CloudFlare Waf的模型上运行。这适用于客户在客户正在保护少量应用程序的简单用例，或基于每个区域的非常多样化的应用程序。</p><p> More complex or unified deployments across zones are normally implemented by leveraging  the API or automation tools such as our  Cloudflare Terraform Provider.</p><p> 跨区域的更复杂或统一的部署通常通过利用诸如我们的CloudFlare Terraform提供商等API或自动化工具来实现。 </p><p> With the new WAF, ruleset deployments can be made across any arbitrary filter of traffic under a single account. For example:</p><p>使用新的WAF，可以在单个帐户下的任何任意流程过滤器中进行规则集部署。例如：</p><p> Deploy Cloudflare OWASP Core Ruleset on all traffic that does not contain  /api/* in the path.</p><p> 在路径中不包含/ API / *的所有流量上部署CloudFlare OWASP核心规则集。</p><p>   To achieve this, rulesets (group of rules) become a first class concept, and are natively versioned allowing for both rollback and diffing capabilities directly in the UI — features that we plan to start exposing in the coming months.</p><p>   为实现这一目标，规则集（规则组）成为第一类概念，并且本身已在UI中直接允许回滚和差异，我们计划在未来几个月开始暴露在UI中。</p><p> Account-based configurations will initially only be available to Enterprise customers who can now request early access by contacting their account team. Custom Firewall Rules themselves will soon be migrated onto the new engine, allowing for customers to also create their own custom firewall rulesets, and deploy them as needed on any traffic filter.</p><p> 基于帐户的配置最初仅适用于现在可以通过联系其帐户团队请求早期访问的企业客户使用。自定义防火墙规则本身将很快迁移到新引擎上，允许客户创建自己的自定义防火墙规则集，并根据任何流过滤器按照所需部署它们。</p><p>  There is a lot more to the WAF than meets the eye and the team is already busy finalising a set of additional features built on the new WAF — these include improvements to the engine itself, better analytics and visibility into actionable events. The entire engine is in fact designed to be the basis for many of the Cloudflare rule-based products, with the aim of ultimately representing the entire Cloudflare configuration as a set of rules.</p><p>  WAF有很多比符合眼睛，团队已经忙于完成新WAF内置的一套附加功能 - 这些包括改进发动机本身，更好地分析和可操作活动的可见性。事实上，整个引擎是旨在成为许多CloudFlare规则的产品的基础，目的是最终将整个CloudFlare配置作为一组规则。</p><p> In the meantime, we look forward to your feedback and we are excited to see how far we can innovate.</p><p> 与此同时，我们期待您的反馈，我们很高兴看到我们能够创新多远。</p><p> .......  1The Cloudflare Specials are rules written by the Cloudflare security team based on observing and protecting millions of web applications that sit behind the Cloudflare platform.</p><p> ....... 1 CloudFlare特价是CloudFlare安全团队基于观察和保护坐在CloudFlare平台后面的数百万个Web应用程序的规则。 </p><p>  Security Week  WAF  Firewall  Product News</p><p>安全周WAF防火墙产品新闻 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.cloudflare.com/new-cloudflare-waf/">https://blog.cloudflare.com/new-cloudflare-waf/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/规则/">#规则</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>