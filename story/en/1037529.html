<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>未经GDPR同意使用Google Analytics（分析） Using Google Analytics without GDPR consent</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Using Google Analytics without GDPR consent<br/>未经GDPR同意使用Google Analytics（分析） </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-04 21:03:00</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/2cb547aa7caeb70da72ce4e59f2e0cc5.png"><img src="http://img2.diglog.com/img/2020/12/2cb547aa7caeb70da72ce4e59f2e0cc5.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>If you’d rather just copy/paste the code, feel free to jump to “ The final script” section below.</p><p>如果您只想复制/粘贴代码，请随时跳到下面的“最终脚本”部分。</p><p>  I care about my privacy and the privacy of the visitors of this website. For that reason, I had stopped using Google Analytics, as I deemed it too intrusive. But I also wanted to know if people visit this website, and what the most popular pieces of content were on here.</p><p>  我关心我的隐私和本网站访问者的隐私。出于这个原因，我已经停止使用Google Analytics（分析）了，因为我认为它太麻烦了。但是我也想知道人们是否访问了该网站，以及其中最受欢迎的内容是什么。</p><p> If you are in the same boat as me, here is how you can use Google Analytics without invading your users’ privacy.</p><p> 如果您与我同舟共济，这就是在不侵犯用户隐私的情况下如何使用Google Analytics（分析）的方法。</p><p>  Back when I used  Netlify for a project of mine, I used their  Analytics feature, but it costs $9 a month, and you can’t retrieve the analytics data beyond a 30-day window.</p><p>  以前，当我将Netlify用于我的一个项目时，我使用了其Analytics（分析）功能，但每月费用为9美元，而且您无法在30天的时间范围内检索到分析数据。</p><p> There are other options like  Matomo,  Fathom,  Plausible and  Simple Analytics, but none of them offer a free option. Don’t get me wrong, they deserve every penny they get, but I currently cannot afford a monthly fee for my simple analytics needs.</p><p> 还有其他选项，例如Matomo，Fathom，Plusible和Simple Analytics，但没有一个提供免费选项。不要误会我的意思，他们应得的每一分钱，但我目前无法负担我的简单分析需求的月费。</p><p>  I only care about page views and unique visitors, and I don’t want to collect any personally identifiable information. For that reason, I didn’t want to bother my readers with a cookie banner.</p><p>  我只关心网页浏览量和唯一身份访问者，也不想收集任何个人身份信息。因此，我不想用cookie横幅打扰我的读者。</p><p> So, I decided to look into how I can use Google Analytics without the need for a GDPR cookie consent banner.</p><p> 因此，我决定研究如何在无需GDPR Cookie同意横幅的情况下使用Google Analytics（分析）。 </p><p>  Disclaimer: I am not a lawyer, and I know very very little about GDPR. This is a simple blog, and my aim was only to avoid collecting any personally identifiable information from my visitors, as I don’t like it when other sites collect mine.</p><p>免责声明：我不是律师，而且我对GDPR知之甚少。这是一个简单的博客，我的目的只是避免从访问者那里收集任何可识别个人身份的信息，因为当其他网站收集我的信息时，我不喜欢它。</p><p> If you are running a business, and want to make sure you are GDPR compliant, you shouldn’t be getting your information from me.</p><p> 如果您经营的是一家公司，并且想确保自己符合GDPR的要求，那么您不应该从我这里获取信息。</p><p> As far as I can tell, if we’re not collecting any personally identifiable information (e.g. IP) and not storing any tracking cookies, we should be fine. Out of the box, Google Analytics collects IP addresses and sets a tracking cookie with a unique client ID. This is a no go when it comes to GDPR.</p><p> 据我所知，如果我们不收集任何个人身份信息（例如IP），也不存储任何跟踪Cookie，则应该可以。 Google Analytics（分析）开箱即用，可收集IP地址并设置具有唯一客户端ID的跟踪Cookie。在GDPR方面，这是行不通的。</p><p>  &lt;!--  Google  Analytics  --&gt; &lt; script &gt;  ( function ( i , s , o , g , r , a , m ){ i [ &#39; GoogleAnalyticsObject &#39; ] = r ; i [ r ] = i [ r ] || function (){  ( i [ r ]. q = i [ r ]. q || []). push ( arguments )}, i [ r ]. l = 1 * new  Date (); a = s . createElement ( o ),  m = s . getElementsByTagName ( o )[ 0 ]; a . async = 1 ; a . src = g ; m . parentNode . insertBefore ( a , m )  })( window , document , &#39; script &#39; , &#39; https://www.google-analytics.com/analytics.js &#39; , &#39; ga &#39; );  ga ( &#39; create &#39; ,  &#39; UA-XXXXX-Y &#39; ,  &#39; auto &#39; );  ga ( &#39; send &#39; ,  &#39; pageview &#39; ); &lt; /script &gt; &lt;!--  End  Google  Analytics  --&gt;</p><p>  ＆lt;！-Google Analytics（分析）-＆gt; ＆lt;脚本＆gt; （function（i，s，o，g，r，a，m）{i [＆＃39; GoogleAnalyticsObject＆＃39;] = r; i [r] = i [r] || function（）{（i [r]。q = i [r]。q || []）。push（arguments）}，i [r]。l = 1 * new Date（）; a = s。createElement（o），m = s 。getElementsByTagName（o）[0]; a。async = 1; a。src = g; m。parentNode。insertBefore（a，m）}）（window，document，＆＃39; script＆＃39;，＆＃ 39; https://www.google-analytics.com/analytics.js＆＃39;，＆＃39; ga＆＃39;）; ga（＆＃39;创建＆＃39; UA-XXXXX-Y＆＃39;，＆＃39;自动＆＃39;）； ga（＆＃39;发送＆＃39;网页浏览＆＃39;）; ＆lt; /脚本＆gt; ＆lt;！-结束Google Analytics（分析）-＆gt;</p><p>   Telling Google Analytics not to store cookies and to anonymize visitor IPs are very simple. We just need to make the following changes:</p><p>   告诉Google Analytics（分析）不要存储cookie并匿名化访问者IP非常简单。我们只需要进行以下更改：</p><p> // ... ga ( &#39; create &#39; ,  &#39; UA-XXXXX-Y &#39; ,  {  // Don&#39;t store any cookies.  &#39; storage &#39; :  &#39; none &#39; , }); // Anonymize the visitor&#39;s IP. ga ( &#39; set &#39; ,  &#39; anonymizeIp &#39; ,  true ); ga ( &#39; send &#39; ,  &#39; pageview &#39; ); // ...</p><p> // ... ga（＆＃39; create＆＃39;，UA-XXXXX-Y＆＃39;，{//不要存储任何cookie。＆＃39;存储＆＃ 39;：＆＃39; none＆＃39;，}）; //匿名化访问者的IP。 ga（＆＃39; set＆＃39;，anonymizeIp＆＃39;，true）; ga（＆＃39;发送＆＃39;网页浏览＆＃39;）; // ...</p><p>  Now the problem is we are not assigning a unique visitor ID to visitors anymore, and thus Google Analytics can’t tell them apart. If we leave the code like this, all visits would count as a new unique visitor.</p><p>  现在的问题是，我们不再为访问者分配唯一的访问者ID，因此Google Analytics（分析）无法区分他们。如果我们这样保留代码，则所有访问都将被视为新的唯一身份访问者。 </p><p> This might be fine if you only care about page views. If not, we need to create a unique visitor ID that doesn’t contain any personally identifiable information.</p><p>如果您只关心页面浏览量，则可能会很好。如果没有，我们需要创建一个唯一的访问者ID，其中不包含任何个人身份信息。</p><p>  In an article titled  Google Analytics: Cookieless Tracking Without GDPR Consent,  Helge Klein uses the following information to create a unique client ID hash:</p><p>  在标题为Google Analytics（分析）：未经GDPR同意的无Cookie跟踪的文章中，Helge Klein使用以下信息来创建唯一的客户端ID哈希：</p><p>  Getting the website domain, the user agent and the language are simple using JavaScript, and we set the validity days to a number we want. The tricky part here is getting the user’s IP address.</p><p>  使用JavaScript可以轻松获取网站域，用户代理和语言，并且我们将有效期设置为所需的数字。这里最棘手的部分是获取用户的IP地址。</p><p> Unfortunately, there is no way of getting a user’s IP address that I know of using only JavaScript.</p><p> 不幸的是，我无法仅使用JavaScript来获取用户的IP地址。</p><p>  In his article, Helge uses the fact that he controls the server that serves his website, so he embeds the visitor IP in the script that’s served to the visitor.</p><p>  Helge在他的文章中利用了以下事实：他控制着为自己的网站提供服务的服务器，因此他将访问者IP嵌入到提供给访问者的脚本中。</p><p> I am using  GitHub Pages for this website, so I didn’t have the option to do so. The best way I found to get a user’s IP address is to call the following address from  Cloudflare  1:</p><p> 我正在为此网站使用GitHub Pages，所以我没有选择。我发现获得用户IP地址的最好方法是从Cloudflare调用以下地址：</p><p>    We can easily get the IP from this response with a simple regular expression, such as  /ip=([\d.]*)\n/.</p><p>    我们可以使用简单的正则表达式从该响应中轻松获取IP，例如/ip=([\d.]*)\n/。 </p><p>   &lt;!--  Google  Analytics  --&gt; &lt; script &gt;  // Based on https://helgeklein.com/blog/2020/06/google-analytics-cookieless-tracking-without-gdpr-consent/   // and https://stackoverflow.com/a/52171480.  const  cyrb53  =  function  ( str ,  seed  =  0 )  {  let  h1  =  0xdeadbeef  ^  seed ,  h2  =  0x41c6ce57  ^  seed ;  for  ( let  i  =  0 ,  ch ;  i  &lt;  str . length ;  i ++ )  {  ch  =  str . charCodeAt ( i );  h1  =  Math . imul ( h1  ^  ch ,  2654435761 );  h2  =  Math . imul ( h2  ^  ch ,  1597334677 );  }  h1  =  Math . imul ( h1  ^  h1  &gt;&gt;&gt;  16 ,  2246822507 )  ^  Math . imul ( h2  ^  h2  &gt;&gt;&gt;  13 ,  3266489909 );  h2  =  Math . imul ( h2  ^  h2  &gt;&gt;&gt;  16 ,  2246822507 )  ^  Math . imul ( h1  ^  h1  &gt;&gt;&gt;  13 ,  3266489909 );  return  4294967296  *  ( 2097151  &amp;  h2 )  +  ( h1  &gt;&gt;&gt;  0 );  };  // If your website is served through Cloudflare, you can use   // &#34;/cdn-cgi/trace&#34; instead.  fetch ( &#34; https://www.cloudflare.com/cdn-cgi/trace &#34; )  . then (( response )  =&gt;  response . text ())  . then (( text )  =&gt;  {  // We get the client IP here.  const  clientIP  =  text . match ( /ip= ([\d . ] * )\n / )[ 1 ];  // The validity interval is set to four days.  const  validityInterval  =  Math . round ( new  Date ()  /  1000  /  3600  /  24  /  4 );  // We combine all the information in a string.  const  clientIDSource  =  clientIP  +  &#34; ; &#34;  +  window . location . host  +  &#34; ; &#34;  +  navigator . userAgent  +  &#34; ; &#34;  +  navigator . language  +  &#34; ; &#34;  +  validityInterval ;  // And here we create a hash from the string.  const  clientIDHashed  =  cyrb53 ( clientIDSource ). toString ( 16 );  ( function ( i , s , o , g , r , a , m ){ i [ &#39; GoogleAnalyticsObject &#39; ] = r ; i [ r ] = i [ r ] || function (){  ( i [ r ]. q = i [ r ]. q || []). push ( arguments )}, i [ r ]. l = 1 * new  Date (); a = s . createElement ( o ),  m = s . getElementsByTagName ( o )[ 0 ]; a . async = 1 ; a . src = g ; m . parentNode . insertBefore ( a , m )  })( window , document , &#39; script &#39; , &#39; https://www.google-analytics.com/analytics.js &#39; , &#39; ga &#39; );  // Don&#39;t forget to replace this with your tracking ID.  ga ( &#39; create &#39; ,  &#39; UA-XXXXX-Y &#39; ,  {  // Don&#39;t store any cookies.  &#39; storage &#39; :  &#39; none &#39; ,  // We send our hash as the client ID.  &#39; clientId &#39; :  clientIDHashed ,  });  // Anonymize the visitor&#39;s IP.  ga ( &#39; set &#39; ,  &#39; anonymizeIp &#39; ,  true );  ga ( &#39; send &#39; ,  &#39; pageview &#39; );  }) &lt; /script &gt; &lt;!--  End  Google  Analytics  --&gt;</p><p>＆lt;！-Google Analytics（分析）-＆gt; ＆lt;脚本＆gt; //基于https://helgeklein.com/blog/2020/06/google-analytics-cookieless-tracking-without-gdpr-consent/ //和https://stackoverflow.com/a/52171480。 const cyrb53 =函数（str，seed = 0）{设h1 = 0xdeadbeef ^种子，h2 = 0x41c6ce57 ^种子; for（令i = 0，ch; i＆lt; str.length; i ++）{ch = str。 charCodeAt（i）; h1 =数学。 imul（h1 ^ ch，2654435761）; h2 =数学。 imul（h2 ^ ch，1597334677）; } h1 =数学。 imul（h1 ^ h1＆gt;＆gt; 16，2246822507）数学。 imul（h2 ^ h2> 13，3266489909）； h2 =数学。 imul（h2 ^ h2＆gt;＆gt; 16，2246822507）数学。 imul（h1 ^ h1＆gt;＆gt; 13，3266489909）;返回4294967296 *（2097151＆amp; h2）+（h1＆gt;＆gt; 0）; }; //如果您的网站是通过Cloudflare服务的，则可以使用//＆＃34; / cdn-cgi / trace＆＃34;代替。获取（＆＃34; https://www.cloudflare.com/cdn-cgi/trace＆＃34;）。然后（（response）=＆gt; response。text（））。然后（（text）=＆gt; {//我们在这里获取客户端IP。const clientIP = text。match（/ ip =（[\ d。] *）\ n /）[1]; //有效间隔为设置为四天const validInterval = Math。round（new Date（）/ 1000/3600/24/4）; //我们将所有信息组合成一个字符串const clientIDSource = clientIP +＆＃34;;＆＃34 ; +窗口。位置。主机+＆＃34;;＆＃34; +导航器userAgent +＆＃34;;＆＃34; +导航器语言+＆＃34;;＆＃34; + validationInterval; //在这里，我们从字符串创建一个哈希值。const clientIDHashed = cyrb53（clientIDSource）。toString（16）;（function（i，s，o，g，r，a，m）{i [＆＃39; GoogleAnalyticsObject＆＃ 39;] = r; i [r] = i [r] || function（）{（i [r]。q = i [r]。q || []）。push（arguments）}，i [r ]。l = 1 * new Date（）; a = s。createElement（o），m = s。getElementsByTagName（o）[0]; a。async = 1; a。src = g; m。parentNode。insertBefore（ a，m）}）（窗口，文档，＆＃39;脚本＆＃39; ，＆＃39; https://www.google-analytics.com/analytics.js＆＃39; ，＆＃39; ga＆＃39; ）; //不要忘记将其替换为您的跟踪ID。 ga（＆＃39; create＆＃39; UA-XXXXX-Y＆＃39;，{//不要存储任何cookie。＆＃39;存储＆＃39;：＆＃39 39; none＆＃39;，//我们将哈希作为客户端ID发送。＆＃39; clientId＆＃39;：clientIDHashed，}）; //匿名化访问者的IP。 ga（＆＃39; set＆＃39;，anonymizeIp＆＃39;，true）; ga（＆＃39;发送＆＃39;网页浏览＆＃39;）; }）＆lt; /脚本＆gt; ＆lt;！-结束Google Analytics（分析）-＆gt;</p><p> And, this is it. Replace your current Google Analytics script with this, and you’re good to go.</p><p> 而且，就是这样。以此替换您当前的Google Analytics（分析）脚本，就可以了。</p><p> I couldn’t find a terms of use for this resource, so use it at your own risk. If you’d rather use another provider for this, there is  a great answer by T. H. Doan on Stack Overflow with many options.  ↩</p><p> 我找不到此资源的使用条款，因此使用后果自负。如果您愿意为此使用其他提供程序，那么T. H. Doan在Stack Overflow上有很多选择的一个很好的答案。 ↩ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/analytics/">#analytics</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/分析/">#分析</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>