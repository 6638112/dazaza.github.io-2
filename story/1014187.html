<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用GitHub操作做蠢事</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">使用GitHub操作做蠢事</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-26 04:42:04</div><div class="page_narrow text-break page_content"><p>分类：标签：TL；DR：DevOps不一定只是工作而不是娱乐。我做了5个愚蠢的(但很有趣！)。GiHub操作…。有何不可呢？</p><p>这些操作的完整代码都可以在这个GitHub资源库中找到。我鼓励您用您自己不切实际的行动来分叉和/或添加问题/公关！</p><p>我还在YouTube上录制了一段关于这个项目的视频。←如果您对这类东西感兴趣，请查看视频并订阅🙏。</p><p>GitHub Actions是GitHub内置的CI/CD平台。它可用于自动化构建、测试和部署代码等工作，并可由任何GitHub事件触发。</p><p>还有一个市场，开发人员可以在这里发布他们的操作供其他人使用。</p><p>虽然我使用过许多CI/CD系统，包括Jenkins、Google Cloud Build和CircleCI，但在此项目之前，我没有研究过GitHub操作，所以我想我应该尝试一下，并在此过程中获得一些乐趣。</p><p>从第一个操作开始，我利用可以按cron计划触发操作这一事实来创建以下10行操作：</p><p>名称：假日-提醒-新年快乐-新年开始：日程安排：-cron：&#39；0 0 1 1*&#39；作业：快乐-新年：运行：Ubuntu-最新步骤：-名称：抛出错误运行：退出1</p><p>该操作将在元旦午夜运行，每次都会因为退出代码非零而失败。这将导致gihub给我发送一封电子邮件，祝我新年快乐🎉🎉🎉。</p><p>下一个想法是由一位朋友和以前的同事(https://scotchka.github.io/).)提出的。他建议我做一个自己触发的动作，这样就创造了一个无限的动作链。</p><p>鉴于GitHub文档明确声明“为了最小化GitHub操作的使用成本，请确保您不会创建递归或意外的工作流运行，这似乎是一个非常愚蠢的想法。为了实现这一点，我创建了一个由提交触发的操作，该操作进行并提交自己的代码更改。</p><p>GitHub通过不触发基于与默认GitHub_Token关联的事件的操作来帮助防止用户意外执行此操作。为了解决这个问题，我创建了个人访问令牌。有关如何使用它，请参阅操作YAML文件。</p><p>为了防止无限动作链，我在repo中的一个文件中保存了动作执行的计数，并在每次执行时递增。这允许我在达到指定限制时终止操作链。</p><p>COUNTER_FILE=./RECURSIVE/COUNTER.txtMAX_COUNT=5count=$(CAT&#34；$COUNTER_FILE&#34；)如果(($COUNT&&gt;；$MAX_COUNT))；则ECHO&#34；计数过高...。正在退出，否则请数数...。继续&#34；；ECHO$(($count+1))&gt；$count_file git config--全局用户.email&#34；[电子邮件受保护]&#34；git config--全局用户.name&#34；sid&#34；git add$counter_file git Commit-m&#34；递增计数器文件&#34；git推送FI；</p><p>前面的操作可能会无限期运行，但一次只执行一个实例，因此可以在必要时手动停止。如果相反，该操作自身触发了多次怎么办？这样，如果情况失控，指数增长的😰将无法阻止。听起来很傻，…。让我们开始吧！</p><p>以前的文件计数器技巧不再起作用，因为多个操作将并行执行，所有操作都试图同时修改和提交，从而导致冲突。相反，我将状态存储在Git标记中！</p><p>随机的UUID用作标签的基础，并附加当前迭代以防止冲突。目前的实现只支持个位数，但是如果我超过了9次指数增长的迭代，那就意味着我搞砸了💀。</p><p>函数INCREMENT_TAG_PUSH{uuid=$(Uuidgen)suffix=$(($count+1))tag=$1.$uuid.$suffix git tag-a$tag-m&#34；新uuid tag&#34；git推送原点$tag}count=&#34；$(echo-n$giHub_ref|ail-c 1)&#34；echo$GitHub_REFecho$countsleep 10#以防万一。数得太多了..。正在退出，否则请数数...。继续&#34；；git config--全局用户。电子邮件&34；[电子邮件受保护]&#34；git配置--全局用户.name&34；sid&34；for((i=1；i&lt；=$1；i++))；执行增量标记推送$I完成FI；</p><p>如果您正在寻找一种快速烧毁2000免费层分钟的方法，请使用…。这绝对是要走的路！</p><p>到目前为止，这些操作都是在小型bash脚本中实现的。为了真正探索GitHub操作的功能，我决定下一个操作应该使用Docker。</p><p>我有两个VeSync的WiFi智能插头，这是我几年前收到的礼物，我为他们的API找到了一个Python客户端。这使得创建一个在每次提交后短时间内打开灯的操作变得很简单(还有什么更好的方式来激励代码速度呢？！💡)。</p><p>这段代码并不特别有趣，但是因为该操作使用的不仅仅是bash，所以它需要一个action.yml文件，在该文件中我们可以看到输入是如何传递到该操作的：</p><p>名称：&#39；打开灯光&#39；描述：&#39；打开智能家居灯几秒钟&#39；输入：VESYNC_PASS：描述：VESYNC_PASS所需的密码：TRUE运行：使用：&#39；docker&#39；image：&#39；Dockerfile&#39；env：VESYNC_PASS：${{inputs.VESYNC_PASS}}。</p><p>当团队开始有点精疲力竭，不得不不断地编写代码来保持灯光亮起时，我决定实现一个Tic-Tac-Toe游戏，让他们燃烧一些动力。诀窍是这个游戏的计算机玩家在一个动作中执行！</p><p>我想尝试一下Javascript运行时，所以我用Node构建了游戏，将棋盘状态保存在一个文本文件中。由于这个游戏的目的是了解动作，计算机的策略是随机的，但这还有一个额外的好处，那就是让人类获胜，提振士气🤔。</p><p>总体而言，GitHub操作被证明是相当容易使用的，并且选项Dockerize the action step确保它应该能够支持几乎任何CI/CD需求。此外，GitHub还通过Marketplace将动作的共享和重用作为体验的核心部分。</p><p>虽然我不会急于将现有的CI/CD工作负载移植到GitHub Actions上，但我肯定会考虑将其用于未来的新建项目！</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://devopsdirective.com/posts/2020/07/stupid-github-actions/">https://devopsdirective.com/posts/2020/07/stupid-github-actions/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/github/">#github</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/stuff/">#stuff</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/操作/">#操作</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1012926.html"><img src="http://img.diglog.com/img/2020/7/thumb_0de2b4bb206b074b4c97c055a9b9e90e.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012926.html">GitHub将21TB开源代码埋藏在北极金库1k年</a></div><span class="my_story_list_date">2020-7-20 3:37</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012660.html"><img src="http://img.diglog.com/img/2020/7/thumb_d1cd60bc19582b09fce08f71de753636.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012660.html">GitHub将巨型开源档案埋葬在北极金库</a></div><span class="my_story_list_date">2020-7-18 7:36</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012585.html"><img src="http://img.diglog.com/img/2020/7/thumb_210147255866cb3d78056bcf2e663e29.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012585.html">各种项目贡献者的观察者：带GitHub操作的GraphQL</a></div><span class="my_story_list_date">2020-7-18 2:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012352.html"><img src="http://img.diglog.com/img/2020/7/thumb_0773ac1aa6337727659aa67c04bd70a0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012352.html">GitHub北极代码库</a></div><span class="my_story_list_date">2020-7-17 2:13</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>