<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>基于Nginx的媒体流服务器 Nginx-Based Media Streaming Server</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Nginx-Based Media Streaming Server<br/>基于Nginx的媒体流服务器 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-13 00:07:14</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/48d30e8be477597ec593197fac475f00.png"><img src="http://img2.diglog.com/img/2020/12/48d30e8be477597ec593197fac475f00.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Advanced buffering techniquesto keep memory allocations at a minimumlevel for faster streaming and lowmemory footprint</p><p>先进的缓冲技术可将内存分配保持在最低水平，以实现更快的流传输和低内存占用</p><p>          The &#34;dev&#34; branch is the one where all contributions will be merged before reaching &#34;master&#34;.If you plan to propose a patch, please commit into the &#34;dev&#34; branch or its own feature branch.Direct commit to &#34;master&#34; are not permitted.</p><p>          ＆＃34; dev＆＃34;分支是所有贡献都将在到达＆＃34; master＆＃34;之前被合并的分支。如果您打算提出补丁，请提交到＆＃34; dev＆＃34;分支或自己的功能分支。直接提交给＆＃34; master＆＃34;不允许。</p><p>         This NGINX-RTMP module does not support multi-worker livestreaming. While this feature can be enabled through rtmp_auto_push on|off directive, it is ill advised because it is incompatible with NGINX versions starting 1.7.2 and up, there for it should not be used.</p><p>         此NGINX-RTMP模块不支持多人实时直播。尽管可以通过rtmp_auto_push on | off指令启用此功能，但不建议使用此功能，因为它与从1.7.2及更高版本开始的NGINX版本不兼容，因此不应使用它。</p><p>  rtmp { server { listen 1935; chunk_size 4000; # TV mode: one publisher, many subscribers application mytv { # enable live streaming live on; # record first 1K of stream record all; record_path /tmp/av; record_max_size 1K; # append current timestamp to each flv record_unique on; # publish only from localhost allow publish 127.0.0.1; deny publish all; #allow play all; } # Transcoding (ffmpeg needed) application big { live on; # On every published stream run this command (ffmpeg) # with substitutions: $app/${app}, $name/${name} for application &amp; stream name. # # This ffmpeg call receives stream from this application &amp; # reduces the resolution down to 32x32. The stream is the published to # &#39;small&#39; application (see below) under the same name. # # ffmpeg can do anything with the stream like video/audio # transcoding, resizing, altering container/codec params etc # # Multiple exec lines can be specified. exec ffmpeg -re -i rtmp://localhost:1935/$app/$name -vcodec flv -acodec copy -s 32x32 -f flv rtmp://localhost:1935/small/${name}; } application small { live on; # Video with reduced resolution comes here from ffmpeg } application webcam { live on; # Stream from local webcam exec_static ffmpeg -f video4linux2 -i /dev/video0 -c:v libx264 -an -f flv rtmp://localhost:1935/webcam/mystream; } application mypush { live on; # Every stream published here # is automatically pushed to # these two machines push rtmp1.example.com; push rtmp2.example.com:1934; } application mypull { live on; # Pull all streams from remote machine # and play locally pull rtmp://rtmp3.example.com pageUrl=www.example.com/index.html; } application mystaticpull { live on; # Static pull is started at nginx start pull rtmp://rtmp4.example.com pageUrl=www.example.com/index.html name=mystream static; } # video on demand application vod { play /var/flvs; } application vod2 { play /var/mp4s; } # Many publishers, many subscribers # no checks, no recording application videochat { live on; # The following notifications receive all # the session variables as well as # particular call arguments in HTTP POST # request # Make HTTP request &amp; use HTTP retcode # to decide whether to allow publishing # from this connection or not on_publish http://localhost:8080/publish; # Same with playing on_play http://localhost:8080/play; # Publish/play end (repeats on disconnect) on_done http://localhost:8080/done; # All above mentioned notifications receive # standard connect() arguments as well as # play/publish ones. If any arguments are sent # with GET-style syntax to play &amp; publish # these are also included. # Example URL: # rtmp://localhost/myapp/mystream?a=b&amp;c=d # record 10 video keyframes (no audio) every 2 minutes record keyframes; record_path /tmp/vc; record_max_frames 10; record_interval 2m; # Async notify about an flv recorded on_record_done http://localhost:8080/record_done; } # HLS # For HLS to work please create a directory in tmpfs (/tmp/hls here) # for the fragments. The directory contents is served via HTTP (see # http{} section in config) # # Incoming stream must be in H264/AAC. For iPhones use baseline H264 # profile (see ffmpeg example). # This example creates RTMP stream from movie ready for HLS: # # ffmpeg -loglevel verbose -re -i movie.avi -vcodec libx264 # -vprofile baseline -acodec libmp3lame -ar 44100 -ac 1 # -f flv rtmp://localhost:1935/hls/movie # # If you need to transcode live stream use &#39;exec&#39; feature. # application hls { live on; hls on; hls_path /tmp/hls; } # MPEG-DASH is similar to HLS application dash { live on; dash on; dash_path /tmp/dash; } }}# HTTP can be used for accessing RTMP statshttp { server { listen 8080; # This URL provides RTMP statistics in XML location /stat { rtmp_stat all; # Use this stylesheet to view XML as web page # in browser rtmp_stat_stylesheet stat.xsl; } location /stat.xsl { # XML stylesheet to view RTMP stats. # Copy stat.xsl wherever you want # and put the full directory path here root /path/to/stat.xsl/; } location /hls { # Serve HLS fragments types { application/vnd.apple.mpegurl m3u8; video/mp2t ts; } root /tmp; add_header Cache-Control no-cache; } location /dash { # Serve DASH fragments root /tmp; add_header Cache-Control no-cache; } }}</p><p>  rtmp {服务器{听1935; chunk_size 4000; ＃电视模式：一个发布者，许多订阅者应用程序mytv {＃启用实时流直播； ＃记录流的第一个1K记录全部； record_path / tmp / av; record_max_size 1K; ＃将当前时间戳附加到每个flv record_unique上； ＃仅从本地主机发布允许发布127.0.0.1;拒绝发布所有内容； ＃允许全部播放； }＃转码（需要ffmpeg）应用程序大{继续； ＃在每个已发布的流上运行以下命令（ffmpeg）＃替换为：$ app / $ {app}，$ name / $ {name}用于应用程序＆amp;流名称。 ＃＃此ffmpeg调用从该应用程序接收流＆amp; ＃将分辨率降低到32x32。流已发布到＃＆＃39; small＆＃39;相同名称的应用程序（见下文）。 ＃＃ffmpeg可以对流执行任何操作，例如视频/音频＃代码转换，调整大小，更改容器/编解码器参数等＃＃可以指定多个exec行。 exec ffmpeg -re -i rtmp：// localhost：1935 / $ app / $ name -vcodec flv -acodec copy -s 32x32 -f flv rtmp：// localhost：1935 / small / $ {name}; }应用小{继续； ＃分辨率降低的视频来自ffmpeg}应用程序网络摄像头{直播； ＃来自本地网络摄像头的流exec_static ffmpeg -f video4linux2 -i / dev / video0 -c：v libx264 -an -f flv rtmp：// localhost：1935 / webcam / mystream; }应用程序mypush {继续； ＃在这里发布的每个流＃自动推送到＃这两台机器都推送rtmp1.example.com;推送rtmp2.example.com:1934; }应用程序mypull {继续； ＃从远程计算机中提取所有流＃并在本地播放拉rtmp：//rtmp3.example.com pageUrl = www.example.com / index.html; }应用程序mystaticpull {继续； ＃从nginx开始拉动开始静态拉动rtmp：//rtmp4.example.com pageUrl = www.example.com / index.html name = mystream static; }＃视频点播应用程序vod {播放/ var / flvs; }应用vod2 {播放/ var / mp4s; }＃许多发布者，许多订阅者＃没有支票，没有录制应用程序视频聊天{继续； ＃以下通知接收所有＃会话变量以及＃HTTP POST中的特定调用参数＃请求＃进行HTTP请求＆amp;使用HTTP retcode＃决定是否允许通过此连接发布＃on_publish http：// localhost：8080 / publish； ＃与播放on_play http：// localhost：8080 / play相同； ＃发布/播放结束（断开连接时重复）on_done http：// localhost：8080 / done; ＃上面提到的所有通知都接收＃标准的connect（）参数以及＃播放/发布参数。如果发送了任何参数，则使用GET样式语法＃发布＃这些也包括在内。 ＃示例网址：＃rtmp：// localhost / myapp / mystream？a = b＆amp; c = d＃每2分钟记录10个视频关键帧（无音频）；每2分钟记录一次关键帧； record_path / tmp / vc; record_max_frames 10; record_interval 2m; ＃异步通知记录在fl_on_record_done http：// localhost：8080 / record_done上的flv; }＃HLS＃为使HLS正常工作，请在tmpfs中创建一个目录（此处为/ tmp / hls）。目录内容通过HTTP提供（请参阅config中的＃http {}部分）＃＃传入流必须位于H264 / AAC中。对于iPhone，请使用基线H264＃配置文件（请参阅ffmpeg示例）。 ＃此示例从可用于HLS的电影创建RTMP流：＃＃ffmpeg -loglevel详细-re -i movie.avi -vcodec libx264＃-vprofile基线-acodec libmp3lame -ar 44100 -ac 1＃-f flv rtmp：// localhost ：1935 / hls / movie＃＃如果您需要转码实时流，请使用＆＃39; exec＆＃39;特征。 ＃application hls {继续； hls; hls_path / tmp / hls; }＃MPEG-DASH类似于HLS应用程序dash {live on;冲刺dash_path / tmp / dash; ＃HTTP可用于访问RTMP统计信息http {服务器{监听8080; ＃该URL在XML位置/ stat {rtmp_stat all; ＃使用此样式表在浏览器rtmp_stat_stylesheet stat.xsl中将XML作为网页查看。 } location /stat.xsl {＃XML样式表，用于查看RTMP统计信息。 ＃将stat.xsl复制到任意位置＃并将完整目录路径放在此处root /path/to/stat.xsl/; } location / hls {＃服务HLS片段类型{application / vnd.apple.mpegurl m3u8; video / mp2t ts; } root / tmp; add_header缓存控制无缓存； } location / dash {＃提供DASH片段根目录/ tmp; add_header缓存控制无缓存； }}} </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/sergey-dryabzhinsky/nginx-rtmp-module">https://github.com/sergey-dryabzhinsky/nginx-rtmp-module</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/媒体/">#媒体</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/based/">#based</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/rtmp/">#rtmp</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>