<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>SWIFT系统现在是开源的</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">SWIFT系统现在是开源的</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-26 03:09:02</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/e7117e2db671fcdebcea09e106639103.png"><img src="http://img2.diglog.com/img/2020/9/e7117e2db671fcdebcea09e106639103.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>今年6月，苹果推出了SWIFT系统，这是一个面向苹果平台的新库，为系统调用和低级货币类型提供惯用的接口。今天，我很兴奋地宣布，我们是开源系统，并且增加了对Linux的支持！我们的愿景是让系统最终成为所有支持的SWIFT平台的低级系统接口的单一主页。</p><p>今天的大多数操作系统都支持用C编写的某些风格的系统接口，这些接口已经存在了几十年。虽然可以直接从SWIFT使用这些API，但这些从C导入的弱类型系统接口可能容易出错且笨重。例如，open系统调用(在类UNIX操作系统(如Linux和Apple平台)上可用)作为一对全局函数导入：</p><p>函数打开(_path：UnsafePointer&lt；CChar&&gt;；，_Oflag：Int32)-&gt；Int32函数打开(_path：UnsafePointer&lt；CChar&gt；，_Oflag：Int32，_mode：mode_t)-&gt；Int32。</p><p>这些弱类型函数有几个缺点，无法利用SWIFT的表现力和类型安全性：</p><p>Oflag参数实际上是一种文件访问模式和任意数量的标志的逻辑“或”运算，但是Oflag类型没有捕获到这一点。</p><p>Open的调用者必须记住检查是否有指示错误的负返回值，如果是，则检查全局变量errno的值，以了解发生了什么错误。此外，如果出现信号，可能会取消一些系统调用，要求调用者记住在这些调用周围编写一个循环来检查EINTR错误。</p><p>文件路径是非托管指针，如果它们派生自托管对象(例如Array&lt；CChar&gt；)，则调用方必须确保数组始终以NULL结尾。</p><p>API的签名中没有捕捉到这些语义规则，从而阻止编程语言引导用户正确使用API。</p><p>系统模块利用各种语言功能来提高表现力，并消除这些出错的机会。例如，SYSTEM将OPEN系统调用定义为在FileDescriptor命名空间中具有默认参数的静态函数：</p><p>Extension FileDescriptor{/打开或创建用于读取或写入的文件。/-参数：/-path：要打开的文件位置。/-mode：要使用的读写权限。/-Options：打开文件的行为。/-权限：创建的文件要使用的文件权限。/-retryOnInterrupte：是否重试打开操作/如果抛出`Errno.interrupted`。/默认为`true`。/传入`false`只试一次，中断抛错。/-返回：打开文件的文件描述符/对应的C函数为`open`。公共静态函数打开(_path：FilePath，_mode：FileDescriptor。AccessMode，Options：FileDescriptor。OpenOptions=文件描述符。OpenOptions()，权限：FilePermission？=nil，retryOnInterrupt：Bool=true)抛出-&gt；FileDescriptor}。</p><p>如果将此版本的Open与C语言中的原始版本进行比较，会发现几个显著的差异：</p><p>系统普遍使用原始的可表示结构和选项集。这些强类型有助于在编译时捕获错误，并且与较弱的C类型之间的转换非常简单。</p><p>错误是使用标准语言机制抛出的，不能遗漏。此外，所有可被信号中断的系统调用都采用一个defaulted-true retryOnInterrupt参数，导致它们在失败时重试。结合使用时，这两个更改将极大地简化错误和信号处理。</p><p>FilePath是一个托管的、以NULL结尾的字节包，它符合ExpressibleByStringWrital-使用起来比使用UnsafePointer&lt；CChar&gt；安全得多。</p><p>结果是代码读起来和行为都像惯常的SWIFT一样。例如，此代码从字符串文字创建文件路径，并使用该路径打开日志文件并将其追加到日志文件：</p><p>让message：string=&#34；Hello，world！&#34；+&#34；\n&#34；let path：FilePath=&#34；/tmp/log&#34；let fd=try FileDescriptor。打开(路径、.。只写，选项：[。附加、。创建]，权限：。OwnerReadWrite)尝试使用FD。关闭后{_=尝试FD。WriteAll(消息。UTF8)}</p><p>系统是多平台的库，不是跨平台的库。它在每个支持的平台上提供一组单独的API和行为，紧密反映底层操作系统接口。单次导入将引入特定于目标操作系统的本机平台界面。</p><p>我们的直接目标是简化跨平台库和应用程序的构建，例如SwiftNIO和SWIFT Package Manager。系统不会消除#if os()条件条件来实现跨平台抽象的需要，但是它确实使填充特定于平台的部分变得更安全和更具表现力。</p><p>系统还处于初级阶段-它目前包括少量的系统调用、货币类型和便利功能。作为扩大API覆盖范围的努力的一部分，我们将努力在SWIFT包管理器中采用系统。这将包括对FilePath的增强，以及添加对Windows上最近发布的SWIFT的支持。</p><p>还有一大堆激动人心的工作要做。系统(特别是即将推出的Windows支持！)。是参与SWIFT项目并帮助其成长为强大、充满活力的跨平台生态系统的绝佳机会。</p><p>请随时在SWIFT论坛的相关帖子中询问有关此帖子的问题。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://swift.org/blog/swift-system/">https://swift.org/blog/swift-system/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/开源/">#开源</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/系统/">#系统</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/system/">#system</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1026055.html"><img src="http://img2.diglog.com/img/2020/9/thumb_e71426729618c8ad02b61516ba56e387.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1026055.html">“失忆：黑暗降临”和“猪的机器”现在都是开源的。</a></div><span class="my_story_list_date">2020-9-24 9:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1025992.html"><img src="http://img2.diglog.com/img/2020/9/thumb_fdc5a682e0d609c991ab338957ea7bb4.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1025992.html">社交媒体分析工具包：追踪虚假信息的开源工具</a></div><span class="my_story_list_date">2020-9-24 4:34</span></div><div class="col-sm"><div><a target="_blank" href="/story/1025921.html"><img src="http://img2.diglog.com/img/2020/9/thumb_97612be9553c55c55813f3f0bf50bbaa.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1025921.html">谷歌表示，开发者现在可以使用其开源UI框架Ffltter来开发目前处于Alpha版本的Windows应用程序，并支持Windows7和更新版本</a></div><span class="my_story_list_date">2020-9-24 0:9</span></div><div class="col-sm"><div><a target="_blank" href="/story/1025851.html"><img src="http://img2.diglog.com/img/2020/9/thumb_839d1b8a442b1d08322ab7ebbaa7e3b8.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1025851.html">
在创建Traefik应用程序代理五年后，开源项目的下载量达到2B次</a></div><span class="my_story_list_date">2020-9-23 20:36</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>