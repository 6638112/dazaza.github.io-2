<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>告别跨站点和域的资源缓存</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">告别跨站点和域的资源缓存</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-26 21:53:35</div><div class="page_narrow text-break page_content"><p>When I started doing web development, we all loaded jQuery from the official global jQuery CDN.</p><p>当我开始做web开发时，我们都从官方的全球jQuery CDN加载了jQuery。</p><p> The idea was straightforward: if everybody loads the same jQuery script file ( cdn.jquery.com/jquery.latest.js – or whatever URL it was back then), then the script file would be cached by the browsers, and other sites requesting the same script would benefit from the speedup of already cached resources. Users would have popular libraries like jQuery already sitting in their browser cache because earlier visited sites requested them.</p><p>这个想法很简单：如果每个人都加载相同的jQuery脚本文件(cdn.jquery.com/jquery.latest.js-或当时的任何URL)，那么该脚本文件将由浏览器缓存，而其他请求相同脚本的站点将受益于已缓存资源的加速。用户可能已经在浏览器缓存中拥有像jQuery这样的受欢迎的库，因为之前访问过的站点需要它们。</p><p> This caching behavior was possible because, at the time, the browser&#39;s HTTP caches used the asset URL ( cdn.jquery.com/jquery.latest.js) as a single cache key. Browsers use cache keys to figure out if and how to cache a resource. If these keys only consist of the resource URL, it allows the reuse of resources across sites and domains.</p><p>这种缓存行为之所以可能，是因为当时浏览器的HTTP缓存使用资产URL(cdn.jquery.com/jquery.latest.js)作为单个缓存键。浏览器使用缓存键来确定是否以及如何缓存资源。如果这些键仅由资源URL组成，则允许跨站点和域重用资源。</p><p> All this worked great, but as it is with many great inventions in web technology,  cross-site resource caching enabled new ways to track users across different sites.</p><p>所有这些都工作得很好，但就像网络技术中的许多伟大发明一样，跨站点资源缓存实现了跨不同站点跟踪用户的新方法。</p><p> As an example, let&#39;s assume Facebook loads a unique file in their logged-in area ( fb-logo-ajgdmaks839–as.svg – I totally made that file path up); if I would know the file path to such a file, request it on  stefanjudis.com and see a rapid response coming from the browser cache, I can almost be sure that the user has logged into Facebook lately.</p><p>例如，假设Facebook在他们的登录区加载了一个唯一的文件(fb-logo-ajgdmaks839-as.svg-I完全创建了该文件路径)；如果我知道这样一个文件的文件路径，在stefan Judis.com上请求它，并看到来自浏览器缓存的快速响应，我几乎可以确定用户最近登录过Facebook。</p><p>  Webkit (Safari) changed its caching strategy already in 2013 to prevent user tracking via the browser cache. Its cache keys are a combination of the requested resource URL and the top-level-domain requesting the resource.</p><p>WebKit(Safari)早在2013年就改变了缓存策略，以阻止通过浏览器缓存进行用户跟踪。其缓存键是请求的资源URL和请求资源的顶级域的组合。</p><p>  On the bright side, this key structure prevents the mentioned tracking possibilities; unfortunately, it also leads to duplicated resources in the browser cache.</p><p>好的一面是，这种键结构阻止了前面提到的跟踪可能性；不幸的是，它还会导致浏览器缓存中的重复资源。</p><p>   Starting with v86, Chrome will be using combined cache keys, too. This change means that it&#39;s time to say goodbye to third-party resource-sharing across the web.  With Chrome&#39;s market share of roughly 70%, most browsers hitting our sites will use partitioned browser caches from now on. Chrome went for combining the top-level site URL, the current frame site URL, and the resource URL. This approach is more granular than what Safari does, but the result is the same.</p><p>从v86开始，Chrome也将使用组合缓存键。这一变化意味着，是时候告别网络上的第三方资源共享了。由于Chrome的市场份额约为70%，从现在开始，访问我们网站的大多数浏览器都将使用分区的浏览器缓存。Chrome将顶级站点URL、当前框架站点URL和资源URL组合在一起。这种方法比Safari做的更精细，但结果是相同的。</p><p> If your sites request the global jQuery, modules from  unpkg.com, font files from  Google fonts or GA&#39;s (Google Analytics)  analytics.js,  users will redownload the resources no matter if they downloaded and cached them for other sites already.</p><p>如果您的站点请求全局jQuery、来自unpkg.com的模块、来自Google Fonts或GA&#39；s(Google Analytics)analytics.js的字体文件，用户将重新下载这些资源，无论他们是否已经下载并缓存到其他站点。</p><p> What does this change mean for you? If your sites live on modern hosting that provides a CDN and supports HTTP/2, you can drop the third-parties and should ship all resources yourself. Relying on a third-party provides little value in 2020.</p><p>这一变化对您意味着什么？如果您的站点依赖于提供CDN并支持HTTP/2的现代主机，那么您可以放弃第三方，而应该自己交付所有资源。在2020年，依赖第三方几乎没有什么价值。</p><p> If you&#39;re interested in learning more on this topic you can give  Terence Eden&#39;s post &#34;Please stop using CDNs for external Javascript libraries&#34; a read, too.</p><p>如果您有兴趣了解有关此主题的更多信息，也可以阅读Terence Eden的帖子：请停止使用外部Javascript库的CDN。</p><p>  I have mixed feelings about these changes. It&#39;s excellent that browsers consider privacy, but it looks like anything can be misused for tracking purposes these days. I wonder where we&#39;re going with this... 😢</p><p>我对这些变化的感觉很复杂。浏览器考虑隐私是件好事，但现在看来，任何东西都可能被滥用于追踪目的。我想知道这件事我们要去哪里……。😢</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.stefanjudis.com/notes/say-goodbye-to-resource-caching-across-sites-and-domains/">https://www.stefanjudis.com/notes/say-goodbye-to-resource-caching-across-sites-and-domains/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/缓存/">#缓存</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/资源/">#资源</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/resource/">#resource</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/站点/">#站点</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>