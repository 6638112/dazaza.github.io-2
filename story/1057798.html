<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>将痘痘移植到Django </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">将痘痘移植到Django </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-12 19:46:16</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/af489a01632ff8f459d8141730bac852.png"><img src="http://img2.diglog.com/img/2021/4/af489a01632ff8f459d8141730bac852.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>正如我在2月份提到的那样，我一直在使用灰姑娘项目，试图通过帮助聚集在加利福尼亚州的Covid疫苗和人们如何提供Covid疫苗和如何可以将大流行结束了一点得到它。</p><p> Vaccinateca的关键活动正在呼吁检查其可用性和资格标准。直到昨晚，这是由一个受到严重定制的空中实例提供的，伴随着通过某些NetWify功能与AirTable API通信的呼叫者的自定义JavaScript应用程序。</p><p> 今天，该流量由新的自定义Django后端提供支持，在PostgreSQL之上运行。</p><p>  这是一个花了我十五年的学习：“让我们建立一件新的东西并更换这个”是可怕的危险：90％的时间你不会完全取代旧的东西，现在你有两个问题！</p><p> -  Simon Willison（@Simonw）2019年6月29日</p><p> 用临时转换重写替换现有系统是有风险的。更换构建的系统，该系统是一种像空气一样灵活地在日常发展的基础上是积极的恐怖！</p><p> Airtable非常良好地服务，但遗憾的是，对于空洞的行数可以处理的行数并且我们已经反对他们并且必须归档一些数据。继续缩放我们需要迁移的组织。 </p><p>我们需要使用具有全面的权限控制接口构建匹配的关系数据库，用于编辑它，以及API驱动我们的网站和应用程序。我们需要使用最无聊的技术来做，因此我们可以直接专注于解决问题而不是研究任何新的问题。</p><p> Django达到了无聊的技术地位，它永远不会让我惊讶！灰姑式坐落在Django的甜点中。所以我们用它来建立我们的替代品。</p><p> 基于Django的系统称为样品瓶，用于“疫苗信息归档和图书馆”-A整洁的Jesse Vincent Bacronym。</p><p> 我们昨晚将事物转移到Vial，但我们也在空调中的活动。我希望我们将继续使用Airtable来完成组织的一生 - 有很多ad-hoc数据项目，它是一个完美的契合。</p><p> 这里最重要的是对任何信息都有一个值得信赖的单曲真理。我还没有准备好在那一点上宣布胜利，但希望在接下来的几天内完成任何安顿下来。</p><p>   在甚至写任何代​​码之前，第一个挑战是如何从空中获取的东西。我为这款工具构建了一个刚刚称为Airtable-export，而且它已经在我加入之前已经使用了垃圾舞曲队！</p><p> AirTable-export已经运行了几次小时，以JSON格式备份到GitHub存储库（一种Git刮擦）。这使我们提供了对空中数据的更改的详细历史，这偶尔证明对于在更改或删除特定记录时回答问题非常有用。 </p><p>在GitHub存储库中的数据也是有用的，因为它给了我们某个地方，以从空中的速率范围内拉出数据。</p><p>  每个Airtable表都以Github存储库中的单个JSON文件最终结束，其中包含一系列对象 - 这些文件变得非常大，在大约80MB时出现。</p><p> 我开始使用Django管理命令，可以通过文件或URL。关于使用GitHub的一个整洁的事情是，您可以使用“原始数据”链接来获取具有短居住令牌的URL，从而授予对该文件的访问权限。所以我可以创建短期网址并将其直接粘贴到我的导入工具中。</p><p> 我没有一个很好的模式，可以在Google云运行上运行Django管理命令，因此我开始移动到基于API的导入脚本。</p><p> 最终工作最佳的模式是提供接受JSON数组的A / API / ImportRecords API端点。</p><p> API期望输入在我们的情况下每个记录 -  airtable_id中具有唯一主键。然后，它使用django的update_or_create（）orm方法如果缺少它们，则会创建新记录，并否则更新现有记录。</p><p> 一个剩下的挑战：一次性将发布80MB的JSON到API，可能会遇到资源限制。我需要一种方法来打破输入较小的批次。 </p><p>我最终建立了一个名为Json-Post的新工具。它具有一个非常具体的用例：它是为了将大JSON数组发布到API端点时，但您希望首先将其分解成批次！</p><p> 以下是如何将JSON在Reports.json中分解为50项阵列，并将其发送到该API作为单独的帖子：</p><p>  以下是一些更复杂的选项。在这里，我们需要通过授权：Bereer XXXTokexxx API密钥标题，以反向运行阵列，记录我们的进度（从API为Newline-Derimited JSON的JSON响应）到日志文件，设置更长的HTTP读取超时并过滤只是特定项目：</p><p> ％json-post报告.json \＆＃34; https：//example.com/api/importReports&#34; \ -h授权＆＃39;持票人xxxtoknxxx＆＃39; \ b尺寸50 \  -  --reverse \ --log /tmp/progress.txt \ --http-readyout 20 \ --filter＆＃39; item.get（＆＃34; is_soft_deleted＆＃34; ）＆＃39;</p><p> --filter选项证明特别有用。当我们踢了小瓶上的轮胎时，我们会发现新的错误 - 像导入脚本一样无法正确录制我们在Airtable中使用的IS_Soft_deleted字段。能够过滤使用命令行标志的输入文件意味着我们可以轻松地重新运行Import，仅为受特定错误影响的报告的子集。</p><p> --Filter采用Python表达式，该表达式将被编译为函数并传递作为列表中当前项的项目。我从SQLite-Transform工具借用了模式。</p><p>  Vaccineca的JavaScript调用者应用程序用于通过NetWify函数发送数据以Airtable，这允许添加额外的身份验证使用Auth0构建。 </p><p>2月回到后，团队有明亮的想法，可以将API流量记录到该函数的函数，以便在空载和响应机构中的单独基础上。</p><p> 这证明是对调试的无价值。它还意味着当我开始构建“提交呼叫报告”API的替代实施时，我可以重播已记录在该表中的历史API流量，让我提供一种具有现实世界流量的新API的强大方法。</p><p> 这意味着当我们打开小瓶时，我们可以将现有的JavaScript SPA切换到与其使用现有的空中备份API的完全测试的克隆交谈。</p><p>  鉴于可写API将在一天内收到几千个请求，将它们保持在数据库表中工作很大。到目前为止，桌子已经发展到90MB。我希望在我们必须担心伐木能力之前将结束大流行！</p><p> 我们正在使用PostgreSQL JSONB列，通过Django的jsonfield来存储传入和返回的JSON。这意味着我们可以使用PostgreSQL的JSON SQL功能进行深入的API分析！在调试API导入脚本调试问题时，能够检查返回的JSON错误消息或聚合在传入请求主体上有助于。</p><p>  如今，几乎所有存储在瓶子中的数据都源于空气。一个真正帮助构建系统的技巧是，可能包含导入数据的每个表都具有Airtable_ID可空列和Import_json JSON字段。</p><p> 任何时候我们导入空载记录，我们都会记录我们用于导入的ID和完整的原始空洞的JSON。 </p><p>这是调试的另一个强大的工具：我们可以直接在Django管理界面中查看原始的AirTable JSON获取记录，并确认它与我们从中设置的ORM字段匹配。</p><p> 我提出了一种简单的模式，用于在Django管理员中漂亮印刷所有只读json，它也有助于解决。</p><p>  担心我最担心的是用Django替换空气的东西是空调的令人难以置信的灵活性。在本组织的短暂生活中，它已经通过在空调中添加新列或建立新视图来解决了这么多问题。</p><p>  这是与电子表格竞争的自定义软件这么难的原因。</p><p> 我们只刚刚制作了开关，所以我们不会知道一段时间我们在处理这方面的程度。我有一些机制，我希望有帮助。</p><p> 第一个是Django-SQL-Dashboard。我在此期间在此处写下这个项目，这里的目标是通过提供一个用于构建SQL查询，书签和保存结果并输出简单的只读机制，将一些想法从DataSette带入Django / PostgreSQL世界。 SQL驱动的可视化。</p><p> 我们在灰姑娘的情况下有很多SQL知识，所以我的希望是SQL的人们将能够解决自己的问题，并且不了解SQL的人们尚未遇到能够帮助他们的人。 </p><p>在钻孔技术模型中，Django-SQL-Dashboard计数为主要创新令牌，我正在为这个项目支出。我很乐观，它会得到回报。</p><p> 我也在沉重地倾向于Django的迁移系统，目的是使数据库迁移普遍和无聊，而不是他们通常的违约才能罕见和令人兴奋。我们已经高达了77次迁移，在一个超过两个月大的码名中！</p><p> 我认为一种快速地发展数据库模式的文化，尽可能小的戏剧，这对于维持这种组织需求的灵活性至关重要。</p><p> 除了提供编辑界面的Django管理员之外，通过API致电地进入并超出小瓶中的所有内容。这些完全记录：我希望人们能够独立构建API，特别是对于数据导入等事物。</p><p> 在HostgreSQL JSON看到与PostgreSQL JSON取得重大成功之后，我考虑将其添加到未来为小瓶添加更多API驱动的灵活性。允许我们的客户开发人员开始从现有的JSON字段中从志愿者收集新的数据，然后一旦证明其值，它就迁移到单独的列中，确实非常诱人。</p><p>   Django-Reversion和Django-Reversion  - 比较提供我们一些核心模型的可扩展，可易阅读的历史</p><p> django-admin-tools  - 它为管理员添加一个方便的可自定义菜单，很好地链接到其他自定义工具 </p><p>Django-Migration-Linter  - 帮助避免意外运输迁移可能导致在部署期间停机的迁移  灰姑娘正在招聘！ 这是一个有趣的演出，因为最终目标是结束大流行，并使这一非营利性永久地摆脱业务。 所以，如果你想更快地帮助结束事物，请联系。  Vaccinateca正在聘请少数工程师来帮助缩放我们的数据摄取并显示超过一个数量级。 如果您想注册兴趣：https://t.co/bsvi40sw1m概括欢迎。 三个子项目; Python后端/行人前端JS。  -  Patrick McKenzie（@ Patio11）4月7日，2021年4月7日  JSON帖子：0.2-（3总发布）-2021-04-11将JSON发布到API的工具，分为页面  Airtable  - 出口：0.7.1-（10总发布）-2021-04-09将空洞数据导出到磁盘上的YAML，JSON或SQLITE文件  Django-SQL-Dashboard：0.6A0-（13总发布）-2021-04-09 Django应用程序用于使用RAW SQL查询构建仪表板 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://simonwillison.net/2021/Apr/12/porting-vaccinateca-to-django/">https://simonwillison.net/2021/Apr/12/porting-vaccinateca-to-django/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/django/">#django</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/移植/">#移植</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/json/">#json</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1056549.html"><img src="http://img2.diglog.com/img/2021/4/thumb_f153561280a64ed7bfcb6f2481d523c2.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1056549.html">Django 3.2  - 关于压缩夹具和夹具压缩的新闻 </a></div><span class="my_story_list_date">2021-4-7 0:42</span></div><div class="col-sm"><div><a target="_blank" href="/story/1049460.html"><img src="http://img2.diglog.com/img/2021/2/thumb_27b5f2ffbdb00ce9a3178ca9d96b02ef.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1049460.html">Django中的高效Postgres全文搜索 </a></div><span class="my_story_list_date">2021-2-26 3:15</span></div><div class="col-sm"><div><a target="_blank" href="/story/1047004.html"><img src="http://img2.diglog.com/img/2021/1/thumb_8f49f3336bb2b29897caff42a296c37e.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1047004.html">更新于2021年：Docker Django和Intercooler是构建SaaS的必备之选 </a></div><span class="my_story_list_date">2021-1-31 7:14</span></div><div class="col-sm"><div><a target="_blank" href="/story/1041919.html"><img src="http://img2.diglog.com/img/2020/12/thumb_4dd669eb8b1e06ae6b16f0488d4ba2b9.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1041919.html">2020年下载量最高的102个Django软件包 </a></div><span class="my_story_list_date">2020-12-27 7:20</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>