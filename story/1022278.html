<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>8086微码反汇编</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">8086微码反汇编</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-06 00:54:31</div><div class="page_narrow text-break page_content"><p>最近，我意识到，作为他的8086逆向工程系列的一部分，肯·谢里夫(Ken Shirriff)在网上发布了一张8086芯片的高分辨率照片，上面去掉了金属层。这是我一段时间以来一直在寻找的东西，以便提取和反汇编8086微码。我之前发现了芯片的非常高分辨率的照片，金属层完好无损，但微码ROM只有一半的位是可读的。Ken还发布了一张8088微码ROM的高分辨率照片，这张照片非常相似，但并不完全相同。我非常好奇，想知道有什么不同。</p><p>我使用bitract从两个主微码ROM中提取位，也从转换ROM中提取位，转换ROM将操作码位模式映射到主微码ROM中的位置。</p><p>该微码在美国专利4363091中有部分记录。具体地说，该专利具有几个微码例程源代码列表。在这些指令中，有一些我能够在ROM转储中找到的指令部分的特定模式。这使我能够计算出ROM中的位模式如何与微码指令集的操作数和操作码相对应，其方式类似于破解单字母替换密码。我得到的微码ROM的反汇编可以在这里找到，我的反汇编程序的代码在GitHub上。</p><p>这次拆卸回答了我对8088和8086的许多问题。这篇文章的其余部分包含了这些问题的答案和我在微码中发现的其他有趣的东西。</p><p>不同之处在于中断处理代码。我认为归根结底是8086执行两次特殊的总线访问来确认中断(一次是告诉PIC它已准备好服务中断，第二次是获取需要服务的IRQ的中断号)。由于某些原因，这些都是字大小的访问，所以8088会将它们分成四个访问，而不是两个访问。这会使PIC感到困惑，因此8088改为执行单一访问，并依赖BIU将访问一分为二。其他变化似乎与此相关。</p><p>基本上都是。然而，也有不同之处(这增加了破译过程的一些复杂性)。不同之处在于字符串指令。例如，专利中的&#34；STS&34；(STOSB/STOSW)指令是：</p><p>CR S D类型a b F-0 IK接口7 F1 11(M)OPR 6带DA，BL2接口IK 0 F1 03 4无RNI。</p><p>0 IK-&&gt;IND 7 F1 RPTS1 M-&&gt;OPR 6 w DA，BL2 Ind-&gt；IK 0 NF1 53 Sigma-&gt；tmpc 5 int RPTI4 tmpc-&gt；BC 0新西兰15 4无RNI</p><p>箭头并没有什么不同-我只是把它放在反汇编中，以强调微码指令的Move部分中数据移动的方向。同样，专利列表中的&#34；F11&34；与我的反汇编中的&#34；F1rpts&#34；相同-我用名称替换子例程编号以便于阅读。</p><p>专利中的版本在处理字符串的任何迭代之前，会检查例程中是否有挂起的中断。这意味着如果有一个连续的中断风暴，字符串指令将不会有任何进展。CPU中的版本会纠正这一点，并在完成存储后检查第3行上的中断，从而允许其继续进行。这可能不是在正常操作中预期会发生的情况(事实上，我似乎记得我的8088和8086机器崩溃的原因是中断发生得太快而无法得到服务)。所做的更改很可能是为了适应使用陷阱标志进行的调试(这实质上意味着在设置陷阱标志时总是有一个中断挂起)。如果没有此更改，使用重复字符串指令的代码不会在调试器下运行。</p><p>根据微码，8086有多少条不同的指令？他们是什么?。</p><p>MOV RM&lt；-&gt；r 4 3LEA 1 1alu RM&lt；-&gt；R 32 4ALU RM，I 4 5MOV RM，I 2 4ALU r，I 16 4 MOV r，I 16 3PUSH RW 8 4PUSH Sr 4 4PUSHF 1 4POP RW 8 3POP Sr 4 3POPF 1 3POP RMW 1 6CBW 1 2CWD 1 7MOV A，[I]2 4MOV[I]，A 2 4CALL CD 1 4CALL CW 1 8XCHG AX，RW 8 3ROT。A 2 2RET 2 4RETF 2 2IRET 1 4RET/RETF iW 4 4JMP CW/JMP CB 2 6JMP CD 1 7Jcond 32 3MOV RMW&lt；-&gt；Sr 2 2LES 1 4LDS 1 4WAIT 1 9(不连续)SAHF 1 4LAHF 1 2ESC 8 1XLAT 1 5STOS 2 6(不连续)CMPS/SCAS 4 13(不连续)MOVS/LODS 4 11(不连续)JCXZ 1 5(不连续)LOOPNE/Loope 2 5LOOP 1 4DAA/DAS 2 4aaa/AAS 2 8AAD 1 4AAM 1 6INC。</p><p>这些不连续的指令很可能被分解了，因为它们有错误修复，使得它们对于原始插槽来说太长了。同样，POP RMW&34；似乎缩短了至少3条指令，因为它后面有一个间隙。在编写代码之后四处移动代码(以及更新所有的远跳转/调用位置)可能会很棘手。</p><p>段覆盖前缀(CS：、SS：、DS：和ES：)没有微码。也不适用于其他前缀(REP、REPNE和LOCK)，也不适用于指令CLC、STC、CLI、STI、CLD、STD、CMC和HLT。&#34；组&#34；操作码0xf6、0xf7、0xfe和0xff没有顶级微码指令。因此，操作码的高位字节中没有一条指令最初由微码处理。这些指令中的大多数都非常简单，并且可能更好地由随机逻辑来完成。HLT有点令人惊讶--我真的以为我会为它找到一个微码循环，因为它似乎每隔一个周期才检查一次中断。</p><p>组指令的解码略有不同，但处理它们的微码例程分解如下：</p><p>INC/DEC RM 3PUSH RM 4NOT RM 3NEG RM 3CALL Far RM 8CALL RM 8TEST RM，I 4JMP RM 2JMP Far RM 4IMUL/MUL人民币8IMUL/MUL RMW 8IDIV/DIV人民币8IDIV/DIV RMW 8</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.reenigne.org/blog/8086-microcode-disassembled/">https://www.reenigne.org/blog/8086-microcode-disassembled/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/汇编/">#汇编</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/微码/">#微码</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/microcode/">#microcode</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1021170.html"><img src="http://img.diglog.com/img/2020/8/thumb_601781c77bec4903cdc8c1443aeb7669.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1021170.html">我把NASA的工艺标准汇编成了一个PDF</a></div><span class="my_story_list_date">2020-8-30 1:10</span></div><div class="col-sm"><div><a target="_blank" href="/story/1016549.html"><img src="http://img.diglog.com/img/2020/8/thumb_fe137f795d7a9df985fdb60dd4d99242.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1016549.html">编译器/ISA资源管理器：请参阅不同编译器的ARM、RISCV、x86输出</a></div><span class="my_story_list_date">2020-8-6 7:42</span></div><div class="col-sm"><div><a target="_blank" href="/story/1015365.html"><img src="http://img.diglog.com/img/2020/7/thumb_24bb2a34c51f10100a8c94984677f826.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1015365.html">国土安全部汇编了发布泄密文件的记者的情报报告</a></div><span class="my_story_list_date">2020-7-31 11:26</span></div><div class="col-sm"><div><a target="_blank" href="/story/1013350.html"><img src="http://img.diglog.com/img/2020/7/thumb_3001540cf3af3a2edcaf8bcae3618fa6.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1013350.html">彼得·泰尔谈进步与停滞--一本100页的汇编</a></div><span class="my_story_list_date">2020-7-22 3:16</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>