<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linux内核在BPF JIT编译器中不正确计算分支位移 Linux kernel incorrect computation of branch displacements in BPF JIT compiler</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Linux kernel incorrect computation of branch displacements in BPF JIT compiler<br/>Linux内核在BPF JIT编译器中不正确计算分支位移 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-10 12:35:14</div><div class="page_narrow text-break page_content"><p>Date: Thu, 8 Apr 2021 16:24:26 +0100From: Piotr Krysiuk &lt;piotras@...il.com&gt;To: oss-security@...ts.openwall.comSubject: [CVE-2021-29154] Linux kernel incorrect computation of branch displacements in BPF JIT compiler can be abused to execute arbitrary code in Kernel modeAn issue has been discovered in the Linux kernel that can be abused byunprivileged local users to escalate privileges.The issue is with how BPF JIT compilers for some architectures computebranch displacements when generating machine code. This can be abusedto craft anomalous machine code and execute it in the Kernel mode,where the control flow is hijacked to execute unsafe code.I developed PoCs for x86-64 and x86-32 architectures to demonstrateshellcode execution in Kernel mode by unprivileged local users.One of these PoCs has been shared privately with &lt;security@...nel.org&gt;to assist with fix development.Patches to mitigate the issue for x86-64 and x86-32 architectures areavailable. These patches do not attempt to correct the underlyingalgorithm and instead assert that all computations were performedcorrectly, such that all unsafe inputs are rejected.The patches were published via BPF subsystem public git repository:*  https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf.git/patch/?id=e4d4d456436bfb2fe412ee2cd489f7658449b098*  https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf.git/patch/?id=26f55a59dc65ff77cd1c4b37991e26497fc68049# DiscovererPiotr Krysiuk &lt;piotras@...il.com&gt;# ReferencesCVE-2021-29154 (reserved via  https://cveform.mitre.org/)</p><p>日期：星期四，4月20日25日16:24:26 + 0100起来：piotr krysiuk＆lt; piotras @ ... Il.com＆gt; to：oss-security @ ... ts.openwall.comsubject：[cve-2021-29154] Linux内核在BPF JIT编译器中的分支位移计算可以滥用，以便在Linux内核中发现内核中的任意代码在Linux内核中发现，可以滥用普通的本地用户来升级权限。问题是BPF JIT编译器的一些在生成机器代码时架构ComputeBranch位移。这可以是滥用的制作异常机器代码并在内核模式下执行它，其中控制流被劫持以执行不安全的代码.I开发了x86-64和x86-32架构的poc，以便通过非特权的本地用户演示在内核模式下演示执行。这些Pocs之一已私下共享，＆lt; security @ ... nel.org＆gt;协助修复开发.patches以减轻x86-64和x86-32架构的问题。这些修补程序不会尝试纠正底层algorithm，而是断言所有计算都已执行，使得所有不安全的输入都被拒绝。通过BPF子系统公共git存储库发布了修补程序：* https://git.kernel.org/pub/ SCM / Linux / kernel / git / bpf / bpf.git / patch / bpf.git / patch / free = e4d4d456436bfb2fe412ee2cd489f7658449b098 * https://git.kernel.org/pub/scm/linux/kernel/git/bf/bpf.git/patch/？ ID = 26F55A59DC65FF777CD1C4B37991E26497FC68049＃discovererpiotr Krysiuk＆lt; piotras @ ... Il.com＆gt; #craftencescve-2021-29154（通过https://cveform.mitre.org/保留） </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.openwall.com/lists/oss-security/2021/04/08/1">https://www.openwall.com/lists/oss-security/2021/04/08/1</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/编译/">#编译</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/分支/">#分支</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/kernel/">#kernel</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/bpf/">#bpf</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>