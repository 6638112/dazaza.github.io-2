<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>路由器架构的简要历史 A brief history of router architecture</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">A brief history of router architecture<br/>路由器架构的简要历史 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-13 09:54:47</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/a12be69a02916fb6cf49926e03615d9f.jpg"><img src="http://img2.diglog.com/img/2021/3/a12be69a02916fb6cf49926e03615d9f.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Over the last 50 years, we’ve made a lot of progress in developing the Internet from a tiny interconnection of a handful of computers to a worldwide fabric with billions of nodes. During that journey, we’ve learned an enormous amount about how to build networks and the routers that interconnect them. The mistakes that we all made generated some important lessons along the way, for those that chose to learn them.</p><p>在过去的50年中，我们在开发互联网从一小亿计算机的微小互连开发互联网时，我们已经取得了很大的进展，这是一个带有数十亿个节点的全球结构。在该旅程中，我们已经学习了关于如何构建网络和互连它们的路由器的巨大数量。对于那些选择学习他们的人来说，我们所有人都会产生一些重要的教训。</p><p> In the beginning, routers were simply generic computers, with Network Interface Cards (NICs) attached to a bus.</p><p> 一开始，路由器简单地是通用计算机，网络接口卡（NIC）连接到总线。</p><p>  This works to a point. In this architecture, packets enter a NIC and are transferred by the CPU from the NIC into memory. The CPU makes a forwarding decision and then pushes the packet out to the outbound NIC. The CPU and memory are centralized resources, bound by what they can support. The bus is an additional limitation: the bandwidth of the bus must be able to support the bandwidth of all of the NICs simultaneously.</p><p>  这是一个点。在此架构中，数据包输入NIC，并由CPU从NIC转换为内存。 CPU进行转发决策，然后将数据包推出到出站NIC。 CPU和内存是集中资源，受他们能够支持的内容。总线是一个额外的限制：总线的带宽必须能够同时支持所有NIC的所有NIC的带宽。</p><p> If you want to scale this up, problems quickly become apparent. You can buy a faster CPU, but how do you scale up the bus? If you double the speed of the bus, then you must double the speed of the bus interface on every NIC and the CPU card. That makes all of the cards more expensive, even if an individual NIC isn’t somehow more capable.</p><p> 如果你想扩展这个，问题很快就会变得明显。您可以购买更快的CPU，但您如何扩展公共汽车？如果您加倍总线的速度，则必须在每个NIC和CPU卡上加倍总线接口的速度。这使得所有卡片更昂贵，即使个体NIC并不涵吞一些能力。</p><p>  Despite this lesson, the expedient solution to scaling was to add another bus and another processor:</p><p>  尽管如此，但缩放的权宜解解决方案是添加另一巴士和其他处理器：</p><p>  The additional Arithmetic Logic Unit (ALU) was a Digital Signal Processing (DSP) chip, chosen because of its excellent price-performance ratio. The additional bus added bandwidth, but the architecture still didn’t scale. In other words, you couldn’t keep adding more ALUs and more buses to get more performance.</p><p>  附加的算术逻辑单元（ALU）是数字信号处理（DSP）芯片，选择，因为其价格优异 - 性能比率。额外的总线增加带宽，但架构仍然没有扩展。换句话说，您无法继续添加更多的ALU和更多的总线以获得更多性能。</p><p> Since the ALU was still a significant limitation, the next step was to add a Field Programmable Gate Array (FPGA) to the architecture to offload the Longest Prefix Match (LPM) lookup.</p><p> 由于ALU仍然是一个显着的限制，因此下一步是将字段可编程门阵列（FPGA）添加到架构中以卸载最长的前缀匹配（LPM）查找。 </p><p>  While this helped, it was surprising that it didn’t help more. The ALU was still saturated. LPM was a big portion of the workload, but the centralized architecture still didn’t scale if you took away that part of the problem.</p><p>虽然这有助于，但它没有更多的帮助。阿卢仍然饱和。 LPM是工作量的大部分，但如果您剥夺了该部分问题，集中式架构仍然没有规模。</p><p> Lesson 2:  LPM can be implemented in custom silicon and is not a roadblock for performance.</p><p> 第2课：LPM可以在Custom Silicon中实现，并且不是性能的障碍。</p><p> Despite this lesson, the next step was to go in the other direction: replace the ALU and FPGA with a generic processor. Try to scale by adding more CPUs and more buses. This required a great deal of effort for a small incremental gain and was still limited by the centralized bus bandwidth.</p><p> 尽管如此，但下一步就是进入另一个方向：用通用处理器替换ALU和FPGA。通过添加更多CPU和更多的总线来尝试缩放。这需要大量努力进行小的增量收益，并且仍然受到集中式总线带宽的限制。</p><p> At this point in the evolution of the Internet, bigger forces came into play. As the web took off in popular imagination, the vast potential of the Internet became increasingly apparent. Telcos acquired the NSFnet regional networks and began deploying commercial backbones. Application-Specific Integrated Circuits (ASICs) became credible technologies, allowing more functionality to be implemented directly in silicon. Demand for routers skyrocketed, and the demand for drastic scalability improvements finally overwhelmed engineering conservatism. Numerous startups sprang forth to meet this demand, with a variety of potential solutions.</p><p> 在互联网演变的这一点上，更大的力量进入了戏剧。随着网络在热门的想象中起飞，互联网的巨大潜力越来越明显。 Telco获得了NSFnet区域网络，并开始部署商业骨干网。特定于应用的集成电路（ASIC）成为可靠的技术，允许直接在硅中实现更多功能。对路由器的需求飙升，并且对剧烈可扩展性的需求终于不堪重负工程保守主义。许多初创公司突出了满足这种需求，具有各种潜在的解决方案。</p><p>   In this architecture, each NIC is an input and an output. A processor on the NIC made the forwarding decision, selected the output NIC and sent a scheduling request for the crossbar. The scheduler took all of the requests from the NICs, tried to figure out an optimal solution, programmed the crossbar with its solution, and cued the inputs to transmit.</p><p>   在此架构中，每个NIC都是输入和输出。 NIC上的处理器使转发决定，选择输出NIC并向横杆发送调度请求。调度程序从NIC中拍摄了所有请求，尝试弄清楚最佳解决方案，用其解决方案编程横梁，并提示输入要传输。</p><p> The problem with this is that each output could only listen to a single input at a time and Internet traffic is bursty. If two packets needed to go to the same output, one of them had to wait. If the packet that has to wait causes other packets on that same input to wait, then the system will suffer from Head Of Line Blocking (HOLB), resulting in very poor router performance.</p><p> 此问题的问题是每个输出只能在时间收听单个输入，而Internet流量则突发。如果需要两个数据包进行同一输出，其中一个必须等​​待。如果必须等待的数据包会导致相同输入的其他数据包等待，则系统将遭受线路阻塞（HOLB）的头部，导致路由器性能非常差。</p><p> Lesson 3:  A router’s internal fabric needs to be non-blocking even under stressful conditions.</p><p> 第3课：即使在压力条件下，路由器的内部面料也需要无阻塞。 </p><p> The migration to custom silicon also encouraged designers to migrate to cell-based internal fabrics, as implementing switching of small, fixed-size cells was much easier than dealing with variable length, sometimes large packets. But switching cells also means the scheduler had to run at a higher, per-cell rate, making scheduling that much harder.</p><p>迁移到定制硅也鼓励设计人员迁移到基于单元的内部织物，因为执行小型固定尺寸小区的切换比处理可变长度，有时大包的更容易。但切换单元也意味着调度程序必须以更高的，每个单元格速率运行，使调度更加困难。</p><p>   Here, each NIC had links to four neighbours, and the input NIC had to compute a path across the fabric to reach the output line card. This had issues — the bandwidth was not uniform. There was more bandwidth in the north-south direction than there was in the east-west direction. If the input traffic pattern needed to go east-west, congestion ensued.</p><p>   这里，每个NIC都有链接到四个邻居，并且输入NIC必须计算跨面料的路径到达输出线卡。这有问题 - 带宽并不均匀。南北方向的带宽比在西方方向上有更多的带宽。如果输入流量模式需要进入东西，则随后拥堵。</p><p> Lesson 4:  A router’s internal fabric must have uniform bandwidth distribution because we can’t anticipate the distribution of traffic.</p><p> 第4课：路由器的内部面料必须具有统一的带宽分配，因为我们无法预测交通的分配。</p><p> A very different approach was to create a full-mesh of NIC to NIC links and distribute cells across all of the NICs:</p><p> 一种非常不同的方法是将NIC的全网格创建到NIC链接和在所有NIC中分发单元格：</p><p>  Despite previous lessons learned, new issues came to light. In this architecture, everything worked reasonably well until someone needed to replace a card for repair. Since each NIC held cells for all of the packets in the system, when a card was pulled, none of the packets could be reconstructed, resulting in a brief but painful outage.</p><p>  尽管先前的经验教训，但新的问题来了光明。在这种架构中，一切都很好地工作，直到有人需要更换卡进行维修。由于每个NIC持有的细胞为系统中的所有数据包，当拉动卡时，可以重建任何数据包，导致简要但痛苦的中断。</p><p>    Here, all packets flow into a central memory and then flow out to the output NIC. This worked fairly well, but scaling the memory is a challenge. You can add multiple memory controllers and memory banks, but at some point, the aggregate bandwidth is simply too much to physically engineer. Running into the practical physical limits forced us to think in other directions.</p><p>    这里，所有数据包都流入中心存储器，然后向输出NIC流出。这相当好，但缩放记忆是一项挑战。您可以添加多个内存控制器和内存库，但在某些时候，聚合带宽对于物理工程师来说太多了。跑进实际的物理限制迫使我们在其他方向上思考。</p><p> We found inspiration in the telephone network. Charles Clos long ago realized that scalable switches could be built by constructing networks of smaller switches. It turns out that all of the wonderful properties that we needed were all present in a Clos network:</p><p> 我们在电话网络中找到了灵感。 Charles Clos很久以前意识到可以通过构建较小的交换机的网络来构建可扩展的开关。事实证明，我们所需要的所有精彩属性都存在于CELL网络中： </p><p>    We always implement inputs and outputs together, so we normally fold this picture on the dotted line. This produces the folded Clos network, which is what we use in multi-chassis routers today, with some chassis full of NICs and a layer of switches, and more chassis with additional layers of switches.</p><p>我们始终将输入和输出一起实现，因此我们通常在虚线上折叠此图片。这产生了折叠的CLOS网络，这是我们今天在多机箱路由器中使用的，其中一些机箱充满了NIC和一层交换机，以及带有附加开关层的机箱。</p><p>  Unfortunately, even this architecture is not without issues. The cell format used between the switches is proprietary to the chip vendor, resulting in chipset lock-in. Being tied to a chip vendor is no better than being tied to a single router vendor, with similar issues of single-source pricing and availability. Hardware upgrades are challenging since a new cell switch must simultaneously support the legacy links and cell format to interoperate as well as any upgrade link speeds and cell formats.</p><p>  不幸的是，即使这个架构也没有没有问题。交换机之间使用的单元格格式为芯片供应商专有，导致芯片组锁定。与芯片供应商绑定并不是与单个路由器供应商相关联，具有类似的单源定价和可用性问题。硬件升级是具有挑战性，因为新的单元格交换机必须同时支持传统链接和单元格格式以互操作以及任何升级链路速度和单元格格式。</p><p> Each cell must have addressing that indicates the output NIC to which it should flow. That addressing is necessarily finite, resulting in an upper bound on scalability. Control and management of a multi-chassis have, to date, been completely proprietary, creating another single-vendor issue for the software stack.</p><p> 每个单元格必须具有地址，指示它应该流到的输出NIC。该寻址必须有限，导致可扩展性的上限。迄今为止，多底盘的控制和管理是完全专有的，为软件堆栈创建了另一个单一供应商问题。</p><p> Fortunately, we can address these issues by changing our architectural philosophy. For the last 50 years, we have been striving to scale up our routers. What we have learned from our experiences in building large clouds is that the scale-out philosophy is frequently more successful.</p><p> 幸运的是，我们可以通过改变我们的建筑哲学来解决这些问题。在过去的50年里，我们一直在努力扩大我们的路由器。我们从建立大云层的经验中学到的是，扩展哲学经常更加成功。</p><p> In a scale-out architecture, instead of trying to build a gigantic, extremely fast single server, why not divide and conquer? A rack full of smaller servers can do the same job, while also being more resilient, flexible, and economical.</p><p> 在横向扩展的架构中，而不是尝试构建一个巨大的，非常快的单个服务器，为什么不划分和征服？充满较小服务器的机架可以做同样的工作，同时也具有更具弹性，灵活和经济的。</p><p> When applied to routers, the thinking is similar. Can we take some smaller routers and arrange them in a Clos topology so that we have similar architectural benefits, but avoid the cell-based issues? It turns out to be not overly difficult:</p><p> 当应用于路由器时，思维是相似的。我们可以采取一些较小的路由器，并在拼接拓扑中安排它们，以便我们具有类似的架构利益，但避免基于细胞的问题？事实证明，没有过于困难：</p><p>  By replacing cell switches with packet switches, such as routers, and retaining the Clos topology, we ensure that we have easy scalability.</p><p>  通过用数据包交换机（例如路由器）替换单元开关，并保留拼盘拓扑，我们确保我们具有简单的可扩展性。 </p><p> We can scale in two dimensions: either by adding more entry routers and packet switches in parallel with the existing layers or by adding additional layers of switches. Since the individual routers are now relatively generic, vendor-lock is avoided. The links are all standard Ethernet, so there is no issue with interoperability.</p><p>我们可以以两个维度缩放：通过添加更多的输入路由器和分组交换机与现有图层并行，或通过添加其他交换机层。由于各个路由器现在相对通用，避免了供应商锁定。链接是所有标准以太网，因此互操作性没有问题。</p><p> Upgrades are direct and straightforward: if more links are needed on a switch, then swap in a bigger switch. If a given link needs to be upgraded and both ends of the link are capable, then it’s a matter of simply upgrading the optics. Running heterogeneous link speeds within the fabric is a non-issue as each router acts as a speed-matching device.</p><p> 升级是直接和简单的：如果在交换机上需要更多链接，则在更大的开关中交换。如果需要升级给定链接并且链路的两端都有能力，那么它只是简单地升级光学器件。当每个路由器充当速率匹配设备时，在织物内运行非均相链接速度是非问题。</p><p> This architecture is common already in the data centre world, and is known as a leaf-spine or super-spine architecture, depending on the number of layers of switches. It has proven to be very robust, stable, and flexible.</p><p> 这种架构已经在数据中心世界中常见，并且被称为叶子脊柱或超脊柱架构，具体取决于交换机的层数。它已被证明是非常坚固，稳定和灵活的。</p><p> From a forwarding plane perspective, it’s clear that this is a viable alternative architecture. The issues that remain are for the control plane and management plane. Scaling out the control plane requires an order of magnitude improvement in the scale of our control protocols. We seek to achieve that by improving our abstraction mechanisms by creating a proxy representation of the architecture, representing the entire topology as a single node.</p><p> 从转发平面透视中，很明显这是一种可行的替代架构。保留的问题适用于控制平面和管理平面。缩放控制平面需要在我们的控制协议的规模中提高大量提高。我们通过创建架构的代理表示来改进我们的抽象机制来实现这一目标，将整个拓扑作为单个节点代表整个拓扑。</p><p> Similarly, we are working on developing management plane abstractions that allow us to control the entire Clos fabric as a single router. This work is being done as an open standard, so none of the technology involved is proprietary.</p><p> 同样，我们正在努力开发管理平面抽象，使我们能够将整个晶面料控制为单个路由器。这项工作正在作为开放标准进行，因此涉及的技术都没有专有。</p><p> Over the last 50 years, router architectures have evolved in fits and starts, with many missteps, as we navigated the trade-offs between technologies. It is clear that our evolution is not yet complete. With each iteration, we have addressed the issues of the previous generation and discovered a new set of concerns.</p><p> 在过去的50年中，路由器架构已经符合拟合并开始，并且随着我们导航技术之间的权衡，而且有许多误操作。很明显，我们的进化尚未完成。通过每次迭代，我们已经解决了前一代的问题，并发现了一套新的关注点。</p><p> Hopefully, by careful consideration of our past and present experiences, we can move forward with a more flexible and robust architecture, and make future improvements without forklift upgrades.</p><p> 希望通过仔细考虑我们的过去和现在的经验，我们可以通过更灵活和强大的架构前进，并在没有叉车升级的情况下进行未来的改进。 </p><p> Tony Li has been a pioneer in Internet routing for 30 years, helping to scale the Internet architecture and leading the deployment of BGP and CIDR.</p><p>Tony Li一直是互联网路由的先驱30年，有助于扩展互联网架构并领导BGP和CIDR的部署。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.apnic.net/2021/03/12/a-brief-history-of-router-architecture/">https://blog.apnic.net/2021/03/12/a-brief-history-of-router-architecture/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/路由器/">#路由器</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/router/">#router</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/nic/">#nic</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012 - 2021 diglog.com </div></div></body></html>