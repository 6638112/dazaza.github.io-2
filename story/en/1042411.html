<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>除非启用了FileVault，否则将略过M1 Macs SSD的“加密” M1 Macs SSD “Encryption” trivially bypassed unless FileVault is enabled</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">M1 Macs SSD “Encryption” trivially bypassed unless FileVault is enabled<br/>除非启用了FileVault，否则将略过M1 Macs SSD的“加密” </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-30 00:25:46</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/1d9f98af55acb29ae9455177f200e329.png"><img src="http://img2.diglog.com/img/2020/12/1d9f98af55acb29ae9455177f200e329.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Built-in Mac SSD Encryption Is Easily Bypassed by an Attacker With Physical Access if Filevault Isn’t Enabled</p><p>如果未启用Filevault，则具有物理访问权限的攻击者可以轻松绕过内置Mac SSD加密</p><p>  If you buy a modern Mac in 2020, it is going to come with a special physical component called the Secure Enclave. This component enables Apple to carry over many popular iOS features which require extra hardware security like Touch ID and Apple Pay to the Mac.</p><p>  如果您在2020年购买一台现代Mac，它将配备一个称为Secure Enclave的特殊物理组件。此组件使Apple能够继承许多流行的iOS功能，这些功能需要额外的硬件安全性，例如Touch ID和Apple Pay到Mac。</p><p> One of the lesser-known features of the Secure Enclave is that it performs automatic hardware based encryption of a Mac’s built-in SSD. This means that without any user intervention, your new Mac is encrypted right out of the packaging. With this fact in mind, you may be wondering if taking the extra step of enabling FileVault is still necessary? I am here to tell you,  yes, it is absolutely necessary .</p><p> Secure Enclave鲜为人知的功能之一是，它对Mac的内置SSD执行基于硬件的自动加密。这意味着，无需任何用户干预，新Mac便会从包装中进行加密。考虑到这一事实，您可能想知道是否仍然需要采取额外的步骤来启用FileVault？我在这里告诉你，是的，这是绝对必要的。</p><p> An encrypted Mac without FileVault allows anyone who has physical access to your device to trivially read your personal data. They don’t even need to know your password. Even worse, some tools used to detect FileVault’s status (like  osquery), can conflate the differences between  Encrypted versus  FileVault On causing you to believe the data on your Mac is safe, when in fact, it’s unprotected from the most common scenarios wherein we rely on encryption to save us.</p><p> 不带FileVault的经过加密的Mac，可以使对您的设备具有物理访问权限的任何人都能轻松读取您的个人数据。他们甚至不需要知道您的密码。更糟糕的是，一些用于检测FileVault状态的工具（例如osquery）可能会混淆Encrypted和FileVault之间的差异，导致您认为Mac上的数据是安全的，而实际上，在我们所依赖的最常见情况下，它是不受保护的加密来拯救我们。</p><p> In this article we will review the current situation, the steps you should take to ensure you are correctly polling this information, and how we are patching osquery to resolve this confusion.</p><p> 在本文中，我们将回顾当前的情况，确保正确轮询此信息应采取的步骤以及如何为osquery打补丁以解决这种混乱。</p><p>  The osquery  disk_encryption table as of December 20th, 2020, reports a value of  encrypted = 1 for  all T2 and M1 Macs,  regardless of the FileVault status. This information is technically correct, but has likely resulted in inaccurate interpretations about FileVault’s status.</p><p>  截至2020年12月20日的osquery disk_encryption表报告所有T2和M1 Mac的加密值= 1，无论FileVault状态如何。该信息在技术上是正确的，但可能导致对FileVault状态的错误解释。</p><p> Kolide determined that the SSD of Encrypted Macs without FileVault can be trivially accessed with simple physical access to the device.</p><p> Kolide确定不使用FileVault的Encrypted Macs的SSD可以通过对设备的简单物理访问来轻松访问。 </p><p> Kolide  shipped a hotfix for its own customers with a new launcher table  kolide_filevault_status, and amended its Check to address the issue.</p><p>Kolide为自己的客户提供了带有新启动器表kolide_filevault_status的修补程序，并修改了其检查以解决此问题。</p><p> Kolide  shipped a patch for the osquery  disk_encryption table to include a new column:  filevault_status</p><p> Kolide为osquery disk_encryption表提供了一个补丁，其中包括一个新列：filevault_status</p><p>  For 30 years, Apple has included a tool with its operating systems called ‘Target Disk Mode’. This utility allowed a user to mount the disk of one Apple device, on another device as a network volume. There are a variety of reasons this functionality is helpful, the most common being, the retrieval of data on a Mac that no longer boots successfully.</p><p>  30年来，Apple在其操作系统中包含了一种称为“目标磁盘模式”的工具。该实用程序允许用户将一个Apple设备的磁盘作为网络卷安装在另一台设备上。此功能有用的原因有多种，最常见的原因是在Mac上无法成功启动的数据检索。</p><p>  However, using macOS’s Target Disk Mode an attacker with physical access to a device can trivially access the contents of the disk by physically connecting it to another computer and booting it in Recovery Mode. So while that disk may  ‘Actually’ be Encrypted at Rest thanks to the Secure Enclave, it is completely vulnerable to data exfiltration so long as FileVault has not been configured.</p><p>  但是，使用macOS的目标磁盘模式，对设备进行物理访问的攻击者可以通过将磁盘物理连接到另一台计算机并以恢复模式启动磁盘来轻松访问磁盘的内容。因此，尽管借助Secure Enclave，该磁盘在静态时可以“实际上”被加密，但只要未配置FileVault，它就完全容易受到数据泄露的攻击。</p><p> How easy is this you might wonder? In our testing you can start pulling down a target device’s files in less than 3 minutes:</p><p> 您可能想知道这有多容易？在我们的测试中，您可以在不到3分钟的时间内开始提取目标设备的文件：</p><p> Shut down and Boot the target device into Recovery Mode (either by holding  ⌘+R or on M1 Macs by holding the Power button)</p><p> 关闭目标设备并将其引导到恢复模式（按住⌘+ R或在M1 Mac上按住电源按钮）</p><p>   In 2018, Apple introduced a slate of Macs with a new security co-processor called  T2. With this new Secure Enclave CPU, Apple moved from a pattern of software encryption (FileVault2) to automatic hardware encryption. In 2020, on the newly introduced Apple Silicon Macs, a similar Secure Enclave is built right into the M1 SoC.</p><p>   在2018年，苹果推出了一系列配备了新的安全协处理器T2的Mac。借助这种新的Secure Enclave CPU，Apple从软件加密（FileVault2）模式转变为自动硬件加密。 2020年，在新推出的Apple Silicon Mac上，M1 SoC中内置了类似的Secure Enclave。 </p><p> Both the T2 and the M1 Secure Enclave securely store a 256-bit AES key (UID) which cannot be directly accessed and is burnt into the chip, protecting both the SSD’s data and the TouchID sensor’s stored fingerprints, as well as disabling the device’s camera and microphone when the computer is locked.</p><p>T2和M1 Secure Enclave均安全地存储无法直接访问并被烧入芯片的256位AES密钥（UID），从而保护SSD的数据和TouchID传感器存储的指纹，并禁用设备的相机和麦克风（当计算机锁定时）。</p><p> What this means in practice, is that the data on a Mac’s disk cannot be accessed once the disk is physically separated from the Mac or if the underlying encryption key is lost. In fact, if your Secure Enclave is damaged or wiped, this encryption will prevent you from accessing any of the contents of the drive. This is yet another failure mode one must negate with backups ( which come with their own encryption considerations)</p><p> 实际上，这意味着一旦将磁盘与Mac物理分离，或者基本的加密密钥丢失，就无法访​​问Mac磁盘上的数据。实际上，如果您的Secure Enclave损坏或擦拭，则此加密将阻止您访问驱动器的任何内容。这是另一种必须与备份无效的失败模式（备份具有其自身的加密注意事项）</p><p>  Before the introduction of the T2 security chip, disk encryption was synonymous with FileVault configuration on macOS. However, with hardware encryption this distinction became multi-faceted. This nuance was particularly problematic for security agents that did not differentiate between a disk that was ‘encrypted’ and a device that had FileVault configured.</p><p>  在引入T2安全芯片之前，磁盘加密与macOS上的FileVault配置同义。但是，通过硬件加密，这种区别变得多方面的。对于无法区分“加密”磁盘和配置了FileVault的设备的安全代理来说，这种细微差别尤其成问题。</p><p> Unfortunately, osquery fell into that camp, and its  disk_encryption table simply returned a boolean value for the column  encrypted, leading many to draw an erroneous conclusion causing a false sense of security.</p><p> 不幸的是，osquery陷入了这个阵营，它的disk_encryption表仅返回了加密列的布尔值，从而导致许多人得出错误的结论，从而产生了错误的安全感。</p><p>  This issue was discovered when the output of common macOS terminal utilities ( diskutil apfs list and  fdesetup status) returned different information from what was observed when querying devices using osquery.</p><p>  当常见的macOS终端实用程序的输出（diskutil apfs列表和fdesetup状态）返回的信息不同于使用osquery查询设备时所观察到的信息时，便发现了此问题。</p><p> This issue proved initially difficult to track down, due to the false-negative nature. It is often easier to track down a coding issue producing a false-positive but an intermittent false negative can be truly maddening. Because users are encouraged during setup to configure FileVault on new devices it is uncommon to see devices without it, this coupled with the fact that the table worked as expected on older hardware, led to a difficulty in establishing a pattern and subsequently a lag-time in discovery.</p><p> 由于假阴性性质，最初证明此问题难以追查。通常更容易找出产生假阳性的编码问题，但是间歇性假阴性确实令人发疯。因为在安装过程中会鼓励用户在新设备上配置FileVault，所以很少看到没有该设备的设备，再加上该表在较旧的硬件上按预期工作，从而导致难以建立模式并随后出现延迟在发现中。</p><p> Fortunately with some additional reverse engineering of Kolide  updated its own agent and  Osquery itself to report this data accurately. At the time of this writing the Osquery core-team has not issued an official release containing this fix, but building the agent yourself should net the new column you need.</p><p> 幸运的是，Kolide进行了一些其他的逆向工程，从而更新了自己的代理和Osquery本身，以准确地报告此数据。在撰写本文时，Osquery核心团队尚未发布包含此修复程序的正式版本，但是您自己构建代理应该将您需要的新列扣除。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.kolide.com/modern-macs-still-need-filevault-d5e2f55c083b">https://blog.kolide.com/modern-macs-still-need-filevault-d5e2f55c083b</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/filevault/">#filevault</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/macs/">#macs</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/加密/">#加密</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>