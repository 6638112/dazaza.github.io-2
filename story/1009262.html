<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>延迟和窗户破碎的故事</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">延迟和窗户破碎的故事</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-01 21:36:48</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/7/a3c9cab62400a33c0e87849a321d80e7.jpg"><img src="http://img.diglog.com/img/2020/7/a3c9cab62400a33c0e87849a321d80e7.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>所有的文章，即使不是准确的和最新的2020年，它的主旨是明确的。有些操作(磁盘、网络)比其他操作更昂贵。在寻求最大限度地减少延迟时，请从更可能耗时较长的操作开始，因为由于硬件和光速的限制，这些操作自然会较慢。</p><p>延迟的重要性将取决于您正在编写的软件。对于某些软件延迟可能是业务关键型的：</p><p>当网站运行缓慢时亏损的电子商务(参见这篇关于亚马逊的很棒的博客文章)。</p><p>您可能还需要编写“足够快”或“不必要的慢”的软件。</p><p>虽然获得关键情况的具体延迟保证需要大量的工作和投资，但除非您注意，否则延迟也是很容易被忽视的事情之一。随着时间的推移，小决策可能会堆积起来，最终得到的产品可能会比应有的速度慢得多，这主要是因为偶然的复杂性，而不是本质的复杂性。</p><p>“破窗”理论很好地提出了这个问题(出自维基百科)：破窗理论是一种犯罪学理论，它认为明显的犯罪迹象、反社会行为和公民骚乱创造了一个鼓励进一步犯罪和混乱的城市环境，包括严重的犯罪。该理论认为，针对破坏公物、游荡、公共饮酒、乱穿马路和逃票等轻微犯罪的警察方法有助于创造有序和合法的氛围，从而防止更严重的犯罪。</p><p>无论理论是否正确(在“魔鬼经济学”一书中有一个关于这一点的有趣章节)，这都是谈论软件的一个有用的背景。在软件行业，实用程序员一书中写道“不要与破碎的窗口共存”。如果我们将这一点应用于延迟，很容易得出这样的结论：如果您让小的决策/更改增加了延迟，随着时间的推移，系统的延迟将随着时间的推移而不断增加。在某些情况下，回去解决问题会过于复杂，有时团队会决定寻找复杂的解决方案来解决这个问题。我们想要避免这种情况。</p><p>我们在Auth0做的一件事是迭代交付。代码的初始版本可以工作并经过测试等，但在我们与客户验证功能之前，我们会避免投资于优化。</p><p>但是，有些事情可以在初始实现中完成，因此我们不需要在以后进行优化，因为作为开发人员，您可以在那时了解您正在做的事情。几周后重新思考许多小决定并不理想。在这种情况下，明智地考虑“昂贵的操作”延迟是有用的。</p><p>作为项目的一部分，我们正在开发一个新服务(new-service)，并从现有服务(客户端)添加一些调用。当我们与团队一起检查我们对客户所做的更改时，我们发现了几个改进的机会。</p><p>下面的代码片段是使用Javascript编写的示例，但是这些想法与语言无关。</p><p>当I/O操作不相互依赖并且您需要所有数据时，如果可能，请使用并行查询。</p><p>const a=等待callExistingService(.)；+const b=等待callNewService(.)；+//对a和b执行某些操作。</p><p>getDataFromNewService(.)。Call执行网络I/O。因为我们正在开发这个新服务，所以我们知道它还会执行更多的网络I/O操作来与数据库对话(可能需要执行一些磁盘I/O操作)。所有这些操作自然都属于本文开头表格中的慢端。</p><p>如果我们无法避免这些操作，那么并行执行这些操作会带来一些明显的好处。如果生成的代码如下所示：</p><p>如果我们将这些操作的时间称为T1(现有服务)和T2(新服务)，则在上一个示例中，我们将延迟从sum(t1，t2)更改为max(t1，t2)。这甚至意味着，如果我们不想使延迟比原始延迟更高，我们所需要做的就是确保t2&lt；=t1！</p><p>当I/O操作OP2仅在OP1可能成功时才运行时，如果OP1在大多数情况下可能成功，请考虑并行执行OP2(预取)。</p><p>这个案例与前一个案例类似，但可能更容易遗漏。假设更改后的代码如下所示：</p><p>Const Param=.。常量EXISTS=等待callExistingService(参数)；如果(！EXISTS){//处理边缘情况}+const b=等待callNewService(参数)；+//对b执行某些操作。</p><p>这两个函数调用都依赖于param，该参数在调用callExistingService(Param)之前可用。如果eXist为false的可能性很低，那么并行调用callNewService(Param)可能是值得的。如果存在=false，您将不会向新服务添加更多负载，但是您将获得前面提到的并行I/O的好处。</p><p>Const Param=.。const[存在，b]=等待承诺。all([callExistingService(Param)，callNewService(Param)])；IF(！EXISTS){//处理边缘大小写}//处理b。</p><p>最佳性能/延迟优化是“无操作(no-op)”，即找出如何防止调用发生。实现这一点的一种简单方法是缓存。但是，重要的是要考虑到缓存不需要过于复杂，并且需要每个开发人员最喜欢的锤子Redis。它只意味着存储计算值，以防止再次执行计算。</p><p>在这种情况下，客户端有一种方法可以存储上一次调用返回相同值的new-service的结果。如果结果相对较小且没有更改，则可以将其与上下文一起存储，并将其作为hyateContext()的一部分加载。这样，我们就可以简单地避免调用callNewService(context.param)；。</p><p>在处理代码时，不要过早优化。然而，我建议你在提交公关前添加一份“心理清单”，重点关注延迟，并将其划掉。这会帮你找到唐纳德·努斯的3%。</p><p>很可能仅仅是这样做并专注于10分钟的延迟可能会表明您可以做一些小但有价值的改进，并随着时间的推移积累延迟。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://yenkel.dev/posts/a-tale-of-latency-and-broken-windows">https://yenkel.dev/posts/a-tale-of-latency-and-broken-windows</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/窗户/">#窗户</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/latency/">#latency</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/延迟/">#延迟</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1008779.html"><img src="http://img.diglog.com/img/2020/6/thumb_1ff4cd858ac0b98e999e94769966f47a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008779.html">微软新的“Windows文件恢复”工具可恢复已删除的数据</a></div><span class="my_story_list_date">2020-6-29 4:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1008457.html"><img src="http://img.diglog.com/img/2020/6/thumb_65d5116a9820eb22ac810bd327fc2969.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008457.html">Windows 10内部版本2004中的新功能</a></div><span class="my_story_list_date">2020-6-27 0:30</span></div><div class="col-sm"><div><a target="_blank" href="/story/1008381.html"><img src="http://img.diglog.com/img/2020/6/thumb_8781ce98da4384873db5617acb471c13.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008381.html">微软从Windows Update中删除手动延迟“以防止混淆”</a></div><span class="my_story_list_date">2020-6-26 19:18</span></div><div class="col-sm"><div><a target="_blank" href="/story/1008223.html"><img src="http://img.diglog.com/img/2020/6/thumb_f424708660f30cb6c0d6a8fa20e200ee.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1008223.html">Microsoft UI犯罪20年</a></div><span class="my_story_list_date">2020-6-26 0:38</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>