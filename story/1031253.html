<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我们选择Java作为高频交易应用程序</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">我们选择Java作为高频交易应用程序</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-26 23:54:44</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/10/3135a88f5c95852430c2739231b50a1f.jpeg"><img src="http://img2.diglog.com/img/2020/10/3135a88f5c95852430c2739231b50a1f.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>在高频交易领域，自动化应用程序每天处理数亿个市场信号，并在全球不同的交易所发回数千个订单。</p><p>为了保持竞争力，反应时间必须始终如一地保持在微秒级，特别是在“黑天鹅”等不寻常的高峰期。</p><p>在典型的体系结构中，金融交易信号将被转换成单一的内部市场数据格式(交易使用各种协议，例如TCP/IP、UDP多播和多种格式，例如二进制、SBE、JSON、FIX等)。</p><p>然后，这些标准的ISED消息被发送到算法服务器、统计引擎、用户界面、日志服务器和所有类型的数据库(内存中的、物理的、分布式的)。</p><p>这条道路上的任何延迟都可能产生代价高昂的后果，比如根据旧价格做出决策的策略，或者订单到达市场太晚。</p><p>为了获得这几个关键的微秒，大多数玩家投资于昂贵的硬件：配备超频液体冷却CPU的服务器池(2020年你可以购买56个内核、5.6 GHz和1TB RAM的服务器)、主要交换数据中心的配置、高端纳秒网络交换机、专用海底线路(Hiberian Express是主要供应商)，甚至是微波网络。</p><p>常见的情况是，高度定制的Linux内核绕过了操作系统，数据直接从网卡“跳”到应用程序、进程间通信(IPC)，甚至FPGA(可编程的单一用途芯片)。</p><p>至于编程语言，C++似乎是服务器端应用程序的天然竞争者：它速度很快，尽可能接近机器代码，并且一旦为目标平台编译，就会提供恒定的处理时间。</p><p>在过去的14年里，我们一直在用Java编写的FX算法交易空间编码和使用伟大但负担得起的硬件方面展开竞争。</p><p>由于团队规模小，资源有限，而且就业市场缺乏熟练的开发人员，Java意味着我们可以快速添加软件改进，因为Java生态系统比C衍生品的上市时间更快。改进可以在上午讨论，下午在生产中实施、测试和发布。</p><p>与大公司进行最轻微的软件更新需要几周甚至几个月的时间相比，这是一个关键的优势。在一个一个漏洞可以在几秒钟内抹去一整年利润的领域，我们还没有准备好在质量上妥协。我们使用许多开源库和项目实现了严格的敏捷环境，包括Jenkins、Maven、单元测试、夜间构建和Jira。</p><p>使用Java，开发人员可以专注于直观的面向对象的业务逻辑，而不是像在C++中那样调试一些模糊的内存核心转储或管理指针。而且，由于Java强大的内部内存管理，初级程序员也可以在第一天增加价值，风险有限。</p><p>有了良好的设计模式和干净的编码习惯，使用Java就有可能达到C++延迟。</p><p>例如，Java将优化和编译在应用程序运行期间观察到的最佳路径，但C++会预先编译所有内容，因此即使是未使用的方法也仍将是最终可执行二进制文件的一部分。</p><p>然而，有一个问题，也是一个需要引导的主要问题。Java之所以成为如此强大和令人愉快的语言，也是因为它的衰落(至少对于微秒敏感的应用程序而言)，即Java虚拟机(JVM)：</p><p>Java按原样编译代码(Just in Time编译器或JIT)，这意味着当它第一次遇到某些代码时，会导致编译延迟。</p><p>Java管理内存的方式是在其“堆”空间中分配内存块。每隔一段时间，它就会清理那个空间，移走旧的东西，为新的腾出空间。主要问题是，为了进行准确的计数，应用程序线程需要暂时“冻结”。此过程称为垃圾收集(GC)。</p><p>GC是低延迟应用程序开发人员可能先验地抛弃Java的主要原因。</p><p>最常见和最标准的是Oracle HotSpot JVM，它在Java社区中广泛使用，主要是由于历史原因。</p><p>Zing是标准Oracle HotSpot JVM的强大替代品。Zing同时解决了GC暂停和JIT编译问题。</p><p>让我们研究一下使用Java所固有的一些问题和可能的解决方案。</p><p>像C++这样的语言被称为编译语言，因为交付的代码完全是二进制的，可以直接在CPU上执行。</p><p>PHP或Perl之所以称为解释程序，是因为解释器(安装在目标机器上)在执行过程中编译每一行代码。</p><p>Java介于两者之间；它将代码编译成所谓的Java字节码，然后在它认为合适的时候将其编译成二进制代码。</p><p>Java不在启动时编译代码的原因与长期性能优化有关。通过观察应用程序运行并分析实时方法调用和类初始化，Java编译频繁调用的代码部分。它甚至可能根据经验做出一些假设(这部分代码永远不会被调用，或者这个对象始终是一个字符串)。</p><p>一个方法需要被调用一定的次数才能达到编译阈值，然后才能对其进行优化和编译(该限制是可配置的，但通常在10,000个调用左右)。在此之前，未经优化的代码不会以“全速”运行。在获得更快的编译和获得高质量的编译之间有一个折衷方案(如果假设是错误的，将会有重新编译的成本)。</p><p>当Java应用程序重新启动时，我们又回到了起点，必须等待再次达到该阈值。</p><p>有些应用程序(像我们的)有一些不太频繁但很关键的方法，这些方法只会被调用几次，但在调用时需要非常快(想想只有在紧急情况下才会调用的风险或止损过程)。</p><p>Azul Zing通过让其JVM将编译的方法和类的状态“保存”在它所称的配置文件中来解决这些问题。这项名为ReadyNow！®的独特功能意味着Java应用程序始终以最佳速度运行，即使在重新启动之后也是如此。</p><p>当您使用现有配置文件重新启动应用程序时，Azul JVM会立即调用其以前的决策，并直接编译概述的方法，从而解决了Java预热问题。</p><p>此外，您可以在开发环境中构建配置文件来模拟生产行为。然后，在知道所有关键路径都已编译和优化的情况下，可以将优化后的配置文件部署到生产中。</p><p>下图显示了交易应用程序的最大延迟(在模拟环境中)。</p><p>HotSpot JVM的大延迟峰值清晰可见，而Zing的延迟随着时间的推移保持相当恒定。</p><p>百分位数分布表明，在1%的时间内，HotSpot JVM产生的延迟是Zing JVM的16倍。</p><p>第二个问题是，在垃圾收集期间，整个应用程序可能会冻结几毫秒到几秒之间的任何时间(延迟随着代码复杂性和堆大小而增加)，更糟糕的是，您无法控制何时发生这种情况。</p><p>虽然暂停应用程序几毫秒甚至几秒钟对于许多Java应用程序来说可能是可以接受的，但对于低延迟应用程序来说，无论是在汽车、航空航天、医疗还是金融领域，这都是一场灾难。</p><p>GC的影响在Java开发人员中是一个大话题；完整的垃圾回收通常被称为“停止世界的暂停”，因为它冻结了整个应用程序。</p><p>多年来，许多GC算法都试图在吞吐量(有多少CPU花在实际应用程序逻辑上，而不是垃圾收集上)与GC暂停(我可以暂停应用程序多长时间？)之间进行折衷。</p><p>从Java9开始，G1收集器一直是默认的GC，其主要思想是根据用户提供的时间目标分割GC暂停。它通常提供较短的暂停时间，但代价是吞吐量较低。此外，暂停时间随着堆的大小而增加。</p><p>Java提供了大量设置来调优其垃圾收集(以及一般的JVM)，从堆大小到收集算法，以及分配给GC的线程数量。因此，经常会看到Java应用程序配置了过多的自定义选项：</p><p>许多开发人员(包括我们的开发人员)已经转向各种技术来完全避免GC。主要是，如果我们创建的对象较少，则稍后要清除的对象也会较少。</p><p>一种旧的(仍在使用的)技术是使用可重用对象的对象池。例如，数据库连接池将包含对10个打开的连接的引用，这些连接随时可以根据需要使用。</p><p>多线程通常需要锁定，这会导致同步延迟和暂停(特别是在它们共享资源的情况下)。一种流行的设计是环形缓冲区队列系统，其中有许多线程在无锁设置中进行写入和读取(请参阅中断程序)。</p><p>出于沮丧，一些专家甚至选择完全覆盖Java内存管理，自己管理内存分配，这在解决一个问题的同时，也带来了更多的复杂性和风险。</p><p>在这种情况下，很明显我们应该考虑其他JVM，我们决定尝试Azul Zing JVM。</p><p>这是因为Zing使用了一个名为C4(持续并发压缩收集器)的独特收集器，该收集器允许暂停垃圾收集，而不管Java堆大小如何(最高可达8TB)。</p><p>这是通过在应用程序仍在运行时并发映射和压缩内存来实现的。</p><p>此外，它不需要任何代码更改，并且延迟和速度改进开箱即可见，无需冗长的配置。</p><p>在这种情况下，Java程序员可以同时享受Java的简单性(不需要对创建新对象感到偏执)和Zing的底层性能，从而在整个系统中实现高度可预测的延迟。</p><p>多亏了GC Easy(一个通用的GC Log分析器)，我们可以在一个真实的自动化交易应用程序中(在模拟环境中)快速比较这两个JVM。</p><p>在我们的应用程序中，使用Zing的GC比使用标准Oracle HotSpot JVM的GC小180倍。</p><p>更令人印象深刻的是，虽然GC暂停通常与实际的应用程序暂停时间相对应，但Zing智能GC通常在最少或没有实际暂停的情况下并行发生。</p><p>总而言之，在享受Java的简单性和面向业务的本质的同时，仍然有可能实现高性能和低延迟。虽然C++用于特定的低级组件，如驱动程序、数据库、编译器和操作系统，但大多数现实生活中的应用程序都可以用Java编写，即使是要求最高的应用程序也可以。</p><p>这就是为什么，根据甲骨文的说法，Java是排名第一的编程语言，在全球拥有数百万开发人员和超过510亿台Java虚拟机。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://medium.com/@jadsarmo/why-we-chose-java-for-our-high-frequency-trading-application-600f7c04da94">https://medium.com/@jadsarmo/why-we-chose-java-for-our-high-frequency-trading-application-600f7c04da94</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/java/">#java</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/交易/">#交易</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/选择/">#选择</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1030931.html"><img src="http://img2.diglog.com/img/2020/10/thumb_b6d2f44664370d45e7761c500cdb97d3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030931.html">对159个国家的17K名开发人员的调查：JavaScript是最受欢迎的语言，有1240万活跃开发人员，紧随其后的是Python，有900万，然后是Java，有820万</a></div><span class="my_story_list_date">2020-10-24 14:8</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030341.html"><img src="http://img2.diglog.com/img/2020/10/thumb_733063352387ad74429fbef6e0502443.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030341.html">Java版正在搬家</a></div><span class="my_story_list_date">2020-10-22 8:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030251.html"><img src="http://img2.diglog.com/img/2020/10/thumb_54a6207715e32873cfcce2d6c085fa72.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030251.html">使用const/let而不是var可以使Webkit中的JavaScript代码运行速度降低10倍</a></div><span class="my_story_list_date">2020-10-21 12:31</span></div><div class="col-sm"><div><a target="_blank" href="/story/1029755.html"><img src="http://img2.diglog.com/img/2020/10/thumb_becaf3f5344ab6de2a56ccf6d56a83a8.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1029755.html">MonSpace：1021字节的JavaScript演示，演示竞赛的获胜者</a></div><span class="my_story_list_date">2020-10-19 17:18</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>