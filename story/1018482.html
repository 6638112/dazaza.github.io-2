<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>关于在数据中心扩展OSPF，我了解到了什么</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">关于在数据中心扩展OSPF，我了解到了什么</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-16 19:57:20</div><div class="page_narrow text-break page_content"><p>我在亚马逊做了17年的网络工程师。现在我离开了亚马逊，看看这个行业，我正在学习新的东西。我最近学到的一件事是，由于规模的原因，OSPF不应该用于Clos叶主干网络。我听说它跟不上现代数据中心网络的规模和规模。Juniper IP Fabric Underlay Network Design and Implementation就是该建议的一个示例。Https://tools.ietf.org/html/rfc7938是在大型CLOS网络中使用eBGP作为路由协议的参考。</p><p>这让我感到震惊，因为我们十年前就建立了大型OSPF Clos网络。我们用数百台(甚至数千台)使用OSPF的路由器以这种方式构建网络。我不是说这很容易，也不是说我们不需要很好地理解OSPF；如果你设计得不好，你就会遭受洪灾。但是如果你把它设置好了，它真的工作得很好。它收敛得很快，在失败的情况下不会崩溃。关键是要确保您了解泛洪是如何工作的，并将重点放在区域和总结上。在使用BGP和OSPF设计Clos网络时，您需要注意不同的事项。使用BGP，您必须弄清楚如何减轻路径搜索。OSPF需要研究如何避免拥塞崩溃。</p><p>还有为这些大型CLO或类似CLO的网络(如https://datatracker.ietf.org/wg/rift/documents/.)构建新协议的工作。我不明白为什么OSPF或ISIS不够好，所以我不明白为什么它们是必要的。Rift有一些好的想法，我只是还没有看到使用它的理由。</p><p>当我们这样做时，我们使用的是2003年的CPU，我们使用的是一个鲜为人知的OSPF堆栈。它的OSPF实现还可以，但是开发人员强烈警告我们不要使用他们的BGP实现。我们必须了解并降低风险。我们必须尽可能地对其进行测试，并且在第一次部署时非常小心。这个堆栈以前从未进行过这样的战斗测试。我们仍然遇到了一些可怕的性能问题，但我们在协议栈上与优秀的软件工程师一起工作，以解决问题并计算出我们的规模。</p><p>其他人同意我的观点，https://www.youtube.com/watch?v=Qmvg2mnbcPg，，尽管他们主要关注的是比我工作时更小的网络。但无论哪种方式，OSPF都可以在非常大(或很小)的Clos网络上正常工作。</p><p>作为扩展的示例，这是一个通用的24端口3层CLO。使OSPF在这方面发挥作用是可能的。这比我们在2012年的工作规模要小。</p><p>为了了解并降低未知OSPF堆栈的大规模风险，我开始构建配置管理系统，并开始模拟我们的网络设计。我们需要了解任何OSPF协议栈是如何工作的。我们能让协议变得更具规模吗？我们需要看看真正的OSPF实施会发生什么情况。我再怎么强调这个模拟的重要性也不为过。我们不了解洪水问题，也不了解解决方案，直到我们在模拟中进行了试验。</p><p>在此之前，我们在白板上花了很多时间讨论拓扑和OSPF。我认为白板是目前可用的最重要的网络设计工具，这让我很难过。我希望那不是真的，我想要更好的工具。我甚至不能告诉你2-3个伟大的网络工程师在白板上争论避免了多少灾难。这真的很有效，但也有一些重要的原因不够好。其中之一是，对于许多这样的讨论，要获得数据来做出决定是极其困难的。在这种情况下，需要将3层Clos中的收敛时间和故障检测与eBGP、iBGP和OSPF进行比较，但我们没有该功能。</p><p>在密集的网状网络(如Clos网络)中，围绕OSPF的担忧围绕四个主要问题展开：泛洪的影响、链路状态数据库的大小、SPF计算的速度以及OSPF承载大量前缀的能力。我们担心的是OSPF的伸缩性(w.r.t.)。它的泛洪，链路状态数据库协议的泛洪是昂贵的，而不是最短路径优先(SPF)计算。这意味着你必须非常小心什么是被淹没的，哪些是区域，以及事情是如何总结的。我不明白这一点，直到我有了一个模拟，我可以尝试有区域或没有区域的东西，效果是戏剧性的。我认为通常情况下，设计中有一部分是你不理解的，这是做仿真的主要原因之一。我们没有能力建立一个像我们将要建设的那样大的网络，所以模拟是至关重要的。我甚至无法想象如果没有它我们会做什么。基于模拟，我们为真实硬件创建了有针对性的测试，以了解它将如何处理规模。</p><p>本文的重点不是OSPF比BGP更好，而是它确实可以在非常大的Clos网络中工作。我感到沮丧的是，这个行业的这么多人在没有很好的数据或分析的情况下，仅仅遵循一套观点和设计选择就走上了一个方向。我希望有一些简单的方法让人们能够设计、模拟和测试像这样的不同设计，这样他们就可以自己决定他们想要做的权衡，而不是依赖于某种类型的行业炒作。需要有一种更好的方法来描述拓扑和设计，这样才能真正容易地尝试不同的想法。</p><p>如果您有其他考虑因素，比如您想运行IPv6或EVPN，那么eBGP的单个实例(如开源路由套件FRR所普及的实例)可能是最简单或最优雅的。但是，如果设计得当，规模并不是使用BGP而不是OSPF的原因。如果您运行的是小型Clos网络，并且没有IPv6或EVPN，则OSPF更简单，通常速度更快，这是BGP在数据中心出现之前的常见做法。</p><p>无论如何，您都需要了解您正在做出的选择，并了解其中的权衡。这很难做到，尤其是在网络领域，因为我们缺乏设计模式和好的工具来帮助我们理解我们选择的含义。</p><p>如果有人知道工具或设计模式，甚至有人在Clos网络中实际比较了OSPF和BGP的数据，我很想听听。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://elegantnetwork.github.io/posts/What-Ive-learned-about-OSPF/">https://elegantnetwork.github.io/posts/What-Ive-learned-about-OSPF/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/扩展/">#扩展</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/learned/">#learned</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ospf/">#ospf</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1017337.html"><img src="http://img.diglog.com/img/2020/8/thumb_66fc0657386195b08e2998a100c5d5c3.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1017337.html">谷歌扩展了Android TV的开发者工具，包括即时应用和语音到文本的支持，并表示月度活跃设备同比增长超过80%</a></div><span class="my_story_list_date">2020-8-10 22:20</span></div><div class="col-sm"><div><a target="_blank" href="/story/1015897.html"><img src="http://img.diglog.com/img/2020/8/thumb_692a7458cb5cd892e42f448fdf7f0c04.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1015897.html">谷歌最新的Chrome扩展显示了详细的广告跟踪数据</a></div><span class="my_story_list_date">2020-8-3 21:40</span></div><div class="col-sm"><div><a target="_blank" href="/story/1013460.html"><img src="http://img.diglog.com/img/2020/7/thumb_59a50acdd7760213f2c0d87b9c97d478.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1013460.html">
印度顶级健身和福利初创公司Cure.fit扩展到美国。</a></div><span class="my_story_list_date">2020-7-22 19:54</span></div><div class="col-sm"><div><a target="_blank" href="/story/1012627.html"><img src="http://img.diglog.com/img/2020/7/thumb_397af1b71b97abe3c822965463c22a78.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1012627.html">喀麦隆大幅削减购买.cm域名的费用</a></div><span class="my_story_list_date">2020-7-18 5:17</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>