<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>C11和C17标准支持抵达MSVC</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">C11和C17标准支持抵达MSVC</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-09-15 17:54:57</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/9/7ea8c0bd130e5a9a7fa2b2c5bed2c49f.png"><img src="http://img2.diglog.com/img/2020/9/7ea8c0bd130e5a9a7fa2b2c5bed2c49f.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>有关我们的更多最新功能，请参阅我们的Visual Studio 2019版本16.8预览版3发行说明。</p><p>我们的团队很高兴地宣布，从Visual Studio 2019版本16.8预览版3开始，C11和C17将成为MSVC编译器工具集中受支持的语言版本！</p><p>多年来，Visual Studio只支持C++所需的C语言。现在编译器中添加了符合要求的基于令牌的预处理器，情况即将发生变化。随着两个新的编译器开关/std：c11和/std：c17的出现，我们正式支持最新的ISO C语言标准。</p><p>支持C11和C17的所有必需功能。这意味着添加以下功能：</p><p>IntelliSense本身也可以使用这些功能，只需对源文件使用.c文件扩展名，或者使用/TC编译器开关来启用C代码的语法突出显示。</p><p>目前，智能感知突出显示仅适用于关键字，而不适用于标准标头引入的宏。此问题将在以后的版本中修复。</p><p>由于C17本质上只是ISO C的错误修复版本，采用了许多缺陷报告，因此我们对C11的支持已经包括了所有相关的缺陷报告。目前C11和C17版本没有区别，除了__STDC_VERSION__宏扩展到201112L(C11)和201710L(C17)。</p><p>#include&lt；assert.h&gt；#include&lt；stdalign.h&gt；#include&lt；stdlib.h&gt；#include&lt；stdnorereturn.h&gt；#定义no_warn(X)\_Pragma(&#34；Warning(Push)&#34；)_Pragma(&#34；Warning(Disable：4146)&#34；)X；\_Pragma(&#。)//根据DST的类型选择STORED或STORE#DEFINE STORE(x，y)_GENERIC((X)，\DATA*：STORED，\int*：STORE)(x，y)tyfinf struct data{_Alignas(8)unsign int i；}data；static_assert(alignof(Data)=8，&#34；data is not right&#34；)；void store(data*restrict dst，const data*restrict src){。I=no_warn(-(src-&gt；i))；}void store(int*restricte dst，const int*restriction src){*dst=*src；}noreturn void my_exit(Int Ret){exit(Ret)；}int main(){data src，dst；src.i=5；int i，j；i=10；store(&amp；src，&amp；dst)；store(&amp；i，</p><p>由于包含了基于令牌的符合预处理器，所以两个新的C编译器开关暗示了/Zc：preessor。如果希望将传统的、基于字符的预处理器与C11或C17一起使用，则需要显式传入/Zc：pre处理器-编译器开关。我们鼓励您在不依赖传统的传统预处理器的情况下，在需要的地方修复源代码。</p><p>虽然目前不支持任何C11可选功能，但我们承诺在未来版本中提供最有效的可选功能。原子和线程支持在我们的路线图上。目前没有计划支持复数，它们的缺失是通过适当的功能测试宏来强制执行的。请转到Visual Studio开发人员社区，表达您对希望实现的功能的支持。我们正在等待您的意见，我们正在进行正确的优先排序。</p><p>由于Windows堆的性质，不支持ALIGNED_ALLOC。另一种方法是使用_aligned_malloc。</p><p>此外，目前没有为realloc实现DR 400支持，因为此更改会破坏ABI。</p><p>敏锐的读者会注意到，VLA也不受支持。当安全可靠地实现时，可变长度数组通常比可比的固定大小数组效率低，并且与等效的malloc()相比通常效率较低。VLA提供了可与臭名昭著的get()相媲美的攻击向量(已弃用并注定要删除)，以提供“转移堆栈”和其他利用的机会。出于这些原因，我们不打算将VLA作为C11中的可选功能来支持。</p><p>为了在您的程序中使用C11或C17，需要最新的Windows SDK更新才能与符合标准的预处理器(/Zc：preessor)和新的Universal C Runtime一起正常工作。Windows SDK版本与Windows OS版本相对应。由于没有包含这些更改的Windows版本，您将需要一个Insider Preview Windows SDK-Windows SDK的预览版，它与Windows内部人员当前正在运行的Windows版本相对应。请注意，安装Insider预览版Windows 10 SDK后，配置为使用最新Windows SDK的Visual Studio项目将使用Insider预览版。</p><p>任何人都可以创建一个免费的微软帐户(https://signup.live.com/))，然后选择加入“内幕”计划。只需转到https://insider.windows.com/en-us/for-developers并单击“注册”并登录即可。</p><p>注册后，您可以选择开始运行Insider版本的Windows，但这不是下载和使用Insider Windows 10 SDK所必需的。注册不会自动选择您的计算机下载新的Windows航班。</p><p>一旦您进入此页面，您就不需要单击“立即飞行”。继续执行下一步并下载Insider Preview Windows 10 SDK。</p><p>Insider Preview Windows SDK可以从https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewSDK.安装。如果这不是您收到的页面，请确保您使用已选择成为Insider的Microsoft帐户登录。</p><p>Insider页面描述需要使用Windows 10 Insider预览版操作系统。对于Windows SDK中包含的某些内容也是如此，因为它们可能依赖于旧版本的Windows中没有的新API，但Windows和Universal C Runtime标头可以正确安装并在没有Insider操作系统的情况下可用。</p><p>点击“获取SDK Insider预览版-内部版本20206”开始下载。Windows SDK的未来版本也将正常工作。</p><p>选择在此计算机上安装Windows软件开发工具包，然后单击“下一步”。您必须选择是否允许深入了解Windows SDK的使用情况，并且在到达功能安装页面之前必须接受许可协议。您应该安装的唯一功能(除非您使用的是Windows 10的Insider预览版)是：</p><p>SDK需要几分钟时间才能完成安装，然后您就可以打开Visual Studio 16.8 Preview 3。</p><p>从Visual Studio16.8预览版3开始支持C11和C17。您可以通过https://visualstudio.microsoft.com/vs/preview/.下载最新的预览版。</p><p>在项目中，打开“属性”页。首先，我们希望确保项目将使用Insiers Preview Windows10SDK。将Windows SDK版本设置为10.0.20206.0(或刚刚安装的最新Insider Preview Windows 10 SDK)。</p><p>您还将看到一个新选项：C语言标准。将其设置为ISO C11标准(/std：c11)或ISO C17(2018)标准(/std：c17)。</p><p>当语言为C++时使用C++语言标准-当文件扩展名为.cpp时，这将是默认设置。当语言为C时使用C语言标准版本-当文件扩展名为.c时，这将是默认版本。为了确保项目是使用C11或C17构建的，您必须确保它是一个.C文件，或者在Properties选项卡中将代码设置为编译为C。</p><p>我们非常激动能够最终支持C11和C17！作为得票率最高的开发者社区建议，我们相信您也会感到兴奋。如果您希望支持C11的可选功能，请在开发者社区上与我们联系。</p><p>我们一如既往地欢迎您的反馈。您可以通过下面的评论或电子邮件(viewalcpp@microsoft.com)联系我们。如果您在使用Visual Studio或MSVC时遇到问题，或对我们有建议，请通过帮助&&gt;；发送反馈&&gt;报告产品中的问题/提供建议，或通过开发人员社区通知我们。您也可以在Twitter(@VisualC)上找到我们。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://devblogs.microsoft.com/cppblog/c11-and-c17-standard-support-arriving-in-msvc/">https://devblogs.microsoft.com/cppblog/c11-and-c17-standard-support-arriving-in-msvc/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/c17/">#c17</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>