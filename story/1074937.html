<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>这些强烈的喜悦</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">这些强烈的喜悦</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-25 17:51:15</div><div class="page_narrow text-break page_content"><p>我&#39；在过去的几天里，我一直在开发一个Inform 6编译器补丁，以收紧生成的代码。在我工作的时候，我在推特上发布了一个童车游戏的截图：</p><p>道路尽头的暴力不是&#39；暴力不是&#39；欢迎来到冒险！暴力不是&#39；答案不是这个。暴力不是&#39；答案不是这个。版本5/序列号961209/通知v6。37.图书馆暴力和#39；回答这个问题。SAt道路终点暴力事件不是&#39；答案不是这个&gt；东内大厦暴力事件不是&#39；答案不是这个。暴力不是&#39；答案不是这个。暴力不是&#39；答案不是这个。暴力不是&#39；答案不是这个。暴力不是&#39；答案不是这个&gt；</p><p>我发推特是因为它很有趣；我的追随者们一致同意。（谢谢大家！）但这是怎么发生的？嘿，我没有&#39；我一段时间没写过代码帖子。让&#39；让我们深入研究一下。</p><p>我的补丁旨在去除死代码。这是什么意思？好吧，假设你写了这样一个Inform 6例程：</p><p>你可能不知道I6，但你可能知道这个函数只是打印&#34；你好&#34; if语句总是错误的，永远不会发生。但是Inform编译器还是在编译第一个print和return语句。我想避免浪费空间。</p><p>在这个简单的例子中，死代码剥离很容易。事实上，I6编译器已经在检测死if语句；它只需要轻轻一推就可以跳过为它生成代码的过程。然而，更复杂的代码样本，嗯，更复杂，我花了几天时间修改算法以使其正确。</p><p>这些变化的关键是一个名为execution_never_Reach_的标志，它的意思正是它所说的，因为Graham Nelson喜欢自我记录代码。如果设置了该标志，则可以跳过生成输出。有趣的部分是确保在编译函数时在正确的时间打开和关闭标志。</p><p>（好吧，这里的“执行”永远不会到达，它的意思并不完全是这样的，因为我在它里面塞进了一些小旗。我不会解释为什么。与这个故事无关。）</p><p>现在，有了&#39；这是通向这个补丁的又一步。在Z-code（和Glulx，但我们在这里重新测试Z-code）中，字符串和代码分别存储在内存中。我&#39；d让编译器跳过生成print和return语句，但是字符串&#34；再见残酷的世界&#34; 仍存储在字符串内存中。</p><p>于是我走进了编译器&#39；s compile_string（）函数，并添加了两行代码，大致如下所示：</p><p>这种变化的意义在于，如果你的打印声明不是&#39；t编译成代码，谁在乎&#39；正在打印什么？compile_string（）必须返回某些内容，因为它的类型是int。但返回的值将被丢弃在地板上。所以我们不妨返回零。</p><p>因此&#39；这很容易，对吧？三行（好的，八行有评论，另一行是现在不重要的检查）。编译编译器，编译。中导，测试。</p><p>欢迎来到冒险！暴力不是&#39；答案不是这个。暴力不是&#39；答案不是这个。版本5/序列号961209/通知v6。37.图书馆暴力和#39；回答这个问题。s</p><p>如果你&#39；你真的很合拍，你可能已经猜到我的错误了。如果没有，我&#39；I’我将以一个段落的间隔来引出悬念。。。</p><p>...我花了所有的时间来确保在函数中正确处理这里的执行。但我忘了检查函数之间发生了什么。事实上，我已经编写了一些清理代码来设置执行_never _reachs _here=-1在每个函数的末尾！然后就忘了是我干的。</p><p>当然，正如我们所说，值-1被认为是真实的。因此，每当编译器遇到函数外部的字符串时——比如全局常量或对象的一部分——它都会自动跳过它并返回零。</p><p>修复很简单：只需清除函数之间的执行_never _reach _为零（false），而不是-1。然后一切正常。</p><p>但是等等。我没有&#39；我什么都没解释！为什么跳过字符串会导致游戏打印&#34；暴力不是&#39；这个问题的答案是#34；到处都是？</p><p>任何用户都熟悉这句话。它&#39；这可能是信息库中最容易识别的信息。它&#39；当你攻击或破坏游戏中没有的东西时会发生什么&#39；t定义为易碎。（或者如果你击中它，或者打架、杀人、谋杀、粉碎、破坏……很多同义词。）</p><p>图书馆默认信息是一门微妙的艺术。你需要一个对玩家可能试图打破的任何东西都合适的回应——在任何游戏中，包括你没有打破的游戏&#39；我没想到。</p><p>这很棘手！假设库默认值为&#34；那&#39；它牢不可破&#34; 这对打破雕像来说是合适的，但它读出了“搏击青蛙”的键——它&#39；It’青蛙怎么会牢不可破并不明显。打碎酒杯&#39；这完全令人困惑。（是的，作者应该为《打碎酒杯》写一篇更好的回复。但图书馆的工作是提供一些足够的东西，如果他们不提供的话。）</p><p>&#34;没有明显的变化&#34；不是&#39；不坏，但它&#39；这也不太好。这意味着玩家试图使用暴力，但没能造成伤害。同样，对于易碎物品来说，这是一种误导。你可以侥幸逃脱&#34；什么都没发生&#34；对于推送动作，因为推送是隐式的。。。有点无聊。（可能物体自由滚动；可能它固定在适当的位置。你可以把这两种结果描述为&#34；什么都没发生。&#34；）但在某些情况下，暴力确实应该产生明显的影响。</p><p>我们想要的是一个反应，这意味着玩家决定不这样做，而且应该尝试其他东西，因为没有实施任何攻击行动。但我们可以&#39；不要说&#34；暴力不是&#39；答案是&#34；因为游戏中的其他东西可能是真正可以攻击的！（毕竟，佐克只有三个可以战斗的怪物——但如果你不战斗，你就不会赢。）我们不得不说&#34；暴力不是&#39；这个问题的答案是&#34；离开球员&#39；我们有很多选择。</p><p>所以&#34；暴力不是&#39；这个问题的答案是#34；这是一个经过仔细调整的妥协。它&#39；在过去的30年里，它一直保持着良好的状态；这是历史。</p><p>（图书馆默认设置的最后一条规则是，它们的语气应该是中立和谦逊的。&#34；暴力不是这个问题的答案。&#34；惊人地失败了——它太令人难忘了！但我们必须允许格雷厄姆·纳尔逊有一些固执己见的时刻，不管怎样，没有它，我的虫子就不会好笑了。还记得我的虫子吗？这是一个非常有趣的问题。）（我在为我的虫子发愁。）</p><p>回想我的错误。我在游戏中省略了某些字符串——所有出现在函数之外的字符串——而是将它们的值记录为零。</p><p>它&#39；很清楚，看看截图，那&#34；欢迎来到冒险&#34; 在函数内部发生。像&#34；发布&#34；和&#34；序列号&#34；和&#34；图书馆&#34；。但是库版本必须是字符串常量。房间和对象描述也是如此。这些都归零了。出于某种原因，零值被打印为&#34；暴力不是&#39；答案不是这个&#34;</p><p>（像&#34；Inside Building&#34；和&#34；the End Of Road&#34；这样的房间名称实际上也是外部功能，但它们重新编译的方式意味着它们是透明的。我不想讨论所有细节。）</p><p>身份线尤其混乱。事实证明，游戏试图打印&#34；得分：34分；和&#34；动作：&#34；在右上角。这些都超出了状态线，完全错了。</p><p>对错文本的混合可能会变得更加愚蠢。我曾经说过：</p><p>你也可以看到暴力不是&#39；答案不是这个。一组按键&#39；这个问题的答案。暴力不是&#39；答案不是这个。美味的食物是&#39；答案不是这个。暴力不是&#39；答案不是这个。小瓶子（暴力不是这个的答案。暴力不是这个的答案。暴力不是这个的答案。暴力不是这个的答案。瓶装水）。</p><p>...这看起来难以描述，直到你意识到游戏正在用字符串常量&#34；a&#34；和&#34；有些&#34；。对象名称很好；短词会被替换。</p><p>所以这一切都有意义。。。除了我们还没有&#39；t解释了零是如何变成暴力的。</p><p>你可能会猜到&#34；暴力不是&#39；这个问题的答案是#34；是游戏中的第一个，或者说是第零个字符串&#39；这是张弦乐桌。而你&#39；你说得对！</p><p>但它是怎么做到的？它&#39；It’当然不是按字母顺序排在第一位。它&#39；这不是游戏中定义的第一个字符串常量。它&#39；这不是英语中定义的第一个字符串。h库文件。它&#39；它甚至不是该文件中LanguageLM（）函数中定义的第一个字符串。</p><p>这让我非常困惑。。。直到我想起I6编译器的一个怪癖。（它有很多怪癖。）在print语句中，短字符串在函数代码中内联编译。（Z代码允许这样做。）更长的字符串——任何超过32个字符的字符串——进入字符串表。</p><p>我&#39；我很确定这条规则是一种降低函数大小的方法。它&#39；很难为很长的函数生成代码，因为Z机器分支操作码的范围有限。游戏作者通常不会&#39；他们不会写很长的函数，但他们有时会写一些打印大量文本的函数。如果所有这些文本都被内联，函数就会变得太长，无法管理。因此，编译器进行了调整，将更大的文本块移动到字符串表中，而字符串表没有&#39；我没有同样的尺寸限制。</p><p>因此&#39；这是调试链中的最后一个环节&#34;暴力不是&#39；这个问题的答案是#34；不是&#39；t是游戏中的第一个字符串，但它是函数库中出现的第一个长字符串。短字符串被内联；函数之外的字符串会被删除。该库在游戏开始前编译。所以&#34；暴力不是&#39；这个问题的答案是#34；是游戏中第一根进入弦表的弦。这使它成为第0个字符串条目。。。其他一切都随之而来。</p><p>&#34;欢迎来到冒险&#34；是（对你和我）一眼就能认出的钩子。然后你发现&#34；在路的尽头&#34；和&#34；大楼内&#34；，这证实了你&#39；在你想一想之后，我们正在看。但它&#39；它充满了&#34；暴力&#34；线，这也是可以识别的，但错了。I6头块很常见，但它&#39；她分手了。你考虑的理论是“34”；暴力&#34；线路被卡在了随机的地方。然后是状态线（熟悉！）用不完整的词再次打破模式，然后是&#34；取笑奥蒂&#34；。到目前为止，你&#39；你完全不知所措。</p><p>（你必须打破垃圾，用垃圾来唱，有时是很棒的垃圾。同样的想法。）</p><p>老实说，它&#39；这正是冒险文本和&#34；暴力不是&#39；答案不是这个&#34; 如果我手动调整它，我可能会坚持#34；闪亮的黄铜灯&#34；在最后五行的某个地方，只是为了再次绊倒人们。但它没有&#39；我不需要它。</p><p>我发誓这完全是偶然的。我没有&#39；除了打字，我什么都不做。有时宇宙只是把它交给你。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/violent/">#violent</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/字符串/">#字符串</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>