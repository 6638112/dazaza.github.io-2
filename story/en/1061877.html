<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在Windows上制作EBPF工作 Making eBPF Work on Windows</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Making eBPF Work on Windows<br/>在Windows上制作EBPF工作 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-05-11 12:29:00</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/5/b978bcefd149fc5fcebcb8c318f8b8d7.jpg"><img src="http://img2.diglog.com/img/2021/5/b978bcefd149fc5fcebcb8c318f8b8d7.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>eBPF is a well-known but revolutionary technology—providing programmability, extensibility, and agility. eBPF has been applied to use cases such as denial-of-service protection and observability. Over time, a significant ecosystem of tools, products, and experience has been built up around eBPF. Although support for eBPF was first implemented in the Linux kernel, there has been increasing interest in allowing eBPF to be used on other operating systems and also to extend user-mode services and daemons in addition to just the kernel.</p><p>EBPF是一种众所周知但革命性的技术提供可编程性，可扩展性和敏捷性。 EBPF已应用于使用拒绝服务和可观察性等案例。随着时间的推移，在EBPF周围建立了一个重要的工具，产品和经验生态系统。尽管在Linux内核中首次对EBPF的支持首次实现，但允许eBPF在其他操作系统上使用甚至延长用户模式服务和守护进程，仍然越来越感兴趣。</p><p> Today we are excited to announce a new Microsoft open source project to make eBPF work on Windows 10 and Windows Server 2016 and later. The  ebpf-for-windows project aims to allow developers to use familiar eBPF toolchains and application programming interfaces (APIs) on top of existing versions of Windows. Building on the work of others, this project takes several existing eBPF open source projects and adds the “glue” to make them run on Windows.</p><p> 今天我们很高兴宣布一个新的Microsoft开源项目，使EBPF在Windows 10和Windows Server 2016上工作。 eBPF-for-Windows项目旨在允许开发人员在现有版本的Windows之上使用熟悉的EBPF Toolchains和Application编程接口（API）。在其他人的工作中，这个项目采用了几个现有的EBPF开源项目，并添加了“胶水”以使它们在Windows上运行。</p><p> We are announcing this now while the project is still relatively early in development because our goal is to work in collaboration with the robust eBPF community to make sure that eBPF works great on Windows, and everywhere else.</p><p> 我们现在正在宣布这一点，而项目仍然在开发中仍然相对较早，因为我们的目标是与强大的EBPF社区合作，以确保EBPF在Windows上工作，而其他地方。</p><p>    As shown in the diagram, existing eBPF toolchains such as clang can be used to generate eBPF bytecode from source code in various languages. The resulting bytecode can then be used by any application or manually through the Windows netsh command-line tool, both of which use a shared library that exposes  Libbpf APIs, though this work is still in progress.</p><p>    如图所示，现有的EBPF工具链如Clang可用于从各种语言的源代码生成EBPF字节码。然后，可以通过任何应用程序或通过Windows NetSh命令行工具手动使用生成的字节码，其中两者都使用公开italy的共享库，虽然此工作仍在进行。</p><p> The library sends the eBPF bytecode to a static verifier (the  PREVAIL verifier) that is hosted in a user-mode  protected process, which is a Windows security environment that allows a kernel component to trust a user-mode daemon signed by a key that it trusts. If the bytecode passes all the verifier’s safety checks, the bytecode can be either loaded into the  uBPF interpreter running in a Windows kernel-mode execution context or compiled by the  uBPF just-in-time (JIT) compiler and have native code loaded into the kernel-mode execution context.</p><p> 该库将EBPF字节码发送到静态验证器（以前的验证程序），该验证者（以前的verifier）托管在用户模式受保护的过程中，它是一个Windows安全环境，允许内核组件信任由它键签名的用户模式守护程序信任。如果字节码通过所有验证者的安全检查，则字段码可以加载到Windows内核模式执行上下文中运行的UBPF解释器中，或者由UBPF立即（JIT）编译器编译，并将本机代码加载到其中内核模式执行上下文。</p><p> eBPF programs installed into the kernel-mode execution context can attach to various hooks to handle events and call various helper APIs exposed by the eBPF shim, which internally wraps public Windows kernel APIs, allowing the use of eBPF on existing versions of Windows. So far, two hooks (XDP and socket bind) have been added, and though these are networking-specific hooks, we expect many more hooks and helpers, not just networking-related, will be added over time .</p><p> 安装到内核模式执行上下文中的EBPF程序可以附加到各种挂钩以处理事件，并调用EBPF SHIM公开的各种辅助API，该eBPF垫片内部包裹公共Windows内核API，允许在现有版本的Windows上使用EBPF。到目前为止，已经添加了两个钩子（XDP和套接字绑定），虽然这些是特定于网络特定的钩子，但我们期望更多的钩子和助手，而不仅仅是网络相关的钩子，将随着时间的推移而增加。</p><p>   The eBPF for Windows project leverages existing open source projects, including the  IOVisor uBPF project and the  PREVAIL verifier, running them on top of Windows by adding the Windows-specific hosting environment for that code.</p><p>   Windows项目的EBPF利用现有的开源项目，包括IOVISOR UBPF项目和PREVAIL验证者，通过为该代码添加特定于Windows的托管环境，在Windows之上运行它们。 </p><p>  The intent is to provide source code compatibility for code that uses common hooks and helpers that apply across Operating System ecosystems.</p><p>意图是为使用跨操作系统生态系统应用的常用钩子和帮助程序提供源代码兼容性。</p><p> Linux provides many hooks and helpers, some of which are very Linux specific (using Linux internal data structs, for example) that would not be applicable to other platforms. Other hooks and helpers are generically applicable, and the intent is to support them for eBPF programs.</p><p> Linux提供了许多钩子和帮助器，其中一些钩子和助手非常适用于Linux（例如，使用Linux内部数据结构）不适用于其他平台。其他钩子和助手是在几乎适用的，而目的是支持它们的EBPF程序。</p><p> Similarly, the eBPF for Windows project exposes  Libbpf APIs to provide source code compatibility for applications that interact with eBPF programs.</p><p> 同样，Windows项目的EBPF公开了Libbpf API为与EBPF程序交互的应用程序提供源代码兼容性。</p><p>  The  ebpf-for-windows project brings the power of eBPF to Windows users and is intended to eventually reside in a community-governed foundation in the eBPF ecosystem. With your input and help, we can get there.</p><p>  EBPF for-Windows项目将EBPF的电源带到Windows用户，最终驻留在EBPF生态系统中的社区管理的基础中。通过您的输入和帮助，我们可以到达那里。</p><p> Reach out to us or create an issue on  GitHub. We’re excited to continue to refine and extend ebpf-for-windows so that everyone can benefit from this project. We are eager to see what you discover with this project and how it evolves.</p><p> 联系我们或在GitHub上创建一个问题。我们很高兴继续改进并扩展EBPF-For-Windows，以便每个人都可以从这个项目中受益。我们渴望看到你发现这个项目的发现以及它如何发展。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://cloudblogs.microsoft.com/opensource/2021/05/10/making-ebpf-work-on-windows/">https://cloudblogs.microsoft.com/opensource/2021/05/10/making-ebpf-work-on-windows/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ebpf/">#ebpf</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>