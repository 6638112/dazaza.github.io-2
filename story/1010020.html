<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>UASP使Raspberry PI 4磁盘IO速度提高50%</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">UASP使Raspberry PI 4磁盘IO速度提高50%</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-06 05:34:14</div><div class="page_narrow text-break page_content"><p>你可以在这里观看与这篇博客文章相关的视频：UASP让树莓PI变得更快了吗？</p><p>几周前，我用我的Raspberry PI 4和外置USB SSD驱动器做了一些测试。我发现USB3.0固态硬盘比我测试的最快的microSD卡快十倍。</p><p>在与那篇帖子相关的视频评论中，布拉德·曼斯克提到了一些我从未想过的事情。他注意到我链接到了一个没有UASP的Inateck USB3.0 SATA表壳。</p><p>在没有UASP的情况下，驱动器是使用仅批量传输(或称BOT)作为大容量存储设备安装的，这是一种专为传输文件而设计的协议，可以追溯到USB全速时代，当时你能获得的最快速度是惊人的12 Mbps！</p><p>对于USB3.0，BOT协议削弱了吞吐量。USB3.0的带宽为5Gbps，是USB1.1的400倍。旧的BOT协议将以大块的形式传输数据，并且每个数据块都必须按顺序传送，而不考虑缓冲或能够并行传输的多位数据。</p><p>我不想在这里谈太多技术性问题，但是SCSI协议已经存在了很长一段时间--足够长的时间，以至于在这本1994年的呆伯特漫画中它只是一个笑话的一部分。它具有允许并行数据位复制和无序数据传输等功能，因此驱动器可以使用缓冲和缓存机制来获得更好的性能。</p><p>大约在USB3.0被引入的时候，大多数USB存储设备和硬盘适配器开始采用该标准。一些只有USB2.0端口的电脑可以更新固件，以便将UASP用于较新的驱动器，因此一些USB2.0连接速度得到了提升。</p><p>我们不要操之过急。回到布拉德对我的Pi SSD视频的评论，我回答布拉德，我甚至没有意识到我有Inateck案的非UASP版本。</p><p>当它真的到了的时候，我试着看看它有什么不同之处。顶部、侧面和背面完全相同。</p><p>只有当你把它拆开并看一看实际的电路板时，差异才会真正明显。较早的非UASP版本在上图的左上角，UASP版本在右下角。UASP版本采用了完全不同的布局，并且使用了不同的控制器芯片。</p><p>如果您有一个USB驱动器，并且不想拆卸它并查看控制器芯片的规格，判断它是否安装了UASP支持的唯一可靠方法是将其插入您的PI，然后运行命令lsusb-t：</p><p>$lsusb-t/：总线02。端口1：设备1，类别=ROOT_HUB，驱动程序=xhci_hcd/4p，5000M|__端口1：设备2，如果为0，类别=大容量存储，驱动程序=UAS，5000M。</p><p>此命令在树中列出所有USB设备，并且对于每个硬盘，您应该会看到列出了一个驱动程序。如果是UAS(如上例所示)，则您的驱动器支持UASP，您将获得最佳速度。如果它是USB存储，那么它使用的是旧的机器人协议，你不会看到它的全部潜力。</p><p>我还有另外两个旧的SATA适配器，多年来我在修理电脑时使用过，当时我会把一个旧硬盘克隆到一个新的硬盘上，或者试图从损坏的电脑的硬盘上恢复数据。</p><p>我检查了我从Micro Center购买的这个内陆适配器，它也支持UASP，这是一个惊喜，因为Micro Center网站上的规格显示数据传输速率高达480 Mbps，哈！</p><p>然后我检查了我在2015年购买的StarTech SATA适配器，它也支持UASP。因此，看起来大多数较新的USB3.0适配器确实支持它，但在亚马逊或其他零售商网站的规格中并不总是很容易看到。</p><p>尽管比PI 4旧的树莓PI只有USB2.0端口，我还是想检查它们是否支持UASP，因为我们马上就会看到，仅仅使用UASP与旧的BOT协议在性能上会有很大的不同，这即使在旧的USB2.0端口上也会有所帮助。</p><p>唉，在测试完我所有的适配器后，我发现它们都使用USB存储驱动程序挂载驱动器。我试图找到任何关于PI 3B+固件是否支持UASP的官方确认，但我在PI论坛的这篇帖子中找到的所有信息都是关于PI的DWC_OTG驱动程序不支持UAS驱动程序所需的功能。</p><p>因此，如果您使用的是较旧的Raspberry PI，那么您的快速外部存储选择非常有限。如果您想做任何需要数据传输的事情，比如构建NAS、设置Nextcloud、将其用于备份或媒体流，我都会坚持使用PI 4。</p><p>这些基准测试表明，当你在Raspberry PI 4上使用UASP和驱动器时，它会产生多大的不同。</p><p>总体而言，UASP发挥了巨大的作用。顶部有用于测试大文件传输的hdparm和dd测试基准。它们分别显示了50%和40%的加速比。</p><p>底部有4K随机访问基准，这是更好地衡量硬盘如何执行典型计算任务的指标。而UASP仍然有很大的影响力。随机读取速度提高了35%，随机写入速度提高了20%。</p><p>但是我也想检查一下其他的东西。随着更高效的数据传输成为可能，在需要多少电力方面会有什么可衡量的差异吗？</p><p>对于许多树莓PI项目，高效的电力使用是一个重要的考虑因素，特别是当你使用电池或太阳能运行PI的时候。</p><p>我使用了Satechi USB-C电源测试仪，并使用UASP测量了8%的峰值节能。这意味着如果你进行大量的文件传输，电池的运行时间将增加8%。</p><p>与我的所有基准测试一样，我将每个基准测试运行了四次，放弃了第一个结果。在我之前的Raspberry Pi Cluster视频中，我谈了很多关于我的基准测试过程。</p><p>您还可以在图灵-pi-cluster存储库的这个基准问题中看到所有原始数据和我的方法。如果您运行相同的基准测试，如果您使用不同的固态硬盘或盘柜，则可能会得到略有不同的结果。</p><p>我的建议是在PI4上使用UASP和USB3.0设备，否则你会错过相当大的性能提升。此外，请记住将USB 3.0设备插入蓝色的USB 3.0端口，而不是黑色的USB 2.0端口，否则您不会看到任何性能差异。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.jeffgeerling.com/blog/2020/uasp-makes-raspberry-pi-4-disk-io-50-faster">https://www.jeffgeerling.com/blog/2020/uasp-makes-raspberry-pi-4-disk-io-50-faster</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/速度/">#速度</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/raspberry/">#raspberry</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/pi/">#pi</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1006388.html"><img src="http://img.diglog.com/img/2020/6/thumb_1df23f578ca3ab354dbe41dddb21eab9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1006388.html">循证调度(2007)</a></div><span class="my_story_list_date">2020-6-13 15:22</span></div><div class="col-sm"><div><a target="_blank" href="/story/1001661.html"><img src="http://img.diglog.com/img/2020/5/thumb_ca4507e2d1c91c190852680f7710f010.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1001661.html">“与时间叮当作响的摄影师”(2015)</a></div><span class="my_story_list_date">2020-5-11 23:25</span></div><div class="col-sm"><div><a target="_blank" href="/story/1000798.html"><img src="http://img.diglog.com/img/2020/5/thumb_6db21dab327bbcfaf519f0c3c9d3a71b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000798.html">旧金山居民正以前所未有的速度离开</a></div><span class="my_story_list_date">2020-5-6 2:18</span></div><div class="col-sm"><div><a target="_blank" href="/story/videos_comedy_423618.html"><img src="http://img.diglog.com/img/2011/5/thumb_423797b9cb7a4e719fdc87351225b6c4.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/videos_comedy_423618.html">这个日语吵架的速度，绝了！</a></div><span class="my_story_list_date">2011-5-2 16:8</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>