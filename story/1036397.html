<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>P²分位数估算器–在不存储值的情况下估算中位数</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">P²分位数估算器–在不存储值的情况下估算中位数</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-25 03:51:33</div><div class="page_narrow text-break page_content"><p>想象一下，您正在应用程序中实现性能遥测。有一个操作执行了数百万次，并且您希望获得其“平均”持续时间。使用算术平均值不是一个好主意，因为获得的值可以很容易地获得被离群值宠坏了。最好使用中位数，这是描述平均值的最可靠方法之一。</p><p> 简单的中值估计方法需要存储所有值，在我们的案例中，保留所有值是一个坏主意，因为这会显着增加内存占用量，这种遥测是有害的，因为它可能成为新的瓶颈而不是监视实际性能。</p><p> 获取中位数的另一种方法是使用顺序分位数估计器（也称为在线分位数估计器或流式分位数估计器），该算法允许使用固定量来计算中位数（或任何其他分位数）当然，它仅提供真实中值的近似值，但通常对于典型遥测用例就足够了。</p><p> 在这篇文章中，我将展示最简单的顺序分位数估计器之一，称为P²分位数估计器（或逐段抛物线分位数估计器）。</p><p>  该算法最初是在[Jain1985]中提出的。在下面可以找到这种方法的简短概述，原始论文中有关错别字的注释，数值模拟和C＃实现。</p><p>  假设我们有一个观测流\（\ {x_0，x_1，x_2，x_3，x_4，\ ldots \} \）并且我们想要估计p分位数。建议的方法引入了五个标记，它们对应于</p><p>   同样，我们必须保持标记位置\（\ {n_0，n_1，n_2，n_3，n_4 \} \）。这些整数值描述了当前获得的观测值的实际标记索引。</p><p>接下来，我们必须定义标记的期望位置\（\ {n'_0，n'_1，n'_2，n'_3，n'_4 \} \）。对于第一个\（n \）个观测值，这些实数值定义如下：</p><p>  为了加快算法的运行速度，我们可以预先计算所需位置的增量，这些增量应在每次新观察后添加到当前值中：</p><p>  请注意，在原始论文中，作者使用基于1的索引，因此我决定将其改编为基于0的索引，从实现的角度来看更方便。</p><p>   \ [\ left \ {\ begin {array} {llll} q_0 = x _ {（0）}，＆n_0 = 0，＆n'_0 = 0，＆dn'_0 = 0，\\ q_1 = x _ {（1 ）}，＆n_1 = 1，＆n'_1 = 2p，＆dn'_1 = p / 2，\\ q_2 = x _ {（2）}，＆n_2 = 2，＆n'_2 = 4p，＆dn' _2 = p，\\ q_3 = x _ {（3）}，＆n_3 = 3，＆n'_3 = 2 + 2p，＆dn'_3 =（1 + p）/ 2，\\ q_4 = x _ {（4 ）}，＆n_4 = 4，＆n'_4 = 4，＆dn'_4 =1。\ end {array} \ right。\]</p><p>   首先，我们应该调整极端标记高度（如果\（x_j  q_4 \），我们应该更新\（q_4 \））并找到\（k \ ）使得\（q_k \ leq x_j  = 1 && n [i + 1]-n [i]> 1 || d  = 1 && n [i + 1]-n [i]> 1 || d <=-1 && n [i-1]-n [i] <-1）{int dInt =数学。签署（d）; double qs =抛物线（i，dInt）;如果（q [i-1] <qs && qs <q [i + 1]）q [i] = qs;否则q [i] =线性（i，dInt）; n [i] + = dInt;计数++; }私人双抛物线（int i，double d）{返回q [i] + d /（n [i + 1]-n [i-1]）*（（n [i]-n [i-1] + d）*（q [i + 1]-q [i]）/（n [i + 1]-n [i]）+（n [i + 1]-n [i]-d）*（q [ i]-q [i-1]）/（n [i]-n [i-1]））; } private double Linear（int，int d）{return q [i] + d *（q [i + d]-q [i]）/（n [i + d]-n [i]）； } public double GetQuantile（）{if（count <= 5）{数组。排序（q，0，count）; int index =（int）数学。回合（（count-1）* p）;返回q [索引]; } return q [2]; }}</p><p>  P²分位数估计器允许在不存储单个值的情况下估计数字流中的分位数。还有许多其他顺序分位数估计器，但是从实现的角度来看，P²分位数估计器是最简单的分位数估计器之一。该算法可用于在您的应用程序中引入性能遥测，而不会产生明显的性能或内存占用开销。</p><p>  [Jain1985] Jain，Raj和Imrich Chlamtac。“用于动态计算分位数和直方图而不存储观测值的P²算法。” ACM通讯28，没有。 10（1985）：1076-1085。</p><p>[Hyndman 1996] Hyndman，R. J.和Fan，Y.1996。统计软件包中的样本分位数，American Statistician 50，361–365。 https://doi.org/10.2307/2684934</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://aakinshin.net/posts/p2-quantile-estimator/">https://aakinshin.net/posts/p2-quantile-estimator/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/估算/">#估算</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/estimator/">#estimator</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/double/">#double</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>