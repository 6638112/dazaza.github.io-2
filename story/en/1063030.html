<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>用D驾驶 Driving with D</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Driving with D<br/>用D驾驶 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-03 23:03:44</div><div class="page_narrow text-break page_content"><p>Here is what comes to mind when I think of D: fast, expressive, easy, and… driving? That’s right, I drive with D.</p><p>当我想到D：快速，表现力，容易，而且......驾驶时，这就是想到的那是对的，我和D一起开车。</p><p> Enter my venerable  Holden VZ Ute daily driver. From the factory, it came with a rubbish four-speed automatic gearbox. During 18 months of ownership, I destroyed four gearboxes. I could not afford a new vehicle at the time, so I had to get creative. I purchased a rock-solid, bulletproof, six-speed automatic gearbox from another car. But that’s where the solutions ended. To make it work, I had to build my own circuit board, computer system, and firmware to control the solenoids, hydraulics, and clutches inside the gearbox, handle user input, perform shifting decisions, and interface to my car by pretending to be the four-speed automatic.</p><p> 输入我的尊敬Holden vz Nute Driver。从工厂出发，它带有垃圾四速自动变速箱。在18个月的所有权期间，我摧毁了四个变速箱。当时我买不起新车，所以我不得不创造创意。我购买了另一辆车的摇滚固体，防弹，六速自动变速箱。但这就是解决方案结束的地方。为了使其工作，我必须建立自己的电路板，计算机系统和固件来控制齿轮箱内的螺线管，液压和离合器，处理用户输入，执行转移决策，并假装是我的汽车的界面四速自动。</p><p> I’m quite proud of my solution. It can perform a shift in 250 milliseconds, which is great for racing. It has a steep first gear, giving it a swift takeoff. It has given some more powerful cars a run for their money. It’s got flappy paddles, diagnostic data on the screen, and the ability to go ahead and change the way it works whenever I want.</p><p> 我为我的解决方案感到骄傲。它可以在250毫秒的班次中进行班次，这很适合赛车。它有一个陡峭的第一档，让它成为迅速的起飞。它给了一些强大的汽车为他们的钱运行。它有Flappy Paddles，屏幕上的诊断数据，并能够进入并改变它在我想要的情况下工作的方式。</p><p> Here’s a very old video of the system working. It’s not representative of the current system—that ghastly blue screen is gone, the speedo works, and shifting has improved.</p><p> 这是一个非常旧的系统视频。它不是当前系统的代表 - 可怕的蓝屏已经消失，Speedo的工作，并且转移改善了。</p><p> The computer is split into two parts: the user interface board, which drives an OLED display and uses an STM32F042, and the mainboard, which handles everything else, utilizing an STM32F407. The two cooperate over a CAN bus ( Controller Area Network). All the firmware to handle this is written in D.</p><p> 计算机分为两部分：用户界面板，驱动OLED显示屏并使用STM32F042，以及使用STM32F407处理其他所有内容的主板。两者合作超过CAN总线（控制器区域网络）。处理此操作的所有固件都在D.</p><p> I picked D (as  -betterC) because of its ingenious Uniform Function Call Syntax (UFCS), metaprogramming, ease of interfacing with C, unit testing, portability,  shared and  @safe. Another bonus is the helpful, welcoming community. It has genuinely been a joy  discussing D on the forums, and with the founders and community leaders.</p><p> 我选择了D（如-betterc），因为它的巧妙均匀函数调用语法（UFC），元编程，易于与C，单元测试，可移植性，共享和@Safe接口。另一个奖金是有用的，欢迎的社区。它真的是在论坛上讨论d的快乐，以及创始人和社区领导人。</p><p>  Uniform Function Call Syntax (UFCS) This has made my code significantly clearer. My code can accurately follow the flow of data without polluting my stack with single-use variables, nesting many function calls, or other sorts of clutter. For example, here is some code I’m using in my upcoming ECU ( Engine Control Unit) project:</p><p>  统一函数调用语法（UFCS）这使我的代码显着更清晰。我的代码可以准确地遵循数据流，而无需使用单一使用变量污染我的堆栈，嵌套许多函数调用或其他类型的混乱。例如，这里是我在即将到来的ECU（发动机控制单元）项目中使用的一些代码： </p><p>  There’s no need to read the code backward or count your brackets, no need to use a gazillion single-use variables. It’s concise.</p><p>无需稍微读取代码或计算括号，无需使用Gazillion单使用变量。这很简洁。</p><p> Metaprogramming The  Don’t Repeat Yourself (DRY) principle is often touted by programmers. D’s metaprogramming is an incredible tool to achieve that goal. I use it in my CAN bus implementation. For example:</p><p> Metaprogramming不要重复自己（干）原则通常由程序员吹捧。 D'S Metaprogramming是一个令人难以置信的工具来实现这一目标。我在我的总线实施中使用它。例如：</p><p> struct CANPacket(ushort ID) { enum id = ID; ubyte[8] data;}alias HeartbeatPacket = CANPacket!10;alias BeepHornPacket = CANPacket!140;</p><p> struct canpacket（USHORT ID）{ENUM ID = ID; ubyte [8]数据;别名心跳= canpacket！10;别名beephornpacket = canpacket！140;</p><p> I’ve got specific aliased types as  HeartbeatPacket and  BeepHornPacket, but I haven’t needed to repeat any code. They all follow the same underlying structure, so if I modify  CANPacket, every alias is also updated.</p><p> 我有特定的锯齿类型类型为心跳acket和beephornpacket，但我还没有重复任何代码。它们都遵循相同的底层结构，因此如果我修改canpacket，每个别名也会更新。</p><p> Interfacing to C I frequently must communicate with my microcontroller’s HAL and RTOS; D’s C interface made that a breeze. Just add an  extern(C) and it’s good to go.</p><p> 接口到C我经常必须与我的微控制器的HAL和RTO进行通信; D'S C接口让微风。只需添加extern（c）即可进入。</p><p>  Unit Testing D’s built-in unit testing has saved me from blowing my foot off a few times. I can run all my unit tests on Windows to guarantee logical correctness and then build a final target for my microcontroller.</p><p>  单位测试D'S内置单元测试已挽救了我从吹掉几次脚的脚。我可以在Windows上运行所有单元测试以保证逻辑正确性，然后为MicroController构建最终目标。</p><p> Portability Following on from above, D supports a surprisingly large number of targets via  GDC and LDC. If it weren’t for D’s portability, I would have had to write my project in C++ (ugh). I use LDC, and cross-compiling can be performed by simply adjusting my command line arguments.</p><p> 从上面开始的可移植性，D通过GDC和LDC支持令人惊讶的大量目标。如果它不适用于d's的可移植性，我必须在c ++（ugh）中写下我的项目。我使用LDC，可以通过简单地调整我的命令行参数来执行交叉编译。 </p><p> Shared Shared is D’s way of guarding against multi-threaded access of code. It’s not perfect, but I use it as-is, and I think it works well. I do have multiple threads in my code base, and they need to synchronize data. I mark certain variables as  shared, which means I must take special care accessing that data. It works with system locks and mutexes. While locked, I can cast shared away from the variable and use it like a normal variable. This is handy with structs and classes.</p><p>共享共享是守护代码的多线程访问的方式。这并不完美，但我用它来使用它，我认为它很好。我在代码库中有多个线程，他们需要同步数据。我将某些变量标记为共享，这意味着我必须特别注意访问该数据。它适用于系统锁和互斥锁。锁定时，我可以传播远离变量并使用它类似于正常变量。这与结构和课程方便。</p><p> shared int sensorValue;sensorValue = 4; // using it like a single-thread variable, erroratomicStore(sensorValue, 4); // works with atomics</p><p> 共享INT SensorValue; SensorValue = 4; //使用它像单线变量，ErroratomStore（SensorValue，4）; //与原子有关</p><p> SafeD  @safe exists to prohibit sketchy memory activities and enforce best behavior. I haven’t had to fight @safe much yet because I don’t do anything wicked with my memory, but it is comfortable knowing that if I am going to make a mistake, the compiler can assist me in stopping it.</p><p> SAFED @SAFE存在，以禁止粗略内存活动并强制执行最佳行为。我还没有打败@Safe，因为我没有做任何邪恶的东西，但很乐意知道如果我要弄错，那么编译器可以帮助我停下来。</p><p> Mental Friction Adam D. Ruppe puts it succinctly: D has low mental friction. The flexibility and expressiveness of the language make it easy to translate one’s thoughts into written code and maintain productivity. I don’t have to fight D much. This is my personal opinion, but I feel like D is the language in which I’m most productive.</p><p> 精神摩擦亚当D. Ruppe简洁地说：D精神摩擦力低。语言的灵活性和表现力使得将一个人的思想转化为书面代码并保持生产力。我不必战斗d。这是我的个人意见，但我觉得D是我最富有成效的语言。</p><p>  D is the perfect fit for this sort of project—I think it’s going to have a bright future ahead in the embedded world. I’m going to continue using D for my projects. I’ve got another D-powered automotive project in the works which I hope to show off in the future.</p><p>  D是这种项目的完美契合 - 我认为它将在嵌入式世界中具有光明的未来。我将继续使用d为我的项目。我希望将来能够炫耀的作品中另一个D-Powered汽车项目。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://dlang.org/blog/2021/06/01/driving-with-d/">https://dlang.org/blog/2021/06/01/driving-with-d/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/驾驶/">#驾驶</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/driving/">#driving</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>