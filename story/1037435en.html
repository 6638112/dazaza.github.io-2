<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>QBE与LLVM QBE vs. LLVM</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">QBE vs. LLVM<br/>QBE与LLVM </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-04 20:28:12</div><div class="page_narrow text-break page_content"><p>Both QBE and LLVM are compiler backends using an SSArepresentation. This document will explain why LLVMdoes not make QBE a redundant project. Obviously,everything following is biased, because written by me.</p><p>QBE和LLVM都是使用SSArepresentation的编译器后端。本文将解释为什么LLVM不会使QBE成为冗余项目。显然，由于我写的东西，所以后面的一切都是有偏见的。</p><p>   It does not address all the problems faced when conceiving an industry-grade language. If you are toying with some language ideas, using LLVM will be like hauling your backpack with a truck, but using QBE will feel more like riding a bicycle.</p><p>   它不能解决构思行业级语言时面临的所有问题。如果您想了解一些语言方面的想法，则使用LLVM就像用卡车拖运背包，而使用QBE则更像是骑自行车。</p><p> It attempts to pinpoint, in the extremely vast compilation literature, the optimizations that get you 70% of the performance in 10% of the code of full blown compilers.</p><p> 它试图在极其庞大的编译文献中找到优化方法，这些优化方法可以用完整编译器代码的10％获得70％的性能。</p><p> For example, copy propagation on SSA form is implemented in 160 lines of code in QBE!</p><p> 例如，在QBE！中用160行代码实现SSA格式的复制传播！</p><p> First, it is, and will remain, a small project (less than 8 kloc). Second, it is programmed in non-fancy C99 without any dependencies. Third, it is able to dump the IL and debug information in a uniform format after each pass.</p><p> 首先，它是并且将继续是一个小项目（少于8 kloc）。其次，它是在没有任何花哨的C99上编程的。第三，它能够在每次通过后以统一格式转储IL和调试信息。</p><p>  LLVM is definitely more packed with features, but thereare a few things provided in QBE to consider.</p><p>  LLVM绝对具有更多功能，但是QBE中提供了一些要考虑的事项。</p><p> In more technical terms, any language that provides good C compatibility and uses LLVM as a backend needs to reimplement large chunks of the ABI in its frontend! This well known issue in the LLVM community causes a great deal of duplication and bugs.</p><p> 用更多的技术术语来说，任何提供良好C兼容性并使用LLVM作为后端的语言都需要在其前端重新实现ABI的大块内容！ LLVM社区中这个众所周知的问题导致大量重复和错误。 </p><p> Implementing a complete C ABI (with struct arguments and returns) is incredibly tricky, and not really a lot of fun. QBE provides you with IL operations to call in (and be called by) C with no pain. Moreover the ABI implementation in QBE has been thoroughly tested by fuzzing and manual tests.</p><p>实现一个完整的C ABI（带有struct参数和返回值）是非常棘手的，并不是很有趣。 QBE为您提供IL操作，使您可以轻松地调用C（并被C调用）。此外，QBE中的ABI实施已通过模糊测试和手动测试进行了全面测试。</p><p> Implementing SSA construction is hard. To save its users from having to implement it, LLVM provides stack slots. This means that one increment of a variable  v will be composed of three LLVM instructions: one load, one add, and one store.</p><p> 实施SSA建设很困难。为了使用户不必实施它，LLVM提供了堆栈插槽。这意味着变量v的一个增量将由三个LLVM指令组成：一个加载，一个加法和一个存储。</p><p> QBE provides simple non-SSA temporaries, so incrementing  v is simply done with one instruction  %v =w add %v, 1.</p><p> QBE提供了简单的非SSA临时对象，因此，v的增加仅需通过一条指令％v = w加上％v，1即可完成。</p><p> This could seem cosmetic, but dividing the size of the IL by three makes it easier for the frontend writers to spot bugs in the generated code.</p><p> 这看起来很漂亮，但是将IL的大小除以三可以使前端编写者更容易发现生成的代码中的错误。</p><p> For the sake of advanced optimizations and correctness, LLVM has complex IL types. However, only a few types are really first class and many operations of source languages require casts to be compiled.</p><p> 为了进行高级优化和正确性，LLVM具有复杂的IL类型。但是，实际上只有少数类型是一流的，并且源语言的许多操作都需要强制类型转换。</p><p> Because QBE makes a much lighter use of types, the IL is more readable and shorter. It can of course be argued back that the correctness of QBE is jeoparadized, but remember that, in practice, the large amount of casts necessary in LLVM IL is undermining the overall effectiveness of the type system.</p><p> 由于QBE大大简化了类型的使用，因此IL更具可读性且更短。当然可以反驳QBE的正确性，但是要记住，实际上，LLVM IL中必需的大量强制转换会损害类型系统的整体有效性。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://c9x.me/compile/doc/llvm.html">https://c9x.me/compile/doc/llvm.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/qbe/">#qbe</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/llvm/">#llvm</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>