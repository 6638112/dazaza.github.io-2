<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>外部GPU和Raspberry PI计算模块4</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">外部GPU和Raspberry PI计算模块4</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-28 06:41:23</div><div class="page_narrow text-break page_content"><p>The  Raspberry Pi Compute Module 4 eschews a built-in USB 3.0 controller and exposes a 1x PCI Express lane.</p><p>Raspberry PI计算模块4避开了内置的USB 3.0控制器，并提供了1x PCI Express通道。</p><p> The slightly older Raspberry Pi 4 model B could be  hacked to get access to the PCIe lane (sacrificing the VL805 USB 3.0 controller chip in the process), but it was a bit of a delicate operation and only a few daring souls tried it.</p><p>稍微老一点的Raspberry Pi 4型号B可能会被黑进PCIe车道(在此过程中牺牲了VL805 USB 3.0控制器芯片)，但这是一个有点微妙的操作，只有少数胆大妄为的人尝试过。</p><p>  Watch this video for more detail about my experience using these GPUs on the CM4:   GPUs on a Raspberry Pi Compute Module 4!</p><p>观看此视频，了解更多关于我在CM4上使用这些GPU的体验：在Raspberry PI计算模块4上使用GPU！</p><p> Now that the CM4&#39;s IO Board has a 1x slot, it&#39;s trivial to plug in any PCI Express card, and test out its functionality with the Raspberry Pi. And test I have! I am detailing all the cards I&#39;ve tested and the results on my  Raspberry Pi PCIe device compatibility database, and you can look at the linked issues to learn more about each card.</p><p>既然CM4的IO板有一个1X插槽，那么插入任何PCI Express卡并用Raspberry PI测试它的功能就变得微不足道了。还有我的测试！我在我的Raspberry Pi PCIe设备兼容性数据库中详细介绍了我测试过的所有卡和结果，您可以查看相关问题以了解有关每张卡的更多信息。</p><p>  The Pi&#39;s BCM2711 SoC includes a VideoCore 6 GPU capable of features like H.265 4Kp60 decode, H.264 1080p60 decode, and 1080p30 encode. It also supports OpenGL ES 3.0, and it&#39;s not a terrible little GPU for what it costs.</p><p>PI&#39；的BCM2711 SoC包括一个VideoCore 6 GPU，能够实现H.265 4Kp60解码、H.264 1080p60解码和1080p30编码等功能。它还支持OpenGL ES 3.0，就其成本而言，它并不是一个糟糕的小GPU。</p><p> But there are many people who have wanted to know whether you could use an Nvidia or AMD GPU with a Pi, and I have tried answering that question.</p><p>但是有很多人想知道你是否可以使用带有PI的NVIDIA或AMD GPU，我试着回答了这个问题。</p><p>   Partly it&#39;s due to lack of support for I/O BAR space on the BCM2711 ARM SoC, and partly it  may be due to driver bugs or features that are only supported on X86 or certain ARM architectures.</p><p>部分原因是BCM2711 ARM SoC上缺乏对I/O条空间的支持，部分原因可能是驱动程序错误或仅在X86或某些ARM架构上支持的功能。</p><p> I have tried the following drivers, and all of them failed to initialize the card fully in one way or another:</p><p>我尝试了以下驱动程序，但都未能以某种方式完全初始化卡：</p><p>  Nouveau open source driver (you have to recompile the Raspberry Pi OS kernel to enable it)</p><p>新的开源驱动程序(您必须重新编译Raspberry PI OS内核才能启用它)。</p><p>  Radeon open source driver (you have to recompile the Raspberry Pi OS kernel to enable it)</p><p>RADEON开源驱动程序(您必须重新编译Raspberry PI OS内核才能启用它)。</p><p> AMDGPU open source driver... which I found after trying to use it does not work with as old a video card as the one I tried!</p><p>AMDGPU开源驱动程序...。在尝试使用后，我发现它不适用于像我试过的那样旧的显卡！</p><p> Just getting the hardware to plug in might be your first challenge, as many (in fact, almost  all) GPUs have physical slots that won&#39;t fit in the IO Board&#39;s x1 PCIe slot. You  could hack off the bit in the middle to make the card physically fit, and it would work, but luckily there are  x1 to x16 adapters that allow larger cards to plug into the x1 slot (though without the added lanes of bandwidth).</p><p>仅仅是将硬件插入可能就是您的第一个挑战，因为许多(事实上，几乎所有)GPU的物理插槽都无法插入IO板的x1 PCIe插槽。您可以砍掉中间的位以使卡在物理上合适，这样就可以工作了，但幸运的是，x1到x16适配器允许将较大的卡插入x1插槽(尽管没有增加带宽通道)。</p><p> Most cards work fine with fewer lanes available; they just don&#39;t get as much bandwidth between the GPU and the CPU.</p><p>大多数卡在可用通道较少的情况下都工作得很好；它们只是不能在GPU和CPU之间获得足够的带宽。</p><p> Both cards were recognized appropriately when I ran  lspci, so at least there was a glimmer of hope:</p><p>在我运行lspci时，这两张卡都被正确识别，所以至少有一线希望：</p><p> # Nvidia GeForce GT 71001:00.0 VGA compatible controller: NVIDIA Corporation GK208 [GeForce GT 710B] (rev a1) (prog-if 00 [VGA controller]) Subsystem: ZOTAC International (MCO) Ltd. GK208B [GeForce GT 710] Flags: fast devsel Memory at 600000000 (32-bit, non-prefetchable) [disabled] [size=16M] Memory at &lt;unassigned&gt; (64-bit, prefetchable) [disabled] Memory at &lt;unassigned&gt; (64-bit, prefetchable) [disabled] I/O ports at &lt;unassigned&gt; [disabled] [virtual] Expansion ROM at 601000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Legacy Endpoint, MSI 00 Capabilities: [100] Virtual Channel Capabilities: [128] Power Budgeting &lt;?&gt; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt;# AMD Radeon 545001:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cedar [Radeon HD 5000/6000/7350/8350 Series] (prog-if 00 [VGA controller]) Subsystem: VISIONTEK Cedar [Radeon HD 5000/6000/7350/8350 Series] Flags: fast devsel, IRQ 255 Memory at &lt;unassigned&gt; (64-bit, prefetchable) [disabled] Memory at 600000000 (64-bit, non-prefetchable) [disabled] [size=128K] I/O ports at &lt;unassigned&gt; [disabled] [virtual] Expansion ROM at 600020000 [disabled] [size=128K] Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting</p><p>#NVIDIA GeForce GT 71001：00.0VGA兼容控制器：NVIDIA Corporation GK208[GeForce GT710B](版本A1)(PROG-IF 00[VGA控制器])子系统：Zotac International(MCO)Ltd.GK208B[GeForce GT710]标志：600000000(32位，不可预取)[禁用][大小=16M]内存&lt；未分配&gt；(64位，可预取)[禁用]&lt；(64位，可预取)[禁用]I/O端口位于&lt；未分配&gt；(64位，可预取)[禁用]I/O端口位于&lt；未分配&gt；(64位，可预取)[禁用]I/O端口位于&lt；未分配&gt；(64位，可预取)[禁用]I/O端口位于&lt；未分配&gt；(64位，可预取)[禁用]I/O端口位于&lt；未分配&gt；[DISABLED][虚拟]601000000扩展只读存储器[DISABLED][SIZE=512K]功能：[60]电源管理版本3功能：[68]MSI：ENABLE-COUNT=1/1 MASKABLE-64BIT+功能：[78]Express旧式端点，MSI 00功能：[100]虚拟通道功能：[128]电源预算&lt；？&gt；功能：[600]供应商特定信息：ID=0001rev=1 LEN=024&lt；？&gt；#AMD RADEON 545001：00.0VGA兼容控制器：Advanced Micro Devices，Inc.。[AMD/ATI]CEDAR[RADEON HD5000/6000/7350/8350系列](PROG-IF 00[VGA控制器])子系统：VISIONTEK CEDAR[RADEON HD5000/6000/7350/8350系列]标志：快速设备，IRQ255内存&lt；未分配&gt；(64位，可预取)[已禁用]内存600000000(64位，不可预取)[已禁用][大小=128K]&lt；未分配&gt；I/O端口；[DISABLED][虚拟]600020000扩展只读存储器[DISABLED][SIZE=128K]功能：[50]电源管理版本3功能：[58]Express旧式端点，MSI00功能：[A0]MSI：ENABLE-COUNT=1/1 MASKABLE-64BIT+功能：[100]供应商特定信息：ID=0001rev=1 LEN=010&lt；？&gt；功能：[150]高级错误报告。</p><p>  PCI express devices require BAR (&#39;Base Address Register&#39;) space to be able to initialize and map memory to the computer&#39;s own memory space, and the Pi  currently gives devices 64 MB of RAM for this purpose.</p><p>PCI Express设备需要BAR(基地址寄存器)空间才能初始化内存并将其映射到计算机自己的内存空间，PI目前为此为设备提供了64MB的RAM。</p><p> That&#39;s fine for a simple device like the VL805 USB 3.0 controller used in the regular Pi 4, and for things like NVMe drives and SATA adapters. But GPUs require a lot more BAR space, so after a bit of research, I  documented the process for expanding the BAR space on the Pi to 1 GB after some help from a couple engineers on the Pi Forums.</p><p>对于普通PI4中使用的VL805USB 3.0控制器这样的简单设备，以及NVMe驱动器和SATA适配器等设备来说，这都没问题。但是GPU需要更多的条形空间，所以经过一些研究，在PI论坛上的几位工程师的帮助下，我记录了将PI上的条形空间扩展到1 GB的过程。</p><p> The Nvidia GPU was happy with just 256 MB of RAM available, but the AMD Radeon wanted 1 GB. This also means that the lowest-end 1 GB Compute Module 4 might not be adequate for certain applications when you want to pair them with PCIe devices.</p><p>NVIDIA GPU对只有256MB的RAM很满意，但AMD Radeon想要1 GB。这也意味着，当您想要将某些应用程序与PCIe设备配对时，最低端的1 GB计算模块4可能不足以满足这些应用程序的需要。</p><p>  Once I got through the BAR space issue, and  dmesg was showing all the MEM space was allocated correctly (though IO space was not, since the BCM2711 doesn&#39;t have any IO registers for PCIe devices), I started trying out all the drivers I could find:</p><p>一旦我解决了条形图空间问题，并且dmesg显示所有的MEM空间都已正确分配(尽管IO空间没有正确分配，因为BCM2711没有任何用于PCIe设备的IO寄存器)，我就开始尝试我能找到的所有驱动程序：</p><p> The Nouveau open source driver for Nvidia cards had to be compiled into a custom Pi kernel—neither Pi OS nor Ubuntu for Pi has it available by default (to save space in their images). Once I got it compiled, the Pi completely locked up during boot if I had the card inserted. No serial output, nothing.</p><p>Nvidia显卡的新开源驱动程序必须编译成一个自定义的PI内核--PI OS和Ubuntu for PI都没有默认的内核(以节省镜像中的空间)。一旦我编译了它，如果我插入了卡，PI在引导期间就完全锁定了。没有串行输出，什么都没有。</p><p> The Nvidia ARM32 driver would fail to compile the kernel module due to a ton of errors; I&#39;m not sure if this driver would install on any ARM device currently.</p><p>由于大量错误，NVIDIA ARM32驱动程序将无法编译内核模块；我不确定此驱动程序目前是否可以安装在任何ARM设备上。</p><p> The Nvidia ARM64 driver compiled and loaded, but during card initialization it output  RmInitAdapter failed! and I couldn&#39;t get past that.</p><p>NVIDIA ARM64驱动程序已编译并加载，但在卡初始化期间输出RmInitAdapter失败！我就是忘不了这一点。</p><p> ** The Radeon open source driver** also needs to be compiled, and almost initialized the card, but  complained that it was  Unable to find PCI I/O BA. Oh well.</p><p>**RADEON开源驱动**也需要编译，几乎初始化了板卡，但抱怨找不到PCI I/O BA。哦，好吧。</p><p>    I thought that maybe I could still use  CUDA on the Nvidia card even though the GPU wouldn&#39;t initialize and output a signal over HDMI, nor work with Xorg... but alas, it seems the CUDA tools require the card to initialize in the same way as the graphics bits, so I got that same  RmInitAdapter failed! message in  dmesg.</p><p>我想也许我仍然可以在NVIDIA卡上使用CUDA，即使GPU不能初始化并通过HDMI输出信号，也不能与Xorg一起工作。但是可惜的是，CUDA工具似乎需要卡以与图形位相同的方式初始化，所以我得到了相同的RmInitAdapter失败！Dmesg中的消息。</p><p> It also turns out the 710  might not be compatible with CUDA 11, as it wasn&#39;t listed on the  GPU compatibility page (even though the 705, 720, 730, and 720 were), even though it is advertised as having 192 CUDA cores. Ah well.</p><p>这也证明了710可能与CUDA 11不兼容，因为它没有在GPU兼容性页面上列出(即使705、720、730和720是)，即使它被宣传为有192个CUDA内核。啊好吧。</p><p>   It looks like the closest anyone&#39;s gotten to using a GPU with a readily-available ARM board is  @sahajsarup, and in  this livestream with 96Boards, he demoed getting console output over HDMI through the 96Boards  Oxalis hardware. That board costs over $400, though, so it&#39;s hardly in the same price range as a Raspberry Pi!</p><p>看起来最接近使用带有现成ARM主板的GPU的人是@sahajsarup，在这个96Boards的直播流中，他演示了通过96Boards Oxalis硬件通过HDMI获得控制台输出。不过，这块木板的价格超过了400美元，所以它的价格范围很难与覆盆子圆周率相提并论！</p><p> And before the Compute Module 4 was released, a couple people hacked out the VL805 chip and routed the PCIe bus through an external riser, most notably  @domipheus, who got about as far along as I did and seemed to also hit a wall.</p><p>在计算模块4发布之前，有几个人破解了VL805芯片，并通过外部提升管对PCIe总线进行了布线，其中最著名的是@Domipheus，他走得和我一样远，似乎也撞到了墙上。</p><p> Besides that, it looks like there were similar troubles in the land of the  ROCKPro64, as  tllim mentions:</p><p>此外，正如特利姆提到的那样，看起来在ROCKPro64的土地上也有类似的麻烦：</p><p> I don&#39;t think NVidia card can work on ROCKPro64, this due to graphic card needs large IO Memory range.</p><p>我不认为NVIDIA卡可以在ROCKPro64上工作，这是因为显卡需要很大的IO内存范围。</p><p> As TL Lim is the founder of Pine64, I&#39;d say his opinion is pretty solid.</p><p>由于TL Lim是Pine64的创始人，我想说他的观点是相当可靠的。</p><p>  Every time I post a story of failure or conjecture, there are immediately a number of suggestions for follow-up, and if I tried them all... well I&#39;d never be able to get anything else done.</p><p>每次我发布一个失败或猜测的故事，马上就会有一些后续的建议，如果我都试过了……。嗯，我再也做不成别的事了。</p><p> But a few things did stand out, and when I get time I may try them:</p><p>但有几件事确实很突出，当我有时间的时候，我可能会试一试：</p><p> Using an externally-powered riser to see if getting more power to the GPU that is not coming through the Pi&#39;s own PCIe circuit could help at all. (I have a riser, but don&#39;t have the power adapter to get it going yet).</p><p>如果GPU没有通过PI&#39；自己的PCIe电路获得更多的电力，那么使用外部供电的Riser卡是否会有任何帮助。(我有一个Riser卡，但还没有电源适配器让它转起来)。</p><p> Trying out  Windows on Raspberry—I don&#39;t have high hopes for it to work, but this would be a good excuse to at least take it for a spin.</p><p>在树莓上试用Windows--我对它的效果不抱太高期望，但这至少是一个很好的借口，至少可以让它去兜风。</p><p> Trying to see if there&#39;s another way to work around the IO BAR space limitations. According to some people I&#39;ve spoken with, they have gotten these cards working on other ARM devices, but they&#39;re always mum about which devices specifically (I&#39;m guessing maybe things like Graviton at AWS, which they probably can&#39;t discuss in detail?).</p><p>尝试查看是否有其他方法来解决IO栏空间限制。据我采访过的一些人说，他们已经让这些卡可以在其他ARM设备上使用，但他们总是对具体是哪种设备三缄其口(我猜可能是像AWS的Graviton这样的设备，他们可能不能详细讨论这一点？)。</p><p> Testing a slightly newer card, like the  AMD Radeon RX 550, which doesn&#39;t have BIOS (uses UEFI) and has overall newer architecture, supported by the amdgpu driver.</p><p>测试稍新的卡，如AMD RADEON RX 550，它没有BIOS(使用UEFI)，但总体架构较新，由amdgpu驱动程序支持。</p><p> Anyways, this was quite an adventure, and in the end, even though I didn&#39;t get a GPU to output a video signal from the Pi, I did learn a  lot about PCIe, the Linux kernel, and the Raspberry Pi Compute Module 4.</p><p>无论如何，这是一次相当大的冒险，最后，尽管我没有让GPU从PI输出视频信号，但我确实学到了很多关于PCIE、Linux内核和Raspberry PI计算模块4的知识。</p><p> Be sure to check out my video  GPUs on a Raspberry Pi Compute Module 4!, and my website where I&#39;m documenting all the PCIe cards I&#39;m testing with the CM4:  Raspberry Pi PCIe device compatibility database.</p><p>请务必查看我的Raspberry PI Compute Module 4！上的视频GPU，以及我记录了所有使用CM4：Raspberry PI PCIe设备兼容性数据库进行测试的PCIe卡的网站。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.jeffgeerling.com/blog/2020/external-gpus-and-raspberry-pi-compute-module-4">https://www.jeffgeerling.com/blog/2020/external-gpus-and-raspberry-pi-compute-module-4</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/raspberry/">#raspberry</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/gpus/">#gpus</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/pi/">#pi</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>