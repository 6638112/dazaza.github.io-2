<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>你现在应该做的事情 Things You Should Do Now</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Things You Should Do Now<br/>你现在应该做的事情 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-02-19 15:27:45</div><div class="page_narrow text-break page_content"><p>Describes things you should do now when building software, because the cost todo them increases over time and eventually becomes prohibitive or impossible.</p><p>描述您现在应该在构建软件时所做的事情，因为它们随着时间的推移而增加，并且最终变得越来越多或不可能。</p><p>  If you&#39;re building a hot new web startup, there are a lot of decisions to makeabout what to focus on. Most things you&#39;ll build will take about the same amountof time to build regardless of what order you build them in, but there are a fewtechnical things which become vastly more expensive to fix later.</p><p>  如果您＆＃39;重新建立一个热门的新网络启动，就会有很多决定是为了重新关注的内容。大多数事情，你＆＃39; ll build将需要大约相同的时间来构建，而不管您建立它们的顺序，还有少数内容，稍后修复更昂贵。</p><p> If you don&#39;t do these things early in development, they&#39;ll become very hard orimpossible to do later. This is basically a list of things that would have savedFacebook huge amounts of time and effort down the road if someone had spenta tiny amount of time on them earlier in the development process.</p><p> 如果你不在发展中尽早做这些事情，他们会变得非常努力地努力。这基本上是一个拯救表面的东西列表，如果有人在开发过程中早些时候有人在他们身上有一段时间，那么就可以获得大量的时间和努力。</p><p>   If you&#39;re using integer IDs to identify data or objects,  don&#39;t start yourIDs at 1. Start them at a huge number (e.g., 2^33) so that no object ID willever appear in any other role in your application (like a count, a naturalindex, a byte size, a timestamp, etc). This takes about 5 seconds if you do itbefore you launch and rules out a huge class of nasty bugs for all time. Itbecomes incredibly difficult as soon as you have production data.</p><p>   如果您＆＃39;重新使用整数ID来识别数据或对象，Don＆＃39; T在1.以巨大的数字（例如，2 ^ 33）启动它们，以便在任何其他角色中出现任何对象ID Willever您的应用程序（如计数，NatherIndex，字节大小，时间戳等）。如果你做的是，这需要大约5秒钟，你会推出并缩短一大群令人讨厌的臭虫。只要您拥有生产数据，它就会非常困难。</p><p> The kind of bug that this causes is accidental use of some other value as an ID:</p><p> 此原因的那种错误是偶然地使用一些其他值作为ID：</p><p> // Load the user&#39;s friends, returns a map of friend_id =&gt; true$friend_ids = user_get_friends($user_id);// Get the first 8 friends.$first_few_friends = array_slice($friend_ids, 0, 8);// Render those friends.render_user_friends($user_id, array_keys($first_few_friends));</p><p> //加载用户＆＃39;朋友，返回friend_id =＆gt的地图; true $ fired_ids = user_get_friends（$ user_id）; //获得前8个朋友。$ first_few_friends = array_slice（$ fired_ids，0,8）; //渲染这些朋友.Render_user_friends（$ user_id，array_keys（$ first_few_friends）;</p><p> Because array_slice() in PHP discards array indices and renumbers them, thisdoesn&#39;t render the user&#39;s first 8 friends but the users with IDs 0 through 7,e.g. Mark Zuckerberg (ID 4) and Dustin Moskovitz (ID 6). If you have IDs in thisrange, sooner or later something that isn&#39;t an ID will get treated like an IDand the operation will be valid and cause unexpected behavior. This iscompletely avoidable if you start your IDs at a gigantic number.</p><p> 因为array_slice（）在php中丢弃阵列索引并重新编写它们，这是＆＃39; t＆＃39; t＆＃39; s的前8个朋友，但用户有ids 0到7的用户，例如。 Mark Zuckerberg（ID 4）和Dustin Moskovitz（ID 6）。如果您在此idange中有ID，那么稍后是ISN＆＃39; T一个ID将被视为idand的ID，操作将有效并导致意外行为。如果您在巨大号码中启动ID，则这是可以避免的。 </p><p>  For the most part, you can ignore UTF-8 and unicode until later. However, thereis one aspect of unicode you should address now: store only valid UTF-8 strings.</p><p>在大多数情况下，您可以忽略UTF-8和Unicode，直到稍后。但是，其中Unicode的一个方面您现在应该解决：仅存储有效的UTF-8字符串。</p><p> Assuming you&#39;re storing data internally as UTF-8 (this is almost certainly theright choice and definitely the right choice if you have no idea how unicodeworks), you just need to sanitize all the data coming into your application andmake sure it&#39;s valid UTF-8.</p><p> 假设您＆＃39;在内部存储数据作为UTF-8（这几乎肯定的选择，并且肯定是正确的选择如果您不知道如何Unicodeworks），您只需要在您的应用程序中消毒所有数据并确保它＆＃ 39; S有效的UTF-8。</p><p> If your application emits invalid UTF-8, other systems (like browsers) willbreak in unexpected and interesting ways. You will eventually be forced toensure you emit only valid UTF-8 to avoid these problems. If you haven&#39;tsanitized your data, you&#39;ll basically have two options:</p><p> 如果您的应用程序发出无效的UTF-8，其他系统（如浏览器）以意想不到和有趣的方式遗漏。您最终将被迫核查，您只能享受有效的UTF-8以避免这些问题。如果你没有＆＃39; tsanitized你的数据，你＆＃39; ll基本上有两个选项：</p><p>  As of 2011 Facebook is in the second group, and spends several milliseconds ofCPU time sanitizing every display string on its way to the browser, whichmultiplies out to hundreds of servers worth of CPUs sitting in a datacenterpaying the price for the invalid UTF-8 in the databases.</p><p>  截至2011年Facebook在第二组中，并在前往浏览器的路上花费了几毫秒的OFCPU时间消毒，这将为数百个服务器的CPU坐在Datacent的utf-8的价格中。数据库。</p><p> You can likely learn enough about unicode to be confident in an implementationwhich addresses this problem within a few hours. You don&#39;t need to learneverything, just the basics. Your language probably already has a function whichdoes the sanitizing for you.</p><p> 您可能会对Unicode学习足够的信息，以在几个小时内解决这个问题。你不需要学习，只是基础知识。您的语言可能已经有一个函数，这些功能将对您进行消毒。</p><p>  When you have an alternative, don&#39;t design security systems which are defaultpermit, blacklist-based, or otherwise attempt to enumerate badness. WhenFacebook launched Platform, it launched with a blacklist-based CSS filter, whichbasically tried to enumerate all the &#34;bad&#34; parts of CSS and filter them out.This was a poor design choice and lead to basically infinite security holes forall time.</p><p>  当您有替代方案时，Don＆＃39; t设计安全系统，这些安全系统是DefaultPermit，基于黑名单的或以其他方式枚举不良的尝试。当Facebook推出平台时，它用基于黑名单的CSS过滤器推出，这依赖于所有的CSS过滤器，以枚举所有＆＃34;坏＆＃34; CSS的一部分并过滤。这是一个糟糕的设计选择，并导致基本上是无限的安全孔。</p><p> It is very difficult to enumerate badness in a complex system and badness isoften a moving target. Instead of trying to do this, design whitelist-basedsecurity systems where you list allowed things and reject anything you don&#39;tunderstand. Assume things are bad until you verify that they&#39;re OK.</p><p> 非常困难在复杂的系统和坏战中枚举不良，但是一个移动的目标。而不是尝试这样做，设计白名单的安全系统，您列出了允许的东西，并拒绝任何您不＆＃39; tunerstand。假设事情很糟糕，直到你验证它们＆＃39;重新确定。 </p><p> It&#39;s tempting to design blacklist-based systems because they&#39;re easier to writeand accept more inputs. In the case of the CSS filter, the product goal was forusers to just be able to use CSS normally and feel like this system was nodifferent from systems they were familiar with. A whitelist-based system wouldreject some valid, safe inputs and create product friction.</p><p>设计基于黑名单的系统很容易，因为它们更容易编写和接受更多输入。对于CSS过滤器，产品目标是使用户能够正常使用CSS，并认为该系统与他们熟悉的系统没有什么不同。基于白名单的系统将拒绝某些有效，安全的输入并造成产品摩擦。</p><p> But this is a much better world than the alternative, where the blacklist-basedsystem fails to reject some dangerous inputs and creates  security holes. It also creates product friction because when you fix those holes you breakexisting uses, and that backward-compatibility friction makes it very difficultto move the system from a blacklist to a whitelist. So you&#39;re basically introuble no matter what you do, and have a bunch of security holes you need tounbreak immediately, so you won&#39;t even have time to feel sorry for yourself.</p><p> 但这是一个比基于黑名单的系统无法拒绝某些危险输入并创建安全漏洞的替代方案更好的世界。它还会产生产品摩擦，因为修复这些孔时会破坏现有的用途，并且向后兼容的摩擦使将系统从黑名单迁移到白名单非常困难。因此，无论您做什么，基本上都不会遇到麻烦，并且需要立即破解很多安全漏洞，因此您甚至没有时间为自己感到难过。</p><p> Designing blacklist-based security is one of the worst now-vs-future tradeoffsyou can make. See also &#34;The Six Dumbest Ideas in Computer Security&#34;:</p><p> 设计基于黑名单的安全性是您现在可以进行的最糟糕的折衷之一。另请参见＆＃34;计算机安全中的六个最笨拙的想法＆＃34 ;：</p><p>   This doesn&#39;t apply if you aren&#39;t using SQL, but if you are: detect when a queryfails because of a syntax error (in MySQL, it is error 1064). If the failurehappened in production, fail in the loudest way possible. (I implemented this in2008 at Facebook and had it just email me and a few other people directly. Thesystem was eventually refined.)</p><p>   如果您不使用SQL，则不适用，但如果您使用的是：检测何时由于语法错误而导致查询失败（在MySQL中，错误为1064）。如果故障发生在生产中，则应尽可能大声地进行故障。 （我在2008年在Facebook上实现了此功能，并直接将其发送给我和其他几个人。系统最终得到了完善。）</p><p> This basically creates a high-signal stream that tells you where you have SQLinjection holes in your application. It will have some false positives and couldtheoretically have false negatives, but at Facebook it was pretty high signalconsidering how important the signal is.</p><p> 这基本上会创建一个高信号流，告诉您应用程序中SQLinjection漏洞的位置。它会有一些误报，理论上也可能有误报，但是在Facebook上，考虑到信号的重要性，信号很高。</p><p> Of course, the real solution here is to not have SQL injection holes in yourapplication, ever. As far as I&#39;m aware, this system correctly detected the oneSQL injection hole we had from mid-2008 until I left in 2011, which was in ahackathon project on an underisolated semi-production tier and didn&#39;t use thequery escaping system the rest of the application does.</p><p> 当然，这里真正的解决方案是永远在您的应用程序中没有SQL注入孔。据我所知，该系统正确地检测到我们从2008年中期到我在2011年离开时所遇到的oneSQL注入漏洞，该漏洞属于一个隔离的半生产层的ahackathon项目，并且没有使用查询转义系统，其余的应用程序都可以。</p><p> Hopefully, whatever language you&#39;re writing in has good query libraries thatcan handle escaping for you. If so, use them. If you&#39;re using PHP and don&#39;t havea solution in place yet, the Phabricator implementation of  qsprintf() issimilar to Facebook&#39;s system and was successful there.</p><p> 希望无论您使用哪种语言编写的代码，都可以使用良好的查询库来为您进行转义。如果是这样，请使用它们。如果您正在使用PHP并且还没有合适的解决方案，则qsprintf（）的Phabricator实现类似于Facebook的系统，并且在该系统中很成功。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://secure.phabricator.com/book/phabflavor/article/things_you_should_do_now/">https://secure.phabricator.com/book/phabflavor/article/things_you_should_do_now/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/应该/">#应该</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/系统/">#系统</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>