<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在BigBlueButton和JODConverter中通过LibreOffice实现文件外泄</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在BigBlueButton和JODConverter中通过LibreOffice实现文件外泄</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-22 08:49:14</div><div class="page_narrow text-break page_content"><p>BigBlueButton is a free web-based video conferencing software that lately got quite popular, largely due to Covid-19. Earlier this year I did a brief check on its security which led to an  article on Golem.de (German). I want to share the most significant findings here.   BigBlueButton has a feature that lets a presenter upload a presentation in a wide variety of file formats that gets then displayed in the web application. This looked like a huge attack surface. The conversion for many file formats is done with Libreoffice on the server. Looking for ways to exploit server-side Libreoffice rendering I found a  blog post by Bret Buerhaus that discussed a number of ways of exploiting such setups.   One of the methods described there is a feature in Opendocument Text (ODT) files that allows embedding a file from an external URL in a text section. This can be a web URL like https or a file url and include a local file.   This directly worked in BigBlueButton. An ODT file that referenced a local file would display that local file. This allows displaying any file that the user running the BigBlueButton service could access on the server. A possible way to exploit this is to exfiltrate the configuration file that contains the API secret key, which then allows basically controlling the BigBlueButton instance. I have a  video showing the exploit here. (I will publish the exploit later.)   I reported this to the developers of BigBlueButton in May. Unfortunately my experience with their security process was not very good. At first I did not get an answer at all. After another mail they told me they plan to sandbox the Libreoffice process either via a chroot or a docker container. However that still has not happened yet. It is planned for the upcoming version 2.3 and independent of this bug this is a good idea, as Libreoffice just creates a lot of attack surface.   Recently I looked a bit more into this. The functionality to include external files only happens after a manual user confirmation and if one uses Libreoffice on the command line it does not work at all by default. So in theory this exploit should not have worked, but it did.   It turned out the reason for this was another piece of software that BigBlueButton uses called  JODConverter. It provides a wrapper around the conversion functionality of Libreoffice. After contacting both the Libreoffice security team and the developer of JODConverter we figured out that it enables including external URLs by default.   I forwarded this information to the BigBlueButton developers and it finally let to a fix, they now change the default settings of JODConverter manually. The JODConverter developer considers changing the default as well, but this has not happened yet. Other software or web pages using JODConverter for serverside file conversion may thus still be vulnerable.   The fix was included in version 2.2.27. Today I learned that the company RedTeam Pentesting  has later independently found the same vulnerability. They also requested a CVE: It is now filed as CVE-2020-25820.   While this issue is fixed, the handling of security issues by BigBlueButton was not exactly stellar. It took around five months from my initial report to a fix. The  release notes do not mention that this is an important security update (the change has the note “speed up the conversion”).   I found a bunch of other security issues in BigBlueButton and proposed some hardening changes. This took a lot of back and forth, but all significant issues are resolved now.   Another issue with the presentation upload was that it allowed cross site scripting, because it did not set a proper content type for downloads. This was independently discovered by another person and was fixed a while ago. (If you are interested in details about this class of vulnerabilities: I have given  a talk about it at last year’s Security Fest.)   The session Cookies both from BigBlueButton itself and from its default web frontend Greenlight were not set with a secure flag, so the cookies could be transmitted in clear text over the network. This has also been changed now.   By default the BigBlueButton installation script starts several services that open ports that do not need to be publicly accessible. This is now also changed. A freeswitch service run locally was installed with a default password (“ClueCon”), this is now also changed to a random password by the installation script.   What also looks quite problematic is the use of outdated software. BigBlueButton only works on Ubuntu 16.04, which is a long term support version, so it still receives updates. But it also uses several external repositories, including one that installs NodeJS version 8 and shows a warning that this repository no longer receives security updates. There is an  open bug in the bug tracker.   If you are using BigBlueButton I strongly recommend you update to at least version 2.2.27. This should fix all the issues I found. I would wish that the BigBlueButton developers improve their security process, react more timely to external reports and more transparent when issues are fixed.     Image Source: Wikimedia Commons / NOAA / Public Domain</p><p>BigBlueButton是一款免费的基于网络的视频会议软件，最近变得相当流行，这在很大程度上要归功于新冠肺炎。今年早些时候，我对它的安全性做了简短的检查，结果写了一篇关于Golem.de(德语)的文章。我想在这里分享最重要的发现。BigBlueButton有一个功能，允许演示者上传各种文件格式的演示文稿，然后在Web应用程序中显示。这看起来像是一个巨大的攻击面。许多文件格式的转换都是在服务器上使用LibreOffice完成的。为了寻找利用服务器端LibreOffice呈现的方法，我找到了Bret Buerhaus的一篇博客文章，其中讨论了许多利用这种设置的方法。描述的方法之一是OpenDocument Text(ODT)文件中的一个功能，该功能允许在文本部分嵌入来自外部URL的文件。这可以是网页URL(如https)或文件URL，并包括本地文件。这在BigBlueButton中直接起作用。引用本地文件的ODT文件将显示该本地文件。这允许显示运行BigBlueButton服务的用户可以在服务器上访问的任何文件。利用此漏洞的一种可能方式是渗出包含API密钥的配置文件，这样基本上就可以控制BigBlueButton实例。我这里有一段视频显示了这个漏洞。(稍后我将发布该漏洞。)我在5月份向BigBlueButton的开发人员报告了这一点。不幸的是，我对他们的安全流程的体验不是很好。起初我根本没有得到答案。在另一封邮件之后，他们告诉我，他们计划通过chroot或docker容器对LibreOffice进程进行沙箱保护。然而，这还没有发生。这是为即将到来的2.3版本计划的，与这个bug无关，这是个好主意，因为LibreOffice只是制造了大量的攻击面。最近，我对此进行了更深入的研究。包含外部文件的功能仅在手动用户确认之后才会发生，如果用户在命令行上使用LibreOffice，则默认情况下它根本不起作用。因此，从理论上讲，这种利用本不应该奏效，但它确实奏效了。事实证明，这是BigBlueButton使用的另一款名为JODConverter的软件造成的。它为LibreOffice的转换功能提供了一个包装器。在联系了LibreOffice安全团队和JODConverter的开发人员之后，我们发现它在默认情况下支持包含外部URL。我将此信息转发给BigBlueButton开发人员，它最终得到修复，他们现在手动更改JODConverter的默认设置。JODConverter开发人员也考虑更改默认值，但这还没有实现。因此，使用JODConverter进行服务器端文件转换的其他软件或网页可能仍易受攻击。该修复包含在版本2.2.27中。今天我得知RedTeam Pentesting公司后来独立发现了同样的漏洞。他们还申请了CVE：现在提交的名称是CVE-2020-25820。虽然这个问题已经修复，但BigBlueButton对安全问题的处理并不十分出色。从我最初的报告到修复花了大约五个月的时间。发行说明没有提到这是一个重要的安全更新(更改中有注释“加快转换”)。我在BigBlueButton中发现了许多其他安全问题，并提出了一些强化的更改。这花了很多时间，但所有重要的问题现在都解决了。演示文稿上传的另一个问题是它允许跨站点脚本，因为它没有为下载设置正确的内容类型。这是另一个人独立发现的，前段时间已经修好了。(如果您对这类漏洞的详细信息感兴趣：我在去年的安全节上做过一次演讲。)来自BigBlueButton本身及其默认Web前端Greenlight的会话Cookie都没有设置安全标志，因此这些Cookie可以通过网络以明文传输。这一点现在也已经改变了。默认情况下，BigBlueButton安装脚本启动几个服务，这些服务打开不需要公开访问的端口。这一点现在也改变了。使用默认密码(“ClueCon”)安装了本地运行的freeswitch服务，现在安装脚本也将该密码更改为随机密码。看起来也很有问题的是过时软件的使用。BigBlueButton只适用于Ubuntu16.04，这是一个长期支持的版本，所以它仍然可以接收更新。但是它也使用几个外部存储库，包括一个安装NodeJS version8的外部存储库，并显示该存储库不再接收安全更新的警告。错误跟踪器中有一个打开的错误。如果您使用的是BigBlueButton，我强烈建议您至少更新到2.2.27版。这应该可以解决我发现的所有问题。我会的</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.hboeck.de/archives/902-File-Exfiltration-via-Libreoffice-in-BigBlueButton-and-JODConverter.html">https://blog.hboeck.de/archives/902-File-Exfiltration-via-Libreoffice-in-BigBlueButton-and-JODConverter.html</a></div><div class="story_tags page_narrow"></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>