<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>FPGA NTP服务器 FPGA NTP Server</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">FPGA NTP Server<br/>FPGA NTP服务器 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-02-17 18:05:51</div><div class="page_narrow text-break page_content"><p>Highly accurate synchronization of computer clocks is critical for many applications, such as air traffic control and high-frequency trading. Microprocessor based Network Time Protocol (NTP) servers suffer from a large amount of timestamp jitter, due to the hardware and Operating System (OS) being shared among other applications. The goal of this project is to implement a stratum-1 NTP server in reconfigurable logic that is capable of Gigabit Ethernet linerates with less than 8 ns of jitter.</p><p>对于许多应用，例如空中交通管制和高频交易，计算机时钟的高度精确同步至关重要。由于硬件和操作系统（OS）在其他应用程序之间共享，因此基于微处理器的网络时间协议（NTP）服务器遭受大量的时间戳抖动。该项目的目标是在可重新配置的逻辑中实现第1层NTP服务器，该服务器能够以小于8 ns的抖动实现千兆位以太网线性。</p><p>  The hardware platform for this project is the  Zedboard produced by Avnet. These boards are based around the Xilinx  Zynq-7000 SoC which provides a dual-core ARM processing system and FPGA programmable logic in one package. The Zedboards have an onboard Gigabit ethernet connection, however, It is not possible to route this directly into the programmable logic so an ethernet daughter board is required to achieve the necessary performance for the NTP server.</p><p>  该项目的硬件平台是安富利生产的Zedboard。这些板卡基于Xilinx Zynq-7000 SoC，该芯片在一个封装中提供了双核ARM处理系统和FPGA可编程逻辑。 Zedboard具有板载千兆位以太网连接，但是，无法将其直接路由到可编程逻辑中，因此需要一个以太网子板来实现NTP服务器所需的性能。</p><p>  The ARM core in the Zynq-7000 allows the board to run Linux which can communicate with the NTP server running on programmable logic through a simple custom driver. This driver allows for parameters to be set on the server and for the logging of NTP activities to be handled by the Linux installation as with a regular software implementation of an NTP server. This driver controls the NTP server by reading and writing values to a set of control registers instantiated within the NTP core using memory mapped IO. The second function of this driver is to handle the logging of the data generated by the NTP server. To do this, the driver provides several buffers in it&#39;s memory space to the NTP server which the FPGA dumps its data to directly. When a buffer is full, the FPGA fires an interrupt and moves onto the next buffer. The interrupt is handled by the driver and the full buffer is dumped to the file system. Linux can be installed and booted from the onboard SD card by following the instructions  here The device driver to control the FPGA NTP server is setup as a character device. Thus parameters can be set or retrieved by simply writing to this file once the driver kernel module has been inserted. The various registers and their position within the file is outlined in the table below. For example, if one wanted to set the IPv6 address for the NTP server, they would open the device file, scan to the 16th byte and write a 16 byte value from that position.  0 Bytes				 8 Bytes			 16 Bytes ----------------------------------------------------------------------------|		Time		 |		 Addend		 ||				 |					 | ----------------------------------------------------------------------------| 	 		 	 IPv6	 ||				 					 | ----------------------------------------------------------------------------| IPv4 | Port | MAC ||	 |		 | 	 | ----------------------------------------------------------------------------| 	 Buffer 1 |	 Buffer 2 || Mem. Addr	 	 |		 Mem. Addr | ----------------------------------------------------------------------------| Buffer | || Length | | ----------------------------------------------------------------------------</p><p>  Zynq-7000中的ARM内核使开发板可以运行Linux，该Linux可以通过简单的自定义驱动程序与在可编程逻辑上运行的NTP服务器进行通信。该驱动程序允许在服务器上设置参数，并允许NTP活动的日志记录由Linux安装（与NTP服务器的常规软件实现一样）进行处理。该驱动程序通过使用内存映射IO读取值并将值写入一组在NTP内核中实例化的控制寄存器来控制NTP服务器。该驱动程序的第二个功能是处理NTP服务器生成的数据的日志记录。为此，驱动程序会在其存储空间中为NTP服务器提供几个缓冲区，FPGA将数据直接转储到该NTP服务器。当缓冲区已满时，FPGA会触发一个中断并移至下一个缓冲区。中断由驱动程序处理，并将完整的缓冲区转储到文件系统。可以按照此处的说明从板载SD卡安装和引导Linux。用于控制FPGA NTP服务器的设备驱动程序已设置为字符设备。因此，一旦插入驱动程序内核模块，就可以通过简单地写入此文件来设置或检索参数。下表概述了各种寄存器及其在文件中的位置。例如，如果要为NTP服务器设置IPv6地址，则他们将打开设备文件，扫描到第16个字节，然后从该位置写入16个字节的值。 0字节8字节16字节-------------------------------------------- -------------------------------- |时间|加|| | | -------------------------------------------------- -------------------------- | IPv6 || | -------------------------------------------------- -------------------------- | IPv4 |港口MAC || | | | -------------------------------------------------- -------------------------- |缓冲区1 |缓冲区2 ||嗯地址|嗯地址| -------------------------------------------------- -------------------------- |缓冲液| ||长度| -------------------------------------------------- --------------------------</p><p> MAC:  The MAC address for the network controller connected to the NTP server (48-bits padded to 64)</p><p> MAC：连接到NTP服务器的网络控制器的MAC地址（48位填充为64位）</p><p>   Buffer 1 &amp; 2 Memory Address: The physical memory address of the buffers used to store NTP log data (room for 32 &amp; 64-bit pointers)</p><p>   缓冲区1和2内存地址：用于存储NTP日志数据的缓冲区的物理内存地址（可容纳32和64位指针的空间） </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://research.wand.net.nz/hardware/ntp.php">https://research.wand.net.nz/hardware/ntp.php</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ntp/">#ntp</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>