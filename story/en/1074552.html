<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ne Brezhibni协议（无缺陷协议）（2012年）Ne-Brezhibni Protokol (Non-Flawless Protocol) (2012)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Ne-Brezhibni Protokol (Non-Flawless Protocol) (2012)<br/>Ne Brezhibni协议（无缺陷协议）（2012年）</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-22 03:54:34</div><div class="page_narrow text-break page_content"><p>1. Why a new protocol?   The good old AX.25 has both good and bad features. Trying to find a better replacement we should first look at the bad features of AX.25 and the reasons why they could not be removed nor corrected. Next we should look at the good features of AX.25 that can not be found in other protocols. This is the way to design a better protocol for the future amateur packet-radio network.   After a few years of experimenting and an initial version AX.25 V1 the protocol specification was finally published as AX.25 V2.0 (1984):    AX.25 V2.0 specification    Some limitations of this AX.25 specification can be overcome easily. For example, the maximum payload length may be simply increased from the specified 256 bytes to 1500 bytes or even more. This brings great improvements especially for TCP/IP over AX.25.   Some specifications of AX.25 are a nightmare for the programmer. Addresses are seven bytes long! The odd, prime number 7 is maybe taken from some fairy tale? Not all bits of these 7 bytes are actually part of the address. Some bits are used for other purposes. Some remained undefined forever. How much programming effort does it take just to compare two AX.25 addresses?   AX.25 V2.0 introduced a terrible nuisance called the poll/final bit. In practice this generates lots of unnecessary traffic of RR-poll/RR-final (RR+/RR-) frames, slowing down the data throughput considerably. Fortunately users could switch back to AX.25 V1 on difficult links like HF. The SuperVozelj nodes use AX.25 V1 to improve the performance of backbone links and let the end user switch to AX.25 V1 if so desired.   Many programmers tried to avoid the RR+/RR- nuisance in their implementations of AX.25. Unfortunately this generated lots of incompatible software. Many AX.25 implementations introduced new protocol mistakes as well.   Some AX.25 software bugs made a really long way! A memory-management bug in the NETROM node firmware for the TNC2 was ported to the TF user firmware for the TNC2, to all versions of the TheNet node software, to the TFKISS program for MS-DOS and finally to some early versions of Linux. One could remotely crash Linux just by sending an AX.25 frame of legal but unexpected length (either too short or too long).   One of the last working implementations of AX.25 with reasonably few bugs (crash at FRMR observed) is Flexnet32 (AX.25 handling) used together with WPP150 (terminal program):    Flexnet32      WPP150    The worst mistake of AX.25 is that it groups too many protocol layers into a single protocol. Unfortunately AX.25 was invented when protocol nesting was not generally known yet. Unfortunately AX.25 is not compatible downwards nor upwards with other protocols.   Downward incompatibility means that AX.25 frames may not be transported by a lower-level protocol that does not keep the same frame sequence. Changing the sequence of AX.25 ACK frames generates AX.25 protocol errors. The latter trigger FRMR replies, reset the AX.25 link and crash some AX.25 implementations. The origin of this problem is the way in which AX.25 acknowledges and protocol counters work.   Upward incompatibility is observed easily when TCP/IP traffic is transmitted through an AX.25 link in the Virtual Circuit (VC) mode. The TCP layer may retry the frame transmission before the AX.25 layer receives the acknowledge, especially if the AX.25 link is slowed down by the RR+/RR- nuisance. The resulting congestion triggers further TCP retries into an endless loop. The origin of this problem is that AX.25 insists to do a perfect data transfer regardless of the time required.   Unfortunately, except for the payload length, none of the above-mentioned problems of AX.25 have ever been solved. The last published specification of AX.25 V2.2 (1998) only makes the protocol considerably more complicated. Therefore AX.25 V2.2 was never implemented in practice on any known hardware:    AX.25 V2.2 specification    Since these well-known problems of AX.25 have never been solved, AX.25 can not compete with commercial internet nor other modern communications. AX.25 networks all over the world were abandoned. The only application where AX.25 frames are still being used are very-low-rate communications like APRS:    APRS V1.0.1 specification    Unfortunately the inventors of APRS introduced their own protocol mistakes. A major mistake of APRS is the removal of the AX.25 destination address. Therefore APRS frames can not be routed through a standard AX.25 network. Since there is no destination address, replies to APRS messages can not be sent back to the original sender.   APRS is quite popular today and will probably stay popular in the future, since there are no inexpensive alternatives for very-low-rate communications. Any future amateur packet-radio network should therefore also support APRS in spite of the many design errors of the latter.   Inexpensive WLAN (WiFi) commercial equipment uses the IEEE 802.11 family of protocols. The latter only work over a single radio link. Network routing is performed at the next higher protocol layer (IP). The symbol rate is usually fixed in a particular 802.11 protocol. Different data rates are obtained using different symbols and different degrees of Forward Error Correction (FEC).   Simple IP routing as built in WLAN (WiFi) equipment only works fine for individual users accessing the public internet at the root of a tree network. Direct user-to-user communication is difficult if possible at all. Even more difficult is the opposite way, calling form the public network back to individual WLAN (WiFi) users.   An amateur packet-radio network implies an arbitrary network topology, preferably a true mesh network. Direct user-to-user communication should be possible without any help from an almighty server somewhere in the galaxy. The same protocol should allow communication between very different users operating at data rates that may differ by several orders of magnitude!   Last but not least, in order to keep radio amateurs interested in the operation of the packet-radio network as well as keep them experimenting with new techniques, routing should be controlled by the end users, not by the network nodes. The operation of the whole network should be clearly visible to all users. This is just the opposite of professional requirements, where the user data has to be encrypted and the network operation has to be kept hidden for security reasons.   AX.25 complies with all these requirements for an amateur network! AX.25 is scalable to data rates differing several orders of magnitude. AX.25 nodes allow any network topology. Besides simple digipeater service, AX.25 digipeater addressing allows passing different routing information to more complex network nodes like RMNC (Rhein-Main Network Controller) or SuperVozelj.   Commercial protocols, in particular the IEEE 802.11 family used in inexpensive WLAN (WiFi) equipment, do not meet the above requirements! Although WLAN (WiFi) equipment including its protocols may still be very useful to radio amateurs, a new protocol is required for the core packet-radio network. Of course, the new protocol should avoid the mistakes of AX.25. On the other hand, all of the good ideas of AX.25 should be made available again!   In 2009 the old AX.25 was mostly abandoned all over the world. In Slovenia there were many SuperVozelj nodes still operational. There were a few users still struggling to get internet access through the inefficient AX.25. Some users were hanging on the last operational DX cluster. The only remaining AX.25 BBS in Maribor had no more users at all. Find the place for all that obsolete equipment in the local museum or invent something new, that was the question!   The answer was the invention of a completely new protocol called NBP in 2009...      2. NBP fundamentals   The main requirement for a new amateur packet-radio protocol is to make radio links as reliable as wire links. Any other requirements should be met by higher-layer protocols at the discretion of the end users, thus allowing as much experimentation as possible. The new protocol was named &#34;Ne-Brezhibni Protokol&#34; (NBP) meaning Non-Flawless Protocol:       NBP is designed to make the likelihood of frame loss or duplication reasonably small by suitable design choices. On the other hand, the likelihood of these undesired events can not be made mathematically identical to zero without making the protocol considerably more complex, introducing delays and compromising the compatibility with higher-layer protocols. Therefore NBP is intentionally made imperfect!   On the other hand, all known communication protocols rely on checksums or better CRCs to eliminate data corrupted in a noisy transmission channel. Regardless of the CRC size, there is always a small, but finite and non-zero probability that a divisible error occurs during transmission. It therefore makes little sense to seek perfection in other parts of a communication protocol, especially if this partial perfection creates bottlenecks, complexity and incompatibility!   NBP is designed both for radio links between network nodes and for simple wire links inside a network node. The NBP frame size supports the standard Ethernet IP MTU of 1500 bytes. NBP is designed to run on 32-bit microprocessors, therefore all protocol variables are 32-bit numbers except the payload, which must have an integer number of bytes:       NBP uses two different type of frames over a radio link: a data frame and an acknowledge frame. A NBP data frame includes a 32-bit tag field, two address paths, a payload and a CRC. In a radio transmission, carefully chosen 32-bit pseudo-random numbers (PRNs) are used as 32-bit tags to uniquely identify a particular data frame on a particular radio segment of the network. The same PRN is used for the initial transmission and for any retries of the same data frame.   The correct reception of a data frame is acknowledged by replying with the same PRN. The NBP acknowledge frame only contains the PRN, one single address (acknowledges may be sent to the broadcast address ALL) and the CRC:       The address information in a NBP frame includes a forward address path and a return address path. Both address paths include between 1 and 16 addresses and are terminated with a separator (32-bit zero is a prohibited address). The immediate destination of the frame is the first address in the forward address path, in other words the 32-bit field immediately following the PRN.   Most NBP frames are addressed to a single destination. NBP also allows a broadcast address (ALL) specified by having all ones in the 32-bit address. All NBP stations are expected to listen to the broadcast address. The forward address path may contain more than one broadcast address. The return address path should not contain any broadcast addresses.   After receiving a valid data frame, the NBP station shifts the forward address path down by one address. The address shifted out at the bottom is discarded. The NBP station own address is added to the beginning of the return address path. The size of the forward address path is decreased by one address while the size of the return address path is increased by one address. The total length of the NBP frame thus remains unchanged!   If the forward address path still contains one or more valid addresses after the above-mentioned address rotation, a new PRN is assigned to the NBP frame, a new CRC is computed and the frame is forwarded to the next radio link.   If the forward address path is empty after the above-mentioned address rotation, the receiver simply uses the payload. The information contained in the return address path may be used for an immediate reply and/or to update the routing table of a supported higher-level protocol.   NBP addresses are 32-bit numbers. The latter are sent over radio and wire links and are understood perfectly by computers running the described protocol. On the other hand, such large numbers are difficult to read, memorize and type again for humans. A simple and efficient human interface is modulo (36) encoding:       The modulo (36) coding table includes 10 decimal digits 0..9 and 26 letters A..Z as symbols of a 36-symbol character set. NBP addresses are therefore written as simple alphanumerical strings containing up to 6, sometimes even 7 characters. The only limitation is that trailing zeros are not displayed. Short names of people and places, abbreviations for frequency bands, radio-amateur callsigns etc can all be typed in as valid NBP addresses!   The special broadcast address includes 32 logical ones or 0xFFFFFFFF in hexadecimal. In the described modulo (36) encoding, the broadcast address is represented by the string &#34;3Z141Z1&#34;. Rather than using this ugly string, an asterisk &#34;*&#34; is generally used to specify the NBP broadcast address.   NBP equipment never makes any unsolicited transmissions, like sending beacons, status messages etc. Network discovery may always be performed by the final user with one or more broadcast addresses &#34;*&#34; in the forward address path of a remote command. Besides an unknown end station network discovery may also include unknown nodes.   Any NBP data frame sent to a broadcast address will be multiplied to all available ports of a NBP node. Usually, a broadcast frame will be sent at the same time both to the radio port and to the local wire loop. The radio transmission will not expect an acknowledge nor it will ever be retried. Asterisks &#34;*&#34; must be used with caution since the number of replies grows exponentially with the number of broadcast addresses in the forward address path!      3. NBP radio transmission   Noise, interference, multipath distortion and collisions corrupt the data transmitted through a radio channel. If a data frame is lost, its transmission has to be repeated. On the other end of the radio link, correct reception has to be acknowledged and duplicates have to be discarded. All these actions require labeling the data frames with unique tags.   Unique tags can not be computed from the frame content. The information stream may contain two or more identical data frames. The receiver might consider all subsequent identical frames as duplicates if the unique tags were derived from the frame content alone.   Protocol counters are frequently used as unique tags. Counters require link establishment, synchronization and link reset. The AX.25 protocol is a clear example of several unfortunate choices for the protocol counters, increasing the protocol complexity and severely limiting its compatibility both downwards and upwards.   NBP uses large (32-bit) pseudo-random numbers as unique tags for the data frames. 32-bit numbers are large enough so that the likelihood of finding two identical ones is small enough. Pseudo-random numbers are generated by a 32-bit primitive polynomial generator. Further, the 32-bit station own address is added to the 32-bit result so that each NBP station generates its own, different sequence of pseudo-random numbers:       The NBP receiver acknowledges all correctly received frames. The PRN unique tag is compared to all of the entries in a circular table. If an identical entry is found in the table, the frame is considered a duplicate and it is discarded. If there is no identical entry in the table, the frame is considered valid and its PRN unique tag is entered in the circular table, replacing the oldest entry.   The circular table contains 1024 entries. This table size is large enough to allow all sensible settings of the retry parameters. On the other hand, the table is small enough to to be scanned in a reasonable amount of time by the CPU.   The acknowledge protocol described above may not maintain the same sequence of the data frames. A later frame may get through immediately while an earlier frame waits for several retries. Changing the sequence of data frames has no effect on TCP/IP nor on many other higher protocols, since they are all designed to operate in even more complex environments.   Unfortunately, changing the sequence of AX.25 acknowledges may crash the AX.25 protocol into a FRMR link reset. AX.25 tunnels through the NBP network may not work reliably. Fortunately, this event is very rare when the AX.25 speed (1200bps) is much smaller than the NBP speed (&gt;1Mbps). Setting the AX.25 parameter MAXFRAME to 1 also solves the problem in most cases. APRS tunnels are not affected, since AX.25 protocol counters are not used in APRS.   A unique tag of all (32) zeros is not allowed. This could be used to run different protocols over the same radio link.   A unique tag of all (32) ones has a special meaning. This unique tag does not require acknowledgment nor it is ever compared to the content of the circular table. The corresponding data frame will not be retransmitted automatically so that duplicates can not be generated. This special unique tag is usually (but not necessarily) associated to broadcast messages intended to all listening stations.   NBP uses simple random access to a simplex radio channel. Although undesired, collisions are expected. In order to control collisions, the retry-delay time is made proportional to the number of retries already performed. Further, the retry-delay time includes a random component, so that the two colliding transmitters will not collide at the next retry as well:       The original implementation of NBP uses HDLC (X.25) framing on the radio link. Besides backward compatibility with AX.25, HDLC framing offers several advantages in a simple radio link. HDLC framing offers really low framing overhead (few inserted zeros) compared to other methods like 4B5B. Start (head) and stop (tail) flags can also be used as synchronization sequences. The NRZI(0) differential encoding guarantees clock recovery but at the same time solves the BPSK RTX signal-polarity ambiguity:       A NBP transmission packet may include more than one frame. All NBP acknowledge frames are included in the first available transmission packet and are always located at the beginning of the transmission packet. Some NBP data frames may be inserted in the transmission packet. Some data frames waiting for acknowledge may not be transmitted in the first available packet.   The NBP specifies that each data frame travels autonomously, independent of other data. Each data frame has its own retry counter. Each data frame waits its own retry timer to expire.   Although small and obsolete by today&#39;s standards, the same 16-bit CCITT-CRC was found sufficient for NBP radio links. The same algorithm is used both for CRC generation in the transmitter and for CRC check in the receiver. The content of the TX CRC generator is inverted before transmission so that it is subtracted from the content of the RX CRC checker. After 16 clocks of processing, a correct CRC subtraction will produce the pattern 0xF0B8 in the CRC checker:       Finally, all successful modems, bit synchronizers, scramblers and radio transceivers originally developed for AX.25 can also be used for NBP links. Using HDLC with NRZI(0) encoding, a Manchester modem can solve the DC-component problem with WBFM radios while a K9NG/G3RUH scrambler can solve the same problem with ZIF-BPSK radios.   Last but not least, any network protocol has to deal with congestion. Radio transmission of data frames requires buffer memory while waiting for acknowledge or retry. NBP equipment handles congestion with a special parameter called MINBLOK:       As long as the amount of free buffer-memory blocks exceeds MINBLOK, the data frames are transmitted as usual waiting for ACK and retransmitted if necessary. As the amount of free memory blocks drops below MINBLOK, the exceeding waiting data frames may only be retransmitted once in the next transmission packet and discarded immediately afterward. The oldest data frames are discarded first, maybe after giving </p><p>1.为什么要制定新的协议？那把好斧头。25有好的和坏的特点。为了找到更好的替代品，我们应该先看看AX的坏特性。以及无法删除或更正的原因。接下来我们应该看看AX的好特性。25在其他协议中找不到。这是为未来业余分组无线网络设计更好协议的途径。经过几年的试验和初步版本的AX。25 V1协议规范最终发布为AX。25 V2。0（1984）：斧头。25 V2。0规范说明了此AX的一些限制。25种规格很容易克服。例如，最大有效负载长度可以简单地从指定的256字节增加到1500字节甚至更多。这带来了巨大的改进，尤其是对于TCP/IP over AX。25.AX的一些规格。25对程序员来说是一场噩梦。地址有七个字节长！奇数素数7可能来自童话故事？并非这7个字节的所有位实际上都是地址的一部分。有些位用于其他目的。有些永远没有定义。仅仅比较两个AX需要多少编程工作量。25个地址？斧头。25 V2。0引入了一个可怕的麻烦，称为poll/final位。在实践中，这会产生大量不必要的RR poll/RR final（RR+/RR-）帧流量，大大降低了数据吞吐量。幸运的是，用户可以切换回AX。在HF等困难链接上使用25 V1。SuperVozelj节点使用AX。25 V1以提高主干链路的性能，并让最终用户切换到AX。25 V1（如果需要）。许多程序员在他们的AX实现中都试图避免RR+/RR干扰。25.不幸的是，这产生了许多不兼容的软件。许多斧头。25种实现也引入了新的协议错误。一些斧头。25个软件漏洞让我们走了很长的路！TNC2的NETROM节点固件中的内存管理错误被移植到TNC2的TF用户固件、所有版本的TheNet node软件、MS-DOS的TFKISS程序，最后移植到一些早期版本的Linux。只需发送一个AX，就可以远程崩溃Linux。25帧，长度合法但意外（太短或太长）。AX的最后一个工作实现之一。Flexnet32（AX.25处理）与WPP150（终端程序）一起使用时，出现了相当少的错误（在FRMR处观察到崩溃）：Flexnet32</p><p>......</p><p>......</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/协议/">#协议</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/brezhibni/">#brezhibni</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ax/">#ax</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>