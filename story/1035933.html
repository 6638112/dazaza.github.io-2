<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Docker中的全栈但简单的邮件服务器（SMTP，IMAP，反垃圾邮件，防病毒..）</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Docker中的全栈但简单的邮件服务器（SMTP，IMAP，反垃圾邮件，防病毒..）</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-23 00:16:49</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/f5529251005900f0f2eaa3cb45ec233c.jpeg"><img src="http://img2.diglog.com/img/2020/11/f5529251005900f0f2eaa3cb45ec233c.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>完整但简单的邮件服务器（SMTP，IMAP，反垃圾邮件，防病毒...）。仅配置文件，无SQL数据库。保持简单和版本化。易于部署和升级。</p><p>    从v7.1.0版本开始，默认变量的使用已略有更改。请查阅环境变量部分</p><p>  具有SSL支持，LDAP身份验证，筛选和配额的Dovecot for SASL，IMAP（和可选的POP3）</p><p>                 加上地址（也就是扩展名分隔符）可以直接使用：给您的电子邮件+extension@example.com转到you@example.com</p><p>  在打开问题之前，请查看此自述文件，Wiki和Postfix / Dovecot文档。</p><p>       注意：您需要停用某些服务，例如ClamAV才能在具有512MB RAM的主机上运行。即使使用1G RAM，您也可能在没有交换的情况下遇到问题，请参阅FAQ。</p><p>       注意：.env中的变量仅在docker-compose.yml文件中扩展，而不在容器中扩展。在容器中使用环境变量的情况下，文件mailserver.env用于这种情况。</p><p>注意：如果要使用裸域（主机名等于域名），请参阅FAQ。</p><p>     编辑文件.env和docker-compose.yml。在.env中，取消注释变量SELINUX_LABEL。如果要在其他容器之间共享卷绑定安装，请将-Z切换为-z。在docker-compose.yml中，取消注释包含$ {SELINUX_LABEL}的行，并注释掉或删除上面的行。</p><p> 注意：使用setup.sh时，请使用选项-z或-Z。该值应与.env文件中SELINUX_LABEL的值匹配。请参阅Wiki，以获取有关setup.sh的更多信息。</p><p>   现在已经生成了密钥，您只需将config / opendkim / keys / domain.tld / mail.txt的内容粘贴到domain.tld.hosts区域中即可配置DNS服务器。</p><p>    你完成了！并且不要忘记使用./setup.sh -h来查看setup.sh脚本的其余功能。</p><p>  如果您在SPF和/或转发邮件方面遇到任何问题，请尝试SRS。您可以通过设置ENABLE_SRS = 1来启用SRS。有关更多信息，请参见变量描述。</p><p>   当两端都支持STARTTLS时，可以通过TLS保护连接。在端口110、143和587上，docker-mailserver将拒绝无法保护的连接。需要端口25支持不安全的连接。</p><p>接收电子邮件并过滤垃圾邮件和病毒。要提交外发邮件，您应该首选需要身份验证的提交端口（465，587）。除非配置了中继主机，否则传出电子邮件将通过端口25离开服务器（因此，出站流量不得被您的提供商或防火墙阻止）。</p><p>    版本：'3.8'服务：邮件：图片：tvial / docker-mailserver：最新主机名：邮件＃$ {HOSTNAME}域名：domain.com＃$ {DOMAINNAME}容器名：邮件＃$ {CONTAINER_NAME}端口：-“ 25： 25“-” 143：143“-” 587：587“-” 993：993“卷：-邮件数据：/ var / mail-邮件状态：/ var / mail-state-邮件日志：/ var / log / mail-./ config /：/ tmp / docker-mailserver /环境：-ENABLE_SPAMASSASSIN = 1-SPAMASSASSIN_SPAM_TO_INBOX = 1-ENABLE_CLAMAV = 1-ENABLE_FAIL2BAN = 1-ENABLE_POSTGREY = 1-ONE_DIR = 1-DMS_DEBUG = 0 cap_add：-NET_EMIN-始终重新启动：SYS_PTRAC ：maildata：mailstate：maillogs：</p><p>  版本：'3.8'服务：邮件：图片：tvial / docker-mailserver：最新主机名：邮件＃$ {HOSTNAME}域名：domain.com＃$ {DOMAINNAME}容器名：邮件＃$ {CONTAINER_NAME}端口：-“ 25： 25“-” 143：143“-” 587：587“-” 993：993“卷：-邮件数据：/ var / mail-邮件状态：/ var / mail-state-邮件日志：/ var / log / mail-./ config /：/ tmp / docker-mailserver /环境：-ENABLE_SPAMASSASSIN = 1-SPAMASSASSIN_SPAM_TO_INBOX = 1-ENABLE_CLAMAV = 1-ENABLE_FAIL2BAN = 1-ENABLE_POSTGREY = 1-ONE_DIR = 1-DMS_DEBUG = 0-ENABLE_LDAP = 1-LDAP_SERVER_HOST = ld ldap容器/ IP /服务器名称-LDAP_SEARCH_BASE = ou = people，dc = localhost，dc = localdomain-LDAP_BIND_DN = cn = admin，dc = localhost，dc = localdomain-LDAP_BIND_PW = admin-LDAP_QUERY_FILTER_USER =（＆（mail =％s）（ mailEnabled = TRUE））-LDAP_QUERY_FILTER_GROUP =（＆（mailGroupMember =％s）（mailEnabled = TRUE））-LDAP_QUERY_FILTER_ALIAS =（|（＆（mailAlias =％s）（objectClass = PostfixBookMailForward））（＆（mailAlias =％s）（ objectClass =发布fixBookMailAccount）（mailEnabled = TRUE）））-LDAP_QUERY_FILTER_DOMAIN =（|（＆（mail = * @％s）（objectClass = PostfixBookMailAccount）（mailEnabled = TRUE））（＆（mailGroupMember = * @％s）（objectClass = PostfixBookMailAccount） （mailEnabled = TRUE））（＆（mailalias = * @％s）（objectClass = PostfixBookMailForward））-DOVECOT_PASS_FILTER =（＆（objectClass = PostfixBookMailAccount）（uniqueIdentifier =％n）-DOVECOT_USER_FILTER =（＆（objectClass = PostfixBookMailAccount） （uniqueIdentifier =％n））-ENABLE_SASLAUTHD = 1-SASLAUTHD_MECHANISMS = ldap-SASLAUTHD_LDAP_SERVER = ldap-SASLAUTHD_LDAP_BIND_DN = cn = admin，dc = localhost，dc =本地域-SASLAUTHD_LDAP_PASSWORD = admin-SASLAUTHD = LDAP，people = localdomain-SASLAUTHD_LDAP_FILTER =（＆（objectClass = PostfixBookMailAccount）（uniqueIdentifier =％U））-POSTMASTER_ADDRESS=postmaster@localhost.localdomain-POSTFIX_MESSAGE_SIZE_LIMIT = 100000000 cap_add：-NET_ADMIN-SYS_PTRACE重新启动：始终是卷：maildata邮件状态：</p><p>  如果某个选项无法如本文所述工作，请检查您是否正在运行最新的映像！粗体为默认值。</p><p> 注意：自docker-mailserver v7.1.0起，环境变量的比较以不同的方式执行。如果您以前使用VARIABLE =''作为空值，请更新为现在使用VARIABLE =。</p><p>        1 =>将所有状态合并到一个目录（/ var / mail-state）中，以允许使用Docker卷进行持久化</p><p>              旧=>未实现。如果确实需要，请自定义覆盖后缀和dovecot设置Wiki的TLS密码</p><p>空=>允许邮件地址欺骗。任何登录的用户都可以使用伪造的发件人地址创建电子邮件。另请参阅Wikipedia（不建议使用，但出于向后兼容的原因而为默认）</p><p> 1 =>（推荐）拒绝邮件欺骗。每个用户只能发送自己的别名地址。具有扩展名分隔符的地址无法发送消息。</p><p>  启用发件人重写方案。如果您的邮件服务器充当转发器，则需要SRS。有关更多说明，请参见postsrsd。</p><p>   为mynetworks选项设置不同的选项（可以在postfix-main.cf中覆盖）警告：将Docker网络的网关添加到受信任主机列表中，例如使用network或connected-networks选项，可以创建一个开放中继，例如，如果在主机上启用了IPv6，但在Docker中未启用IPv6。</p><p> 网络=>添加docker默认桥接网络（172.16.0.0/12）;警告：在这种情况下，docker-compose可能会使用其他主机（例如192.168.0.0/16）使用PERMIT_DOCKER = connected-networks</p><p>   如果您的网络接口与eth0不同，例如在Kubernetes中使用HostNetworking时，可以将其设置为所需的任何接口。然后将使用此接口。</p><p>      此选项正在激活POSTFIX_DAGENT的用法，以指定不同于默认dovecot套接字的ltmp客户端。</p><p>设置所有用户的邮箱大小限制。如果设置为零，则大小将不受限制（默认）。</p><p>      设置所有用户的邮件大小限制。如果设置为零，则大小将不受限制（不建议！）</p><p>     =>指定要为其提供邮件的标准域名。这用于许多配置功能，因此，如果您无法设置主机名（例如，您在不允许的容器平台中），请在此环境变量中进行指定。</p><p>    强制=>允许其他测试完成。拒绝尝试发送带有550 SMTP答复的邮件的尝试，并记录helo / sender /收件人信息。下次客户端连接时重复此测试。</p><p> drop =>立即使用521 SMTP回复删除连接。下次客户端连接时重复此测试。</p><p> 忽略=>忽略此测试的失败。允许其他测试完成。下次客户端连接时重复此测试。此选项对于测试和收集统计信息而不阻止邮件很有用。</p><p>  mdbox ==>（实验性）使用Dovecot高性能邮箱格式，每个文件多个消息，每个框多个文件</p><p>该选项已在2019年11月添加。在docker-mailserver中使用Maildir以外的其他格式被认为是实验性的，仅应用于测试目的。有关更多详细信息，请参阅Dovecot文档。</p><p>        这是一个新选项。仍然支持旧的REPORT选项以实现向后兼容性。如果未设置此选项，并且使用旧选项启用了报告，则将使用logrotate。</p><p>                    更改轮换日志和发送（不建议使用）报告的时间间隔。</p><p>  注意：此变量用于控制容器内的logrotate旋转并在日志旋转时发送pflogsumm报告。为了向后兼容，仍支持该变量，但添加了新选项LOGROTATE_INTERVAL，仅旋转日志。</p><p>    请注意，只有容器内部的日志会受到影响。完整的日志输出仍可通过docker logs邮件（或您各自的容器名称）获得。如果要控制docker生成的日志文件的logrotation，请参阅：Docker Logging Drivers。</p><p> 另请注意，默认情况下，回收容器时日志会丢失。要保留日志，请挂载卷。</p><p> 最后，logrotate间隔可能会影响生成报告的时间。当报告由日志轮换触发时就是这种情况。</p><p>/！\垃圾邮件发送：启用垃圾邮件处理程序后，标记为垃圾邮件的邮件将不会被发送。使用SPAMASSASSIN_SPAM_TO_INBOX = 1接收垃圾邮件。</p><p>  1 =>垃圾邮件将发送到收件箱，并使用SA_SPAM_SUBJECT标记为垃圾邮件。</p><p>            注意：此spamassassin设置需要ENABLE_SPAMASSASSIN = 1。默认情况下，邮件服务器配置为隔离垃圾邮件。如果隔离了电子邮件，则将它们压缩并存储在取决于上述ONE_DIR设置的位置。如果ONE_DIR = 1，则位置为/ var / mail-state / lib-amavis / virusmails /。如果ONE_DIR = 0，则为/ var / lib / amavis / virusmails /。这些路径在docker容器内。要禁止这种行为并发送垃圾邮件，请将其设置为很高的值，例如100.0。</p><p>   注意：此spamassassin设置需要ENABLE_SPAMASSASSIN = 1。通过插入关键字SCORE：*** SPAM（SCORE）***，将spamassassin分数添加到主题行。</p><p>    注意：仅当您对贝叶斯数据库有信心来识别垃圾邮件时才激活它。</p><p>    注意：仅当您对贝叶斯数据库有信心识别火腿时，才激活此选项。</p><p>        注意：为了准备将ldap服务器与此容器结合使用，本文可能会有所帮助</p><p>注意：如果要结合使用邮件服务器和docker-compose，可以在此处设置服务名称</p><p>                                    注意：左边的值是目录属性，右边的值是dovecot变量。</p><p>    注意：左边的值是目录属性，右边的值是dovecot变量。</p><p>        35 =>删除自上次被看到以来早于N天的条目</p><p>              例如使用SASLAUTHD_MECHANISMS rimap，您需要指定imap服务器的IP地址/服务器名称==> xxx.xxx.xxx.xxx</p><p>                 电子邮件具有“信封”发件人（指示发送服务器）和“标头”发件人（指示发送者）。更严格的SPF政策可能要求您同时替换这两者，而不仅仅是信封发送者。</p><p>      您可以指定多个键，以逗号分隔。第一个用于签名，其余的用于验证。这就是您旋转和到期密钥的方式</p><p>如果自动检测失败，不是您想要的或希望有单独的容器处理DSN，请设置此选项</p><p>   默认主机和端口，以中继所有邮件。格式：[example.com]：587（如果需要与$ RELAY_USER和$ RELAY_PASSWORD兼容，请不要忘记括号，如下所述）。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://github.com/tomav/docker-mailserver">https://github.com/tomav/docker-mailserver</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/病毒/">#病毒</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/docker/">#docker</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/全栈/">#全栈</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/服务器/">#服务器</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/simple/">#simple</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1035856.html"><img src="http://img2.diglog.com/img/2020/11/thumb_a5099c7573d45b4994a8c13dcb497081.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035856.html">病毒式的南达科他州护士和Covid轻信</a></div><span class="my_story_list_date">2020-11-22 12:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035834.html"><img src="http://img2.diglog.com/img/2020/11/thumb_93662622bce782c5b24bd8b01b6575c9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035834.html">在上个星期，美国经历了100万例新的冠状病毒病例</a></div><span class="my_story_list_date">2020-11-22 7:58</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035831.html"><img src="http://img2.diglog.com/img/2020/11/thumb_85b0d56df858e8486162fd11e1e6f83b.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035831.html">圣诞老人对冠状病毒的免疫</a></div><span class="my_story_list_date">2020-11-22 7:48</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035543.html"><img src="http://img2.diglog.com/img/2020/11/thumb_db1bc2222092828e99ab763d640cca16.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035543.html">冠状病毒的免疫力可能在去年，新的数据提示</a></div><span class="my_story_list_date">2020-11-21 12:51</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>