<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>未经许可，我的NAS通过互联网暴露 My NAS exposes itself over the internet without permission</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">My NAS exposes itself over the internet without permission<br/>未经许可，我的NAS通过互联网暴露 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-04 00:34:04</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/0949860d73f2e10bd7d8b7e6002a74ea.png"><img src="http://img2.diglog.com/img/2021/4/0949860d73f2e10bd7d8b7e6002a74ea.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>I recently bought a Terramaster F2-210. It’s a reasonably nice NAS that does what I ask of it. I however discovered something which unsettled me. As I’ve discussed in previous articles  uPnP is a convenience that can be particularly dangerous. These NAS products are generally administrated using a web interface and The Terramaster TOS software is no different. The software requests you visit the hostname of the device on your network port 8181 in order to access the NAS interface, and the interface openly claims the NAS is not publicly accessible.</p><p>我最近买了一个teramaster f2-210。这是一个合理的漂亮的NA，可以做到我的要求。然而，我发现了一些令我沮丧的东西。正如我在以前的文章中讨论的那样，UPNP是一种特别危险的便利性。这些NAS产品通常使用Web界面管理，并且Teramaster TOS软件没有任何不同。该软件请求您访问网络端口8181上设备的主机名，以便访问NAS接口，并且界面公开要求NAS无法公开访问。</p><p>  A few days after installing the NAS, I discovered I could access the NAS using my public IP, even though I hadn’t port forwarded anything! Upon inspecting my routers port forwarding rules, I identified that the NAS was punching 4 ports using uPnP. It was punching 8181 as we just discovered, but also 5443 which is for SSL access should you have configured it, and inexplicably port 9091, which normally is for Portainer, a container management tool for Docker, as well as 8800 - I’m not sure what this port is. It seems that potentially some of these rules were left in from the development process. I trust this NAS to be reliable hardware, however I am dubious of trusting its web interface to the open internet. Generally good practice to expose as little as possible to the public internet anyway!</p><p>  安装NAS后几天，我发现我可以使用我的公共IP访问NAS，即使我没有移植到任何东西！在检查路由器端口转发规则时，我确定NAS使用UPnP打孔4个端口。它正在冲出8181，因为我们刚刚发现，也是5443，用于SSL接入应该配置它，并且莫名其妙的端口9091，通常用于Portainer，用于Docker的容器管理工具以及8800  - 我不是确定这个端口是什么。从开发过程中似乎似乎有些规则留下了一些规则。我相信这款NAS是可靠的硬件，但是我可以为您的Web界面信任开放互联网。无论如何，一般善行会尽可能少地曝光！</p><p>  Unfortunately, disabling uPnP these days is too much of a hit to convenience, so I looked for other solutions. My router is an ISP provisioned one so the feature-set there is somewhat limited, so I wanted to prevent the NAS from opening these ports rather than firewalling them off at the router.</p><p>  不幸的是，这几天禁用UPnP太多的击中了方便，所以我寻找其他解决方案。我的路由器是一个ISP配置，所以功能集有一些有限的功能，所以我想防止NAS打开这些端口，而不是在路由器处关闭它们。</p><p> I dug through the NAS interface and was not able to discover a way to disable this behaviour, since I didn’t really want my NAS administration interface publicly accessible. What I did discover was that the default web server port was at least configurable, so I changed it, and checked the uPnP port mappings again. Somewhat surprisingly, it punched holes for these new ports, but didn’t clear the existing ports!</p><p> 我通过NAS接口挖掘，无法发现一种禁用这种行为的方法，因为我真的不希望我的NAS管理界面可公开访问。我所发现的是默认的Web服务器端口至少可配置，因此我更改了它，然后再次检查UPnP端口映射。有点令人惊讶的是，它为这些新港口打孔，但没有清除现有的港口！</p><p>  This annoyed me, so I contacted Terramaster about this 6 weeks ago, hoping they’d have a suggestion or something as a fix, but this wasn’t supplied, and therefore I went digging myself.</p><p>  这让我感到恼火，所以我联系了大约6周前的Teramaster，希望他们有一个建议或一些东西作为修复，但这没有提供，因此我挖掘自己。</p><p> Upon SSHing into the NAS and having a dig around the file system, I discovered a file that could be modified. /etc/upnp.json seems to contain a list of port forwarding rules. Thank you to Terramaster for providing root access to these at least. Simply change  bEnable to 0 for whatever ports you don’t want exposed, reboot the NAS, and check the port forwarding rules.</p><p> 在SSHING进入NAS并在文件系统周围挖掘时，我发现了一个可以修改的文件。 /etc/upnp.json似乎包含一个端口转发规则列表。感谢TerraMaster至少提供对此的根目录。无论您不想要暴露的任何端口，重新启动NAS，并检查端口转发规则，只需更改为0即可。</p><p> &#34;triestimes&#34;: 3, &#34;mapList&#34;: [ { &#34;desc&#34;: &#34;ftp&#34;, &#34;nExternalPort&#34;: 6221, &#34;nInternalPort&#34;: 21, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 }, { &#34;desc&#34;: &#34;ftp_data&#34;, &#34;nExternalPort&#34;: 2000, &#34;nInternalPort&#34;: 20, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 }, { &#34;desc&#34;: &#34;sshd&#34;, &#34;nExternalPort&#34;: 22, &#34;nInternalPort&#34;: 22, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 1 }, { &#34;desc&#34;: &#34;telnetd&#34;, &#34;nExternalPort&#34;: 23, &#34;nInternalPort&#34;: 23, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 }, { &#34;desc&#34;: &#34;http_ssl&#34;, &#34;nExternalPort&#34;: 54633, &#34;nInternalPort&#34;: 54633, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 }, { &#34;desc&#34;: &#34;http&#34;, &#34;nExternalPort&#34;: 54632, &#34;nInternalPort&#34;: 54632, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 }, { &#34;desc&#34;: &#34;pt&#34;, &#34;nExternalPort&#34;: 9091, &#34;nInternalPort&#34;: 9091, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 }, { &#34;desc&#34;: &#34;http_pri&#34;, &#34;nExternalPort&#34;: 8800, &#34;nInternalPort&#34;: 8800, &#34;sProtocol&#34;: &#34;TCP&#34;, &#34;bEnable&#34;: 0 } ]</p><p> ＆＃34;＆＃34 ;: 3，＆＃34; maplist＆＃34 ;: [{＆＃34; desc＆＃34 ;:＆＃34; ftp＆＃34;＆＃34; nexternalport＆＃34 ;: 6221 ，＆＃34; ninernalport＆＃34 ;: 21，＆＃34; sprotocol＆＃34 ;:＆＃34; tcp＆＃34 ;,＆＃34; benable＆＃34 ;: 0}，{＆＃34; desc＆＃34 ;＆＃34; ftp_data＆＃34 ;,＆＃34; nexternalport＆＃34 ;: 2000，＆＃34; ninternalport＆＃34 ;:20，＆＃34; sprotocol＆＃34 ;:＆＃34; tcp＆＃34; ，＆＃34;有点和＃34 ;: 0}，{＆＃34; desc＆＃34 ;:＆＃34; sshd＆＃34 ;,＆＃34; nexternalport＆＃34 ;:22，＆＃34; ninernalport＆＃34; ninernalport＆＃34; ;：22，＆＃34; Sprotocol＆＃34 ;:＆＃34; TCP＆＃34 ;,＆＃34; Benable＆＃34 ;: 1}，{＆＃34; desc＆＃34 ;:＆＃34; telnetd＆＃ 34;，＆＃34; nexternalport＆＃34 ;: 23，＆＃34; ninernalport＆＃34 ;: 23，＆＃34; Sprotocol＆＃34 ;:＆＃34; tcp＆＃34 ;,＆＃34; benable＆＃34; ;：0}，{＆＃34; DESC＆＃34 ;:＆＃34; http_ssl＆＃34 ;,＆＃34; nexternalport＆＃34 ;: 54633，＆＃34; ninernalport＆＃34 ;: 54633，＆＃34; Sprotocol＆＃34 ;:＆＃34; tcp＆＃34 ;,＆＃34; beable＆＃34 ;: 0}，{＆＃34; desc＆＃34 ;:＆＃34; http＆＃34 ;,＆＃34; nexternalport＆＃34; nexternalport＆＃34; nexternalport＆＃34; nexternalport＆ ＃34 ;: 54632，＆＃34; ninternalport＆＃34 ;: 54632，＆＃34; sprotocol＆＃34 ;:＆＃34; tcp＆＃34;＆＃34; benable＆＃34 ;: 0}，{＆＃ 34; desc＆＃34; ：＆＃34; pt＆＃34 ;,＆＃34; nexternalport＆＃34 ;: 9091，＆＃34; ninernalport＆＃34 ;: 9091，＆＃34; sprotocol＆＃34 ;:＆＃34; tcp＆＃34;， ＆＃34;有点和＃34 ;: 0}，{＆＃34; desc＆＃34 ;:＆＃34; http_pri＆＃34 ;,＆＃34; nexternalport＆＃34 ;: 8800，＆＃34; ninernalport＆＃34; ninernalport＆＃34; ：8800，＆＃34; Sprotocol＆＃34 ;:＆＃34; TCP＆＃34 ;,＆＃34; beable＆＃34 ;: 0}] </p><p> This almost completely resolves the problem, however it seems the ports 8181 and 5443 remain punched, but result in a 404, since we moved the web server earlier. This is better than before, but still not perfect. I await further instructions from Terramaster/a software update, and will update this blog post should I get this.</p><p>这几乎完全解决了问题，但似乎端口8181和5443仍然被打孔，但是导致404，因为我们之前移动了Web服务器。 这比以前更好，但仍然不完美。 我等待来自TerraMaster / A软件更新的进一步指示，并将更新此博客文章，我应该得到这个。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://kn100.me/terramaster-nas-exposing-itself-over-upnp/">https://kn100.me/terramaster-nas-exposing-itself-over-upnp/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/nas/">#nas</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/exposes/">#exposes</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>