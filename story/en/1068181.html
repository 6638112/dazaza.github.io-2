<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>quick. QUIC at Snap</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">QUIC at Snap<br/>quick. </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-25 12:45:58</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/6/e2957867e447022828d9ebc6a3a8198c.jpeg"><img src="http://img2.diglog.com/img/2021/6/e2957867e447022828d9ebc6a3a8198c.jpeg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>At Snapchat, our goal is to make our Camera the fastest way to share a moment. We do not want Snapchatters to face any delays when they are in the moment and want to share with their real friends.</p><p>在Snapchat，我们的目标是使我们的相机是分享片刻的最快方式。我们不希望Snapchatters在此时延迟，并希望与他们的真实朋友分享。</p><p> Network requests are on the critical path of using Snapchat. Compared to a UI update or disk write that takes milliseconds, network latency can take seconds with high error rate and device constraints. To reduce network latency and error, we make requests and responses smaller, reduce unnecessary sync, utilize global content distribution partners to bring media close to the people who use it, and use an efficient, next generation network protocol called Quick UDP Internet Connections, or   QUIC for short.</p><p> 网络请求在使用Snapchat的关键路径上。与毫秒的UI更新或磁盘写相比，网络延迟可能需要高差错率和设备约束。为了减少网络延迟和错误，我们提出更小，减少不必要的同步的请求和响应，利用全球内容分发合作伙伴将媒体带到使用它的人员，并使用称为快速UDP Internet连接的有效的下一代网络协议，或使用称为快速UDP Internet连接的人员，或者Quic。</p><p>   Let’s first take a quick look at the network stack before QUIC. Take a Snap send as an example: on the application layer, we put the Snap media into the   HTTP2 request payload. Then we use   TLS to ensure the connection safety on the security layer and leverage   TCP to split the request into chunks and upload the Snap to the server. However the TCP+TLS+HTTP2 stack is suboptimal for the mobile network environment. For example, TCP requests will fail if a Snapchatter switches between WiFi and WWAN. For a user chatting with friends, failure to send a message due to a connection drop can lead to a degraded experience.</p><p>   让我们首先在Quic之前快速查看网络堆栈。拍摄Snap发送作为示例：在应用程序层上，我们将Snap Media放入HTTP2请求有效载荷。然后，我们使用TLS来确保安全层上的连接安全，并利用TCP将请求拆分为块并将SNAP向服务器上传。但是，TCP + TLS + HTTP2堆栈是移动网络环境的次优。例如，如果WiFi和Wwan之间的快速切换，则TCP请求将失败。对于与朋友聊天的用户，未能由于连接丢弃而发送消息可能会导致劣化的体验。</p><p>   QUIC is a transport protocol for the internet, developed by engineers at Google. QUIC is the foundation of   HTTP3 that replaces the TCP+TLS+HTTP2 and is built on top of UDP. QUIC solves a number of transport-layer and application-layer problems while requiring little or no change from application developers. As the above diagram depicts, QUIC does not alter the low-level operating system network protocols nor does it alter high-level HTTP.</p><p>   Quic是互联网的传输协议，由Google的工程师开发。 Quic是HTTP3的基础，它替换了TCP + TLS + HTTP2，建立在UDP之上。 QUIC解决了许多传输层和应用层问题，同时需要从应用程序开发人员那里几乎没有变化。如上图所示，Quic不会改变低级操作系统网络协议，也不改变高电平HTTP。</p><p>  Faster connection establishment: QUIC handshakes support   zero roundtrips before sending payload, compared to   1-3 round trips for TCP+TLS.</p><p>  更快的连接建立：Quic Handshakes在发送有效载荷之前支持零往返，而1-3往返TCP + TLS。</p><p> Improved congestion control: QUIC has pluggable congestion control, and provides richer information to the congestion control algorithm than TCP. For example   QUIC BBR v1 and   QUIC BBR v2.</p><p> 改进的拥塞控制：Quic具有可插拔拥塞控制，并将更丰富的信息提供给拥塞控制算法而不是TCP。例如，Quic BBR V1和Quic BBR V2。</p><p> Multiplexing without head-of-line blocking: For HTTP2 connections, when a TCP packet is lost, no streams on that connection can make forward progress until the packet is retransmitted and received by the far side. This leads to increased latency and a potentially degraded user experience on mobile network connections. QUIC eliminates this stalling for other streams multiplexed over the same connection.</p><p> 没有线路阻塞的多路复用：对于HTTP2连接，当TCP数据包丢失时，该连接上没有流可以进展，直到数据包被远方重传和接收到的数据包。这导致增加延迟和对移动网络连接的潜在降级的用户体验。 Quic消除了在相同连接上复用的其他流的这种停滞。 </p><p> Connection migration across IP addresses: A TCP request will fail if the IP changes. However, QUIC connections are recognized by a QUIC protocol layer randomly generated 64 bit identifier, so a client using QUIC can continue in-flight requests, uninterrupted across a change in IP address, allowing for an undisturbed user experience.</p><p>跨IP地址的连接迁移：如果IP更改，TCP请求将失败。然而，通过随机生成的64位标识符识别Quic连接，因此使用Quic的客户端可以在IP地址的改变中不间断地继续在飞行中，不间断地在IP地址的变化中不间断地继续。</p><p>   Faster connection establishment: At Snapchat, before QUIC, p90 connection setup took up to 300ms. This connection setup latency translates to user waiting latency, and blocks the user from receiving Snaps and viewing Stories. Faster connection on QUIC directly reduces user waiting latency and improves the user experience.</p><p>   更快的连接建立：在Snapchat，在Quic之前，P90 Connection Setup占用高达300ms。此连接设置延迟转换为用户等待延迟，并阻止用户接收捕捉和查看故事。 Quic的更快连接直接降低用户等待延迟并提高用户体验。</p><p> Improved congestion control: At Snap, the size of upload media can be as large as 10MB. A better congestion control algorithm improves throughput, reduces latency and error rate especially for large media.</p><p> 改进的拥塞控制：在SNAP时，上传媒体的大小可以大约10MB。更好的拥塞控制算法可以提高吞吐量，降低延迟和错误率，特别是对于大型媒体。</p><p> Multiplexing without head-of-line blocking: Snapchat has rich use cases with short content, including Snaps, Stories, Discover content, etc. Normally there are multiple download streams using the same connection. QUIC eliminates the HTTP2 head of blocking issues, such as avoiding the send message requests blocking spotlight requests.</p><p> 没有线路阻塞的多路复用：Snapchat具有富含内容的使用情况，包括捕捉，故事，发现内容等。通常，使用相同的连接有多个下载流。 Quic消除了阻止问题的HTTP2头，例如避免发送消息请求阻止聚光灯请求。</p><p> Connection migration across IP addresses: When with friends, failure to send a message due to a drop in their wifi connection can lead to a degraded experience. Connection migration solves this pain point.</p><p> 跨IP地址的连接迁移：与朋友在一起时，由于他们的WiFi连接中的下降而无法发送消息，可能会导致劣化的体验。连接迁移解决了这种痛苦点。</p><p> Detection of lost connection: A long loading spinner due to a lost connection is disturbing, especially when a Snapchatter is in full screen mode enjoying content. With QUIC, when requests fail due to a lost connection, we can detect and retry while providing a user-friendly UI.</p><p> 丢失连接的检测：由于丢失的连接而导致的长装锭子是令人不安的，特别是当Snapchatter处于全屏模式时享受内容。使用Quic，当请求由于丢失的连接而失败时，我们可以在提供用户友好的UI时检测和重试。</p><p>  Snapchat’s client network stack is built on top of the open-source mobile network library   Cronet. Snap leverages Cronet not only for QUIC but also for improved observability through rich metrics and logs. We are able to build a cohesive view of client and server network performance.</p><p>  Snapchat的客户端网络堆栈建立在开源移动网络库音乐节的顶部。 Snap Leverages不仅用于Quic，而且为了通过丰富的指标和日志提高可观察性。我们能够构建客户端和服务器网络性能的凝聚力。 </p><p>  We chose different protocols based on the network performance across countries and platforms. In general, we observed that enabling QUIC improved p90/P99 network latency by 6-20% and network errors by 3%-8%. There are even more improvements on the low network connectivity user cohort. Here we showcase three examples.</p><p>我们根据国家和平台的网络性能选择了不同的协议。通常，我们观察到，使Quic改善P90 / P99网络延迟将6-20％和网络误差达到3％-8％。低网络连接用户群体甚至有更多的改进。在这里，我们展示了三个例子。</p><p> In the first example, we enabled QUIC on our ads service in Oct 2019. We observed latency improvements across P90/P99 and error rate.</p><p> 在第一个示例中，我们在2019年10月在我们的广告服务中启用了Quic。我们观察到P90 / P99的延迟改进和错误率。</p><p>   We observed error rate improvements across all error codes, including connection timeout, connection lost, request timeout. In further breakdowns of the latency improvements by country and region, we observed higher latency improvement for countries and regions with relatively worse network quality and further geo distance to our services.</p><p>   我们观察到所有错误代码的错误率改进，包括连接超时，连接丢失，请求超时。在国家和地区的延迟改善的进一步分析中，我们观察到具有相对较差的网络质量和进一步与我们服务的地理距离的国家和地区的更高延迟改善。</p><p> In the second example, on top of QUIC, enabling BBR congestion control on the client to server path also brought significant latency improvements. And there are more improvements with larger request payload.</p><p> 在第二个示例中，在Quic之上，在客户端上启用BBR拥塞控制到服务器路径也带来了显着的延迟改进。较大的请求有效载荷有更多的改进。</p><p>   In the last example, by enabling connection migration on Android, the network request success rate when losing a wifi connection increased by 20%.</p><p>   在最后一个示例中，通过启用Android上的连接迁移，在丢失WiFi连接时，网络请求成功率增加了20％。</p><p>  With the success story on QUIC integration, moving forward, we will double down on QUIC, including:</p><p>  随着Quic集成的成功故事，向前迈进，我们将在Quic上加倍，包括： </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://eng.snap.com/quic-at-snap">https://eng.snap.com/quic-at-snap</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/quick/">#quick</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/quic/">#quic</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>