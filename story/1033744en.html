<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CSV：好的、坏的和丑陋的</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">CSV：好的、坏的和丑陋的</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-08 09:29:01</div><div class="page_narrow text-break page_content"><p>CSVs are a relatively popular data format, it seems particularly common as aformat for providing exports of medium-sized datasets. My day job involvesprocessing lots of these types of data sets, and so I’ve developed a set ofstrong opinions on CSVs, which are documented here.</p><p>CSV是一种相对流行的数据格式，作为一种提供中型数据集输出的格式似乎特别常见。我的日常工作涉及处理大量这种类型的数据集，因此我对CSV形成了一套强有力的观点，这些观点都记录在这里。</p><p> One feature of CSVs that is often considered a big advantage is that it’s anincredibly simple file format. However, this can be misleading.</p><p>CSV的一个特点通常被认为是一个很大的优势，那就是它是一种极其简单的文件格式。然而，这可能会产生误导。</p><p>  They support streaming processing, you don’t need to hold an entire file inmemory to process it.</p><p>它们支持流处理，你不需要在内存中保存整个文件来处理它。</p><p> They’re relatively space efficient, the CSV format itself imposes relativelylow overhead on the size of the data itself (specifically, the names of eachcolumn are not repeated for each record).</p><p>它们的空间效率相对较高，CSV格式本身对数据本身的大小施加了相对较低的开销(具体地说，每条记录不会重复每列的名称)。</p><p> Parsers are widely available, in every popular programming language, and alsomany small-data processing tools (e.g. Excel) support them natively.</p><p>解析器在每种流行的编程语言中都广泛可用，而且许多小数据处理工具(例如Excel)本身也支持解析器。</p><p>  CSVs have cousin formats tab-separated-values and pipe-separated-values.These are often used semi-interchangeably with CSVs, but are slightly lesswell supported, and if you parse something expecting the wrong delimiteryou’ll get silent bugs.</p><p>CSV有类似的格式，即制表符分隔值和竖线分隔值。这些格式通常与CSV半互换使用，但支持程度稍差一些，如果您解析的东西需要错误的分隔符，您将得到无声的错误。</p><p> CSVs have no types, everything is a string. This means no native sequencetypes, and also no notion of nullability that’s distinct from the emptystring.</p><p>CSV没有类型，所有内容都是字符串。这意味着没有本机Sequencetype，也没有与空字符串不同的空性概念。</p><p> Most popular CSV libraries are poorly optimized, making CSV parsing muchslower than it needs to be.</p><p>大多数流行的CSV库都没有得到很好的优化，这使得CSV的解析速度比需要的慢得多。</p><p>  A great many people seem to produce and consume CSVs without using a real CSVlibrary. This is because the format of CSVs is so seductively simple, manypeople don’t realize it has escaping and quoting rules. Many people seem togenerate their CSVs with  file.write(&#34;,&#34;.join(fields)) which generates anunparsable mess when one of the fields contains a quote or a comma.</p><p>似乎很多人在生产和消费CSV时并没有使用真正的CSV库。这是因为CSV的格式非常简单，很多人没有意识到它有转义和引用的规则。许多人似乎使用file.write(&#34；，&#34；.Join(Field))生成CSV，当其中一个字段包含引号或逗号时，会产生无法解析的混乱。</p><p> This can generate a catastrophic mess, because there’s no mechanism forre-synchronization. Consider the following:</p><p>这可能会产生灾难性的混乱，因为没有重新同步的机制。考虑以下问题：</p><p>  Many CSV parsers will produce something like the following, which is thecorrect parse according to RFC 4180:</p><p>许多CSV解析器将生成类似以下内容的内容，这是根据RFC4180进行的正确解析：</p><p>  However, some may also produce the following, which is what you’d get if youtreat quotes as a literal or naively split on commas:</p><p>然而，有些引号也可能会产生以下结果，如果你将引号视为原文或天真的逗号分隔符，你会得到这样的结果：</p><p>  Or even the following, if you implicitly close all quotes at the end of a line:</p><p>或者，如果您隐式结束一行末尾的所有引号，甚至可以执行以下操作：</p><p>  This makes parsing CSV file a somewhat fraught experience. This is exacerbatedby the fact that most CSV libraries contain various heuristics about how tohandle these sorts of cases, making the results inconsistent across languages.</p><p>这使得解析CSV文件成为一种令人担忧的体验。事实上，大多数CSV库都包含关于如何处理这类情况的各种启发式方法，这使得结果在不同语言之间不一致。</p><p>  My experience consuming CSVs generated from dozens of different systems is thatthe quoting, escaping, and other parse errors I highlighted as “The Ugly”present a large problem. Unfortunately, there’s no competing format I’m awareof that supports streaming processing, imposes low storage overhead, and iswidely supported by tooling. Such a format would be tremendously valuable… ifit were widely adopted. There are several alternatives which succeed on someaxis:</p><p>我使用从几十个不同系统生成的CSV的经验是，引用、转义和其他我强调为“丑陋”的解析错误是一个大问题。不幸的是，据我所知，目前还没有一种支持流处理、存储开销低且得到工具广泛支持的竞争格式。这样的格式将是非常有价值的…。IFit被广泛采用。在某一轴上有几种成功的替代方案：</p><p> Line-delimited JSON works, but imposes a high size overhead (field names arerepeated for every record) and is not well supported in non-programmingenvironments.</p><p>以行分隔的JSON可以工作，但会带来很大的开销(每条记录都重复使用字段名)，并且在非编程环境中不受很好的支持。</p><p> Parquet files work well, but streaming is a tad more complex (you need to beable to seek to the end of the file to read the metadata before you canstream the contents) and aren’t as widely supported.</p><p>拼图文件运行良好，但流媒体稍微复杂一些(您需要能够查找到文件末尾才能读取元数据，然后才能对内容进行流媒体传输)，并且没有得到广泛的支持。</p><p> Excel files don’t support streaming well and are relatively poorly supportedin programming environments.</p><p>Excel文件不能很好地支持流，在编程环境中的支持也相对较差。</p><p> Ultimately there’s no format that corrects all of CSVs flaws while retainingits benefits.</p><p>归根结底，没有一种格式可以在保留其优点的同时纠正所有CSV缺陷。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://alexgaynor.net/2020/sep/24/csv-good-bad-ugly/">https://alexgaynor.net/2020/sep/24/csv-good-bad-ugly/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/csv/">#csv</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/good/">#good</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>