<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>故意泄漏AWS密钥 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">故意泄漏AWS密钥 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-20 02:23:53</div><div class="page_narrow text-break page_content"><p>“永远不要将秘密检查到源代码管理中”是100％正确的规则之一，直到不正确为止。软件中没有通用的法律，最近我有理由打破这一法律。我将AWS密钥签入了Git存储库。 Ithen将这些提交推送到GitHub上的公共存储库中。我故意这样做，并且活着讲述这个故事。您几乎肯定不应该这样做，所以我想我会分享您这样做时的情况。</p><p> 我可以想象您在想：“这个人是故意发布他的AWS凭证的？一定是个白痴。”我不同意您的结论，但请让我解释一下！</p><p> 我的用例非常简单：delta-rs项目需要一个真正的S3bucket来进行一些集成测试。我决定建立一个真正的S3存储桶forour（只读）集成测试。幸运的是，我们的测试仅需要从存储桶中检索对象，以确认S3存储桶正确地将自己呈现为Delta表。如果我们需要在存储桶上进行“写入”操作，我将永远不会这样做。</p><p>  AWS有一个称为IAM的集成访问控制框架，不要与“ AMI”字谜相混淆，Corey Quinn可以帮助您学习如何发音。 IAM允许以十几种或更多不同的方式针对AWS中的所有内容制定策略和角色。它切成薄片，确保您的水桶安全。它还配置了JSON，该功能非常实用，但是我必须将这些保留的内容保存在另一篇博客文章中。无论如何，这是我为存储桶设置的只读策略：</p><p> {＆＃34;版本＆＃34; ：＆＃34; 2012-10-17＆＃34; ，＆＃34;声明＆＃34; ：[{＆＃34; Sid＆＃34; ：＆＃34; VisualEditor0＆＃34; ，＆＃34;效果＆＃34; ：＆＃34;允许＆＃34; ，＆＃34;动作＆＃34; ：[＆＃34; s3：GetLifecycleConfiguration＆＃34; ，＆＃34; s3：GetBucketTagging＆＃34; ，＆＃34; s3：GetInventoryConfiguration＆＃34; ，＆＃34; s3：GetObjectVersionTagging＆＃34; ，＆＃34; s3：ListBucketVersions＆＃34; ，＆＃34; s3：GetBucketLogging＆＃34; ，＆＃34; s3：ListBucket＆＃34; ，＆＃34; s3：GetAccelerateConfiguration＆＃34; ，＆＃34; s3：GetBucketPolicy＆＃34; ，＆＃34; s3：GetObjectVersionTorrent＆＃34; ，＆＃34; s3：GetObjectAcl＆＃34; ，＆＃34; s3：GetEncryptionConfiguration＆＃34; ，＆＃34; s3：GetBucketObjectLockConfiguration＆＃34; ，＆＃34; s3：GetBucketRequestPayment＆＃34; ，＆＃34; s3：GetObjectVersionAcl＆＃34; ，＆＃34; s3：GetObjectTagging＆＃34; ，＆＃34; s3：GetMetricsConfiguration＆＃34; ，＆＃34; s3：GetBucketOwnershipControls＆＃34; ，＆＃34; s3：GetBucketPublicAccessBlock＆＃34; ，＆＃34; s3：GetBucketPolicyStatus＆＃34; ，＆＃34; s3：ListBucketMultipartUploads＆＃34; ，＆＃34; s3：GetObjectRetention＆＃34; ，＆＃34; s3：GetBucketWebsite＆＃34; ，＆＃34; s3：GetBucketVersioning＆＃34; ，＆＃34; s3：GetBucketAcl＆＃34; ，＆＃34; s3：GetObjectLegalHold＆＃34; ，＆＃34; s3：GetBucketNotification＆＃34; ，＆＃34; s3：GetReplicationConfiguration＆＃34; ，＆＃34; s3：ListMultipartUploadParts＆＃34; ，＆＃34; s3：GetObject＆＃34; ，＆＃34; s3：GetObjectTorrent＆＃34; ，＆＃34; s3：GetBucketCORS＆＃34; ，＆＃34; s3：GetAnalyticsConfiguration＆＃34; ，＆＃34; s3：GetObjectVersionForReplication＆＃34; ，＆＃34; s3：GetBucketLocation＆＃34; ，＆＃34; s3：GetObjectVersion＆＃34; ]，＆＃34;资源＆＃34; ：[＆＃34; arn：aws：s3 ::: deltars＆＃34; ，＆＃34; arn：aws：s3 ::: deltars / *＆＃34; ]}]}</p><p> 我还设置了一个AWSBudget来提醒网购此举是否会花掉真钱。我当前在该AWS账户中的每月费用几乎为1.50美元，因此我的预算设置为，如果/当此开始每月花费我数美元以上时，AWS会向我发送电子邮件，以便我想出办法来节省我的钱钱。</p><p> 最后，我为集成测试创建了一个IAM用户。此IAM用户已附加上面列出的单个IAM策略。然后，我获取了IAM用户的AWS访问密钥和私钥ID，并将其签入Git。 </p><p>准备完集成测试后，我在太平洋标准时间13:05提出了我的pullrequest。在将代码推送到GitHub时，世界上的机器人会立即识别出任何类似于AWS访问密钥的东西，其中大多数意图是恶意的，但有些旨在帮助像我这样的开发人员犯下愚蠢的错误。</p><p>  我们已经知道，属于IAM用户deltars-ro的AWS访问密钥AKIAX7EGEQ7FT6CLQGWH以及相应的密钥在以下网址在线公开可用：https://github.com/rtyler/delta.rs/blob/b3581ee06eee26d971bd3b76bb788c85ecf0c6c0c/rust/ tests / s3_test.rs。</p><p>  您的安全性对我们很重要，并且您帐户的IAM凭证的暴露给您的AWS帐户带来安全风险，可能导致未经授权的活动产生过多费用，并违反AWS客户协议或与我们有关管理您对我们服务使用的其他协议。</p><p>  为了保护您的帐户免遭过多的费用和未经授权的活动，我们已将“ AWSCompromisedKeyQuarantine” AWS托管策略（“隔离策略”）应用于上述IAM用户。应用于用户的隔离策略通过限制高风险AWS服务的权限来保护您的账户。您可以通过以下网址查看该策略：https://console.aws.amazon.com/iam/home#policies/arn:aws： iam :: aws：policy / AWSCompromisedKeyQuarantine $ jsonEditor？section = permissions。</p><p>  为了安全起见，在遵循以下说明之前，请勿删除隔离策略。如果隔离策略导致生产问题，则可以将策略与用户分离。注意：只有具有管理员权限或有权访问iam：DetachUserPolicy的用户才能删除该策略。有关如何删除托管策略的说明，请访问：https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html#remove-policies-console。如果未经授权使用您的AWS账户，我们可以全权酌情为您提供让步。但是，不遵循以下说明可能会损害您获得让步的能力。</p><p>  如果您认为自己收到的此说明有误，请立即通过支持案例与我们联系。</p><p>    步骤1：删除或旋转公开的AWS访问密钥AKIAX7EGEQ7FT6CLQGWH。要删除IAM用户密钥，请转到此处的AWS管理控制台：https://console.aws.amazon.com/iam/home#users。要删除根用户密钥，请访问：https://console.aws.amazon.com/iam/home#security_credential。 </p><p>如果您的应用程序使用公开的访问密钥，则需要更换密钥。要替换密钥，请先创建第二个密钥（届时两个密钥都将处于活动状态），然后修改您的应用程序以使用新密钥。然后，通过单击“使无效”来禁用（但不要删除）公开的密钥。控制台中的选项。如果您的应用程序有任何问题，您可以重新激活公开的密钥。当您的应用程序使用新密钥完全正常运行时，请删除公开的密钥。</p><p>  注意：仅旋转或删除外露的钥匙可能不足以保护您的帐户，请参阅步骤2。</p><p>  步骤2：检查您的CloudTrail日志中是否存在未经批准的活动，例如创建未经授权的IAM用户，策略，角色或临时安全凭证。为了保护您的帐户，请删除所有未经授权的IAM用户，角色和策略，并撤消所有临时凭据。</p><p>  要删除未经授权的IAM用户，请导航至https://console.aws.amazon.com/iam/home#users。要删除未经授权的策略，请访问：https：//console.aws.amazon.com/iam/home#/policies。要删除未经授权的角色，请访问：https://console.aws.amazon.com/iam/home#/roles。</p><p>  可能已使用公开的AWS访问密钥AKIAX7EGEQ7FT6CLQGWH为IAM用户deltars-ro创建了未经授权的临时凭证。您可以按照此处概述的说明撤消临时凭证：https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_control-access_disable-perms.html#denying-access-to-credentials-issue-time 。也可以通过删除IAM用户来撤销临时凭据。注意：删除IAM用户可能会影响生产工作负载，因此应谨慎进行。</p><p>  步骤3：检查CloudTrail日志以查看您的AWS账户是否有未经授权的AWS使用，例如未经授权的EC2实例，Lambda函数或EC2竞标价。您还可以通过登录AWS管理控制台并查看每个服务页面来检查使用情况。还可以检查计费控制台中的“计费”页面，以防意外使用。 https://console.aws.amazon.com/billing/home#/bill</p><p>  请记住，任何区域都可能发生未经授权的使用，并且您的控制台一次只能向您显示一个区域。要在区域之间切换，可以使用控制台屏幕右上角的下拉菜单。 </p><p>请采取措施以防止任何新的凭据公开暴露。请参阅http://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html上的“管理访问密钥的最佳做法”。</p><p>    Amazon GuardDuty是一项AWS威胁检测服务，可帮助您持续监控和保护您的AWS账户和工作负载。在您的账户上启用Amazon GuardDuty可以使您进一步了解恶意或未经授权的活动，提醒您采取措施以减少受到伤害的风险。要了解更多信息，请访问：https://aws.amazon.com/guardduty。</p><p>  如果您有任何疑问，可以通过访问帐户支持中心中新创建的支持案例与我们联系。如果看不到新案例，则可以从以下支持中心创建案例：https://console.aws.amazon.com/support/home?#/</p><p> 我还在太平洋标准时间13:09收到了来自两个第三方服务GitGuardian的电子邮件，而太平洋标准时间14:56也收到了泄漏.io的电子邮件。伙计们，可以尝试一下，但是在我执行git push的几秒钟内，AWS已经在它之上。</p><p> 我忽略了第三方服务，并回复了AWS支持案例，让他们知道我的披露实际上是故意的。支持人员一定会翻过双眼，然后提醒我负责该帐户的收费，但仍建议我：</p><p>   通常这个故事结局不好。我是有目的地并按计划进行的。我个人知道（我的一个朋友的朋友！）GitHub上有泄露AWS密钥的事件（我发誓！）。发生错误的git将本地凭证文件添加到个人但公共存储库中。由于未定期检查链接到AWS账户的电子邮件账户，因此在撤销密钥之前，滥用该密钥在AWS账单上累积了数百美元。</p><p> 如果您将类似于AWS密钥的内容添加到公共存储库，网站或互联网上的任何内容，恶意参与者将下载密钥并尝试在您的AWS账户中启动服务。通常是加密货币矿工或垃圾邮件网关，任何花费大量金钱的东西，他们很高兴您自愿支付。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://brokenco.de/2021/01/15/leaking-aws-keys.html">https://brokenco.de/2021/01/15/leaking-aws-keys.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/aws/">#aws</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/leaking/">#leaking</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/s3/">#s3</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1045025.html"><img src="http://img2.diglog.com/img/2021/1/thumb_4941312783dbfab249cf42eaa1edf162.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1045025.html">AWS正在使用React创建一个“新的开源设计系统” </a></div><span class="my_story_list_date">2021-1-19 10:50</span></div><div class="col-sm"><div><a target="_blank" href="/story/1043582.html"><img src="http://img2.diglog.com/img/2021/1/thumb_b608e74918d9742126e5c0d710a13c5b.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1043582.html">消息来源：在华纳媒体同意延长其AWS服务合同之前，AT＆T无法获得亚马逊Fire TV设备的HBO Max分销协议 </a></div><span class="my_story_list_date">2021-1-9 8:13</span></div><div class="col-sm"><div><a target="_blank" href="/story/1042752.html"><img src="http://img2.diglog.com/img/2021/1/thumb_f4795f436c7d16e1c854251da0fa97eb.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042752.html">带有工作示例的AWS Lambda Terraform Cookbook </a></div><span class="my_story_list_date">2021-1-1 8:53</span></div><div class="col-sm"><div><a target="_blank" href="/story/1042220.html"><img src="http://img2.diglog.com/img/2020/12/thumb_efe69273418bc3a499afa19a2ed98175.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1042220.html">AWS将Apple Mac Mini节点添加到EC2 – ServeTheHome </a></div><span class="my_story_list_date">2020-12-29 1:50</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>