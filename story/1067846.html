<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>在像素背后：Starduino  -  3D在28KB中的游戏 </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">在像素背后：Starduino  -  3D在28KB中的游戏 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-06-24 06:06:07</div><div class="page_narrow text-break page_content"><p>我正在寻找一个有趣的业余工程，在找到Arduboy时磨练我的AVR装配技能，这是一个坚固的“Arduino”，我可以留在口袋里。</p><p> 已经有很多有趣的游戏，甚至是3D的一些，但没有填充多边形游戏？这必须纠正。</p><p>    Arduboy是一个与Arduino IDE兼容的便携式游戏机，使用与Arduino Leonardo相同的微控制器，这是一个Atmega32U4，但与Leonardo板不同，它配备了所有在一个漂亮的坚固的套管中预先安装的硬件。</p><p> Atmega32U4包含一个8位CPU，一点RAM，一些用于程序和数据的Flash ROM，一个微小的EEPROM，用于在电源熄灭时保存数据，并具有一堆GPIO引脚来连接到外部硬件。</p><p>  显示屏是128×64 1BPP，这意味着完整的帧占用了我们的存储器的1KB。除非我们在飞行中生成显示器（对于基于多边形的3D游戏并不实用，否则我尝试过。更稍后，我们稍后更多地为1.5KB的RAM留下了我们的所有工作数据，包括CPU堆栈。</p><p> 它通过单向SPI连接到MCU，我们不会从OLED控制器获得V-SYNC信号，因为该特定显示制造商没有暴露在带状电缆上的信号。 ＆lt; jackie_chan_wtf.jpg＆gt;</p><p> 没有音频生成电路。对于每个PWM脉冲，必须通过IRQ在软件中生成声音。在我们珍贵的CPU时间吃饭。 </p><p>2018年半月后，当我收到我的单位时，我从一个填充多边形光栅化器开始看，看它是否可以以可玩的速度获得任何东西。</p><p>  然后我开始尝试不同的游戏概念。要查看哪些风格将更好地符合OLED显示器，发动机的性能，ROM空间，有限的控制等。</p><p>  我在Snes上的任天堂明星狐狸安顿下一个概念。</p><p>    在MCU硬件上调试绝不是与您最喜欢的IDE中最喜欢的工作站上的方便，与边界检查器和日志文件等所有漂亮的工具。</p><p> 因此，我将项目从Arduino IDE中移动到我自己的基于Makefile的构建系统中，使用本机PC端口，因此我可以在PC上进行多大测试，而无需每次编程闪存。</p><p>  它还让我做一些方便的节省时间，例如在级别预览窗口中显示边界框和Bezier路径，并直播级别和声音。</p><p>  如果您正在计划花费几个月的业余时间，在游戏投资时间开始让您的生活更轻松。不花很长时间才能回报。 </p><p>走出arduino IDE让我扔掉USB库和其他一些作品。但这意味着我无法访问USB串行端口进行调试...</p><p>    默认情况下，显示控制器处于“水平模式”，这对于2D闪烁很好，但对于光栅化多边形并不方便。</p><p> 幸运的是，控制器具有一个“垂直寻址模式”，它将内存映射转换为熟悉和光栅化的64×128屏幕（侧向），从左上角，右转，使用LSB在最左侧像素上启动的8×128字节（0x01 =最左边，0x80 =右边）。</p><p>   静态const8_t init_cmds [] progmem = {0xae，0xa8,64-1，0xd3,0x00,0x40,0xDA，0x14，0xC8，0xDA，0x12,0x22,0xDA，0xD9,0x22,0xDB，0x00,0x2，0xDB，0x00，0x2E，0xA6，0xA4 ，0xAF，0x20,0x01，0xA0};</p><p> 制作3D引擎的伟大事物是您真正关心屏幕的方式。您可以在投影矩阵中修复此功能。</p><p>  我不会进入光栅化多边形的细节，因为已经有很多关于这两者在线和死树格式的书籍和教程。选择你最喜欢的。</p><p> 只要纹理不涉及CPU就可以处理它。 32份注册它在这份工作中非常宽朴。 </p><p>然而，我用了天空盒的伎俩。通过将地平线投影到屏幕的边缘，实际上，它实际上是在屏幕上以偏斜的方式在屏幕上绘制的动态产生的2×96纹理，以确定高度和斜率。</p><p> 在清除帧缓冲器之前，将表示地面的线绘制到背景图案上。它们的位置根据投影矩阵计算。</p><p>  ROM空间在这里是溢价如此明显的数据需要以某种方式压缩。我们也没有太多的RAM工作，所以一切都必须被压缩（或生成！）。</p><p> 并且必须在保存的数据和解压缩器代码之间击中平衡。 CPU上的每个指令都是2个字节，这可以快速加起来。</p><p> 我不想通过手动进入顶点值来模拟3D对象，因此我使一个obj到C ++转换器 - 压缩机工具，并在Modo中建模了对象。</p><p> 保存字节的第一个明显的位置是尽可能镜像模型，因此压缩机在所有3维（x，y，z）上寻找匹配的镜像多边形，并将它们合并为镜像批次。</p><p> 这意味着我所需要的只是3位，以便如果必须重复在x，y和/或z上的多批处理镜像的多批处理，则告诉解压缩器。 </p><p>发动机使用32位签名定点数学以16.16格式（16位分数）。这意味着每个顶点12个字节，但这太浪费了。</p><p>    我使用的诀窍是将顶点编码为4位的有效量和一个共享的4位指数，每个顶点总共2个字节。</p><p> 现代GPU使用类似的技巧来编码HDR颜色，例如32位OpenGL中的RGB9_E5_EXT。</p><p> void vectorunpack（固定* out_v，const uint16_t * v）{uint16_t t = pgm_read_word_nword_near（v）;字节e =（t＆amp; 0xf）+ 8; INT32_T * DST =（INT32_T *）OUT_V; for（字节i = 3; i  - ;）{int8_t tx =（t＆amp; 0xf0）; Tx＆gt;＆gt; = 4; * DST ++ =（（INT32_T）TX）<＆lt;＆lt; e; t＆gt;＆gt; = 4; }}</p><p> 这是3D模型被压缩机工具屠宰的地方，但是通过仔细调整顶点，即使在舍入之后也可以让模型看起来正常。乞丐不能选择。</p><p> 每个Poly都有一个4位“颜色”索引，进入16个条目调色板，该调色板映射到9个不同的抖动模式。间接允许我创建脉冲亮度动画和闪烁。</p><p>   通常，3D引擎中的动画是使用骨矩阵变换与复杂的Bezier曲线进行完成，但这对于这个项目来说将太大，并且在任何合理的时间框架中，差的小CPU无法处理多个骨矩阵。 </p><p>因此，使用简单的顶点插值来完成动画。当顶点仅为2个字节（并镜像！），对于将获得动画的几个网格，它变得更加合理。</p><p>     所有对象都具有缩放值以重用网格，边界框隐式1x1x1以围绕对象的原点为中心。 （-0.5到0.5）然后通过实例的缩放缩放。</p><p>   您认为额外的隐形对象将添加比存储边界框更多的字节，但处理多个尺寸框的额外代码复杂性，每个对象的多个界限和每个对象的位置递减节省。</p><p>    游戏包含一个介绍级别，其中逐渐引入元素以让新玩家学习控件。</p><p>   当游戏开始时，RNG只能选择每个类别的前几个片段。</p><p>   随机数发生器以常数播种，因此每次都会产生相同的水平以保持高分展平。</p><p>   第一次将字形突出插入8×5缓冲液（记住屏幕在其侧面）。 </p><p>样式缓冲区告诉文本呈现例程如何呈现多个文本通行证：</p><p>   它似乎是浪费，但黑色轮廓步骤会照顾到黑色，所以第二次通过只需要反转。</p><p>   为了帮助控制游戏时，当帧速率倾斜时，输入的读取60次（作为游戏播放逻辑的速率相同）并存储到循环缓冲器中，因此在其输入时间处理输入。</p><p>    50％的时间花费了几何变换，剪切另外30％。</p><p> 我不得不写16.16 x 16.16  - ＆gt; 16.16装配中的固定点乘法代码获得体面的帧速率。</p><p> 除了没有做出可笑的溢出32 x 32  - ＆gt的主要优点。在C ++中的64个定点数学是我能够跳过一些长乘法步骤作为3D顶点*矩阵变换有很多零字节的档案舍入的方式，所以汇编代码跳过整个（字节* 4字节）为每个零字节乘以累积代码的块。</p><p>   最快的例程是没有任何东西的例程。这是速度最大的增长。 </p><p>下载.arduboy文件（98kb turbo版本）（经典版本：.arduboy文件（100kb））在您的arduboy上闪存游戏。  或者具有可打印PDF指令小册子（600kb）的完整.zip文件并包含使用AVRDUDE或您的首选方法上传的.hex文件。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://rv6502.ca/post/2019/01/05/starduino-3d-gaming-in-28kb-behind-the-pixels/">http://rv6502.ca/post/2019/01/05/starduino-3d-gaming-in-28kb-behind-the-pixels/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/像素/">#像素</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/pixels/">#pixels</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1067792.html"><img src="http://img2.diglog.com/img/2021/6/thumb_e56edea664712bfa6b5dba9bf8c7943d.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1067792.html">我们如何将NES游戏融入40千字节[视频] </a></div><span class="my_story_list_date">2021-6-24 2:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1067767.html"><img src="http://img2.diglog.com/img/2021/6/thumb_23b606564728a0865a7729d351286494.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1067767.html">电子艺术以14亿美元购买手机游戏工作室Playdex </a></div><span class="my_story_list_date">2021-6-24 1:1</span></div><div class="col-sm"><div><a target="_blank" href="/story/1067762.html"><img src="http://img2.diglog.com/img/2021/6/thumb_881932c516f7acdf18a105cff7aa5000.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1067762.html">Microsoft在周四的“下一代”Windows事件中预期的内容：新的Windows 11 UI，更新了Windows Store，并专注于生产力和游戏 </a></div><span class="my_story_list_date">2021-6-24 0:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1067711.html"><img src="http://img2.diglog.com/img/2021/6/thumb_0c700319464e58972f7335eef040d368.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1067711.html">电子艺术以14亿美元的现金获得华纳兄弟游戏的Playdex </a></div><span class="my_story_list_date">2021-6-23 22:6</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>