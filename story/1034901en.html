<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>苹果：开发者ID证书吊销(OCSP)</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">苹果：开发者ID证书吊销(OCSP)</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-13 19:32:44</div><div class="page_narrow text-break page_content"><p>Last week, Mac users with HP printers were unable to print or run their printer software, because HP&#39;s code signing certificate was temporarily revoked. In this blog post I&#39;ll talk about how this works from a technical perspective, and clear up some misconceptions about the situation. Software distributed outside the Mac App Store, such as a printer driver from HP, is signed with a Developer ID code signing certificate. This certificate is issued by Apple&#39;s Developer ID Certification Authority (CA). There&#39;s a different CA, the Apple Worldwide Developer Relations Certification Authority, that&#39;s used for Mac App Store development. Information about Apple certificates and CAs can be found on the  Apple PKI (Public Key Infrastructure) page. You can use the  codesign command-line tool to see the certificate used to sign an app. For example, if you have my own app  StopTheNews installed, use this command:</p><p>上周，使用惠普打印机的Mac用户无法打印或运行他们的打印机软件，因为惠普的代码签名证书被暂时吊销。在这篇博客文章中，我将从技术角度谈一谈这是如何工作的，并澄清一些关于这种情况的误解。在Mac App Store之外分发的软件(如惠普的打印机驱动程序)会使用开发者ID代码签名证书进行签名。此证书由苹果的开发者ID证书颁发机构(CA)颁发。还有一个不同的CA，苹果全球开发者关系认证机构(Apple Worldwide Developer Relations Certification Authority)，用于Mac应用商店的开发。有关Apple证书和CA的信息可以在Apple PKI(公钥基础设施)页面上找到。您可以使用CoDesign命令行工具查看用于签署应用程序的证书。例如，如果您安装了我自己的应用程序StopTheNews，请使用以下命令：</p><p>  This creates the files  codesign0,  codesign1, and  codesign2 in the current working directory. These files are in DER (Distinguished Encoding Rules) format, so you may want to give them the  .der file extension, which allows you to preview the files with QuickLook. The 3 files are the 3 code signing certificates that make up the &#34;chain of trust&#34;. In the case of StopTheNews,  codesign0 is my own Developer ID Application cert,  codesign1 is the Developer ID CA cert, and  codesign2 is the Apple Root CA cert. The latter 2 certs are already in your System Roots keychain, which you can see in the Keychain Access app.</p><p>这将在当前工作目录中创建文件cosign0、cosign1和cosign2。这些文件是DER(可分辨编码规则)格式，因此您可能希望为它们提供.der文件扩展名，这样您就可以使用QuickLook预览文件。这3个文件是组成信任链的3个代码签名证书。在StopTheNews的例子中，cosign0是我自己的开发人员ID应用程序证书，cosign1是开发人员ID CA证书，cosign2是Apple Root CA证书。后两个证书已经在您的系统根密钥链中，您可以在密钥链访问应用程序中看到这两个证书。</p><p> Apple&#39;s Developer ID CA does not have a Certificate Revocation List. The revocation status of a Developer ID cert is only available via Online Certificate Status Protocol. This is explained in the CA&#39;s  Certification Practice Statement:</p><p>苹果的开发者ID CA没有证书吊销列表。开发者ID证书的吊销状态只能通过在线证书状态协议获得。CA的认证实践声明中对此进行了说明：</p><p> 4.10. CERTIFICATE STATUS The Developer ID Sub-CA utilizes Online Certificate Status Protocol (OCSP) to provide information whether a certificate has been revoked.</p><p>4.10.。证书状态开发者ID子CA利用在线证书状态协议(OCSP)提供证书是否已被吊销的信息。</p><p> This is in contrast to the Apple WWDR CA, which use a CRL in addition to OCSP:</p><p>这与Apple WWDR CA形成了鲜明对比，后者除了使用OCSP外还使用CRL：</p><p> 4.10. CERTIFICATE STATUS The WWDR Sub-CAs utilize two methods for certificate validation, Certificate Revocation List (CRL)and Online Certificate Status Protocol (OCSP).</p><p>4.10.。证书状态WWDR子CA使用两种方法进行证书验证，即证书吊销列表(CRL)和在线证书状态协议(OCSP)。</p><p> An unfortunate consequence of the lack of a Developer ID CRL is that you can&#39;t obtain a list of all revoked Developer ID certs. You can only query the status of known certs one-by-one.</p><p>缺少开发人员ID CRL的一个不幸后果是，您无法获得所有被吊销的开发人员ID证书的列表。您只能逐个查询已知证书的状态。</p><p> When you launch a Developer ID signed app, it may perform an OCSP check. You can see this if you take a packet trace. The check consists of an HTTP GET request (port 80, unencrypted!) to  ocsp.apple.com with a path that is both Base64 encoded and URL encoded. According to the OCSP format, the encoded bytes end with the serial number of the Developer ID cert. The OCSP check is performed by the  trustd processes ( /usr/libexec/trustd). An OCSP check is different and separate from a notarization check, which is performed by the  syspolicyd process. Developer ID certs were always checked for revocation via OCSP, before notarization even existed.</p><p>启动开发者ID签名的应用程序时，它可能会执行OCSP检查。如果您跟踪数据包，就可以看到这一点。该检查包括一个HTTP GET请求(端口80，未加密！)。到ocsp.apple.com，其路径既是Base64编码的，也是URL编码的。根据OCSP格式，编码的字节以开发者ID证书的序列号结尾。OCSP检查由信任进程(/usr/libexec/trustd)执行。OCSP检查不同于公证检查，公证检查由syspolicyd进程执行。在公证存在之前，开发人员ID证书总是通过OCSP检查吊销。</p><p> The OCSP result is cached for a period of time, so a packet trace may not show another check the next time you launch an app. At a path of the format  /var/folders/[RANDOM]/C/com.apple.trustd/ocspcache.sqlite3 there&#39;s an OCSP cache in an SQLite database. Enter the command  getconf DARWIN_USER_CACHE_DIR in Terminal to get the directory for caches on your Mac. Since the result is cached, the current revocation status of a cert may not be reflected on your Mac.</p><p>OCSP结果会缓存一段时间，因此下次启动应用程序时，数据包跟踪可能不会显示另一项检查。在格式为/var/folders/[RANDOM]/C/com.apple.trustd/ocspcache.sqlite3的路径处，SQLite数据库中有一个OCSP缓存。在终端中输入命令getconf Darwin_USER_CACHE_DIR以获取Mac上的缓存目录。由于结果已缓存，因此证书的当前吊销状态可能不会反映在您的Mac上。</p><p> As the Certificate Authority, Apple can revoke a Developer ID certificate at any time. This is done when Apple discovers that a cert has been used to sign malware. Unfortunately, we&#39;ve seen cases where Apple has revoked a Developer ID cert mistakenly, such as with the indie developer  Charlie Monroe. Is it possible for a developer to revoke their own Developer ID cert? The answer is no. From the Developer ID CA CPS:</p><p>作为证书颁发机构，苹果可以随时撤销开发者ID证书。当苹果发现证书被用来签署恶意软件时，就会这样做。不幸的是，我们见过苹果错误地撤销开发者ID证书的案例，比如独立开发者查理·门罗(Charlie Monroe)。开发人员可以撤销他们自己的开发人员ID证书吗？答案是否定的。从开发者ID CA CPS：</p><p> 4.8. CERTIFICATE REVOCATION The Subscriber may initiate a revocation request by sending an email to productsecurity@apple.com. The request for revocation will then be evaluated by Apple.</p><p>4.8.。证书吊销订户可以通过发送电子邮件至ProductSecurity@apple.com来发起吊销请求。随后，苹果将对撤销申请进行评估。</p><p>  4.8. CERTIFICATE REVOCATION Certificates with Apple as the intended Subscriber are revoked at the request of an authorized Appleemployee in accordance with internal business practices.  For Pass Certificates, Enhanced Pass Certificates, Apple Pay Pass Certificates, and Website Push Notification Certificates, the Subscriber may initiate a revocation request by sending an email to product-security@apple.com. The request for revocation will then be evaluated by Apple.  For all other certificates issued to Developers, the certificate revocation process will commenceupon receipt of a valid request to revoke the Certificate from the Subscriber via the Apple Developer website or via Xcode. The Subscriber will be required to log in using their Apple ID and password. After authentication, the Subscriber will indicate that they wish to revoke their Certificate.Revocation of a Certificate cannot be undone. After revocation, a new Certificate must be requested.</p><p>4.8.。根据内部商业惯例，在苹果授权员工的要求下，以苹果为目标订户的证书吊销证书将被吊销。对于PASS证书、增强PASS证书、Apple Pay PASS证书和网站推送通知证书，订户可以通过发送电子邮件至product-security@apple.com发起撤销请求。随后，苹果将对撤销申请进行评估。对于颁发给开发者的所有其他证书，证书撤销过程将在收到订户通过Apple Developer网站或Xcode发出的撤销证书的有效请求后开始。订户将被要求使用他们的Apple ID和密码登录。身份验证后，订阅者将表明他们希望吊销证书。证书的吊销无法撤消。吊销后，必须申请新的证书。</p><p> The reason for this difference in policy is that revoking a Developer ID cert has severe consequences, as we&#39;ve seen with HP printer software: Mac users will no longer be able to run software signed with the revoked cert. Developers are allowed to revoke their own Mac App Store code signing certificates, because those certs are only used for development purposes. Apps downloaded from the Mac App Store are not actually signed by the app developers, they&#39;re signed by Apple. Developers only use their Mac App Store certs to sign an app for upload to App Store Connect, or to test the app locally on their own Mac. Thus, revoking the development cert has no effect on Mac App Store customers. If you&#39;re a developer yourself, you can go to your  Certificates, Identifiers &amp; Profiles on the Apple Developer site and see the difference. Mac (and iOS) App Store certs have a &#34;Revoke&#34; button you can press, whereas Developer ID certs do not have a &#34;Revoke&#34; button. You have to email Apple Product Security to request that your Developer ID cert be revoked. You might do this if the private key for your cert becomes compromised. This happened for example to  Panic. (However, Apple did not revoke Panic&#39;s Developer ID cert! Older versions of their apps still run.)</p><p>政策上出现这种差异的原因是，撤销开发者ID证书会带来严重的后果，正如我们在惠普打印机软件中看到的那样：Mac用户将不能再运行用被撤销的证书签名的软件。开发者可以撤销他们自己的Mac App Store代码签名证书，因为这些证书只用于开发目的。从Mac应用商店下载的应用程序实际上并不是由应用程序开发者签名的，而是由苹果公司签名的。开发者只使用他们的Mac App Store证书来签署上传到App Store Connect的应用程序，或者在他们自己的Mac上本地测试该应用程序。因此，撤销开发证书对Mac App Store客户没有影响。如果你自己也是一名开发者，你可以去苹果开发者网站上的证书、识别符和配置文件，看看其中的不同之处。Mac(和iOS)App Store证书有一个可以按下的吊销按钮，而开发者ID证书没有吊销按钮。您必须向Apple Product Security发送电子邮件，要求撤销您的开发者ID证书。如果证书的私钥泄露，您可能会这样做。例如，这发生在恐慌中。(然而，苹果并没有撤销恐慌的开发者ID证书！他们的旧版应用程序仍在运行。)。</p><p> Except in cases of malware and compromised private keys, there&#39;s really not ever a good reason to revoke a Developer ID cert. Every code signing cert has an expiration date, but it&#39;s crucial to understand what this means. The valid dates of a code signing cert only apply to the use of the cert to sign software. After a code signing cert is expired, a developer can no longer use the cert to sign software. But any software that was signed with the cert before the expiration date is valid  forever, unless the cert is revoked. In other words, the expiration date applies to signing software, not to running software. Users should always be able to run their validly signed software, for as long as the software is installed on their Mac.</p><p>除非是恶意软件和泄露的私钥，否则真的没有什么好理由撤销开发者ID证书。每个代码签名证书都有一个有效期，但理解这意味着什么是至关重要的。代码签名证书的有效日期仅适用于使用该证书对软件进行签名。代码签名证书过期后，开发人员不能再使用该证书对软件进行签名。但是，除非证书被吊销，否则在到期日之前使用证书签名的任何软件都将永久有效。换句话说，到期日期适用于签名软件，而不适用于运行软件。只要他们的Mac上安装了有效签名的软件，用户应该始终能够运行该软件。</p><p> With respect to the HP printer situation, there has been some dispute about who was at fault. Here&#39;s a  press statement:</p><p>关于惠普打印机的情况，关于谁是罪魁祸首一直存在一些争议。以下是一份新闻声明：</p><p> The Register understands from sources familiar with the matter that HP Inc asked Apple to revoke its printer driver code-signing certificates. It appears this request backfired as it left users unable to print. A HP Inc spokesperson told us on Friday night:</p><p>The Register从知情人士那里了解到，惠普(HP Inc.)要求苹果吊销其打印机驱动程序代码签名证书。这一请求似乎适得其反，因为它让用户无法打印。惠普公司(HP Inc.)的一位发言人周五晚间告诉我们：</p><p> We unintentionally revoked credentials on some older versions of Mac drivers. This caused a temporary disruption for those customers and we are working with Apple to restore the drivers. In the meantime, we recommend users experiencing this problem to uninstall the HP driver and use the native AirPrint driver to print to their printer.</p><p>我们无意中吊销了一些较旧版本的Mac驱动程序的凭据。这对这些客户造成了暂时的中断，我们正在与苹果合作恢复驱动程序。同时，我们建议遇到此问题的用户卸载HP驱动程序，并使用本机AirPrint驱动程序打印到他们的打印机。</p><p> As my blog post makes clear, it is not possible for HP to unilaterally revoke their own Developer ID cert. HP had to contact Apple and request for the cert to be revoked. Apparently Apple granted that request. So blame must be apportioned to both companies. There have been no reports of malware or private key compromise. Therefore, no good reason exists for HP to request that their cert be revoked, and no good reason exists for Apple to grant that misguided request.</p><p>正如我的博客所说的那样，惠普不可能单方面撤销他们自己的开发者ID证书。惠普不得不联系苹果，要求撤销该证书。显然，苹果批准了这一请求。因此，责任必须分摊到这两家公司身上。目前还没有恶意软件或私钥泄露的报道。因此，惠普没有很好的理由要求撤销他们的证书，苹果也没有很好的理由同意这种误导性的请求。</p><p> With great power comes great responsibility. Both HP and Apple failed in their responsibility, and Mac users suffered as a result.</p><p>强大的力量伴随着巨大的责任。惠普和苹果都没有尽到责任，Mac用户也因此蒙受了损失。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://lapcatsoftware.com/articles/revocation.html">https://lapcatsoftware.com/articles/revocation.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/开发/">#开发</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/开发者/">#开发者</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/developer/">#developer</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1034875.html"><img src="http://img2.diglog.com/img/2020/11/thumb_70cb84755c6e1c3dba801123370378e9.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034875.html">
PSA：MacOS今早有点崩溃，许多非苹果应用程序在发布时挂起</a></div><span class="my_story_list_date">2020-11-13 19:7</span></div><div class="col-sm"><div><a target="_blank" href="/story/1034869.html"><img src="http://img2.diglog.com/img/2020/11/thumb_b5c4485adeaef8c4c6de1a4e8f31f726.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034869.html">
《每日新闻》：苹果发布MacOS Big Sur</a></div><span class="my_story_list_date">2020-11-13 19:6</span></div><div class="col-sm"><div><a target="_blank" href="/story/1034848.html"><img src="http://img2.diglog.com/img/2020/11/thumb_d533402dbd67ee0830f92bcdae337ba3.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034848.html">IOS 14.3测试版代码表明，苹果可能会在iPhone或iPad安装过程中向用户推荐第三方应用，这可能会平息反垄断担忧</a></div><span class="my_story_list_date">2020-11-13 19:2</span></div><div class="col-sm"><div><a target="_blank" href="/story/1034844.html"><img src="http://img2.diglog.com/img/2020/11/thumb_7e158e30fd4e364ef3ccf9b99a500622.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1034844.html">苹果公司的Greg Joswiak、Craig Federighi和John Ternus就M1的开发、Mac的未来、购买第一版硬件等问题进行了采访</a></div><span class="my_story_list_date">2020-11-13 19:0</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>