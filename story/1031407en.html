<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>MIOS：IBM 5150 BIOS更换项目</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">MIOS：IBM 5150 BIOS更换项目</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-10-27 13:10:10</div><div class="page_narrow text-break page_content"><p>Thiswebpage describes the MIOS Project. MIOS is achip-for-chip replacement of the BIOS (Basic Input Output System) onthe IBM 5150 Personal Computer. On the IBM PC the BIOS is contained ina ROM IC Chip located on the motherboard at socket location U33. The ICis socketed and can be replaced with a custom ROM containingcustom code.    The purpose of this project is to explore controlling the IBM PChardware in non-standard ways. The purpose is not to replace the BIOSwith another BIOS that does exactly the same thing! We are going todescribe how MIOS works by describing the path we took for development.   We started this project by considering other BIOS replacement software.Notably for the IBM PC there is a diagnostic ROM replacement known asthe Landmark/Supersoft package, as described here:  MinusZero Degrees    The Landmark/Supersoft code is unique. By burning the codeto ROM and placing in BIOS location U33 it is possible to boot the IBMPC and perform a series of diagnostic tests, with the resultsreported on the screen in real time. A photo of a typical displayscreen is shown in Figure 1.   Thekey point about thediagnosticROM is the fact the code is completely controlling the PChardware: There is no DOS operating system. There is no BIOS.          Controlling PC hardware directly, without using the standard BIOS, isfacilitated by the extensive available documentation describinghow the IBM 5150works and operates. The IBM Technical Manual contains the completecircuit diagrams, with useful additional descriptions of hardwarecomponents, and a complete listing of the BIOS source code. Theassembly code control of computer hardware without a BIOSor operating system is sometimes referred to as using &#34;primitives&#34;.Direct control of computer hardware has certain advantages, not theleast ofwhich is the possibly of increased operating speed.    As built, the IBM 5150 PC dedicated a single ROM socket for the BIOS.This is socket U33 on the motherboard, as shown in Figure 2. The socketis designed to accepta Motorola MC68766 programmable ROM. The ROM has space for8192bytes of code. (This is often abbreviated as &#34;8K&#34;.) The original ROMchip chosen by IBM is comparatively rare, and the programming protocolrequires vintage hardware that can be difficult to find.Fortunately, the ROM chip can be substituted with a much more common ICchip by using a socket adapter. The MIOS code must be burned into a ROMchip before it can be used. We use an adapter with theprogrammable M27128Achip,as shown in Figure 3.          MIOS has been designed to avoid the use of CPUinterrupts. This marks a major departure from the design of theoriginal IBM 5150 BIOS. We decided to pursue this design approach basedupon a similar idea as presented by  PerBrinchHansen, in his book &#34;Programminga Personal Computer&#34;, 1982, P. 54.The first task of the MIOS software then, is to elimate interrupts tothe 8088 CPU. Interrupts to the CPU have multiple sources: Maskableexternal interrupts, non-maskable external interrupts, and non-maskableinternal interrupts.           The maskable interrupts can be masked by using the assembly codecommand &#34;CLI&#34;, a mneumonic with the meaning &#34;CLear Interrupts&#34;. As luckwould have it, the IBM 5150 external non-maskable interrupts can indeedbydisabled with a command to a logic gate preceding the CPU input pin, asdescribed in Mazidi, P. 435.  (Masking NMIInterrupts) The internal non-maskable interrupts arethe only remaining. (Interrupt 0: Divide byZero, etc)     The 8088 CPU iscodedinternally to proceed to a specific memory address at the start of theRAM to read an interrupt vector address to follow and execute code tohandle the interrupt. The first 16K of RAM in the IBM PC is soldereddirectly to the motherboard. Although this RAM is available for use,since it is dynamic RAM, the memory requires constant refreshing tohold address byte content. Therefore we do not have an easy way tohandle the non-maskable internal CPU interrupts. We recognize this as adeficiency in MIOS. Here is a discussion of operating without DRAMrefresh interrupts.  (DRAMRefresh)   MIOS is designed to operate in conjunction with an MDA display adapter.The MDA is the simplest display adapter for the IBM 5150 PC. However,the MDAdisplay adapter has one very notable and useful feature: The videomemory is SRAM, not RAM.  The SRAM on the MDA card can be usedbyMIOS as general-purpose memory for creating a Stack Segment (SS) andExtra Segment (ES). Using SRAM avoids the complexity and resourcerequirements of servicing an interrupt for memory refresh.          Before the MDA display adapter can be used it must be initialized. TheMDA is initialized by sending setup byte parameters to onboard memorylocations called registers. Thisturns out to be fairly easy to do because of excellent documentionregards the inner workings of the MDA:  MDACard Explanation   We were fortunate to also find a coding example for initializing theMDA registers using assembly code. Although we did not use the codedirectly, the basic outline in MIOS is very similar.  MDACardInitializaton Example   Working with the ROM code space of  8192 bytes is accomplishedbyusing specialized software called a Hex Editor. It is akin to a texteditor, but optimized for editing hexadecimal machine codeinstructions. Our favorite hex editor is HxD by Mael Horz, availablehere:  HxDHex Editor           With a hex editor you can directly view and manipulate the 8192 bytesof code for the MIOS ROM. A typical screenshot of a hex editing sessionis shown in the Figure 5. The ROM space at motherboard location U33 ishardwired to map to the 8088 memory space as locations FE00:0000 toFF00:FFFF. (These addresses are represented in characteristicSegment:Offset notation. See an explanation at  Segment:OffsetExplanation) This memory is atthe very top of thedirectly-addressable memory in the IBM 5150 PC.   The MIOS input/output operating system is coded in 8086 assembly code.We have opted to code and compile using a software tool characteristicof the time period. We are using Microsoft Assembler 2.0 (&#34;MASM 2.0&#34;).We use MASM to compile and link the code, and the &#34;EXE2BIN.EXE utilityto &#34;flatten&#34; the executable to a simple binary file. (Basically toremove the Program Segment Prefix (PSP).) Here is a link to historicalinformation for MASM:  MASMVersion History          When power is applied, the 8088 CPU is internally programmed tojumpto a specific memory location for its first machine code instruction.That first instruction is expected to reside at memory location:FF00:FFF0. This address corresponds to the beginning of the last 16byte line in the U33 memory space. In the original IBM BIOS thislocation contains an unconditional jump to the start of the boot code.MIOS does the same thing, with an unconditional jump to thefirst byte of the ROM at: FE00:0000.         The IBM PC uses a segmented memory system. Briefly, thememory is oftenorganized into 4 main segments: CS: Code Segment is a sequential list of machine code instructions forthe CPU. DS: Data Space is a section of byte-based data the CPU can reference. SS: Stack Segment is a temporary memory storage area, acessed usingPUSH and POP instructions. ES: Extra Segment is a destination area for displayinginformation, often the video monitor.    MIOS is written to interface directly with the IBM PC Keyboard. Thekeyboard connects to the motherboard using a 5 Pin DIN connector. Wefound a good assembly code example of a keyboard hardware interface inSam&#39;s Photofact Book:  Keyboard ProgrammingExample    The interface routine we areusing for the keyboard is extremely basic. The keyboard sendsbyte-sized scancodes, which are different that the byte-sized ASCIIcodes representing a character. A translation must be performed. We dothe translation using the XLAT instruction with a data table. (XLAT =TRANSLATE). Another complication is that the keyboard actually sends 2scancodes per key tap:  1 scancode for press, and 1 scancode forrelease. The keyboard is polled for a keypress. Interrupts are not used.          As an experiment, we created a 64K version of MIOS for a 386motherboard as shown in Figure X. Because the motherboard has ISAexpansion slots, we were able to use the MDA video card. We weresurprised to discover that MIOS was able to boot the system. (Althoughthe keyboard interface did not work.) This experiment suggestsadditional possibilities for future development.          We have packaged the source code and binary files for MIOS in acompressed zip file. The file can be downloaded here:  MIOS.ZIP   Here is an short summary of the sequential steps taken in the MIOS code: 1) Unconditional jump to the first byte in the U33 ROM memory space. 2) Mask and disable interrupts. 3) Beep the speaker 4) Initialize the MDA card 5) Clear the screen 6) Send a POST code to show boot progress  (RequiresPOST card at 80HPort) 7) Define Data Segment, Extra Segment, Stack Segment 8) Display a welcome message (&#34;MTM SCI&#34;) 9) Display a label in the Stack Segment (&#34;STK&#34;) 10) Display 8088 CPU Registers 11) Poll the keyboard and display the ASCII character if a key ispressed          Here is a list of possible ideas for future improvements: 1) Programmed output on the parallet port on the MDA card.  (Speed Test Results) 2) Use the DIP switch settings for input or configuration. 3) Program one of the onboard timers to measure short programintervals. (Cycle Counter) 4) Add additional SRAM memory using an ISA card interface.  (PCSRAM Extension: SERGEY) 5) Create a dumb terminal using RS-232 I/O. ( SerialPort Card and the  Initialize Code) 6) Add more features to the diagnostic interface. (Something like DEBUG) 7) Interface to a RTC card in an ISA slot. Poll the RTC registers fortimekeeping. 8) Interface to an 8087 FPU (Math Coprocessor) 9) Add hardware tests and diagnostics, with a progress display 10) Interface to CGA Video. Explore initializing a VGA card using theregisters.   We consulted a large number of books and references developing the MIOScode. Especially useful were the following books. The book by Mazidiwas especially helpful, and can be found on EBAY for less than $10.</p><p>这网页介绍了MIOS项目。MIOS是一个片对片更换BIOS(基本输入输出系统)ONIBM5150个人计算机。在IBM PC上，BIOS包含在位于主板上插座位置U33的ROM IC芯片。集成电路是套接字的，并且不能替换为包含以下内容的自定义ROM自定义代码。本项目的目的是探索对IBMPC的控制以非标准方式提供硬件。其目的不是更换BIOS用另一个BIOS来做完全相同的事情！我们要去通过描述我们的开发路径来描述MIOS的工作原理。我们从考虑其他BIOS替换软件开始这个项目。值得注意的是，对于IBMPC，有一种称为Landmark/Supersoft软件包，如下所述：减号零度Landmark/SuperSoft代码是唯一的。通过烧录代码到ROM并将其放入BIOS位置U33，可以引导IBMPC并根据结果执行一系列诊断测试在屏幕上实时报道。一张典型展示的照片屏幕如图1所示。关于这个问题的几个关键点诊断性ROM是代码完全控制PC的事实硬件：没有DOS操作系统。没有BIOS。直接控制PC硬件，而不使用标准BIOS，由大量可用的文档提供帮助，这些文档描述IBM 5150如何工作和操作。IBM技术手册包含完整的电路图，以及对硬件的有用补充说明组件，以及BIOS源代码的完整列表。这个汇编代码-在没有BIOS的情况下控制计算机硬件或者操作系统有时被称为使用原语。直接控制计算机硬件有一定的优势，而不是最少这就是提高运行速度的可能性。建成后，IBM5150PC专门为BIOS提供了一个ROM插槽。这是主板上的插座U33，如图2所示。插座旨在接受一个摩托罗拉MC68766可编程只读存储器。ROM有空间用于8192代码的字节数。(这通常缩写为&#34；8K&#34；。)。原版ROMIBM选择的芯片比较少见，编程协议需要可能很难找到的老式硬件。幸运的是，ROM芯片可以用更普通的IC代替芯片通过使用插座适配器。MIOS代码必须烧录到ROM中芯片才能使用。我们将适配器与可编程M27128A奇普，如图3所示，MIOS被设计为避免使用CPU打断一下。这标志着与原始IBM 5150 BIOS。我们决定采用这种设计方法，其基础是根据PER提出的类似想法布林克汉森在他的书“编程”中写道。A Personal Computer&#34；，1982，第54页。因此，MIOS软件的第一个任务是消除中断以8088 CPU。CPU中断有多个来源：可屏蔽外部中断、不可屏蔽的外部中断和不可屏蔽的内部中断。可以使用汇编代码屏蔽可屏蔽中断COMMAND&#34；CLI&34；，意思是清除中断&34；的机械式命令。作为运气如果有的话，IBM5150外部不可屏蔽中断确实可以通过通过对CPU输入引脚之前的逻辑门发出命令来禁用，因为在Mazidi，第435页中描述。(屏蔽NMI中断)内部不可屏蔽中断是唯一剩下的。(中断0：除以零等)。8088 CPU是已编码在内部继续到特定的内存地址，该地址位于RAM读取要跟随并执行代码的中断矢量地址处理中断。IBMPC中的第一个16K RAM是焊接的直接连接到主板上。虽然该RAM可供使用，因为它是动态RAM，所以存储器需要不断刷新以保存地址字节内容。因此，我们没有一种简单的方法来处理不可屏蔽的内部CPU中断。我们认识到这是一种MIOS缺乏症。下面讨论的是在不使用DRAM的情况下运行刷新中断。(DRAM刷新)MIOS设计为与MDA显示适配器配合运行。MDA是IBM5150PC最简单的显示适配器。然而，丙二醛(MDA)显示适配器有一个非常显著和有用的功能：视频内存是SRAM，不是RAM。*可以使用MDA卡上的SRAM通过作为通用存储器的MIOS，用于创建堆栈段(SS)和额外分段。使用SRAM避免了复杂性和资源为存储器刷新服务中断的要求。在使用MDA显示适配器之前，必须对其进行初始化。这个通过将设置字节参数发送到板载存储器来初始化MDA称为寄存器的位置。这事实证明，由于出色的文档编排，做起来相当容易关于mda的内部工作：mda卡片解释</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="http://www.mtmscientific.com/mios.html">http://www.mtmscientific.com/mios.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/ios/">#ios</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/更换/">#更换</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/bios/">#bios</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1031313.html"><img src="http://img2.diglog.com/img/2020/10/thumb_4e7ed6ed96318909c557ea613cff188e.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031313.html">现在是电影制片厂介入拯救电影院的时候了</a></div><span class="my_story_list_date">2020-10-27 5:49</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031261.html"><img src="http://img2.diglog.com/img/2020/10/thumb_9c1d0639f421119bea70e3af379cbea1.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031261.html">
Pinterest的新小工具将最喜欢的主板上的照片带到您的iOS14主屏幕上</a></div><span class="my_story_list_date">2020-10-27 0:2</span></div><div class="col-sm"><div><a target="_blank" href="/story/1031073.html"><img src="http://img2.diglog.com/img/2020/10/thumb_c1481866f8ac975e5bd0efeda6491de0.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1031073.html">Zest AI为其人工智能支持的技术筹集了1500万美元，该公司声称这可以帮助金融机构减少贷款组合中的偏见，使其风险投资总额达到8700万美元</a></div><span class="my_story_list_date">2020-10-25 16:18</span></div><div class="col-sm"><div><a target="_blank" href="/story/1030664.html"><img src="http://img2.diglog.com/img/2020/10/thumb_f34f22319d16aefa9a36dee08e96b7be.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1030664.html">苹果推出iOS14.1、iMovie更新等</a></div><span class="my_story_list_date">2020-10-23 4:37</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/美国/">#美国</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/linux/">#linux</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/程序/">#程序</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>