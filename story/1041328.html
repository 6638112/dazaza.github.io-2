<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Raspberry Pi CM4上的WiFi 6达到1.34 Gbps </title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Raspberry Pi CM4上的WiFi 6达到1.34 Gbps </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-23 03:34:46</div><div class="page_narrow text-break page_content"><p>购买三张无线网卡后，需要一个新的WiFi路由器，优化我的流程以交叉编译Raspberry Pi的Linux内核，安装Intel的WiFi固件，并修补Intel的无线驱动程序以使其能够在在Raspberry Pi上，我对EDUP Intel AX200 WiFi 6 PCIe卡进行了基准测试，并在Raspberry Pi和新的ASUS WiFi 6路由器之间获得了1.34 Gbps的带宽。</p><p>   您是否曾经以50美元的预算启动过一个需要花费几个小时的项目，并且最终意识到您在该项目上花费了整整一个月的时间，并且花费了近一千美元？</p><p>   当我测试Compute Module 4的板载WiFi 802.11ac芯片时，即使使用外部天线，我的速度也达到了约80 Mbps。</p><p>  我想知道使用PCI Express卡是否可以获得更好的性能。因此，我购买了内部装有Realtek芯片的ASUS AC51 PCIe卡，并花了几天时间调试Realtek的Linux驱动程序。最终，我放弃了，因为Linux上的大多数人似乎都使用USB版本，而不是PCI Express。如果您想了解更多有关该故障的信息，请在ASUS AC51上查看此GitHub问题。</p><p> 因此，在对Linux上受良好支持的WiFi芯片组进行了更多研究之后，我决定使用EDUP Intel AX200 PCIe卡，如本文顶部所示。从我在网上阅读的内容来看，所需的iwlwifi驱动程序在运行Linux的各种台式机和笔记本电脑中得到了更广泛的使用。</p><p>  该博客文章在下面继续，但是如果您更倾向于视觉，我还在Pi上发布了有关WiFi 6的视频：</p><p>  为缩略图表示歉意-在我的A / B测试中，它的表现比不张嘴的杰夫好1000倍。 </p><p>在WiFi的早期，当苹果公司的AirPort风行一时时，我们有了802.11b WiFi，理论上最大速度为11 Mbps。</p><p> 在过去的几十年中，我们拥有速率为54 Mbps的802.11a和g，速率为300-600 Mbps并使用2.4或5 GHz频谱的802.11n（AKA WiFi 4），以及最近的802.11ac（gka WiFi 5）在5 GHz频段上高达1.3 Gbps。</p><p>  我还跳过了其他一些标准，但是去年802.11ax标准被命名为＆＃39; WiFi 6＆＃39;现在是黄金标准，理论上允许的最大值是10 5 GHz频段上的Gbps。</p><p>  现在，回到PCI Express卡。它非常适合Compute Module 4 IO板上的1x插槽，无需任何适配器。</p><p> 我要测试的所有板卡的第一件事是启动Pi并查看使用lspci可以看到的内容：</p><p>  自从出现板卡以来，我还运行了dmesg并查找了PCI Express初始化部分，以确保没有BAR空间问题：</p><p> [0.940759] pci 0000：00：00.0：BAR 8：分配了[mem 0x600000000-0x6000fffff] [0.940790] pci 0000：01：00.0：BAR 0：分配了[mem 0x600000000-0x600003fff 64bit] </p><p>我测试过的GPU和其他一些卡遇到了BAR分配问题，但该卡似乎还不错。</p><p> 我还运行了ip a，看看运气好不好，该卡是否已在Pi OS中得到支持，但是我没有运气。仅将内置的wlan0接口与local和eth0一起列出。</p><p>  在为我的第一个Pi GPU测试视频经历了将近十二次重新编译Linux内核的艰苦努力之后，我决定在Mac上建立一个可靠的交叉编译环境，该处理器具有更快的处理器。</p><p>  该环境是在Mac上的虚拟机内部构建的，其主要原因是很难在Mac上安装Raspberry Pi ext4文件系统（即使使用Mac的Docker），但也很容易在VirtualBox下的Linux VM中执行操作。我必须这样做，以便能够在使用microSD卡时将已编译的内核复制到Pi的适当位置。</p><p> 还有其他方法可以做到这一点，例如通过网络而不是整个内核复制特定于驱动程序的文件，或者使用netboot进行复制，但是由于在各种情况下它都是可靠且可重复的，因此目前这就是我要做的。</p><p> 有关交叉编译的完整说明，请参见我在GitHub上的Raspberry Pi PCIe项目存储库：Raspberry Pi Linux交叉编译环境。</p><p>  最重要的是使用menuconfig配置内核（如果需要，可以手动配置），并启用以下选项： </p><p>设备驱动程序＆gt;网络设备支持＆gt;无线局域网英特尔＆gt; ＆＃34;英特尔无线WiFi下一代AGN（iwlwifi）＆＃34;</p><p> 保存该配置后，编译内核。在我的Mac上，在VM中，大约需要10分钟。在Pi 4上，大约需要一个小时！</p><p> 需要更多帮助和细节吗？在这里查看我在整个过程中制作的视频：Raspberry Pi CM4上的WiFi 6使它成为Fly!。</p><p> 编译完成后，请按照其余说明将已构建的内核，dtb等复制到microSD卡上（假设您正在使用CM4 Lite，否则请分别安装CM4的eMMC版本）。</p><p> 完成所有复制后，我卸载了两个分区，然后关闭了VM。我从Mac上拉了microSD卡，将其放回Pi中，启动了它，然后用手指交叉了！</p><p>  我登录到Pi并运行dmesg来检查日志...并且我意识到一定缺少某些东西，因为我看到消息找不到合适的固件！</p><p> 我还必须从Linux Wireless网站安装适当的设备固件。我在英特尔无线驱动程序页面上找到了AX200的驱动程序下载，并将其安装在Pi上，如下所示： </p><p>这次，我运行了dmesg，看到了更多的输出，但同时也出现了很多错误。使用dmesg --follow，我发现每隔几秒钟就会打印出类似的错误。</p><p> 并检查了ip a和iw列表后，发现有一个新的无线设备，但它似乎陷入了循环，每次尝试初始化时都会增加其ID。</p><p>     热区问题只是方向错误；这不是致命的，实际上，如果我手动读取热区数据，它似乎可以工作，因此可能是驱动程序中的错误。</p><p> 对于第二个错误，我最终在Linux内核邮件列表中找到了一个有用的补丁。</p><p> PawełMarczewski提出的解决方案是删除错误消息和触发它的检查。我认为这值得一试，因此我使用该电子邮件中的差异修补了Intel的WiFi驱动程序。</p><p>  我直接从邮件列表页面复制了diff，再次启动了交叉编译环境，登录，然后回到Linux源目录。</p><p> 我用邮件列表中diff的内容创建了一个名为iwlwifi.patch的新文件，并用git apply -v iwlwifi.patch应用了它。补丁程序干净利落地偏移了，于是我重新编译（第二次快得多），将所有内容复制到Pi的microSD卡上，然后使用补丁驱动程序启动Pi。 </p><p>我运行ip a检查接口，它显示为wlan1，我运行iw列表，并且在那里也正确显示！</p><p> 因此，最后要测试的是连接到我的网络。我在/etc/wpa_supplicant/wpa_supplicant.conf中编辑了WPA请求者文件，设置了我的国家代码和网络详细信息</p><p>   一切都已连接，WiFi卡获取了一个IP地址。我们在做生意！</p><p>  第一次执行此操作时，我使用iperf进行了一些测试，但此时意识到我已将802.11ax无线卡连接到老式的802.11ac无线路由器。所以我不得不想办法通过WiFi 6进行连接。</p><p>  GitHub上的PixlRainbow并没有升级我的整个家庭网络，而是建议我尝试将另一台计算机升级到WiFi 6，然后测试将其直接连接到Pi。</p><p> 因此，当我发现20美元的“明智的老虎”时，我感到非常兴奋。适用于我的Dell XPS 13笔记本电脑的Intel AX200卡。我购买了它并将其安装在Dell中，并制作了视频“如何将Dell XPS 13升级到WiFi 6（802.11ax）”的视频。</p><p> 但是，当我测试速度时，由于戴尔的两分两天线性能和配置，我发现升级后的卡只能在XPS 13上以300-400 Mbps的速度通过，这让我感到失望。我的不带WiFi 6的MacBook Pro可以通过802.11ac达到900 Mbps的速度，因此整个系统的设计非常重要。 </p><p>我很高兴在戴尔笔记本电脑中安装WiFi 6，但是它还不足以测试从Pi上获得的速度有多快。</p><p>  因此，我的下一步是升级无线路由器。并且有很多可用的AX路由器，但是大多数速度超过千兆的路由器比基本模型要贵很多。而且，如果我想突破千兆位的障碍，我需要一个具有更快上行链路的设备。</p><p> 我发现我的本地Micro Center装有具有2.5 Gbps可切换LAN / WAN端口的ASUS RT-AX86U WiFi 6路由器。我的家庭Internet连接无法做那么多事情（感谢Spectrum！），但是我确实希望尽快将内部网络升级到10 Gbps，所以也很高兴能拥有快速的WiFi连接。</p><p>     首先，我购买了十个千兆网络设备，包括一个MikroTik 4 SFP +端口10G交换机...然后，我意识到事后购买的特定收发器无法与路由器的2.5 Gbps端口配合使用-他们只做1或10 Gbps。</p><p> 其次，我决定遵循GitHub上St0nedB的建议，并在路由器上设置ASUSWRT-Merlin固件，以便可以在路由器和Raspberry Pi之间直接运行iperf。</p><p> 如果您想尝试同样的方法，可以在GitHub上链接直接使用iperf与ASUS路由器进行基准测试的说明。</p><p>   在我的千兆位网络上，Pi达到了其内置的千兆位有线网络性能，使其达到了930兆位。 </p><p>并直接连接到AX路由器，它可以泵送1.34吉比特（或双向1.5吉比特，具有全双工传输）。 这款WiFi 6 AX200卡的运行速度比内置千兆有线网络快30％，比内置WiFi快16倍！  在Raspberry Pi上获得更快的WiFi并不是很困难，但是它确实需要一些额外的调整和一个内核补丁，这使得大多数人很难使其正常工作。 希望我遇到的问题将来会更容易解决。  我想探索这种快速无线设置带来的更多可能性，例如将WiFi 6与快速SATA或NVMe存储一起用于超快速无线NAS，或将WiFi 6与千兆以太网一起使用来构建自定义路由器或访问点。  如果您想跟随这些冒险，请订阅我的YouTube频道并在Raspberry Pi PCIe设备数据库上浏览问题。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.jeffgeerling.com/blog/2020/wifi-6-gets-134-gbps-on-raspberry-pi-cm4">https://www.jeffgeerling.com/blog/2020/wifi-6-gets-134-gbps-on-raspberry-pi-cm4</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/wifi/">#wifi</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/pi/">#pi</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/raspberry/">#raspberry</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1037078.html"><img src="http://img2.diglog.com/img/2020/11/thumb_93cb04ea57ae39b19331997be290db7d.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1037078.html">亚马逊因其人行道功能而面临隐私反弹，该功能将Alexa设备转变为业主必须选择退出的邻居WiFi网络</a></div><span class="my_story_list_date">2020-11-29 8:43</span></div><div class="col-sm"><div><a target="_blank" href="/story/1036968.html"><img src="http://img2.diglog.com/img/2020/11/thumb_9133e4f1bb30783a525272366d692e53.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1036968.html">亚马逊因其人行道功能而面临隐私反弹，该功能将Alexa设备转变为业主必须选择退出的邻居WiFi网络</a></div><span class="my_story_list_date">2020-11-28 13:3</span></div><div class="col-sm"><div><a target="_blank" href="/story/1036483.html"><img src="http://img2.diglog.com/img/2020/11/thumb_03031572254a575d50557bee2a9a7fdb.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1036483.html">Wi-Fi如何运作？</a></div><span class="my_story_list_date">2020-11-25 14:16</span></div><div class="col-sm"><div><a target="_blank" href="/story/1035948.html"><img src="http://img2.diglog.com/img/2020/11/thumb_541cdba467f1abf22db443dc20131591.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1035948.html">ESP32-C3 WiFi和BLE RISC-V处理器与ESP8266引脚对引脚兼容</a></div><span class="my_story_list_date">2020-11-23 0:59</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>