<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>解读长生不老药中的联想</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">解读长生不老药中的联想</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-11-12 07:39:44</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/11/e49d013723f9c166194944fa6263990e.jpg"><img src="http://img2.diglog.com/img/2020/11/e49d013723f9c166194944fa6263990e.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Ecto中的数据建模需要一些时间来适应，特别是对于大多数已经。</p><p>使用传统的“重型”ORM。</p><p></p><p>对于很多ECTO新手用户来说，与协会相关的操作成为第一块绊脚石。ECTO提供了多个。</p><p>用于建立和修改记录之间的关联的功能，每个记录都是针对特定用例量身定做的。</p><p>从StackOverflow上关于cast_assoc、put_assoc和build_assoc的问题数量来看。</p><p>在线社区，选择正确的社区往往很有挑战性，特别是在用户还不习惯的情况下。</p><p>ECTO官方文件中的技术术语。</p><p></p><p>这篇文章的目的是在几个最常见的问题上给出一个简短但明确的答案。</p><p>(也是最简单的)场景。</p><p></p><p></p><p>传统ORM承担着极其复杂的“掩饰”任务。</p><p>与数据相关的操作，给开发人员一种使用本机语言数据容器的错觉。</p><p>为了实现这一点，ORM通常在幕后执行复杂的转换，这有时会导致次优</p><p>数据库性能。从这个意义上说，ORMS提出了一种折衷方案，即在语言本地语法的便利性和。</p><p>手工创建的SQL查询的精确度。</p><p></p><p>ECTO本质上提供了相同的权衡，但更倾向于手工创建的SQL查询。</p><p>核心概念上的区别在于ECTO并不打算抽象数据库操作，相反，</p><p>它为自己创建SQL查询提供了一种灵丹妙药的语法。ECTO依赖于开发人员进行格式化。</p><p>并验证数据以符合数据库架构，编制高效使用索引的查询，将。</p><p>记录在一起，并执行ORM试图自动化的其他任务。结果就是学习曲线变得更高了，</p><p>但也大大提高了灵活性。要更深入地比较ActiveRecord和ECTO，</p><p>看看这篇出色的ActiveRecord vs.Ecto帖子。</p><p></p><p></p><p>使用关联并不一定总是很复杂。在您有目标ID的情况下，ecto让。</p><p>您可以将关系列视为普通数据库字段。</p><p></p><p>为了给出一个具体的例子，让我们假设我们使用两个模型，Post和Comment，其中多个评论可以</p><p>参考一个帖子。在这种情况下，你的模型应该是这样的。</p><p></p><p>1个。</p><p>2个。</p><p>3个。</p><p>4.。</p><p>5个。</p><p>6个</p><p>7个。</p><p>8个。</p><p>9个。</p><p>10个。</p><p>11个。</p><p>12个。</p><p>13个。</p><p>14.</p><p>15个。</p><p>16个。</p><p>定义模块博客。POST DO。</p><p>使用ecto。图式。</p><p>架构(&#34；POST&34；DO)。</p><p>有很多：评论，博客。评论。</p><p>字段：标题，：字符串。</p><p>字段：正文，：字符串</p><p>端部。</p><p>端部。</p><p></p><p>定义模块博客。评论做。</p><p>使用ecto。图式。</p><p>架构(&#34；POST&34；DO)。</p><p>归属于：帖子、博客。邮政。</p><p>字段：正文，：字符串</p><p>端部。</p><p>端部。</p><p></p><p></p><p></p><p>默认情况下，每个表都包含一个主字段ID。POST上的HAS_MANY字段未引用数据库字段，它。</p><p>它的存在只是为了向ECTO提示，可以使用评论的Belong_to字段为帖子预载评论。</p><p>另一方面，WORMERS_TO字段指代表架构中的现有字段。默认情况下，此文件的名称</p><p>表中的字段与ECTO模型中的名称不同：数据库字段的末尾有_id。</p><p></p><p>ECTO允许您以与修改任何其他字段相同的方式修改这些类型的关联字段。在埃托文中，</p><p>更改原语字段的值称为“强制转换”。如果您需要为特定帖子创建新评论，</p><p>您实际上不需要任何特定于关联的函数，只需转换主键的值：</p><p></p><p></p><p>这是在两个表之间创建关联的最简单、最直接的方法。</p><p></p><p></p><p>将CAST_ASSOC看作是在关联上工作的CAST的特殊版本是很有用的。</p><p>但是，强制转换关联可能比强制转换普通字段复杂得多。强制转换调用通常转换为。</p><p>或多或少直接插入到单个SQL查询中，而CAST_ASSOC可能会导致多个INSERT、UPDATE或。</p><p>删除查询。让我们假设上例中的数据库表包含以下内容：</p><p></p><p></p><p></p><p>由于Post模型包含要评论的HASS_MANY关联，因此预加载所有评论是微不足道的。</p><p>在特定的帖子上：</p><p>%帖子{。</p><p>&#34；id&#34；=&gt；1，</p><p>一个关于……的故事。</p><p>正文&#34；=&gt；&34；从前...&#34；，</p><p>&#34；评论&#34；=&gt；[。</p><p>%COMMENT{&#34；id&#34；=&&gt;；10，&#34；正文&#34；=&&gt;；精彩故事！&#34；}，</p><p>%COMMENT{&#34；id&#34；=&&gt;；11，&#34；Body&#34；=&&gt;；接下来发生了什么？&#34；}，</p><p>%COMMENT{&#34；id&#34；=&&gt;；12，&#34；Body&#34；=&&gt;}感谢您的文章，</p><p>],。</p><p>}。</p><p></p><p>Single CAST_ASSOC Call On：注释将替换整个关联。实际上，这意味着这些值。</p><p>您传递给cast_assoc的信息将在以后的预加载调用中返回。这并不一定意味着所有。</p><p>数据库行将被替换。ECCO比较状态前和状态后的状态，并执行所需的最小工作量。</p><p>才能达到理想的状态。为了说明这一点，请考虑以下更改集：</p><p>参数=%{备注：[。</p><p>%COMMENT{&#34；id&#34；=&&gt;；11，&#34；Body&#34；=&&gt;；接下来发生了什么？&#34；}，</p><p>%COMMENT{&#34；id&#34；=&&gt;；12，&#34；Body&#34；=&&gt;；谢谢您的帖子，</p><p>%Comment{&#34；正文&#34；=&&gt;；有趣&#34；}，</p><p>]}。</p><p>邮政。</p><p>|&gt；cast(params，[])。</p><p>|&gt；cast_assoc(：评论)</p><p></p><p>执行此变更集将导致对数据库的三次调用：</p><p>-删除ID为10的评论。</p><p>-更新ID为12的评论，并将Body设置为“谢谢您的帖子”</p><p>-插入正文为“有趣”的评论，并为其分配一个新的id。</p><p></p><p>ID为11的行保持不变，因为它与预加载值匹配。这里需要注意的重要一点是。</p><p>ECTO本身不会预加载数据，因此要使用cast_assoc，您需要记住调用preload</p><p>事先。但是，您并不局限于预加载一个完整的关联。Cast_assoc的工作方式与。</p><p>当您使用预加载作为Repo.preload(：Comments，Query)记录的子集时。此功能对以下方面非常有用。</p><p>将CAST_ASSOC的影响限制在关联记录的子集。</p><p></p><p></p><p>乍一看，put_assoc在很多方面与cast_assoc相似：它也适用于整个关联。</p><p>并要求您预先加载要更新的记录。然而，仔细检查后发现，它几乎是。</p><p>与你使用它的方式相反。关键区别在于put_assoc旨在更新</p><p>关联是“引用”的，而不是数据。也就是说，当您想要连接时，通常会使用put_assoc。</p><p>数据库中已存在的一条或多条记录的记录。</p><p></p><p>Put_Assoc可用于将新评论与现有帖子相关联，类似于我们在“直接转换”中所做的操作。</p><p>部分，但不直接使用post_id字段：</p><p></p><p></p><p>这使得您的代码在具有复杂主字段的情况下更加简洁，因为Ecto负责所有的记账工作</p><p>为了你。</p><p></p><p></p><p>Build_Assoc是一个方便的函数，允许您通过关联创建相关记录。</p><p>在一张现有的唱片上。为了继续我们的帖子/评论示例，这里有另一种创建新评论的方法：</p><p></p><p>POST=回购。滚蛋！(7)。</p><p>..。</p><p>COMMENT_PARAMS=%{。</p><p>&#34；标题&#34；：&#34；一个故事…&#34；</p><p>&#34；Body&#34；：&#34；曾几何时...&#34；</p><p>}。</p><p>埃托。Build_assoc(POST，：Comments，Comment_Params)。</p><p>#%评论{post_id：7，标题：&#34；一个故事...&#34；，正文：&#34；从前...&#34；}。</p><p></p><p>Build_assoc的强大之处在于它的表现力：上面的代码清楚地向您展示了评论属于帖子。</p><p></p><p>与上面讨论的函数不同，Build_Assoc不在变更集上操作-它构建一个变更集。这意味着你会。</p><p>只有在想要创建新记录时才使用Build_Assoc。</p><p></p><p></p><p>虽然这篇文章并没有涵盖您在生产应用程序中可能遇到的各种用例，</p><p>我希望它能给你一个坚实的基础，让你开始寻找答案。如果你需要提神的话。</p><p>在未来，这里有一个简单的流程图，它将提醒您讨论的用例：</p><p></p><p></p><p>ECTO的关联函数是对数据库中的字段引用的相对精简的抽象。了解如何。</p><p>这些功能中的每一个都在数据库级别上工作，这对于成为专业的Elixir/Phoenix开发人员至关重要。幸运的是，</p><p>ECTO的构建方式是，每个功能都相对较小、确定，并且只有一个目的。您先。</p><p>掌握了基础知识之后，与传统ORM相比(至少在我的经验中是这样)，您可以期待更少的“理解”</p><p>情况就是这样)。编码愉快！</p><p>附注：如果你想在文章发布后立即阅读《炼金术》，请订阅我们的《炼金术》时事通讯，不要错过任何一篇帖子！</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://blog.appsignal.com/2020/11/10/understanding-associations-in-elixir-ecto.html">https://blog.appsignal.com/2020/11/10/understanding-associations-in-elixir-ecto.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/长生不老/">#长生不老</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/ecto/">#ecto</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>