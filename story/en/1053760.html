<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>关于重构的短暂警示故事 A Short Cautionary Tale About Refactoring</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">A Short Cautionary Tale About Refactoring<br/>关于重构的短暂警示故事 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-03-21 14:06:31</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/3/e2b2adc539c7a6c9bc9e2f20a9dea37a.png"><img src="http://img2.diglog.com/img/2021/3/e2b2adc539c7a6c9bc9e2f20a9dea37a.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>This week I was making changes in a part of the codebase I was unfamiliar with. While reading the code I spotted an inlined PNG image. This was not a small icon but an image of about 100kb in size. I searched the project and found the same inlined image in a couple of different components. Maybe it was because I was in a need of some coffee, but at that moment I could not think of a good reason for this approach. As the components with the inline image were quite similar, I surmised that they were copied from each other and the inline image is just one of those weird things that you find in legacy code.</p><p>本周我正在制定码Base的一部分的变化，我不熟悉。读取代码时，我发现了一个内联的PNG图像。这不是一个小图标，但大小约为100kb的图像。我搜索了该项目，并在几个不同的组件中找到了相同的内联图像。也许是因为我需要一些咖啡，但在那一刻，我无法想到这种方法的好理由。由于内联图像的组件非常相似，我猜测它们彼此复制，内联图像只是您在遗留代码中找到的那些奇怪的事情之一。</p><p> I decoded the embedded image from Base64 and created a separate PNG file from it. The final step was to replace the inlined image source with a relative path to the new image file. The diff for the commit was almost perfect: large red blocks of deleted code and just a few green lines of added code. A quick and easy refactoring win and a textbook example of the  boy scout rule. Or so I thought.</p><p> 我从Base64解码了嵌入式图像，并从中创建单独的PNG文件。最后一步是用新图像文件的相对路径替换带内线的图像源。该提交的差异几乎是完美的：删除代码的大红色块，只有几条绿线的添加代码。一个快速简便的重构胜利和男性侦察规则的教科书示例。或者我想。</p><p> I took a short break and grabbed some much-needed coffee. Fast forward a few hours and I completed the task that I was originally working on. I was in the final stages of testing when I noticed a bug. At that same moment, I also realized the exact purpose of the inlined image. Can you guess?</p><p> 我休息一下，抓住了一些需要的咖啡。快进几个小时，我完成了我最初工作的任务。当我注意到一个错误时，我是在测试的最后阶段。在那个同一时刻，我也意识到内联图像的确切目的。猜一下？</p><p> To give you more context, we use the components with the image to display error messages. The image is a cute illustration of the company mascot with the expression “Oops something went wrong”. One of the possible errors that can happen, is when the user losses their connection or goes offline. So when that happens and you render a component that still needs to download an image, the image will fail to load. Oh yeah… 🤦‍♂️</p><p> 要为您提供更多的上下文，我们将使用与图像的组件显示为显示错误消息。这张照片是公司吉祥物的可爱插图，表达了“哎呀出了问题”。可能发生的可能性之一，是用户丢失它们的连接或脱机。因此，当发生这种情况时，渲染仍然需要下载图像的组件，图像将无法加载。哦，是的......♥</p><p> I thought I had learned the hard way earlier in my career not to presume I know better than the original author. Of course, there are situations where a less experienced coder (ie. yourself from a couple of years ago) worked on a feature or where someone had to cut corners (eg. due to a deadline). But usually, there is a good reason why someone took the approach that they did.</p><p> 我以为我在职业生涯中早些时候已经学到了艰难的方式，而不是假设我知道比原作者更了解。当然，有一个经验丰富的编码器（即，来自几年前的自己）在一个特征或某人不得不削减角落的情况下（例如，从事截止日期）。但通常情况下，有一个充满原因的人为什么有人采取了他们所做的方法。</p><p> Luckily I spotted the issue before I pushed my branch. I could use  git reset --soft and alter my changes. I extracted the inlined image into a separate React component and used it where needed. This way we still get both benefits: the error components are much cleaner and easier to read, and the inlined image is located in one place. After that, I reapplied all the other commits. The Git history was clean and none of my coworkers were the wiser. Unless they are reading this, in which case: “Oh hey, how’s it going?”  😅</p><p> 幸运的是，在我推动分公司之前，我发现了这个问题。我可以使用git reset --soft并改变我的更改。我将环列的图像提取到单独的反应组件中并在需要时使用它。这样，我们仍然获得两个好处：错误组件是更清晰的更清晰，更容易读取，内衬图像位于一个地方。之后，我重新申请了所有其他罪行。 Git历史很干净，我的同事都不是更聪明。除非他们正在阅读这一点，在这种情况下：“哦，嘿，怎么样？” 😅</p><p> I know, this bug would not be the end of the world. But this small example shows how even the best of our refactoring intentions can do more harm than good. If you find yourself looking at a piece of code that looks strange or needlessly too complex, ask your coworkers. This is especially true if the original author is still at the company. You might be missing some context and you’ll get to learn something new. Or you can indeed improve the code, in which case the original author may learn the better approach. In both cases, it’s a win. Also if there is a good reason for the current approach, document it. Add a more descriptive name or a comment to avoid confusion in the future.</p><p> 我知道，这个虫子不会成为世界的尽头。但这个小的例子表明，即使是我们的重构意图也有多弊大于良好。如果您发现自己看一段看起来很奇怪或不必要的代码，请询问您的同事。如果原作者仍然在公司，这尤其如此。您可能缺少一些上下文，您将获得新的东西。或者您可以确实可以改进代码，在这种情况下，原作者可能会学到更好的方法。在这两种情况下，这是一个胜利。此外，如果目前的方法有很好的理由，请记录它。添加更多描述性名称或评论以避免将来混淆。 </p><p> Learn from my small mistake and research before making refactorings. This is 10 times more important for larger changes and when editing the core files of the project. And the most important thing: don’t forget to drink some coffee before starting.</p><p>在制作重构之前从我的小错误和研究中学习。 对于更大的变化以及编辑项目的核心文件时，这是10倍。 最重要的是：在开始之前别忘了喝点咖啡。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://zigamiklic.com/cautionary-tale/">https://zigamiklic.com/cautionary-tale/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/警示/">#警示</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/图像/">#图像</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>