<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用标准工具创建舒适的FreeBSD Jails Creating Comfy FreeBSD Jails Using Standard Tools</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Creating Comfy FreeBSD Jails Using Standard Tools<br/>使用标准工具创建舒适的FreeBSD Jails </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-01-18 04:28:46</div><div class="page_narrow text-break page_content"><p>Docker has stormed into software development inrecent years. While the concepts behind it are powerful and useful, similartools have been used in systems for decades. FreeBSD’s jails in one of those toolswhich build upon even older  chroot(2) To put it shortly, with these tools, youcan make a safe environment separated from the rest of the system.</p><p>Docker在最近几年进入了软件开发领域。虽然其背后的概念功能强大且有用，但数十年来，类似的工具已在系统中使用。 FreeBSD的监狱之一就是建立在更老的chroot（2）上的工具之一。简而言之，借助这些工具，您可以将安全的环境与系统的其余部分分开。</p><p> Jails in FreeBSD is by no means a new tool (introduced in 4.X), but for a reasonor another, I haven’t used them that often, which is a shame since they are sopowerful. So I wanted to explore this concept in a concise and summarizedmanner.</p><p> FreeBSD中的Jails绝不是一个新工具（在4.X中引入），但是由于另一个原因，我没有经常使用它们，这很遗憾，因为它们功能强大。因此，我想以简洁明了的方式探讨这个概念。</p><p>  ZFS datasets are a great way of creating templates for jails since, after thetemplate creation, you can easily create new jails with  zfs clone or  zfs send/receive. Typically people tend to divide jails to complete and servicejails, where the former usually resembles a real FreeBSD system, and the latteris often dedicated to applications/services. I’ll cover complete jails for now.</p><p>  ZFS数据集是为监狱创建模板的好方法，因为在模板创建之后，您可以使用zfs clone或zfs send / receive轻松创建新的监狱。通常，人们倾向于将监狱分为完成监狱和服务监狱，前者通常类似于真实的FreeBSD系统，后者通常专用于应用程序/服务。我现在将介绍完整的监狱。</p><p> The creation of templates starts with creating a dataset for your jail andtemplate. Here I’ll make a new dataset for the base installation of FreeBSD12.2.</p><p> 模板的创建始于为监狱和模板创建数据集。在这里，我将为FreeBSD12.2的基本安装创建一个新的数据集。</p><p> $ sudo zfs create -o mountpoint=/vm zroot/vm$ sudo zfs create zroot/vm/tmpl$ sudo zfs create zroot/vm/tmpl/12.2</p><p> $ sudo zfs create -o mountpoint = / vm zroot / vm $ sudo zfs create zroot / vm / tmpl $ sudo zfs create zroot / vm / tmpl / 12.2</p><p>  $ fetch ftp://ftp.freebsd.org/pub/FreeBSD/releases/amd64/12.2-RELEASE/base.txz# Fetch all the necessary stuff for your template, e.g. lib32 if needed$ sudo tar -xJvpf base.txz -C /vm/tmpl/12.2</p><p>  $获取ftp://ftp.freebsd.org/pub/FreeBSD/releases/amd64/12.2-RELEASE/base.txz#获取模板所需的所有必要内容，例如lib32（如果需要）$ sudo tar -xJvpf base.txz -C /vm/tmpl/12.2</p><p>        # No output for successful script runs.daily_show_success=&#34;NO&#34;weekly_show_success=&#34;NO&#34;monthly_show_success=&#34;NO&#34;security_show_success=&#34;NO&#34; # Output to log files which are rotated by default.daily_output=&#34;/var/log/daily.log&#34;daily_status_security_output=&#34;/var/log/daily.log&#34;weekly_output=&#34;/var/log/weekly.log&#34;weekly_status_security_output=&#34;/var/log/weekly.log&#34;monthly_output=&#34;/var/log/monthly.log&#34;monthly_status_security_output=&#34;/var/log/monthly.log&#34; # No need for those without sendmaildaily_clean_hoststat_enable=&#34;NO&#34;daily_status_mail_rejects_enable=&#34;NO&#34;daily_status_mailq_enable=&#34;NO&#34;daily_queuerun_enable=&#34;NO&#34; # Host does thosedaily_status_disks_enable=&#34;NO&#34;daily_status_zfs_zpool_list_enable=&#34;NO&#34;daily_status_network_enable=&#34;NO&#34;daily_status_uptime_enable=&#34;NO&#34;daily_ntpd_leapfile_enable=&#34;NO&#34;weekly_locate_enable=&#34;NO&#34;weekly_whatis_enable=&#34;NO&#34;security_status_chksetuid_enable=&#34;NO&#34;security_status_neggrpperm_enable=&#34;NO&#34;security_status_chkuid0_enable=&#34;NO&#34;security_status_ipfwdenied_enable=&#34;NO&#34;security_status_ipfdenied_enable=&#34;NO&#34;security_status_ipfwlimit_enable=&#34;NO&#34;security_status_ipf6denied_enable=&#34;NO&#34;security_status_tcpwrap_enable=&#34;NO&#34;</p><p>        ＃没有成功脚本运行的输出。 ＃输出到默认循环的日志文件.daily_output =＆＃34; /var/log/daily.log&#34; daily_status_security_output =＆＃34; /var/log/daily.log&#34; weekly_output =＆＃34 ; /var/log/weekly.log&#34; weekly_status_security_output =＆＃34; /var/log/weekly.log&#34; monthly_output =＆＃34; /var/log/monthly.log&#34; monthly_status_security_output =＆＃ 34; /var/log/monthly.log&#34; ＃无需那些没有sendmail的用户就可以了＃主机执行这些daily_status_disks_enable =＆＃34; NO＆＃34; daily_status_zfs_zpool_list_enable =＆＃34; NO＆＃34; daily_status_network_enable =＆＃34; NO＆＃34; daily_status_uptime_enable =＆＃34; NO＆＃34 = dap＆d34; ap_d ＃34; weekly_locate_enable =＆＃34; NO＆＃34; weekly_whatis_enable =＆＃34; NO＆＃34; security_status_chksetuid_enable =＆＃34; NO＆＃34; security_status_neggrpperm_enable =＆＃34; NO＆＃34; security_status_chkuid0_enable ＃34; security_status_ipfwdenied_enable =＆＃34; NO＆＃34; security_status_ipfdenied_enable =＆＃34; NO＆＃34; security_status_ipfwlimit_enable =＆＃34; NO＆＃34; security_status_ipf6denied_enable =＆＃34_no＆＃34; ＃34; </p><p>        This creates a snapshot of  zroot/vm/tmpl/12.2 named  complete. You can then check your current snapshots with:</p><p>这将创建名为完成的zroot / vm / tmpl / 12.2的快照。然后，您可以使用以下方法检查当前快照：</p><p>   Now you should be able to create a new jail based on that snapshot. You can doit either with  zfs clone or  zfs send/receive:</p><p>   现在，您应该能够基于该快照创建一个新的监狱。您可以使用zfs clone或zfs send / receive进行操作：</p><p>  “A clone is a writable volume or file system whose initial contents are thesame as the dataset from which it was created. As with snapshots, creating aclone is nearly instantaneous and initially consumes no additional diskspace. In addition, you can snapshot a clone.” [1]</p><p>  “克隆是一个可写的卷或文件系统，其初始内容与创建它的数据集相同。与快照一样，创建aclone几乎是即时的，并且最初不占用额外的磁盘空间。此外，您可以快照克隆。” [1]</p><p> “The zfs send command creates a stream representation of a snapshot that iswritten to standard output. By default, a full stream is generated. You canredirect the output to a file or to a different system. The zfs receivecommand creates a snapshot whose contents are specified in the stream that isprovided on standard input. If a full stream is received, a new file system iscreated as well. You can send ZFS snapshot data and receive ZFS snapshot dataand file systems with these commands. See the examples in the next section.”[2]</p><p> “ zfs send命令创建快照的流表示形式，并将其写入标准输出。默认情况下，将生成完整的流。您可以将输出重定向到文件或其他系统。 zfs receivecommand创建一个快照，该快照的内容在标准输入所提供的流中指定。如果接收到完整的流，则还将创建一个新的文件系统。您可以使用以下命令发送ZFS快照数据并接收ZFS快照数据和文件系统。请参阅下一节中的示例。” [2]</p><p> $ sudo zfs clone zroot/vm/tmpl/12.2@complete zroot/vm/jail1# OR$ sudo sh -c &#34;zfs send zroot/vm/tmpl/12.2@complete | zfs receive zroot/vm/jail1&#34;</p><p> $ sudo zfs clone zroot/vm/tmpl/12.2@complete zroot / vm / jail1＃OR $ sudo sh -c＆＃34; zfs发送zroot/vm/tmpl/12.2@complete | zfs接收zroot / vm / jail1＆＃34;</p><p>  Note: These configurations is for very bare-bones jail, e.g. without anymounts or advanced networking. Further configurations are discussed in future posts.</p><p>  注意：这些配置适用于非常简陋的监狱，例如无需任何安装或高级联网。更多配置将在以后的文章中讨论。</p><p>   # /etc/jail.confexec.start = &#34;/bin/sh /etc/rc&#34;;exec.stop = &#34;/bin/sh /etc/rc.shutdown&#34;;exec.clean;mount.devfs;host.hostname = $name;path = &#34;/vm/$name&#34;;exec.consolelog = &#34;/var/log/jail_${name}_console.log&#34;;exec.prestart = &#34;cp /etc/resolv.conf $path/etc&#34;;exec.poststop = &#34;rm $path/etc/resolv.conf&#34;;jail1 { ip4.addr = &#34;lo0|127.1.1.1/32&#34;; ip6.addr = &#34;lo0|fd00:1:1:1::1/64&#34;; allow.chflags; allow.raw_sockets;}</p><p>   ＃/etc/jail.confexec.start =＆＃34; / bin / sh /etc/rc&#34;;exec.stop =＆＃34; / bin / sh /etc/rc.shutdown&#34;;exec。 clean; mount.devfs; host.hostname = $ name; path =＆＃34; / vm / $ name＆＃34 ;; exec.consolelog =＆＃34; / var / log / jail _ $ {name} _console.log＆＃ 34 ;; exec.prestart =＆＃34; cp /etc/resolv.conf $ path / etc＆＃34 ;; exec.poststop =＆＃34; rm $ path / etc / resolv.conf＆＃34 ;; jail1 {ip4 .addr =＆＃34; lo0 | 127.1.1.1/32&#34 ;; ip6.addr =＆＃34; lo0 | fd00：1：1：1 :: 1/64＆＃34 ;; allow.chflags; allow.raw_sockets;} </p><p>             So that’s how you can spin up a simple restricted environment on your FreeBSDsystem. There are still lots of things to cover in this topic, e.g., in-depthnetworking and configurations. But I think those deserve their own posts. So seeyou soon!</p><p>这样便可以在FreeBSD系统上启动一个简单的受限环境。 本主题中仍有很多内容要涉及，例如深度网络和配置。 但是我认为那些人应该有自己的职位。 很快见！ </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://kettunen.io/post/standard-freebsd-jails/">https://kettunen.io/post/standard-freebsd-jails/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/标准/">#标准</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/comfy/">#comfy</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/status/">#status</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>