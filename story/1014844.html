<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>不是的随机字符串和整数</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">不是的随机字符串和整数</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-29 10:17:43</div><div class="page_narrow text-break page_content"><p>最近，内部聊天中出现了生成随机优惠码和其他字符串的话题。我的首选一直是基于Feistel网络的解决方案，我认为它并不是非常晦涩难懂。但当其他人似乎没有认出它时，我很惊讶，所以可能是这样的。无论如何，这里有一个小插图来说明这件事在起作用。</p><p>Feistel网络是DES和其他加密算法背后的密码的数学基础。我不会详述细节(因为这会表明我完全理解它，有些地方我不太清楚)，但最终它是一种有点简单且非常快速的机制，对于我们在这里的使用相当有效。</p><p>对于字符串生成，我们有两个部分。对于第一部分，我们获取一个整数，比如数据库中按顺序生成的id主键字段，然后通过一个函数将其运行，该函数会将其转换为其他一些随机的整数。我们的函数实现有一个有趣的属性：如果您将看起来随机的整数通过相同的函数运行回来，我们就会得到原来的整数。换句话说，…。</p><p>…。对于n的任何整数值，这种一对一映射实质上保证了随机外观的输出在整个整数空间中实际上是唯一的。换句话说，我们可以肯定，一旦我们到了做线的部分，就不会有碰撞。</p><p>最初的函数基于PostgreSQL wiki上的代码，为清晰起见只做了几处改动，应该适用于任何现代(或古老)版本的Postgres。</p><p>CREATE OR REPLACE Function PUBLIC.feistel_crypt(值整数)返回整数语言plpgsql不可变STRICTAS$Function$DECLARE KEY NUMERIC；L1INT；L2INT；R1INT：=0；BEGIN L1：=(VALUE&&gt;；&&gt;16)&amp；65535；R1：=VALUE&AMP；65535；而I&lt；3LOOP--KEY可以是返回0到1之间数值的任何函数：=(。R2：=L1#(KEY*32767)：：INT；L1：=L2；R1：=R2；I：=i+1；结束循环；返回((R1&lt；&lt；16)+L1)；结束；$Function$；</p><p>交换一下分配给那个关键变量的值，这样就可以得到与我所说明的不同的输出。毕竟，如果有人可以一字不差地使用这个示例并生成您的优惠券代码，那就不好了。此外，一旦开始以某种方式使用生成的数字，您可能不想更改该键函数，因为这可能会引入与前一个键生成的现有值冲突的可能性。</p><p>无论如何，有了这些，您就可以开始生成一些随机整数，并确保它们映射回来：</p><p>TOTESRANDOM=#SELECT feistel_crypt(1)，feistel_crypt(2)，feistel_crypt(3)，feistel_crypt(4)；FESTEL_CRYPT|feistel_crypt-+-561465857|436885871|576481439|483424269(1行)总计RANDOM=#SELECT FESTEL_CRYPT(561465857)，FESTEL_CRYPT(436885871)，FESTEL_CRYPT(576481439)，FESTEL_CRYPT(483424269)；FESTEL_CRYPT|feistel_crypt-+-1|2|3|4(1行)。</p><p>TOTESRANDOM=#SELECT COUNT(*)FROM GENERATE_SELECTION(110000000)WHERE FESTEL_CRYPT(FEISTEL_CRYPT(GENERATE_RESERENCE))！=GENERATE_STERENCE；COUNT-0(1行)时间：185151.416毫秒(03：05.151)。</p><p>一旦我们有了新的价值，第二部分就更容易了。我们获取新的整数并将其映射到字符串，实质上是创建数字的基数N表示。</p><p>CREATE OR REPLACE Function PUBLIC.INT_TO_STRING(NINT)返回文本语言plpgsql不可变STRICTAS$Function$DECLARE字母text：=&#39；abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39；；BASE INT：=LENGTH(字母表)；输出文本：=&#39；&#39；；BEGIN LOOP OUTPUT：=OUTPUT||SUBSTR(字母表，1+(n%BASE)：：INT，1)；n：=n/BASE；当n=0时退出；结束循环；返回输出；结束$Function$；</p><p>瞧，看起来像随机的短字符串，你可以用来作为优惠码、电子邮件确认令牌，任何你需要的东西：</p><p>Talesdom=#select int_to_string(feistel_crypt(1))，int_to_string(feistel_crypt(2))，int_to_string(feistel_crypt(3))，int_to_string(feistel_crypt(4))；INT_TO_STRING|int_to_string-+-5409L|t8hJD|Tj1aN|NTySG(1行)时间：0.473毫秒。</p><p>当然，您可以根据需要调整该字符集。如果你对有人对它进行反向工程非常偏执，也许会把它弄得乱七八糟。您的字符集可以是您想要的任何内容。一个纯粹的表情符号集可能会很有趣，或者可能会将它设置为一组单词，以便连接在一起，而不是单个字母。或者，如果有人可能正在大声朗读其中的一个，例如，在电话中，你可能会想要一个单独的案例：</p><p>&#39；ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39；totesrandom=#_to_string(FESTEL_CRYPT(1))，INT_TO_STRING(FESTEL_CRYPT(2))，INT_TO_STRING(FESTEL_CRYPT(3))，INT_TO_STRING(FESTEL_CRYPT(4))；INT_TO_STRING|int_to_string-+-33FKKJ|XK9DIH|L79HTJ|7TQ39H(1行)时间：0.681毫秒</p><p>当然也可以颠倒这一部分，并将字符串读回原始整数。但我建议将结果字符串存储到数据库字段中，并直接对其进行查找。</p><p>在某种程度上，我最终将其移植到了Python。它仍然是超级简单的，而且工作起来也是一样的。但是，也许以另一种形式查看它会帮助您将其移植到您可能需要它的任何其他语言。</p><p>Def Simple_Feistel(Value)：#用于ID混淆的简单自逆Feistel密码L1=(Value&gt；&gt；16)&amp；65535 R1=值&amp；65535，范围(3)：KEY=(1366*R1+150889)%714025)/714025.0)L2=R1=R2=L1^INT(KEY*32767)L1=L2 R1=R2 RETURN(R1&lt；&lt；16)+l1def stringify_INTEGER(VALUE)：#获取整数并将其编码为基(LEN(字母))字符串字母表=&#39；abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39；；BASE=LEN(字母表)输出=&#39；&#39；而VALUE&gt；0：OUTPUT+=字母表[VALUE%BASE]VALUE//=BASE返回输出</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.endpoint.com/blog/2020/07/02/random-strings-and-integers-that-actually-arent">https://www.endpoint.com/blog/2020/07/02/random-strings-and-integers-that-actually-arent</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/字符串/">#字符串</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/strings/">#strings</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/生成/">#生成</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1014073.html"><img src="http://img.diglog.com/img/2020/7/thumb_c72a4bdf84c77ccc3eff0558d5edc17a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1014073.html">当性能很重要时，避免逐个字符处理</a></div><span class="my_story_list_date">2020-7-25 11:17</span></div><div class="col-sm"><div><a target="_blank" href="/story/1005073.html"><img src="http://img.diglog.com/img/2020/6/thumb_59413fdac3188e903082cc46af1e334d.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1005073.html">陌生事物，JavaScript版</a></div><span class="my_story_list_date">2020-6-4 7:33</span></div><div class="col-sm"><div><a target="_blank" href="/story/1003527.html"><img src="http://img.diglog.com/img/2020/5/thumb_2b3d936a097a3bd933232ea55cafc8c9.jpeg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1003527.html">淘气弦大名单</a></div><span class="my_story_list_date">2020-5-24 23:29</span></div><div class="col-sm"><div><a target="_blank" href="/story/1000578.html"><img src="http://img.diglog.com/img/2020/5/thumb_7caf034c70468be71ccb5a4ff75bc807.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1000578.html">所有的弦都应该变成f弦吗？</a></div><span class="my_story_list_date">2020-5-4 19:21</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>