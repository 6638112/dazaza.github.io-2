<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>防指纹扩展往往会使指纹更容易 Anti-fingerprinting extensions tend to make fingerprinting easier</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Anti-fingerprinting extensions tend to make fingerprinting easier<br/>防指纹扩展往往会使指纹更容易 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-12-11 07:51:13</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2020/12/dada12760035560ca09c7e822e3b55f2.png"><img src="http://img2.diglog.com/img/2020/12/dada12760035560ca09c7e822e3b55f2.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Do you have a privacy protection extension installed in your browser? There are so many around, and every security vendor is promoting their own. Typically, these will provide a feature called “anti-fingerprinting” or “fingerprint protection” which is supposed to make you less identifiable on the web. What you won’t notice: this feature is almost universally flawed, potentially allowing even better fingerprinting.</p><p>您的浏览器中是否安装了隐私保护扩展程序？周围有这么多，每个安全厂商都在推广自己的产品。通常，这些工具将提供称为“防指纹”或“指纹保护”的功能，以减少您在网络上的身份。您不会注意到的是：此功能几乎普遍存在缺陷，可能会带来更好的指纹识别。</p><p>  I’ve seen a number of extensions misimplement this functionality, yet I rarely bother to write a report. The effort to fully explain the problem is considerable. On the other hand, it is obvious that for most vendors privacy protection is merely a check that they can put on their feature list. Quality does not matter because no user will be able to tell whether their solution actually worked. With minimal resources available, my issue report is unlikely to cause a meaningful action.</p><p>  我看到许多扩展程序都没有使用此功能，但我很少去写报告。充分解释该问题的工作量很大。另一方面，很明显，对于大多数供应商而言，隐私保护只是他们可以放入其功能列表中的一项检查。质量并不重要，因为没有用户能够知道他们的解决方案是否真正起作用。如果资源很少，我的问题报告就不太可能采取有意义的行动。</p><p> That’s why I decided to explain the issues in a blog post, a typical extension will have at least three out of four. Next time I run across a browser extension suffering from all the same flaws I can send them a link to this post. And maybe some vendors will resolve the issues then. Or, even better, not even make these mistakes in the first place.</p><p> 这就是为什么我决定在博客文章中解释这些问题的原因，典型的扩展名至少有四分之三。下次当我遇到一个浏览器扩展程序时，遇到同样的缺陷，我可以向他们发送指向该帖子的链接。也许某些供应商会解决问题。或者，甚至更好的是，甚至根本不会犯这些错误。</p><p>   When you browse the web, you aren’t merely interacting with the website you are visiting but also with numerous third parties. Many of these have a huge interest in recognizing you reliably across different websites, advertisers for example want to “personalize” your ads. The traditional approach is storing a cookie in your browser which contains your unique identifier. However, modern browsers have a highly recommendable setting to clear cookies at the end of the browsing session. There is private browsing mode where no cookies are stored permanently. Further technical restrictions for third-party cookies are expected to be implemented soon, and EU data protection rules also make storing cookies complicated to say the least.</p><p>   浏览网络时，您不仅在与您访问的网站进行交互，而且还与众多第三方进行交互。其中许多人对在不同网站上可靠地识别您有极大的兴趣，例如，广告商想要“个性化”您的广告。传统方法是在您的浏览器中存储一个cookie，其中包含您的唯一标识符。但是，现代浏览器的设置非常值得推荐，可以在浏览会话结束时清除Cookie。有专用浏览模式，其中不会永久存储Cookie。第三方cookie的进一步技术限制预计将很快实施，并且欧盟数据保护规则也至少使cookie的存储变得复杂。</p><p> So cookies are becoming increasingly unreliable. Fingerprinting is supposed to solve this issue by recognizing individual users without storing any data on their end. The idea is to look at data about user’s system that browsers make available anyway, for example display resolution. It doesn’t matter what the data is, it should be:</p><p> 因此，cookie变得越来越不可靠。指纹识别应该通过识别单个用户而不在其端存储任何数据来解决此问题。这样做的目的是查看浏览器无论如何都能获得的有关用户系统的数据，例如显示分辨率。数据是什么都没有关系，应该是：</p><p>  Note that no data point needs to identify a single person by itself. If each of them refer to a different group of people, with enough data points the intersection of all these groups will always be a single person.</p><p>  注意，没有数据点需要自己识别一个人。如果他们每个人都指的是不同的人群，那么只要有足够的数据点，所有这些人群的交集将永远是一个人。</p><p>  The goal of anti-fingerprinting is reducing the amount and quality of data that can be used for fingerprinting. For example, CSS used to allow recognizing websites that the user visited before – a design flaw that could be used for fingerprinting among other things. It took quite some time and effort, but eventually the browsers  found a fix that wouldn’t break the web. Today this data point is no longer available to websites.</p><p>  防指纹的目标是减少可用于指纹识别的数据的数量和质量。例如，CSS用于允许识别用户之前访问过的网站，这是一种设计缺陷，可用于指纹识别等。这花费了很多时间和精力，但最终浏览器找到了不会破坏网络的修复程序。今天，该数据点不再可用于网站。 </p><p> Other data points remain but have been defused considerably. For example, browsers provide websites with a user agent string so that these know e.g. which browser brand and version they are dealing with. Applications installed by the users used to extend this user agent string with their own identifiers. Eventually, browser vendors recognized how this could be misused for fingerprinting and decided to  remove any third-party additions. Much of the other information originally available here has been removed as well, so that today any user agent string is usually common to a large group of people.</p><p>其他数据点仍然存在，但已被大量混淆。例如，浏览器向网站提供用户代理字符串，以便这些网站知道例如他们正在处理哪个浏览器品牌和版本。用户安装的应用程序用于使用自己的标识符扩展此用户代理字符串。最终，浏览器供应商意识到如何将其误用于指纹识别，因此决定删除任何第三方添加的内容。最初在此处可用的许多其他信息也已被删除，因此如今，任何用户代理字符串通常对于一大群人来说都是通用的。</p><p>  Browser vendors have already invested a considerable amount of work into anti-fingerprinting. However, they usually limited themselves to measures which wouldn’t break existing websites. And while things like display resolution (unlike window size) aren’t considered by too many websites, these were apparently numerous enough that browsers still give them user’s display resolution and the available space (typically display resolution without the taskbar).</p><p>  浏览器供应商已经在防指纹方面投入了大量工作。但是，他们通常将自己限制在不会破坏现有网站的措施上。尽管没有太多的网站考虑诸如显示分辨率（与窗口大小不同）之类的东西，但这些网站显然足够多，以至于浏览器仍然为它们提供用户的显示分辨率和可用空间（通常是不带任务栏的显示分辨率）。</p><p> Privacy protection extensions on the other hand aren’t showing as much concern. So they will typically do something like:</p><p> 另一方面，隐私保护扩展并没有引起太多关注。因此，他们通常会执行以下操作：</p><p>  There you go, the website will now see the same display resolution for everybody, right? Well, that’s unless the website does this:</p><p>  到了那里，网站现在将为每个人看到相同的显示分辨率，对吗？好吧，除非网站这样做：</p><p>  And suddenly  screen.width and  screen.height are restored to their original values. Fingerprinting can now use two data points instead of one: not merely the real display resolution but also the fake one. Even if that fake display resolution were extremely common, it would still make the fingerprint slightly more precise.</p><p>  突然，screen.width和screen.height恢复为原始值。指纹现在可以使用两个数据点代替一个数据点：不仅是真实的显示分辨率，还包括假的分辨率。即使那种虚假的显示分辨率非常普遍，它仍然会使指纹更加精确。</p><p> Is this magic? No, just how JavaScript prototypes work. See, these properties are not defined on the  screen object itself, they are part of the object’s prototype. So that privacy extension added an override for prototype’s properties. With the override removed the original properties became visible again.</p><p> 这是魔法吗？不，只是JavaScript原型的工作方式。请注意，这些属性未在屏幕对象本身上定义，它们是对象原型的一部分。因此，该隐私权扩展程序为原型的属性添加了替代项。删除替代项后，原始属性再次变得可见。</p><p>   Much better. The website can no longer retrieve the original value easily. However, it can detect that the value has been manipulated by calling  Object.getOwnPropertyDescriptor(Screen.prototype, &#34;width&#34;). Normally the resulting property descriptor would contain a getter, this one has a static value however. And the fact that a privacy extension is messing with the values is again a usable data point.</p><p>   好多了。该网站无法再轻松地获取原始价值。但是，它可以通过调用Object.getOwnPropertyDescriptor（Screen.prototype，＆＃34; width＆＃34;）来检测到该值已被操纵。通常，生成的属性描述符将包含一个吸气剂，但是该吸气剂具有静态值。隐私扩展将这些值弄乱的事实再次成为可用的数据点。 </p><p>   Almost there. But now the website can call  Object.getOwnPropertyDescriptor(Screen.prototype, &#34;width&#34;).get.toString() to see the source code of our getter. Again a data point which could be used for fingerprinting. The source code needs to be hidden:</p><p>快好了。但是现在该网站可以调用Object.getOwnPropertyDescriptor（Screen.prototype，＆＃34; width＆＃34;）。get.toString（）来查看我们的吸气剂的源代码。再次是可以用于指纹识别的数据点。源代码需要隐藏：</p><p>  This  bind() call makes sure the getter looks like a native function. Exactly what we needed.</p><p>  此bind（）调用确保getter看起来像本机函数。正是我们需要的。</p><p>  There is a complication here: a website doesn’t merely have one JavaScript execution context, it has one for each frame. So you have to make sure your content script runs in all these frames. And so browser extensions will typically specify   &#34;all_frames&#34;: true in their manifest. And that’s correct. But then the website does something like this:</p><p>  这里有一个复杂之处：一个网站不仅有一个JavaScript执行上下文，而且每个框架都有一个。因此，您必须确保您的内容脚本可以在所有这些框架中运行。因此，浏览器扩展程序通常会在其清单中指定＆＃34; all_frames＆＃34 ;: true。没错。但随后，该网站执行了以下操作：</p><p>  Why is this newly created frame still reporting the original display width? We are back at square one: the website again has two data points to work with instead of one.</p><p>  为什么这个新创建的框架仍然报告原始显示宽度？我们回到第一个广场：该网站又有两个数据点，而不是一个。</p><p> The problem here: if frame location isn’t set, the default is to load the special page  about:blank. When Chrome developers created their extension APIs originally they didn’t give extensions any way to run content scripts here. Luckily, this loophole has been closed by now, but the extension manifest has to set   &#34;match_about_blank&#34;: true as well.</p><p> 这里的问题是：如果未设置框架位置，则默认为加载特殊页面about：blank。 Chrome开发人员最初创建扩展API时，并没有提供任何扩展来在此处运行内容脚本。幸运的是，此漏洞现在已经关闭，但是扩展清单必须将＆＃34; match_about_blank＆＃34;设置为true。</p><p>  As anti-fingerprinting functionality in browser extensions is rather invasive, it is prone to breaking websites. So it is important to let users disable this functionality on specific websites. This is why you will often see code like this in extension content scripts:</p><p>  由于浏览器扩展中的防指纹功能具有侵入性，因此很容易破坏网站。因此，重要的是让用户在特定网站上禁用此功能。这就是为什么您经常在扩展内容脚本中看到这样的代码的原因：</p><p>  So rather than initializing all the anti-fingerprinting measures immediately, this content script first waits for the extension’s background page to tell it whether it is actually supposed to do anything. This gives the website the necessary time to store all the relevant values before these are changed. It could even come back later and check out the modified values as well – once again, two data points are better than one.</p><p>  因此，此内容脚本不是立即立即初始化所有的防指纹措施，而是先等待扩展程序的背景页面告诉它是否实际上应该执行任何操作。这使网站有必要的时间来存储所有相关值，然后再进行更改。它甚至可以稍后再返回并检查修改后的值-再次，两个数据点要好于一个。 </p><p> This is an important limitation of Chrome’s extension architecture which is sadly shared by all browsers today. It is possible to run a content script before any webpage scripts can run (  &#34;run_at&#34;: &#34;document_start&#34;). This will only be a static script however, not knowing any of the extension state. And requesting extension state takes time.</p><p>这是Chrome扩展架构的一个重要限制，可悲的是如今所有浏览器都共享该架构。可以在运行任何网页脚本之前运行内容脚本（＆＃34; run_at＆＃34 ;:＆＃34; document_start＆＃34;）。但是，这只是一个静态脚本，不知道任何扩展状态。并且请求扩展状态需要时间。</p><p> This might eventually get solved by  dynamic content script support, a request originally created ten years ago. In the meantime however, it seems that the only viable solution is to initialize anti-fingerprinting immediately. If the extension later says “no, you are disabled” – well, then the content script will just have to undo all manipulations. But this approach makes sure that in the common scenario (functionality is enabled) websites won’t see two variants of the same data.</p><p> 动态内容脚本支持最终可能会解决这个问题，该请求最初是十年前创建的。但是，与此同时，似乎唯一可行的解​​决方案是立即初始化防指纹。如果扩展名后面说“不，您被禁用” –好吧，那么内容脚本将只需要撤消所有操作。但是这种方法可以确保在常见情况（启用功能）中，网站不会看到同一数据的两种变体。</p><p>  Let’s say that all the technical issues are solved. The mechanism for installing fake values works flawlessly. This still leaves a question: how does one choose the “right” fake value?</p><p>  假设所有的技术问题都已解决。安装假值的机制可以完美地工作。这仍然存在一个问题：如何选择“正确的”假价值？</p><p> How about choosing a random value? My display resolution is 1661×3351, now fingerprint that! As funny as this is, fingerprinting doesn’t rely on data that makes sense. All it needs is data that is stable and sufficiently unique. And that display resolution is certainly extremely unique. Now one could come up with schemes to change this value regularly, but fact is: making users stand out isn’t the right way.</p><p> 如何选择一个随机值？我的显示分辨率是1661×3351，现在是指纹！有趣的是，指纹识别并不依赖有意义的数据。它所需要的只是稳定且足够唯一的数据。而且该显示分辨率当然是极其独特的。现在，人们可以提出一些方案来定期更改此值，但事实是：让用户脱颖而出并不是正确的方法。</p><p> What you’d rather want is finding the largest group out there and joining it. My display resolution is 1920×1080 – just the  common Full HD, nothing to see here! Want to know my available display space? I have my Windows taskbar at the bottom, just like everyone else. No, I didn’t resize it either. I’m just your average Joe.</p><p> 您想要的是找到最大的团队并加入。我的显示分辨率是1920×1080 –只是普通的Full HD，在这里看不到任何东西！想知道我的可用显示空间吗？与其他所有人一样，我的Windows任务栏位于底部。不，我也没有调整大小。我只是你平常的乔</p><p> The only trouble with this approach: the values have to be re-evaluated regularly. Two decades ago, 1024×768 was the most common display resolution and a good choice for anti-fingerprinting. Today, someone claiming to have this screen size would certainly stick out. Similarly, in my website logs visitors claiming to use Firefox 48 are noticeable: it might have been a common browser version some years ago, but today it’s usually bots merely pretending to be website visitors.</p><p> 这种方法的唯一麻烦是：必须定期重新评估值。二十年前，1024×768是最常见的显示分辨率，也是防指纹的不错选择。今天，声称拥有此屏幕尺寸的人肯定会脱颖而出。同样，在我的网站日志中，引人注目的是声称使用Firefox 48的访客：它可能是几年前的通用浏览器版本，但如今，它通常只是假装为网站访客的机器人。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://palant.info/2020/12/10/how-anti-fingerprinting-extensions-tend-to-make-fingerprinting-easier/">https://palant.info/2020/12/10/how-anti-fingerprinting-extensions-tend-to-make-fingerprinting-easier/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/指纹/">#指纹</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/网站/">#网站</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy; 2020 diglog.com </div></div></body></html>