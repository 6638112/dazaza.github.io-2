<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>最小二进制启动Minimal Binary Boot</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Minimal Binary Boot<br/>最小二进制启动</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-25 22:01:05</div><div class="page_narrow text-break page_content"><p>The minor objective is to do it in code that is understandableby 75% of programmers.</p><p>次要目标是用75%的程序员都能理解的代码来实现。</p><p>   MiniForth by Jakub Kądziołka, c.f.  https://github.com/NieDzejkob/miniforthOne of its ideas is to put variable addresses (&amp;here, ...) onto theinitial stack. We extend this to execution tokens and the constant -1.</p><p>《米尼福斯》Jakub Kądziołka，c.f。https://github.com/NieDzejkob/miniforthOne它的想法之一是放置可变地址（&amp；here，…）在最初的堆栈上。我们将其扩展到执行令牌和常量-1。</p><p> stage0 by Jeremiah Oriansj with a binary seed for x86 of 357 bytes, c.f.  https://github.com/oriansj/stage0/</p><p>stage0由Jeremiah Oriansj编写，带有357字节x86的二进制种子，c.f。https://github.com/oriansj/stage0/</p><p>  Planckforth by Koichi NAKAMURA, c.f.  https://github.com/nineties/planckforthIt starts with one character words. Therefore, his parser is reallysimple, i.e. it reads the next character. Later he extends this tonormal forth.</p><p>普朗克福斯中村光一，c.f。https://github.com/nineties/planckforthIt从一个字符的单词开始。因此，他的解析器是reallysimple，即它读取下一个字符。后来，他把这个扩展到了正常的范围。</p><p>  Small forth nuclei on which we can define a regular forth by forthsource code. Both use tail code sharing and place variablesdirectly in the machine instructions. ITF-STC: indirection table forth with subroutine threading codeWe replaced the linked list directory with a lookup table forwords of one character.</p><p>小的forth核，我们可以在其上定义规则的forth by forthsource代码。两者都使用尾部代码共享，并将变量直接放入机器指令中。ITF-STC：间接表forth和子程序线程代码我们用一个字符的单词查找表替换了链表目录。</p><p> 0w4tf: A forth with an empty dictionary, i.e. it has no regularwords. It has a default word and some execution tokens, -1, andsome addresses of variables on the initial stack. Just enough toassemble new Forth primitives.C.f.  0w4tf</p><p>0w4tf：一个forth，有一个空字典，也就是说，它没有固定的单词。它有一个默认字和一些执行标记，-1，以及初始堆栈上变量的一些地址。刚刚够组装新福思原语。C.f.0w4tf</p><p> 2wf:My first forth nucleus with only two words in thedictionary (: and ,). It has also execution tokens and variableson the stack.</p><p>2wf：我的第一个第四核，字典里只有两个词（：和，）。它还具有执行令牌和堆栈上的变量。</p><p> The octal monitor with the shifting flag, which controls, if we readthe next octal digit or emit the next octet into the memory.</p><p>带移位标志的八进制监视器，用于控制我们是读取下一个八进制数字，还是将下一个八进制数字发送到内存中。</p><p>     I&#39;m still working on the code for the testenvironment using 32 bit linux. It&#39;s now down to 316 bytes for 2wf(as monitor input) and 315 bytes loaded if standalone.</p><p>我&#39；我仍在使用32位linux编写测试环境的代码。它&#39；现在2wf（作为监视器输入）的字节数减少到316字节，如果独立，则加载315字节。</p><p>  The 16 bit bios code of 2wf for keyboard is down to 237 bytesstandalone and 231 bytes to be loaded by the monitor.Both are not yet debugged.</p><p>键盘2wf的16位bios代码仅为237字节，由监视器加载231字节。两者都还没有调试。</p><p> At these small sizes, a mere human can rigorously check each bit with due diligence.</p><p>在这些小尺寸的机器上，仅仅一个人就可以尽职尽责地严格检查每一点。</p><p>    I have found no way to compile a short jump without doubt.Gnu as optimizes jmp on its own and do not provide something like jmpb AFAIK.Any hints are welcome.</p><p>毫无疑问，我没有办法编写一个简短的跳转。Gnu as自己优化jmp，不提供类似jmpb AFAIK的东西。欢迎任何提示。</p><p>   .macro jmpb target pre_jump_byte_\@ : jmp \target .fill 0xffffffff * (. - 2 - pre_jump_byte_\@), 8, 0xdeadbeef # its size is zero or to big.endm</p><p>.macro jmpb target pre_jump_byte_\@:jmp\target。填充0xFFFFFF*（-2-pre_jump_byte_\@），8，0xdeadbeef#其大小为零或大。endm</p><p>  .macro jmpb target .db 0xEB, target - ( $ + 1) ; hex code and relative offset .fill 0xffffffff * ((target - $) &amp; ~ 0xff), 8, 0xdeadbeef .endm</p><p>.宏jmpb目标。db 0xEB，目标-（$+1）；十六进制代码和相对偏移量。填充0xFFFFFF*（（目标-$）&amp；~0xff），8，0xdeadbeef。endm</p><p>    The binary seed is only a monitor, i.e. a code loader. The defaultone reads octal numbers and writes them as octets into memory.</p><p>二进制种子只是一个监视器，即一个代码加载程序。defaultone读取八进制数，并将其作为八位字节写入内存。</p><p> The last octet overwrites the last jump offset of the monitor. Thus,we jump into the new code.</p><p>最后一个八位字节覆盖监视器的最后一个跳转偏移量。因此，我们跳进了新的代码。</p><p>  Octal code is easier to parse and convert to octets. We only have tosubstract &#39;0&#39;. With hex code we must substract either &#39;0&#39; or &#39;A&#39; or&#39;a&#39;. Therefore, the octal monitor is smaller than a hex monitor.</p><p>八进制代码更容易解析并转换为八进制。我们只需要订阅&#39；0&#39;. 对于十六进制代码，我们必须减去&#39；0&#39; 或&#39；A&#39；或&#39；a&#39；。因此，八进制监视器比十六进制监视器小。</p><p>  On x86 hardware we can use a monitor which reads octets, becauseof the alt numpad input method. It allows us to enteroctals numbers directly.</p><p>在x86硬件上，由于alt numpad输入法，我们可以使用读取八位字节的监视器。它允许我们直接计算肠胃直肠的数字。</p><p> Otherwise octet input would be cheating. We would enter a binarymanually. That&#39;s still a binary seed.</p><p>否则八位组输入就是作弊。我们将手动输入二进制文件。那&#39；它仍然是一颗二元种子。</p><p>  The monitor input is a minimal forth interpreter compiled to machine code,all bytes reversed and encoded as octal numbers. We provide twovariants:</p><p>监视器输入是一个最小的forth解释器，编译成机器代码，所有字节都反转并编码为八进制数。我们提供两种变体：</p><p> 0w4tf - zero words four tokens forth: It has no regular forth word,only a fallback code if the word is not found. Additionally, it 4execution tokens, the value -1, and 3 addresses of variables on theinitial stack.</p><p>0w4tf-零单词四个token-forth：它没有常规的forth单词，如果找不到单词，则只有一个回退代码。此外，它在初始堆栈上包含4个执行标记、值-1和3个变量地址。</p><p> 2wf - two word forth: It was my first attempt. I moved it into aseparate branch 2wf.It has only two regular forth words and a well chosen initialstack. The stack contains some execution tokens (xt) and somevariable addresses.</p><p>2wf-两个字：这是我第一次尝试。我把它搬到了一个独立的2wf分店。它只有两个常规的forth单词和一个精心挑选的首字母堆栈。堆栈包含一些执行令牌（xt）和一些变量地址。</p><p> The purist compiles the assembler to machine code by pen and paper; then hereverses the bytes, does the octal encoding and enter the result by hand.</p><p>纯粹主义者用笔和纸把汇编程序编译成机器代码；然后对字节进行八进制编码，手工输入结果。</p><p>  If you don&#39;t accept octal code as source code you can take thebinary of 0w4tf as a small binary seed.</p><p>如果你没有&#39；不要接受八进制代码作为源代码，你可以把0w4tf的二进制作为一个小的二进制种子。</p><p> Both forth systems fit easily into a boot sector of 512 octets (aka bytes).Thus, they are small by themselves but huge in comparison to the octal monitor.</p><p>两个forth系统都可以轻松地放入512个八位字节（又称字节）的引导扇区。因此，它们本身很小，但与八进制监视器相比却很大。</p><p>  For those, who don&#39;t like reverse octal code as source input, weprovide a binary seed of our forth nucleus.</p><p>对于那些没有&#39；我们不喜欢将反向八进制代码作为源输入，而是提供了第四核的二进制种子。</p><p>  Because of the small size, we don&#39;t provide visual feedback at thestart. This means entering blindly a lot of characters. If you don&#39;tlike it I recommend a serial connection. That has the pro, that youcan attach a simple electric non-digitial logger to it, which printsall send and received bytes on a paper trail. That can be checkedrigorously with due diligence.</p><p>因为体积小，我们没有&#39；不要在启动时提供视觉反馈。这意味着盲目地输入大量字符。如果你没有&#39；我推荐串行连接。它有一个pro，你可以在它上面附加一个简单的电子非数字记录器，它可以打印所有发送和接收的字节。这可以通过尽职调查进行严格检查。</p><p>    We start with a test environment for i386 linux. In this environment it iseasier to develop and debug the code.</p><p>我们从i386 linux的测试环境开始。在这种环境下，开发和调试代码更容易。</p><p>  implement in Forth a hexcode word, e.g. hex0, , cf. [1].[1]  https://github.com/oriansj/stage0It&#39;s seed takes 357 bytes; i.e. much more than 2wf or 0w4tf</p><p>在Forth中实现一个hexcode字，例如hex0，参见[1]。[1]  https://github.com/oriansj/stage0It&#39;s种子占用357字节；i、 e.远远超过2wf或0w4tf</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/二进制/">#二进制</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/binary/">#binary</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/代码/">#代码</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>