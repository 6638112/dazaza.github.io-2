<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>简单的XMPP命令行客户端</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">简单的XMPP命令行客户端</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-15 00:58:00</div><div class="page_narrow text-break page_content"><p>/*--微小的XMPP客户端——txmppc从stdin读取命令并打印到stdout。它是用于命令行或自动化的KISS客户端。超出范围：花名册-&gt；有一个状态列表-&gt；没有名称（别名）、组或订阅状态MUC管理-&gt；基本工作：加入（使用密码）、写入和离开-&gt；没有管理、邀请、注册、迪斯科。。。没有迪斯科舞厅、书签、pubsub、vcard、文件、语音。。。OMEMO-加密很好，但对于一个小客户端来说太复杂了：有一个库（https://github.com/gkdr/libomemo）和亵渎有一个很好的实现，但omemo的代码比txmppc大5倍-&gt；亵渎（tui-OMEMO、OTR和PGP及插件）&gt；https://profanity-im.github.io/（c使用libstrophe）——&gt；poezio（tui-欧米莫和OTR）&gt；https://poez.io/（python使用slixmpp lib）&gt；mcabber（tui——没有OMEMO，但有OTR和PGP，外部脚本+fifo）——&gt；https://mcabber.com/（c）使用lib loudmouth-&gt；https://github.com/mcabber/loudmouth）——&gt；xmppc（cli，它可以发送消息（聊天+PGP），监视和查询一些数据）->；https://codeberg.org/Anoxinon_e.V./xmppc（c使用libstrophe）——&gt；smplxmpp-&gt；https://codeberg.org/tropf/smplxmpp（c++使用gloox库）——&gt；freetalk-&gt；https://www.gnu.org/software/freetalk/（c）使用loudmouth）&gt；jj（创建文件系统（fifo）结构）&gt；https://23.fi/jj/（c使用loudmouth）构建：仅取决于libstophe&gt；gcc txmppc。c-lstrophe-o txmppcStatic编译（musl）&gt；gcc txmppc。c-lstrophe-lc-lssl-lcrypto-lexpat-static-o txmppc_static（取决于libstrophe，它可以是xml2而不是expat和/或gnutls而不是openssl）可选：&gt；strip txmppc_staticUse:[echo&#34；命令jid消息&#34；|]txmppc[_static]&lt；jid&gt&书信电报；通过&gt；[&lt；服务器&gt；[（：|=）&lt；端口&gt；]-jid和密码是必需的-可选的是服务器的第三个参数（和：port或=port-&gt；如果tls启动（自签名证书）失败则忽略）。txmppc记录向stdout输入消息并从stdin读取命令-仅作为瘦客户端启动：&gt；txmppc-发送单个消息：&gt；echo和#34；[mM]jid消息&#34；|txmppc-&gt；txmppc执行命令并退出（在stdin关闭时）-对命令使用fifo：&gt；tail-f fifo | txmppc-&gt；从fifo执行命令并打印到标准输出&gt；echo和#34；q&#34&gt&gt；先进先出！尾巴仍然会等待——所以它不会&#39；t出口-&gt；发送另一行-tmux水平拆分+rlwrap客户端示例：（mkfifo-fifo；echo&#34；contact@example.com&#34; &gt&gt；jid_文件）90%窗格&gt；一边读台词；打印F&#39；%s:&gt；%s\n和#39&#34;$（日期和#34；+%Y-%m-%d%H:%m和#34；）&#34; &#34;${line}&#34&gt&amp；2.printf&#39；%s\n和#39&#34;${line}&#34；；测试&#34；q&#34；=&#34;${line}&#34&amp&amp；打破完成&lt；fifo | txmppc JID PASS |读线时；打印F&#39；%s:%s\n&#39&#34;$（日期和#34；+%Y-%m-%d%H:%m和#34；）&#34; &#34;${line}&#34；；完成10%窗格&gt；rlwrap-s-10-H/dev/null-b&#34&#34; -f jid#U文件awk和#39；{print}/^q$/{exit}&#39&gt&gt；先进先出-&gt；通过10行历史记录（未保存）和fid_文件中的jid完成，读取行编辑，输出将有一个日期前缀-&gt；提示：在这种情况下，fifo可以&#39；不能用于其他进程，因为发送EOF将结束客户端。命令：j[muc[密码]]-&gt；加入多用户会议（无muc和#34；加入和#34；状态更改-默认打开）J muc[密码]-&gt；加入多用户会议-无历史记录[muc]-&gt；离开多用户会议（无muc和#34；离开和#34；状态更改）[m]jid[message]-&gt；向jid发送（聊天）信息（无信息进入多行模式）h jid信息-&gt；将标题消息发送到jidn jid消息-&gt；将正常消息发送至jidM muc_jid消息-&gt；向多用户会议发送（groupchat）消息（如果不在muc中，它将被加入并离开）。[信息]-&gt；将（聊天|标题|正常|群组聊天）消息发送到最后一个jid（无消息进入多行模式）p[[优先级]状态]-&gt；优先顺序：-128/127，出席：在[fline]| aw[ay]| ch[at]| dn[d]| xa-&gt；不带arg：显示状态列表；无优先级：仅更改状态yp[jid[priority]状态[status]]-&gt；向jid发送状态，额外状态：订阅|订阅|取消订阅|取消订阅-&gt；无arg显示状态列表，包括不可用/离线Q-&gt；结束/退出节-&gt；发送原始节（无效数据可能导致XMPP服务器立即终止流）R[key]-&gt；显示原始（消息、iq.result）节，如果它包含键-禁用而没有键-&gt&#34;&lt&#34; （将匹配每一节），&#34；智商&#34&#34;信息&#34&#34;碳&#34&#34;openpgp&#34&#34;juliet@example.org&#34;, ... （要查看使用-DDEBUG编译的每一节，它将启用libstrophe XMPP_LEVEL_DEBUG）输出：i-&gt；infoI-&gt；信息离线，失去连接P-&gt；在场（使用j/l命令更改加入/离开状态）P-&gt；状态列表M-&gt；信息聊天（&#34；m from:message&#34；，如果碳来自self&#34；m-&gt；to:message&#34；）n-&gt；消息正常H-&gt；消息标题M-&gt；信息多-&gt；消息muc historyr-&gt；原始信息节-&gt；错误w-&gt；警告-命令错误-&gt；（标准）启动错误-&gt；将退出加密：-可以发送PGP加密消息（发送原始节）：&gt；BASE64_OPENPGP_MESSAGE=$（echo和#34；MESSAGE和#34；|gpg | BASE64）和#34&gt；echo和#34；r&lt；致=&#39；juliet@example.org&#39;&gt&书信电报；openpgp xmlns=&#39；urn:xmpp:openpgp:0&#39&gt${BASE64_OPENPGP_MESSAGE}&lt/openpgp&gt&lt/信息&gt&#34; | txmppc（节必须在一行中，可能由其他客户端支持：https://xmpp.org/extensions/xep-0373.html)-&gt；请注意，大多数客户已经实施了过时的：https://xmpp.org/extensions/xep-0027.html-&gt；用于接收原始消息节过滤（&#34；R opengpg&#34；）这是一种选择。-一种不符合XMPP的方式，如果两个客户端都使用txmppc，则可以使用任何加密编写脚本。年龄示例（不要使用受密码保护的密钥）：发件人：&gt；加密消息=&#34$（printf和#39；message和#39；age-r age1rredc3g8dfachch0d6gzt5katx3tsfesz35zc6jn3fl23jrfmq027uuuu9 | base64-w0）和#34&gt；printf和#39；Mjuliet@example.orgMYCRYPT:%s&#39&#34;${ENCRYPTED_MESSAGE}&#34；|txmppc接收器：&gt；txmppc |读线时；做加密的_消息=&#34${line#*MYCRYPT:}&#34；如果[&#34；${line}&#34；=&#34；${ENCRYPTED#MESSAGE}&#34；]；然后printf&#39；%s\n和#39&#34;${line}&#34；else MESSAGE=&#34$（printf&#39；%s&#39；&#34；${ENCRYPTED#u MESSAGE}&#34；| base64-d | age-d-i juliet.key）&#34；printf&#39；%s%s\n&#39&#34;${line%MYCRYPT:}&#34&#34;${MESSAGE}&#34；fi Donelices：https://holmeinbuch.de/repo/txmppc/ - matthias@Copyright（c）ISC License特此授予出于任何目的使用、复制、修改和/或分发本软件的许可，无论是否收费，前提是上述版权声明和本许可声明出现在所有副本中。软件提供&#34；原样&#34；作者否认与本软件有关的所有保证，包括所有关于适销性和适用性的暗示保证。在任何情况下，作者均不对因使用或执行本软件而产生的或与之相关的任何特殊、直接、间接或后果性损害或因使用、数据或利润损失而导致的任何损害负责，无论是在合同诉讼、疏忽或其他侵权诉讼中*/#包括&lt；ctype。h&gt#包括&lt；斯特迪奥。h&gt#包括&lt；stdlib。h&gt#包括&lt；一串h&gt#包括&lt；信号h&gt#包括&lt；系统/选择。h&gt#包括&lt；时间h&gt#包括&lt；unistd。h&gt；//https://www.rfc-editor.org/rfc/rfc6120-核心//https://www.rfc-editor.org/rfc/rfc6121-即时通讯+状态#包括&lt；斯特罗弗。h&gt；静态无符号短忽略证书失败=0；静态短路重新连接=1；//https://www.rfc-editor.org/rfc/rfc6120-&gt；4.6.4检查方法的使用：建议每5分钟不超过一次#定义PING_间隔60静态字符PING_id[32]#定义BUFIN_MAX 4096//https://www.rfc-editor.org/rfc/rfc6121-&gt；唐&#39；t干扰优先级，负数可能得不到消息静态短连接优先级=0；静态无符号短显示\存在\状态\更改=1#定义存在；定义存在；定义存在；定义存在；定义存在。JID）JID）JID）最大静态字符。静态字符表示。类型[10][[13][[10][[13]={35；34；离线；离线；离线和34；34；34；在线和34；在线和34；在线和34；在线和34；在线和34；在线和34；在线和34；34；34；34；以及以及以及以及以及以及（35；34；34；34；在线和34；在线；34；34；34；34；34；34；34；34；34；在线和，以及以及以及，以及以及，以及以及以及以及以及，以及以及以及以及以及以及，34；在线；34；34；34；34；34；34；34；34；34；34；在线和，以及，以及，以及，以及，以及，以及，以及，以及，以及以及，以及，以及以及，以及以及以及以及，以及以及以及以及，以及以及以及以及以及以及，34；34；34；34；34；34#34；取消订阅&#34；，&#34；取消订阅&#34；}#定义状态_离线0#定义状态_在线1#定义状态_在线_MUC-1#定义状态_在线_MUC-NO _历史-101#定义状态_离线_MUC-100//https://www.rfc-editor.org/rfc/rfc7622-地址（jid）#定义jid_MAX 3071+1上次发送的静态字符_类型_jid[1+jid_MAX]；struct list_node{char jid[jid_MAX]；短存在；短优先级；struct list_node*next；}；静态结构列表节点*jid\u list=NULL；//https://xmpp.org/extensions/xep-0172.html-尼克-&gt；昵称长度未定义//https://xmpp.org/extensions/xep-0045.html-muc-&gt；昵称是jid的资源部分#定义NICK_MAX 1023+1静态字符NICK[NICK_MAX]；静态短多_线=0#定义SHOW_RAW_STANZA_MAX 32静态字符SHOW_RAW_STANZA[SHOW_RAW_STANZA_MAX]；无符号短截取开始位置（char*buf，unsigned short start_pos）{unsigned short buf_len=（unsigned short）strlen（&amp；buf[start_pos]）+start_pos for（unsigned short i=start_pos；i&lt；buf_len；i++）{if（！isspace（buf[i]）{return i；}返回buf_len；}void update_jid_list（const char*jid，short presence，short priority）{struct list_node*list_before=NULL；struct list_node*list_current=jid_list；struct list_node*list_new=NULL；size_jid_len=strlen（jid）；而（list_current）{int jid_match=strnmp（jid，list_current-&gt；jid，jidlen）；if（jid_match==0）{（presence==presence\u OFFLINE\u MUC）{//remove jid，将MUC从列表中删除//如果self离开MUC，则使用裸jid-&gt；删除每个MUC条目，而（list\u current&amp；strncmp（jid，list\u current-&gt；jid\u len）==0）{if（list\u before）{list\u before-&gt；next=list\u current-&gt；next；free（list\u current）; list_current=list_before-&gt；下一步；}否则{jid_list=l</p><p>......</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/命令行/">#命令行</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/xmpp/">#xmpp</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/gt/">#gt</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>