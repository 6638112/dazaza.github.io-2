<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>冰湖AVX-512降频</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">冰湖AVX-512降频</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-20 05:02:58</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/da0063552588576775f07f3371b9d08c.jpg"><img src="http://img.diglog.com/img/2020/8/da0063552588576775f07f3371b9d08c.jpg" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>这是一篇简短的帖子，调查了英特尔最新的冰湖芯片上AVX2和AVX-512相关的基于许可证的降频行为。</p><p>基于许可证的降频1指的是当执行某些SIMD指令时，尤其是重浮点指令或512位宽指令时施加低于标称频率限制的半著名效应。</p><p>有关这种类型的降频的更多详细信息，请参阅StackOverflow解答，我们已经详细介绍了这些转换的低级机制。您还可以找到一些关于如何使用Wide SIMD的指南，给出了这个问题2。</p><p>所有这些都是在Skylake-SP(SKX)的环境下编写的，Skylake-SP(SKX)是支持AVX-512的第一代芯片。</p><p>那么冰湖(Ice Lake)呢，这款最新的芯片既支持AVX-512的SKX风格，又有一整套新的AVX-512指令？我们会不会被困在遥远的地方长时间凝视这些新的指令，而永远不会因为降频而被允许实际使用它们？</p><p>我们将使用avx-turbo实用程序来测量CPU的内核计数和指令混合相关频率。该工具以一种简单的方式工作：在给定数量的内核上运行给定的指令混合，同时测量测试期间达到的频率。</p><p>例如，avx256_fma_t测试(该测试测量具有高ILP的256位繁重指令的成本)运行以下FMA序列：</p><p>Vfmadd132pd ymm0，ymm10，ymm11 vfmadd132pd ymm1，ymm10，ymm11 vfmadd132pd ymm2，ymm10，ymm11 vfmadd132pd ymm3，ymm10，ymm11 vfmadd132pd ymm4，ymm10，ymm11 vfmadd132pd ymm5，ymm10，ymm11 vfmadd132pd ymm4</p><p>总共，我们将使用以下命令行，使用五个测试来测试256位和512位指令的每种轻重组合，以及标量指令(128位SIMD的行为与标量相同)：</p><p>如上所述，我在Ice Lake i5-1035G4上运行了AVX-turbo，这是运行速度高达3.7 GHz的中等Ice Lake客户端CPU。全部输出隐藏在要点中，但以下是最重要的频率结果(所有值均以GHz为单位)：</p><p>正如预期的那样，最大频率随着活动核计数的增加而降低，但向下扫描每列以查看指令类别的影响。沿着这个轴，几乎没有任何降频！只有对于单个活动内核计数，更宽的指令才会有任何减少，并且仅为100 MHz：当使用任何512位指令时，从3,700 MHz减少到3,600 MHz。</p><p>在任何其他场景中，包括任何时候多个内核处于活动状态，或者对于繁重的256位指令，都没有基于许可证的降频：一切都运行得和标量一样快。</p><p>这里还有另一个变化。在SKX中，与降频有关的许可证或指令类别有三种：L0、L1和L2。这里，在客户端ICL中，只有2个3，它们与SKX中的3个不完全一致。</p><p>更清楚地说，在SKX中，许可证映射到指令宽度和权重如下：</p><p>现在，256重型和512轻型在不同的类别！事实上，轻与重的整个概念似乎并不适用于这里：分类纯粹基于宽度4。</p><p>至少，这意味着我们需要调整我们对AVX-512指令的频率相关成本的心理模型。在这个冰湖芯片上，我们可以说AVX-512导致了微不足道的或零的基于许可证的降频，而不是“通常导致显著的降频”，我预计在其他冰湖客户芯片上也是如此。</p><p>现在，这种预期的调整伴随着一个重要的警告：基于许可证的降频只是降频的一个来源。也有可能达到功率、热量或电流限制。在超出运行功率限制之前，某些配置可能只能在所有内核上运行宽SIMD指令一小段时间。在我的例子中，我正在测试的250美元的笔记本电脑的散热性能非常差，我在几秒钟内就达到了热限制(100°C限制)，而不是功率限制，在所有内核上运行任何重的东西。</p><p>然而，这些其他限制与基于牌照的限制在性质上是不同的。它们主要是按您使用的方式付费的：如果您使用一两条宽大或繁重的指令，仅与这些指令相关的额外电力或热量成本微乎其微。这与一些基于许可证的转换不同，在这些转换中，核心或芯片范围的转换会在很长一段时间内影响不相关的后续执行。</p><p>由于较宽的操作通常比同等数量的较窄操作6的功耗更低，因此您可以预先确定一个较宽的操作是值得的-至少对于随宽度扩展很好的情况是这样。在任何情况下，问题都是最局部的：不依赖于周围代码的行为。</p><p>Ice Lake i5-1035CPU在运行512位指令时，仅有100 MHz基于许可证的下行时钟，具有1个活动内核。</p><p>3.3 GHz的全核512位Turbo频率是最大单核标量频率3.7 GHz的89%，因此在功率和热量限制下，该芯片的频率剖面非常“平坦”。</p><p>与SKX不同的是，这款冰湖芯片不区分“轻”和“重”指令用于频率调节目的：FMA操作与较轻操作的行为相同。</p><p>因此，在ICL客户端上，您不必担心宕机。只有时间会告诉我们这是否也适用于ICL服务器。</p><p>如果您有问题或任何类型的反馈，您可以在下面留言。我也对其他ICL芯片的结果感兴趣，比如i3和i7变种：如果你有这样的芯片，请告诉我，我们可以收集结果。</p><p>不断重复基于许可证的下行时钟会让人感到疲惫，所以我通常会简单地使用“下行时钟”，但这仍然应该被理解为指的是基于许可证的品种，而不是其他类型的频率节流。-↩。</p><p>只有两个可见：这三个(或更多)类别可能仍然存在，但它们只导致电压转换，而不是任何频率转换。-↩。</p><p>有人可能会认为这是ICL客户端在所有SKU上只有一个FMA单元的结果：非常繁重的FP 512位操作是不可能的。然而，这并不意味着256位重型仍然很快：您仍然可以在每个周期执行2x256位FMA，这与每个周期1x512位FMA的FP强度相同。更像是，在这个芯片上，FP操作不需要更多的基于许可证的保护，不受相同宽度的其他操作的影响，主要成本是512bit的宽度。--↩。</p><p>例如，一个512位的整数加法通常比计算相同结果所需的两个256位操作在能源使用上更便宜，因为执行开销不会随宽度线性扩展(这几乎是执行本身之外的所有事情)。-↩</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://travisdowns.github.io/blog/2020/08/19/icl-avx512-freq.html">https://travisdowns.github.io/blog/2020/08/19/icl-avx512-freq.html</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/冰湖/">#冰湖</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/lake/">#lake</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/指令/">#指令</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>