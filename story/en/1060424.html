<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>使用基于磁盘的redis克隆来减少AWS S3账单 Using a disk-based Redis clone to reduce AWS S3 bill</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">Using a disk-based Redis clone to reduce AWS S3 bill<br/>使用基于磁盘的redis克隆来减少AWS S3账单 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-28 11:23:50</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/5b03300ba6a5da1125c56b323663eff7.png"><img src="http://img2.diglog.com/img/2021/4/5b03300ba6a5da1125c56b323663eff7.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Redis is an in-memory database with very high write and read speed, and a limitation that data sets can’t be larger than available RAM.It’s like  memcached but supports data structures instead of just strings as values.Redis is great for caching lookups to AWS S3 from an external server, which can speed up your S3 reads and save you money on  Outgoing Data Transfer costs.However, having your entire data set limited to the size of available RAM on the machine means you can only cache a small fraction of your possible AWS S3 keys.Also with Redis, if snapshotting ever fails because you’ve used more RAM than available, your  snapshot will fail and force your Redis instance into  read-only mode.This means your production Redis database might suddenly stop allowing writes until you restart it, yikes!😱</p><p>Redis是一个具有非常高的写入和读取速度的内存数据库，并且数据集不能大于可用RAM.it就像MEMCACHED一样，但支持数据结构而不是仅仅是字符串，而不是作为值.Redis非常适合缓存查找非常重要从外部服务器到AWS S3，可以加快S3读取并将您节省您的资金在传出数据传输成本上。无论何种数据集，都可以限制在机器上的可用RAM的大小意味着您只能缓存小部分您可能的AWS S3 keys.Also with Redis，如果Snapshotting失败，因为您已经使用了更多的RAM而不是可用，那么您的快照将失败并将redis实例强制进入只读模式。这意味着您的生产Redis数据库可能突然停止允许写道，直到你重新启动它，yikes！😱</p><p>  Right now, you might be thinking of a solution… shard the data across a multi-machine Redis Cluster.That increases your max OPS, but also has some downsides:</p><p>  现在，您可能正在考虑一个解决方案......将数据划分多机REDIS集群。该拆分MAX操作，还有一些缺点：</p><p>   WakaTime uses  S3 as a database for user code stats, because hosting for traditional relational databases with data sets in the terabytes is expensive.Not to mention traditional relational databases don’t have the reliability, resiliency, scalability, and serverless features of S3.</p><p>   Wakatime使用S3作为用户代码统计数据库，因为托管Terabytes中的数据集的传统关系数据库很昂贵。要提及传统关系数据库的不可靠性，弹性，可伸缩性和S3的无服务器功能。</p><p> WakaTime hosts programming dashboards on  DigitalOcean servers.That’s because DigitalOcean servers come with dedicated attached SSDs, and overall give you much more compute bang for the buck than EC2.DigitalOcean’s S3 compatible object storage service ( Spaces) is very inexpensive, but we couldn’t use DigitalOcean Spaces for our primary database because it’s  much slower than S3.</p><p> Wakatime在DigitaloCean Servers上寄出编程仪表板。这是因为DigitalCean服务器带有专用的附加SSD，而且总体为您提供比EC2.DigItaloCean的S3兼容对象存储服务（空格）更加突出的计算爆炸，但我们不能是非常便宜的，但我们不能为我们的主数据库使用DigitaloCean Spaces，因为它比S3慢得多。</p><p> Transferring data from S3 to DigitalOcean servers costs $0.09 per GB, because Amazon charges a higher price for outgoing data transfers vs internal transfers.Using S3 as a database was becoming a significant portion of our monthly AWS bill.</p><p> 将数据从S3转移到DigitaloCean服务器费用$ 0.09每个GB，因为亚马逊为传出数据传输的价格较高，因为数据库作为数据库的重要组成部分是我们每月的一部分。</p><p>  To reduce costs and improve performance, we tried caching S3 reads with Redis.However, with the cache size limited by RAM it barely made a dent in our reads from S3.The amount of RAM we would need to cache multiple terabytes of S3 data would easily cost more than our total AWS bill.Instead, we decided to try several disk-based Redis alternatives and found one that fit our needs perfectly.</p><p>  为了降低成本并提高性能，我们尝试了使用Redis的缓存S3读取。然而，通过RAM限制的缓存大小，从S3中的读取中几乎没有凹陷。我们需要缓存的RAM数量的S3数据的多重数据轻松成本超过我们的AWS Bill.Instead，我们决定尝试几个基于磁盘的Redis替代方案，并找到一个适合我们需求的完美。</p><p>  We’ve been  using a disk-backed Redis alternative in production for over 3 years now called  SSDB.SSDB is a drop-in replacement for Redis, so you don’t need to change any client libraries.It uses  LevelDB (a key-value storage library by Google) behind the scenes to achieve performance comparable to Redis. According to benchmarks, writes to SSDB are slightly slower but reads are actually faster than Redis!😲</p><p>  我们已经在生产中使用的磁盘备份的Redis替代品超过3年，现在称为SSDB.SDB是Redis的另一个替代品，因此您无需更改任何客户端库。它使用leveldb（一个键 - 谷歌的价值存储库）在幕后实现与Redis相当的性能。根据基准测试，SSDB的写入略微慢，但读数实际上比REDIS快！😲 </p><p> SSDB supports  replication built-in and clustering with  twemproxy.Most importantly, it stores your data set on disk using RAM for caching.Our SSDB data set is 500GB and does a good job of lowering the number of reads we make to S3.Remember to  increase the file-max of your SSDB server to at least 10k, to prevent getting errors like  Too many open files or  Connection reset by peer.Also, remember to periodically trigger garbage collection on your SSDB data files by running ssdb-cli compact with this crontab:</p><p>SSDB支持与Twemproxy的复制内置和群集。最重要的是，它将您的数据设置在磁盘上使用RAM用于缓存.OUS SSDB数据集是500GB，并且在S3.Rembermber降低读数的良好工作是良好的工作。将SSDB服务器的File-Max增加到至少10k，以防止像Peer.Also重置过多的打开文件或连接重置错误，记住通过运行SSDB-CLI Compact与此定期触发SSDB数据文件上的垃圾收集CRONTAB：</p><p>  Or else you’ll see your SSDB disk usage  grow forever even after deleting keys.</p><p>  否则您将看到SSDB磁盘使用率即使在删除键后也会生长。</p><p>  Using SSDB to cache S3 has significantly reduced the outbound data transfer portion of our AWS bill! 🎉With performance comparable to Redis and using the disk to bypass Redis’s RAM limitation, SSDB is a powerful tool for lean startups.</p><p>  使用SSDB到缓存S3显着减少了我们AWS账单的出站数据传输部分！ 🎉与redis的性能相媲美并使用磁盘绕过redis的RAM限制，SSDB是一个强大的精简创业工具。</p><p> If you liked this post, browse similar writeups using the  devops tag.To get started with your free code time insights today,  install the WakaTime plugin for your IDE.</p><p> 如果您喜欢这篇文章，请使用Devops Tagse浏览类似的写作.To立即开始使用您的免费代码时间洞察力，为IDE安装Wakatime插件。 </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://wakatime.com/blog/45-using-a-diskbased-redis-clone-to-reduce-aws-s3-bill">https://wakatime.com/blog/45-using-a-diskbased-redis-clone-to-reduce-aws-s3-bill</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/s3/">#s3</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/based/">#based</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/redis/">#redis</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>