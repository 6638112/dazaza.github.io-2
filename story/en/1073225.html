<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CORS并不是为了保护API端点CORS is not meant to secure an API endpoint</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">CORS is not meant to secure an API endpoint<br/>CORS并不是为了保护API端点</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2022-02-15 02:40:18</div><div class="page_narrow text-break page_content"><p>A few days ago I came across this  article. The author shows how to access a  Drupal system in the backend with a Vue.js app. For authentication he uses an API key - and I find that dangerous. Here&#39;s why.</p><p>几天前我看到了这篇文章。作者展示了如何使用Vue在后端访问Drupal系统。js应用。他使用API密钥进行身份验证——我觉得这很危险。这里&#39；这就是为什么。</p><p> First, let me briefly explain the setup presented in the article: The backend is provided by Drupal. Drupal has integrated a JSON API in core since version 8, which can be easily activated via module management. With this it is now possible to access all entities (e.g. users, nodes, etc.) and read them via GET request.</p><p>首先，让我简要解释一下本文中介绍的设置：后端由Drupal提供。Drupal从版本8开始就在core中集成了JSON API，可以通过模块管理轻松激活。通过这种方式，现在可以访问所有实体（例如用户、节点等），并通过GET请求读取它们。</p><p>  The JSON API is based on the defined permissions in the Drupal system. So if a user has no read access to a content, then this content can also not be loaded via the JSON API. The same is true here for write access: an entity can only be created, modified or deleted if the accessing user has the appropriate permission.</p><p>JSON API基于Drupal系统中定义的权限。因此，如果用户对内容没有读取权限，那么也不能通过JSON API加载该内容。写访问也是如此：只有在访问用户拥有适当权限的情况下，才能创建、修改或删除实体。</p><p>  But back to the article: Here, the author describes how he accesses the Drupal backend in a client-side Vue app to create content. In the example shown, he creates a content (also called a node in Drupal) of type &#34;article&#34;.</p><p>但回到文章：在这里，作者描述了如何在客户端Vue应用程序中访问Drupal后端来创建内容。在所示的示例中，他创建了类型为&#34的内容（Drupal中也称为节点）；第34条；。</p><p> Now it gets interesting: he has configured his Drupal system so that only logged-in users can create articles. So, in order to create an article via the JSON API, he must first authenticate himself.</p><p>现在有意思了：他已经配置了他的Drupal系统，这样只有登录的用户才能创建文章。因此，为了通过JSON API创建一篇文章，他必须首先对自己进行身份验证。</p><p> There are several ways to authenticate to Drupal. The usual way is via a username and password. This is not only possible directly via the frontend, but also via the API. Here Drupal returns a session ID after successful authentication, which you can cache and use for all further requests.</p><p>有几种向Drupal进行身份验证的方法。通常的方法是通过用户名和密码。这不仅可以通过前端直接实现，还可以通过API实现。在这里，Drupal在成功验证后返回一个会话ID，您可以缓存该ID并将其用于所有进一步的请求。</p><p>  The author now uses another way: he installs the  Key auth module. This creates an API key for each user in the backend, which can be used for the authentication to the API. For this purpose, the parameter &#34;api-key&#34; must be passed with the key as value for each call. With this the user is automatically authenticated in Drupal and has all assigned rights.</p><p>作者现在使用另一种方法：安装密钥验证模块。这将为后端中的每个用户创建一个API密钥，用于对API进行身份验证。为此，参数&#34；api密钥&#34；必须将键作为每个调用的值传递。这样，用户就可以在Drupal中自动进行身份验证，并拥有所有分配的权限。</p><p>  And here he makes a dangerous mistake: he integrates the API key from the Drupal backend into his Vue.js app to be able to authenticate to the API and create content.</p><p>在这里，他犯了一个危险的错误：他将Drupal后端的API密钥集成到他的Vue中。js应用程序能够对API进行身份验证并创建内容。</p><p>  A Vue.js app is executed client-side nin the user&#39;s browser. This means that the source code is sent from the server directly to the browser. Now here the user has full access to the source code and can also read the auth key it contains.</p><p>一个Vue。js应用程序由用户在客户端执行&#39；s浏览器。这意味着源代码将从服务器直接发送到浏览器。现在，用户可以完全访问源代码，也可以读取其中包含的身份验证密钥。</p><p>  An environment variable is written to the source code during the build process of the web app. Environment variables are meant (as the name suggests) to provide different variables for different environments. For example, you can use different variables in a development environment than in a staging environment or a production environment. For example, if you want to integrate the payment provider  Stripe, you can use Stripe&#39;s test mode in the development and staging environment, while you use Stripe&#39;s live mode in the production environment.</p><p>在web应用程序的构建过程中，环境变量会写入源代码。环境变量的意思是（顾名思义）为不同的环境提供不同的变量。例如，您可以在开发环境中使用不同于暂存环境或生产环境的变量。例如，如果要集成支付提供商Stripe，可以使用Stripe&#39；在开发和登台环境中使用Stripe&#39；s在生产环境中的实时模式。</p><p> But the CORS setting makes sure that I can only access the backend from a certain domain</p><p>但是CORS设置确保我只能从特定域访问后端</p><p> No! CORS is an implementation in the browser and is designed to protect the user from malicious applications by ensuring that the resource in the browser is only allowed to access specific endpoints.</p><p>不CORS是浏览器中的一种实现，旨在通过确保浏览器中的资源仅允许访问特定端点来保护用户免受恶意应用程序的攻击。</p><p> This browser implementation can be bypassed at any time. First, it is up to the browser itself: if CORS is not integrated, or not integrated cleanly, then it will not work. The server sends a CORS header and it is up to the browser to decide how to handle it. This is not a security element, because it is not in the hands of the server to deny access here, but solely in the hands of the browser.</p><p>任何时候都可以绕过这种浏览器实现。首先，这取决于浏览器本身：如果CORS没有集成，或者没有干净地集成，那么它将无法工作。服务器发送CORS头，由浏览器决定如何处理。这不是一个安全元素，因为它不在服务器的手中，而在浏览器的手中。</p><p>  An attacker can access the API key via the source code of the web app and use it, for example, via a cURL request to directly access the API resources of the backend. With cURL, no CORS takes effect, so the attacker has direct access with the full rights of the user.</p><p>攻击者可以通过web应用的源代码访问API密钥，并使用它，例如，通过cURL请求直接访问后端的API资源。使用cURL时，CORS不会生效，因此攻击者可以使用用户的全部权限直接访问。</p><p>  An API key is an alternative to a username and password. Nobody would think of storing a username and password in the source code of a web app.</p><p>API密钥是用户名和密码的替代方案。没有人会想到在web应用程序的源代码中存储用户名和密码。</p><p> However, there are scenarios where this would still be possible. For example, if the API key had restricted rights. This is certainly the case for some services (e.g. some Google services, like Google Maps).</p><p>然而，在某些情况下，这仍然是可能的。例如，如果API密钥具有受限权限。对于某些服务（例如，一些谷歌服务，如谷歌地图），情况肯定是这样。</p><p> However, the &#34;Key auth&#34; module described in the article does not restrict the rights of the key. It is just an alternative to the username &amp; password.</p><p>然而&#34；主要作者&#34；本文中描述的模块不限制密钥的权限。它只是用户名&amp；暗语</p><p>  I came across the article because I was looking for ways to authenticate a Vue APP to a Drupal backend. Designkojo&#39;s article was one of the first to show up at the top of the search engine. In addition, the article has charm: it is well and compactly described. Especially for beginners the described way is easy and fast to implement. And it suggests: authentication via API key is a common way for a Web-App. And this is where it gets dangerous: especially inexperienced developers can fall for it and think that this is a common way to authenticate with a web app to a backend.</p><p>我读到这篇文章是因为我在寻找将Vue应用程序验证到Drupal后端的方法。Designkojo&#39；s的文章是最先出现在搜索引擎顶部的文章之一。此外，这篇文章也很有魅力：它描述得很好，很简洁。特别是对于初学者来说，所描述的方法易于快速实现。它表明：通过API密钥进行身份验证是Web应用程序的常见方式。这就是它变得危险的地方：尤其是没有经验的开发人员可能会上当，并认为这是一种通过后端的web应用进行身份验证的常见方法。</p><p> I contacted the author of the article via Twitter and explained my point of view. We had a discussion about it and he got my point. He added a warning to his article.</p><p>我通过Twitter联系了这篇文章的作者，并解释了我的观点。我们讨论了一下，他明白了我的意思。他在文章中加了一条警告。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/api/">#api</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/meant/">#meant</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>