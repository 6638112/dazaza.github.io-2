<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>为theGuardian.com构建脱机页面</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">为theGuardian.com构建脱机页面</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-07-26 02:09:52</div><div class="page_narrow text-break page_content"><p>你在去上班的火车上，打开手机上的卫报应用程序。一条隧道包围着你，但这款应用程序的工作方式仍然与往常非常相似-尽管你缺乏互联网连接，但你仍然可以获得完整的体验，只有显示的内容会变得陈旧。但是，如果您尝试对网站执行相同的操作，它将完全不会加载：</p><p>Chrome的隐藏游戏减轻了离线的痛苦(在桌面上按空格键，在移动设备上轻拍恐龙)。但我们可以做得更好。</p><p>服务人员允许网站作者拦截对其网站的所有网络请求，这意味着我们可以提供丰富的离线体验，就像本地应用程序一样。在“卫报”上，我们最近发布了我们自己的定制离线体验。当用户离线时，他们会看到一个卫报品牌的页面，上面有一条简单的离线消息，还有一个纵横字谜供他们在等待连接时玩。这篇博客文章是关于我们是如何建造它的，但首先，这里是你可以如何亲身体验它的方法。</p><p>您必须运行支持Service Worker和Fetch API的浏览器。在撰写本文时，只有Chrome(移动端和台式机)支持这两个API，但是Firefox很快就会支持这两个API(目前是夜间版本)，除了Safari之外，所有的浏览器都表现出了热情。此外，服务人员只能注册通过HTTPS提供服务的网站，theGuardian.com已经开始转向HTTPS。因此，我们只能为网站的HTTPS部分提供离线体验。目前，我们选择了开发者博客作为我们的试验场。所以，如果你在我们网站的开发者博客上读到这篇文章，你就很幸运了。</p><p>一旦您在支持的浏览器中访问了我们的开发人员博客上的页面，您就一切都准备好了。断开您的设备与互联网的连接并刷新。如果您无法亲自试用，请看此演示视频。</p><p>我们可以使用一些简单的JavaScript命令浏览器在用户到达页面后立即注册我们的服务工作者。目前对服务工作者的支持很少，因此我们需要使用功能检测来避免任何错误。</p><p>作为服务人员安装活动的一部分，我们可以使用新的缓存API来缓存我们网站的各种移动部分，如HTML、CSS和JavaScript：</p><p>Var staticCacheName=&#39；static&#39；var version=1；function updateCache(){1返回caches.open(staticCacheName+version))，然后(function(Cache){1)返回cache.addAll([])&#39；/Offline-page.html&#39；，#39；/sets/css/main.。/Assets/js/main.js&#39；{#39；{{#}；self.addEventListener(&#39；install&#39；，function(Event){www.event.waitUntil(updateCache())；})；</p><p>安装完成后，服务人员可以监听和控制FETCH事件，让我们完全控制网站将来产生的所有网络请求。</p><p>为了让您对我们这里的灵活性有一些了解，我们可以通过编程构造我们自己的响应：</p><p>Self.addEventListener(&#39；FETCH&#39；，Function(Event){var Response=new Response(&#39；&lt；h1&gt；Hello，World！&lt；/h1&gt；&39；，{Headers：{&#39；Content-Type&#39；：&#39；text/html&#39；}})；#event.respondWith(Response)；})；</p><p>或者，如果我们可以找到给定请求的匹配项，我们可以使用缓存中的内容进行响应，回退到网络：</p><p>Self.addEventListener(&#39；FETCH&#39；，Function(Event){Eventevent.respondWith(Fetch.caches.Match(event.request)和Event.Request)；Then(Function(Response){Fetch(event.request)；Function(Event.request)；Function(Event.Request}))；})；</p><p>首先，服务人员在安装时缓存离线页面所需的HTML和资源。此缓存中包括我们为纵横字谜页面开发的Reaction应用程序。此后，我们拦截对theGuardian.com上的网页的所有网络请求，包括对这些页面上的子资源的请求。处理这些请求的逻辑大致如下：</p><p>如果我们检测到传入的请求是指向某个HTML页面的导航，我们总是希望提供最新的内容，因此我们尝试通过网络向服务器发出请求。</p><p>如果网络请求抛出错误(即，由于用户脱机而失败)，我们将捕获该错误并使用脱机页面的缓存HTML进行响应。</p><p>否则，如果我们检测到请求不是HTML，我们将在缓存中查找该请求。</p><p>生成的代码使用新的缓存API(作为Service Worker API的一部分)和FETCH(用于发出网络请求)，如下所示：</p><p>Var doRequestAcceptHtml=function(Request){}；return request.headers.get(&#39；Accept&#39；)；.plit(&#39；，&#39；)；.Some(function(Type){return type=&#39；text/html&#39；；})；}；self.addEventListener(&#39；FETCH&#39；，Function(Event){0。**if(doRequestAcceptHtml(Request)){Do RequestAcceptHtml(&#39；/Offline-page.html&#39；；*FETCH(Request)*FETCH(Request)*.catch(function(){*caches.Match(&#39；/Offline-page.html&#39；)；*})*)；**}否则{//默认取回行为将首先为所有其他请求提供缓存//缓存，以获取事件.respondWith()、caches.Match(Request)、(Request)，然后(function(Response){、返回响应||Fetch(Request)；、())、()、()；}})；</p><p>我们有充分的理由对这些新的浏览器技术感到兴奋，因为它们可以用来为网站提供我们今天在本地应用程序中拥有的丰富的离线体验。将来，当theGuardian.com完成向HTTPS的迁移后，离线页面的重要性将会增加，我们可以对离线体验做进一步的改进。想象一下，在你没有互联网的通勤路上打开theGuardian.com去工作，找到为你个性化的内容，并在你访问之前由浏览器下载和缓存。安装过程中没有摩擦--与需要用户拥有应用商店帐户才能安装的本地应用不同，在网络上只需访问有问题的网站即可。服务人员还可以帮助缩短网站加载时间，因为可以像在本地应用程序中一样可靠地缓存网站的外壳。</p><p>如果你有兴趣了解更多关于服务工作者的知识和可能发生的事情，Chrome的开发者倡导者Matt Gaant已经写了一篇关于服务工作者的入门文章，对此进行了更详细的介绍。</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://www.theguardian.com/info/developer-blog/2015/nov/04/building-an-offline-page-for-theguardiancom">https://www.theguardian.com/info/developer-blog/2015/nov/04/building-an-offline-page-for-theguardiancom</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/脱机/">#脱机</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/offline/">#offline</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/网站/">#网站</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>