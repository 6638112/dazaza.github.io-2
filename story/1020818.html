<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>恒定时间LFU</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">恒定时间LFU</h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2020-08-28 06:05:47</div><div class="story_img_container"><a href="http://img.diglog.com/img/2020/8/ec10ebdc8db7d9ad3a2379b34bf172ed.png"><img src="http://img.diglog.com/img/2020/8/ec10ebdc8db7d9ad3a2379b34bf172ed.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>让任何系统都具有超强性能的一种常见策略是缓存。几乎所有大规模运行的软件产品在其体系结构中都有多层缓存。如果处理得当，缓存确实会影响响应时间，这也是产品在大规模环境下运行良好的主要原因之一。高速缓存引擎受可用内存量的限制，因此一旦内存变满，引擎就必须决定应该逐出哪个项目，这也是LFU和LRU等逐出算法的位置。开始发挥作用了。</p><p>LRU(最近最少使用)缓存清除策略是目前最流行的策略之一。LFU(最不频繁使用)策略在某些用例中表现良好，但其最流行的实现(其中使用最小堆)的一个问题是，它为所有三个操作(插入、更新和删除)提供了O(Logn)的运行时间复杂度；因此，它经常被次优但极快的O(1)LRU逐出方案所取代。</p><p>本文在Ketan Shah，Anirban Mitra和Dhruv Matani教授关于实现LFU缓存驱逐方案的O(1)算法的基础上，研究了常数时间LFU的实现，其中不使用最小堆，而是使用双向链表和哈希表的组合来获得所有三个核心操作的运行时间复杂度为O(1)。</p><p>LFU通常是使用根据每个元素的访问频率组织的最小堆来实现的。该堆的每个元素都保存一个成对的缓存值和访问频率；并且按照该频率的顺序进行组织，以便具有最低访问频率的缓存值位于顶部，从而快速识别要驱逐的元素。</p><p>虽然识别要驱逐的元素很快，但是为了让堆保持其属性-访问频率最低的元素位于顶部-它需要重新平衡，并且这个重新平衡过程的运行复杂度为O(Logn)。更糟糕的是，每次更改项的频率时都需要重新平衡；这意味着在实现LFU的缓存中，每次插入、访问或收回项时都需要重新平衡-使得所有三个核心操作的时间复杂度都为O(Logn)。</p><p>通过使用一个哈希表和一串双向链表，对于所有三种操作，LFU缓存的复杂度都可以达到O(1)。正如rum猜想所述，为了获得恒定时间的读取和更新操作，我们必须在内存利用率方面做出妥协。这正是我们在此实现中观察到的。</p><p>哈希表存储缓存键到保存缓存值的值节点的映射。键的值通常是指向实际值节点的指针。给定哈希表的查找复杂度为O(1)，从该哈希表访问给定关键字的值的操作可以在恒定的时间内完成。</p><p>上图描绘了保存高速缓存键K1、K2等的哈希表通过直接指针映射到保存值v1和v2的节点。节点是使用动态分配在堆上分配的，因此有点杂乱无章。键映射到的Value Node不仅保存缓存值，还保存一些指向系统中不同实体的指针，从而实现恒定时间操作。</p><p>LFU的这种实现要求我们维护一个双向链接的频率列表，称为freq_list，为跨越所有缓存值的每个唯一频率保存一个节点。该列表按节点表示的频率保持排序，使得表示最低频率的节点在一端，而表示最高频率的节点在另一端。</p><p>每个频率节点保存它在成员FREQ中表示的频率以及指向相邻频率节点的通常的NEXT和PREV指针；它还保持指向另一个双向链表的VALUES_PTR，该值列表保存具有相同访问频率FREQ的值节点(在哈希表中引用)。</p><p>双向链表的总体示意图及其排列如上图所示。存放频率节点的双向链表水平排列，而存放值节点的列表垂直排列，以便更清晰地查看和理解。</p><p>由于缓存值v1和v7都被访问了7次，因此它们都链接在双向链表中，并与代表频率7的频率节点挂钩。类似地，持有值v5、v3和v9的值节点也链接在另一个双向链表中，并与代表频率18的频率节点挂钩。</p><p>Value Node包含成员数据中的缓存值，以及通常指向列表中相邻值节点的NEXT和PREV指针。它还持有指向列表所挂接到的频率节点的freq_Pointer。拥有所有这些指针可以帮助我们确保所有三个操作都在恒定的时间内进行。</p><p>现在我们已经准备好了所有必要的结构，接下来我们来看一下3个核心操作及其伪实现。</p><p>向缓存添加新值是一个相对简单的操作，它需要一系列指针操作，并以恒定的时间运行复杂性完成这项工作。在缓存中插入值时，我们首先检查表中是否存在键，如果键已经存在，并尝试再次放置它，则函数将引发错误。然后，我们确保存在代表频率1的频率节点，并且在此过程中，我们可能还需要创建一个新的频率节点。然后，我们将值包装在一个Value Node中，并将其添加到此Frequency节点的VALUES_LIST中；最后，我们在表中创建一个条目，确认缓存过程已完成。</p><p>Def(key：str，value：object)：#检查表中是否已经存在键，#如果是，则返回错误，如果键在表中：Raise KeyAlreadyExistsError#持有所有必需的指针value_node=make_value_node(Value)first_Frequency_node=freq_list.head if first_Frequency_node.freq！=1：#由于freq_list中的第一个节点不代表#Frequency of 1，我们创建一个新节点first_Frequency_node=make_Frequency_node(1)#更新保存所有频率节点#的`freq_list`，使得第一个节点表示频率1#，而其他列表保持不变。First_requency_node.next=freq_list.head freq_list.head.prev=first_Frequency_node freq_list.head=first_Frequency_node#value节点指向其所属的频率节点value_node.freq_Pointer=first_Frequency_node#在`first_Frequency_node`first_Frequency_node.values.add(Value_Node)中添加值节点#更新哈希表[key]=value_node中的条目</p><p>从上面的伪代码中可以看出，在缓存中添加新值的整个过程是一堆内存分配以及一些指针操作，因此我们观察到此操作的运行复杂度为O(1)。</p><p>逐出(与插入类似)是一个琐碎的操作，我们只需选取访问频率最低的频率节点(freq_list中的第一个节点)，然后删除其valueslist中出现的第一个value Node。由于整个逐出过程还需要指针操作，因此其运行复杂度也为O(1)。</p><p>Def()：if freq_list.head and freq_list.head.value：first_value_node=freq_list.head.values.first Second_Value_node=first_value_node.next#将第二个元素设为first freq_list.head=Second_Value_node#确保第二个节点没有悬空的Prev链接Second_Value_node.prev=None#如果freq_list.head和#删除第一个元素delete_value_node(First_Value_Node)，则删除第一个元素DELETE_VALUE_NODE(FIRST_VALUE_NODE。Head.values：#如果逐出后的Frequency Node没有保存#我们去掉它的任何值delete_Frequency_node(freq_list.head)。</p><p>从高速缓存访问项必须是任何高速缓存中最常见的操作。在LFU方案中，在返回缓存值之前，引擎还必须更新其访问频率。确保更改一个缓存值的访问频率不需要进行某种重新平衡或重构来维护完整性，这就是此实现的特殊之处。</p><p>引擎首先对哈希表进行GET调用，以检查缓存中是否存在该键。在从检索到的值节点返回缓存值之前，引擎执行以下操作-它访问与检索到的值节点对应的频率节点及其同级节点。它确保同级节点的频率比频率节点的频率高1；如果不是这样，它会创建必要的频率节点，并将其放置为新的同级节点。然后，Value Node更改其与此同级频率节点的关联性，以使其正确匹配访问频率。最后，设置从Value Node到新Frequency Node的反向指针，并返回值。</p><p>Def(key：str)-&gt；object：#从哈希表获取Value Node value_node=table.get(key，one)#如果缓存中不存在该值，则返回错误#声明未找到key if not value_node：raise KeyNotFoundError#我们使用#freq_Pointer成员从值节点获取频率节点。FREENCY_NODE=VALUE_NODE.freq_POINTER#我们还将下一个频率节点获取到当前的#频率节点，以便我们可以调用#需要创建一个新节点。Next_Frequency_node=Frequency_node.next if next_Frequency_node.freq！=Frequency_node.freq+1：#新建频率节点new_Frequency_node=make_Frequency_node(Frequency_node.freq+1)#将频率节点放在列表Frequency_node.next中的正确位置。next=new_Frequency_node new_Frequency_node.prev=Frequency_node next_Frequency_node.prev=new_Frequency_node new_Frequency_node.prev=new_Frequency_node new_Frequency_node.prev=new_Frequency_node new_Frequency_node.prev=new_Frequency_node new_Frequency_node.prev=new_Frequency_node new_Frequency_。将新的频率节点称为Next#，因为它代表下一个频率节点Next_Frequency_node=new_Frequency_node#我们在neX Next_Frequency_node.values.add(Value_Node)中添加值Node#我们将父节点和形容词节点更改为此值节点value_node.freq_Pointer=Next_Frequency_node value_node.next=None value_node.prev=next_Frequency_node.values.last#如果频率节点没有元素，则删除。如果len(Frequency_node.values)==0，则内存泄漏：delete_Frequency_node(Frequency_Node)#返回值返回值_node.value。</p><p>同样，由于此操作也只处理通过直接指针的指针操作，因此此操作的运行时间复杂度也是恒定的时间。因此，我们可以看到恒定时间LFU实现，其中通过使用哈希表和双向链表来实现必要的时间复杂度。</p><p>如果你喜欢你所读的内容，订阅，你可以随时订阅我的时事通讯，并将帖子直接送到你的收件箱。我写各种工程主题的文章，并通过我的每周时事通讯👇与人分享。</p><p>一致性散列是设计高伸缩性的散列技术中最受欢迎的技术之一。</p><p>异常检测是一个由来已久的问题，在本文中，我们将深入研究一种无监督的算法...。</p><p>写时复制用于建模时间旅行，构建没有锁的数据库，并使分叉系统...</p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://arpitbhayani.me/blogs/lfu">https://arpitbhayani.me/blogs/lfu</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/时间/">#时间</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/节点/">#节点</a></button></div></div><div class="shadow p-3 mb-5 bg-white rounded clearfix"><div class="container"><div class="row"><div class="col-sm"><div><a target="_blank" href="/story/1020523.html"><img src="http://img.diglog.com/img/2020/8/thumb_877c7b1684737b5186cb4088f0f25dcd.png" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1020523.html">否=更多时间</a></div><span class="my_story_list_date">2020-8-27 3:45</span></div><div class="col-sm"><div><a target="_blank" href="/story/1019554.html"><img src="http://img.diglog.com/img/2020/8/thumb_3d62ab56c5287f942660fc900ad95e51.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1019554.html">物理学家说，时间之箭飞过五百年的古典音乐</a></div><span class="my_story_list_date">2020-8-21 15:4</span></div><div class="col-sm"><div><a target="_blank" href="/story/1019340.html"><img src="http://img.diglog.com/img/2020/8/thumb_4106f281da38b9caca7c09c68633614a.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1019340.html">运动相关因素对时间知觉的影响</a></div><span class="my_story_list_date">2020-8-20 20:36</span></div><div class="col-sm"><div><a target="_blank" href="/story/1018441.html"><img src="http://img.diglog.com/img/2020/8/thumb_04b248341818e8c494b0f4258d54c1db.jpg" class="img-fluid" onerror="this.style.display='none'"></a></div><div class="item_title"><a target="_blank" href="/story/1018441.html">由于时间膨胀，地核比其表面年轻2.5年</a></div><span class="my_story_list_date">2020-8-16 10:50</span></div></div></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/谷歌/">#谷歌</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>