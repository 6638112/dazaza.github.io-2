<!doctype html><html lang="zh-hans"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>我用一个python脚本击败了柏林租赁市场 I Beat the Berlin Rental Market with a Python Script</title><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"><link rel="stylesheet" href="/img/css.css?random="><link data-rh="true" rel="icon" href="/img/favicon.ico"/><script data-ad-client="ca-pub-6067137220025946" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5effb96910009800120b8d4d&product=inline-share-buttons" async="async"></script>
<script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?03c1a0f31299b4a2fbb83c34d6beaac9";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></head><body><div id="my_header"><div class="container"><nav class="navbar navbar-expand-lg"><a class="navbar-brand" href="/"><img alt="diglog" src="/img/logo.v1.gif" class="rounded-sm"></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNavAltMarkup"><div class="navbar-nav"></div></div></nav></div></div><div class="container"><div id="my_content"><h1 class="page_narrow">I Beat the Berlin Rental Market with a Python Script<br/>我用一个python脚本击败了柏林租赁市场 </h1><div class="row"><div class="col-lg-12 col-12"><div class="my_story_list_item shadow p-3 mb-5 bg-white rounded"><div class="story_page_pub_time page_narrow">2021-04-01 19:43:40</div><div class="story_img_container"><a href="http://img2.diglog.com/img/2021/4/0c6508a20922b1069e1b05b54bc07e73.png"><img src="http://img2.diglog.com/img/2021/4/0c6508a20922b1069e1b05b54bc07e73.png" class="img-fluid my_story_img" onerror="this.style.display='none'"></a></div><div class="page_narrow text-break page_content"><p>Usually, this means that prices tend to increase. That’s what used to happen in Berlin too. Then, a couple of years ago, the city municipality passed a controversial rent control policy that prevents price increase for at least 5 years.</p><p>通常，这意味着价格往往会增加。这就是曾经在柏林发生的东西。然后，几年前，城市市政府通过了一个有争议的租金控制政策，防止价格增加了至少5年。</p><p>  Housing supply contracted (instead of expanding), due to lack of financial incentives. Those who have a contract do their best to not walk away from it, even when they’d love to.</p><p>  由于缺乏财务激励，住房供应（而不是扩大）。那些合同的人尽力不要远离它，即使他们喜欢。</p><p> Today, renting in Berlin has little to do with spending power and all to do with competition: you find a rent offer, you visit the apartment with a dozen other people, and you pray that the landlord will select you among everyone else.</p><p> 今天，在柏林租赁与消费能力有关，与竞争有关：您可以找到租金优惠，您可以享受十几个人的公寓，您祈祷房东将在其他人中选择您。</p><p>  There are two elements that influence your ability to be selected and get the contract: your profile, and your speed.</p><p>  有两个元素会影响您选择的能力并获得合同：您的个人资料，以及您的速度。</p><p> You don’t have much room to change your profile, at least in the short term. Speed, however, is something you can play with.</p><p> 至少在短期内，您没有太多的空间来改变您的个人资料。然而，速度是你可以玩的东西。</p><p> It’s a trivial strategy: you ask for a visit  first, you go to the viewing  first, and you apply to get the house  first. There’s no guarantee that it will work, but it gives you an edge. Some agencies are pressured to allocate a house in a given timeframe, and might settle for the “good enough”. Others might be inexperienced amateurs that chicken out and just take the first in the queue.</p><p> 这是一项琐碎的策略：你先要求访问，你先去观看，你申请先拿到房子。没有保证它将工作，但它给你了一个优势。一些机构被迫在给定的时间范围内分配房屋，并可能满足于“足够好”。其他人可能是没有经验的业余爱好者，鸡出来，只是在队列中迈出第一个。</p><p> The critical problem of this approach is that you’re effectively making a massive financial decision — up to 50% of your income, for at least 1-2 years — in the span of hours, if not minutes. A big no-no.</p><p> 这种方法的关键问题是您有效地制定了大规模的财务决策 - 至少1-2岁 - 在几小时内的收入的50％，如果不是分钟。一个大的否。 </p><p> To counter this out, you should go to the viewing with your mind already made. However, this is not always easy: it takes many months of experience to start developing an intuition on what price makes sense for a given house.  Bargain or FOMO? Hard to tell.</p><p>要反击这一点，你应该用你的思想来看看。然而，这并不总是容易：需要几个月的经验，开始制定一个在特定房屋的价格是什么意义上的直觉。讨价还价或福福？很难说。</p><p> In the mix you should also consider the chance that a rent offer will change price: true, competition is bad, but sometimes landlords misprice their offering and get a group of applicants they judge too small. So they end up lowering the price hoping to attract better candidates.</p><p> 在混合中，您还应该考虑租赁报价将改变价格的机会：真实，竞争是坏的，但有时房东的含量非常糟糕，并获得一组申请人，他们判断得太小。所以他们最终降低了希望吸引更好的候选人的价格。</p><p> Finding a great deal is all about waiting if you can afford to do so, and then committing as fast as you can when a good deal is about to go out. Like the stock market.</p><p> 如果你能负担得起，那么等待很多，然后尽可能快地努力。像股票市场一样。</p><p> When I began my hunt, I realized it all came down to quantifying how expensive a house is with respect to similar houses. This is easier said than done. What does “similar house” really mean? It’s more nuanced than just taking the cost of a square meter: a more expensive house might be substantially cheaper when considering its balcony, or its location, or its lack of criminality in the area. It’s a  search-optimization problem, but one with quite nebulous variables at play.</p><p> 当我开始追捕时，我意识到这一切都归结为量化房子与类似房屋的昂贵程度。这比完成更容易。 “类似的房子”真的是什么意思？它比采取平方米的成本更加差别：在考虑其阳台或其位置或其在该地区缺乏犯罪时，更昂贵的房屋可能会比较便宜。这是一个搜索优化问题，但在播放时有一个具有相当虚弱的变量。</p><p> I’ll spoiler the end of this story: I ended up being able to find a house I like a lot.</p><p> 我会破坏这个故事的结束：我最终能够找到一个我喜欢的房子。</p><p> I’m paying less than how the market assesses its value (on average). There were 10 other people during the viewing, but they selected me nonetheless, most likely because I was the first to apply. I literally sent the documentation from the street in front of the apartment, after the viewing.</p><p> 我付出的价格低于市场如何评估其价值（平均）。观看中有10个人，但他们仍然选择了我，最有可能因为我是第一个申请的人。在观看后，我从公寓前面的街道上派出了文档。</p><p> I was able to do so because I was keenly aware of the specific characteristics of the neighborhood, because the house had changed price twice already (-7% first, and another -6% after that) and was unlikely to change the price again, and because it was very likely to be rented soon. I knew all of this thanks to a couple of predictive models and a few weekends of scraping real estate data.</p><p> 我能够这样做，因为我敏锐地意识到邻里的具体特征，因为房子已经改变了两次（ -  7％，而另一个--6％），不太可能再次改变价格，因为很可能很快租来。我认识到这一切，感谢几个预测模型和几个周末刮掉了房地产数据。 </p><p>   The first thing I needed was the data. I wrote a quick scraper, deployed it on a server, and let it loose. The goal was to build a dataset of all the housing offers in the city: cost, geolocation, and basic parameters describing the properties.</p><p>我需要的第一件事是数据。我写了一个快速刮刀，在服务器上部署它，让它松动。目标是建立城市所有住房优惠的数据集：成本，地理位置和描述属性的基本参数。</p><p> I wanted to move fast and cut corners — this was (supposed to be) a weekend project, not a huge product of sorts. I settled for MongoDB as a database of choice. I’ve read  many bad things about Mongo, but the reason why it’s bad is the reason why I liked it: ultra-high flexibility, ultra-low constraints (needed for scale, but hampering speed). I just had to dump some data somewhere: I couldn’t care less about migration and DTO consistency.</p><p> 我想快速移动和切割 - 这是（应该是）周末项目，而不是一个巨大的种类产品。我为MongoDB定居为首选数据库。我读了许多关于蒙古的坏事，但它是坏的原因是我喜欢它的原因：超高的灵活性，超低约束（规模需要，但速度妨碍速度）。我只需要在某处抛弃一些数据：我无法不在乎迁移和DTO一致性。</p><p> I also had no sophisticated chron: it was a Python script constantly running on a  tmux pane, connected to a MongoDB Atlas free instance. To that, I only added a Jupyter scratchpad to play with the results.</p><p> 我也没有复杂的chron：它是一个在Tmux窗格上不断运行的Python脚本，连接到MongoDB Atlas免费实例。为此，我只添加了一个jupyter scratchpad来玩结果。</p><p>   In real estate, it’s all about location. What does location mean, though? Is it the postal code? Is it the city neighborhoods? I tried it all. Postal codes lack granularity: they’re too broad and inhomogenous. Neighborhoods are a bit better, but they too are way too broad to allow for precise analysis.</p><p>   在房地产中，这完全是关于地点的。虽然位置是什么意思？是邮政编码吗？这是城市社区吗？我尝试了一切。邮政编码缺乏粒度：它们太宽阔而不合适。社区有点更好，但它们也太广泛而无法实现精确分析。</p><p> I ended up defining as “region” all the neighborhoods of the city — Prenzlauer Berg, Kreuzberg, Charlottenburg, etc. Then, I iteratively sliced them in half until the resulting cells (that I called “quarters”) weren’t smaller than a 5-minute walking distance from one border to the other.</p><p> 我最终定义了这个城市的所有社区 -  Prenzlauer Berg，Kreuzberg，Charlottenburg等，那么，我迭代地切成两半，直到得到的细胞（我称之为“Quarters”）并不小于a从一个边界到另一个边境的步行距离5分钟。</p><p>  In an ideal world, I should’ve defined these clusters with an unsupervised algorithm (denser regions weighting more), but I lacked enough rental offers to do so, and the historical data I found on all existing buildings was unreliable (it went back to the 70s, before the fall of the Wall: not the best way to describe today’s Berlin).</p><p>  在一个理想的世界中，我应该用一个无监督的算法（更加权更多的算法来定义这些群集，但我缺乏足够的租赁提供，并且我在所有现有建筑物上发现的历史数据不可靠（它返回到70年代，在墙壁落后：不是描述当今柏林的最佳方式）。</p><p> To store the information, I used  GeoJSON. It’s natively supported by Mongo, and being open made it easy to find libraries I could work with.</p><p> 要存储信息，我使用了Geojson。它是由Mongo的本地支持，并且开放使得可以轻松找到我可以使用的图书馆。 </p><p> The trickiest part was computing distances. The distance from point-A to point-B is not a straight line, because they’re on top of a round surface. Luckily, libraries like   pyproj and   shapely came to the rescue.</p><p>最棘手的部分是计算距离。从点-A到point-B的距离不是一条直线，因为它们在圆形表面的顶部。幸运的是，像pyproj这样的图书馆和匀称地来到救援。</p><p>   With information on rents and a neat way to group them in reasonable regions, I then proceeded to add some features to the dataset.</p><p>   通过关于租金的信息和在合理区域中对其进行分组的简洁方式，我继续向数据集添加一些功能。</p><p> I went on to dump all the data I could. For each region, I created a set of scores and indices describing the quality of public transports, the average density of car-sharing vehicles, safety and criminality, outdoor activities, number and quality of bars and food venues.</p><p> 我继续抛弃我可以的所有数据。对于每个地区，我创建了一组分数和指数，描述了公共交通的质量，汽车分享车辆的平均密度，安全和犯罪，户外活动，酒吧和食品场地的数量和质量。</p><p> I used a host of services to do so. In some instances, I had to produce the data myself (car-sharing and public transports: some good old scraping here too). In other cases, the data was conveniently handed off in public datasets.</p><p> 我用了一系列服务来这样做。在某些情况下，我必须自己制作数据（汽车分享和公共交通工具：在这里有些好老刮）。在其他情况下，数据在公共数据集中方便地交出。</p><p>   I normalized the scores to make them easily comparable across regions. The outcome was a pretty good map of interesting data I cared about in the city.</p><p>   我标准化了分数，使它们容易跨越地区。结果是我在城市关心的有趣数据的一个很好的地图。</p><p>   The first number I worked on was a  “market alignment” score: how far is the price of a given offer when compared to similar ones on the market? In other words:  is it worth the price they’re asking?</p><p>   我工作的第一个号码是一个“市场对齐”得分：与市场上类似的产品相比，给定提供的价格有多远？换句话说：它是值得的，他们要问吗？</p><p> To compute the market alignment, I took all the offerings within a radius of 5km from the one being considered. Then, I retained in the pool only those that were:</p><p> 为了计算市场对齐，我从被考虑的人中占据了5km的半径范围内的所有产品。然后，我只保留在池中，那些是： </p><p> » Within ±1 standard deviations from the price of the rent, its number of rooms, its living space, and its construction year,</p><p>»在租金价格的±1标准偏差范围内，其客房数量，生活空间及其建设年份，</p><p> » Within ±1.5 standard deviations from the general characteristics of the region it’s located in,</p><p> »在±1.5内的标准偏差范围内，它位于该地区的一般特征内，</p><p> This typically kept ~5% of the initial group of offers. It’s possible to play with the numbers — for instance, by increasing the initial radius: more data but potentially less precise. Empirically, this worked out pretty well.</p><p> 这通常持续〜5％的初始优惠组。可以使用数字 - 例如，通过增加初始半径：更多数据但可能更加精确。经验上，这效果很好。</p><p> Within this sub-group, I then computed the price per square meter, and saw how far the rent offer was from the mean of the sub-group:</p><p> 在这个子组中，我然后计算每平方米的价格，并看到租金提供的租金来自子集团的平均值：</p><p>  This number was enough for me to have a reasonable idea of what the market considers a “fair price”, versus how the offer was actually priced. In case of a substantially negative delta, I was in for a good deal.</p><p>  这个号码足以让我有一个合理的想法，市场考虑了“公平价格”，而且如何提供该报价的实际价格。如果是一个基本上负面的delta，我是一个很好的交易。</p><p> I also computed two more numbers: the  likelihood that the rent was  about to go sold out soon, and the  likelihood of a price decrease.</p><p> 我还计算了两个人：租金即将售罄的可能性很快，价格下降的可能性下降。</p><p> To get these numbers I trained two supervised models. I fine-tuned the pipeline and hyperparameters with genetic programming on an AWS GPU-heavy machine (still the easiest way to do machine learning, and yet very expensive: there’s so much room for disruption in this space). I didn’t have time to work on the model — again: this was supposedly a weekend project —, so having a machine do the heavy lifting for me, even if less efficiently, was exactly what I needed.</p><p> 要获得这些数字，我训练了两个监督模型。我精致的管道和封闭式遗传编程在AWS GPU-reforms上（仍然是机器学习的最简单方法，而且非常昂贵：这个空间中有这么多的破坏空间）。我没有时间在模型上工作 - 再次：这是一个周末项目 - 所以拥有一台机器对我进行沉重的提升，即使较低的是我需要的。 </p><p>    I won’t lie, I have the feeling that all this was a bit over-engineered. I found a house I’m super happy with, but maybe there was an easier way to do it. In any case, it was an interesting opportunity to get to know the real estate market in Berlin and to explore technologies I wasn’t familiar with.</p><p>我不会撒谎，我有一种感觉，所有这一切都有点过度设计。我发现了一个我超级满意的房子，但也许有一种更简单的方法。无论如何，这是一个有趣的机会，了解柏林房地产市场，探索我不熟悉的技术。</p><p> I’m now in the process of turning this work into a web app. Again, a good opportunity to explore technologies and marketing tactics.</p><p> 我现在正在将这项工作转变为Web应用程序。再次，探索技术和营销策略的良好机会。</p><p>   I honestly have no clue if there’s a market for this product. I also don’t know who might be the most efficient demographic to start from as a go-to-market strategy. I’m currently testing a few ideas (rigorously on weekends!), and the initial results are very interesting.</p><p>   如果是这个产品的市场，我真的没有线索。我也不知道谁可能是最有效的人口，以从作为上市战略开始。我目前正在测试一些想法（周末严格！），初步结果非常有趣。</p><p> This won’t solve the real estate problem in Berlin. For that there’s one solution only: build more houses. The goal of this tool was (and will be, moving forward) finding great deals at best, and not be screwed over at worst.</p><p> 这不会解决柏林的房地产问题。为此仅有一种解决方案：构建更多的房屋。这个工具的目标是（并且将是，前进）最多发现很大的优惠，而不是在最坏的情况下拧紧。</p><p> There are two main clusters of people I’m thinking of: real estate agents, trying to exploit arbitrage opportunities, and young expats with moderately high spending power (your average developer, for instance) trying to rent consciously.</p><p> 我正在考虑的两个人的主要集群：房地产经纪人，试图利用套利的机会，年轻的外籍人士与中等高度的消费电力（例如，您的平均开发人员）试图有意识地租用。</p><p>   If you enjoyed this content,  follow me on  Twitter where I’ll keep posting updates on my building activities. Feel free to reach out if you have questions: my DMs are open.</p><p>   如果您享受此内容，请在Twitter上关注我，我将继续发布关于我的建筑活动的更新。如果您有疑问，请随时伸出协议：我的DMS是开放的。</p><p>  /* An big thanks to  Art &amp;  Ergest, that helped me edit earlier drafts of this post. */</p><p>  / *感谢艺术＆amp;呃，这帮助我编辑了这篇文章的早期草案。 * / </p></div><div id="story_share_this"><div class="sharethis-inline-share-buttons"></div></div><div class="text-break sotry_link page_narrow"><a target="_blank" href="https://giansegato.com/essays/how-i-beat-the-berlin-rental-market-with-a-python-script/">https://giansegato.com/essays/how-i-beat-the-berlin-rental-market-with-a-python-script/</a></div><div class="story_tags page_narrow"><button type="button" class="btn btn-light my_tag"><a href="/tag/python/">#python</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/脚本/">#脚本</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/berlin/">#berlin</a></button><button type="button" class="btn btn-light my_tag"><a href="/tag/价格/">#价格</a></button></div></div><div class="my_movie_list_item shadow p-3 mb-5 bg-white rounded"><button type="button" class="btn btn-link my_tag"><a href="/tag/web2.0/">#web2.0</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/google/">#google</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/设计/">#设计</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/创意/">#创意</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/摄影/">#摄影</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/图片/">#图片</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/游戏/">#游戏</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/软件/">#软件</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/视频/">#视频</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/手机/">#手机</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/广告/">#广告</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/网站/">#网站</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/iphone/">#iphone</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/免费/">#免费</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/下载/">#下载</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/windows/">#windows</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/微软/">#微软</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/firefox/">#firefox</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/blog/">#blog</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/apple/">#apple</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/音乐/">#音乐</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/苹果/">#苹果</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/博客/">#博客</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/wordpress/">#wordpress</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/恶搞/">#恶搞</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/qq/">#qq</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/艺术/">#艺术</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/web/">#web</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/工具/">#工具</a></button><button type="button" class="btn btn-link my_tag"><a href="/tag/分享/">#分享</a></button></div></div></div><div id="my_footer"><div class=""><a href="/tags/">tags</a> <a href="/users/">users</a></div>&copy;2012-2021 diglog.com </div></div></body></html>